# 🎨 設計工具深度分析

> 針對手冊設計器 (brochure) 和網頁行程設計 (itinerary/new) 的完整分析

---

## 📍 一、兩個工具的定位

| 工具 | 目的 | 產出 | 使用者 |
|------|------|------|--------|
| **手冊設計器** | 製作印刷用旅遊手冊 | PDF 文件 | 業務/設計 |
| **網頁行程設計** | 製作線上行程頁面 | 網頁連結 | 業務 |

---

## 📊 二、現有架構

### 手冊設計器 (brochure)
```
URL: /brochure?tour_id=xxx

┌─────────────────────────────────────────────────────┐
│                    頂部工具列                        │
│  [返回] [存檔] [縮放] [對齊] [圖層] [匯出PDF]        │
├──────────┬──────────────────────────┬───────────────┤
│ 左側     │                          │    右側       │
│ 頁面列表 │      Canvas 畫布         │  屬性面板     │
│          │     (Fabric.js)          │ /模板資料     │
│ [新增頁] │                          │               │
│ Day 1    │    ┌──────────────┐      │ [封面圖]      │
│ Day 2    │    │   設計內容   │      │ [標題]        │
│ Day 3    │    │              │      │ [每日行程]    │
│ 備忘錄   │    └──────────────┘      │               │
└──────────┴──────────────────────────┴───────────────┘

檔案數：72 個
主檔案：brochure/page.tsx (3060 行)
技術：Fabric.js Canvas
```

### 網頁行程設計 (itinerary/new)
```
URL: /itinerary/new?itinerary_id=xxx

┌─────────────────────────────────────────────────────┐
│                    頂部工具列                        │
│  [返回] [自動存檔狀態] [發布]                        │
├─────────────────────────┬───────────────────────────┤
│        左側編輯區        │       右側預覽區          │
│       (表單輸入)         │    (即時預覽)             │
│                         │                           │
│  [封面資訊]              │   ┌─────────────────┐    │
│  [航班資訊]              │   │  💻 電腦 / 📱 手機 │    │
│  [每日行程]              │   ├─────────────────┤    │
│  [飯店資訊]              │   │                 │    │
│  [價格說明]              │   │   TourPreview   │    │
│                         │   │                 │    │
│                         │   └─────────────────┘    │
└─────────────────────────┴───────────────────────────┘

檔案數：~15 個
主檔案：itinerary/new/page.tsx (288 行)
技術：React Forms + TourPreview 組件
```

---

## 🔴 三、痛點分析

### 手冊設計器

#### 1. 概念混亂
| 問題 | 說明 |
|------|------|
| **三層資料** | templateData / generatedPages / Canvas 三層資料，用戶不知道改哪個有效 |
| **雙向綁定** | 剛實作，但還沒完整測試 |
| **模板 vs 自由編輯** | 哪些元素是模板控制的？哪些可以自由改？界線模糊 |

#### 2. 操作不直覺
| 問題 | 說明 |
|------|------|
| **天數問題** | 複製頁面時天數混亂（剛修復）|
| **存檔時機** | 什麼時候存？有沒有存成功？不明確 |
| **頁面生成** | 有些改動會重新生成頁面，有些不會，邏輯不一致 |

#### 3. 效能擔憂
| 問題 | 說明 |
|------|------|
| **主檔案太大** | 3060 行，難以維護 |
| **狀態太多** | 25+ 個 useState |
| **重繪頻繁** | 擔心雙向綁定會造成效能問題 |

### 網頁行程設計

#### 1. 功能分散
| 問題 | 說明 |
|------|------|
| **多種格式** | TourForm / GeminiItinerary / PrintItinerary 三種格式，入口不清楚 |
| **和手冊的關係** | 同樣的行程資料，但介面完全不同 |

#### 2. 編輯體驗
| 問題 | 說明 |
|------|------|
| **表單很長** | 要滾動很多才能編輯完 |
| **預覽延遲** | 不確定改動是否即時反映 |

---

## 💡 四、參考業界最佳實踐

### Canva 的設計原則
1. **所見即所得** — 畫布就是最終結果
2. **自動存檔** — 不需要手動按存檔
3. **模板只是起點** — 套用後就是你的，自由編輯
4. **清楚的層級** — 頁面 > 元素，沒有中間層

### Notion 的編輯原則
1. **Block-based** — 所有內容都是區塊
2. **即時同步** — 改了就存
3. **版本歷史** — 可以回到任何時間點

### Figma 的協作原則
1. **單一真相** — 只有一份設計，不會有同步問題
2. **即時預覽** — 改動立即可見
3. **清楚的 Auto-save 指示** — 「已儲存」狀態很明顯

---

## ✅ 五、改進建議

### 手冊設計器

#### Phase 1：清理概念
- [ ] **統一資料模型** — 移除 templateData/generatedPages 分離，直接操作 CanvasPage[]
- [ ] **標記模板元素** — 清楚區分「模板元素」和「用戶添加的元素」
- [ ] **狀態指示** — 清楚顯示「已存檔」「未存檔」狀態

#### Phase 2：簡化 UI
- [ ] **右側面板** — 根據選取的元素動態顯示屬性，而不是固定顯示 templateData
- [ ] **頁面管理** — 拖拉排序、批量操作
- [ ] **快捷鍵** — 常用操作的鍵盤快捷鍵

#### Phase 3：效能優化
- [ ] **拆分檔案** — 3060 行 → 多個模組
- [ ] **減少 useState** — 用 zustand 或 useReducer 管理複雜狀態
- [ ] **懶加載** — 圖片和頁面縮圖的懶加載

### 網頁行程設計

#### Phase 1：統一入口
- [ ] **合併格式** — 一個編輯器，多種輸出格式
- [ ] **和手冊共享** — 共用行程資料編輯組件

#### Phase 2：改善體驗
- [ ] **摺疊區塊** — 可收合的編輯區塊
- [ ] **即時存檔** — 自動存檔 + 狀態指示
- [ ] **快速預覽** — 不需要切換視窗就能預覽

---

## 🎯 六、建議的優先順序

### 今晚可以做
1. **手冊：清楚的存檔狀態指示** — 讓用戶知道有沒有存
2. **手冊：測試雙向綁定** — 確保剛做的改動沒問題
3. **列出所有 UX 問題** — 實際操作一遍，記錄所有困惑點

### 短期（1-2 週）
1. 右側面板重構 — 根據選取元素顯示
2. 統一資料模型 — 移除三層架構
3. 檔案拆分 — 提高可維護性

### 中期（1-2 月）
1. 兩個工具共享行程編輯組件
2. 完整的版本控制 UI
3. 協作功能（如果需要）

---

*最後更新：2025-01-30*
