# 資料庫 Schema 文件

> **自動產生日期**: 2026-02-18
> **資料庫**: Supabase (pfqvdacxowpgfamuvnsn)

## customers

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | text | NO | - |
| code | text | NO | - |
| name | text | NO | - |
| phone | text | YES | - |
| email | text | YES | - |
| address | text | YES | - |
| national_id | text | YES | - |
| emergency_contact | jsonb | YES | '{}'::jsonb |
| total_orders | integer | YES | 0 |
| total_spent | numeric | YES | 0 |
| notes | text | YES | - |
| is_active | boolean | YES | true |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| english_name | text | YES | - |
| alternative_phone | text | YES | - |
| city | text | YES | - |
| country | text | YES | '台灣' |
| passport_number | text | YES | - |
| birth_date | date | YES | - |
| gender | text | YES | - |
| company | text | YES | - |
| tax_id | text | YES | - |
| is_vip | boolean | YES | false |
| vip_level | text | YES | - |
| source | text | YES | - |
| referred_by | text | YES | - |
| last_order_date | timestamptz | YES | - |
| passport_name | varchar | YES | - |
| passport_expiry | date | YES | - |
| workspace_id | uuid | YES | - |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |
| verification_status | enum | NO | 'unverified' |
| passport_image_url | text | YES | - |
| nationality | text | YES | - |
| sex | text | YES | - |
| nickname | text | YES | - |
| member_type | text | NO | 'member' |
| avatar_url | text | YES | - |
| total_points | integer | YES | 0 |
| dietary_restrictions | text | YES | - |
| linked_at | timestamptz | YES | - |
| linked_method | text | YES | - |
| passport_name_print | text | YES | - |
| online_user_id | uuid | YES | - |

## driver_tasks

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | uuid | NO | gen_random_uuid() |
| task_code | varchar | NO | - |
| tour_request_id | uuid | YES | - |
| tour_id | uuid | YES | - |
| tour_code | varchar | YES | - |
| tour_name | varchar | YES | - |
| supplier_id | uuid | NO | - |
| supplier_name | varchar | YES | - |
| driver_id | uuid | YES | - |
| driver_name | varchar | YES | - |
| driver_phone | varchar | YES | - |
| vehicle_info | varchar | YES | - |
| service_date | date | NO | - |
| pickup_time | timestamptz | NO | - |
| pickup_location | varchar | NO | - |
| pickup_address | text | YES | - |
| pickup_lat | numeric | YES | - |
| pickup_lng | numeric | YES | - |
| pickup_note | text | YES | - |
| dropoff_location | varchar | NO | - |
| dropoff_address | text | YES | - |
| dropoff_lat | numeric | YES | - |
| dropoff_lng | numeric | YES | - |
| dropoff_note | text | YES | - |
| stops | jsonb | YES | '[]'::jsonb |
| passenger_name | varchar | YES | - |
| passenger_phone | varchar | YES | - |
| passenger_count | integer | YES | - |
| passenger_note | text | YES | - |
| agency_contact_name | varchar | YES | - |
| agency_contact_phone | varchar | YES | - |
| status | varchar | YES | 'pending' |
| assigned_at | timestamptz | YES | - |
| accepted_at | timestamptz | YES | - |
| started_at | timestamptz | YES | - |
| picked_up_at | timestamptz | YES | - |
| completed_at | timestamptz | YES | - |
| cancelled_at | timestamptz | YES | - |
| internal_note | text | YES | - |
| driver_note | text | YES | - |
| estimated_cost | numeric | YES | - |
| final_cost | numeric | YES | - |
| currency | varchar | YES | 'TWD' |
| workspace_id | uuid | NO | - |
| source_workspace_id | uuid | YES | - |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |

## itineraries

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | text | NO | gen_random_uuid()::text |
| tour_id | text | YES | - |
| description | text | YES | - |
| created_at | timestamptz | NO | now() |
| updated_at | timestamptz | NO | now() |
| _deleted | boolean | YES | false |
| _needs_sync | boolean | YES | false |
| _synced_at | timestamptz | YES | - |
| created_by | uuid | YES | - |
| author_name | text | YES | - |
| code | text | YES | - |
| workspace_id | uuid | NO | - |
| updated_by | uuid | YES | - |
| tagline | text | YES | - |
| title | text | YES | - |
| subtitle | text | YES | - |
| country | text | YES | - |
| city | text | YES | - |
| status | text | YES | - |
| features | jsonb | YES | - |
| leader | jsonb | YES | - |
| departure_date | text | YES | - |
| tour_code | text | YES | - |
| cover_image | text | YES | - |
| outbound_flight | jsonb | YES | - |
| return_flight | jsonb | YES | - |
| focus_cards | jsonb | YES | - |
| meeting_info | jsonb | YES | - |
| itinerary_subtitle | text | YES | - |
| daily_itinerary | jsonb | YES | - |
| show_features | boolean | YES | false |
| hotels | jsonb | YES | '[]'::jsonb |
| show_leader_meeting | boolean | YES | false |
| show_hotels | boolean | YES | false |
| version | integer | YES | 1 |
| parent_id | text | YES | - |
| is_latest | boolean | YES | true |
| version_records | jsonb | YES | '[]'::jsonb |
| archived_at | timestamptz | YES | - |
| is_template | boolean | YES | false |
| closed_at | timestamptz | YES | - |
| cover_style | text | YES | 'original' |
| price | text | YES | - |
| price_note | text | YES | - |
| show_pricing_details | boolean | YES | false |
| pricing_details | jsonb | YES | - |
| price_tiers | jsonb | YES | - |
| show_price_tiers | boolean | YES | false |
| faqs | jsonb | YES | - |
| show_faqs | boolean | YES | false |
| notices | ARRAY | YES | - |
| show_notices | boolean | YES | false |
| cancellation_policy | ARRAY | YES | - |
| show_cancellation_policy | boolean | YES | false |
| erp_itinerary_id | text | YES | - |
| summary | text | YES | - |
| duration_days | integer | YES | - |
| flight_style | text | YES | 'original' |
| itinerary_style | text | YES | 'original' |
| cover_template_id | text | YES | - |
| daily_template_id | text | YES | - |
| flight_template_id | text | YES | - |
| leader_style | text | YES | 'original' |
| hotel_style | text | YES | 'original' |
| pricing_style | text | YES | 'original' |
| features_style | text | YES | 'original' |
| created_by_legacy_user_id | uuid | YES | - |
| proposal_package_id | uuid | YES | - |

## order_members

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | uuid | NO | gen_random_uuid() |
| order_id | uuid | NO | - |
| customer_id | uuid | YES | - |
| member_type | text | NO | - |
| created_at | timestamptz | YES | now() |
| identity | varchar | YES | - |
| chinese_name | varchar | YES | - |
| passport_name | varchar | YES | - |
| birth_date | date | YES | - |
| age | integer | YES | - |
| id_number | varchar | YES | - |
| gender | varchar | YES | - |
| passport_number | varchar | YES | - |
| passport_expiry | date | YES | - |
| special_meal | varchar | YES | - |
| pnr | varchar | YES | - |
| flight_cost | numeric | YES | - |
| hotel_1_name | varchar | YES | - |
| hotel_1_checkin | date | YES | - |
| hotel_1_checkout | date | YES | - |
| hotel_2_name | varchar | YES | - |
| hotel_2_checkin | date | YES | - |
| hotel_2_checkout | date | YES | - |
| transport_cost | numeric | YES | - |
| misc_cost | numeric | YES | - |
| total_payable | numeric | YES | - |
| deposit_amount | numeric | YES | - |
| balance_amount | numeric | YES | - |
| deposit_receipt_no | varchar | YES | - |
| balance_receipt_no | varchar | YES | - |
| remarks | text | YES | - |
| cost_price | numeric | YES | - |
| selling_price | numeric | YES | - |
| profit | numeric | YES | - |
| workspace_id | uuid | YES | - |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |
| passport_image_url | text | YES | - |
| ticket_number | varchar | YES | - |
| ticketing_deadline | date | YES | - |
| flight_self_arranged | boolean | YES | false |
| contract_created_at | timestamptz | YES | - |
| checked_in | boolean | YES | false |
| checked_in_at | timestamptz | YES | - |
| passport_name_print | text | YES | - |
| sort_order | integer | YES | 0 |

## orders

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | text | NO | - |
| code | text | NO | - |
| tour_id | text | YES | - |
| customer_id | text | YES | - |
| contact_person | text | NO | - |
| contact_phone | text | YES | - |
| contact_email | text | YES | - |
| adult_count | integer | YES | 0 |
| child_count | integer | YES | 0 |
| infant_count | integer | YES | 0 |
| total_people | integer | YES | 0 |
| total_amount | numeric | YES | 0 |
| paid_amount | numeric | YES | 0 |
| status | text | YES | 'pending' |
| payment_status | text | YES | '未收款' |
| notes | text | YES | - |
| is_active | boolean | YES | true |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| tour_name | text | YES | - |
| sales_person | text | YES | - |
| assistant | text | YES | - |
| member_count | integer | YES | 0 |
| remaining_amount | numeric | YES | 0 |
| order_number | text | YES | - |
| workspace_id | uuid | YES | - |
| identity_options | jsonb | YES | default |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |

## payment_requests

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | uuid | NO | gen_random_uuid() |
| code | text | NO | - |
| tour_id | uuid | YES | - |
| request_type | text | NO | - |
| amount | numeric | NO | - |
| supplier_id | uuid | YES | - |
| supplier_name | text | YES | - |
| status | text | YES | 'pending' |
| approved_by | uuid | YES | - |
| approved_at | timestamptz | YES | - |
| paid_by | uuid | YES | - |
| paid_at | timestamptz | YES | - |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| workspace_id | uuid | YES | - |
| request_date | date | YES | CURRENT_DATE |
| total_amount | numeric | YES | 0 |
| tour_code | text | YES | - |
| tour_name | text | YES | - |
| budget_warning | boolean | YES | false |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |
| items | jsonb | YES | '[]'::jsonb |
| notes | text | YES | - |
| order_id | text | YES | - |
| order_number | text | YES | - |
| created_by_name | text | YES | - |
| request_category | varchar | YES | 'tour' |
| expense_type | varchar | YES | - |
| is_special_billing | boolean | YES | false |
| request_number | text | YES | - |
| batch_id | uuid | YES | - |

## receipts

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | uuid | NO | gen_random_uuid() |
| receipt_number | text | NO | - |
| order_id | uuid | NO | - |
| customer_id | uuid | YES | - |
| amount | numeric | NO | - |
| payment_method | text | NO | - |
| payment_date | date | NO | - |
| bank_name | text | YES | - |
| account_last_digits | text | YES | - |
| transaction_id | text | YES | - |
| status | text | NO | 'pending' |
| confirmed_at | timestamptz | YES | - |
| confirmed_by | text | YES | - |
| notes | text | YES | - |
| deleted_at | timestamptz | YES | - |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| workspace_id | uuid | NO | - |
| order_number | varchar | YES | - |
| tour_name | varchar | YES | - |
| receipt_type | integer | NO | 1 |
| receipt_amount | numeric | NO | - |
| actual_amount | numeric | YES | 0 |
| receipt_date | date | YES | - |
| receipt_account | varchar | YES | - |
| email | varchar | YES | - |
| payment_name | varchar | YES | - |
| pay_dateline | date | YES | - |
| handler_name | varchar | YES | - |
| account_info | varchar | YES | - |
| fees | numeric | YES | - |
| card_last_four | varchar | YES | - |
| auth_code | varchar | YES | - |
| check_number | varchar | YES | - |
| check_bank | varchar | YES | - |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |
| customer_name | text | YES | - |
| sync_status | text | YES | 'synced' |
| tour_id | text | YES | - |
| link | text | YES | - |
| linkpay_order_number | text | YES | - |
| check_date | date | YES | - |
| total_amount | numeric | YES | 0 |

## suppliers

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | text | NO | - |
| code | text | NO | - |
| name | text | NO | - |
| contact_person | text | YES | - |
| phone | text | YES | - |
| email | text | YES | - |
| address | text | YES | - |
| total_orders | integer | YES | 0 |
| total_spent | numeric | YES | 0 |
| notes | text | YES | - |
| is_active | boolean | YES | true |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| english_name | varchar | YES | - |
| type | varchar | YES | - |
| country_id | varchar | YES | - |
| bank_name | varchar | YES | - |
| bank_account | varchar | YES | - |
| tax_id | varchar | YES | - |
| payment_terms | varchar | YES | - |
| currency | varchar | YES | 'TWD' |
| rating | integer | YES | - |
| is_preferred | boolean | YES | false |
| display_order | integer | YES | 0 |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |
| website | text | YES | - |
| bank_branch | text | YES | - |
| contact | jsonb | YES | default |
| country | text | YES | - |
| region | text | YES | - |
| status | text | YES | 'active' |
| category_id | uuid | YES | - |
| _deleted | boolean | YES | false |
| _needs_sync | boolean | YES | false |
| _synced_at | timestamptz | YES | - |
| bank_code_legacy | text | YES | - |
| workspace_id | uuid | YES | - |
| fax | varchar | YES | - |

## tours

| Column | Type | Nullable | Default |
|--------|------|----------|---------|
| id | text | NO | - |
| code | text | NO | - |
| name | text | NO | - |
| departure_date | date | NO | - |
| return_date | date | NO | - |
| location | text | YES | - |
| status | text | YES | '提案' |
| price | numeric | YES | 0 |
| max_participants | integer | YES | 0 |
| created_at | timestamptz | YES | now() |
| updated_at | timestamptz | YES | now() |
| contract_status | text | NO | '未簽署' |
| total_revenue | numeric | NO | 0 |
| total_cost | numeric | NO | 0 |
| profit | numeric | NO | 0 |
| quote_id | text | YES | - |
| quote_cost_structure | jsonb | YES | - |
| description | text | YES | - |
| is_active | boolean | YES | true |
| current_participants | integer | YES | 0 |
| contract_template | text | YES | - |
| contract_content | text | YES | - |
| contract_created_at | timestamptz | YES | - |
| contract_notes | text | YES | - |
| contract_completed | boolean | YES | false |
| contract_archived_date | timestamptz | YES | - |
| envelope_records | text | YES | - |
| _needs_sync | boolean | YES | false |
| _synced_at | timestamptz | YES | - |
| _deleted | boolean | YES | false |
| features | jsonb | YES | '[]'::jsonb |
| archived | boolean | YES | false |
| country_id | text | YES | - |
| main_city_id | text | YES | - |
| workspace_id | uuid | YES | - |
| closing_status | varchar | YES | 'open' |
| closing_date | date | YES | - |
| closed_by | uuid | YES | - |
| created_by | uuid | YES | - |
| updated_by | uuid | YES | - |
| enable_checkin | boolean | YES | false |
| checkin_qrcode | text | YES | - |
| outbound_flight | jsonb | YES | - |
| return_flight | jsonb | YES | - |
| locked_quote_id | text | YES | - |
| locked_quote_version | integer | YES | - |
| locked_itinerary_id | text | YES | - |
| locked_itinerary_version | integer | YES | - |
| locked_at | timestamptz | YES | - |
| locked_by | uuid | YES | - |
| last_unlocked_at | timestamptz | YES | - |
| last_unlocked_by | uuid | YES | - |
| modification_reason | text | YES | - |
| archive_reason | text | YES | - |
| proposal_id | uuid | YES | - |
| proposal_package_id | uuid | YES | - |
| converted_from_proposal | boolean | YES | false |
| controller_id | uuid | YES | - |
| confirmed_requirements | jsonb | YES | - |
| itinerary_id | text | YES | - |
