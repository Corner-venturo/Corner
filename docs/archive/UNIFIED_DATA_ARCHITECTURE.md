# Venturo ERP çµ±ä¸€è³‡æ–™æ¶æ§‹

> **å»ºç«‹æ—¥æœŸ**ï¼š2026-01-12
> **ç›®æ¨™**ï¼šä¸€å€‹åª½åª½ç”Ÿçš„ - æ‰€æœ‰è³‡æ–™å­˜å–éƒ½ç”¨åŒä¸€å¥—æ¨¡å¼

---

## ä¸€ã€æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Venturo ERP çµ±ä¸€æ¶æ§‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     UI Layer (Components)                    â”‚   â”‚
â”‚  â”‚  Pages, Dialogs, Forms...                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                       â”‚
â”‚                             â”‚ useEntity() hooks                     â”‚
â”‚                             â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Data Access Layer                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚ useTours()  â”‚  â”‚ useOrders() â”‚  â”‚ useMembers()â”‚  ...    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚  â”‚                          â–¼                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              createEntityHook() Factory              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - çµ±ä¸€ CRUD                                         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - çµ±ä¸€å¿«å–ç­–ç•¥                                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - çµ±ä¸€éŒ¯èª¤è™•ç†                                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  - çµ±ä¸€ loading ç‹€æ…‹                                  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                        â”‚
â”‚                            â”‚ SWR + Supabase                         â”‚
â”‚                            â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Global Cache (SWR)                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ tours  â”‚ â”‚ orders â”‚ â”‚members â”‚ â”‚ quotes â”‚  ...          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                                       â”‚
â”‚                             â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Supabase                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒæ¦‚å¿µ

### 2.1 å–®ä¸€æ¨¡å¼ï¼šcreateEntityHook

æ‰€æœ‰è³‡æ–™å­˜å–éƒ½é€éåŒä¸€å€‹ factory function å»ºç«‹ï¼Œç¢ºä¿ä¸€è‡´æ€§ï¼š

```typescript
// å®šç¾©ä¸€æ¬¡ï¼Œåˆ°è™•ä½¿ç”¨
export const useTours = createEntityHook<Tour>('tours', {
  // åˆ—è¡¨é…ç½®
  list: {
    select: '*',
    orderBy: { column: 'departure_date', ascending: false },
  },
  // ç²¾ç°¡ç‰ˆé…ç½®ï¼ˆåˆ—è¡¨é¡¯ç¤ºç”¨ï¼‰
  slim: {
    select: 'id,code,name,departure_date,status',
  },
  // å–®ç­†é…ç½®
  detail: {
    select: '*',
  },
  // å¿«å–é…ç½®
  cache: {
    ttl: 60000,           // 60 ç§’å¿«å–
    staleTime: 30000,     // 30 ç§’å…§è¦–ç‚ºæ–°é®®
    dedupe: true,         // å»é‡è¤‡è«‹æ±‚
  },
})
```

### 2.2 çµ±ä¸€ä»‹é¢

æ‰€æœ‰ entity hook éƒ½æœ‰ç›¸åŒçš„ä»‹é¢ï¼š

```typescript
interface EntityHook<T> {
  // è³‡æ–™
  items: T[]
  item: T | null
  loading: boolean
  error: string | null

  // åˆ—è¡¨æ“ä½œ
  list: () => { items: T[], loading: boolean, error: string | null }
  listSlim: () => { items: Partial<T>[], loading: boolean }
  listPaginated: (params: PaginationParams) => PaginatedResult<T>
  listByFilter: (filter: FilterParams) => { items: T[], loading: boolean }

  // å–®ç­†æ“ä½œ
  get: (id: string) => { item: T | null, loading: boolean }

  // CRUD
  create: (data: CreateData<T>) => Promise<T>
  update: (id: string, data: Partial<T>) => Promise<T>
  delete: (id: string) => Promise<boolean>

  // å¿«å–
  refresh: () => Promise<void>
  invalidate: () => void

  // Dictionaryï¼ˆå¿«é€ŸæŸ¥è©¢ï¼‰
  dictionary: Record<string, T>
  getById: (id: string) => T | undefined
  getNameById: (id: string) => string
}
```

### 2.3 å¿«å–ç­–ç•¥

```typescript
// å…¨åŸŸå¿«å–é…ç½®
const CACHE_CONFIG = {
  // é«˜é »è³‡æ–™ï¼ˆtours, ordersï¼‰
  high: {
    ttl: 60000,           // 1 åˆ†é˜
    staleTime: 30000,     // 30 ç§’
    revalidateOnFocus: false,
    revalidateOnReconnect: true,
  },
  // ä¸­é »è³‡æ–™ï¼ˆquotes, itinerariesï¼‰
  medium: {
    ttl: 300000,          // 5 åˆ†é˜
    staleTime: 60000,     // 1 åˆ†é˜
    revalidateOnFocus: false,
  },
  // ä½é »è³‡æ–™ï¼ˆregions, settingsï¼‰
  low: {
    ttl: 3600000,         // 1 å°æ™‚
    staleTime: 300000,    // 5 åˆ†é˜
    revalidateOnFocus: false,
  },
}
```

---

## ä¸‰ã€æª”æ¡ˆçµæ§‹

```
src/
â”œâ”€â”€ data/                          # ğŸ“ æ–°çš„çµ±ä¸€è³‡æ–™å±¤
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ createEntityHook.ts    # Factory function
â”‚   â”‚   â”œâ”€â”€ types.ts               # çµ±ä¸€å‹åˆ¥å®šç¾©
â”‚   â”‚   â”œâ”€â”€ cache.ts               # å¿«å–ç­–ç•¥
â”‚   â”‚   â””â”€â”€ fetcher.ts             # Supabase fetcher
â”‚   â”‚
â”‚   â”œâ”€â”€ entities/                  # å„ entity å®šç¾©
â”‚   â”‚   â”œâ”€â”€ tours.ts               # useTours
â”‚   â”‚   â”œâ”€â”€ orders.ts              # useOrders
â”‚   â”‚   â”œâ”€â”€ members.ts             # useMembers
â”‚   â”‚   â”œâ”€â”€ quotes.ts              # useQuotes
â”‚   â”‚   â”œâ”€â”€ itineraries.ts         # useItineraries
â”‚   â”‚   â”œâ”€â”€ customers.ts           # useCustomers
â”‚   â”‚   â””â”€â”€ index.ts               # çµ±ä¸€ export
â”‚   â”‚
â”‚   â”œâ”€â”€ composites/                # çµ„åˆ hooks
â”‚   â”‚   â”œâ”€â”€ useTourWithOrders.ts   # Tour + é—œè¯ Orders
â”‚   â”‚   â”œâ”€â”€ useOrderWithMembers.ts # Order + é—œè¯ Members
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ index.ts                   # ä¸»è¦ export
â”‚
â”œâ”€â”€ stores/                        # ğŸ“ ä¿ç•™ä½†ç²¾ç°¡åŒ–
â”‚   â””â”€â”€ auth-store.ts              # åªä¿ç•™èªè­‰ç›¸é—œ
â”‚
â””â”€â”€ hooks/                         # ğŸ“ UI ç›¸é—œ hooks
    â”œâ”€â”€ useDialog.ts
    â”œâ”€â”€ useForm.ts
    â””â”€â”€ ...
```

---

## å››ã€å¯¦ä½œç´°ç¯€

### 4.1 createEntityHook Factory

```typescript
// src/data/core/createEntityHook.ts

import useSWR, { mutate } from 'swr'
import { supabase } from '@/lib/supabase/client'
import { useAuthStore } from '@/stores/auth-store'

interface EntityConfig<T> {
  list?: {
    select: string
    orderBy?: { column: keyof T; ascending: boolean }
    filter?: Record<string, unknown>
  }
  slim?: {
    select: string
  }
  detail?: {
    select: string
  }
  cache?: {
    ttl?: number
    staleTime?: number
    dedupe?: boolean
  }
}

export function createEntityHook<T extends { id: string }>(
  tableName: string,
  config: EntityConfig<T>
) {
  const cacheKey = `entity-${tableName}`
  const cacheKeySlim = `entity-${tableName}-slim`

  // é è¨­å¿«å–é…ç½®
  const cacheConfig = {
    revalidateOnFocus: false,
    revalidateOnReconnect: true,
    dedupingInterval: config.cache?.staleTime || 30000,
  }

  // ============================================
  // List Hook
  // ============================================
  function useList() {
    const { user, isAuthenticated, _hasHydrated } = useAuthStore()
    const swrKey = _hasHydrated && isAuthenticated && user?.id ? cacheKey : null

    const { data, error, isLoading, mutate: mutateSelf } = useSWR<T[]>(
      swrKey,
      async () => {
        let query = supabase
          .from(tableName as 'tours')
          .select(config.list?.select || '*')

        if (config.list?.orderBy) {
          query = query.order(
            config.list.orderBy.column as string,
            { ascending: config.list.orderBy.ascending }
          )
        }

        const { data, error } = await query
        if (error) throw error
        return data as unknown as T[]
      },
      cacheConfig
    )

    return {
      items: data || [],
      loading: !_hasHydrated || isLoading,
      error: error?.message || null,
      refresh: () => mutateSelf(),
    }
  }

  // ============================================
  // List Slim Hookï¼ˆç²¾ç°¡ç‰ˆï¼‰
  // ============================================
  function useListSlim() {
    const { user, isAuthenticated, _hasHydrated } = useAuthStore()
    const swrKey = _hasHydrated && isAuthenticated && user?.id ? cacheKeySlim : null

    const { data, error, isLoading } = useSWR<Partial<T>[]>(
      swrKey,
      async () => {
        const { data, error } = await supabase
          .from(tableName as 'tours')
          .select(config.slim?.select || 'id')

        if (error) throw error
        return data as unknown as Partial<T>[]
      },
      cacheConfig
    )

    return {
      items: data || [],
      loading: !_hasHydrated || isLoading,
      error: error?.message || null,
    }
  }

  // ============================================
  // Detail Hookï¼ˆå–®ç­† + Skip Patternï¼‰
  // ============================================
  function useDetail(id: string | null) {
    const { user, isAuthenticated, _hasHydrated } = useAuthStore()
    const swrKey = _hasHydrated && isAuthenticated && user?.id && id
      ? `${cacheKey}-${id}`
      : null

    const { data, error, isLoading, mutate: mutateSelf } = useSWR<T | null>(
      swrKey,
      async () => {
        if (!id) return null

        const { data, error } = await supabase
          .from(tableName as 'tours')
          .select(config.detail?.select || '*')
          .eq('id', id)
          .single()

        if (error) throw error
        return data as unknown as T
      },
      cacheConfig
    )

    return {
      item: data || null,
      loading: !_hasHydrated || isLoading,
      error: error?.message || null,
      refresh: () => mutateSelf(),
    }
  }

  // ============================================
  // Paginated Hook
  // ============================================
  function usePaginated(params: {
    page: number
    pageSize: number
    filter?: Record<string, unknown>
    search?: string
    searchFields?: string[]
  }) {
    const { user, isAuthenticated, _hasHydrated } = useAuthStore()
    const swrKey = _hasHydrated && isAuthenticated && user?.id
      ? `${cacheKey}-paginated-${JSON.stringify(params)}`
      : null

    const { data, error, isLoading, mutate: mutateSelf } = useSWR(
      swrKey,
      async () => {
        const from = (params.page - 1) * params.pageSize
        const to = from + params.pageSize - 1

        let query = supabase
          .from(tableName as 'tours')
          .select(config.list?.select || '*', { count: 'exact' })
          .range(from, to)

        // Apply filters
        if (params.filter) {
          Object.entries(params.filter).forEach(([key, value]) => {
            if (value !== undefined && value !== null && value !== 'all') {
              query = query.eq(key, value)
            }
          })
        }

        // Apply search
        if (params.search && params.searchFields?.length) {
          const searchConditions = params.searchFields
            .map(field => `${field}.ilike.%${params.search}%`)
            .join(',')
          query = query.or(searchConditions)
        }

        // Apply order
        if (config.list?.orderBy) {
          query = query.order(
            config.list.orderBy.column as string,
            { ascending: config.list.orderBy.ascending }
          )
        }

        const { data, count, error } = await query
        if (error) throw error

        return {
          items: data as unknown as T[],
          totalCount: count || 0,
        }
      },
      cacheConfig
    )

    return {
      items: data?.items || [],
      totalCount: data?.totalCount || 0,
      loading: !_hasHydrated || isLoading,
      error: error?.message || null,
      refresh: () => mutateSelf(),
    }
  }

  // ============================================
  // Dictionary Hookï¼ˆO(1) æŸ¥è©¢ï¼‰
  // ============================================
  function useDictionary() {
    const { items, loading } = useListSlim()

    const dictionary = (items || []).reduce((acc, item) => {
      if (item.id) {
        acc[item.id] = item
      }
      return acc
    }, {} as Record<string, Partial<T>>)

    return {
      dictionary,
      loading,
      get: (id: string) => dictionary[id],
    }
  }

  // ============================================
  // CRUD Operations
  // ============================================
  async function create(data: Omit<T, 'id' | 'created_at' | 'updated_at'>): Promise<T> {
    const now = new Date().toISOString()
    const newItem = {
      ...data,
      id: crypto.randomUUID(),
      created_at: now,
      updated_at: now,
    }

    const { data: created, error } = await supabase
      .from(tableName as 'tours')
      .insert(newItem as Record<string, unknown>)
      .select()
      .single()

    if (error) throw error

    // Invalidate cache
    await mutate((key: string) => key?.startsWith(cacheKey), undefined, { revalidate: true })

    return created as unknown as T
  }

  async function update(id: string, data: Partial<T>): Promise<T> {
    const updateData = {
      ...data,
      updated_at: new Date().toISOString(),
    }

    const { data: updated, error } = await supabase
      .from(tableName as 'tours')
      .update(updateData as Record<string, unknown>)
      .eq('id', id)
      .select()
      .single()

    if (error) throw error

    // Invalidate cache
    await mutate((key: string) => key?.startsWith(cacheKey), undefined, { revalidate: true })

    return updated as unknown as T
  }

  async function remove(id: string): Promise<boolean> {
    const { error } = await supabase
      .from(tableName as 'tours')
      .delete()
      .eq('id', id)

    if (error) throw error

    // Invalidate cache
    await mutate((key: string) => key?.startsWith(cacheKey), undefined, { revalidate: true })

    return true
  }

  // ============================================
  // Return All Hooks
  // ============================================
  return {
    useList,
    useListSlim,
    useDetail,
    usePaginated,
    useDictionary,
    create,
    update,
    delete: remove,
    // å¿«å–æ§åˆ¶
    invalidate: () => mutate((key: string) => key?.startsWith(cacheKey)),
  }
}
```

### 4.2 Entity å®šç¾©ç¯„ä¾‹

```typescript
// src/data/entities/tours.ts

import { createEntityHook } from '../core/createEntityHook'
import { Tour } from '@/stores/types'

export const tourEntity = createEntityHook<Tour>('tours', {
  list: {
    select: '*',
    orderBy: { column: 'departure_date', ascending: false },
  },
  slim: {
    select: 'id,code,name,departure_date,status,location,current_participants',
  },
  detail: {
    select: '*',
  },
  cache: {
    ttl: 60000,
    staleTime: 30000,
  },
})

// å°å‡ºä¾¿æ· hooks
export const useTours = tourEntity.useList
export const useToursSlim = tourEntity.useListSlim
export const useTour = tourEntity.useDetail
export const useToursPaginated = tourEntity.usePaginated
export const useTourDictionary = tourEntity.useDictionary

// å°å‡º CRUD
export const createTour = tourEntity.create
export const updateTour = tourEntity.update
export const deleteTour = tourEntity.delete
```

```typescript
// src/data/entities/orders.ts

import { createEntityHook } from '../core/createEntityHook'
import { Order } from '@/stores/types'

export const orderEntity = createEntityHook<Order>('orders', {
  list: {
    select: '*',
    orderBy: { column: 'created_at', ascending: false },
  },
  slim: {
    select: 'id,order_number,tour_id,tour_name,contact_person,payment_status,member_count',
  },
  detail: {
    select: '*',
  },
  cache: {
    ttl: 60000,
    staleTime: 30000,
  },
})

export const useOrders = orderEntity.useList
export const useOrdersSlim = orderEntity.useListSlim
export const useOrder = orderEntity.useDetail
export const useOrdersPaginated = orderEntity.usePaginated
export const useOrderDictionary = orderEntity.useDictionary

export const createOrder = orderEntity.create
export const updateOrder = orderEntity.update
export const deleteOrder = orderEntity.delete
```

### 4.3 çµ±ä¸€ Export

```typescript
// src/data/index.ts

// Entities
export * from './entities/tours'
export * from './entities/orders'
export * from './entities/members'
export * from './entities/quotes'
export * from './entities/itineraries'
export * from './entities/customers'

// Coreï¼ˆå¦‚æœéœ€è¦è‡ªè¨‚ï¼‰
export { createEntityHook } from './core/createEntityHook'
```

---

## äº”ã€ä½¿ç”¨æ–¹å¼

### 5.1 åˆ—è¡¨é é¢

```typescript
// Before âŒ
import { useTourStore } from '@/stores'

function ToursPage() {
  const tourStore = useTourStore()

  useEffect(() => {
    tourStore.fetchAll()
  }, [])

  const tours = tourStore.items.filter(...)

  return <Table data={tours} />
}

// After âœ…
import { useToursPaginated } from '@/data'

function ToursPage() {
  const { items: tours, totalCount, loading } = useToursPaginated({
    page: currentPage,
    pageSize: 20,
    filter: { status: activeTab },
    search: searchQuery,
    searchFields: ['name', 'code'],
  })

  return <Table data={tours} totalCount={totalCount} loading={loading} />
}
```

### 5.2 è©³ç´°é é¢ / Dialog

```typescript
// Before âŒ
function TourDetailDialog({ tourId }) {
  const tourStore = useTourStore()

  useEffect(() => {
    tourStore.fetchAll()  // è¼‰å…¥å…¨éƒ¨åªç‚ºäº†æ‰¾ä¸€ç­†
  }, [])

  const tour = tourStore.items.find(t => t.id === tourId)

  return <div>{tour?.name}</div>
}

// After âœ…
import { useTour } from '@/data'

function TourDetailDialog({ tourId }) {
  const { item: tour, loading } = useTour(tourId)  // Skip pattern: tourId ç‚º null ä¸è«‹æ±‚

  if (loading) return <Loading />
  return <div>{tour?.name}</div>
}
```

### 5.3 ID â†’ Name è½‰æ›

```typescript
// Before âŒ
const tourStore = useTourStore()
const tour = tourStore.items.find(t => t.id === order.tour_id)  // O(n)
const tourName = tour?.name || ''

// After âœ…
import { useTourDictionary } from '@/data'

const { get } = useTourDictionary()
const tourName = get(order.tour_id)?.name || ''  // O(1)
```

### 5.4 CRUD æ“ä½œ

```typescript
// Before âŒ
const tourStore = useTourStore()
await tourStore.create(data)
await tourStore.update(id, data)
await tourStore.delete(id)

// After âœ…
import { createTour, updateTour, deleteTour } from '@/data'

await createTour(data)
await updateTour(id, data)
await deleteTour(id)
// å¿«å–è‡ªå‹•å¤±æ•ˆï¼Œç›¸é—œ hooks è‡ªå‹•æ›´æ–°
```

---

## å…­ã€é·ç§»è¨ˆç•«

### Phase 1: å»ºç«‹æ ¸å¿ƒï¼ˆ1-2 å¤©ï¼‰
- [ ] å»ºç«‹ `src/data/core/createEntityHook.ts`
- [ ] å»ºç«‹å‹åˆ¥å®šç¾©
- [ ] å»ºç«‹ tours entity ä½œç‚ºç¯„æœ¬

### Phase 2: é·ç§»ä¸»è¦ entitiesï¼ˆ2-3 å¤©ï¼‰
- [ ] tours
- [ ] orders
- [ ] members
- [ ] quotes
- [ ] itineraries

### Phase 3: é·ç§»é é¢ï¼ˆæ¼¸é€²å¼ï¼‰
- [ ] å¾æœ€å¸¸ç”¨çš„é é¢é–‹å§‹
- [ ] ä¿æŒèˆŠ store å¯ç”¨ï¼Œé€æ­¥æ›¿æ›
- [ ] æ¯å€‹é é¢ç¨ç«‹æ¸¬è©¦

### Phase 4: æ¸…ç†ï¼ˆ1 å¤©ï¼‰
- [ ] ç§»é™¤æœªä½¿ç”¨çš„ store æ–¹æ³•
- [ ] ç§»é™¤èˆŠçš„ fetchAll å‘¼å«
- [ ] æ›´æ–°æ–‡æª”

---

## ä¸ƒã€æ•ˆç›Š

| æŒ‡æ¨™ | Before | After |
|------|--------|-------|
| ç¨‹å¼ç¢¼ä¸€è‡´æ€§ | å„é é¢å„è‡ªå¯¦ä½œ | çµ±ä¸€ factory |
| å¿«å–å‘½ä¸­ç‡ | ~0%ï¼ˆæ¯æ¬¡éƒ½ fetchï¼‰| ~80%+ |
| é¦–æ¬¡è¼‰å…¥è«‹æ±‚æ•¸ | 5-10 å€‹ï¼ˆç€‘å¸ƒå¼ï¼‰| 1-2 å€‹ï¼ˆå¹³è¡Œï¼‰|
| é‡è¤‡ç¨‹å¼ç¢¼ | å¤§é‡ fetchAll | 0 |
| IDâ†’Name æŸ¥è©¢ | O(n) find | O(1) dictionary |
| ç¶­è­·é›£åº¦ | é«˜ï¼ˆåˆ†æ•£å„è™•ï¼‰| ä½ï¼ˆé›†ä¸­ç®¡ç†ï¼‰|

---

*æ–‡ä»¶å»ºç«‹æ—¥æœŸï¼š2026-01-12*
*ç›®æ¨™ï¼šä¸€å€‹åª½åª½ç”Ÿçš„çµ±ä¸€æ¶æ§‹*
