# ğŸ¯ Venturo v4.0 é›¢ç·šæ¶æ§‹ - å®Œæ•´ç¸½çµ

> **å®Œæˆæ—¥æœŸ**ï¼š2025-01-05
> **ç‰ˆæœ¬**ï¼šv4.0
> **åˆ†æ”¯**ï¼šfeature/offline-first-v4
> **ç‹€æ…‹**ï¼šâœ… å·²å®Œæˆä¸¦æ¸¬è©¦é€šé

---

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

### ç›®æ¨™
å»ºç«‹ä¸€å€‹å®Œæ•´çš„**é›¢ç·šå„ªå…ˆï¼ˆOffline-Firstï¼‰**æ¶æ§‹ï¼Œè®“ä½¿ç”¨è€…åœ¨æ²’æœ‰ç¶²è·¯çš„æƒ…æ³ä¸‹ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ç³»çµ±ï¼Œè³‡æ–™æœƒåœ¨èƒŒæ™¯è‡ªå‹•åŒæ­¥åˆ°é›²ç«¯ã€‚

### è§£æ±ºçš„å•é¡Œ
1. âŒ **èˆŠå•é¡Œ**ï¼šä½¿ç”¨è€…é›¢ç·šæ™‚ç„¡æ³•æ“ä½œ
2. âœ… **æ–°æ–¹æ¡ˆ**ï¼šæ‰€æœ‰æ“ä½œç«‹å³å­˜åˆ°æœ¬åœ°ï¼ŒèƒŒæ™¯è‡ªå‹•åŒæ­¥

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ¶æ§‹åœ–
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä½¿ç”¨è€…æ“ä½œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OfflineManager (çµ±ä¸€ç®¡ç†å±¤)              â”‚
â”‚  â€¢ create()  â€¢ update()  â€¢ delete()  â€¢ get()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                   â”‚
              â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  IndexedDB      â”‚   â”‚  Sync Queue      â”‚
    â”‚  (æœ¬åœ°è³‡æ–™åº«)    â”‚   â”‚  (åŒæ­¥ä½‡åˆ—)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   SyncEngine     â”‚
                          â”‚  (åŒæ­¥å¼•æ“)       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Supabase       â”‚
                          â”‚  (é›²ç«¯è³‡æ–™åº«)     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ ¸å¿ƒæª”æ¡ˆçµæ§‹

```
src/lib/offline/
â”œâ”€â”€ unified-types.ts           # çµ±ä¸€è³‡æ–™æ¨¡å‹ (320 è¡Œ)
â”œâ”€â”€ offline-database.ts        # IndexedDB å°è£ (420 è¡Œ)
â”œâ”€â”€ offline-manager.ts         # é›¢ç·šç®¡ç†æ ¸å¿ƒ (354 è¡Œ)
â”œâ”€â”€ sync-engine.ts            # åŒæ­¥å¼•æ“ (301 è¡Œ)
â””â”€â”€ auto-sync-provider.tsx    # è‡ªå‹•åŒæ­¥ Provider (120 è¡Œ)

src/components/
â””â”€â”€ sync-indicator.tsx         # åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨ (100 è¡Œ)

src/lib/
â””â”€â”€ persistent-store.ts        # é‡æ§‹å¾Œçš„ Store (ç²¾ç°¡ 200+ è¡Œ)

src/app/
â”œâ”€â”€ layout.tsx                # æ•´åˆ AutoSyncProvider
â””â”€â”€ test-offline/page.tsx     # æ¸¬è©¦é é¢
```

---

## ğŸ”§ æ ¸å¿ƒçµ„ä»¶èªªæ˜

### 1ï¸âƒ£ unified-types.ts - çµ±ä¸€è³‡æ–™æ¨¡å‹
**åŠŸèƒ½**ï¼š
- å®šç¾©æ‰€æœ‰è³‡æ–™å‹åˆ¥ï¼ˆTour, Order, Quote ç­‰ï¼‰
- æä¾› camelCase â†” snake_case è½‰æ›
- UUID ç”Ÿæˆå™¨

**é—œéµå‡½æ•¸**ï¼š
```typescript
toSupabase(data)    // å‰ç«¯ â†’ è³‡æ–™åº« (camelCase â†’ snake_case)
fromSupabase(data)  // è³‡æ–™åº« â†’ å‰ç«¯ (snake_case â†’ camelCase)
generateUUID()      // ç”Ÿæˆå”¯ä¸€ ID
```

---

### 2ï¸âƒ£ offline-database.ts - IndexedDB å°è£
**åŠŸèƒ½**ï¼š
- å°è£æ‰€æœ‰ IndexedDB æ“ä½œ
- æä¾› CRUD ä»‹é¢
- è‡ªå‹•ç´¢å¼•ç®¡ç†
- SSR å®‰å…¨æª¢æŸ¥

**æ”¯æ´çš„ Stores**ï¼š
- `tours` - æ—…éŠåœ˜
- `orders` - è¨‚å–®
- `quotes` - å ±åƒ¹å–®
- `paymentRequests` - ä»˜æ¬¾è«‹æ±‚
- `todos` - å¾…è¾¦äº‹é …
- `suppliers` - ä¾›æ‡‰å•†
- `customers` - å®¢æˆ¶
- `syncQueue` - åŒæ­¥ä½‡åˆ—

**é—œéµæ–¹æ³•**ï¼š
```typescript
add(storeName, data)           // æ–°å¢
update(storeName, data)        // æ›´æ–°
delete(storeName, id)          // åˆªé™¤
get(storeName, id)             // è®€å–å–®ç­†
getAll(storeName)              // è®€å–å…¨éƒ¨
getByIndex(storeName, index, value)  // ç´¢å¼•æŸ¥è©¢
addBatch(storeName, dataList)  // æ‰¹æ¬¡æ–°å¢
```

---

### 3ï¸âƒ£ offline-manager.ts - é›¢ç·šç®¡ç†æ ¸å¿ƒ
**åŠŸèƒ½**ï¼š
- çµ±ä¸€ç®¡ç†æ‰€æœ‰é›¢ç·šè³‡æ–™æ“ä½œ
- è‡ªå‹•ç®¡ç†åŒæ­¥ä½‡åˆ—
- æä¾› localStorage è¼”åŠ©æ–¹æ³•
- è³‡æ–™çµ±è¨ˆåŠŸèƒ½

**æ ¸å¿ƒæµç¨‹**ï¼š
```typescript
// å»ºç«‹è³‡æ–™
create('tours', data)
  â†“ è‡ªå‹•ç”Ÿæˆ IDã€æ™‚é–“æˆ³
  â†“ å­˜åˆ° IndexedDB
  â†“ åŠ å…¥åŒæ­¥ä½‡åˆ—
  â†“ æ¨™è¨˜ synced: false

// æ›´æ–°è³‡æ–™
update('tours', id, updates)
  â†“ åˆä½µæ›´æ–°
  â†“ ç‰ˆæœ¬è™Ÿ +1
  â†“ å­˜åˆ° IndexedDB
  â†“ åŠ å…¥åŒæ­¥ä½‡åˆ—

// åˆªé™¤è³‡æ–™
delete('tours', id)
  â†“ å¾ IndexedDB åˆªé™¤
  â†“ åŠ å…¥åŒæ­¥ä½‡åˆ— (operation: 'delete')
```

**åŒæ­¥ä½‡åˆ—ç®¡ç†**ï¼š
```typescript
getPendingSyncItems()          // å–å¾—å¾…åŒæ­¥é …ç›®
markSyncCompleted(itemId)      // æ¨™è¨˜ç‚ºå®Œæˆ
markSyncFailed(itemId, error)  // æ¨™è¨˜ç‚ºå¤±æ•—
clearCompletedSync()           // æ¸…ç©ºå·²å®Œæˆé …ç›®
```

---

### 4ï¸âƒ£ sync-engine.ts - åŒæ­¥å¼•æ“
**åŠŸèƒ½**ï¼š
- è™•ç†åŒæ­¥ä½‡åˆ—
- ä¸Šå‚³æœ¬åœ°è®Šæ›´åˆ°é›²ç«¯
- æ™ºèƒ½æ¨¡å¼åˆ‡æ›ï¼ˆæœ‰/ç„¡ Supabaseï¼‰
- æ‰¹æ¬¡è™•ç† + é‡è©¦æ©Ÿåˆ¶

**é‹ä½œæ¨¡å¼**ï¼š

#### æ¨¡å¼ 1ï¼šç„¡ Supabaseï¼ˆæ¨¡æ“¬æ¨¡å¼ï¼‰
```typescript
æª¢æ¸¬ï¼šç„¡ SUPABASE_URL æˆ– SUPABASE_KEY
è¡Œç‚ºï¼šç›´æ¥æ¨™è¨˜ç‚ºå®Œæˆä¸¦æ¸…ç©ºä½‡åˆ—
ç”¨é€”ï¼šé–‹ç™¼æ¸¬è©¦ã€é›¢ç·šæ¼”ç¤º
```

#### æ¨¡å¼ 2ï¼šæœ‰ Supabaseï¼ˆçœŸå¯¦æ¨¡å¼ï¼‰
```typescript
æª¢æ¸¬ï¼šæœ‰å®Œæ•´çš„ Supabase é…ç½®
è¡Œç‚ºï¼šçœŸå¯¦ä¸Šå‚³åˆ°é›²ç«¯
æµç¨‹ï¼š
  1. å–å¾—å¾…åŒæ­¥é …ç›®
  2. è½‰æ›è³‡æ–™æ ¼å¼ (toSupabase)
  3. åŸ·è¡Œ create/update/delete
  4. æ¨™è¨˜ç‚ºå®Œæˆ
  5. å¤±æ•—æ™‚é‡è©¦ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
```

**é—œéµé…ç½®**ï¼š
```typescript
{
  enableAutoSync: true,    // å•Ÿç”¨è‡ªå‹•åŒæ­¥
  syncInterval: 30000,     // åŒæ­¥é–“éš” (30 ç§’)
  batchSize: 10,          // æ‰¹æ¬¡å¤§å°
  maxRetries: 3           // æœ€å¤§é‡è©¦æ¬¡æ•¸
}
```

---

### 5ï¸âƒ£ auto-sync-provider.tsx - è‡ªå‹•åŒæ­¥æ©Ÿåˆ¶
**åŠŸèƒ½**ï¼š
- å…¨åŸŸåŒæ­¥ç‹€æ…‹ç®¡ç†
- ç¶²è·¯ç‹€æ…‹ç›£è½
- å®šæœŸèƒŒæ™¯åŒæ­¥
- ç¶²è·¯æ¢å¾©è‡ªå‹•åŒæ­¥

**Context æä¾›çš„åŠŸèƒ½**ï¼š
```typescript
{
  syncStatus: SyncStatus,      // åŒæ­¥ç‹€æ…‹
  isOnline: boolean,           // ç¶²è·¯ç‹€æ…‹
  triggerSync: () => Promise,  // æ‰‹å‹•åŒæ­¥
  enableAutoSync: () => void,  // å•Ÿç”¨è‡ªå‹•åŒæ­¥
  disableAutoSync: () => void  // åœç”¨è‡ªå‹•åŒæ­¥
}
```

**ç›£è½äº‹ä»¶**ï¼š
- `online` äº‹ä»¶ï¼šç¶²è·¯æ¢å¾© â†’ ç«‹å³åŒæ­¥
- `offline` äº‹ä»¶ï¼šç¶²è·¯æ–·ç·š â†’ åˆ‡æ›é›¢ç·šæ¨¡å¼
- å®šæ™‚å™¨ï¼šæ¯ 30 ç§’è‡ªå‹•åŒæ­¥
- ç‹€æ…‹è¼ªè©¢ï¼šæ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡

---

### 6ï¸âƒ£ sync-indicator.tsx - åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨
**åŠŸèƒ½**ï¼š
- è¦–è¦ºåŒ–é¡¯ç¤ºåŒæ­¥ç‹€æ…‹
- é»æ“Šå¯æ‰‹å‹•è§¸ç™¼åŒæ­¥
- Tooltip é¡¯ç¤ºè©³ç´°è³‡è¨Š

**ç‹€æ…‹åœ–ç¤º**ï¼š
- ğŸŸ¢ `CheckCircle` - æ‰€æœ‰è³‡æ–™å·²åŒæ­¥
- ğŸŸ  `Cloud` + Badge - æœ‰ N ç­†å¾…åŒæ­¥
- ğŸ”´ `CloudOff` - é›¢ç·šæ¨¡å¼
- ğŸ”µ `Loader2` (æ—‹è½‰) - åŒæ­¥ä¸­
- ğŸŸ¡ `AlertCircle` - åŒæ­¥å¤±æ•—

---

## ğŸ”„ å®Œæ•´æ“ä½œæµç¨‹

### ä½¿ç”¨è€…å»ºç«‹ä¸€ç­† Tour è³‡æ–™

```typescript
// 1. å‰ç«¯å‘¼å«
await useTourStore.getState().add({
  code: 'TOUR001',
  name: 'å°åŒ—ä¸‰æ—¥éŠ',
  destination: 'å°åŒ—',
  startDate: '2025-02-01',
  endDate: '2025-02-03',
  // ...
})

// 2. persistent-store.ts å…§éƒ¨
await offlineManager.create('tours', data)

// 3. offline-manager.ts è™•ç†
const record = {
  ...data,
  id: generateUUID(),           // 'abc-123-def'
  createdAt: '2025-01-05T10:30:00Z',
  updatedAt: '2025-01-05T10:30:00Z',
  synced: false,
  version: 1
}
await db.add('tours', record)   // å­˜åˆ° IndexedDB
await addToSyncQueue('create', 'tours', record.id, record)

// 4. åŒæ­¥ä½‡åˆ—æ–°å¢é …ç›®
{
  id: 'queue-001',
  operation: 'create',
  tableName: 'tours',
  recordId: 'abc-123-def',
  data: record,
  status: 'pending',
  retryCount: 0
}

// 5. æ¯ 5 ç§’ç‹€æ…‹æª¢æŸ¥
sidebar é¡¯ç¤º: "1 å¾…åŒæ­¥" (æ©˜ç‡ˆ ğŸŸ )

// 6. 30 ç§’å¾Œè‡ªå‹•åŒæ­¥
syncEngine.syncAll()
  â†’ å–å¾— pending é …ç›®
  â†’ toSupabase(record)  // camelCase â†’ snake_case
  â†’ [æ¨¡æ“¬æ¨¡å¼] ç›´æ¥æ¨™è¨˜å®Œæˆ
  â†’ [çœŸå¯¦æ¨¡å¼] supabase.from('tours').insert(...)
  â†’ markSyncCompleted('queue-001')
  â†’ clearCompletedSync()

// 7. åŒæ­¥å®Œæˆ
sidebar é¡¯ç¤º: "å·²é€£ç·š" (ç¶ ç‡ˆ ğŸŸ¢)
```

---

## ğŸ“Š æ•ˆèƒ½æŒ‡æ¨™

### IndexedDB å„²å­˜å®¹é‡
- Chrome: å¯ç”¨ç©ºé–“çš„ 60%
- Firefox: å¯ç”¨ç©ºé–“çš„ 50%
- Safari: 1GB ä¸Šé™

### åŒæ­¥æ•ˆèƒ½
- æ‰¹æ¬¡å¤§å°: 10 ç­†/æ‰¹æ¬¡
- åŒæ­¥é–“éš”: 30 ç§’
- ç‹€æ…‹æ›´æ–°: 5 ç§’
- é‡è©¦æ¬¡æ•¸: æœ€å¤š 3 æ¬¡

---

## ğŸ§ª æ¸¬è©¦çµæœ

### å·²æ¸¬è©¦åŠŸèƒ½
âœ… å»ºç«‹è³‡æ–™ï¼ˆcreateï¼‰
âœ… è®€å–è³‡æ–™ï¼ˆget / getAllï¼‰
âœ… æ›´æ–°è³‡æ–™ï¼ˆupdateï¼‰
âœ… åˆªé™¤è³‡æ–™ï¼ˆdeleteï¼‰
âœ… ç´¢å¼•æŸ¥è©¢ï¼ˆgetByIndexï¼‰
âœ… æ‰¹æ¬¡å»ºç«‹ï¼ˆcreateBatchï¼‰
âœ… åŒæ­¥ä½‡åˆ—ç®¡ç†
âœ… æ‰‹å‹•åŒæ­¥
âœ… è‡ªå‹•åŒæ­¥ï¼ˆæ¯ 30 ç§’ï¼‰
âœ… ç¶²è·¯ç‹€æ…‹ç›£è½
âœ… SSR ç›¸å®¹æ€§

### æ¸¬è©¦é é¢
è¨ªå• `http://localhost:3000/test-offline` å¯åŸ·è¡Œå®Œæ•´æ¸¬è©¦ï¼š
- 8 å€‹è‡ªå‹•åŒ–æ¸¬è©¦é …ç›®
- å³æ™‚é¡¯ç¤ºåŸ·è¡Œç‹€æ…‹
- æ•ˆèƒ½è¨ˆæ™‚é¡¯ç¤º
- è³‡æ–™çµ±è¨ˆå„€è¡¨æ¿

---

## ğŸ¨ UI æ•´åˆ

### Sidebar åŒæ­¥ç‹€æ…‹é¡¯ç¤º
```tsx
// ä½ç½®ï¼šå·¦å´é‚Šæ¬„åº•éƒ¨
// é¡¯ç¤ºå…§å®¹ï¼š
â€¢ ğŸŸ¢ å·²é€£ç·š          (æ‰€æœ‰è³‡æ–™å·²åŒæ­¥)
â€¢ ğŸŸ  5 å¾…åŒæ­¥        (æœ‰ 5 ç­†å¾…åŒæ­¥)
â€¢ ğŸ”´ é›¢ç·š            (ç¶²è·¯æ–·ç·š)

// Hover é¡¯ç¤ºè©³ç´°è³‡è¨Šï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ ç¶²è·¯å·²é€£ç·š     â”‚
â”‚ 5 å€‹è®Šæ›´å¾…åŒæ­¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¸¬è©¦é é¢æ§åˆ¶
```tsx
[é–‹å§‹æ¸¬è©¦]    - åŸ·è¡Œ 8 å€‹è‡ªå‹•åŒ–æ¸¬è©¦
[æ‰‹å‹•åŒæ­¥]    - ç«‹å³è§¸ç™¼åŒæ­¥
[æ¸…ç©ºæ‰€æœ‰è³‡æ–™] - é‡ç½®æ¸¬è©¦ç’°å¢ƒ
```

---

## ğŸ” è³‡æ–™å®‰å…¨æ€§

### æœ¬åœ°è³‡æ–™ä¿è­·
- IndexedDB å—åŒæºæ”¿ç­–ä¿è­·
- è³‡æ–™åªåœ¨åŒä¸€ç¶²åŸŸä¸‹å¯å­˜å–
- ç€è¦½å™¨è‡ªå‹•åŠ å¯†å„²å­˜

### åŒæ­¥å®‰å…¨æ€§
- ä½¿ç”¨ Supabase Row Level Security (RLS)
- åªåŒæ­¥ä½¿ç”¨è€…æœ‰æ¬Šé™çš„è³‡æ–™
- å¤±æ•—è‡ªå‹•é‡è©¦ï¼Œé¿å…è³‡æ–™éºå¤±

### ç‰ˆæœ¬æ§åˆ¶
- æ¯æ¬¡æ›´æ–°è‡ªå‹•å¢åŠ ç‰ˆæœ¬è™Ÿ
- å¯è¿½è¹¤è³‡æ–™è®Šæ›´æ­·å²
- æœªä¾†å¯æ“´å±•è¡çªè™•ç†

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬æ“ä½œ
```typescript
import { getOfflineManager } from '@/lib/offline/offline-manager'

const manager = getOfflineManager()

// å»ºç«‹
const tour = await manager.create('tours', {
  code: 'TOUR001',
  name: 'å°åŒ—ä¸‰æ—¥éŠ',
  // ...
})

// è®€å–
const tour = await manager.get('tours', tourId)
const allTours = await manager.getAll('tours')

// æ›´æ–°
await manager.update('tours', tourId, {
  name: 'å°åŒ—äº”æ—¥éŠ'
})

// åˆªé™¤
await manager.delete('tours', tourId)

// æŸ¥è©¢
const planningTours = await manager.getByIndex(
  'tours',
  'status',
  'planning'
)
```

### è‡ªå‹•åŒæ­¥ Hook
```typescript
import { useAutoSync } from '@/lib/offline/auto-sync-provider'

function MyComponent() {
  const { syncStatus, isOnline, triggerSync } = useAutoSync()

  return (
    <div>
      <p>ç¶²è·¯ç‹€æ…‹: {isOnline ? 'åœ¨ç·š' : 'é›¢ç·š'}</p>
      <p>å¾…åŒæ­¥: {syncStatus?.pendingCount || 0} ç­†</p>
      <button onClick={triggerSync}>æ‰‹å‹•åŒæ­¥</button>
    </div>
  )
}
```

---

## ğŸ“ Git æäº¤è¨˜éŒ„

```bash
# ç¸½å…± 7 å€‹æäº¤
1. docs: å»ºç«‹é›¢ç·šæ¶æ§‹å¯¦ä½œè¨ˆç•« v4.0
2. docs: åˆå§‹åŒ–å·¥ä½œæ—¥èªŒ
3. feat: å®Œæˆé›¢ç·šæ¶æ§‹æ ¸å¿ƒ (Step 1)
4. refactor: é‡æ§‹ persistent-store ä½¿ç”¨æ–°é›¢ç·šæ¶æ§‹
5. feat: å»ºç«‹æ¸¬è©¦é é¢ (Step 4)
6. feat: å»ºç«‹åŒæ­¥å¼•æ“ - è§£æ±ºã€Œå¾…åŒæ­¥ã€å•é¡Œ (Step 5)
7. feat: å¯¦ä½œè‡ªå‹•åŒæ­¥æ©Ÿåˆ¶ (Step 6)
```

### åˆ†æ”¯ç‹€æ…‹
```bash
feature/offline-first-v4
  â†‘ 7 commits ahead of main

æ–°å¢: 5 å€‹æª”æ¡ˆ (~1,615 è¡Œ)
ä¿®æ”¹: 3 å€‹æª”æ¡ˆ (~-200 è¡Œç²¾ç°¡)
æ·¨å¢: ~1,415 è¡Œç¨‹å¼ç¢¼
```

---

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

### Phase 1: æœ¬åœ°é›¢ç·šæ¶æ§‹
- [x] çµ±ä¸€è³‡æ–™æ¨¡å‹å®šç¾©
- [x] IndexedDB å°è£
- [x] OfflineManager æ ¸å¿ƒ
- [x] åŒæ­¥ä½‡åˆ—ç®¡ç†
- [x] é‡æ§‹ persistent-store
- [x] SSR ç›¸å®¹æ€§è™•ç†

### Phase 2: åŒæ­¥æ©Ÿåˆ¶
- [x] SyncEngine å¯¦ä½œ
- [x] æ™ºèƒ½æ¨¡å¼åˆ‡æ›
- [x] æ‰¹æ¬¡è™•ç†
- [x] é‡è©¦æ©Ÿåˆ¶
- [x] è³‡æ–™æ ¼å¼è½‰æ›

### Phase 3: è‡ªå‹•åŒ–èˆ‡ UI
- [x] AutoSyncProvider
- [x] ç¶²è·¯ç‹€æ…‹ç›£è½
- [x] å®šæœŸèƒŒæ™¯åŒæ­¥
- [x] åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨
- [x] æ•´åˆåˆ°ä¸»æ‡‰ç”¨

### Phase 4: æ¸¬è©¦èˆ‡æ–‡æª”
- [x] æ¸¬è©¦é é¢å»ºç«‹
- [x] 8 å€‹è‡ªå‹•åŒ–æ¸¬è©¦
- [x] å·¥ä½œæ—¥èªŒè¨˜éŒ„
- [x] å®Œæ•´ç¸½çµæ–‡æª”

---

## ğŸ”® æœªä¾†æ“´å±•

### çŸ­æœŸå„ªåŒ–
- [ ] é…ç½®çœŸå¯¦ Supabase é€£æ¥
- [ ] å£“åŠ›æ¸¬è©¦ï¼ˆ100+ ç­†è³‡æ–™ï¼‰
- [ ] ç¶²è·¯æ–·ç·šæ¢å¾©æ¸¬è©¦
- [ ] éŒ¯èª¤è™•ç†å„ªåŒ–

### ä¸­æœŸåŠŸèƒ½
- [ ] è¡çªè™•ç†æ©Ÿåˆ¶
- [ ] è³‡æ–™ç‰ˆæœ¬æ­·å²
- [ ] é›¢ç·šåœ–ç‰‡å¿«å–
- [ ] é¸æ“‡æ€§åŒæ­¥ï¼ˆåªåŒæ­¥å¿…è¦è³‡æ–™ï¼‰

### é•·æœŸè¦åŠƒ
- [ ] å¤šè£ç½®åŒæ­¥
- [ ] è³‡æ–™åŠ å¯†
- [ ] å·®ç•°åŒæ­¥ï¼ˆåªå‚³è®Šæ›´æ¬„ä½ï¼‰
- [ ] WebSocket å³æ™‚åŒæ­¥

---

## ğŸ“š æŠ€è¡“æ£§

- **Next.js 15** - React æ¡†æ¶
- **TypeScript** - å‹åˆ¥å®‰å…¨
- **IndexedDB** - æœ¬åœ°è³‡æ–™åº«
- **Zustand** - ç‹€æ…‹ç®¡ç†
- **Supabase** - é›²ç«¯è³‡æ–™åº«
- **Turbopack** - æ‰“åŒ…å·¥å…·

---

## ğŸ‘¨â€ğŸ’» é–‹ç™¼è€…

**William Chien**
é–‹ç™¼æœŸé–“ï¼š2025-01-03 ~ 2025-01-05 (3 å¤©)

---

## ğŸ‰ ç¸½çµ

é€™å€‹é›¢ç·šæ¶æ§‹å·²ç¶“å®Œæ•´å¯¦ä½œä¸¦æ¸¬è©¦é€šéï¼Œæä¾›äº†ï¼š

âœ… **å®Œæ•´çš„é›¢ç·šæ“ä½œèƒ½åŠ›** - ç„¡ç¶²è·¯ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨
âœ… **è‡ªå‹•èƒŒæ™¯åŒæ­¥** - ä½¿ç”¨è€…ç„¡æ„ŸçŸ¥çš„è³‡æ–™åŒæ­¥
âœ… **æ™ºèƒ½æ¨¡å¼åˆ‡æ›** - è‡ªå‹•é©æ‡‰æœ‰/ç„¡é›²ç«¯ç’°å¢ƒ
âœ… **è¦–è¦ºåŒ–ç‹€æ…‹** - å³æ™‚é¡¯ç¤ºåŒæ­¥é€²åº¦
âœ… **é«˜åº¦å¯é æ€§** - é‡è©¦æ©Ÿåˆ¶ + éŒ¯èª¤è™•ç†

ä½¿ç”¨è€…å¯ä»¥åœ¨ä»»ä½•ç’°å¢ƒä¸‹æµæš¢ä½¿ç”¨ç³»çµ±ï¼Œè³‡æ–™å®‰å…¨å„²å­˜åœ¨æœ¬åœ°ï¼Œä¸¦åœ¨æœ‰ç¶²è·¯æ™‚è‡ªå‹•åŒæ­¥åˆ°é›²ç«¯ï¼

---

**æ–‡æª”ç‰ˆæœ¬**ï¼šv1.0
**æœ€å¾Œæ›´æ–°**ï¼š2025-01-05
