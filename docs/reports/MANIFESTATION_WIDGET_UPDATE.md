# é¡¯åŒ–é­”æ³•åŠŸèƒ½æ•´åˆå ±å‘Š

## åŸ·è¡Œæ™‚é–“

2025-10-25

## å®Œæˆé …ç›®

### âœ… 1. æ¬Šé™èª¿æ•´

**ä¿®æ”¹æª”æ¡ˆï¼š** `src/lib/permissions.ts`

å°‡é¡¯åŒ–é­”æ³•çš„è·¯ç”± `/manifestation` åŠ å…¥åˆ°ã€Œäººè³‡ç®¡ç†ã€æ¬Šé™ä¸­ï¼š

```typescript
{
  id: 'hr',
  label: 'äººè³‡ç®¡ç†',
  category: 'ç®¡ç†',
  routes: ['/hr', '/manifestation'],  // â† æ–°å¢ /manifestation
  description: 'å“¡å·¥å’Œäººäº‹ç®¡ç†ã€é¡¯åŒ–é­”æ³•'
}
```

**æ•ˆæœï¼š**

- æ“æœ‰ã€Œäººè³‡ç®¡ç†ã€æ¬Šé™çš„ç”¨æˆ¶å¯ä»¥è¨ªå•é¡¯åŒ–é­”æ³•é é¢
- é¡¯åŒ–é­”æ³•ç¾åœ¨æ­¸å±¬æ–¼ç®¡ç†é¡åˆ¥

### âœ… 2. å°å·¥å…·æ•´åˆ

**æ–°å¢æª”æ¡ˆï¼š** `src/features/dashboard/components/manifestation-widget.tsx`

**åŠŸèƒ½ç‰¹è‰²ï¼š**

- ğŸ“Š é¡¯ç¤ºç·´ç¿’é€²åº¦ï¼ˆå·²å®Œæˆç« ç¯€æ•¸ x/10ï¼‰
- ğŸ“… è¿½è¹¤æœ€å¾Œç·´ç¿’æ™‚é–“
- ğŸ¯ é¡¯ç¤ºç•¶å‰ç« ç¯€è³‡è¨Š
- ğŸ’­ å±•ç¤ºæœ€è¿‘çš„é¡˜æœ›è¨˜éŒ„
- ğŸ”„ å…©ç¨®è¦–åœ–æ¨¡å¼ï¼š
  - **ä¸»è¦–åœ–**ï¼šæ¦‚è¦½å’Œç‹€æ…‹
  - **å¿«é€Ÿç·´ç¿’è¦–åœ–**ï¼šç« ç¯€å…§å®¹é è¦½

**æ›´æ–°æª”æ¡ˆï¼š** `src/features/dashboard/components/widget-config.tsx`

```typescript
export const AVAILABLE_WIDGETS: WidgetConfig[] = [
  { id: 'stats', name: 'çµ±è¨ˆè³‡è¨Š', icon: BarChart3, component: StatsWidget, span: 2 },
  {
    id: 'manifestation',
    name: 'é¡¯åŒ–é­”æ³•',
    icon: Sparkles,
    component: ManifestationWidget,
    span: 1,
  }, // â† æ–°å¢
  { id: 'calculator', name: 'è¨ˆç®—æ©Ÿ', icon: Calculator, component: CalculatorWidget },
  // ...
]
```

### âœ… 3. åŠŸèƒ½ä¿ç•™

**ä¿ç•™çš„é é¢å’ŒåŠŸèƒ½ï¼š**

- âœ… `/manifestation` é é¢å®Œæ•´ä¿ç•™
- âœ… æ‰€æœ‰ç« ç¯€å…§å®¹ä¿æŒä¸è®Š
- âœ… å‘¼å¸ç·´ç¿’åŠŸèƒ½æ­£å¸¸
- âœ… é¡˜æœ›ç‰†åŠŸèƒ½æ­£å¸¸
- âœ… è³‡æ–™ç®¡ç†ï¼ˆmanifestation-storeï¼‰æ­£å¸¸

## æ¶æ§‹èªªæ˜

### é›™é‡å­˜å–æ–¹å¼

ç¾åœ¨é¡¯åŒ–é­”æ³•æä¾›å…©ç¨®ä½¿ç”¨æ–¹å¼ï¼š

1. **å®Œæ•´é é¢æ¨¡å¼** (`/manifestation`)
   - å®Œæ•´çš„ç« ç¯€å­¸ç¿’é«”é©—
   - å‘¼å¸ç·´ç¿’å¼•å°
   - é¡˜æœ›ç‰†åŠŸèƒ½
   - éœ€è¦ã€Œäººè³‡ç®¡ç†ã€æ¬Šé™

2. **å°å·¥å…·æ¨¡å¼** (å·¥ä½œç©ºé–“)
   - å¯åŠ å…¥åˆ°å€‹äººå·¥ä½œç©ºé–“
   - å¿«é€ŸæŸ¥çœ‹é€²åº¦å’Œç‹€æ…‹
   - ä¸€éµè·³è½‰åˆ°å®Œæ•´é é¢
   - é¡¯ç¤ºæœ€è¿‘é¡˜æœ›

### æ¬Šé™è¨­è¨ˆ

```
æ¬Šé™å±¤ç´šï¼š
â”œâ”€ ç®¡ç†é¡åˆ¥
â”‚  â”œâ”€ äººè³‡ç®¡ç† (hr)
â”‚  â”‚  â”œâ”€ /hr (å“¡å·¥ç®¡ç†)
â”‚  â”‚  â””â”€ /manifestation (é¡¯åŒ–é­”æ³•) â† æ–°å¢
â”‚  â”œâ”€ è³‡æ–™ç®¡ç†
â”‚  â””â”€ ç³»çµ±è¨­å®š
```

## ä½¿ç”¨èªªæ˜

### å¦‚ä½•ä½¿ç”¨å°å·¥å…·

1. é€²å…¥å·¥ä½œç©ºé–“é é¢ (`/workspace`)
2. é»æ“Šã€Œæ–°å¢å°å·¥å…·ã€
3. é¸æ“‡ã€Œé¡¯åŒ–é­”æ³•ã€
4. å°å·¥å…·æœƒé¡¯ç¤ºï¼š
   - ç·´ç¿’é€²åº¦
   - æœ€å¾Œç·´ç¿’æ™‚é–“
   - ç•¶å‰ç« ç¯€
   - æœ€è¿‘é¡˜æœ›

### å¦‚ä½•è¨ªå•å®Œæ•´é é¢

1. **æ–¹å¼ä¸€**ï¼šå´é‚Šæ¬„å°èˆª â†’ é¡¯åŒ–é­”æ³•ï¼ˆéœ€è¦äººè³‡ç®¡ç†æ¬Šé™ï¼‰
2. **æ–¹å¼äºŒ**ï¼šå°å·¥å…· â†’ é»æ“Šã€ŒæŸ¥çœ‹å…¨éƒ¨ç« ç¯€ã€æˆ–ã€Œé–‹å§‹å®Œæ•´ç·´ç¿’ã€
3. **æ–¹å¼ä¸‰**ï¼šç›´æ¥è¨ªå• `/manifestation`

## æ¸¬è©¦çµæœ

### âœ… Build Test

```bash
npm run build
âœ“ Compiled successfully in 7.4s
âœ“ Generating static pages (6/6)
53 routes generated (åŒ…å« /manifestation)
```

### âœ… Lint Test

```bash
npx next lint
âœ” No ESLint warnings or errors
```

### âœ… æª”æ¡ˆæª¢æŸ¥

```bash
# æ–°å¢æª”æ¡ˆ
+ src/features/dashboard/components/manifestation-widget.tsx

# ä¿®æ”¹æª”æ¡ˆ
M src/lib/permissions.ts
M src/features/dashboard/components/widget-config.tsx
```

## æŠ€è¡“ç´°ç¯€

### å°å·¥å…·çµ„ä»¶ç‰¹è‰²

**ç‹€æ…‹ç®¡ç†ï¼š**

- ä½¿ç”¨ `useManifestationStore` ç²å–è³‡æ–™
- è‡ªå‹•è¨ˆç®—ç·´ç¿’é€²åº¦
- æ™ºèƒ½æé†’ç³»çµ±ï¼ˆæ ¹æ“šæœ€å¾Œç·´ç¿’æ™‚é–“ï¼‰

**è¦–è¦ºè¨­è¨ˆï¼š**

- æ¼¸å±¤èƒŒæ™¯ï¼ˆrose/amber/purpleï¼‰
- éŸ¿æ‡‰å¼å¡ç‰‡å¸ƒå±€
- æµæš¢çš„å‹•ç•«éæ¸¡

**äº’å‹•åŠŸèƒ½ï¼š**

- å±•é–‹/æ”¶èµ·å¿«é€Ÿç·´ç¿’è¦–åœ–
- æ–°åˆ†é é–‹å•Ÿå®Œæ•´é é¢
- é»æ“Šç« ç¯€æŸ¥çœ‹è©³æƒ…

### è³‡æ–™æ•´åˆ

```typescript
// ä½¿ç”¨ç¾æœ‰çš„ manifestation store
const { entries, progress, fetchEntries, fetchProgress } = useManifestationStore()

// ä½¿ç”¨ç¾æœ‰çš„ç« ç¯€è³‡æ–™
import { getChapter } from '@/data/manifestation-chapters'

// ä½¿ç”¨ç¾æœ‰çš„æé†’ç³»çµ±
import { getManifestationReminderSnapshot } from '@/lib/manifestation/reminder'
```

## ç³»çµ±ç¾æ³

- âœ… **Build Status**: æˆåŠŸ (53 routes)
- âœ… **Lint Status**: 0 errors, 0 warnings
- âœ… **æ¬Šé™è¨­å®š**: å·²æ•´åˆåˆ°äººè³‡ç®¡ç†
- âœ… **å°å·¥å…·**: å·²åŠ å…¥å·¥ä½œç©ºé–“
- âœ… **å®Œæ•´åŠŸèƒ½**: å®Œå…¨ä¿ç•™

## ä½¿ç”¨æ•ˆç›Š

1. **éˆæ´»æ€§æå‡** âœ…
   - å¯åœ¨å·¥ä½œç©ºé–“å¿«é€ŸæŸ¥çœ‹
   - å®Œæ•´é é¢æ·±åº¦å­¸ç¿’

2. **æ¬Šé™æ¸…æ™°** âœ…
   - æ­¸å±¬æ–¼äººè³‡ç®¡ç†é¡åˆ¥
   - æ¬Šé™æ§åˆ¶çµ±ä¸€

3. **ç”¨æˆ¶é«”é©—** âœ…
   - å¤šç¨®è¨ªå•æ–¹å¼
   - ç„¡ç¸«åˆ‡æ›

## çµè«–

é¡¯åŒ–é­”æ³•å·²æˆåŠŸæ•´åˆç‚ºï¼š

- âœ… äººè³‡ç®¡ç†æ¬Šé™ä¸‹çš„ç¨ç«‹é é¢
- âœ… å·¥ä½œç©ºé–“å¯ç”¨çš„å°å·¥å…·
- âœ… æ‰€æœ‰åŠŸèƒ½å®Œæ•´ä¿ç•™
- âœ… Build å’Œ Lint å…¨éƒ¨é€šé

---

## 2025-10-25 æ›´æ–°ï¼šå°å·¥å…·æ•´åˆå„ªåŒ–

### å•é¡Œä¿®æ­£

ç”¨æˆ¶åé¥‹åŸæœ¬çš„ `ManifestationReminderWidget` æ˜¯**æµ®å‹•é¡¯ç¤ºåœ¨å³ä¸Šè§’**ï¼Œå¸Œæœ›æ”¹æˆï¼š

- åªåœ¨é¦–é çš„å°å·¥å…·ç³»çµ±ä¸­é¡¯ç¤º
- å’Œå…¶ä»–å°å·¥å…·ä¸€æ¨£çš„å‘ˆç¾æ–¹å¼ï¼Œä¸è¦ç¨ç«‹æµ®ç¾

### ä¿®æ”¹å…§å®¹

#### âœ… 1. ç§»é™¤å…¨åŸŸæµ®å‹•å°å·¥å…·

**ä¿®æ”¹æª”æ¡ˆï¼š** `src/components/layout/main-layout.tsx`

ç§»é™¤äº†å…©è™• `ManifestationReminderWidget` çš„å¼•ç”¨ï¼š

- ç§»é™¤ import èªå¥
- ç§»é™¤å…©å€‹ `{isClient && <ManifestationReminderWidget />}` æ¸²æŸ“

**æ•ˆæœï¼š**

- é¡¯åŒ–é­”æ³•å°å·¥å…·ä¸å†å…¨åŸŸæµ®å‹•åœ¨å³ä¸Šè§’
- æ¸›å°‘äº†ä¸å¿…è¦çš„å…¨åŸŸå…ƒä»¶

#### âœ… 2. å¢å¼·å°å·¥å…·åŠŸèƒ½

**ä¿®æ”¹æª”æ¡ˆï¼š** `src/features/dashboard/components/manifestation-widget.tsx`

æ•´åˆäº†åŸæœ¬ `ManifestationReminderWidget` çš„åŠŸèƒ½ï¼š

- âœ… é€±æ›†ç·šåœ–ï¼ˆæœ¬é€±é¡¯åŒ–ç´€éŒ„ï¼‰
- âœ… é€£çºŒå¤©æ•¸é¡¯ç¤º
- âœ… æ™ºèƒ½æé†’ç³»çµ±ï¼ˆæ ¹æ“šæœ€å¾Œç·´ç¿’æ™‚é–“ï¼‰
- âœ… é€²åº¦è¿½è¹¤ï¼ˆç« ç¯€å®Œæˆæ•¸ï¼‰
- âœ… å¿«é€Ÿç·´ç¿’è¦–åœ–åˆ‡æ›

**æ–°å¢åŠŸèƒ½ï¼š**

```typescript
// é€±æ›†ç·šåœ–
const week = useMemo(() => {
  const range = getWeekRange()
  return range.map((day, index) => ({
    day,
    label: dayLabels[index],
    completed: snapshot.history.includes(day),
  }))
}, [snapshot.history])

// å¯¦æ™‚åŒæ­¥æé†’è³‡æ–™
useEffect(() => {
  const syncFromStorage = () => {
    setSnapshot(getManifestationReminderSnapshot())
  }
  // ç›£è½ MANIFESTATION_EVENT å’Œè¦–çª—ç„¦é»è®ŠåŒ–
  window.addEventListener(MANIFESTATION_EVENT, handleUpdate)
  window.addEventListener('focus', syncFromStorage)
  // ...
}, [])
```

### æ¸¬è©¦çµæœ

#### âœ… Lint Test

```bash
npx next lint
âœ” No ESLint warnings or errors
```

#### âœ… Build Test

```bash
npm run build
âœ“ Compiled successfully in 7.5s
âœ“ Generating static pages (6/6)
53 routes generated (åŒ…å« /manifestation)
```

### æœ€çµ‚æ¶æ§‹

**é›™é‡å­˜å–æ–¹å¼ç¶­æŒä¸è®Šï¼š**

1. **å®Œæ•´é é¢æ¨¡å¼** (`/manifestation`)
   - å®Œæ•´çš„ç« ç¯€å­¸ç¿’é«”é©—
   - å‘¼å¸ç·´ç¿’å¼•å°
   - é¡˜æœ›ç‰†åŠŸèƒ½
   - éœ€è¦ã€Œäººè³‡ç®¡ç†ã€æ¬Šé™

2. **å°å·¥å…·æ¨¡å¼** (é¦–é å·¥ä½œç©ºé–“) â† **æ›´æ–°**
   - âœ… åªåœ¨é¦–é å°å·¥å…·ç³»çµ±ä¸­é¡¯ç¤ºï¼ˆä¸å†æµ®å‹•ï¼‰
   - âœ… èˆ‡å…¶ä»–å°å·¥å…·ç›¸åŒçš„å‘ˆç¾æ–¹å¼
   - âœ… é€±æ›†ç·šåœ–é¡¯ç¤ºæœ¬é€±ç·´ç¿’è¨˜éŒ„
   - âœ… é€£çºŒå¤©æ•¸å’Œé€²åº¦è¿½è¹¤
   - âœ… å¿«é€Ÿç·´ç¿’è¦–åœ–åˆ‡æ›
   - âœ… ä¸€éµè·³è½‰åˆ°å®Œæ•´é é¢

### ç³»çµ±ç¾æ³

- âœ… **Build Status**: æˆåŠŸ (53 routes)
- âœ… **Lint Status**: 0 errors, 0 warnings
- âœ… **å°å·¥å…·æ•´åˆ**: å®Œæˆçµ±ä¸€åˆ°é¦–é å°å·¥å…·ç³»çµ±
- âœ… **æµ®å‹•å…ƒä»¶**: å·²ç§»é™¤å…¨åŸŸæµ®å‹•é¡¯ç¤º
- âœ… **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿ç•™ä¸¦å¢å¼·

**ä¿®å¾©å®Œæˆï¼** ğŸ‰
