# è¡Œç¨‹ç”Ÿå‘½é€±æœŸæ¶æ§‹

> æœ€å¾Œæ›´æ–°ï¼š2026-01-31

## ğŸ¯ æ ¸å¿ƒåŸå‰‡

**Single Source of Truth** â€” è¡Œç¨‹è³‡æ–™åªåšä¸€æ¬¡ï¼Œå¤šè™•ä½¿ç”¨

---

## ğŸ“Š å•é¡Œï¼šåŒä¸€è¡Œç¨‹åšä¸‰æ¬¡

| éšæ®µ | ç”¢å‡º | å•é¡Œ |
|------|------|------|
| ææ¡ˆ | ç¶²é è¡Œç¨‹ | ç¬¬ 1 ç‰ˆ |
| é–‹åœ˜ | æ‰‹å†Š | ç¬¬ 2 ç‰ˆï¼ˆé‡åšï¼‰|
| å‡ºåœ˜ | Online App | ç¬¬ 3 ç‰ˆï¼ˆåˆé‡åšï¼‰|

**æµªè²»äººåŠ› + ç‰ˆæœ¬éŒ¯äº‚**

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### è³‡æ–™æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ERP (venturo-erp)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ã€ææ¡ˆéšæ®µã€‘packages                                        â”‚
â”‚      â””â”€â”€ itinerary_id                                       â”‚
â”‚          (å¯ç·¨è¼¯ã€å¯å¤šç‰ˆæœ¬æ¯”è¼ƒ)                               â”‚
â”‚                 â†“                                           â”‚
â”‚          å®¢æˆ¶ç¢ºèªï¼Œé¸å®šæœ€çµ‚ç‰ˆæœ¬                               â”‚
â”‚                 â†“                                           â”‚
â”‚  ã€é–‹åœ˜éšæ®µã€‘tours                                           â”‚
â”‚      â””â”€â”€ itinerary_id (é–å®š)                                â”‚
â”‚      â””â”€â”€ brochure_settings (æ‰‹å†Šæ’ç‰ˆï¼šé¡¯ç¤º/éš±è—æ™¯é»)         â”‚
â”‚                 â†“                                           â”‚
â”‚  ã€è¨‚å–®ã€‘orders                                              â”‚
â”‚      â””â”€â”€ tour_id                                            â”‚
â”‚      â””â”€â”€ members                                            â”‚
â”‚                 â†“                                           â”‚
â”‚          ç¢ºèªäº¤æ¥                                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ è¤‡è£½æœ€çµ‚ç‰ˆæœ¬
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Online (venturo-online)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  trips è¡¨                                                   â”‚
â”‚      â””â”€â”€ source: 'erp' | 'user'                            â”‚
â”‚      â””â”€â”€ erp_tour_id (å¦‚æœä¾†è‡ª ERP)                         â”‚
â”‚      â””â”€â”€ itinerary_data (è¡Œç¨‹è³‡æ–™)                          â”‚
â”‚                                                             â”‚
â”‚  ã€é ˜éšŠã€‘æ ¹æ“šç¾æ³æ›´æ–°æ™‚é–“                                    â”‚
â”‚  ã€æ—…å®¢ã€‘æŸ¥çœ‹æ¯æ—¥è¡Œç¨‹                                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å€‹ç”¢å‡ºï¼Œä¸€ä»½è³‡æ–™

| ç”¢å‡º | ä¾†æº | å·®ç•° |
|------|------|------|
| **ç¶²é è¡Œç¨‹** | itineraries | å…¨éƒ¨é¡¯ç¤º |
| **æ‰‹å†Š** | itineraries + brochure_settings | å¯éš±è—éƒ¨åˆ†æ™¯é» |
| **Online App** | trips (å¾ itineraries è¤‡è£½) | é ˜éšŠå¯æ›´æ–°æ™‚é–“ |

---

## ğŸ” é—œéµè¦å‰‡

| è¦å‰‡ | èªªæ˜ |
|------|------|
| **é–‹åœ˜å‰** | itinerary å¯è‡ªç”±ç·¨è¼¯ã€å¯æœ‰å¤šç‰ˆæœ¬ |
| **é–‹åœ˜å¾Œ** | itinerary é–å®šï¼Œåªèƒ½ä¿®æ”¹å…§å®¹ï¼Œä¸èƒ½æ–°å¢ç‰ˆæœ¬ |
| **æ‰‹å†Šéš±è—** | è¨­å®šå­˜åœ¨ brochure_settingsï¼Œä¸å½±éŸ¿åŸå§‹è³‡æ–™ |
| **è¤‡è£½æ™‚æ©Ÿ** | ç¢ºèªäº¤æ¥æ™‚ï¼ˆæœ€çµ‚ç‰ˆæœ¬ï¼‰|
| **æ™‚é–“æ¬„ä½** | é¸å¡«ï¼Œé ˜éšŠå¯åœ¨ Online æ›´æ–° |

---

## ğŸ“± Online ä½¿ç”¨å ´æ™¯

### æ—…å®¢æŸ¥çœ‹è¡Œç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Day 2 Â· 1æœˆ31æ—¥        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â— 08:30 é£¯åº—å¤§å»³é›†åˆ    â”‚
â”‚                         â”‚
â”‚  â— 09:00 å‡ºç™¼å‰å¾€é®å€‰    â”‚
â”‚    [æ´»å‹•åœ–ç‰‡]            â”‚
â”‚    ç¶“å…¸çŒç±ƒé«˜æ‰‹å¹³äº¤é“... â”‚
â”‚                         â”‚
â”‚  â— 12:30 åˆé¤è‡ªç†        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é ˜éšŠæ›´æ–°æ™‚é–“

```
å®¢äººï¼šã€Œæ˜å¤©å¹¾é»é›†åˆï¼Ÿã€

é ˜éšŠæ‰“é–‹ App â†’ æ›´æ–°é›†åˆæ™‚é–“ â†’ æ—…å®¢é¦¬ä¸Šçœ‹åˆ°
```

---

## ğŸ“‹ Online trips è¡¨è¨­è¨ˆ

```sql
CREATE TABLE trips (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- ä¾†æº
  source TEXT NOT NULL CHECK (source IN ('erp', 'user')),
  erp_tour_id UUID REFERENCES erp_tours(id),  -- å¦‚æœä¾†è‡ª ERP
  
  -- åŸºæœ¬è³‡è¨Š
  title TEXT NOT NULL,
  subtitle TEXT,
  cover_image TEXT,
  departure_date DATE,
  return_date DATE,
  
  -- è¡Œç¨‹è³‡æ–™ (JSONB)
  itinerary_data JSONB NOT NULL DEFAULT '{}',
  -- çµæ§‹ï¼š
  -- {
  --   "dailyItinerary": [
  --     {
  --       "day": 1,
  --       "activities": [
  --         {
  --           "title": "é£¯åº—å¤§å»³é›†åˆ",
  --           "startTime": "0830",
  --           "endTime": "0900",
  --           "description": "...",
  --           "image": "..."
  --         }
  --       ],
  --       "meals": { "breakfast": "é£¯åº—å…§", "lunch": "è‡ªç†", "dinner": "..." },
  --       "hotel": "..."
  --     }
  --   ],
  --   "outboundFlight": {...},
  --   "returnFlight": {...},
  --   "hotels": [...]
  -- }
  
  -- ç‹€æ…‹
  status TEXT NOT NULL DEFAULT 'upcoming' CHECK (status IN ('upcoming', 'ongoing', 'completed')),
  
  -- æ¬Šé™
  created_by UUID REFERENCES users(id),
  leader_id UUID REFERENCES users(id),  -- é ˜éšŠ
  
  -- æ™‚é–“æˆ³
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- åœ˜å“¡é—œè¯
CREATE TABLE trip_members (
  trip_id UUID REFERENCES trips(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id),
  role TEXT NOT NULL DEFAULT 'member' CHECK (role IN ('leader', 'member')),
  PRIMARY KEY (trip_id, user_id)
);
```

---

## ğŸš€ å¾…å¯¦ä½œ

### ERP ç«¯

1. [ ] ã€Œç¢ºèªäº¤æ¥ã€æŒ‰éˆ• â€” tours è©³æƒ…é 
2. [ ] è¤‡è£½ itinerary åˆ° Online API
3. [ ] brochure_settings æ¬„ä½ï¼ˆæ‰‹å†Šéš±è—æ™¯é»ï¼‰

### Online ç«¯

1. [ ] trips è¡¨ migration
2. [ ] `/api/trips/sync-from-erp` API
3. [ ] `/trips/[id]` è¡Œç¨‹è©³æƒ…é 
4. [ ] é ˜éšŠç·¨è¼¯æ™‚é–“åŠŸèƒ½
5. [ ] æ¨æ’­é€šçŸ¥ï¼ˆæ™‚é–“æ›´æ–°æ™‚ï¼‰

---

## ğŸ“ ç›¸é—œæ–‡ä»¶

- `VENTURO_VISION.md` â€” é›™å¹³å°æ¶æ§‹
- `CROSS_SYSTEM_MAP.md` â€” è·¨ç³»çµ±å½±éŸ¿åœ°åœ–
- `venturo-online/.claude/CLAUDE.md` â€” Online é–‹ç™¼è¦ç¯„
