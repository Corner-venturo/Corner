<!DOCTYPE html>
<html>
<head>
  <title>Realtime åŠŸèƒ½æ¸¬è©¦</title>
  <meta charset="utf-8">
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
    }
    h1 { color: #2563eb; }
    .status {
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
      border: 2px solid;
    }
    .success {
      background: #dcfce7;
      border-color: #16a34a;
      color: #166534;
    }
    .error {
      background: #fee2e2;
      border-color: #dc2626;
      color: #991b1b;
    }
    .info {
      background: #dbeafe;
      border-color: #2563eb;
      color: #1e40af;
    }
    .step {
      margin: 20px 0;
      padding: 15px;
      background: #f3f4f6;
      border-left: 4px solid #6366f1;
      border-radius: 4px;
    }
    button {
      background: #2563eb;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #1d4ed8;
    }
    code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>ğŸ“¡ Realtime åŠŸèƒ½æ¸¬è©¦æŒ‡å—</h1>

  <div class="status info">
    <strong>âš ï¸ é‡è¦ï¼š</strong>è«‹åœ¨ç€è¦½å™¨é–‹å•Ÿ <code>http://localhost:3000/calendar</code> ä¸¦æ‰“é–‹é–‹ç™¼è€…å·¥å…· (F12) çš„ Console è¦–çª—
  </div>

  <div class="step">
    <h3>æ­¥é©Ÿ 1ï¼šæª¢æŸ¥ Realtime Manager æ˜¯å¦è¼‰å…¥</h3>
    <p>åœ¨ Console ä¸­è¼¸å…¥ï¼š</p>
    <pre>window.realtimeManager</pre>
    <p><strong>é æœŸçµæœï¼š</strong>æ‡‰è©²æœƒçœ‹åˆ° RealtimeManager ç‰©ä»¶ï¼ˆä¸æ˜¯ undefinedï¼‰</p>
    <p><strong>å¦‚æœæ˜¯ undefinedï¼š</strong>è¡¨ç¤º realtime-manager.ts æ²’æœ‰æ­£ç¢ºè¼‰å…¥</p>
  </div>

  <div class="step">
    <h3>æ­¥é©Ÿ 2ï¼šæª¢æŸ¥ç›®å‰çš„è¨‚é–±ç‹€æ…‹</h3>
    <p>åœ¨ Console ä¸­è¼¸å…¥ï¼š</p>
    <pre>window.realtimeManager.getAllSubscriptions()</pre>
    <p><strong>é æœŸçµæœï¼š</strong>æ‡‰è©²æœƒçœ‹åˆ°ä¸€å€‹é™£åˆ—ï¼ŒåŒ…å«ç›®å‰çš„è¨‚é–±ï¼ˆä¾‹å¦‚ calendar_events-realtimeï¼‰</p>
    <p><strong>å¦‚æœæ˜¯ç©ºé™£åˆ— []ï¼š</strong>è¡¨ç¤º Hook æ²’æœ‰è¢«åŸ·è¡Œ</p>
  </div>

  <div class="step">
    <h3>æ­¥é©Ÿ 3ï¼šæª¢æŸ¥ Console æ˜¯å¦æœ‰è¨‚é–±è¨Šæ¯</h3>
    <p>é‡æ–°æ•´ç†è¡Œäº‹æ›†é é¢ï¼Œæ‡‰è©²æœƒçœ‹åˆ°ï¼š</p>
    <pre>ğŸ”„ [calendar_events] é–‹å§‹è¨‚é–± Realtime
[RealtimeManager] Creating subscription: calendar_events-realtime
âœ… [calendar_events] Realtime è¨‚é–±å·²å»ºç«‹</pre>
    <p><strong>å¦‚æœæ²’çœ‹åˆ°ï¼š</strong>è¡¨ç¤º useRealtimeForCalendarEvents() æ²’æœ‰è¢«å‘¼å«</p>
  </div>

  <div class="step">
    <h3>æ­¥é©Ÿ 4ï¼šæ¸¬è©¦ Realtime æ˜¯å¦é‹ä½œ</h3>
    <p>è«‹åŒäº‹æ–°å¢ä¸€ç­†è¡Œäº‹æ›†äº‹é …ï¼Œä½ çš„ Console æ‡‰è©²æœƒçœ‹åˆ°ï¼š</p>
    <pre>â• [calendar_events] Realtime INSERT: {...}
âœ… [calendar_events] æ–°å¢åˆ° Store</pre>
    <p>åŒæ™‚ç•«é¢æ‡‰è©²<strong>ç«‹å³é¡¯ç¤º</strong>æ–°å¢çš„äº‹é …ï¼ˆç„¡éœ€é‡æ–°æ•´ç†ï¼‰</p>
  </div>

  <div class="step">
    <h3>æ­¥é©Ÿ 5ï¼šæ‰‹å‹•è§¸ç™¼è¨‚é–±ï¼ˆé™¤éŒ¯ç”¨ï¼‰</h3>
    <p>å¦‚æœä¸Šè¿°æ­¥é©Ÿéƒ½æ²’æœ‰åæ‡‰ï¼Œå¯ä»¥æ‰‹å‹•æ¸¬è©¦ Supabase Realtime é€£ç·šï¼š</p>
    <button onclick="testRealtimeConnection()">æ¸¬è©¦ Realtime é€£ç·š</button>
    <pre id="result" style="display: none; margin-top: 10px;"></pre>
  </div>

  <div class="status error" id="troubleshooting" style="display: none;">
    <h3>âŒ å¸¸è¦‹å•é¡Œæ’é™¤</h3>
    <ul id="issues"></ul>
  </div>

  <script>
    function testRealtimeConnection() {
      const result = document.getElementById('result');
      result.style.display = 'block';
      result.textContent = 'æ­£åœ¨æ¸¬è©¦é€£ç·š...';

      if (typeof window.realtimeManager === 'undefined') {
        result.textContent = 'âŒ éŒ¯èª¤ï¼šwindow.realtimeManager ä¸å­˜åœ¨\n\né€™è¡¨ç¤º realtime-manager.ts æ²’æœ‰æ­£ç¢ºè¼‰å…¥ã€‚\nè«‹ç¢ºèªæª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚';
        return;
      }

      const subs = window.realtimeManager.getAllSubscriptions();
      result.textContent = `âœ… RealtimeManager å·²è¼‰å…¥\n\nç›®å‰è¨‚é–±æ•¸é‡ï¼š${subs.length}\n\nè¨‚é–±è©³æƒ…ï¼š\n${JSON.stringify(subs, null, 2)}`;

      if (subs.length === 0) {
        result.textContent += '\n\nâš ï¸ è­¦å‘Šï¼šæ²’æœ‰ä»»ä½•è¨‚é–±ï¼\né€™è¡¨ç¤º useRealtimeForCalendarEvents() Hook æ²’æœ‰è¢«åŸ·è¡Œã€‚\nè«‹æª¢æŸ¥ src/app/calendar/page.tsx æ˜¯å¦æ­£ç¢ºå‘¼å«è©² Hookã€‚';
      }
    }

    // è‡ªå‹•æª¢æŸ¥å¸¸è¦‹å•é¡Œ
    setTimeout(() => {
      const issues = [];

      if (typeof window.realtimeManager === 'undefined') {
        issues.push('RealtimeManager æœªè¼‰å…¥ - è«‹æª¢æŸ¥ src/lib/realtime/realtime-manager.ts');
      }

      if (issues.length > 0) {
        const troubleshooting = document.getElementById('troubleshooting');
        const issuesList = document.getElementById('issues');

        issues.forEach(issue => {
          const li = document.createElement('li');
          li.textContent = issue;
          issuesList.appendChild(li);
        });

        troubleshooting.style.display = 'block';
      }
    }, 2000);
  </script>
</body>
</html>
