<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ¸…ç† IndexedDB</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    button {
      background: #ef4444;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #dc2626;
    }
    button.safe {
      background: #3b82f6;
    }
    button.safe:hover {
      background: #2563eb;
    }
    .success {
      background: #dcfce7;
      color: #166534;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      display: none;
    }
    .warning {
      background: #fef3c7;
      color: #92400e;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
    pre {
      background: #1f2937;
      color: #e5e7eb;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§¹ æ¸…ç† IndexedDB å¿«å–è³‡æ–™</h1>
    
    <div class="warning">
      <strong>âš ï¸ æ³¨æ„ï¼š</strong>æ­¤æ“ä½œæœƒæ¸…é™¤æ‰€æœ‰æœ¬åœ°å¿«å–ï¼Œç„¶å¾Œé‡æ–°å¾ Supabase è¼‰å…¥ä¹¾æ·¨çš„è³‡æ–™ã€‚
    </div>

    <button class="safe" onclick="clearMessages()">æ¸…ç†è¨Šæ¯å¿«å–</button>
    <button onclick="clearAllIndexedDB()">æ¸…ç†æ‰€æœ‰ IndexedDB è³‡æ–™</button>

    <div id="result" class="success"></div>
    <pre id="log"></pre>
  </div>

  <script>
    function log(message) {
      const logEl = document.getElementById('log');
      logEl.textContent += message + '\n';
      console.log(message);
    }

    function showSuccess(message) {
      const resultEl = document.getElementById('result');
      resultEl.textContent = message;
      resultEl.style.display = 'block';
    }

    async function clearMessages() {
      log('ğŸ§¹ é–‹å§‹æ¸…ç†è¨Šæ¯å¿«å–...');

      try {
        const dbName = 'VenturoOfflineDB';
        const request = indexedDB.open(dbName);
        
        request.onsuccess = function(event) {
          const db = event.target.result;
          const transaction = db.transaction(['messages'], 'readwrite');
          const objectStore = transaction.objectStore('messages');
          const clearRequest = objectStore.clear();
          
          clearRequest.onsuccess = function() {
            log('âœ… è¨Šæ¯å¿«å–å·²æ¸…ç†å®Œæˆï¼');
            showSuccess('âœ… è¨Šæ¯å¿«å–å·²æ¸…ç†ï¼è«‹é‡æ–°æ•´ç†é é¢ä»¥é‡æ–°è¼‰å…¥è³‡æ–™ã€‚');
          };
          
          clearRequest.onerror = function() {
            log('âŒ æ¸…ç†å¤±æ•—: ' + clearRequest.error);
          };
        };
        
        request.onerror = function() {
          log('âŒ ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ' + request.error);
        };
      } catch (error) {
        log('âŒ ç™¼ç”ŸéŒ¯èª¤: ' + error.message);
      }
    }

    async function clearAllIndexedDB() {
      if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™å—ï¼Ÿé€™æœƒåˆªé™¤æ‰€æœ‰å¿«å–ï¼ŒåŒ…æ‹¬è¨Šæ¯ã€é »é“ç­‰è³‡æ–™ã€‚')) {
        return;
      }

      log('ğŸ§¹ é–‹å§‹æ¸…ç†æ‰€æœ‰ IndexedDB è³‡æ–™...');

      try {
        const dbName = 'VenturoOfflineDB';
        const deleteRequest = indexedDB.deleteDatabase(dbName);
        
        deleteRequest.onsuccess = function() {
          log('âœ… IndexedDB å·²å®Œå…¨æ¸…é™¤ï¼');
          showSuccess('âœ… æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤ï¼è«‹é‡æ–°æ•´ç†é é¢ä»¥é‡æ–°è¼‰å…¥è³‡æ–™ã€‚');
        };
        
        deleteRequest.onerror = function() {
          log('âŒ æ¸…é™¤å¤±æ•—: ' + deleteRequest.error);
        };
        
        deleteRequest.onblocked = function() {
          log('âš ï¸ è³‡æ–™åº«è¢«é–å®šï¼Œè«‹é—œé–‰æ‰€æœ‰ä½¿ç”¨æ­¤ç¶²ç«™çš„åˆ†é å¾Œå†è©¦ã€‚');
        };
      } catch (error) {
        log('âŒ ç™¼ç”ŸéŒ¯èª¤: ' + error.message);
      }
    }

    log('ğŸ“‹ IndexedDB æ¸…ç†å·¥å…·å·²å°±ç·’');
    log('ğŸ’¡ æç¤ºï¼šæ¸…ç†å¾Œè«‹é‡æ–°æ•´ç†ä¸»é é¢ä»¥é‡æ–°è¼‰å…¥è³‡æ–™');
  </script>
</body>
</html>
