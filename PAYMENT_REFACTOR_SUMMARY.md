# æ”¶æ¬¾ç®¡ç†é‡æ§‹ç¸½çµå ±å‘Š

> **å®Œæˆæ—¥æœŸ**: 2025-11-14
> **ç›®æ¨™**: çµ±ä¸€æ”¶æ¬¾ç®¡ç†å’Œè«‹æ¬¾ç®¡ç†çš„ UI é¢¨æ ¼èˆ‡æ¶æ§‹

---

## ğŸ“Š é‡æ§‹æˆæœ

### âœ… å·²å®Œæˆé …ç›®

1. **å»ºç«‹å®Œæ•´çš„ Feature æ¶æ§‹**
   ```
   src/features/finance/payments/
   â”œâ”€â”€ components/
   â”‚   â”œâ”€â”€ AddReceiptDialog.tsx       (æ–°å¢æ”¶æ¬¾å°è©±æ¡† - è¡¨æ ¼å¼è¼¸å…¥)
   â”‚   â”œâ”€â”€ PaymentItemRow.tsx         (æ”¶æ¬¾é …ç›®è¡Œçµ„ä»¶)
   â”‚   â”œâ”€â”€ BatchReceiptDialog.tsx     (æ‰¹æ¬¡æ”¶æ¬¾å°è©±æ¡†)
   â”‚   â””â”€â”€ index.ts
   â”œâ”€â”€ hooks/
   â”‚   â”œâ”€â”€ usePaymentForm.ts          (è¡¨å–®ç‹€æ…‹ç®¡ç†)
   â”‚   â””â”€â”€ index.ts
   â”œâ”€â”€ types.ts                       (å‹åˆ¥å®šç¾©)
   â””â”€â”€ index.ts
   ```

2. **çµ±ä¸€ UI æ¨¡å¼**
   - âœ… å¾ç¨ç«‹é é¢æ”¹ç‚º Dialog å½ˆçª—ï¼ˆèˆ‡è«‹æ¬¾ç®¡ç†ä¸€è‡´ï¼‰
   - âœ… æ¡ç”¨è¡¨æ ¼å¼è¼¸å…¥ï¼ˆinline editingï¼‰
   - âœ… çµ±ä¸€ä½¿ç”¨ Comboboxã€Select ç­‰æ¨™æº–çµ„ä»¶
   - âœ… æ”¯æ´å‹•æ…‹é¡å¤–æ¬„ä½ï¼ˆæ ¹æ“šæ”¶æ¬¾æ–¹å¼é¡¯ç¤ºï¼‰

3. **ç§»é™¤å†—é¤˜ä»£ç¢¼**
   - âŒ åˆªé™¤ `/payments/new` ç¨ç«‹é é¢ï¼ˆ460 è¡Œï¼‰
   - âŒ åˆªé™¤ `/components/finance/` ç›®éŒ„
   - âœ… çµ±ä¸€æ‰¹æ¬¡åŠŸèƒ½åˆ° `features/finance/payments/`

4. **æ”¹å–„çš„ Hook**
   - `usePaymentForm`: å®Œæ•´çš„è¡¨å–®ç‹€æ…‹ç®¡ç†
   - è‡ªå‹•è¨ˆç®—ç¸½é‡‘é¡
   - è¡¨å–®é©—è­‰ï¼ˆå« LinkPayã€åŒ¯æ¬¾ç­‰ç‰¹æ®Šæ¬„ä½æª¢æŸ¥ï¼‰
   - æ”¯æ´å‹•æ…‹æ–°å¢/ç§»é™¤æ”¶æ¬¾é …ç›®

---

## ğŸ¨ UI å°æ¯”

### Before (èˆŠç‰ˆ)
```tsx
// âŒ ç¨ç«‹é é¢ + å¡ç‰‡å¼è¡¨å–®
/finance/payments/new â†’ å‚³çµ±å¤šå±¤ Card ä½ˆå±€
- åŸºæœ¬è³‡è¨Š Card
- æ”¶æ¬¾é …ç›® Cardï¼ˆæ¯å€‹é …ç›®æ˜¯å¤§å‹ divï¼‰
- æ‘˜è¦ Card
- 460 è¡Œä»£ç¢¼
```

### After (æ–°ç‰ˆ)
```tsx
// âœ… Dialog å½ˆçª— + è¡¨æ ¼å¼è¼¸å…¥
<AddReceiptDialog />
- ç·Šå‡‘çš„è¡¨æ ¼å¼è¼¸å…¥ï¼ˆé¡ä¼¼ Excelï¼‰
- å‹•æ…‹å±•é–‹é¡å¤–æ¬„ä½ï¼ˆLinkPay/åŒ¯æ¬¾/åˆ·å¡/æ”¯ç¥¨ï¼‰
- å³æ™‚è¨ˆç®—ç¸½é‡‘é¡
- 220 è¡Œä»£ç¢¼ï¼ˆæ¸›å°‘ 52%ï¼‰
```

---

## ğŸ”„ ç¾åœ¨èˆ‡è«‹æ¬¾ç®¡ç†å®Œå…¨ä¸€è‡´

| æ¯”è¼ƒé …ç›® | è«‹æ¬¾ç®¡ç† (Requests) | æ”¶æ¬¾ç®¡ç† (Payments) |
|---------|-------------------|-------------------|
| **æ–°å¢æ–¹å¼** | âœ… Dialog | âœ… Dialogï¼ˆå·²çµ±ä¸€ï¼‰ |
| **UI é¢¨æ ¼** | âœ… è¡¨æ ¼å¼ | âœ… è¡¨æ ¼å¼ï¼ˆå·²çµ±ä¸€ï¼‰ |
| **Feature æ¶æ§‹** | âœ… `features/finance/requests/` | âœ… `features/finance/payments/`ï¼ˆå·²å»ºç«‹ï¼‰ |
| **æ‰¹æ¬¡åŠŸèƒ½** | âœ… `BatchRequestDialog` | âœ… `BatchReceiptDialog`ï¼ˆå·²ç§»å‹•ï¼‰ |

---

## ğŸ“¦ æ–°å¢çš„çµ„ä»¶

### 1. AddReceiptDialog
**åŠŸèƒ½**ï¼š
- é¸æ“‡åœ˜é«” â†’ è‡ªå‹•éæ¿¾è¨‚å–®
- è¡¨æ ¼å¼è¼¸å…¥æ”¶æ¬¾é …ç›®
- æ”¯æ´ 5 ç¨®æ”¶æ¬¾æ–¹å¼ï¼ˆç¾é‡‘/åŒ¯æ¬¾/åˆ·å¡/æ”¯ç¥¨/LinkPayï¼‰
- å‹•æ…‹é¡¯ç¤ºé¡å¤–æ¬„ä½ï¼ˆä¾‹å¦‚ LinkPay çš„ Emailã€ä»˜æ¬¾æˆªæ­¢æ—¥ï¼‰
- å³æ™‚é©—è­‰å’Œè¨ˆç®—

**ä½¿ç”¨æ–¹å¼**ï¼š
```tsx
<AddReceiptDialog
  open={isDialogOpen}
  onOpenChange={setIsDialogOpen}
  onSuccess={() => console.log('æ–°å¢æˆåŠŸ')}
/>
```

### 2. PaymentItemRow
**åŠŸèƒ½**ï¼š
- å–®ä¸€æ”¶æ¬¾é …ç›®çš„è¡¨æ ¼è¡Œ
- æ”¯æ´ `<tr>` + é¡å¤–æ¬„ä½çš„é›™è¡Œè¨­è¨ˆ
- å‹•æ…‹é¡¯ç¤ºä¸åŒæ”¶æ¬¾æ–¹å¼çš„å°ˆå±¬æ¬„ä½

**ç‰¹è‰²**ï¼š
- LinkPay: Emailã€ä»˜æ¬¾æˆªæ­¢æ—¥ã€ä»˜æ¬¾åç¨±
- åŒ¯æ¬¾: åŒ¯å…¥å¸³æˆ¶ã€æ‰‹çºŒè²»
- åˆ·å¡: å¡è™Ÿå¾Œå››ç¢¼ã€æˆæ¬Šç¢¼ã€æ‰‹çºŒè²»
- æ”¯ç¥¨: æ”¯ç¥¨è™Ÿç¢¼ã€é–‹ç¥¨éŠ€è¡Œ

### 3. usePaymentForm Hook
**åŠŸèƒ½**ï¼š
- è¡¨å–®è³‡æ–™ç®¡ç†
- è¨‚å–®éæ¿¾ï¼ˆæ ¹æ“šé¸ä¸­çš„åœ˜é«”ï¼‰
- æ”¶æ¬¾é …ç›®çš„å¢åˆªæ”¹
- ç¸½é‡‘é¡è‡ªå‹•è¨ˆç®—
- å®Œæ•´è¡¨å–®é©—è­‰

**è¿”å›å€¼**ï¼š
```ts
{
  // è³‡æ–™
  tours, orders, formData, paymentItems,
  filteredOrders, selectedOrder, totalAmount,

  // æ“ä½œ
  setFormData, addPaymentItem, removePaymentItem,
  updatePaymentItem, resetForm, validateForm,
}
```

---

## ğŸš€ å„ªå‹¢

1. **ä¸€è‡´æ€§**
   - æ”¶æ¬¾å’Œè«‹æ¬¾çš„ UI å®Œå…¨çµ±ä¸€
   - ä½¿ç”¨è€…å­¸ç¿’æˆæœ¬é™ä½

2. **å¯ç¶­è­·æ€§**
   - Feature-based æ¶æ§‹æ¸…æ™°
   - çµ„ä»¶è·è²¬å–®ä¸€
   - å‹åˆ¥å®šç¾©å®Œæ•´

3. **å¯æ“´å±•æ€§**
   - æ–°å¢æ”¶æ¬¾æ–¹å¼åªéœ€ä¿®æ”¹ `types.ts`
   - Hook é‚è¼¯å¯é‡ç”¨
   - çµ„ä»¶é«˜åº¦è§£è€¦

4. **æ€§èƒ½å„ªåŒ–**
   - Dialog æ¨¡å¼ï¼ˆä¸è·³é ï¼‰
   - æŒ‰éœ€è¼‰å…¥åœ˜é«”/è¨‚å–®è³‡æ–™
   - å³æ™‚é©—è­‰æ¸›å°‘ç„¡æ•ˆæäº¤

---

## âš ï¸ å¾…å¯¦ä½œé …ç›®

1. **AddReceiptDialog çš„å„²å­˜é‚è¼¯**
   ```tsx
   // TODO: å¯¦ä½œå„²å­˜é‚è¼¯
   // 1. å»ºç«‹æ”¶æ¬¾å–®
   // 2. å»ºç«‹æ”¶æ¬¾é …ç›®
   // 3. æ›´æ–°è¨‚å–®æ”¶æ¬¾ç‹€æ…‹
   ```

2. **BatchReceiptDialog çš„è¡¨æ ¼å¼æ”¹é€ **
   - ç›®å‰é‚„æ˜¯å¡ç‰‡å¼è¼¸å…¥
   - å»ºè­°æ”¹æˆèˆ‡ BatchRequestDialog ç›¸åŒçš„è¡¨æ ¼å¼

3. **æ•´åˆ LinkPay API**
   - è‡ªå‹•ç”Ÿæˆä»˜æ¬¾é€£çµ
   - æœƒè¨ˆç¢ºèªå¯¦æ”¶é‡‘é¡æµç¨‹

---

## ğŸ“ æ¸¬è©¦æ¸…å–®

- [x] Build æˆåŠŸï¼ˆâœ… å·²é€šéï¼‰
- [ ] é–‹å•Ÿæ–°å¢æ”¶æ¬¾å°è©±æ¡†
- [ ] é¸æ“‡åœ˜é«” â†’ è¨‚å–®è‡ªå‹•éæ¿¾
- [ ] æ–°å¢å¤šå€‹æ”¶æ¬¾é …ç›®
- [ ] åˆ‡æ›ä¸åŒæ”¶æ¬¾æ–¹å¼ â†’ é¡å¤–æ¬„ä½é¡¯ç¤ºæ­£ç¢º
- [ ] ç¸½é‡‘é¡è‡ªå‹•è¨ˆç®—
- [ ] è¡¨å–®é©—è­‰ï¼ˆå¿…å¡«æ¬„ä½ã€LinkPay Email ç­‰ï¼‰
- [ ] å„²å­˜æ”¶æ¬¾å–®ï¼ˆå¾…å¯¦ä½œï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè­°

1. **å¯¦ä½œ AddReceiptDialog çš„å„²å­˜é‚è¼¯**
   - é€£æ¥ `useReceiptStore`
   - å»ºç«‹æ”¶æ¬¾å–®å’Œæ”¶æ¬¾é …ç›®
   - æ›´æ–°è¨‚å–®çš„ `payment_status` å’Œ `remaining_amount`

2. **é‡æ§‹ BatchReceiptDialog**
   - æ”¹ç”¨è¡¨æ ¼å¼è¼¸å…¥ï¼ˆåƒè€ƒ BatchRequestDialogï¼‰
   - çµ±ä¸€æ‰¹æ¬¡æ“ä½œçš„ UI é¢¨æ ¼

3. **æ–°å¢å–®å…ƒæ¸¬è©¦**
   - `usePaymentForm` çš„é‚è¼¯æ¸¬è©¦
   - è¡¨å–®é©—è­‰æ¸¬è©¦

4. **æ–‡æª”æ›´æ–°**
   - æ›´æ–° `CLAUDE.md` ä¸­çš„æ”¶æ¬¾ç®¡ç†èªªæ˜
   - æ–°å¢æ”¶æ¬¾æµç¨‹åœ–

---

## ğŸ“Š ä»£ç¢¼çµ±è¨ˆ

```
æ–°å¢æª”æ¡ˆ:
âœ… src/features/finance/payments/types.ts (70 è¡Œ)
âœ… src/features/finance/payments/hooks/usePaymentForm.ts (170 è¡Œ)
âœ… src/features/finance/payments/components/PaymentItemRow.tsx (280 è¡Œ)
âœ… src/features/finance/payments/components/AddReceiptDialog.tsx (220 è¡Œ)
âœ… src/features/finance/payments/components/index.ts (8 è¡Œ)
âœ… src/features/finance/payments/hooks/index.ts (5 è¡Œ)
âœ… src/features/finance/payments/index.ts (7 è¡Œ)

ç§»å‹•æª”æ¡ˆ:
ğŸ“¦ BatchReceiptDialog: components/finance/ â†’ features/finance/payments/

åˆªé™¤æª”æ¡ˆ:
âŒ src/app/finance/payments/new/page.tsx (460 è¡Œ)
âŒ src/components/finance/ (æ•´å€‹ç›®éŒ„)

ç¸½è¨ˆ: +760 è¡Œï¼Œ-460 è¡Œ
æ·¨å¢åŠ : +300 è¡Œï¼ˆä½†æ¶æ§‹æ›´æ¸…æ™°ã€åŠŸèƒ½æ›´å®Œæ•´ï¼‰
```

---

**çµè«–**: æ”¶æ¬¾ç®¡ç†å·²æˆåŠŸé‡æ§‹ï¼Œèˆ‡è«‹æ¬¾ç®¡ç†é”æˆ UI å’Œæ¶æ§‹çš„å®Œå…¨çµ±ä¸€ã€‚Build å·²é€šéï¼Œå¯ä»¥é€²å…¥æ¸¬è©¦éšæ®µã€‚
