# Venturo 願景與平台概念

> **版本**: 1.0
> **最後更新**: 2026-01-11
> **必讀對象**: 所有參與 Venturo 開發的 AI 助手與開發者

---

## 核心願景

**Venturo 不只是一套 ERP 系統，而是一個完整的旅遊業數位生態系統。**

我們的目標是打造一個「旅行社內部營運」與「旅客外部體驗」完美銜接的平台，讓每一趟旅程從報價、訂購、出發到回憶，都能流暢且精彩。

---

## 雙平台架構

Venturo 由兩個緊密連結的系統組成：

```
┌─────────────────────────────────────────────────────────────────────┐
│                         VENTURO 生態系統                              │
├─────────────────────────────┬───────────────────────────────────────┤
│                             │                                        │
│     venturo-erp             │           venturo-online               │
│     (內部營運)               │           (會員體驗)                    │
│                             │                                        │
│  ┌─────────────────────┐   │   ┌─────────────────────────────┐     │
│  │ 旅遊團管理          │   │   │ 會員入口                    │     │
│  │ 訂單處理            │   │   │ 行程瀏覽                    │     │
│  │ 客戶關係            │   │   │ 線上報名                    │     │
│  │ 簽證辦理            │   │   │ 付款流程                    │     │
│  │ 財務會計            │   │   │ 旅途日誌                    │     │
│  │ 人資管理            │◄──┼──►│ 照片牆                      │     │
│  │ 供應商管理          │   │   │ 旅遊回憶                    │     │
│  │ 報價/行程設計       │   │   │ 團員互動                    │     │
│  │ 行銷素材            │   │   │ 推薦分享                    │     │
│  └─────────────────────┘   │   └─────────────────────────────┘     │
│                             │                                        │
│       員工專用               │            旅客專用                     │
│                             │                                        │
└─────────────────────────────┴───────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │     Supabase        │
                    │   (共享資料層)       │
                    │                     │
                    │  - 旅遊團資料       │
                    │  - 訂單/會員        │
                    │  - 行程表           │
                    │  - 照片/回憶        │
                    │  - 即時同步         │
                    └─────────────────────┘
```

### 1. venturo-erp（內部營運系統）

**定位**：旅行社員工的日常工作平台

**核心功能**：
- **旅遊團管理**：從規劃到出發的完整生命週期
- **訂單處理**：報價→簽約→收款→出團
- **客戶關係**：客戶資料、聯繫紀錄、歷史訂單
- **簽證辦理**：護照掃描、簽證申請追蹤
- **財務會計**：收款、請款、傳票、報表
- **人資管理**：員工、考勤、請假、薪資
- **供應商管理**：機票、住宿、地接成本
- **報價/行程**：快速報價、詳細行程設計
- **行銷素材**：圖庫、設計工具

**技術特色**：
- Next.js 16 + React 19 + TypeScript
- Zustand 狀態管理
- 莫蘭迪色系 UI 設計
- 多租戶 (workspace) 架構

### 2. venturo-online（會員體驗系統）

**定位**：旅客的旅遊入口與回憶平台

**核心功能**：
- **會員入口**：註冊、登入、個人資料
- **行程瀏覽**：查看即將出發的行程
- **線上報名**：選團、填資料、付款
- **旅途日誌**：GPS 軌跡、景點打卡
- **照片牆**：團員共享照片、相簿
- **旅遊回憶**：行程回顧、紀念冊
- **團員互動**：聊天室、群組通知
- **推薦分享**：推薦朋友、分享連結

**技術特色**：
- PWA 支援（可安裝到手機桌面）
- 響應式設計（手機優先）
- 離線快取（旅途中無網路時可用）
- 即時通知（Supabase Realtime）

---

## 價值飛輪：從營運到體驗的正向循環

```
    ┌──────────────────────────────────────────────────────────────┐
    │                                                              │
    ▼                                                              │
┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐│
│  設計   │───►│  銷售   │───►│  出發   │───►│  回憶   │───►│  推薦   ││
│ 行程    │    │ 報名    │    │ 服務    │    │ 沉澱    │    │ 裂變    ││
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘│
    │              │              │              │              │  │
    │              │              │              │              │  │
    ▼              ▼              ▼              ▼              ▼  │
┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐│
│ ERP    │    │ ERP+   │    │ Online │    │ Online │    │ Online ││
│ 行程表  │    │ Online │    │ 日誌   │    │ 照片牆  │    │ 分享    ││
│ 報價單  │    │ 訂單   │    │ 打卡   │    │ 相簿   │    │ 推薦    ││
└────────┘    └────────┘    └────────┘    └────────┘    └────────┘│
                                                               │  │
                                                               └──┘
                                                          新客戶加入
```

### 飛輪五階段

1. **設計**（ERP）
   - 員工在 ERP 設計行程、製作報價單
   - 上傳景點照片、設定每日行程

2. **銷售**（ERP + Online）
   - 客戶在 Online 瀏覽行程、線上報名
   - ERP 自動收到訂單、處理簽約收款

3. **出發**（Online）
   - 旅客使用 Online App 查看行程
   - 領隊發送通知、團員互動聊天

4. **回憶**（Online）
   - 旅途中上傳照片、GPS 軌跡自動記錄
   - 回國後生成精美回憶相簿

5. **推薦**（Online → ERP）
   - 旅客分享回憶連結給親友
   - 親友點擊 → 變成新客戶 → 飛輪再轉

---

## 資料流向

### ERP → Online（營運資料推送）

| ERP 資料 | Online 呈現 |
|---------|------------|
| 旅遊團 (tours) | 會員行程列表 |
| 行程表 (itineraries) | 每日行程詳情 |
| 訂單成員 (order_members) | 團員名單 |
| 景點 (attractions) | 打卡地點 |
| 領隊通知 | 即時推播 |

### Online → ERP（體驗資料回流）

| Online 資料 | ERP 用途 |
|------------|---------|
| 會員註冊 | 客戶名單 |
| 線上報名 | 自動建立訂單 |
| 付款記錄 | 收款對帳 |
| 照片上傳 | 行銷素材庫 |
| 滿意度評價 | 品質改善 |

### 共享快取機制

為了確保會員登入速度，我們採用「寫入時計算」的快取策略：

```sql
-- 當 ERP 更新訂單成員時，自動更新快取
CREATE TRIGGER trigger_refresh_tour_cache
AFTER INSERT OR UPDATE ON order_members
FOR EACH ROW
EXECUTE FUNCTION refresh_traveler_tour_cache();
```

會員登入時直接讀取快取表，避免即時 JOIN 造成延遲。

---

## 共享基礎設施

### 1. Supabase 資料庫

兩個系統共用同一個 Supabase 專案：

```
pfqvdacxowpgfamuvnsn.supabase.co
├── ERP 操作 → 業務資料 CRUD
├── Online 讀取 → 會員查詢行程
├── Realtime → 即時通知同步
└── Storage → 照片/文件共享
```

### 2. RLS 資料隔離

```sql
-- ERP 員工：看自己公司的資料
CREATE POLICY "erp_workspace_access" ON tours
FOR ALL USING (workspace_id = get_current_user_workspace());

-- Online 會員：只看自己參加的行程
CREATE POLICY "member_tour_access" ON tours
FOR SELECT USING (
  id IN (
    SELECT tour_id FROM order_members
    WHERE identity_number = auth.jwt()->>'sub'
  )
);
```

### 3. 共用服務

| 服務 | 用途 |
|-----|------|
| LinkPay | 線上金流（ERP+Online 共用） |
| OCR 服務 | 護照辨識 |
| 圖片壓縮 | 照片上傳優化 |
| Email | 通知信件 |

---

## 開發協作規範

### 跨系統修改注意事項

當修改會影響兩個系統的資料結構時：

1. **先修改 ERP**（主要資料來源）
2. **同步 Migration** 到共享資料庫
3. **更新 Online** 的讀取邏輯
4. **測試雙向同步**

### 命名一致性

| ERP 表格 | Online 呈現 | 說明 |
|---------|------------|------|
| `tours` | 我的行程 | 旅遊團 |
| `itineraries` | 每日行程 | 行程表 |
| `order_members` | 團員 | 訂單成員 |
| `attractions` | 景點 | 打卡地點 |

### API 約定

ERP 和 Online 都直接操作 Supabase，無需中間 API 層：

```typescript
// ERP 建立訂單
await supabase.from('orders').insert({ ... })

// Online 讀取行程（自動被 RLS 過濾）
await supabase.from('tours').select('*, itineraries(*)')
```

---

## 開發優先級

### ERP 優先（目前階段）

ERP 是業務核心，優先完善：
- 完整的團務流程
- 財務會計系統
- 人資管理
- 穩定的資料結構

### Online 配合（次要階段）

Online 依賴 ERP 資料，需等 ERP 穩定後：
- 會員入口
- 行程展示
- 線上報名
- 照片/回憶功能

---

## 給 AI 助手的重要提醒

1. **理解雙平台關係**
   - ERP 是資料來源，Online 是資料呈現
   - 修改資料結構要考慮對 Online 的影響

2. **資料庫是共享的**
   - 同一個 Supabase 專案
   - 共用 tables、functions、triggers

3. **RLS 區分存取**
   - ERP 員工看 workspace 資料
   - Online 會員看自己的行程

4. **快取優先**
   - 會員登入要快
   - 使用「寫入時計算」策略

5. **漸進式開發**
   - ERP 功能先穩定
   - Online 功能逐步添加

---

## 相關文件

| 文件 | 位置 | 說明 |
|-----|------|------|
| SITEMAP.md | `/Users/williamchien/Projects/SITEMAP.md` | 完整系統地圖 |
| CLAUDE.md | `.claude/CLAUDE.md` | Claude 工作規範 |
| ARCHITECTURE_STANDARDS.md | `docs/` | 架構規範 |
| venturo-online | `/Users/williamchien/Projects/venturo-online` | Online 專案目錄 |

---

**這份文件定義了 Venturo 的核心願景。在開發任何功能前，請確保你理解這個雙平台架構的全貌。**
