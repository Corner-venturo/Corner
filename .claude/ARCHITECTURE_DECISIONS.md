# 架構決定記錄

## 2026-02-22 行程表架構重設計

### 核心：一個團、一份資料、四個面向

行程表是唯一源頭，報價/需求確認/領隊回填都是同一份資料的不同面向。

```
行程表（唯一源頭）
├─→ 報價面向（成本/售價）
├─→ 需求面向（發給供應商）
├─→ 確認面向（供應商回覆）
└─→ 回填面向（領隊出團後填寫）
```

### 移除的概念
- ❌ 版本管理 — 一個團就一份，不需要版本
- ❌ 提案（作為獨立功能）— 開團且什麼都沒做就是提案

### 團生命週期（5 個狀態）

```
開團 → 待出發 → 已出發 → 待結團 → 已結團
```

| 狀態 | 觸發 | 能做什麼 |
|------|------|---------|
| 開團 | 建立團 | 填行程、報價、給客人看、接訂單 |
| 待出發 | 收到合約（線上自動/紙本手動） | 發需求、收確認、分房、報到 |
| 已出發 | 出發日到了 | 領隊回填、即時狀況 |
| 待結團 | 回來了 | 對帳、請款、收款、算獎金 |
| 已結團 | 帳對完 | 唯讀 |

### 行程表 UI：上下結構

- **上半部**：團層級（標題、天數可調、航班選擇、住宿按鈕）
- **下半部**：每日分頁 Day 1 | Day 2 | Day 3 | ...
- **住宿**：浮動卡片 Dialog，Combobox 搜尋/手打，第二晚起可勾「續住」

### Combobox 資料流

飯店/餐廳/景點共用邏輯：
1. 搜尋系統內資料 → 有就選
2. 沒有 → 先存文字
3. 需求單確認 → 正式建檔到 DB
4. 自然累積歷史報價資料

### 報價單與行程表

- 行程表每個項目自動帶入報價單（包含免費景點）
- 報價單帶入後可獨立微調（不反向影響行程表）
- 客人確認後再回去更新行程表

### 團列表

操作欄精簡，只留 ⋮（封存/刪除）。快捷動作移到總覽 tab。

### 狀態顏色

統一從 `src/lib/status-config.ts` 取得，使用莫蘭迪色系。
規範見 `docs/COMPONENT_GUIDE.md` 底部。
