#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” åŸ·è¡Œ pre-commit ä»£ç¢¼å“è³ªæª¢æŸ¥..."
echo "================================"

# æª¢æŸ¥æ–‡ä»¶å¤§å°
echo ""
echo "ğŸ“ æª¢æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶..."
if ! ./scripts/check-file-size.sh; then
  echo "âŒ æ–‡ä»¶å¤§å°æª¢æŸ¥å¤±æ•—ï¼è«‹æ‹†åˆ†è¶…å¤§æ–‡ä»¶å¾Œå†æäº¤ã€‚"
  exit 1
fi

# æª¢æŸ¥ any é¡å‹ä½¿ç”¨
echo ""
echo "ğŸ” æª¢æŸ¥ TypeScript any é¡å‹ä½¿ç”¨..."
if ! ./scripts/check-any-usage.sh; then
  echo "âŒ any é¡å‹æª¢æŸ¥å¤±æ•—ï¼è«‹ä½¿ç”¨æ˜ç¢ºçš„é¡å‹å®šç¾©ã€‚"
  exit 1
fi

# TypeScript é¡å‹æª¢æŸ¥
echo ""
echo "ğŸ”§ åŸ·è¡Œ TypeScript é¡å‹æª¢æŸ¥..."
if ! npm run type-check --silent; then
  echo "âŒ TypeScript é¡å‹æª¢æŸ¥å¤±æ•—ï¼"
  exit 1
fi

# ESLint æª¢æŸ¥ï¼ˆåªæª¢æŸ¥æš«å­˜å€çš„æ–‡ä»¶ï¼‰
echo ""
echo "ğŸ“‹ åŸ·è¡Œ ESLint æª¢æŸ¥..."
if ! npm run lint --silent; then
  echo "âŒ ESLint æª¢æŸ¥å¤±æ•—ï¼"
  echo "ğŸ’¡ æç¤ºï¼šåŸ·è¡Œ 'npm run lint' æŸ¥çœ‹è©³ç´°éŒ¯èª¤"
  exit 1
fi

echo ""
echo "================================"
echo "âœ… æ‰€æœ‰ pre-commit æª¢æŸ¥é€šéï¼"
echo ""
