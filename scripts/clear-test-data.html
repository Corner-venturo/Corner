<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>æ¸…ç†æ¸¬è©¦è³‡æ–™</title>
</head>
<body>
  <h1>æ¸…ç† IndexedDB æ¸¬è©¦è³‡æ–™</h1>
  <button onclick="clearTestData()">æ¸…ç†æ¸¬è©¦è³‡æ–™</button>
  <pre id="output"></pre>

  <script>
    const log = (msg) => {
      const output = document.getElementById('output');
      output.textContent += msg + '\n';
      console.log(msg);
    };

    async function clearTestData() {
      try {
        log('ğŸ”„ é–‹å§‹æ¸…ç†æ¸¬è©¦è³‡æ–™...');

        // é–‹å•Ÿè³‡æ–™åº«
        const dbRequest = indexedDB.open('venturo-db', 2);

        dbRequest.onerror = () => {
          log('âŒ ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ' + dbRequest.error);
        };

        dbRequest.onsuccess = async () => {
          const db = dbRequest.result;
          log('âœ… è³‡æ–™åº«å·²é–‹å•Ÿ');

          try {
            // åˆªé™¤ suppliers æ¸¬è©¦è³‡æ–™
            const suppliersTransaction = db.transaction('suppliers', 'readwrite');
            const suppliersStore = suppliersTransaction.objectStore('suppliers');
            const supplierDeleteRequest = suppliersStore.delete('80bf93fb-6d08-47ed-bd69-28848740d48e');

            await new Promise((resolve, reject) => {
              supplierDeleteRequest.onsuccess = () => {
                log('âœ… å·²åˆªé™¤ suppliers æ¸¬è©¦è³‡æ–™');
                resolve();
              };
              supplierDeleteRequest.onerror = () => {
                log('âš ï¸ suppliers æ¸¬è©¦è³‡æ–™å¯èƒ½ä¸å­˜åœ¨');
                resolve(); // ç¹¼çºŒåŸ·è¡Œ
              };
            });

            // åˆªé™¤ itineraries æ¸¬è©¦è³‡æ–™
            const itinerariesTransaction = db.transaction('itineraries', 'readwrite');
            const itinerariesStore = itinerariesTransaction.objectStore('itineraries');
            const itineraryDeleteRequest = itinerariesStore.delete('4f103864-5140-4230-a97c-adfbefc4c17d');

            await new Promise((resolve, reject) => {
              itineraryDeleteRequest.onsuccess = () => {
                log('âœ… å·²åˆªé™¤ itineraries æ¸¬è©¦è³‡æ–™');
                resolve();
              };
              itineraryDeleteRequest.onerror = () => {
                log('âš ï¸ itineraries æ¸¬è©¦è³‡æ–™å¯èƒ½ä¸å­˜åœ¨');
                resolve(); // ç¹¼çºŒåŸ·è¡Œ
              };
            });

            log('\nâœ… æ¸…ç†å®Œæˆï¼è«‹é‡æ–°æ•´ç†é é¢');

          } catch (error) {
            log('âŒ éŒ¯èª¤: ' + error.message);
          } finally {
            db.close();
          }
        };

      } catch (error) {
        log('âŒ éŒ¯èª¤: ' + error.message);
      }
    }
  </script>
</body>
</html>
