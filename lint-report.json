[{"filePath":"/Users/william/Projects/Corner/next-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/check-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/check-messages-schema.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/check-schema-diff.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getSupabaseFields' is defined but never used. Allowed unused vars must match /^_/u.","line":74,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tableName' is defined but never used. Allowed unused args must match /^_/u.","line":74,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Schema å·®ç•°æª¢æŸ¥å·¥å…·\n * æ¯”å° IndexedDB schemasã€å‰ç«¯ typesã€Supabase types\n */\n\nimport { TABLE_SCHEMAS } from '../src/lib/db/schemas';\nimport type { Database } from '../src/lib/supabase/types';\n\n// å‰ç«¯å¯¦éš›ä½¿ç”¨çš„å‹åˆ¥ï¼ˆå¾ stores/types.tsï¼‰\nconst FRONTEND_TYPES = {\n  employees: [\n    'id', 'employee_number', 'english_name', 'display_name', 'chinese_name',\n    'personal_info', 'job_info', 'salary_info', 'permissions', 'roles',\n    'attendance', 'contracts', 'status', 'avatar', 'password_hash',\n    'last_password_change', 'must_change_password', 'failed_login_attempts',\n    'last_failed_login', 'created_at', 'updated_at'\n  ],\n  tours: [\n    'id', 'code', 'name', 'departure_date', 'return_date', 'status',\n    'location', 'price', 'max_participants', 'current_participants',\n    'contract_status', 'total_revenue', 'total_cost', 'profit',\n    'quote_id', 'quote_cost_structure', 'archived', 'description',\n    'outboundFlight', 'returnFlight', 'created_at', 'updated_at'\n  ],\n  orders: [\n    'id', 'order_number', 'tour_id', 'code', 'tour_name', 'customer_id',\n    'contact_person', 'sales_person', 'assistant', 'member_count',\n    'status', 'payment_status', 'total_amount', 'paid_amount',\n    'remaining_amount', 'notes', 'created_at', 'updated_at'\n  ],\n  members: [\n    'id', 'order_id', 'tour_id', 'name', 'name_en', 'birthday',\n    'passport_number', 'passport_expiry', 'id_number', 'gender', 'age',\n    'phone', 'email', 'emergency_contact', 'emergency_phone',\n    'dietary_restrictions', 'medical_conditions', 'room_preference',\n    'assigned_room', 'is_child_no_bed', 'reservation_code',\n    'add_ons', 'refunds', 'custom_fields', 'notes', 'created_at', 'updated_at'\n  ],\n  customers: [\n    'id', 'code', 'name', 'phone', 'email', 'address', 'notes',\n    'is_vip', 'is_active', 'created_at', 'updated_at'\n  ],\n  quotes: [\n    'id', 'quote_number', 'name', 'status', 'tour_id', 'customer_name',\n    'contact_person', 'contact_phone', 'contact_email', 'group_size',\n    'accommodation_days', 'requirements', 'budget_range', 'valid_until',\n    'payment_terms', 'categories', 'total_cost', 'version', 'versions',\n    'created_at', 'updated_at'\n  ],\n  suppliers: [\n    'id', 'code', 'name', 'type', 'contact', 'bank_info', 'price_list',\n    'status', 'note', 'created_at', 'updated_at'\n  ],\n  todos: [\n    'id', 'title', 'priority', 'deadline', 'status', 'completed',\n    'creator', 'assignee', 'visibility', 'related_items', 'sub_tasks',\n    'notes', 'enabled_quick_actions', 'needs_creator_notification',\n    'type', 'parent_id', 'project_id', 'created_at', 'updated_at'\n  ],\n  tour_addons: [\n    'id', 'tour_id', 'name', 'price', 'description', 'is_active',\n    'created_at', 'updated_at'\n  ],\n  tour_refunds: [\n    'id', 'tour_id', 'order_id', 'order_number', 'member_name',\n    'reason', 'amount', 'status', 'applied_date', 'processed_date',\n    'notes', 'created_at', 'updated_at'\n  ],\n};\n\n// Supabase å‹åˆ¥å®šç¾©ï¼ˆå¾ types.ts æå–ï¼‰\ntype SupabaseTables = Database['public']['Tables'];\n\nfunction getSupabaseFields(tableName: keyof SupabaseTables): string[] {\n  // é€™è£¡éœ€è¦æ‰‹å‹•åˆ—å‡ºï¼ˆå› ç‚º TypeScript å‹åˆ¥åœ¨ runtime ä¸å¯ç”¨ï¼‰\n  // æˆ–è€…å¾ Supabase å¯¦éš›æŸ¥è©¢ schema\n  return [];\n}\n\nfunction compareSchemas() {\n  console.log('ğŸ” é–‹å§‹æ¯”å° Schema...\\n');\n\n  const results = {\n    missing_in_supabase: {} as Record<string, string[]>,\n    missing_in_frontend: {} as Record<string, string[]>,\n    missing_tables: [] as string[],\n    extra_tables: [] as string[],\n  };\n\n  // æª¢æŸ¥ç¼ºå°‘çš„è¡¨æ ¼\n  const frontendTables = Object.keys(FRONTEND_TYPES);\n  const supabaseTables = TABLE_SCHEMAS.map(s => s.name);\n\n  frontendTables.forEach(table => {\n    if (!supabaseTables.includes(table)) {\n      results.missing_tables.push(table);\n    }\n  });\n\n  // ç”Ÿæˆå ±å‘Š\n  console.log('ğŸ“Š æª¢æŸ¥çµæœï¼š\\n');\n\n  if (results.missing_tables.length > 0) {\n    console.log('âŒ Supabase ç¼ºå°‘çš„è¡¨æ ¼ï¼š');\n    results.missing_tables.forEach(table => {\n      console.log(`   - ${table}`);\n    });\n    console.log('');\n  }\n\n  Object.entries(FRONTEND_TYPES).forEach(([table, fields]) => {\n    console.log(`\\nğŸ“‹ ${table}:`);\n    console.log(`   å‰ç«¯æ¬„ä½æ•¸: ${fields.length}`);\n    fields.forEach(field => {\n      console.log(`   - ${field}`);\n    });\n  });\n}\n\ncompareSchemas();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/clean-invalid-tours.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[792,795],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[792,795],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ¸…ç†ç„¡æ•ˆçš„æ—…éŠåœ˜è³‡æ–™\n * ç”¨é€”ï¼šç§»é™¤ departure_date ç„¡æ•ˆæˆ–ç©ºç™½çš„æ—…éŠåœ˜\n */\n\nimport { openDB } from 'idb';\n\nasync function cleanInvalidTours() {\n  console.log('ğŸ” é–‹å§‹æƒæç„¡æ•ˆçš„æ—…éŠåœ˜è³‡æ–™...');\n\n  try {\n    // é–‹å•Ÿ IndexedDB\n    const db = await openDB('venturo-db', 1);\n\n    // è®€å–æ‰€æœ‰æ—…éŠåœ˜\n    const allTours = await db.getAll('tours');\n\n    console.log(`ğŸ“Š ç¸½å…±æ‰¾åˆ° ${allTours.length} ç­†æ—…éŠåœ˜è³‡æ–™`);\n\n    // æ‰¾å‡ºç„¡æ•ˆçš„æ—…éŠåœ˜ï¼ˆdeparture_date ç©ºç™½æˆ–ç„¡æ•ˆï¼‰\n    const invalidTours = allTours.filter((tour: any) => {\n      if (!tour.departure_date) return true; // ç©ºç™½\n      const date = new Date(tour.departure_date);\n      return isNaN(date.getTime()); // ç„¡æ•ˆæ—¥æœŸ\n    });\n\n    if (invalidTours.length === 0) {\n      console.log('âœ… æ²’æœ‰æ‰¾åˆ°ç„¡æ•ˆçš„æ—…éŠåœ˜è³‡æ–™');\n      return;\n    }\n\n    console.log(`âŒ æ‰¾åˆ° ${invalidTours.length} ç­†ç„¡æ•ˆçš„æ—…éŠåœ˜è³‡æ–™ï¼š`);\n    invalidTours.forEach((tour: any) => {\n      console.log(`  - ID: ${tour.id}, åç¨±: ${tour.name || '(ç„¡åç¨±)'}, å‡ºç™¼æ—¥æœŸ: ${tour.departure_date || '(ç©ºç™½)'}`);\n    });\n\n    // ç¢ºèªæ˜¯å¦è¦åˆªé™¤\n    const confirmed = confirm(`ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™ ${invalidTours.length} ç­†ç„¡æ•ˆè³‡æ–™å—ï¼Ÿ`);\n\n    if (!confirmed) {\n      console.log('âŒ ä½¿ç”¨è€…å–æ¶ˆæ“ä½œ');\n      return;\n    }\n\n    // æ°¸ä¹…åˆªé™¤\n    console.log('ğŸ—‘ï¸ é–‹å§‹åˆªé™¤...');\n    for (const tour of invalidTours) {\n      await db.delete('tours', tour.id);\n      console.log(`âœ… å·²åˆªé™¤: ${tour.id}`);\n    }\n\n    console.log(`âœ… æˆåŠŸæ¸…é™¤ ${invalidTours.length} ç­†ç„¡æ•ˆè³‡æ–™ï¼`);\n    console.log('ğŸ’¡ è«‹é‡æ–°æ•´ç†é é¢ä»¥æŸ¥çœ‹çµæœ');\n\n  } catch (error) {\n    console.error('âŒ æ¸…ç†å¤±æ•—:', error);\n  }\n}\n\n// åŸ·è¡Œæ¸…ç†\ncleanInvalidTours();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/cleanup-workspace.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/comprehensive-analysis.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/create-tour-channels.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/diagnose-id-strategy.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/fix-author-id-type.js","messages":[],"suppressedMessages":[{"ruleId":"no-unused-vars","severity":2,"message":"'supabase' is assigned a value but never used.","line":14,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/fix-db-issues.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[239,242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[239,242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7014,7017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7014,7017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7019,7022],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7019,7022],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9662,9665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9662,9665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\n/**\n * ä¿®å¾© IndexedDB å•é¡Œè…³æœ¬\n * è™•ç†ï¼š\n * 1. é‡è¤‡ç´¢å¼•å•é¡Œ\n * 2. è³‡æ–™è¡¨ä¸å­˜åœ¨å•é¡Œ\n * 3. è³‡æ–™åº«ç‰ˆæœ¬å‡ç´šå•é¡Œ\n */\n\nconst DB_NAME = 'VenturoOfflineDB';\nconst CURRENT_VERSION = 2;\n\ninterface DBFixResult {\n  success: boolean;\n  message: string;\n  details?: any;\n}\n\nclass DatabaseFixer {\n  /**\n   * ä¸»è¦ä¿®å¾©å‡½æ•¸\n   */\n  static async fix(): Promise<DBFixResult> {\n    console.log('ğŸ”§ é–‹å§‹ä¿®å¾©è³‡æ–™åº«å•é¡Œ...\\n');\n\n    try {\n      // 1. æª¢æŸ¥ä¸¦å‡ç´šè³‡æ–™åº«ç‰ˆæœ¬\n      console.log('ğŸ“Š æª¢æŸ¥è³‡æ–™åº«ç‰ˆæœ¬...');\n      const versionResult = await this.checkAndUpgradeVersion();\n      console.log(versionResult.message);\n\n      // 2. æª¢æŸ¥ regions è¡¨æ˜¯å¦å­˜åœ¨\n      console.log('\\nğŸ“Š æª¢æŸ¥ regions è¡¨...');\n      const regionsResult = await this.checkRegionsTable();\n      console.log(regionsResult.message);\n\n      // 3. æ¸…ç†é‡è¤‡è³‡æ–™\n      console.log('\\nğŸ§¹ æ¸…ç†é‡è¤‡è³‡æ–™...');\n      const cleanupResult = await this.cleanupDuplicates();\n      console.log(cleanupResult.message);\n\n      // 4. é©—è­‰ä¿®å¾©çµæœ\n      console.log('\\nâœ… é©—è­‰ä¿®å¾©çµæœ...');\n      const validationResult = await this.validateFix();\n      console.log(validationResult.message);\n\n      console.log('\\nâœ¨ è³‡æ–™åº«ä¿®å¾©å®Œæˆï¼');\n\n      return {\n        success: true,\n        message: 'è³‡æ–™åº«ä¿®å¾©æˆåŠŸ',\n        details: {\n          version: versionResult,\n          regions: regionsResult,\n          cleanup: cleanupResult,\n          validation: validationResult\n        }\n      };\n    } catch (error) {\n      console.error('âŒ ä¿®å¾©å¤±æ•—:', error);\n      return {\n        success: false,\n        message: 'è³‡æ–™åº«ä¿®å¾©å¤±æ•—',\n        details: error\n      };\n    }\n  }\n\n  /**\n   * æª¢æŸ¥ä¸¦å‡ç´šè³‡æ–™åº«ç‰ˆæœ¬\n   */\n  private static checkAndUpgradeVersion(): Promise<DBFixResult> {\n    return new Promise((resolve, reject) => {\n      // å…ˆç²å–ç•¶å‰ç‰ˆæœ¬\n      const versionRequest = indexedDB.open(DB_NAME);\n      \n      versionRequest.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        const currentVersion = db.version;\n        db.close();\n\n        if (currentVersion < CURRENT_VERSION) {\n          // éœ€è¦å‡ç´š\n          console.log(`  éœ€è¦å‡ç´š: v${currentVersion} -> v${CURRENT_VERSION}`);\n          \n          const upgradeRequest = indexedDB.open(DB_NAME, CURRENT_VERSION);\n          \n          upgradeRequest.onupgradeneeded = (event) => {\n            const db = (event.target as IDBOpenDBRequest).result;\n            \n            // å¦‚æœ regions è¡¨ä¸å­˜åœ¨ï¼Œå»ºç«‹å®ƒ\n            if (!db.objectStoreNames.contains('regions')) {\n              console.log('  å»ºç«‹ regions è¡¨...');\n              const regionsStore = db.createObjectStore('regions', {\n                keyPath: 'id',\n                autoIncrement: false,\n              });\n\n              // å»ºç«‹ç´¢å¼•\n              regionsStore.createIndex('code', 'code', { unique: true });\n              regionsStore.createIndex('name', 'name', { unique: false });\n              regionsStore.createIndex('status', 'status', { unique: false });\n              regionsStore.createIndex('is_active', 'is_active', { unique: false });\n              regionsStore.createIndex('created_at', 'created_at', { unique: false });\n              regionsStore.createIndex('updated_at', 'updated_at', { unique: false });\n              regionsStore.createIndex('sync_status', 'sync_status', { unique: false });\n            }\n          };\n\n          upgradeRequest.onsuccess = () => {\n            upgradeRequest.result.close();\n            resolve({\n              success: true,\n              message: `  âœ… è³‡æ–™åº«å·²å‡ç´šåˆ° v${CURRENT_VERSION}`\n            });\n          };\n\n          upgradeRequest.onerror = () => {\n            reject(new Error(`å‡ç´šå¤±æ•—: ${upgradeRequest.error?.message}`));\n          };\n        } else {\n          resolve({\n            success: true,\n            message: `  âœ… è³‡æ–™åº«å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ v${currentVersion}`\n          });\n        }\n      };\n\n      versionRequest.onerror = () => {\n        reject(new Error(`ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ${versionRequest.error?.message}`));\n      };\n    });\n  }\n\n  /**\n   * æª¢æŸ¥ regions è¡¨æ˜¯å¦å­˜åœ¨\n   */\n  private static checkRegionsTable(): Promise<DBFixResult> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, CURRENT_VERSION);\n\n      request.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        \n        if (db.objectStoreNames.contains('regions')) {\n          // è¨ˆç®— regions è¡¨ä¸­çš„è³‡æ–™ç­†æ•¸\n          const transaction = db.transaction(['regions'], 'readonly');\n          const objectStore = transaction.objectStore('regions');\n          const countRequest = objectStore.count();\n\n          countRequest.onsuccess = () => {\n            db.close();\n            resolve({\n              success: true,\n              message: `  âœ… regions è¡¨å­˜åœ¨ï¼ŒåŒ…å« ${countRequest.result} ç­†è³‡æ–™`\n            });\n          };\n\n          countRequest.onerror = () => {\n            db.close();\n            reject(new Error('ç„¡æ³•è¨ˆç®— regions è³‡æ–™ç­†æ•¸'));\n          };\n        } else {\n          db.close();\n          resolve({\n            success: false,\n            message: '  âš ï¸ regions è¡¨ä¸å­˜åœ¨ï¼ˆéœ€è¦é‡æ–°å»ºç«‹ï¼‰'\n          });\n        }\n      };\n\n      request.onerror = () => {\n        reject(new Error(`ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ${request.error?.message}`));\n      };\n    });\n  }\n\n  /**\n   * æ¸…ç†é‡è¤‡è³‡æ–™\n   */\n  private static async cleanupDuplicates(): Promise<DBFixResult> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, CURRENT_VERSION);\n\n      request.onsuccess = async (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        \n        // éœ€è¦æª¢æŸ¥çš„è¡¨å’Œå”¯ä¸€ç´¢å¼•\n        const tablesToCheck = [\n          { table: 'regions', uniqueField: 'code' },\n          { table: 'tours', uniqueField: 'code' },\n          { table: 'orders', uniqueField: 'code' },\n          { table: 'customers', uniqueField: 'code' },\n        ];\n\n        let totalCleaned = 0;\n\n        for (const { table, uniqueField } of tablesToCheck) {\n          if (!db.objectStoreNames.contains(table)) {\n            console.log(`    è·³é ${table} (ä¸å­˜åœ¨)`);\n            continue;\n          }\n\n          try {\n            const cleaned = await this.cleanTableDuplicates(db, table, uniqueField);\n            totalCleaned += cleaned;\n            if (cleaned > 0) {\n              console.log(`    æ¸…ç† ${table}: ç§»é™¤ ${cleaned} ç­†é‡è¤‡è³‡æ–™`);\n            }\n          } catch (error) {\n            console.error(`    ${table} æ¸…ç†å¤±æ•—:`, error);\n          }\n        }\n\n        db.close();\n        resolve({\n          success: true,\n          message: `  âœ… æ¸…ç†å®Œæˆï¼Œå…±ç§»é™¤ ${totalCleaned} ç­†é‡è¤‡è³‡æ–™`\n        });\n      };\n\n      request.onerror = () => {\n        reject(new Error(`ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ${request.error?.message}`));\n      };\n    });\n  }\n\n  /**\n   * æ¸…ç†å–®å€‹è¡¨çš„é‡è¤‡è³‡æ–™\n   */\n  private static cleanTableDuplicates(\n    db: IDBDatabase, \n    tableName: string, \n    uniqueField: string\n  ): Promise<number> {\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const getAllRequest = objectStore.getAll();\n\n      getAllRequest.onsuccess = async () => {\n        const records = getAllRequest.result;\n        const seen = new Map<any, any>();\n        const duplicates: string[] = [];\n\n        // æ‰¾å‡ºé‡è¤‡è³‡æ–™\n        for (const record of records) {\n          const key = record[uniqueField];\n          if (key && seen.has(key)) {\n            // ä¿ç•™è¼ƒæ–°çš„è³‡æ–™ï¼ˆæ ¹æ“š updated_at æˆ– created_atï¼‰\n            const existing = seen.get(key);\n            const existingTime = new Date(existing.updated_at || existing.created_at || 0).getTime();\n            const currentTime = new Date(record.updated_at || record.created_at || 0).getTime();\n            \n            if (currentTime > existingTime) {\n              duplicates.push(existing.id);\n              seen.set(key, record);\n            } else {\n              duplicates.push(record.id);\n            }\n          } else if (key) {\n            seen.set(key, record);\n          }\n        }\n\n        // åˆªé™¤é‡è¤‡è³‡æ–™\n        if (duplicates.length > 0) {\n          const deleteTransaction = db.transaction([tableName], 'readwrite');\n          const deleteStore = deleteTransaction.objectStore(tableName);\n          \n          for (const id of duplicates) {\n            deleteStore.delete(id);\n          }\n\n          deleteTransaction.oncomplete = () => {\n            resolve(duplicates.length);\n          };\n\n          deleteTransaction.onerror = () => {\n            reject(new Error(`åˆªé™¤é‡è¤‡è³‡æ–™å¤±æ•—: ${deleteTransaction.error?.message}`));\n          };\n        } else {\n          resolve(0);\n        }\n      };\n\n      getAllRequest.onerror = () => {\n        reject(new Error(`è®€å– ${tableName} å¤±æ•—`));\n      };\n    });\n  }\n\n  /**\n   * é©—è­‰ä¿®å¾©çµæœ\n   */\n  private static validateFix(): Promise<DBFixResult> {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open(DB_NAME, CURRENT_VERSION);\n\n      request.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        const issues: string[] = [];\n\n        // æª¢æŸ¥é—œéµè¡¨æ˜¯å¦å­˜åœ¨\n        const requiredTables = ['regions', 'tours', 'orders', 'customers', 'employees'];\n        for (const table of requiredTables) {\n          if (!db.objectStoreNames.contains(table)) {\n            issues.push(`ç¼ºå°‘è¡¨: ${table}`);\n          }\n        }\n\n        db.close();\n\n        if (issues.length === 0) {\n          resolve({\n            success: true,\n            message: '  âœ… è³‡æ–™åº«çµæ§‹æ­£å¸¸'\n          });\n        } else {\n          resolve({\n            success: false,\n            message: `  âš ï¸ ç™¼ç¾å•é¡Œ:\\n    - ${issues.join('\\n    - ')}`\n          });\n        }\n      };\n\n      request.onerror = () => {\n        reject(new Error(`ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ${request.error?.message}`));\n      };\n    });\n  }\n}\n\n// åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­åŸ·è¡Œ\nif (typeof window !== 'undefined') {\n  // æ·»åŠ åˆ° window å°è±¡ä»¥ä¾¿åœ¨ console ä¸­èª¿ç”¨\n  (window as any).fixDatabase = DatabaseFixer.fix;\n  console.log('ğŸ’¡ åœ¨ Console ä¸­åŸ·è¡Œ fixDatabase() ä¾†ä¿®å¾©è³‡æ–™åº«å•é¡Œ');\n} else {\n  console.log('âš ï¸ æ­¤è…³æœ¬éœ€è¦åœ¨ç€è¦½å™¨ç’°å¢ƒä¸­åŸ·è¡Œ');\n  console.log('è«‹åœ¨ç€è¦½å™¨çš„ Console ä¸­è²¼ä¸Šæ­¤è…³æœ¬ä¸¦åŸ·è¡Œ fixDatabase()');\n}\n\n// å°å‡ºä¾›å…¶ä»–æ¨¡çµ„ä½¿ç”¨\nexport default DatabaseFixer;\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/generate-complete-fix.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/generate-uuid-migration.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/scripts/restore-default-channels.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/_dev/dev-tools/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":120,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { initializeEmployeePasswords, createTestEmployees } from '@/lib/init-passwords';\nimport { useUserStore } from '@/stores/user-store';\nimport { useWorkspaceStore } from '@/stores/workspace-store';\nimport { DB_NAME } from '@/lib/db/schemas';\nimport { Shield, Users, Key, AlertTriangle, CheckCircle, Settings, Trash2, Hash } from 'lucide-react';\n\nexport default function DevToolsPage() {\n  const [isInitializing, setIsInitializing] = useState(false);\n  const [isCreatingTest, setIsCreatingTest] = useState(false);\n  const [devMode, setDevMode] = useState(process.env.NODE_ENV === 'development');\n  const [logs, setLogs] = useState<string[]>([]);\n  const { items: users } = useUserStore();\n  const { channels } = useWorkspaceStore();\n\n  // æ””æˆª console.log ä»¥é¡¯ç¤ºåœ¨é é¢ä¸Š\n  const captureLog = (callback: () => Promise<void>) => {\n    return async () => {\n      const originalLog = console.log;\n      const newLogs: string[] = [];\n      \n      console.log = (...args) => {\n        newLogs.push(args.join(' '));\n        originalLog(...args);\n      };\n\n      try {\n        await callback();\n      } finally {\n        console.log = originalLog;\n        setLogs(newLogs);\n      }\n    };\n  };\n\n  const handleInitPasswords = captureLog(async () => {\n    setIsInitializing(true);\n    try {\n      await initializeEmployeePasswords();\n    } finally {\n      setIsInitializing(false);\n    }\n  });\n\n  const handleCreateTestEmployees = captureLog(async () => {\n    setIsCreatingTest(true);\n    try {\n      await createTestEmployees();\n    } finally {\n      setIsCreatingTest(false);\n    }\n  });\n\n  const toggleDevMode = () => {\n    const newMode = !devMode;\n    setDevMode(newMode);\n    \n    if (newMode) {\n      localStorage.setItem('dev-mode', 'true');\n    } else {\n      localStorage.removeItem('dev-mode');\n    }\n    \n    setLogs([`é–‹ç™¼æ¨¡å¼å·²${newMode ? 'å•Ÿç”¨' : 'åœç”¨'}`]);\n  };\n\n  const clearAllData = () => {\n    if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {\n      localStorage.clear();\n      sessionStorage.clear();\n      indexedDB.deleteDatabase(DB_NAME);\n      setLogs(['âœ… å·²æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™ï¼Œè«‹é‡æ–°æ•´ç†é é¢']);\n    }\n  };\n\n  const clearTestData = async () => {\n    if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…ç†æ‰€æœ‰æ¸¬è©¦è³‡æ–™å—ï¼Ÿï¼ˆä¿ç•™äººè³‡ç®¡ç†è³‡æ–™ï¼‰\\n\\nå°‡æ¸…ç†ï¼š\\nâ€¢ å·¥ä½œç©ºé–“é »é“\\nâ€¢ æ—…éŠåœ˜\\nâ€¢ å ±åƒ¹å–®\\nâ€¢ è¨‚å–®\\nâ€¢ å®¢æˆ¶\\nâ€¢ å¾…è¾¦äº‹é …\\nâ€¢ IndexedDB æ‰€æœ‰è¡¨æ ¼')) {\n      const logs: string[] = [];\n\n      try {\n        // 1. æ¸…ç©ºå·¥ä½œç©ºé–“é »é“ï¼ˆä¿ç•™ä¸€èˆ¬è¨è«–ï¼‰\n        const workspaceData = localStorage.getItem('workspace-storage');\n        if (workspaceData) {\n          const data = JSON.parse(workspaceData);\n          const channelCount = data.state?.channels?.length || 0;\n          data.state.channels = [\n            {\n              id: 'channel-001',\n              workspace_id: data.state.currentWorkspace?.id || 'workspace-001',\n              name: 'ä¸€èˆ¬è¨è«–',\n              description: 'ä¸€èˆ¬äº‹å‹™è¨è«–',\n              type: 'public',\n              created_at: new Date().toISOString()\n            }\n          ];\n          data.state.messages = [];\n          localStorage.setItem('workspace-storage', JSON.stringify(data));\n          logs.push(`âœ… æ¸…ç©º ${channelCount} å€‹é »é“`);\n        }\n\n        // 2. æ¸…ç©º IndexedDB æ‰€æœ‰è¡¨æ ¼ï¼ˆä¿ç•™ employeesï¼‰\n        const db = await indexedDB.databases();\n        const venturoDb = db.find(d => d.name === DB_NAME);\n\n        if (venturoDb) {\n          const request = indexedDB.open(DB_NAME);\n          request.onsuccess = (event) => {\n            const database = (event.target as IDBOpenDBRequest).result;\n            const transaction = database.transaction(database.objectStoreNames, 'readwrite');\n\n            // æ¸…ç©ºé™¤äº† employees ä»¥å¤–çš„æ‰€æœ‰è¡¨æ ¼\n            Array.from(database.objectStoreNames).forEach(storeName => {\n              if (storeName !== 'employees') {\n                try {\n                  transaction.objectStore(storeName).clear();\n                  logs.push(`âœ… æ¸…ç©º ${storeName}`);\n                } catch (err) {\n                  logs.push(`âš ï¸ æ¸…ç©º ${storeName} å¤±æ•—`);\n                }\n              }\n            });\n\n            transaction.oncomplete = () => {\n              logs.push('âœ… IndexedDB æ¸…ç†å®Œæˆ');\n              logs.push('âš ï¸ è«‹é‡æ–°æ•´ç†é é¢ä»¥è¼‰å…¥æœ€æ–°è³‡æ–™');\n              setLogs(logs);\n            };\n          };\n        }\n\n        // 3. æ¸…ç©ºå…¶ä»– localStorage è³‡æ–™ï¼ˆä¿ç•™èªè­‰å’Œå“¡å·¥ç›¸é—œï¼‰\n        const keysToKeep = ['auth-storage', 'user-storage', 'dev-mode'];\n        const allKeys = Object.keys(localStorage);\n\n        allKeys.forEach(key => {\n          if (!keysToKeep.some(keep => key.includes(keep))) {\n            localStorage.removeItem(key);\n          }\n        });\n\n        logs.push('âœ… æ¸¬è©¦è³‡æ–™æ¸…ç†å®Œæˆ');\n        logs.push('âœ… å·²ä¿ç•™ï¼šå“¡å·¥è³‡æ–™ã€èªè­‰è³‡è¨Š');\n        setLogs(logs);\n\n      } catch (error) {\n        console.error('æ¸…ç†å¤±æ•—:', error);\n        setLogs([...logs, 'âŒ æ¸…ç†éç¨‹ç™¼ç”ŸéŒ¯èª¤']);\n      }\n    }\n  };\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* æ¨™é¡Œ */}\n        <div className=\"mb-6\">\n          <h1 className=\"text-2xl font-bold text-morandi-primary flex items-center gap-2\">\n            <Settings size={28} />\n            é–‹ç™¼è€…å·¥å…·\n          </h1>\n          <p className=\"text-morandi-secondary mt-2\">\n            ç³»çµ±åˆå§‹åŒ–å’Œæ¸¬è©¦å·¥å…·\n          </p>\n        </div>\n\n        {/* ç³»çµ±ç‹€æ…‹ */}\n        <div className=\"bg-white rounded-lg border border-border p-4 mb-6\">\n          <h2 className=\"font-semibold text-morandi-primary mb-3\">ç³»çµ±ç‹€æ…‹</h2>\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <Users size={18} className=\"text-morandi-secondary\" />\n              <span className=\"text-sm text-morandi-secondary\">å“¡å·¥æ•¸é‡ï¼š</span>\n              <span className=\"font-semibold text-morandi-primary\">{users.length}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Hash size={18} className=\"text-morandi-secondary\" />\n              <span className=\"text-sm text-morandi-secondary\">é »é“æ•¸é‡ï¼š</span>\n              <span className=\"font-semibold text-morandi-primary\">{channels.length}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Shield size={18} className=\"text-morandi-secondary\" />\n              <span className=\"text-sm text-morandi-secondary\">é–‹ç™¼æ¨¡å¼ï¼š</span>\n              <span className={`font-semibold ${devMode ? 'text-green-600' : 'text-red-600'}`}>\n                {devMode ? 'å·²å•Ÿç”¨' : 'å·²åœç”¨'}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* å·¥å…·æŒ‰éˆ• */}\n        <div className=\"space-y-4\">\n          {/* å¯†ç¢¼ç®¡ç† */}\n          <div className=\"bg-white rounded-lg border border-border p-4\">\n            <h3 className=\"font-semibold text-morandi-primary mb-3 flex items-center gap-2\">\n              <Key size={18} />\n              å¯†ç¢¼ç®¡ç†\n            </h3>\n            <div className=\"space-y-3\">\n              <div>\n                <Button\n                  onClick={handleInitPasswords}\n                  disabled={isInitializing}\n                  className=\"w-full\"\n                >\n                  {isInitializing ? 'åˆå§‹åŒ–ä¸­...' : 'åˆå§‹åŒ–å“¡å·¥å¯†ç¢¼'}\n                </Button>\n                <p className=\"text-xs text-morandi-secondary mt-1\">\n                  ç‚ºç¾æœ‰å“¡å·¥è¨­å®šé è¨­å¯†ç¢¼ï¼Œæ ¼å¼ï¼šå“¡å·¥ç·¨è™Ÿ@ç•¶å‰å¹´ä»½\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* æ¸¬è©¦è³‡æ–™ */}\n          <div className=\"bg-white rounded-lg border border-border p-4\">\n            <h3 className=\"font-semibold text-morandi-primary mb-3 flex items-center gap-2\">\n              <Users size={18} />\n              æ¸¬è©¦è³‡æ–™\n            </h3>\n            <div className=\"space-y-3\">\n              <div>\n                <Button\n                  onClick={handleCreateTestEmployees}\n                  disabled={isCreatingTest}\n                  variant=\"outline\"\n                  className=\"w-full\"\n                >\n                  {isCreatingTest ? 'å»ºç«‹ä¸­...' : 'å»ºç«‹æ¸¬è©¦å“¡å·¥'}\n                </Button>\n                <p className=\"text-xs text-morandi-secondary mt-1\">\n                  å»ºç«‹ 3 å€‹æ¸¬è©¦å“¡å·¥å¸³è™Ÿï¼ˆjohn01, mary01, peter01ï¼‰\n                </p>\n              </div>\n            </div>\n          </div>\n\n          {/* ç³»çµ±è¨­å®š */}\n          <div className=\"bg-white rounded-lg border border-border p-4\">\n            <h3 className=\"font-semibold text-morandi-primary mb-3 flex items-center gap-2\">\n              <Settings size={18} />\n              ç³»çµ±è¨­å®š\n            </h3>\n            <div className=\"space-y-3\">\n              <Button\n                onClick={toggleDevMode}\n                variant={devMode ? 'default' : 'outline'}\n                className=\"w-full\"\n              >\n                {devMode ? 'åœç”¨é–‹ç™¼æ¨¡å¼' : 'å•Ÿç”¨é–‹ç™¼æ¨¡å¼'}\n              </Button>\n\n              <Button\n                onClick={clearTestData}\n                variant=\"outline\"\n                className=\"w-full border-orange-300 hover:bg-orange-50\"\n              >\n                <Trash2 size={16} className=\"mr-2\" />\n                æ¸…ç†æ¸¬è©¦è³‡æ–™ï¼ˆä¿ç•™å“¡å·¥ï¼‰\n              </Button>\n\n              <Button\n                onClick={clearAllData}\n                variant=\"destructive\"\n                className=\"w-full\"\n              >\n                <AlertTriangle size={16} className=\"mr-2\" />\n                æ¸…é™¤æ‰€æœ‰æœ¬åœ°è³‡æ–™\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* åŸ·è¡Œæ—¥èªŒ */}\n        {logs.length > 0 && (\n          <div className=\"mt-6 bg-gray-900 text-gray-100 rounded-lg p-4\">\n            <h3 className=\"font-semibold mb-2\">åŸ·è¡Œæ—¥èªŒ</h3>\n            <div className=\"font-mono text-sm space-y-1\">\n              {logs.map((log, index) => (\n                <div key={index} className=\"flex items-start gap-2\">\n                  <span className=\"text-gray-500\">{index + 1}.</span>\n                  <span className={\n                    log.includes('âœ…') ? 'text-green-400' :\n                    log.includes('âš ï¸') ? 'text-yellow-400' :\n                    log.includes('âŒ') ? 'text-red-400' :\n                    'text-gray-300'\n                  }>{log}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* é è¨­å¸³è™Ÿè³‡è¨Š */}\n        <div className=\"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4\">\n          <h3 className=\"font-semibold text-blue-900 mb-2\">é è¨­å¸³è™Ÿè³‡è¨Š</h3>\n          <div className=\"space-y-2 text-sm text-blue-800\">\n            <div className=\"font-mono bg-white rounded p-2\">\n              <div>ğŸ” ç®¡ç†å“¡ï¼šadmin / admin123</div>\n            </div>\n            <div className=\"font-mono bg-white rounded p-2\">\n              <div>ğŸ‘¤ æ¸¬è©¦å“¡å·¥ï¼š</div>\n              <div className=\"ml-4\">john01 / john123 (æ¥­å‹™éƒ¨)</div>\n              <div className=\"ml-4\">mary01 / mary123 (è²¡å‹™éƒ¨)</div>\n              <div className=\"ml-4\">peter01 / peter123 (äººè³‡éƒ¨)</div>\n            </div>\n            <p className=\"text-xs text-blue-600 mt-2\">\n              âš ï¸ é€™äº›æ˜¯æ¸¬è©¦ç”¨å¸³è™Ÿï¼Œæ­£å¼ä¸Šç·šå‰è«‹åˆªé™¤æˆ–ä¿®æ”¹å¯†ç¢¼\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/_dev/dev/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/accounting/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/accounting/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'is_active' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":408,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":408,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useRef, useMemo, useCallback } from 'react';\n\nimport {\n  Wallet,\n  Plus,\n  TrendingUp,\n  ArrowUpDown,\n  BarChart3,\n  Settings,\n  Zap,\n  Package,\n  Edit3,\n} from 'lucide-react';\n\nimport { AccountsManagement } from '@/components/accounting/accounts-management';\nimport { AddAccountDialog } from '@/components/accounting/add-account-dialog';\nimport { TransactionList } from '@/components/accounting/transaction-list';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useAccountingStore } from '@/stores/accounting-store';\n\nimport { cn } from '@/lib/utils';\n\nexport default function AccountingPage() {\n  const { accounts, stats, categories, transactions, addTransaction } = useAccountingStore();\n  const [activeTab, setActiveTab] = useState<'overview' | 'transactions' | 'accounts' | 'settings'>('overview');\n  const [isAddAccountOpen, setIsAddAccountOpen] = useState(false);\n  const [theme, setTheme] = useState<'morandi' | 'moneypro'>('morandi');\n\n  // å¿«é€Ÿè¨˜å¸³ç‹€æ…‹\n  const [quickAmount, setQuickAmount] = useState('');\n  const [quickCategory, setQuickCategory] = useState('4'); // é è¨­é¤è²»\n  const [quickAccount] = useState(accounts.length > 0 ? accounts[0].id : '');\n  const [showToast, setShowToast] = useState(false);\n  const amountInputRef = useRef<HTMLInputElement>(null);\n  const categorySelectRef = useRef<HTMLButtonElement>(null);\n  const addButtonRef = useRef<HTMLButtonElement>(null);\n\n  const tabs = [\n    { id: 'overview', label: 'ç¸½è¦½', icon: BarChart3 },\n    { id: 'transactions', label: 'äº¤æ˜“', icon: ArrowUpDown },\n    { id: 'accounts', label: 'å¸³æˆ¶', icon: Wallet },\n    { id: 'settings', label: 'è¨­å®š', icon: Settings },\n  ];\n\n  // å¸¸ç”¨åˆ†é¡é…ç½®\n  const quickCategories = [\n    { id: '4', name: 'é¤è²»', icon: 'Food', color: '#F97316' },\n    { id: '5', name: 'äº¤é€š', icon: 'Transport', color: '#8B5CF6' },\n    { id: '6', name: 'è³¼ç‰©', icon: 'Shopping', color: '#EC4899' },\n    { id: '7', name: 'å¨›æ¨‚', icon: 'Game', color: '#6366F1' },\n    { id: '8', name: 'å…¶ä»–', icon: 'Other', color: '#6B7280' },\n  ];\n\n  // ä»Šæ—¥äº¤æ˜“\n  const today = new Date().toISOString().split('T')[0];\n  const todayTransactions = useMemo(() =>\n    transactions\n      .filter(t => t.date === today)\n      .sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime())\n      .slice(0, 3)\n  , [transactions, today]);\n\n  // å¿«é€Ÿè¨˜å¸³è™•ç†\n  const handleQuickTransaction = useCallback(async () => {\n    if (!quickAmount || !quickCategory || !quickAccount) return;\n\n    const categoryData = categories.find(c => c.id === quickCategory);\n    const accountData = accounts.find(a => a.id === quickAccount);\n\n    if (!categoryData || !accountData) return;\n\n    const transactionData = {\n      account_id: quickAccount,\n      account_name: accountData.name,\n      category_id: quickCategory,\n      category_name: categoryData.name,\n      type: 'expense' as const,\n      amount: parseFloat(quickAmount),\n      currency: 'TWD',\n      description: '',\n      date: today,\n    };\n\n    addTransaction(transactionData);\n\n    // æ¸…ç©ºè¡¨å–®ä¸¦é¡¯ç¤ºæˆåŠŸå‹•ç•«\n    setQuickAmount('');\n    setShowToast(true);\n    setTimeout(() => setShowToast(false), 2000);\n\n    // é‡æ–°èšç„¦åˆ°é‡‘é¡è¼¸å…¥\n    setTimeout(() => {\n      amountInputRef.current?.focus();\n    }, 100);\n  }, [quickAmount, quickCategory, quickAccount, categories, accounts, today, addTransaction]);\n\n  // åˆ†é¡å¿«é€Ÿé¸æ“‡\n  const handleQuickCategorySelect = useCallback((category_id: string) => {\n    setQuickCategory(category_id);\n    setTimeout(() => {\n      addButtonRef.current?.focus();\n    }, 100);\n  }, []);\n\n  // é‡‘é¡è¼¸å…¥å®Œæˆ\n  const handleAmountComplete = useCallback(() => {\n    if (quickAmount) {\n      categorySelectRef.current?.focus();\n    }\n  }, [quickAmount]);\n\n  // è¨ˆç®—æœ¬æœˆèˆ‡ä¸Šæœˆå·®ç•°\n  const currentMonth = new Date().getMonth();\n  const currentYear = new Date().getFullYear();\n  const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;\n  const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;\n\n  const lastMonthExpense = useMemo(() =>\n    transactions\n      .filter(t => {\n        const transactionDate = new Date(t.date);\n        return t.type === 'expense' &&\n               transactionDate.getMonth() === lastMonth &&\n               transactionDate.getFullYear() === lastMonthYear;\n      })\n      .reduce((sum, t) => sum + t.amount, 0)\n  , [transactions, lastMonth, lastMonthYear]);\n\n  const expenseDifference = lastMonthExpense - (stats?.monthly_expense || 0);\n  const daysToEndOfMonth = new Date(currentYear, currentMonth + 1, 0).getDate() - new Date().getDate();\n\n  // ä¸»é¡Œé…ç½®\n  const themeConfig = {\n    morandi: {\n      bg: 'bg-gradient-to-br from-[#F8F5F0] to-[#E6DDD4]',\n      headerBg: 'bg-gradient-to-r from-[#6B5B73] to-[#B5986A]',\n      cardBg: 'bg-gradient-to-br from-white to-[#F8F5F0]',\n      primary: 'text-[#6B5B73]',\n      secondary: 'text-[#6B5B73]/60',\n      accent: 'bg-gradient-to-r from-[#B5986A] to-[#D4C4A8]',\n      border: 'border-[#E6DDD4]'\n    },\n    moneypro: {\n      bg: 'bg-gradient-to-b from-slate-700 to-slate-800',\n      headerBg: 'bg-gradient-to-r from-slate-800 to-slate-700',\n      cardBg: 'bg-slate-600',\n      primary: 'text-white',\n      secondary: 'text-slate-300',\n      accent: 'bg-gradient-to-r from-blue-600 to-blue-700',\n      border: 'border-slate-500'\n    }\n  };\n\n  const currentTheme = themeConfig[theme];\n\n  return (\n    <div className={cn('min-h-screen pb-20 pt-4', currentTheme.bg)}>\n      {/* APPé¢¨æ ¼é ‚éƒ¨å€åŸŸ */}\n      <div className={cn('text-white p-4 sm:p-6 mx-4 rounded-3xl shadow-lg', currentTheme.headerBg)}>\n        <div className=\"flex justify-between items-center mb-4\">\n          <h1 className=\"text-xl sm:text-2xl font-bold\">è¨˜å¸³åŠ©æ‰‹</h1>\n          <div className=\"flex items-center space-x-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setTheme(theme === 'morandi' ? 'moneypro' : 'morandi')}\n              className=\"text-white hover:bg-white/20 rounded-full p-2 text-xs\"\n            >\n              {theme === 'morandi' ? 'Dark' : 'Light'}\n            </Button>\n          </div>\n        </div>\n\n        {/* æœ¬æœˆæ”¯å‡ºä¸»å¡ç‰‡ */}\n        <div className=\"bg-white/15 backdrop-blur-sm rounded-2xl p-4 sm:p-6 mb-4\">\n          <div className=\"text-center\">\n            <div className=\"text-white/80 text-sm mb-1\">æœ¬æœˆæ”¯å‡º</div>\n            <div className=\"text-3xl sm:text-4xl font-bold text-white mb-2\">\n              NT$ {(stats?.monthly_expense || 0).toLocaleString()}\n            </div>\n            <div className=\"flex flex-col sm:flex-row items-center justify-center space-y-2 sm:space-y-0 sm:space-x-4 text-sm text-white/80\">\n              <div className=\"flex items-center space-x-1\">\n                <TrendingUp size={14} />\n                <span>æ”¶å…¥: NT$ {(stats?.monthly_income || 0).toLocaleString()}</span>\n              </div>\n              {expenseDifference > 0 && (\n                <div className=\"flex items-center space-x-1 text-green-300\">\n                  <span>æ¯”ä¸Šæœˆçœäº† NT$ {expenseDifference.toLocaleString()}</span>\n                </div>\n              )}\n            </div>\n            <div className=\"text-xs text-white/60 mt-2\">\n              è·é›¢æœˆåº•é‚„æœ‰ {daysToEndOfMonth} å¤©\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"px-4 mt-4 space-y-6\">\n        {/* å¿«é€Ÿè¨˜å¸³å€åŸŸ */}\n        <div className={cn('rounded-2xl p-6 shadow-lg border', currentTheme.cardBg, currentTheme.border)}>\n          <div className=\"flex items-center space-x-2 mb-6\">\n            <Zap className={cn('w-5 h-5', theme === 'morandi' ? 'text-[#B5986A]' : 'text-blue-400')} />\n            <h2 className={cn('text-lg font-semibold', currentTheme.primary)}>å¿«é€Ÿè¨˜å¸³</h2>\n          </div>\n\n          {/* ä¸‰æŒ‰éˆ•å€åŸŸ - éŸ¿æ‡‰å¼è¨­è¨ˆ */}\n          <div className=\"space-y-4 sm:space-y-0 sm:grid sm:grid-cols-3 sm:gap-3 mb-6\">\n            {/* é‡‘é¡è¼¸å…¥ */}\n            <div className=\"sm:col-span-1\">\n              <div className={cn('rounded-xl border-2 p-4 h-20 transition-colors',\n                theme === 'morandi' ? 'bg-white border-[#E6DDD4] focus-within:border-[#B5986A]' : 'bg-slate-700 border-slate-500 focus-within:border-blue-400'\n              )}>\n                <div className={cn('text-xs mb-1', currentTheme.secondary)}>é‡‘é¡</div>\n                <input\n                  ref={amountInputRef}\n                  type=\"number\"\n                  value={quickAmount}\n                  onChange={(e) => setQuickAmount(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && handleAmountComplete()}\n                  placeholder='0'\n                  className={cn('w-full text-xl font-bold bg-transparent border-0 focus:outline-none',\n                    currentTheme.primary,\n                    theme === 'morandi' ? 'placeholder-[#6B5B73]/30' : 'placeholder-slate-400'\n                  )}\n                />\n              </div>\n            </div>\n\n            {/* åˆ†é¡é¸æ“‡ */}\n            <div className=\"sm:col-span-1\">\n              <Select value={quickCategory} onValueChange={setQuickCategory}>\n                <SelectTrigger\n                  ref={categorySelectRef}\n                  className={cn('h-20 border-2 rounded-xl text-center',\n                    theme === 'morandi'\n                      ? 'bg-white border-[#E6DDD4] text-[#6B5B73] focus:border-[#B5986A]'\n                      : 'bg-slate-700 border-slate-500 text-white focus:border-blue-400'\n                  )}\n                >\n                  <SelectValue>\n                    <div className=\"flex items-center justify-center space-x-2\">\n                      <span className=\"font-semibold\">\n                        {quickCategories.find(c => c.id === quickCategory)?.name || 'é¤è²»'}\n                      </span>\n                    </div>\n                  </SelectValue>\n                </SelectTrigger>\n                <SelectContent>\n                  {quickCategories.map((category) => (\n                    <SelectItem key={category.id} value={category.id}>\n                      <span>{category.name}</span>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* è¨˜å¸³æŒ‰éˆ• */}\n            <div className=\"sm:col-span-1\">\n              <Button\n                ref={addButtonRef}\n                onClick={handleQuickTransaction}\n                disabled={!quickAmount || !quickCategory}\n                className={cn('w-full h-20 text-white font-semibold rounded-xl border-0 shadow-lg transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:active:scale-100 text-base',\n                  currentTheme.accent\n                )}\n              >\n                <Plus size={20} className=\"mr-2\" />\n                è¨˜å¸³\n              </Button>\n            </div>\n          </div>\n\n          {/* å¸¸ç”¨åˆ†é¡å¿«é€Ÿé¸æ“‡ */}\n          <div className=\"space-y-3\">\n            <div className={cn('text-sm', currentTheme.secondary)}>å¸¸ç”¨åˆ†é¡</div>\n            <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2\">\n              {quickCategories.map((category) => (\n                <button\n                  key={category.id}\n                  onClick={() => handleQuickCategorySelect(category.id)}\n                  className={cn(\n                    'flex items-center justify-center px-3 py-3 sm:px-4 rounded-full transition-all duration-200 active:scale-95 text-sm sm:text-base',\n                    quickCategory === category.id\n                      ? (theme === 'morandi' ? 'bg-[#B5986A] text-white shadow-lg' : 'bg-blue-600 text-white shadow-lg')\n                      : (theme === 'morandi' ? 'bg-white/80 text-[#6B5B73] hover:bg-white border border-[#E6DDD4]' : 'bg-slate-700 text-slate-300 hover:bg-slate-600 border border-slate-500')\n                  )}\n                >\n                  <span className=\"font-medium\">{category.name}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* ä»Šæ—¥äº¤æ˜“ç°¡åŒ–åˆ—è¡¨ */}\n        <div className={cn('rounded-2xl p-6 shadow-lg border', currentTheme.cardBg, currentTheme.border)}>\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className={cn('text-lg font-semibold', currentTheme.primary)}>ä»Šæ—¥äº¤æ˜“</h3>\n            <Button\n              variant='ghost'\n              size='sm'\n              onClick={() => setActiveTab('transactions')}\n              className={cn('rounded-full text-sm',\n                theme === 'morandi' ? 'text-[#B5986A] hover:bg-[#B5986A]/10' : 'text-blue-400 hover:bg-blue-400/10'\n              )}\n            >\n              æŸ¥çœ‹å…¨éƒ¨\n            </Button>\n          </div>\n\n          {todayTransactions.length > 0 ? (\n            <div className=\"space-y-3\">\n              {todayTransactions.map((transaction) => {\n                const _category = quickCategories.find(c => c.id === transaction.category_id);\n                return (\n                  <div key={transaction.id} className={cn('flex items-center justify-between p-3 sm:p-4 rounded-xl border',\n                    theme === 'morandi' ? 'bg-white/60 border-[#E6DDD4]/50' : 'bg-slate-700 border-slate-600'\n                  )}>\n                    <div className=\"flex items-center space-x-3 flex-1 min-w-0\">\n                      <div className=\"min-w-0 flex-1\">\n                        <div className={cn('font-medium truncate', currentTheme.primary)}>{transaction.category_name}</div>\n                        <div className={cn('text-sm', currentTheme.secondary)}>\n                          {new Date(transaction.created_at).toLocaleTimeString('zh-TW', {\n                            hour: '2-digit',\n                            minute: '2-digit'\n                          })}\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-2 flex-shrink-0\">\n                      <div className=\"text-right\">\n                        <span className={cn(\n                          'font-bold text-base sm:text-lg',\n                          transaction.type === 'expense'\n                            ? (theme === 'morandi' ? 'text-[#D2691E]' : 'text-red-400')\n                            : (theme === 'morandi' ? 'text-[#228B22]' : 'text-green-400')\n                        )}>\n                          {transaction.type === 'expense' ? '-' : '+'}NT$ {transaction.amount.toLocaleString()}\n                        </span>\n                      </div>\n                      <Button\n                        variant='ghost'\n                        size='sm'\n                        className={cn('p-1 sm:p-2',\n                          theme === 'morandi' ? 'text-[#6B5B73]/40 hover:text-[#6B5B73]' : 'text-slate-400 hover:text-slate-300'\n                        )}\n                      >\n                        <Edit3 size={14} />\n                      </Button>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            <div className={cn('text-center py-8', currentTheme.secondary)}>\n              <Package size={40} className={cn('mx-auto mb-3 sm:w-12 sm:h-12',\n                theme === 'morandi' ? 'text-[#B5986A]/40' : 'text-blue-400/40'\n              )} />\n              <p className='text-base sm:text-lg'>ä»Šæ—¥é‚„æ²’æœ‰äº¤æ˜“ç´€éŒ„</p>\n              <p className='text-sm'>ä½¿ç”¨ä¸Šæ–¹å¿«é€Ÿè¨˜å¸³é–‹å§‹å§</p>\n            </div>\n          )}\n        </div>\n\n        {/* å…¶ä»–åˆ†é å…§å®¹ */}\n        {activeTab !== 'overview' && (\n          <div className={cn('rounded-2xl shadow-lg border', currentTheme.cardBg, currentTheme.border)}>\n            {activeTab === 'transactions' && (\n              <div className=\"p-6\">\n                <TransactionList />\n              </div>\n            )}\n\n            {activeTab === 'accounts' && (\n              <div className=\"p-6\">\n                <AccountsManagement />\n              </div>\n            )}\n\n            {activeTab === 'settings' && (\n              <div className=\"p-6\">\n                <div className=\"text-center py-8\">\n                  <Settings size={48} className=\"mx-auto mb-3 text-[#B5986A]\" />\n                  <h3 className=\"text-lg font-semibold text-[#6B5B73] mb-2\">è¨­å®šåŠŸèƒ½</h3>\n                  <p className=\"text-[#6B5B73]/60\">å³å°‡æ¨å‡ºæ›´å¤šè¨­å®šé¸é …</p>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* APPé¢¨æ ¼åº•éƒ¨å°èˆª */}\n      <div className={cn('fixed bottom-0 left-0 right-0 backdrop-blur-lg border-t px-2 sm:px-4 py-2 sm:py-3 safe-area-bottom',\n        theme === 'morandi'\n          ? 'bg-gradient-to-r from-white/95 to-[#F8F5F0]/95 border-[#E6DDD4]/50'\n          : 'bg-slate-800/95 border-slate-600'\n      )}>\n        <div className=\"flex items-center justify-around max-w-lg mx-auto\">\n          {tabs.map((tab) => {\n            const Icon = tab.icon;\n            const is_active = activeTab === tab.id;\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id as typeof activeTab)}\n                className={cn(\n                  'flex flex-col items-center space-y-1 p-2 sm:p-3 rounded-xl transition-all duration-200 min-w-0 flex-1',\n                  activeTab === tab.id\n                    ? (theme === 'morandi' ? 'text-[#B5986A] bg-[#B5986A]/10 scale-110' : 'text-blue-400 bg-blue-400/10 scale-110')\n                    : (theme === 'morandi' ? 'text-[#6B5B73]/60 hover:text-[#6B5B73] hover:bg-[#6B5B73]/5' : 'text-slate-400 hover:text-slate-300 hover:bg-slate-700')\n                )}\n              >\n                <Icon size={20} className=\"sm:w-6 sm:h-6\" />\n                <span className=\"text-xs font-medium truncate\">{tab.label}</span>\n              </button>\n            );\n          })}\n        </div>\n      </div>\n\n\n      {/* æˆåŠŸæç¤ºToast */}\n      {showToast && (\n        <div className=\"fixed top-4 left-1/2 transform -translate-x-1/2 z-50\">\n          <div className=\"bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-full shadow-lg flex items-center space-x-2 animate-pulse\">\n            <div className=\"w-2 h-2 bg-white rounded-full animate-ping\" />\n            <span className=\"font-medium\">è¨˜å¸³æˆåŠŸï¼</span>\n          </div>\n        </div>\n      )}\n\n\n      {/* æ–°å¢å¸³æˆ¶å°è©±æ¡† */}\n      <AddAccountDialog\n        isOpen={isAddAccountOpen}\n        onClose={() => setIsAddAccountOpen(false)}\n      />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/api/health/detailed/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/api/health/route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\n\n/**\n * Health Check API\n * æª¢æŸ¥ç³»çµ±å„é …æœå‹™ç‹€æ…‹\n *\n * GET /api/health\n */\nexport async function GET() {\n  const startTime = Date.now();\n\n  const checks = {\n    status: 'healthy' as 'healthy' | 'degraded' | 'unhealthy',\n    timestamp: new Date().toISOString(),\n    uptime: process.uptime(),\n    services: {\n      database: {\n        status: 'unknown' as 'ok' | 'error' | 'unknown',\n        responseTime: 0,\n        message: ''\n      },\n      cache: {\n        status: 'ok' as 'ok' | 'error' | 'unknown',\n        message: 'IndexedDB (client-side)'\n      }\n    },\n    version: {\n      app: '5.8.0',\n      node: process.version\n    }\n  };\n\n  // æª¢æŸ¥ Supabase é€£ç·š\n  try {\n    const dbStartTime = Date.now();\n\n    if (!supabaseUrl || !supabaseKey) {\n      checks.services.database.status = 'error';\n      checks.services.database.message = 'Supabase credentials not configured';\n      checks.status = 'degraded';\n    } else {\n      const supabase = createClient(supabaseUrl, supabaseKey);\n\n      // ç°¡å–®æŸ¥è©¢æ¸¬è©¦é€£ç·š\n      const { data, error } = await supabase\n        .from('employees')\n        .select('count', { count: 'exact', head: true });\n\n      checks.services.database.responseTime = Date.now() - dbStartTime;\n\n      if (error) {\n        checks.services.database.status = 'error';\n        checks.services.database.message = error.message;\n        checks.status = 'degraded';\n      } else {\n        checks.services.database.status = 'ok';\n        checks.services.database.message = `Connected (${checks.services.database.responseTime}ms)`;\n      }\n    }\n  } catch (error) {\n    checks.services.database.status = 'error';\n    checks.services.database.message = error instanceof Error ? error.message : 'Unknown error';\n    checks.status = 'unhealthy';\n  }\n\n  const totalTime = Date.now() - startTime;\n\n  return NextResponse.json({\n    ...checks,\n    responseTime: totalTime\n  }, {\n    status: checks.status === 'healthy' ? 200 :\n           checks.status === 'degraded' ? 207 : 503\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/api/log-error/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/business/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/calendar/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CalendarEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9036,9039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9036,9039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":428,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12963,12966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12963,12966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":823,"column":41,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":823,"endColumn":65,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[27770,27771],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef, useMemo, useCallback, useEffect } from 'react'\n\nimport { useRouter } from 'next/navigation'\n\nimport { EventClickArg } from '@fullcalendar/core'\nimport dayGridPlugin from '@fullcalendar/daygrid'\nimport interactionPlugin from '@fullcalendar/interaction'\nimport FullCalendar from '@fullcalendar/react'\nimport {\n  Calendar as CalendarIcon,\n  MapPin,\n  X,\n  Plus,\n  Cake,\n  Briefcase,\n  Clock,\n  CheckSquare,\n} from 'lucide-react'\n\nimport { CalendarSettingsDialog } from '@/components/calendar/calendar-settings-dialog'\nimport { ResponsiveHeader } from '@/components/layout/responsive-header'\nimport { Button } from '@/components/ui/button'\nimport { Card } from '@/components/ui/card'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\nimport { useTourStore, useOrderStore, useMemberStore, useCalendarStore, useCalendarEventStore } from '@/stores'\nimport { useAuthStore } from '@/stores/auth-store'\nimport { Tour } from '@/stores/types'\nimport { CalendarEvent } from '@/types/calendar.types'\nimport { logger } from '@/lib/utils/logger'\n\n// FullCalendar å…ƒä»¶æ‰€éœ€çš„é¡¯ç¤ºæ ¼å¼ï¼ˆèˆ‡è³‡æ–™åº« CalendarEvent ä¸åŒï¼‰\ninterface FullCalendarEvent {\n  id: string\n  title: string\n  start: string\n  end?: string\n  backgroundColor: string\n  borderColor: string\n  extendedProps: {\n    type: 'tour' | 'personal' | 'birthday' | 'company'\n    description?: string\n    location?: string\n    participants?: number\n    max_participants?: number\n    status?: Tour['status']\n    tour_id?: string\n    code?: string\n  }\n}\n\ninterface PersonalEvent {\n  id: string\n  title: string\n  date: string\n  end_date?: string\n  time?: string\n  type: 'meeting' | 'deadline' | 'task'\n  description?: string\n}\n\nexport default function CalendarPage() {\n  const router = useRouter()\n  const calendarRef = useRef<FullCalendar>(null)\n  const { items: tours } = useTourStore()\n  const { items: orders } = useOrderStore()\n  const { items: members } = useMemberStore()\n\n  // CalendarStoreï¼ˆåªç®¡ç† UI ç‹€æ…‹ï¼‰\n  const { user } = useAuthStore()\n  const { settings } = useCalendarStore()\n\n  // CalendarEventStoreï¼ˆç®¡ç†äº‹ä»¶è³‡æ–™ï¼‰\n  const { items: calendarEvents, create: addEvent, delete: deleteEvent } = useCalendarEventStore()\n\n  const [moreEventsDialog, setMoreEventsDialog] = useState<{\n    open: boolean\n    date: string\n    events: FullCalendarEvent[]\n  }>({\n    open: false,\n    date: '',\n    events: [],\n  })\n\n  const [eventDetailDialog, setEventDetailDialog] = useState<{\n    open: boolean\n    event: PersonalEvent | null\n  }>({\n    open: false,\n    event: null,\n  })\n\n  const [addEventDialog, setAddEventDialog] = useState<{\n    open: boolean\n    selectedDate: string\n  }>({\n    open: false,\n    selectedDate: '',\n  })\n\n  const [currentDate, setCurrentDate] = useState(new Date())\n\n  const [newEvent, setNewEvent] = useState({\n    title: '',\n    visibility: 'personal' as 'personal' | 'company',\n    event_type: 'meeting' as 'meeting' | 'deadline' | 'task' | 'other',\n    description: '',\n    end_date: '',\n    start_time: '',\n    end_time: '',\n  })\n\n  // è¨ˆç®—äº‹ä»¶å€é–“é•·åº¦ï¼ˆç”¨æ–¼æ’åºï¼‰\n  const getEventDuration = useCallback((event: FullCalendarEvent): number => {\n    if (!event.end) return 0\n    const start = new Date(event.start)\n    const end = new Date(event.end)\n    return Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24))\n  }, [])\n\n  // äº‹ä»¶æ’åºï¼šçŸ­ç¨‹åœ¨å‰ï¼Œé•·ç¨‹åœ¨å¾Œ\n  const compareEvents = useCallback(\n    (a: FullCalendarEvent, b: FullCalendarEvent): number => {\n      const durationA = getEventDuration(a)\n      const durationB = getEventDuration(b)\n\n      if (durationA !== durationB) {\n        return durationA - durationB\n      }\n\n      return a.start.localeCompare(b.start)\n    },\n    [getEventDuration]\n  )\n\n  // æ ¹æ“šé¡å‹å–å¾—é¡è‰² - ä½¿ç”¨è«è˜­è¿ªé…è‰²\n  const getEventColor = useCallback((type: string, status?: Tour['status']) => {\n    if (type === 'tour' && status) {\n      const colors: Record<Tour['status'], { bg: string; border: string }> = {\n        draft: { bg: '#9BB5D6', border: '#8AA4C5' },       // ææ¡ˆ\n        active: { bg: '#A8C4A2', border: '#97B391' },      // é€²è¡Œä¸­\n        pending_close: { bg: '#D4B896', border: '#C3A785' }, // å¾…çµæ¡ˆ\n        closed: { bg: '#B8B3AE', border: '#A7A29D' },      // çµæ¡ˆ\n        cancelled: { bg: '#B8B3AE', border: '#A7A29D' },   // å·²å–æ¶ˆ\n        special: { bg: '#D4A5A5', border: '#C39494' },     // ç‰¹æ®Šåœ˜\n      }\n      return colors[status] || colors.draft\n    }\n\n    const colors = {\n      personal: { bg: '#B8A9D1', border: '#A798C0' },\n      birthday: { bg: '#E6B8C8', border: '#D5A7B7' },\n      company: { bg: '#E0C3A0', border: '#CFB28F' },\n    }\n    return colors[type as keyof typeof colors] || { bg: '#B8B3AE', border: '#A7A29D' }\n  }, [])\n\n  // è½‰æ›æ—…éŠåœ˜ç‚ºæ—¥æ›†äº‹ä»¶ï¼ˆéæ¿¾æ‰ç‰¹æ®Šåœ˜ï¼‰\n  const tourEvents: FullCalendarEvent[] = useMemo(() => {\n    return (tours || [])\n      .filter(tour => tour.status !== 'special') // éæ¿¾æ‰ç°½è­‰å°ˆç”¨åœ˜ç­‰ç‰¹æ®Šåœ˜\n      .map(tour => {\n        const color = getEventColor('tour', tour.status)\n        const tourOrders = (orders || []).filter(order => order.tour_id === tour.id)\n        const actualMembers = (members || []).filter(member =>\n          tourOrders.some(order => order.id === member.order_id)\n        ).length\n\n        // ä¿®æ­£ FullCalendar çš„å¤šæ—¥äº‹ä»¶é¡¯ç¤ºå•é¡Œ\n        // å¦‚æœæœ‰ return_dateï¼Œå‰‡éœ€è¦åŠ ä¸€å¤©æ‰èƒ½æ­£ç¢ºé¡¯ç¤ºè·¨æ—¥äº‹ä»¶\n        let end_date = tour.return_date\n        if (end_date && end_date !== tour.departure_date) {\n          const returnDateObj = new Date(end_date)\n          returnDateObj.setDate(returnDateObj.getDate() + 1)\n          end_date = returnDateObj.toISOString().split('T')[0]\n        }\n\n        return {\n          id: `tour-${tour.id}`,\n          title: `ğŸ›« ${tour.name}`,\n          start: tour.departure_date,\n          end: end_date,\n          backgroundColor: color.bg,\n          borderColor: color.border,\n          extendedProps: {\n            type: 'tour' as const,\n            tour_id: tour.id,\n            code: tour.code,\n            location: tour.location,\n            participants: actualMembers,\n            max_participants: tour.max_participants,\n            status: tour.status,\n          },\n        }\n      })\n  }, [tours, orders, members, getEventColor])\n\n  // è½‰æ›å€‹äººäº‹é …ç‚ºæ—¥æ›†äº‹ä»¶\n  const personalCalendarEvents: FullCalendarEvent[] = useMemo(() => {\n    return (calendarEvents || [])\n      .filter(event => event.visibility === 'personal')\n      .map(event => {\n        const color = getEventColor('personal')\n        return {\n          id: event.id,\n          title: `ğŸ“… ${event.title}`,\n          start: event.start,\n          end: event.end,\n          backgroundColor: color.bg,\n          borderColor: color.border,\n          extendedProps: {\n            type: 'personal' as const,\n            description: event.description,\n          },\n        }\n      })\n  }, [calendarEvents, getEventColor])\n\n  // è½‰æ›å…¬å¸äº‹é …ç‚ºæ—¥æ›†äº‹ä»¶\n  const companyCalendarEvents: FullCalendarEvent[] = useMemo(() => {\n    return (calendarEvents || [])\n      .filter(event => event.visibility === 'company')\n      .map(event => {\n        const color = getEventColor('company')\n        return {\n          id: event.id,\n          title: `ğŸ¢ ${event.title}`,\n          start: event.start,\n          end: event.end,\n          backgroundColor: color.bg,\n          borderColor: color.border,\n          extendedProps: {\n            type: 'company' as const,\n            description: event.description,\n          },\n        }\n      })\n  }, [calendarEvents, getEventColor])\n\n  // è½‰æ›æœƒå“¡ç”Ÿæ—¥ç‚ºæ—¥æ›†äº‹ä»¶\n  const birthdayEvents: FullCalendarEvent[] = useMemo(() => {\n    const currentYear = new Date().getFullYear()\n\n    return (members || [])\n      .map(member => {\n        if (!member?.birthday) return null\n\n        // è¨ˆç®—ä»Šå¹´çš„ç”Ÿæ—¥æ—¥æœŸ\n        const birthdayThisYear = `${currentYear}-${member.birthday.slice(5)}`\n\n        return {\n          id: `birthday-${member.id}`,\n          title: `ğŸ‚ ${member.name}`,\n          start: birthdayThisYear,\n          backgroundColor: getEventColor('birthday').bg,\n          borderColor: getEventColor('birthday').border,\n          extendedProps: {\n            type: 'birthday' as const,\n            member_id: member.id,\n            member_name: member.name,\n            order_id: member.order_id,\n          },\n        }\n      })\n      .filter(Boolean) as FullCalendarEvent[]\n  }, [members, getEventColor])\n\n  // åˆä½µæ‰€æœ‰äº‹ä»¶\n  const allEvents = useMemo(() => {\n    return [...tourEvents, ...personalCalendarEvents, ...companyCalendarEvents, ...birthdayEvents]\n  }, [tourEvents, personalCalendarEvents, companyCalendarEvents, birthdayEvents])\n\n  // éæ¿¾äº‹ä»¶ï¼ˆæ ¹æ“š settingsï¼‰\n  const filteredEvents = useMemo(() => {\n    return allEvents.filter(event => {\n      const type = event.extendedProps.type\n\n      if (type === 'tour' && !settings.showTours) return false\n      if (type === 'personal' && !settings.showPersonal) return false\n      if (type === 'company' && !settings.showCompany) return false\n      if (type === 'birthday' && !settings.showBirthdays) return false\n\n      return true\n    })\n  }, [allEvents, settings])\n\n  // è™•ç†æ—¥æœŸé»æ“Š - ç›´æ¥é–‹å•Ÿæ–°å¢å€‹äººäº‹é …\n  const handleDateClick = (info: any) => {\n    setAddEventDialog({\n      open: true,\n      selectedDate: info.dateStr,\n    })\n  }\n\n  // æ–°å¢äº‹ä»¶\n  const handleAddEvent = async () => {\n    if (!newEvent.title || !user) return\n\n    try {\n      // çµ„åˆæ—¥æœŸå’Œæ™‚é–“\n      const startDateTime = newEvent.start_time\n        ? `${addEventDialog.selectedDate}T${newEvent.start_time}:00`\n        : `${addEventDialog.selectedDate}T00:00:00`;\n\n      const endDate = newEvent.end_date || addEventDialog.selectedDate;\n      const endDateTime = newEvent.end_time\n        ? `${endDate}T${newEvent.end_time}:00`\n        : `${endDate}T23:59:59`;\n\n      // æ˜ å°„ event_type: deadline â†’ reminder\n      const mappedType = newEvent.event_type === 'deadline' ? 'reminder' : newEvent.event_type;\n\n      await addEvent({\n        title: newEvent.title,\n        description: newEvent.description,\n        start: startDateTime,\n        end: endDateTime,\n        all_day: !newEvent.start_time && !newEvent.end_time,\n        type: mappedType as 'tour' | 'meeting' | 'task' | 'reminder' | 'other',\n        visibility: newEvent.visibility,\n        owner_id: user.id,\n      })\n\n      // é‡ç½®è¡¨å–®\n      setNewEvent({\n        title: '',\n        visibility: 'personal',\n        event_type: 'meeting',\n        description: '',\n        end_date: '',\n        start_time: '',\n        end_time: '',\n      })\n\n      setAddEventDialog({ open: false, selectedDate: '' })\n    } catch (error) {\n      logger.error('æ–°å¢äº‹ä»¶å¤±æ•—:', error)\n    }\n  }\n\n  // ç”Ÿæˆ15åˆ†é˜é–“éš”çš„æ™‚é–“é¸é …\n  const generateTimeOptions = () => {\n    const options = []\n    for (let hour = 0; hour < 24; hour++) {\n      for (let minute = 0; minute < 60; minute += 15) {\n        const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`\n        options.push(timeString)\n      }\n    }\n    return options\n  }\n\n  const timeOptions = generateTimeOptions()\n\n  // æœˆä»½åˆ‡æ›\n  const handlePrevMonth = () => {\n    const newDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1)\n    setCurrentDate(newDate)\n    calendarRef.current?.getApi().prev()\n  }\n\n  const handleNextMonth = () => {\n    const newDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1)\n    setCurrentDate(newDate)\n    calendarRef.current?.getApi().next()\n  }\n\n  const handleToday = () => {\n    const today = new Date()\n    setCurrentDate(today)\n    calendarRef.current?.getApi().today()\n  }\n\n  // æ ¼å¼åŒ–ç•¶å‰æœˆä»½\n  const getCurrentMonthYear = () => {\n    return currentDate.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long' })\n  }\n\n  // è™•ç†äº‹ä»¶é»æ“Š\n  const handleEventClick = (info: EventClickArg) => {\n    const eventType = info.event.extendedProps.type\n\n    if (eventType === 'tour') {\n      const tour_id = info.event.extendedProps.tourId\n      router.push(`/tours/${tour_id}`)\n    } else if (eventType === 'birthday') {\n      // è·³è½‰åˆ°æœƒå“¡è³‡æ–™é é¢\n      const member_id = info.event.extendedProps.memberId\n      // é€™è£¡å¯ä»¥è·³è½‰åˆ°è¨‚å–®è©³æƒ…é é¢çš„æœƒå“¡å€å¡Š\n      router.push(`/orders?member=${member_id}`)\n    } else if (eventType === 'personal' || eventType === 'company') {\n      // æ‰¾åˆ°å°æ‡‰çš„äº‹é …\n      const eventId = info.event.id\n      const event = calendarEvents.find(e => e.id === eventId)\n      if (event) {\n        // è½‰æ›ç‚º PersonalEvent æ ¼å¼ä»¥å…¼å®¹ç¾æœ‰ Dialog\n        const personalEventFormat: PersonalEvent = {\n          id: event.id,\n          title: event.title,\n          date: event.start,\n          end_date: event.end,\n          time: event.start,\n          type: event.type as 'meeting' | 'deadline' | 'task',\n          description: event.description,\n        }\n        setEventDetailDialog({\n          open: true,\n          event: personalEventFormat,\n        })\n      }\n    }\n  }\n\n  // åˆªé™¤äº‹é …\n  const handleDeleteEvent = async (eventId: string) => {\n    try {\n      await deleteEvent(eventId)\n      setEventDetailDialog({ open: false, event: null })\n    } catch (error) {\n      logger.error('åˆªé™¤äº‹ä»¶å¤±æ•—:', error)\n    }\n  }\n\n  // è™•ç† \"æ›´å¤š\" é€£çµé»æ“Š\n  const handleMoreLinkClick = (info: any) => {\n    info.jsEvent.preventDefault()\n    const clickedDate = info.dateStr\n\n    const dayEvents = (filteredEvents || []).filter((event: FullCalendarEvent) => {\n      if (!event?.start) return false\n      const eventStart = event.start.split('T')[0]\n      const eventEnd = event?.end ? event.end.split('T')[0] : eventStart\n      return clickedDate >= eventStart && clickedDate <= eventEnd\n    })\n\n    const sortedEvents = dayEvents.sort(compareEvents)\n\n    setMoreEventsDialog({\n      open: true,\n      date: clickedDate,\n      events: sortedEvents,\n    })\n\n    return 'popover' as const\n  }\n\n  const handleCloseDialog = () => {\n    setMoreEventsDialog({\n      open: false,\n      date: '',\n      events: [],\n    })\n  }\n\n  const handleDialogEventClick = (event: FullCalendarEvent) => {\n    if (event.extendedProps.type === 'tour') {\n      router.push(`/tours/${event.extendedProps.tour_id}`)\n    }\n    handleCloseDialog()\n  }\n\n  return (\n    <>\n      <ResponsiveHeader\n        title=\"è¡Œäº‹æ›†\"\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è¡Œäº‹æ›†', href: '/calendar' },\n        ]}\n        actions={\n          <div className=\"flex items-center gap-4\">\n            {/* æœˆä»½åˆ‡æ› */}\n            <div className=\"flex items-center gap-2 border border-border rounded-lg p-1\">\n              <Button variant=\"ghost\" size=\"sm\" onClick={handlePrevMonth} className=\"h-8 w-8 p-0\">\n                â†\n              </Button>\n              <span className=\"text-sm font-medium text-morandi-primary min-w-[120px] text-center\">\n                {getCurrentMonthYear()}\n              </span>\n              <Button variant=\"ghost\" size=\"sm\" onClick={handleNextMonth} className=\"h-8 w-8 p-0\">\n                â†’\n              </Button>\n            </div>\n\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleToday}\n              className=\"border-morandi-gold text-morandi-gold hover:bg-morandi-gold hover:text-white\"\n            >\n              ä»Šå¤©\n            </Button>\n\n            <CalendarSettingsDialog />\n\n            <Button\n              size=\"sm\"\n              onClick={() => {\n                const today = new Date().toISOString().split('T')[0]\n                setAddEventDialog({ open: true, selectedDate: today })\n              }}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              <Plus size={16} className=\"mr-1\" />\n              æ–°å¢äº‹é …\n            </Button>\n          </div>\n        }\n      />\n\n      <div className=\"space-y-6\">\n        <Card className=\"p-6 border-morandi-container\">\n        {/* æ—¥æ›†ä¸»é«” */}\n        <div className=\"calendar-container\">\n          <FullCalendar\n            ref={calendarRef}\n            plugins={[dayGridPlugin, interactionPlugin]}\n            initialView=\"dayGridMonth\"\n            headerToolbar={false}\n            events={filteredEvents}\n            dateClick={handleDateClick}\n            eventClick={handleEventClick}\n            locale=\"zh-tw\"\n            height=\"auto\"\n            dayMaxEvents={3}\n            moreLinkClick={handleMoreLinkClick}\n            moreLinkText=\"æ›´å¤š\"\n            weekends={true}\n            firstDay={1}\n            eventDisplay=\"auto\"\n            eventDidMount={info => {\n              // ç‚ºäº‹ä»¶æ·»åŠ  data å±¬æ€§ä»¥ä¾¿ CSS é¸æ“‡å™¨ä½¿ç”¨\n              const eventType = info.event.extendedProps.type\n              info.el.setAttribute('data-event-type', eventType)\n            }}\n            displayEventTime={false}\n            eventOrder=\"start,-duration,title\"\n            buttonText={{\n              today: 'ä»Šå¤©',\n              month: 'æœˆ',\n              week: 'é€±',\n              day: 'æ—¥',\n            }}\n          />\n        </div>\n\n        {/* åœ–ä¾‹ */}\n        <div className=\"mt-6 flex flex-wrap gap-4 p-4 bg-morandi-container/10 rounded-lg\">\n          <div className=\"text-sm font-medium text-morandi-secondary\">åœ–ä¾‹ï¼š</div>\n\n          {/* æ—…éŠåœ˜ç‹€æ…‹åœ–ä¾‹ */}\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#9BB5D6' }} />\n            <span className=\"text-sm text-morandi-secondary\">ææ¡ˆ</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#A8C4A2' }} />\n            <span className=\"text-sm text-morandi-secondary\">é€²è¡Œä¸­</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#D4B896' }} />\n            <span className=\"text-sm text-morandi-secondary\">å¾…çµæ¡ˆ</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#B8B3AE' }} />\n            <span className=\"text-sm text-morandi-secondary\">çµæ¡ˆ</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#D4A5A5' }} />\n            <span className=\"text-sm text-morandi-secondary\">ç‰¹æ®Šåœ˜</span>\n          </div>\n\n          {/* å€‹äººäº‹é …åœ–ä¾‹ */}\n          <div className=\"flex items-center gap-2 ml-4\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#B8A9D1' }} />\n            <span className=\"text-sm text-morandi-secondary\">å€‹äººäº‹é …</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#E6B8C8' }} />\n            <span className=\"text-sm text-morandi-secondary\">ç”Ÿæ—¥</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-4 h-4 rounded\" style={{ backgroundColor: '#E0C3A0' }} />\n            <span className=\"text-sm text-morandi-secondary\">å…¬å¸æ´»å‹•</span>\n          </div>\n        </div>\n      </Card>\n\n      {/* æ–°å¢è¡Œäº‹æ›†äº‹é …å°è©±æ¡† */}\n      <Dialog\n        open={addEventDialog.open}\n        onOpenChange={(open) => {\n          if (!open) {\n            // é—œé–‰æ™‚é‡ç½®è¡¨å–®\n            setNewEvent({\n              title: '',\n              visibility: 'personal',\n              event_type: 'meeting',\n              description: '',\n              end_date: '',\n              start_time: '',\n              end_time: '',\n            })\n            setAddEventDialog({ open: false, selectedDate: '' })\n          }\n        }}\n      >\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢è¡Œäº‹æ›†äº‹é …</DialogTitle>\n          </DialogHeader>\n\n          <form\n            onSubmit={e => {\n              e.preventDefault()\n              if (newEvent.title.trim()) {\n                handleAddEvent()\n              }\n            }}\n            className=\"space-y-4\"\n          >\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">é–‹å§‹æ—¥æœŸ</label>\n                <div className=\"mt-1 p-3 bg-morandi-container/20 rounded-lg\">\n                  <p className=\"text-base font-semibold text-morandi-primary\">\n                    {addEventDialog.selectedDate}\n                  </p>\n                </div>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">çµæŸæ—¥æœŸï¼ˆé¸å¡«ï¼‰</label>\n                <Input\n                  type=\"date\"\n                  value={newEvent.end_date}\n                  onChange={e => setNewEvent(prev => ({ ...prev, end_date: e.target.value }))}\n                  min={addEventDialog.selectedDate}\n                  className=\"mt-1\"\n                  placeholder=\"è·¨å¤©æ´»å‹•è«‹é¸æ“‡\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ¨™é¡Œ</label>\n              <Input\n                value={newEvent.title}\n                onChange={e => setNewEvent(prev => ({ ...prev, title: e.target.value }))}\n                placeholder=\"è¼¸å…¥äº‹é …æ¨™é¡Œ\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">äº‹ä»¶é¡å‹</label>\n                <select\n                  value={newEvent.visibility}\n                  onChange={e => setNewEvent(prev => ({ ...prev, visibility: e.target.value as 'personal' | 'company' }))}\n                  className=\"mt-1 w-full p-2 border border-border rounded-md bg-white\"\n                >\n                  <option value=\"personal\">å€‹äººè¡Œäº‹æ›†</option>\n                  <option value=\"company\">å…¬å¸è¡Œäº‹æ›†</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">é–‹å§‹æ™‚é–“ï¼ˆé¸å¡«ï¼‰</label>\n                <select\n                  value={newEvent.start_time}\n                  onChange={e => setNewEvent(prev => ({ ...prev, start_time: e.target.value }))}\n                  className=\"mt-1 w-full p-2 border border-border rounded-md bg-white\"\n                >\n                  <option value=\"\">ä¸æŒ‡å®šæ™‚é–“</option>\n                  {timeOptions.map(time => (\n                    <option key={time} value={time}>\n                      {time}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n\n            {/* å¦‚æœæœ‰çµæŸæ—¥æœŸï¼Œé¡¯ç¤ºçµæŸæ™‚é–“ */}\n            {newEvent.end_date && (\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">çµæŸæ™‚é–“ï¼ˆé¸å¡«ï¼‰</label>\n                <select\n                  value={newEvent.end_time}\n                  onChange={e => setNewEvent(prev => ({ ...prev, end_time: e.target.value }))}\n                  className=\"mt-1 w-full p-2 border border-border rounded-md bg-white\"\n                >\n                  <option value=\"\">ä¸æŒ‡å®šæ™‚é–“</option>\n                  {timeOptions.map(time => (\n                    <option key={time} value={time}>\n                      {time}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            )}\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">èªªæ˜ï¼ˆé¸å¡«ï¼‰</label>\n              <Input\n                value={newEvent.description}\n                onChange={e => setNewEvent(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"è¼¸å…¥èªªæ˜\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div className=\"flex justify-end gap-3 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setAddEventDialog({ open: false, selectedDate: '' })}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={!newEvent.title.trim()}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢ <span className=\"ml-1 text-xs opacity-70\">(Enter)</span>\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* äº‹ä»¶è©³æƒ…å°è©±æ¡† */}\n      <Dialog\n        open={eventDetailDialog.open}\n        onOpenChange={() => setEventDetailDialog({ open: false, event: null })}\n      >\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>äº‹ä»¶è©³æƒ…</DialogTitle>\n          </DialogHeader>\n\n          {eventDetailDialog.event && (\n            <div className=\"space-y-4\">\n              {/* æ¨™é¡Œ */}\n              <div className=\"p-4 bg-morandi-container/20 rounded-lg\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  {eventDetailDialog.event.type === 'meeting' && (\n                    <span className=\"text-2xl\">ğŸ“…</span>\n                  )}\n                  {eventDetailDialog.event.type === 'deadline' && (\n                    <span className=\"text-2xl\">â°</span>\n                  )}\n                  {eventDetailDialog.event.type === 'task' && <span className=\"text-2xl\">âœ“</span>}\n                  <span className=\"text-sm text-morandi-secondary\">\n                    {eventDetailDialog.event.type === 'meeting'\n                      ? 'æœƒè­°'\n                      : eventDetailDialog.event.type === 'deadline'\n                        ? 'æˆªæ­¢æ—¥æœŸ'\n                        : 'å¾…è¾¦äº‹é …'}\n                  </span>\n                </div>\n                <h3 className=\"text-lg font-semibold text-morandi-primary\">\n                  {eventDetailDialog.event.title}\n                </h3>\n              </div>\n\n              {/* æ—¥æœŸæ™‚é–“ */}\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2 text-sm\">\n                  <CalendarIcon size={16} className=\"text-morandi-secondary\" />\n                  <span className=\"text-morandi-primary\">\n                    {new Date(eventDetailDialog.event.date).toLocaleDateString('zh-TW', {\n                      year: 'numeric',\n                      month: 'long',\n                      day: 'numeric',\n                      weekday: 'long',\n                    })}\n                  </span>\n                </div>\n\n                {eventDetailDialog.event.end_date && (\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <span className=\"text-morandi-secondary ml-6\">è‡³</span>\n                    <span className=\"text-morandi-primary\">\n                      {new Date(eventDetailDialog.event.end_date).toLocaleDateString('zh-TW', {\n                        year: 'numeric',\n                        month: 'long',\n                        day: 'numeric',\n                        weekday: 'long',\n                      })}\n                    </span>\n                  </div>\n                )}\n\n                {eventDetailDialog.event.time && (\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Clock size={16} className=\"text-morandi-secondary\" />\n                    <span className=\"text-morandi-primary\">{eventDetailDialog.event.time}</span>\n                  </div>\n                )}\n              </div>\n\n              {/* èªªæ˜ */}\n              {eventDetailDialog.event.description && (\n                <div className=\"p-3 bg-morandi-container/10 rounded-lg\">\n                  <p className=\"text-sm text-morandi-secondary mb-1\">èªªæ˜</p>\n                  <p className=\"text-sm text-morandi-primary\">\n                    {eventDetailDialog.event.description}\n                  </p>\n                </div>\n              )}\n\n              {/* æ“ä½œæŒ‰éˆ• */}\n              <div className=\"flex justify-end gap-3 pt-4 border-t border-border\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹äº‹ä»¶å—ï¼Ÿ')) {\n                      handleDeleteEvent(eventDetailDialog.event!.id)\n                    }\n                  }}\n                  className=\"text-morandi-red hover:bg-morandi-red hover:text-white\"\n                >\n                  åˆªé™¤\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setEventDetailDialog({ open: false, event: null })}\n                >\n                  é—œé–‰\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* æ›´å¤šäº‹ä»¶å°è©±æ¡† */}\n      <Dialog open={moreEventsDialog.open} onOpenChange={handleCloseDialog}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <div className=\"flex items-center justify-between\">\n              <DialogTitle>\n                {moreEventsDialog.date} çš„æ‰€æœ‰äº‹ä»¶ ({moreEventsDialog.events.length})\n              </DialogTitle>\n              <button\n                onClick={handleCloseDialog}\n                className=\"text-morandi-secondary hover:text-morandi-primary\"\n              >\n                <X size={20} />\n              </button>\n            </div>\n          </DialogHeader>\n\n          <div className=\"space-y-2 max-h-[60vh] overflow-y-auto\">\n            {moreEventsDialog.events.map((event, index) => {\n              const duration = getEventDuration(event)\n              const Icon =\n                event.extendedProps.type === 'tour'\n                  ? MapPin\n                  : event.extendedProps.type === 'personal'\n                    ? CheckSquare\n                    : event.extendedProps.type === 'birthday'\n                      ? Cake\n                      : Briefcase\n\n              return (\n                <button\n                  key={index}\n                  onClick={() => handleDialogEventClick(event)}\n                  className=\"w-full p-4 border border-border rounded-lg hover:bg-morandi-container/10 transition-colors text-left\"\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div\n                      className=\"w-3 h-3 rounded mt-1 flex-shrink-0\"\n                      style={{ backgroundColor: event.backgroundColor }}\n                    />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium text-morandi-primary mb-1 truncate\">\n                        {event.title}\n                      </div>\n                      <div className=\"flex items-center gap-4 text-sm text-morandi-secondary\">\n                        <div className=\"flex items-center gap-1\">\n                          <Icon size={14} />\n                          <span className=\"capitalize\">{event.extendedProps.type}</span>\n                        </div>\n                        {event.extendedProps.location && (\n                          <span>{event.extendedProps.location}</span>\n                        )}\n                        {event.extendedProps.participants && (\n                          <span>\n                            {event.extendedProps.participants}/{event.extendedProps.max_participants}\n                            äºº\n                          </span>\n                        )}\n                        {duration > 0 && (\n                          <span className=\"text-morandi-gold font-medium\">{duration}å¤©</span>\n                        )}\n                      </div>\n                      {event.extendedProps.description && (\n                        <div className=\"mt-1 text-xs text-morandi-secondary\">\n                          {event.extendedProps.description}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </button>\n              )\n            })}\n          </div>\n        </DialogContent>\n      </Dialog>\n      </div>\n\n      <style jsx global>{`\n        /* FullCalendar Morandi æ¨£å¼è¦†è“‹ */\n        .calendar-container {\n          font-family: inherit;\n        }\n\n        .fc .fc-toolbar-title {\n          font-size: 1.5rem;\n          font-weight: 600;\n          color: #3a3633;\n        }\n\n        .fc .fc-button {\n          background-color: #c4a572;\n          border-color: #c4a572;\n          color: white;\n          padding: 0.5rem 1rem;\n          font-size: 0.875rem;\n          text-transform: none;\n          box-shadow: none;\n        }\n\n        .fc .fc-button:hover {\n          background-color: #b39561;\n          border-color: #b39561;\n        }\n\n        .fc .fc-button:disabled {\n          background-color: #e8e6e3;\n          border-color: #e8e6e3;\n          color: #8b8680;\n          opacity: 0.6;\n        }\n\n        .fc .fc-button-primary:not(:disabled).fc-button-active {\n          background-color: #b39561;\n          border-color: #b39561;\n        }\n\n        .fc .fc-col-header-cell {\n          background-color: #f6f4f1;\n          padding: 1rem 0.5rem;\n          font-weight: 500;\n          color: #8b8680;\n          border-color: #e8e6e3;\n        }\n\n        .fc .fc-daygrid-day {\n          border-color: #e8e6e3;\n        }\n\n        .fc .fc-daygrid-day-number {\n          color: #3a3633;\n          padding: 0.5rem;\n          font-size: 0.875rem;\n        }\n\n        .fc .fc-day-today {\n          background-color: rgba(217, 210, 200, 0.3) !important;\n        }\n\n        .fc .fc-day-today .fc-daygrid-day-number {\n          background-color: #c4a572;\n          color: white;\n          padding: 0.125rem 0.5rem;\n          border-radius: 0.375rem;\n          font-weight: 600;\n          display: inline-block;\n          margin: 0.25rem 0 0.25rem 0.5rem;\n        }\n\n        .fc .fc-daygrid-day:hover {\n          background-color: rgba(58, 54, 51, 0.02);\n          cursor: pointer;\n        }\n\n        .fc-event {\n          cursor: pointer;\n          border: none;\n          font-size: 0.75rem;\n          padding: 0.25rem 0.5rem;\n          border-radius: 0.25rem;\n          font-weight: 500;\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);\n          transition: all 0.2s ease;\n        }\n\n        .fc-event:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);\n        }\n\n        .fc-event-title {\n          font-weight: 500;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        .fc-daygrid-more-link {\n          color: #c4a572 !important;\n          font-weight: 500 !important;\n          text-decoration: none !important;\n          padding: 0.125rem 0.5rem !important;\n          border-radius: 0.25rem !important;\n          transition: all 0.2s ease !important;\n          display: inline-block !important;\n          margin-top: 0.25rem !important;\n          font-size: 0.75rem !important;\n        }\n\n        .fc-daygrid-more-link:hover {\n          background-color: rgba(196, 165, 114, 0.1) !important;\n          color: #b39561 !important;\n        }\n\n        .fc-popover {\n          display: none !important;\n        }\n\n        .fc .fc-day-sat,\n        .fc .fc-day-sun {\n          background-color: transparent;\n        }\n\n        /* é»é»æ¨£å¼äº‹ä»¶ */\n        .fc .fc-daygrid-event.fc-event-start.fc-event-end {\n          margin: 1px 2px;\n          padding: 2px 6px;\n          border-radius: 12px;\n          font-size: 11px;\n          line-height: 1.2;\n        }\n\n        /* ç”Ÿæ—¥äº‹ä»¶ç‰¹æ®Šæ¨£å¼ - åœ“å½¢é»é» */\n        .fc-event[data-event-type='birthday'] {\n          border-radius: 50% !important;\n          width: 24px !important;\n          height: 24px !important;\n          padding: 0 !important;\n          margin: 2px !important;\n          display: flex !important;\n          align-items: center !important;\n          justify-content: center !important;\n          overflow: hidden !important;\n          border: none !important;\n        }\n\n        .fc-event[data-event-type='birthday'] .fc-event-title {\n          font-size: 14px !important;\n          line-height: 1 !important;\n          text-align: center !important;\n        }\n      `}</style>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/customers/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'orders' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'customer_id' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2132,2135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2132,2135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2514,2517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2514,2517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2839,2842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2839,2842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'activeCustomers' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":182,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":182,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'avgSpentPerCustomer' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":184,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":184,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { Users, User, Mail, Phone, MapPin, Calendar, DollarSign, Edit } from 'lucide-react';\n\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { EnhancedTable, TableColumn } from '@/components/ui/enhanced-table';\nimport { Input } from '@/components/ui/input';\nimport { useTourStore, useOrderStore, useCustomerStore } from '@/stores';\n\nexport default function CustomersPage() {\n  const { items: customers, create: addCustomer } = useCustomerStore();\n  const { items: orders } = useOrderStore();\n  const { items: tours } = useTourStore();\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [newCustomer, setNewCustomer] = useState({\n    name: '',\n    email: '',\n    phone: '',\n    address: ''\n  });\n\n  const filteredCustomers = useMemo(() => {\n    if (!searchTerm) return customers;\n    return customers.filter(c =>\n      c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      c.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      c.phone?.includes(searchTerm)\n    );\n  }, [customers, searchTerm]);\n\n  const handleAddCustomer = async () => {\n    if (!newCustomer.name.trim()) return;\n\n    await addCustomer({\n      ...newCustomer,\n      code: '', // ç”± Store è‡ªå‹•ç”Ÿæˆ\n      is_vip: false,\n      is_active: true,\n      total_spent: 0\n    });\n\n    setNewCustomer({\n      name: '',\n      email: '',\n      phone: '',\n      address: ''\n    });\n    setIsAddDialogOpen(false);\n  };\n\n  const getCustomerOrders = (customer_id: string) => {\n    // âœ… é€é Order.customer_id åæŸ¥ï¼ˆç›®å‰ Order é¡å‹é‚„æ²’æœ‰ customer_idï¼Œæš«æ™‚è¿”å›ç©ºé™£åˆ—ï¼‰\n    // TODO: ç­‰ Order é¡å‹åŠ å…¥ customer_id å¾Œï¼Œæ”¹ç‚º: orders.filter(order => order.customer_id === customer_id)\n    return [];\n  };\n\n  const getCustomerTours = (customer_id: string) => {\n    // âœ… é€éåæŸ¥è¨‚å–®çš„ tour_id\n    const customerOrders = getCustomerOrders(customer_id);\n    const tourIds = new Set(customerOrders.map((o: any) => o.tour_id));\n    return tours.filter(tour => tourIds.has(tour.id));\n  };\n\n  // æ¨¡æ“¬æ›´è±å¯Œçš„é¡§å®¢è³‡æ–™\n  const enrichedCustomers = filteredCustomers.map(customer => {\n    const customerOrders = getCustomerOrders(customer.id);\n    const customerTours = getCustomerTours(customer.id);\n    const lastOrderDate = customerOrders.length > 0\n      ? new Date(Math.max(...customerOrders.map((o: any) => new Date(o.created_at).getTime())))\n      : null;\n\n    return {\n      ...customer,\n      orderCount: customerOrders.length,\n      tourCount: customerTours.length,\n      lastOrderDate: lastOrderDate?.toLocaleDateString(),\n      avgOrderValue: customerOrders.length > 0\n        ? customerOrders.reduce((sum: number, o: any) => sum + o.total_amount, 0) / customerOrders.length\n        : 0\n    };\n  });\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'name',\n      label: 'å§“å',\n      sortable: true,\n      render: (value, customer) => (\n        <div>\n          <div className=\"text-sm font-medium text-morandi-primary\">{customer.name}</div>\n          <div className=\"text-xs text-morandi-secondary\">ID: {customer.id}</div>\n        </div>\n      ),\n    },\n    {\n      key: 'contact',\n      label: 'è¯çµ¡æ–¹å¼',\n      sortable: false,\n      render: (value, customer) => (\n        <div>\n          {customer.email && (\n            <div className=\"flex items-center text-sm text-morandi-primary mb-1\">\n              <Mail size={12} className=\"mr-1\" />\n              {customer.email}\n            </div>\n          )}\n          {customer.phone && (\n            <div className=\"flex items-center text-sm text-morandi-secondary\">\n              <Phone size={12} className=\"mr-1\" />\n              {customer.phone}\n            </div>\n          )}\n        </div>\n      ),\n    },\n    {\n      key: 'address',\n      label: 'åœ°å€',\n      sortable: true,\n      render: (value, customer) => (\n        <div>\n          {customer.address && (\n            <div className=\"flex items-center text-sm text-morandi-primary\">\n              <MapPin size={12} className=\"mr-1\" />\n              {customer.address}\n            </div>\n          )}\n        </div>\n      ),\n    },\n    {\n      key: 'orders',\n      label: 'è¨‚å–®/æ—…éŠåœ˜',\n      sortable: true,\n      render: (value, customer) => (\n        <div className=\"text-sm\">\n          <div className=\"text-morandi-primary\">è¨‚å–®: {customer.orderCount} ç­†</div>\n          <div className=\"text-morandi-secondary\">æ—…éŠåœ˜: {customer.tourCount} å€‹</div>\n        </div>\n      ),\n    },\n    {\n      key: 'totalSpent',\n      label: 'æ¶ˆè²»ç´€éŒ„',\n      sortable: true,\n      render: (value, customer) => (\n        <div className=\"text-sm\">\n          <div className=\"font-medium text-morandi-primary\">\n            ç¸½è¨ˆ: NT$ {customer.total_spent.toLocaleString()}\n          </div>\n          {customer.avgOrderValue > 0 && (\n            <div className=\"text-morandi-secondary\">\n              å¹³å‡: NT$ {customer.avgOrderValue.toLocaleString()}\n            </div>\n          )}\n        </div>\n      ),\n    },\n    {\n      key: 'lastOrderDate',\n      label: 'æœ€å¾Œæ¶ˆè²»',\n      sortable: true,\n      render: (value, customer) => (\n        <div>\n          {customer.lastOrderDate && (\n            <div className=\"flex items-center text-xs text-morandi-secondary\">\n              <Calendar size={12} className=\"mr-1\" />\n              {customer.lastOrderDate}\n            </div>\n          )}\n        </div>\n      ),\n    },\n  ], []);\n\n  const totalCustomers = customers.length;\n  const activeCustomers = customers.filter(c => (c.total_orders ?? 0) > 0).length;\n  const totalSpent = customers.reduce((sum, c) => sum + (c.total_spent ?? 0), 0);\n  const avgSpentPerCustomer = totalCustomers > 0 ? totalSpent / totalCustomers : 0;\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"é¡§å®¢ç®¡ç†\"\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹é¡§å®¢å§“åã€é›»è©±ã€Email...\"\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢é¡§å®¢\"\n      >\n        <div className=\"text-sm text-morandi-secondary\">\n          {filteredCustomers.length} ä½é¡§å®¢\n        </div>\n      </ResponsiveHeader>\n\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n        className=\"min-h-full\"\n        columns={tableColumns}\n        data={enrichedCustomers}\n        actions={() => (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n            title=\"ç·¨è¼¯é¡§å®¢\"\n          >\n            <Edit size={14} className=\"text-morandi-gold\" />\n          </Button>\n        )}\n      />\n      </div>\n\n      {/* æ–°å¢é¡§å®¢å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢é¡§å®¢</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">å§“å</label>\n              <Input\n                value={newCustomer.name}\n                onChange={(e) => setNewCustomer(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"è¼¸å…¥é¡§å®¢å§“å\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">Email</label>\n              <Input\n                type=\"email\"\n                value={newCustomer.email}\n                onChange={(e) => setNewCustomer(prev => ({ ...prev, email: e.target.value }))}\n                placeholder=\"è¼¸å…¥ Email åœ°å€\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">é›»è©±</label>\n              <Input\n                value={newCustomer.phone}\n                onChange={(e) => setNewCustomer(prev => ({ ...prev, phone: e.target.value }))}\n                placeholder=\"è¼¸å…¥è¯çµ¡é›»è©±\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">åœ°å€</label>\n              <Input\n                value={newCustomer.address}\n                onChange={(e) => setNewCustomer(prev => ({ ...prev, address: e.target.value }))}\n                placeholder=\"è¼¸å…¥åœ°å€\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsAddDialogOpen(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleAddCustomer}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/database/activities/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6169,6172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6169,6172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { MapIcon, Edit, Trash2, Ticket } from 'lucide-react';\n\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { EnhancedTable, TableColumn, useEnhancedTable } from '@/components/ui/enhanced-table';\nimport { Input } from '@/components/ui/input';\nimport { getRegionOptions, type RegionName, type ActivityOption } from '@/data/region-options';\n\nexport default function ActivitiesPage() {\n  const [selectedRegion] = useState<RegionName>('æ¸…é‚');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [_editingActivity, setEditingActivity] = useState<ActivityOption | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [newActivity, setNewActivity] = useState({\n    name: '',\n    category: '',\n    adultPrice: 0,\n    childPrice: 0,\n    groupDiscount: 0\n  });\n\n  const currentOptions = getRegionOptions(selectedRegion);\n  const activityOptions = currentOptions.activities;\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'name',\n      label: 'æ´»å‹•åç¨±',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <div className=\"flex items-center\">\n          <MapIcon size={16} className=\"mr-2 text-morandi-gold\" />\n          <span className=\"font-medium text-morandi-primary\">{value}</span>\n        </div>\n      )\n    },\n    {\n      key: 'category',\n      label: 'é¡åˆ¥',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">{value || '-'}</span>\n      )\n    },\n    {\n      key: 'adultPrice',\n      label: 'æˆäººåƒ¹æ ¼',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">\n          {value ? `NT$ ${value}` : '-'}\n        </span>\n      )\n    },\n    {\n      key: 'childPrice',\n      label: 'å…’ç«¥åƒ¹æ ¼',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">\n          {value ? `NT$ ${value}` : '-'}\n        </span>\n      )\n    },\n    {\n      key: 'groupDiscount',\n      label: 'åœ˜é«”æŠ˜æ‰£',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">\n          {value ? `${value}%` : 'ç„¡'}\n        </span>\n      )\n    },\n    {\n      key: 'actions',\n      label: 'æ“ä½œ',\n      sortable: false,\n      filterable: false,\n      render: (_, row) => (\n        <div className=\"flex items-center space-x-2\">\n          <button\n            onClick={() => handleEditActivity(row)}\n            className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n            title=\"ç·¨è¼¯æ´»å‹•\"\n          >\n            <Edit size={14} className=\"text-morandi-gold\" />\n          </button>\n          <button\n            onClick={() => handleDeleteActivity(row.id)}\n            className=\"p-1 hover:bg-morandi-red/10 rounded transition-colors\"\n            title=\"åˆªé™¤æ´»å‹•\"\n          >\n            <Trash2 size={14} className=\"text-morandi-red\" />\n          </button>\n        </div>\n      )\n    }\n  ], []);\n\n  // æ’åºå’Œç¯©é¸å‡½æ•¸\n  const sortFunction = (data: ActivityOption[], column: string, direction: 'asc' | 'desc') => {\n    return [...data].sort((a, b) => {\n      const aValue: string | number = a[column as keyof ActivityOption] ?? '';\n      const bValue: string | number = b[column as keyof ActivityOption] ?? '';\n\n      if (aValue < bValue) return direction === 'asc' ? -1 : 1;\n      if (aValue > bValue) return direction === 'asc' ? 1 : -1;\n      return 0;\n    });\n  };\n\n  const filterFunction = useCallback((data: ActivityOption[], filters: Record<string, string>) => {\n    return data.filter(activity => {\n      // æœå°‹åŠŸèƒ½ï¼šæª¢æŸ¥åç¨±æˆ–é¡åˆ¥æ˜¯å¦åŒ…å«æœå°‹è©\n      const matchesSearch = !searchTerm ||\n        activity.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        (activity.category || '').toLowerCase().includes(searchTerm.toLowerCase());\n\n      return (\n        matchesSearch &&\n        (!filters.name || activity.name.toLowerCase().includes(filters.name.toLowerCase())) &&\n        (!filters.category || (activity.category || '').toLowerCase().includes(filters.category.toLowerCase())) &&\n        (!filters.adultPrice || (activity.adultPrice || 0).toString().includes(filters.adultPrice)) &&\n        (!filters.childPrice || (activity.childPrice || 0).toString().includes(filters.childPrice)) &&\n        (!filters.groupDiscount || (activity.groupDiscount || 0).toString().includes(filters.groupDiscount))\n      );\n    });\n  }, [searchTerm]);\n\n  const { data: filteredAndSortedActivities, handleSort, handleFilter } = useEnhancedTable(\n    activityOptions,\n    sortFunction,\n    filterFunction\n  );\n\n  // é‡æ–°è¨ˆç®—éæ¿¾çµæœï¼ˆç•¶æœå°‹è©æ”¹è®Šæ™‚ï¼‰\n  const finalFilteredActivities = useMemo(() => {\n    return filterFunction(filteredAndSortedActivities, {});\n  }, [filteredAndSortedActivities, filterFunction]);\n\n  const handleAddActivity = () => {\n    if (!newActivity.name.trim()) return;\n    // TODO: æ–°å¢æ´»å‹•é¸é …åˆ°è³‡æ–™åº«\n    resetForm();\n  };\n\n  const handleEditActivity = (activity: ActivityOption) => {\n    setEditingActivity(activity);\n    setNewActivity({\n      name: activity.name,\n      category: activity.category || '',\n      adultPrice: activity.adultPrice || 0,\n      childPrice: activity.childPrice || 0,\n      groupDiscount: activity.groupDiscount || 0\n    });\n    setIsAddDialogOpen(true);\n  };\n\n  const handleDeleteActivity = (_activityId: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ´»å‹•é¸é …å—ï¼Ÿ')) {\n      // TODO: åˆªé™¤æ´»å‹•é¸é …å¾è³‡æ–™åº«\n    }\n  };\n\n  const resetForm = () => {\n    setNewActivity({\n      name: '',\n      category: '',\n      adultPrice: 0,\n      childPrice: 0,\n      groupDiscount: 0\n    });\n    setIsAddDialogOpen(false);\n    setEditingActivity(null);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <ResponsiveHeader\n        {...{\n        title: 'æ´»å‹•é–€ç¥¨ç®¡ç†',\n        icon: Ticket} as any}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è³‡æ–™åº«ç®¡ç†', href: '/database' },\n          { label: 'æ´»å‹•é–€ç¥¨', href: '/database/activities' }\n        ]}\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹æ´»å‹•æˆ–é¡åˆ¥...\"\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢æ´»å‹•\"\n        actions={\n          <span className=\"text-sm text-morandi-secondary\">\n            å…± {finalFilteredActivities.length} ç­†æ´»å‹•é–€ç¥¨\n          </span>\n        }\n      />\n\n      <ContentContainer>\n        <EnhancedTable\n          columns={tableColumns}\n          data={finalFilteredActivities}\n          onSort={handleSort}\n          onFilter={handleFilter}\n          selection={undefined}\n        />\n\n        {finalFilteredActivities.length === 0 && (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <MapIcon size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p>{activityOptions.length === 0 ? 'æ­¤åœ°å€å°šæœªå»ºç«‹æ´»å‹•é¸é …' : 'ç„¡ç¬¦åˆæ¢ä»¶çš„æ´»å‹•é¸é …'}</p>\n          </div>\n        )}\n      </ContentContainer>\n\n      {/* æ–°å¢æ´»å‹•å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={resetForm}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢æ´»å‹•é–€ç¥¨</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">æ´»å‹•åç¨±</label>\n                <Input\n                  value={newActivity.name}\n                  onChange={(e) => setNewActivity(prev => ({ ...prev, name: e.target.value }))}\n                  placeholder=\"ä¾‹å¦‚ï¼šå¤§è±¡ä¿è­·å€\"\n                  className=\"mt-1\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">åˆ†é¡</label>\n                <Input\n                  value={newActivity.category}\n                  onChange={(e) => setNewActivity(prev => ({ ...prev, category: e.target.value }))}\n                  placeholder=\"ä¾‹å¦‚ï¼šç”Ÿæ…‹é«”é©—\"\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">æˆäººç¥¨åƒ¹</label>\n                <Input\n                  type=\"number\"\n                  value={newActivity.adultPrice || ''}\n                  onChange={(e) => setNewActivity(prev => ({ ...prev, adultPrice: Number(e.target.value) || 0 }))}\n                  placeholder=\"0\"\n                  className=\"mt-1\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">å…’ç«¥ç¥¨åƒ¹</label>\n                <Input\n                  type=\"number\"\n                  value={newActivity.childPrice || ''}\n                  onChange={(e) => setNewActivity(prev => ({ ...prev, childPrice: Number(e.target.value) || 0 }))}\n                  placeholder=\"0\"\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button variant=\"outline\" onClick={resetForm}>å–æ¶ˆ</Button>\n              <Button onClick={handleAddActivity} className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\">\n                æ–°å¢\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/database/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/database/pricing/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/database/regions/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Dialog' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogContent' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogHeader' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTitle' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Region' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1677,1680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1677,1680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1959,1962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1959,1962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'create' and 'regions.length'. Either include them or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [create, regions.length]","fix":{"range":[2339,2341],"text":"[create, regions.length]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo, useEffect } from 'react';\nimport { MapPin, Edit, Trash2, Power, ChevronRight, ChevronDown } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\n\nimport { cn } from '@/lib/utils';\nimport { DESTINATIONS } from '@/constants/destinations';\nimport { useRegionStore } from '@/stores';\nimport type { Region } from '@/types';\n\nexport default function RegionsPage() {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [expandedCountries, setExpandedCountries] = useState<Set<string>>(new Set());\n  const { items: regions, create, update, delete: deleteRegion } = useRegionStore();\n\n  // åˆå§‹åŒ–ï¼šå¦‚æœæ²’æœ‰è³‡æ–™ï¼Œå¾ DESTINATIONS åŒ¯å…¥\n  useEffect(() => {\n    const initializeRegions = async () => {\n      // æª¢æŸ¥æ˜¯å¦å·²ç¶“åˆå§‹åŒ–éï¼ˆä½¿ç”¨ localStorage æ¨™è¨˜ï¼‰\n      const initialized = localStorage.getItem('regions_initialized');\n      if (initialized === 'true') {\n        console.log('ğŸ“ åœ°å€è³‡æ–™å·²åˆå§‹åŒ–ï¼Œè·³é');\n        return;\n      }\n\n      // å†æ¬¡æª¢æŸ¥ store ä¸­æ˜¯å¦å·²æœ‰è³‡æ–™ï¼ˆé˜²æ­¢é‡è¤‡åˆå§‹åŒ–ï¼‰\n      if (regions.length > 0) {\n        console.log('ğŸ“ åœ°å€è³‡æ–™å·²å­˜åœ¨ï¼Œæ¨™è¨˜ç‚ºå·²åˆå§‹åŒ–');\n        localStorage.setItem('regions_initialized', 'true');\n        return;\n      }\n\n      console.log('ğŸ“ åˆå§‹åŒ–åœ°å€è³‡æ–™...');\n\n      try {\n        for (const [countryCode, destination] of Object.entries(DESTINATIONS)) {\n          // æ·»åŠ åœ‹å®¶\n          await create({\n            type: 'country',\n            name: destination.name,\n            code: countryCode,\n            status: 'active'\n          } as any);\n\n          // æ·»åŠ åŸå¸‚\n          for (const city of destination.cities) {\n            await create({\n              type: 'city',\n              name: city.name,\n              code: city.code,\n              status: 'active',\n              country_code: countryCode\n            } as any);\n          }\n        }\n\n        // æ¨™è¨˜ç‚ºå·²åˆå§‹åŒ–\n        localStorage.setItem('regions_initialized', 'true');\n        console.log('âœ… åœ°å€è³‡æ–™åˆå§‹åŒ–å®Œæˆ');\n      } catch (error) {\n        console.error('âŒ åœ°å€è³‡æ–™åˆå§‹åŒ–å¤±æ•—:', error);\n        // ä¸æ¨™è¨˜ç‚ºå·²åˆå§‹åŒ–ï¼Œä¸‹æ¬¡å¯ä»¥é‡è©¦\n      }\n    };\n\n    // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿ store å·²è¼‰å…¥\n    const timer = setTimeout(initializeRegions, 100);\n    return () => clearTimeout(timer);\n  }, []); // åªåŸ·è¡Œä¸€æ¬¡\n\n  // åˆ‡æ›åœ‹å®¶å±•é–‹/æ”¶èµ·\n  const toggleCountry = (countryCode: string) => {\n    setExpandedCountries(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(countryCode)) {\n        newSet.delete(countryCode);\n      } else {\n        newSet.add(countryCode);\n      }\n      return newSet;\n    });\n  };\n\n  // åœç”¨/å•Ÿç”¨\n  const toggleStatus = async (id: string) => {\n    const region = regions.find(r => r.id === id);\n    if (!region) return;\n\n    await update(id, {\n      status: region.status === 'active' ? 'inactive' : 'active'\n    });\n  };\n\n  // åˆªé™¤\n  const handleDelete = async (id: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) {\n      await deleteRegion(id);\n    }\n  };\n\n  // éæ¿¾å’Œçµ„ç¹”è³‡æ–™\n  const { countries, cities } = useMemo(() => {\n    const countryList = regions.filter(r => r.type === 'country');\n    const cityList = regions.filter(r => r.type === 'city');\n\n    return {\n      countries: countryList.filter(country =>\n        !searchTerm ||\n        country.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        country.code.toLowerCase().includes(searchTerm.toLowerCase())\n      ),\n      cities: cityList\n    };\n  }, [regions, searchTerm]);\n\n  // ç²å–åœ‹å®¶çš„åŸå¸‚åˆ—è¡¨\n  const getCities = (countryCode: string) => {\n    return cities.filter(city =>\n      city.country_code === countryCode &&\n      (!searchTerm ||\n        city.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        city.code.toLowerCase().includes(searchTerm.toLowerCase())\n      )\n    );\n  };\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"åœ°å€ç®¡ç†\"\n        icon={MapPin}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è³‡æ–™åº«ç®¡ç†', href: '/database' },\n          { label: 'åœ°å€ç®¡ç†', href: '/database/regions' }\n        ]}\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹åœ‹å®¶æˆ–åŸå¸‚...\"\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        <div className=\"border border-border rounded-lg overflow-hidden bg-card\">\n          {/* è¡¨æ ¼æ¨™é¡Œ */}\n          <div className=\"bg-morandi-container/30 border-b border-border\">\n            <div className=\"flex items-center px-4 py-3\">\n              <div className=\"flex-1 text-sm font-medium text-morandi-secondary\">åœ‹å®¶/åŸå¸‚</div>\n              <div className=\"w-32 text-sm font-medium text-morandi-secondary\">ä»£ç¢¼</div>\n              <div className=\"w-24 text-sm font-medium text-morandi-secondary\">ç‹€æ…‹</div>\n              <div className=\"w-32 text-sm font-medium text-morandi-secondary text-right\">æ“ä½œ</div>\n            </div>\n          </div>\n\n          {/* è¡¨æ ¼å…§å®¹ */}\n          <div>\n            {countries.length === 0 ? (\n              <div className=\"text-center py-12 text-morandi-secondary\">\n                <MapPin size={48} className=\"mx-auto mb-4 opacity-50\" />\n                <p>ç„¡ç¬¦åˆæ¢ä»¶çš„åœ°å€</p>\n              </div>\n            ) : (\n              countries.map((country) => {\n                const isExpanded = expandedCountries.has(country.code);\n                const countryCities = getCities(country.code);\n\n                return (\n                  <div key={country.id}>\n                    {/* åœ‹å®¶è¡Œ */}\n                    <div className=\"border-b border-border hover:bg-morandi-container/20 transition-colors\">\n                      <div className=\"flex items-center px-4 py-3\">\n                        <div className=\"flex-1 flex items-center\">\n                          {/* å±•é–‹/æ”¶èµ·æŒ‰éˆ• */}\n                          <button\n                            onClick={() => toggleCountry(country.code)}\n                            className=\"mr-2 p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n                          >\n                            {isExpanded ? (\n                              <ChevronDown size={16} className=\"text-morandi-gold\" />\n                            ) : (\n                              <ChevronRight size={16} className=\"text-morandi-secondary\" />\n                            )}\n                          </button>\n\n                          <MapPin size={16} className=\"mr-2 text-morandi-gold\" />\n                          <span className=\"font-semibold text-morandi-primary\">{country.name}</span>\n                          <span className=\"ml-2 text-xs text-morandi-muted\">\n                            ({countryCities.length} å€‹åŸå¸‚)\n                          </span>\n                        </div>\n\n                        <div className=\"w-32 text-morandi-secondary font-mono\">{country.code}</div>\n\n                        <div className=\"w-24\">\n                          <span className={cn(\n                            'inline-flex items-center px-2 py-1 rounded text-xs font-medium',\n                            country.status === 'active'\n                              ? 'bg-morandi-green text-white'\n                              : 'bg-morandi-container text-morandi-secondary'\n                          )}>\n                            {country.status === 'active' ? 'å•Ÿç”¨' : 'åœç”¨'}\n                          </span>\n                        </div>\n\n                        <div className=\"w-32 flex items-center justify-end gap-1\">\n                          <button\n                            onClick={() => toggleStatus(country.id)}\n                            className=\"p-1 rounded transition-colors hover:bg-morandi-container/30\"\n                            title={country.status === 'active' ? 'åœç”¨' : 'å•Ÿç”¨'}\n                          >\n                            <Power size={14} className={\n                              country.status === 'active' ? 'text-morandi-green' : 'text-morandi-secondary'\n                            } />\n                          </button>\n                          <button\n                            onClick={() => handleDelete(country.id)}\n                            className=\"p-1 text-morandi-secondary hover:text-morandi-red hover:bg-morandi-red/10 rounded transition-colors\"\n                            title=\"åˆªé™¤\"\n                          >\n                            <Trash2 size={14} />\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* åŸå¸‚åˆ—è¡¨ï¼ˆå±•é–‹æ™‚é¡¯ç¤ºï¼‰ */}\n                    {isExpanded && countryCities.length > 0 && (\n                      <div className=\"bg-morandi-container/5\">\n                        {countryCities.map((city) => (\n                          <div\n                            key={city.id}\n                            className=\"border-b border-border/50 hover:bg-morandi-container/20 transition-colors\"\n                          >\n                            <div className=\"flex items-center px-4 py-2.5 pl-14\">\n                              <div className=\"flex-1 flex items-center\">\n                                <div className=\"w-1 h-1 rounded-full bg-morandi-gold mr-3\"></div>\n                                <span className=\"text-morandi-primary\">{city.name}</span>\n                              </div>\n\n                              <div className=\"w-32 text-morandi-secondary font-mono text-sm\">{city.code}</div>\n\n                              <div className=\"w-24\">\n                                <span className={cn(\n                                  'inline-flex items-center px-2 py-0.5 rounded text-xs font-medium',\n                                  city.status === 'active'\n                                    ? 'bg-morandi-green/80 text-white'\n                                    : 'bg-morandi-container text-morandi-secondary'\n                                )}>\n                                  {city.status === 'active' ? 'å•Ÿç”¨' : 'åœç”¨'}\n                                </span>\n                              </div>\n\n                              <div className=\"w-32 flex items-center justify-end gap-1\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => toggleStatus(city.id)}\n                                  className=\"h-7 w-7 p-0\"\n                                  title={city.status === 'active' ? 'åœç”¨' : 'å•Ÿç”¨'}\n                                >\n                                  <Power size={12} className={\n                                    city.status === 'active' ? 'text-morandi-green' : 'text-morandi-secondary'\n                                  } />\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleDelete(city.id)}\n                                  className=\"h-7 w-7 p-0 hover:text-morandi-red\"\n                                  title=\"åˆªé™¤\"\n                                >\n                                  <Trash2 size={12} />\n                                </Button>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                );\n              })\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/database/suppliers/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supplierTypeIcons' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'supplierTypeColors' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filter' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":54,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2918,2921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2918,2921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { useSupplierStore } from '@/stores';\nimport {\n  Building2,\n  Hotel,\n  UtensilsCrossed,\n  Car,\n  Ticket,\n  UserCheck,\n  Package\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Supplier } from '@/types/supplier.types';\nimport { EnhancedTable, type TableColumn } from '@/components/ui/enhanced-table';\nimport { supplierService } from '@/features/suppliers/services/supplier.service';\nimport { useRegionStore } from '@/stores';\n\nconst supplierTypeIcons = {\n  hotel: Hotel,\n  restaurant: UtensilsCrossed,\n  transport: Car,\n  ticket: Ticket,\n  guide: UserCheck,\n  other: Package\n};\n\nconst supplierTypeLabels = {\n  hotel: 'é£¯åº—ä½å®¿',\n  restaurant: 'é¤å»³',\n  transport: 'äº¤é€š',\n  ticket: 'é–€ç¥¨',\n  guide: 'å°éŠ',\n  other: 'å…¶ä»–'\n};\n\nconst supplierTypeColors = {\n  hotel: 'bg-blue-500',\n  restaurant: 'bg-green-500',\n  transport: 'bg-orange-500',\n  ticket: 'bg-purple-500',\n  guide: 'bg-pink-500',\n  other: 'bg-gray-500'\n};\n\nexport default function SuppliersPage() {\n  const { items: suppliers, create: addSupplier, filter } = useSupplierStore();\n  const { items: regions, fetchAll: fetchRegions } = useRegionStore();\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // æ‡¶è¼‰å…¥ï¼šæ‰“é–‹æ–°å¢å°è©±æ¡†æ™‚æ‰è¼‰å…¥ regions\n  const handleOpenAddDialog = useCallback(() => {\n    if (regions.length === 0) {\n      fetchRegions();\n    }\n    setIsAddDialogOpen(true);\n  }, [regions.length, fetchRegions]);\n\n  // å¾ regions å–å¾—åœ‹å®¶åˆ—è¡¨\n  const activeCountries = useMemo(() => {\n    return regions\n      .filter(r => r.type === 'country' && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [regions]);\n\n  const [newSupplier, setNewSupplier] = useState({\n    supplier_code: '',\n    name: '',\n    country: '',\n    location: '',\n    type: 'hotel' as Supplier['type'],\n    contact: {\n      contact_person: '',\n      phone: '',\n      email: '',\n      address: '',\n      website: ''\n    },\n    status: 'active' as Supplier['status'],\n    note: ''\n  });\n\n  const handleAddSupplier = useCallback(async () => {\n    if (!newSupplier.name.trim() || !newSupplier.contact.contact_person.trim()) return;\n    if (!newSupplier.country) {\n      alert('è«‹é¸æ“‡åœ‹å®¶');\n      return;\n    }\n\n    // è‡ªå‹•ç”Ÿæˆä¾›æ‡‰å•†ç·¨è™Ÿ\n    const supplierCode = await supplierService.generateSupplierCode(newSupplier.country);\n\n    addSupplier({\n      ...newSupplier,\n      supplier_code: supplierCode\n    } as any);\n\n    setNewSupplier({\n      supplier_code: '',\n      name: '',\n      country: '',\n      location: '',\n      type: 'hotel',\n      contact: {\n        contact_person: '',\n        phone: '',\n        email: '',\n        address: '',\n        website: ''\n      },\n      status: 'active',\n      note: ''\n    });\n    setIsAddDialogOpen(false);\n  }, [newSupplier, addSupplier]);\n\n  // éæ¿¾ä¾›æ‡‰å•† - ä½¿ç”¨ useMemo å„ªåŒ–\n  const filteredSuppliers = useMemo(() => {\n    if (!suppliers || !Array.isArray(suppliers)) return [];\n    return suppliers.filter(supplier => {\n      const matchesSearch = searchQuery === '' ||\n        supplier.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        (supplier.supplier_code && supplier.supplier_code.toLowerCase().includes(searchQuery.toLowerCase())) ||\n        (supplier.country && supplier.country.toLowerCase().includes(searchQuery.toLowerCase())) ||\n        (supplier.location && supplier.location.toLowerCase().includes(searchQuery.toLowerCase())) ||\n        supplier.contact.contact_person.toLowerCase().includes(searchQuery.toLowerCase());\n\n      return matchesSearch;\n    });\n  }, [suppliers, searchQuery]);\n\n  // å®šç¾©è¡¨æ ¼æ¬„ä½\n  const columns: TableColumn[] = [\n    {\n      key: 'name',\n      label: 'ä¾›æ‡‰å•†åç¨±',\n      sortable: true,\n      render: (value) => <span className=\"font-medium text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'supplier_code',\n      label: 'ä¾›æ‡‰å•†ç·¨è™Ÿ',\n      sortable: true,\n      render: (value) => <span className=\"text-morandi-primary\">{value || '-'}</span>,\n    },\n    {\n      key: 'country',\n      label: 'åœ‹å®¶',\n      sortable: true,\n      render: (value) => <span className=\"text-morandi-primary\">{value || '-'}</span>,\n    },\n    {\n      key: 'location',\n      label: 'åœ°é»',\n      sortable: true,\n      render: (value) => <span className=\"text-morandi-primary\">{value || '-'}</span>,\n    },\n    {\n      key: 'type',\n      label: 'æœå‹™é …ç›®',\n      sortable: true,\n      render: (value) => (\n        <Badge variant=\"secondary\" className=\"text-xs\">\n          {supplierTypeLabels[value as Supplier['type']]}\n        </Badge>\n      ),\n    },\n  ];\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"ä¾›æ‡‰å•†ç®¡ç†\"\n        icon={Building2}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è³‡æ–™åº«ç®¡ç†', href: '/database' },\n          { label: 'ä¾›æ‡‰å•†ç®¡ç†', href: '/database/suppliers' }\n        ]}\n        showSearch={true}\n        searchTerm={searchQuery}\n        onSearchChange={setSearchQuery}\n        searchPlaceholder=\"æœå°‹ä¾›æ‡‰å•†åç¨±ã€è¯çµ¡äººæˆ–æœå‹™é …ç›®...\"\n        onAdd={handleOpenAddDialog}\n        addLabel=\"æ–°å¢ä¾›æ‡‰å•†\"\n      />\n\n      {/* ä¾›æ‡‰å•†åˆ—è¡¨ */}\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n          className=\"min-h-full\"\n          columns={columns}\n          data={filteredSuppliers}\n          loading={false}\n        />\n      </div>\n\n      {/* æ–°å¢ä¾›æ‡‰å•†å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢ä¾›æ‡‰å•†</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-6\">\n            {/* åŸºæœ¬è³‡è¨Š */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-sm font-medium text-morandi-primary\">åŸºæœ¬è³‡è¨Š</h3>\n                <p className=\"text-xs text-morandi-secondary\">ä¾›æ‡‰å•†ç·¨è™Ÿå°‡è‡ªå‹•ç”Ÿæˆ</p>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">ä¾›æ‡‰å•†åç¨± *</label>\n                  <Input\n                    value={newSupplier.name}\n                    onChange={(e) => setNewSupplier(prev => ({ ...prev, name: e.target.value }))}\n                    placeholder=\"è¼¸å…¥ä¾›æ‡‰å•†åç¨±\"\n                    className=\"mt-1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">åœ‹å®¶ *</label>\n                  <Select\n                    value={newSupplier.country}\n                    onValueChange={(value) => setNewSupplier(prev => ({ ...prev, country: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue placeholder=\"é¸æ“‡åœ‹å®¶\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {activeCountries.map((dest) => (\n                        <SelectItem key={dest.code} value={dest.name}>\n                          {dest.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">åœ°é»</label>\n                  <Input\n                    value={newSupplier.location}\n                    onChange={(e) => setNewSupplier(prev => ({ ...prev, location: e.target.value }))}\n                    placeholder=\"è¼¸å…¥åœ°é»\"\n                    className=\"mt-1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">æœå‹™é¡åˆ¥ *</label>\n                  <Select\n                    value={newSupplier.type}\n                    onValueChange={(value: Supplier['type']) => setNewSupplier(prev => ({ ...prev, type: value }))}\n                  >\n                    <SelectTrigger className=\"mt-1\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {Object.entries(supplierTypeLabels).map(([value, label]) => (\n                        <SelectItem key={value} value={value}>{label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            {/* è¯çµ¡è³‡è¨Š */}\n            <div className=\"space-y-4\">\n              <h3 className=\"text-sm font-medium text-morandi-primary\">è¯çµ¡è³‡è¨Š</h3>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">è¯çµ¡äºº *</label>\n                  <Input\n                    value={newSupplier.contact.contact_person}\n                    onChange={(e) => setNewSupplier(prev => ({\n                      ...prev,\n                      contact: { ...prev.contact, contact_person: e.target.value }\n                    }))}\n                    placeholder=\"è¯çµ¡äººå§“å\"\n                    className=\"mt-1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">é›»è©±</label>\n                  <Input\n                    value={newSupplier.contact.phone}\n                    onChange={(e) => setNewSupplier(prev => ({\n                      ...prev,\n                      contact: { ...prev.contact, phone: e.target.value }\n                    }))}\n                    placeholder=\"è¯çµ¡é›»è©±\"\n                    className=\"mt-1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">é›»å­ä¿¡ç®±</label>\n                  <Input\n                    type=\"email\"\n                    value={newSupplier.contact.email}\n                    onChange={(e) => setNewSupplier(prev => ({\n                      ...prev,\n                      contact: { ...prev.contact, email: e.target.value }\n                    }))}\n                    placeholder=\"example@email.com\"\n                    className=\"mt-1\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">ç¶²ç«™</label>\n                  <Input\n                    value={newSupplier.contact.website}\n                    onChange={(e) => setNewSupplier(prev => ({\n                      ...prev,\n                      contact: { ...prev.contact, website: e.target.value }\n                    }))}\n                    placeholder=\"https://...\"\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">åœ°å€</label>\n                <Input\n                  value={newSupplier.contact.address}\n                  onChange={(e) => setNewSupplier(prev => ({\n                    ...prev,\n                    contact: { ...prev.contact, address: e.target.value }\n                  }))}\n                  placeholder=\"å®Œæ•´åœ°å€\"\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n\n            {/* å‚™è¨» */}\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">å‚™è¨»</label>\n              <Input\n                value={newSupplier.note}\n                onChange={(e) => setNewSupplier(prev => ({ ...prev, note: e.target.value }))}\n                placeholder=\"ä¾›æ‡‰å•†å‚™è¨»è³‡è¨Š\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsAddDialogOpen(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleAddSupplier}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢ä¾›æ‡‰å•†\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/database/transport/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'regionOptionsMap' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedRegion' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":43},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'filterFunction'. Either include it or remove the dependency array.","line":177,"column":6,"nodeType":"ArrayExpression","endLine":177,"endColumn":46,"suggestions":[{"desc":"Update the dependencies array to be: [filterFunction, filteredAndSortedTransport]","fix":{"range":[5895,5935],"text":"[filterFunction, filteredAndSortedTransport]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transportId' is defined but never used. Allowed unused args must match /^_/u.","line":198,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":198,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":221,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6963,6966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6963,6966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Car, Edit, Trash2, Users, User } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { EnhancedTable, TableColumn, useEnhancedTable } from '@/components/ui/enhanced-table';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { cn } from '@/lib/utils';\nimport { getRegionOptions, regionOptionsMap, type RegionName, type TransportOption } from '@/data/region-options';\n\nexport default function TransportPage() {\n  const router = useRouter();\n  const [selectedRegion, setSelectedRegion] = useState<RegionName>('æ¸…é‚');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingTransport, setEditingTransport] = useState<TransportOption | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [newTransport, setNewTransport] = useState({\n    name: '',\n    price_per_person: 0,\n    pricePerGroup: 0,\n    capacity: 0,\n    is_group_cost: false\n  });\n\n  const currentOptions = getRegionOptions(selectedRegion);\n  const transportOptions = currentOptions.transport;\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'name',\n      label: 'äº¤é€šæ–¹å¼',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <div className=\"flex items-center\">\n          <Car size={16} className=\"mr-2 text-morandi-gold\" />\n          <span className=\"font-medium text-morandi-primary\">{value}</span>\n        </div>\n      )\n    },\n    {\n      key: 'is_group_cost',\n      label: 'é¡å‹',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { value: 'true', label: 'åœ˜é«”åˆ†æ”¤' },\n        { value: 'false', label: 'å€‹äººè²»ç”¨' }\n      ],\n      render: (value) => (\n        <span className={cn(\n          'inline-flex items-center px-2 py-1 rounded text-xs font-medium',\n          value\n            ? 'bg-morandi-gold text-white'\n            : 'bg-morandi-container text-morandi-secondary'\n        )}>\n          {value ? (\n            <>\n              <Users size={12} className=\"mr-1\" />\n              åœ˜é«”åˆ†æ”¤\n            </>\n          ) : (\n            <>\n              <User size={12} className=\"mr-1\" />\n              å€‹äººè²»ç”¨\n            </>\n          )}\n        </span>\n      )\n    },\n    {\n      key: 'price_per_person',\n      label: 'å€‹äººåƒ¹æ ¼',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">\n          {value ? `NT$ ${value}` : '-'}\n        </span>\n      )\n    },\n    {\n      key: 'pricePerGroup',\n      label: 'åœ˜é«”åƒ¹æ ¼',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">\n          {value ? `NT$ ${value}` : '-'}\n        </span>\n      )\n    },\n    {\n      key: 'capacity',\n      label: 'è¼‰å®¢é‡',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">\n          {value ? `${value} äºº` : '-'}\n        </span>\n      )\n    },\n    {\n      key: 'actions',\n      label: 'æ“ä½œ',\n      sortable: false,\n      filterable: false,\n      render: (_, row) => (\n        <div className=\"flex items-center space-x-2\">\n          <button\n            onClick={() => handleEditTransport(row)}\n            className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n            title=\"ç·¨è¼¯äº¤é€šé¸é …\"\n          >\n            <Edit size={14} className=\"text-morandi-gold\" />\n          </button>\n          <button\n            onClick={() => handleDeleteTransport(row.id)}\n            className=\"p-1 hover:bg-morandi-red/10 rounded transition-colors\"\n            title=\"åˆªé™¤äº¤é€šé¸é …\"\n          >\n            <Trash2 size={14} className=\"text-morandi-red\" />\n          </button>\n        </div>\n      )\n    }\n  ], []);\n\n  // æ’åºå’Œç¯©é¸å‡½æ•¸\n  const sortFunction = (data: TransportOption[], column: string, direction: 'asc' | 'desc') => {\n    return [...data].sort((a, b) => {\n      const aValue: string | number | boolean = a[column as keyof TransportOption] ?? '';\n      const bValue: string | number | boolean = b[column as keyof TransportOption] ?? '';\n\n      if (aValue < bValue) return direction === 'asc' ? -1 : 1;\n      if (aValue > bValue) return direction === 'asc' ? 1 : -1;\n      return 0;\n    });\n  };\n\n  const filterFunction = (data: TransportOption[], filters: Record<string, string>) => {\n    return data.filter(transport => {\n      // æœå°‹åŠŸèƒ½ï¼šæª¢æŸ¥åç¨±æ˜¯å¦åŒ…å«æœå°‹è©\n      const matchesSearch = !searchTerm || transport.name.toLowerCase().includes(searchTerm.toLowerCase());\n\n      return (\n        matchesSearch &&\n        (!filters.name || transport.name.toLowerCase().includes(filters.name.toLowerCase())) &&\n        (!filters.is_group_cost || (transport.is_group_cost ?? false).toString() === filters.is_group_cost) &&\n        (!filters.price_per_person || (transport.price_per_person || 0).toString().includes(filters.price_per_person)) &&\n        (!filters.pricePerGroup || (transport.pricePerGroup || 0).toString().includes(filters.pricePerGroup)) &&\n        (!filters.capacity || (transport.capacity || 0).toString().includes(filters.capacity))\n      );\n    });\n  };\n\n  const { data: filteredAndSortedTransport, handleSort, handleFilter } = useEnhancedTable(\n    transportOptions,\n    sortFunction,\n    filterFunction\n  );\n\n  // é‡æ–°è¨ˆç®—éæ¿¾çµæœï¼ˆç•¶æœå°‹è©æ”¹è®Šæ™‚ï¼‰\n  const finalFilteredTransport = useMemo(() => {\n    return filterFunction(filteredAndSortedTransport, {});\n  }, [filteredAndSortedTransport, searchTerm]);\n\n  const handleAddTransport = () => {\n    if (!newTransport.name.trim()) return;\n\n    // TODO: æ–°å¢äº¤é€šé¸é …åˆ°è³‡æ–™åº«\n    resetForm();\n  };\n\n  const handleEditTransport = (transport: TransportOption) => {\n    setEditingTransport(transport);\n    setNewTransport({\n      name: transport.name,\n      price_per_person: transport.price_per_person || 0,\n      pricePerGroup: transport.pricePerGroup || 0,\n      capacity: transport.capacity || 0,\n      is_group_cost: transport.is_group_cost || false\n    });\n    setIsAddDialogOpen(true);\n  };\n\n  const handleDeleteTransport = (transportId: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤äº¤é€šé¸é …å—ï¼Ÿ')) {\n      // TODO: åˆªé™¤äº¤é€šé¸é …å¾è³‡æ–™åº«\n    }\n  };\n\n  const resetForm = () => {\n    setNewTransport({\n      name: '',\n      price_per_person: 0,\n      pricePerGroup: 0,\n      capacity: 0,\n      is_group_cost: false\n    });\n    setIsAddDialogOpen(false);\n    setEditingTransport(null);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <ResponsiveHeader\n        {...{\n        title: \"äº¤é€šé¸é …ç®¡ç†\",\n        icon: Car} as any}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è³‡æ–™åº«ç®¡ç†', href: '/database' },\n          { label: 'äº¤é€šé¸é …', href: '/database/transport' }\n        ]}\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹äº¤é€šæ–¹å¼...\"\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢äº¤é€šé¸é …\"\n        actions={\n          <span className=\"text-sm text-morandi-secondary\">\n            å…± {finalFilteredTransport.length} ç­†äº¤é€šé¸é …\n          </span>\n        }\n      />\n\n      <ContentContainer>\n        <EnhancedTable\n          columns={tableColumns}\n          data={finalFilteredTransport}\n          onSort={handleSort}\n          onFilter={handleFilter}\n          selection={undefined}\n        />\n\n        {finalFilteredTransport.length === 0 && (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <Car size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p>{transportOptions.length === 0 ? 'æ­¤åœ°å€å°šæœªå»ºç«‹äº¤é€šé¸é …' : 'ç„¡ç¬¦åˆæ¢ä»¶çš„äº¤é€šé¸é …'}</p>\n          </div>\n        )}\n      </ContentContainer>\n\n      {/* æ–°å¢/ç·¨è¼¯äº¤é€šé¸é …å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={resetForm}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingTransport ? 'ç·¨è¼¯äº¤é€šé¸é …' : 'æ–°å¢äº¤é€šé¸é …'}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">äº¤é€šæ–¹å¼åç¨±</label>\n              <Input\n                value={newTransport.name}\n                onChange={(e) => setNewTransport(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"ä¾‹å¦‚ï¼šæ©Ÿå ´æ¥é€ã€åŒ…è»Šä¸€æ—¥\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">è²»ç”¨é¡å‹</label>\n              <Select\n                value={newTransport.is_group_cost.toString()}\n                onValueChange={(value) => setNewTransport(prev => ({ ...prev, is_group_cost: value === 'true' }))}\n              >\n                <SelectTrigger className=\"mt-1\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"false\">å€‹äººè²»ç”¨</SelectItem>\n                  <SelectItem value=\"true\">åœ˜é«”åˆ†æ”¤</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">å€‹äººåƒ¹æ ¼</label>\n                <Input\n                  type=\"number\"\n                  value={newTransport.price_per_person || ''}\n                  onChange={(e) => setNewTransport(prev => ({ ...prev, price_per_person: Number(e.target.value) || 0 }))}\n                  placeholder=\"0\"\n                  className=\"mt-1\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">åœ˜é«”åƒ¹æ ¼</label>\n                <Input\n                  type=\"number\"\n                  value={newTransport.pricePerGroup || ''}\n                  onChange={(e) => setNewTransport(prev => ({ ...prev, pricePerGroup: Number(e.target.value) || 0 }))}\n                  placeholder=\"0\"\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">è¼‰å®¢é‡</label>\n              <Input\n                type=\"number\"\n                value={newTransport.capacity || ''}\n                onChange={(e) => setNewTransport(prev => ({ ...prev, capacity: Number(e.target.value) || 0 }))}\n                placeholder=\"æœ€å¤§è¼‰å®¢äººæ•¸\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button variant=\"outline\" onClick={resetForm}>\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleAddTransport}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                {editingTransport ? 'æ›´æ–°' : 'æ–°å¢'}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/editor/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[477,480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[477,480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState } from \"react\";\nimport { ResponsiveHeader } from \"@/components/layout/responsive-header\";\nimport { TourForm } from \"@/components/editor/TourForm\";\nimport { TourPreview } from \"@/components/editor/TourPreview\";\nimport { PublishButton } from \"@/components/editor/PublishButton\";\nimport {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n} from \"@tabler/icons-react\";\n\n// Icon mapping\nconst iconMap: any = {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n};\n\nexport default function TourEditor() {\n  const [viewMode, setViewMode] = useState<'desktop' | 'mobile'>('desktop');\n  const [tourData, setTourData] = useState({\n    // å°é¢è³‡è¨Š\n    tagline: \"Venturo Travel 2025 ç§‹å­£ç²¾é¸\",\n    title: \"æ¼«éŠç¦å²¡\",\n    subtitle: \"åŠè‡ªç”±è¡Œ\",\n    description: \"2æ—¥å¸‚å€è‡ªç”±æ´»å‹• Â· ä¿è­‰å…¥ä½æº«æ³‰é£¯åº— Â· æŸ³å·éŠèˆ¹ Â· é˜¿è˜‡ç«å±±\",\n    departureDate: \"2025/10/21\",\n    tourCode: \"25JFO21CIG\",\n    coverImage: \"https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=1200&q=75&auto=format&fit=crop\",\n\n    // èˆªç­è³‡è¨Š\n    outboundFlight: {\n      airline: \"ä¸­è¯èˆªç©º\",\n      flightNumber: \"CI110\",\n      departureAirport: \"TPE\",\n      departureTime: \"06:50\",\n      departureDate: \"10/21\",\n      arrivalAirport: \"FUK\",\n      arrivalTime: \"09:55\",\n      duration: \"2å°æ™‚5åˆ†\",\n    },\n    returnFlight: {\n      airline: \"ä¸­è¯èˆªç©º\",\n      flightNumber: \"CI111\",\n      departureAirport: \"FUK\",\n      departureTime: \"11:00\",\n      departureDate: \"10/25\",\n      arrivalAirport: \"TPE\",\n      arrivalTime: \"12:30\",\n      duration: \"2å°æ™‚30åˆ†\",\n    },\n\n    // è¡Œç¨‹ç‰¹è‰²\n    features: [\n      {\n        icon: \"IconBuilding\",\n        title: \"æº«æ³‰é£¯åº—é«”é©—\",\n        description: \"ä¿è­‰å…¥ä½é˜¿è˜‡æº«æ³‰é£¯åº—ï¼Œäº«å—æ—¥å¼æº«æ³‰æ–‡åŒ–\",\n      },\n      {\n        icon: \"IconToolsKitchen2\",\n        title: \"ç¾é£Ÿé¥—å®´\",\n        description: \"åšå¤šæ‹‰éºµã€æŸ³å·é°»é­šé£¯ã€é•·è…³èŸ¹è‡ªåŠ©é¤\",\n      },\n      {\n        icon: \"IconSparkles\",\n        title: \"ç²¾é¸é«”é©—\",\n        description: \"æŸ³å·éŠèˆ¹ã€é˜¿è˜‡ç«å±±ã€å¤ªå®°åºœå¤©æ»¿å®®\",\n      },\n      {\n        icon: \"IconCalendar\",\n        title: \"è‡ªç”±æ´»å‹•æ™‚é–“\",\n        description: \"2æ—¥ç¦å²¡å¸‚å€è‡ªç”±æ¢ç´¢ï¼Œå½ˆæ€§å®‰æ’å€‹äººè¡Œç¨‹\",\n      },\n      {\n        icon: \"IconPlane\",\n        title: \"ç›´é£›èˆªç­\",\n        description: \"ä¸­è¯èˆªç©ºæ¡ƒåœ’ç›´é£›ç¦å²¡ï¼Œçœæ™‚ä¾¿åˆ©\",\n      },\n      {\n        icon: \"IconMapPin\",\n        title: \"å°ˆæ¥­é ˜éšŠ\",\n        description: \"ç¶“é©—è±å¯Œçš„é ˜éšŠå…¨ç¨‹é™ªåŒï¼Œè²¼å¿ƒæœå‹™\",\n      },\n    ],\n\n    // ç²¾é¸æ™¯é»\n    focusCards: [\n      {\n        title: \"ç”±å¸ƒé™¢æº«æ³‰è¡—\",\n        src: \"https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&q=75&auto=format\",\n      },\n      {\n        title: \"é˜¿è˜‡ç«å±±å£\",\n        src: \"https://images.unsplash.com/photo-1578469550956-0e16b69c6a3d?w=400&q=75&auto=format\",\n      },\n      {\n        title: \"æŸ³å·æ°´é„‰\",\n        src: \"https://images.unsplash.com/photo-1528360983277-13d401cdc186?w=400&q=75&auto=format\",\n      },\n      {\n        title: \"å¤ªå®°åºœç¥ç¤¾\",\n        src: \"https://images.unsplash.com/photo-1624253321033-c4eb104e7462?w=400&q=75&auto=format\",\n      },\n    ],\n\n    // é ˜éšŠè³‡è¨Š\n    leader: {\n      name: \"é¾æƒ å¦‚ å°å§\",\n      domesticPhone: \"+886 0928402897\",\n      overseasPhone: \"+81 08074371189\",\n    },\n\n    // é›†åˆè³‡è¨Š\n    meetingInfo: {\n      time: \"2025/10/21 04:50\",\n      location: \"æ¡ƒåœ’æ©Ÿå ´è¯èˆªç¬¬äºŒèˆªå»ˆ 7è™Ÿæ«ƒå°\",\n    },\n\n    // è¡Œç¨‹å‰¯æ¨™é¡Œ\n    itinerarySubtitle: \"5å¤©4å¤œç²¾å½©æ—…ç¨‹è¦åŠƒ\",\n\n    // é€æ—¥è¡Œç¨‹\n    dailyItinerary: [\n      {\n        dayLabel: \"Day 1\",\n        date: \"10/21 (äºŒ)\",\n        title: \"å°åŒ— âœˆ ç¦å²¡ç©ºæ¸¯ â†’ ç”±å¸ƒé™¢ Â· é‡‘éºŸæ¹– â†’ é˜¿è˜‡æº«æ³‰\",\n        highlight: \"âœ¨ ç‰¹åˆ¥å®‰æ’ï¼šç”±å¸ƒé™¢ Â· é‡‘éºŸæ¹– ï½ æ—¥æœ¬ OL äººæ°£ NO.1 æ•£ç­–åœ°\",\n        description: \"é›†åˆæ–¼å°ç£æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ï¼Œç”±å°ˆäººè¾¦ç†å‡ºå¢ƒæ‰‹çºŒï¼Œæ­ä¹˜è±ªè¯å®¢æ©Ÿï¼Œé£›å¾€æ—¥æœ¬ä¹å·ç„é—œâ”€â”€ç¦å²¡ã€‚\",\n        activities: [],\n        recommendations: [],\n        meals: {\n          breakfast: \"æº«æš–çš„å®¶\",\n          lunch: \"åšå¤šæ‹‰éºµ (Â¥1000)\",\n          dinner: \"é•·è…³èŸ¹è‡ªåŠ©é¤\",\n        },\n        accommodation: \"ASO RESORT GRANDVRIO HOTEL\",\n      },\n      {\n        dayLabel: \"Day 2\",\n        date: \"10/22 (ä¸‰)\",\n        title: \"é˜¿è˜‡ç«å±± â†’ æŸ³å·éŠèˆ¹ â†’ æ—…äººåˆ—è»Š â†’ å¤ªå®°åºœå¤©æ»¿å®®\",\n        highlight: \"\",\n        description: \"\",\n        activities: [\n          { icon: \"ğŸŒ‹\", title: \"é˜¿è˜‡ç«å±±\", description: \"è¿‘è·é›¢è§€è³æ´»ç«å±±å£¯éº—æ™¯è§€\" },\n          { icon: \"ğŸš£\", title: \"æŸ³å·éŠèˆ¹\", description: \"ä¹˜èˆ¹éŠè¦½æ°´é„‰é¢¨æƒ…\" },\n          { icon: \"ğŸšƒ\", title: \"æ—…äººåˆ—è»Š\", description: \"é«”é©—æ—¥å¼é¢¨æƒ…åˆ—è»Š\" },\n          { icon: \"â›©ï¸\", title: \"å¤ªå®°åºœå¤©æ»¿å®®\", description: \"åƒæ‹œå­¸å•ä¹‹ç¥\" },\n        ],\n        recommendations: [],\n        meals: {\n          breakfast: \"é£¯åº—å…§æ—©é¤\",\n          lunch: \"æŸ³å·é°»é­šé£¯ (Â¥2400)\",\n          dinner: \"æ¶®æ¶®é‹åƒåˆ°é£½\",\n        },\n        accommodation: \"QUINTESSA HOTEL FUKUOKA TENJIN MINAMI\",\n      },\n      {\n        dayLabel: \"Day 3-4\",\n        date: \"10/23-10/24\",\n        title: \"ç¦å²¡å…¨æ—¥è‡ªç”±æ´»å‹•\",\n        highlight: \"\",\n        description: \"\",\n        activities: [],\n        recommendations: [\n          \"å¤©ç¥å•†åœˆè³¼ç‰©\",\n          \"ç¦å²¡å¡”\",\n          \"é›…è™å·¨è›‹\",\n          \"é³¥æ – PREMIUM OUTLET\",\n          \"é–€å¸æ¸¯æ‡·èˆŠè¡—é“\",\n        ],\n        meals: {\n          breakfast: \"é£¯åº—å…§æ—©é¤\",\n          lunch: \"æ•¬è«‹è‡ªç†\",\n          dinner: \"æ•¬è«‹è‡ªç†\",\n        },\n        accommodation: \"QUINTESSA HOTEL FUKUOKA TENJIN MINAMI\",\n      },\n      {\n        dayLabel: \"Day 5\",\n        date: \"10/25 (å…­)\",\n        title: \"ç¦å²¡ç©ºæ¸¯ âœˆ å°åŒ—\",\n        highlight: \"\",\n        description: \"äº«å—ä¸€å€‹æ²’æœ‰ MORNING CALL çš„æ—©æ™¨ï¼Œæ‚ é–’çš„é£¯åº—ç”¨å®Œæ—©é¤å¾Œï¼Œæ¥è‘—å‰å¾€ç¦å²¡ç©ºæ¸¯ï¼Œæ­ä¹˜è±ªè¯å®¢æ©Ÿè¿”å›å°åŒ—ï¼ŒçµæŸäº†æ„‰å¿«çš„ä¹å·ä¹‹æ—…ã€‚\",\n        activities: [],\n        recommendations: [],\n        meals: {\n          breakfast: \"é£¯åº—å…§æ—©é¤\",\n          lunch: \"æ©Ÿä¸Šé¤é£Ÿ\",\n          dinner: \"æº«æš–çš„å®¶\",\n        },\n        accommodation: \"\",\n      },\n    ],\n  });\n\n  // Convert icon strings to components for preview\n  const processedData = {\n    ...tourData,\n    features: tourData.features.map((f) => ({\n      ...f,\n      iconComponent: iconMap[f.icon] || IconSparkles,\n    })),\n  };\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* ========== é é¢é ‚éƒ¨å€åŸŸ ========== */}\n      <ResponsiveHeader\n        title=\"è¡Œç¨‹ç·¨è¼¯å™¨\"\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è¡Œç¨‹ç·¨è¼¯å™¨', href: '/editor' }\n        ]}\n        actions={<PublishButton data={processedData} />}\n      />\n\n      {/* ========== ä¸»è¦å…§å®¹å€åŸŸ ========== */}\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"h-full flex\">\n          {/* å·¦å´ï¼šè¼¸å…¥è¡¨å–® */}\n          <div className=\"w-1/2 bg-white border-r border-slate-200 dark:bg-slate-900 dark:border-slate-700 flex flex-col\">\n            <div className=\"bg-gradient-to-r from-amber-500 to-orange-500 text-white px-6 py-3\">\n              <h2 className=\"text-lg font-bold\">ç·¨è¼¯è¡¨å–®</h2>\n            </div>\n            <div className=\"flex-1 overflow-y-auto\">\n              <TourForm data={tourData} onChange={setTourData} />\n            </div>\n          </div>\n\n          {/* å³å´ï¼šå³æ™‚é è¦½ */}\n          <div className=\"w-1/2 bg-slate-50 dark:bg-slate-800 flex flex-col\">\n            <div className=\"bg-slate-800 dark:bg-slate-900 text-white px-6 py-3 flex items-center justify-between border-b border-slate-700\">\n              <div className=\"flex items-center gap-4\">\n                <h2 className=\"text-lg font-bold\">å³æ™‚é è¦½</h2>\n                <div className=\"flex gap-2 bg-slate-700 dark:bg-slate-800 rounded-lg p-1\">\n                  <button\n                    onClick={() => setViewMode('desktop')}\n                    className={`px-3 py-1.5 rounded text-sm font-medium transition-all ${\n                      viewMode === 'desktop'\n                        ? 'bg-blue-600 text-white shadow-sm'\n                        : 'text-slate-300 hover:text-white hover:bg-slate-600'\n                    }`}\n                  >\n                    ğŸ’» é›»è…¦\n                  </button>\n                  <button\n                    onClick={() => setViewMode('mobile')}\n                    className={`px-3 py-1.5 rounded text-sm font-medium transition-all ${\n                      viewMode === 'mobile'\n                        ? 'bg-blue-600 text-white shadow-sm'\n                        : 'text-slate-300 hover:text-white hover:bg-slate-600'\n                    }`}\n                  >\n                    ğŸ“± æ‰‹æ©Ÿ\n                  </button>\n                </div>\n              </div>\n            </div>\n            <div className=\"flex-1 overflow-hidden bg-slate-200 dark:bg-slate-700 flex items-center justify-center p-4\">\n              <div\n                className={`bg-white dark:bg-slate-900 h-full transition-all duration-300 rounded-lg shadow-xl ${\n                  viewMode === 'mobile' ? 'w-[375px]' : 'w-full'\n                }`}\n                style={{\n                  maxWidth: viewMode === 'mobile' ? '375px' : '100%',\n                }}\n              >\n                <div className=\"h-full overflow-hidden rounded-lg\">\n                  <TourPreview data={processedData} />\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tours' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'orders' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[703,706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[703,706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport Link from 'next/link';\nimport { useMemo } from 'react';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Card } from '@/components/ui/card';\nimport { EnhancedTable, TableColumn } from '@/components/ui/enhanced-table';\nimport { useTourStore, useOrderStore } from '@/stores';\n// TODO: usePaymentStore deprecated - æ”¶æ¬¾/ä»˜æ¬¾è¨˜éŒ„åŠŸèƒ½æœªå¯¦ä½œ\nimport {\n  CreditCard,\n  FileText,\n  Wallet,\n  BarChart3,\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  AlertTriangle\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function FinancePage() {\n  const { items: tours } = useTourStore();\n  const { items: orders } = useOrderStore();\n  const payments: any[] = []; // TODO: å¯¦ä½œæ”¶æ¬¾/ä»˜æ¬¾è¨˜éŒ„åŠŸèƒ½\n\n  // è¨ˆç®—è²¡å‹™çµ±è¨ˆ\n  const totalReceivable = payments\n    .filter(p => p.type === 'æ”¶æ¬¾')\n    .reduce((sum, p) => sum + p.amount, 0);\n\n  const totalPayable = payments\n    .filter(p => p.type === 'è«‹æ¬¾')\n    .reduce((sum, p) => sum + p.amount, 0);\n\n  const pendingPayments = payments\n    .filter(p => p.status === 'å¾…ç¢ºèª')\n    .reduce((sum, p) => sum + p.amount, 0);\n\n  const netProfit = totalReceivable - totalPayable;\n\n  // æœ€è¿‘äº¤æ˜“è¡¨æ ¼é…ç½®\n  const recentPayments = payments.slice(0, 10); // é¡¯ç¤ºæœ€è¿‘10ç­†\n\n  const transactionColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'type',\n      label: 'é¡å‹',\n      sortable: true,\n      render: (value, payment) => {\n        const typeIcons = {\n          'æ”¶æ¬¾': <TrendingUp size={16} className=\"text-morandi-green\" />,\n          'è«‹æ¬¾': <TrendingDown size={16} className=\"text-morandi-red\" />,\n          'å‡ºç´': <DollarSign size={16} className=\"text-morandi-gold\" />\n        };\n        return (\n          <div className=\"flex items-center space-x-2\">\n            {typeIcons[payment.type as keyof typeof typeIcons]}\n            <span className=\"text-sm\">{payment.type}</span>\n          </div>\n        );\n      }\n    },\n    {\n      key: 'description',\n      label: 'èªªæ˜',\n      sortable: true,\n      render: (value, payment) => (\n        <span className=\"text-sm text-morandi-primary\">{payment.description}</span>\n      )\n    },\n    {\n      key: 'amount',\n      label: 'é‡‘é¡',\n      sortable: true,\n      render: (value, payment) => {\n        const isIncome = payment.type === 'æ”¶æ¬¾';\n        return (\n          <span className={cn(\n            'text-sm font-medium',\n            isIncome ? 'text-morandi-green' : 'text-morandi-red'\n          )}>\n            {isIncome ? '+' : '-'} NT$ {payment.amount.toLocaleString()}\n          </span>\n        );\n      }\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      render: (value, payment) => {\n        const statusColors = {\n          'å·²ç¢ºèª': 'text-morandi-green',\n          'å¾…ç¢ºèª': 'text-morandi-gold',\n          'å·²å®Œæˆ': 'text-morandi-primary'\n        };\n        return (\n          <span className={cn('text-sm', statusColors[payment.status as keyof typeof statusColors])}>\n            {payment.status}\n          </span>\n        );\n      }\n    },\n    {\n      key: 'created_at',\n      label: 'æ—¥æœŸ',\n      sortable: true,\n      render: (value, payment) => (\n        <span className=\"text-sm text-morandi-secondary\">\n          {new Date(payment.created_at).toLocaleDateString()}\n        </span>\n      )\n    }\n  ], []);\n\n  const financeModules = [\n    {\n      title: 'è²¡å‹™ç®¡ç†',\n      description: 'ç®¡ç†æ‰€æœ‰æ”¶æ¬¾å’Œè«‹æ¬¾è¨˜éŒ„',\n      icon: CreditCard,\n      href: '/finance/payments',\n      stats: `${payments.length} ç­†è¨˜éŒ„`,\n      color: 'text-morandi-green',\n      bgColor: 'bg-morandi-green/10'\n    },\n    {\n      title: 'å‡ºç´ç®¡ç†',\n      description: 'æ—¥å¸¸æ”¶æ”¯èˆ‡ç¾é‡‘æµç®¡ç†',\n      icon: Wallet,\n      href: '/finance/treasury',\n      stats: `${payments.filter(p => p.type === 'å‡ºç´').length} ç­†äº¤æ˜“`,\n      color: 'text-morandi-gold',\n      bgColor: 'bg-morandi-gold/10'\n    },\n    {\n      title: 'å ±è¡¨ç®¡ç†',\n      description: 'è²¡å‹™åˆ†æèˆ‡çµ±è¨ˆå ±è¡¨',\n      icon: BarChart3,\n      href: '/finance/reports',\n      stats: 'å³æ™‚è²¡å‹™åˆ†æ',\n      color: 'text-morandi-primary',\n      bgColor: 'bg-morandi-primary/10'\n    }\n  ];\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader title=\"è²¡å‹™ç®¡ç†ä¸­å¿ƒ\" />\n\n      <div className=\"flex-1 overflow-auto\">\n        <div className=\"space-y-6\">\n          {/* è²¡å‹™ç¸½è¦½ */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n        <Card className=\"p-4 border border-border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-morandi-secondary mb-1\">ç¸½æ”¶å…¥</p>\n              <p className=\"text-2xl font-bold text-morandi-green\">\n                NT$ {totalReceivable.toLocaleString()}\n              </p>\n            </div>\n            <TrendingUp size={24} className=\"text-morandi-green\" />\n          </div>\n        </Card>\n\n        <Card className=\"p-4 border border-border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-morandi-secondary mb-1\">ç¸½æ”¯å‡º</p>\n              <p className=\"text-2xl font-bold text-morandi-red\">\n                NT$ {totalPayable.toLocaleString()}\n              </p>\n            </div>\n            <TrendingDown size={24} className=\"text-morandi-red\" />\n          </div>\n        </Card>\n\n        <Card className=\"p-4 border border-border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-morandi-secondary mb-1\">æ·¨åˆ©æ½¤</p>\n              <p className={`text-2xl font-bold ${netProfit >= 0 ? 'text-morandi-green' : 'text-morandi-red'}`}>\n                NT$ {netProfit.toLocaleString()}\n              </p>\n            </div>\n            <DollarSign size={24} className={netProfit >= 0 ? 'text-morandi-green' : 'text-morandi-red'} />\n          </div>\n        </Card>\n\n        <Card className=\"p-4 border border-border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-morandi-secondary mb-1\">å¾…ç¢ºèªæ¬¾é …</p>\n              <p className=\"text-2xl font-bold text-morandi-gold\">\n                NT$ {pendingPayments.toLocaleString()}\n              </p>\n            </div>\n            <AlertTriangle size={24} className=\"text-morandi-gold\" />\n          </div>\n        </Card>\n      </div>\n\n      {/* åŠŸèƒ½æ¨¡çµ„ */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {financeModules.map((module, index) => (\n          <Link key={index} href={module.href}>\n            <Card className=\"p-6 border border-border hover:shadow-lg transition-shadow cursor-pointer\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center mb-3\">\n                    <div className={`p-2 rounded-lg ${module.bgColor} mr-3`}>\n                      <module.icon size={24} className={module.color} />\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold text-morandi-primary\">{module.title}</h4>\n                      <p className=\"text-sm text-morandi-secondary\">{module.description}</p>\n                    </div>\n                  </div>\n                  <div className=\"text-sm text-morandi-secondary\">\n                    {module.stats}\n                  </div>\n                </div>\n              </div>\n            </Card>\n          </Link>\n        ))}\n      </div>\n\n      {/* æœ€è¿‘äº¤æ˜“ */}\n      <div className=\"space-y-4\">\n        <h3 className=\"text-lg font-semibold text-morandi-primary\">æœ€è¿‘äº¤æ˜“</h3>\n        <EnhancedTable\n          columns={transactionColumns}\n          data={recentPayments}\n        />\n      </div>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/payments/new/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ArrowLeft' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card } from '@/components/ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useOrderStore } from '@/stores';\nimport { CreditCard, Plus, Trash2, ArrowLeft } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\n// æ”¶æ¬¾æ–¹å¼é¸é …\nconst paymentMethods = [\n  { value: 'ç¾é‡‘', label: 'ç¾é‡‘' },\n  { value: 'åŒ¯æ¬¾', label: 'åŒ¯æ¬¾' },\n  { value: 'åˆ·å¡', label: 'åˆ·å¡' },\n  { value: 'æ”¯ç¥¨', label: 'æ”¯ç¥¨' }\n];\n\n// å¸³æˆ¶é¸é …\nconst bankAccounts = [\n  { value: 'bank1', label: 'å°ç£éŠ€è¡Œ - 001234567' },\n  { value: 'bank2', label: 'åœ‹æ³°ä¸–è¯ - 987654321' },\n  { value: 'bank3', label: 'ç‰å±±éŠ€è¡Œ - 555666777' }\n];\n\ninterface PaymentItem {\n  id: string;\n  paymentMethod: string;\n  amount: number;\n  transactionDate: string;\n  handlerName?: string;\n  accountInfo?: string;\n  fees?: number;\n  cardLastFour?: string;\n  authCode?: string;\n  checkNumber?: string;\n  checkBank?: string;\n  note?: string;\n}\n\nexport default function NewReceiptPage() {\n  const router = useRouter();\n  const { items: orders } = useOrderStore();\n\n  // åŸºæœ¬è¡¨å–®ç‹€æ…‹\n  const [selectedOrderId, setSelectedOrderId] = useState('');\n  const [receiptDate, setReceiptDate] = useState(new Date().toISOString().split('T')[0]);\n  const [note, setNote] = useState('');\n\n  // æ”¶æ¬¾é …ç›®\n  const [paymentItems, setPaymentItems] = useState<PaymentItem[]>([\n    {\n      id: '1',\n      paymentMethod: 'ç¾é‡‘',\n      amount: 0,\n      transactionDate: new Date().toISOString().split('T')[0]\n    }\n  ]);\n\n  // éæ¿¾å¯ç”¨è¨‚å–®ï¼ˆæœªæ”¶æ¬¾æˆ–éƒ¨åˆ†æ”¶æ¬¾ï¼‰\n  const availableOrders = useMemo(() => {\n    return orders.filter(order =>\n      order.payment_status === 'unpaid' || order.payment_status === 'partial'\n    );\n  }, [orders]);\n\n  // é¸ä¸­çš„è¨‚å–®è³‡è¨Š\n  const selectedOrder = useMemo(() => {\n    return orders.find(order => order.id === selectedOrderId);\n  }, [orders, selectedOrderId]);\n\n  // è¨ˆç®—ç¸½æ”¶æ¬¾é‡‘é¡\n  const total_amount = useMemo(() => {\n    return paymentItems.reduce((sum, item) => sum + (item.amount || 0), 0);\n  }, [paymentItems]);\n\n  // æ–°å¢æ”¶æ¬¾é …ç›®\n  const addPaymentItem = () => {\n    const newItem: PaymentItem = {\n      id: Date.now().toString(),\n      paymentMethod: 'ç¾é‡‘',\n      amount: 0,\n      transactionDate: new Date().toISOString().split('T')[0]\n    };\n    setPaymentItems(prev => [...prev, newItem]);\n  };\n\n  // ç§»é™¤æ”¶æ¬¾é …ç›®\n  const removePaymentItem = (id: string) => {\n    if (paymentItems.length > 1) {\n      setPaymentItems(prev => prev.filter(item => item.id !== id));\n    }\n  };\n\n  // æ›´æ–°æ”¶æ¬¾é …ç›®\n  const updatePaymentItem = (id: string, updates: Partial<PaymentItem>) => {\n    setPaymentItems(prev => prev.map(item =>\n      item.id === id ? { ...item, ...updates } : item\n    ));\n  };\n\n  // è™•ç†å„²å­˜\n  const handleSave = () => {\n    if (!selectedOrderId || paymentItems.length === 0 || total_amount <= 0) {\n      alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');\n      return;\n    }\n\n    // é€™è£¡æ‡‰è©²è¦ä¿å­˜åˆ° store æˆ– API\n    // TODO: ä¿å­˜æ”¶æ¬¾å–®åˆ° store æˆ– API\n\n    // å„²å­˜æˆåŠŸå¾Œå›åˆ°åˆ—è¡¨é \n    router.push('/finance/payments');\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <ResponsiveHeader\n        title=\"æ–°å¢æ”¶æ¬¾å–®\"\n        icon={CreditCard}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è²¡å‹™ç³»çµ±', href: '/finance' },\n          { label: 'æ”¶æ¬¾ç®¡ç†', href: '/finance/payments' },\n          { label: 'æ–°å¢æ”¶æ¬¾å–®', href: '/finance/payments/new' }\n        ]}\n        showBackButton={true}\n        onBack={() => router.push('/finance/payments')}\n      />\n\n      <div className=\"max-w-4xl mx-auto space-y-6\">\n        {/* åŸºæœ¬è³‡è¨Š */}\n        <Card className=\"p-6\">\n          <h2 className=\"text-lg font-semibold mb-4\">åŸºæœ¬è³‡è¨Š</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é¸æ“‡è¨‚å–®</label>\n              <Select value={selectedOrderId} onValueChange={setSelectedOrderId}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"è«‹é¸æ“‡å¾…æ”¶æ¬¾çš„è¨‚å–®...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {availableOrders.map(order => (\n                    <SelectItem key={order.id} value={order.id}>\n                      <div>\n                        <div className=\"font-medium\">{order.order_number} - {order.tour_name}</div>\n                        <div className=\"text-sm text-morandi-secondary\">\n                          {order.contact_person} | å¾…æ”¶: NT$ {order.remaining_amount?.toLocaleString() || 0}\n                        </div>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾æ—¥æœŸ</label>\n              <Input\n                type=\"date\"\n                value={receiptDate}\n                onChange={(e) => setReceiptDate(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾å–®è™Ÿ</label>\n              <Input\n                value=\"REC-2024004ï¼ˆè‡ªå‹•ç”¢ç”Ÿï¼‰\"\n                disabled\n                className=\"bg-morandi-container/30\"\n              />\n            </div>\n\n            {selectedOrder && (\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">å¾…æ”¶é‡‘é¡</label>\n                <Input\n                  value={`NT$ ${selectedOrder.remaining_amount?.toLocaleString() || 0}`}\n                  disabled\n                  className=\"bg-morandi-container/30\"\n                />\n              </div>\n            )}\n          </div>\n        </Card>\n\n        {/* æ”¶æ¬¾é …ç›® */}\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-lg font-semibold\">æ”¶æ¬¾é …ç›®</h2>\n            <Button onClick={addPaymentItem} variant=\"outline\">\n              <Plus size={16} className=\"mr-2\" />\n              æ–°å¢é …ç›®\n            </Button>\n          </div>\n\n          <div className=\"space-y-4\">\n            {paymentItems.map((item, index) => (\n              <div key={item.id} className=\"border border-border rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"font-medium\">æ”¶æ¬¾é …ç›® {index + 1}</h3>\n                  {paymentItems.length > 1 && (\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => removePaymentItem(item.id)}\n                      className=\"text-morandi-red hover:text-morandi-red/80\"\n                    >\n                      <Trash2 size={16} />\n                    </Button>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾æ–¹å¼</label>\n                    <Select\n                      value={item.paymentMethod}\n                      onValueChange={(value) => updatePaymentItem(item.id, { paymentMethod: value })}\n                    >\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {paymentMethods.map(method => (\n                          <SelectItem key={method.value} value={method.value}>\n                            {method.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div>\n                    <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é‡‘é¡</label>\n                    <Input\n                      type=\"number\"\n                      value={item.amount || ''}\n                      onChange={(e) => updatePaymentItem(item.id, { amount: Number(e.target.value) })}\n                      placeholder=\"è«‹è¼¸å…¥æ”¶æ¬¾é‡‘é¡\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">äº¤æ˜“æ—¥æœŸ</label>\n                    <Input\n                      type=\"date\"\n                      value={item.transactionDate}\n                      onChange={(e) => updatePaymentItem(item.id, { transactionDate: e.target.value })}\n                    />\n                  </div>\n\n                  {/* æ ¹æ“šæ”¶æ¬¾æ–¹å¼é¡¯ç¤ºé¡å¤–æ¬„ä½ */}\n                  {item.paymentMethod === 'ç¾é‡‘' && (\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">ç¶“æ‰‹äºº</label>\n                      <Input\n                        value={item.handlerName || ''}\n                        onChange={(e) => updatePaymentItem(item.id, { handlerName: e.target.value })}\n                        placeholder=\"è«‹è¼¸å…¥ç¶“æ‰‹äººå§“å\"\n                      />\n                    </div>\n                  )}\n\n                  {item.paymentMethod === 'åŒ¯æ¬¾' && (\n                    <>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">åŒ¯å…¥å¸³æˆ¶</label>\n                        <Select\n                          value={item.accountInfo || ''}\n                          onValueChange={(value) => updatePaymentItem(item.id, { accountInfo: value })}\n                        >\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"è«‹é¸æ“‡å¸³æˆ¶\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {bankAccounts.map(account => (\n                              <SelectItem key={account.value} value={account.label}>\n                                {account.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ‰‹çºŒè²»</label>\n                        <Input\n                          type=\"number\"\n                          value={item.fees || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { fees: Number(e.target.value) })}\n                          placeholder=\"æ‰‹çºŒè²»é‡‘é¡\"\n                        />\n                      </div>\n                    </>\n                  )}\n\n                  {item.paymentMethod === 'åˆ·å¡' && (\n                    <>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">å¡è™Ÿå¾Œå››ç¢¼</label>\n                        <Input\n                          value={item.cardLastFour || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { cardLastFour: e.target.value })}\n                          placeholder=\"****\"\n                          maxLength={4}\n                        />\n                      </div>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æˆæ¬Šç¢¼</label>\n                        <Input\n                          value={item.authCode || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { authCode: e.target.value })}\n                          placeholder=\"æˆæ¬Šç¢¼\"\n                        />\n                      </div>\n                    </>\n                  )}\n\n                  {item.paymentMethod === 'æ”¯ç¥¨' && (\n                    <>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¯ç¥¨è™Ÿç¢¼</label>\n                        <Input\n                          value={item.checkNumber || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { checkNumber: e.target.value })}\n                          placeholder=\"æ”¯ç¥¨è™Ÿç¢¼\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é–‹ç¥¨éŠ€è¡Œ</label>\n                        <Input\n                          value={item.checkBank || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { checkBank: e.target.value })}\n                          placeholder=\"é–‹ç¥¨éŠ€è¡Œ\"\n                        />\n                      </div>\n                    </>\n                  )}\n\n                  <div className=\"md:col-span-3\">\n                    <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">å‚™è¨»</label>\n                    <Input\n                      value={item.note || ''}\n                      onChange={(e) => updatePaymentItem(item.id, { note: e.target.value })}\n                      placeholder=\"æ”¶æ¬¾å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n                    />\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </Card>\n\n        {/* æ‘˜è¦å’Œå‚™è¨» */}\n        <Card className=\"p-6\">\n          <h2 className=\"text-lg font-semibold mb-4\">æ”¶æ¬¾æ‘˜è¦</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">ç¸½æ”¶æ¬¾é‡‘é¡</label>\n              <Input\n                value={`NT$ ${total_amount.toLocaleString()}`}\n                disabled\n                className=\"bg-morandi-container/30 text-lg font-medium\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾å¾Œç‹€æ…‹</label>\n              <Input\n                value={selectedOrder ?\n                  (total_amount >= (selectedOrder.remaining_amount || 0) ? 'å·²æ”¶æ¬¾' : 'éƒ¨åˆ†æ”¶æ¬¾')\n                  : 'è«‹é¸æ“‡è¨‚å–®'}\n                disabled\n                className=\"bg-morandi-container/30\"\n              />\n            </div>\n\n            <div className=\"md:col-span-2\">\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾å–®å‚™è¨»</label>\n              <textarea\n                value={note}\n                onChange={(e) => setNote(e.target.value)}\n                placeholder=\"æ•´å¼µæ”¶æ¬¾å–®çš„å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n                className=\"w-full p-3 border border-border rounded-lg resize-none h-20\"\n              />\n            </div>\n          </div>\n        </Card>\n\n        {/* æ“ä½œæŒ‰éˆ• */}\n        <div className=\"flex justify-end gap-4 pb-6\">\n          <Button\n            variant=\"outline\"\n            onClick={() => router.push('/finance/payments')}\n          >\n            å–æ¶ˆ\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={!selectedOrderId || total_amount <= 0}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n          >\n            å„²å­˜æ”¶æ¬¾å–®\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/payments/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1415,1418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1415,1418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { EnhancedTable } from '@/components/ui/enhanced-table';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useOrderStore } from '@/stores';\n// TODO: usePaymentStore deprecated - æ”¶æ¬¾è¨˜éŒ„åŠŸèƒ½æœªå¯¦ä½œ\nimport { CreditCard, Calendar, Plus, Trash2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\n// æ”¶æ¬¾æ–¹å¼é¸é …\nconst paymentMethods = [\n  { value: 'ç¾é‡‘', label: 'ç¾é‡‘' },\n  { value: 'åŒ¯æ¬¾', label: 'åŒ¯æ¬¾' },\n  { value: 'åˆ·å¡', label: 'åˆ·å¡' },\n  { value: 'æ”¯ç¥¨', label: 'æ”¯ç¥¨' }\n];\n\n// å¸³æˆ¶é¸é …\nconst bankAccounts = [\n  { value: 'bank1', label: 'å°ç£éŠ€è¡Œ - 001234567' },\n  { value: 'bank2', label: 'åœ‹æ³°ä¸–è¯ - 987654321' },\n  { value: 'bank3', label: 'ç‰å±±éŠ€è¡Œ - 555666777' }\n];\n\ninterface PaymentItem {\n  id: string;\n  paymentMethod: string;\n  amount: number;\n  transactionDate: string;\n  handlerName?: string;\n  accountInfo?: string;\n  fees?: number;\n  cardLastFour?: string;\n  authCode?: string;\n  checkNumber?: string;\n  checkBank?: string;\n  note?: string;\n}\n\nexport default function PaymentsPage() {\n  const { items: orders } = useOrderStore();\n  const payments: any[] = []; // TODO: å¯¦ä½œæ”¶æ¬¾è¨˜éŒ„åŠŸèƒ½\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  // åªå–æ”¶æ¬¾è¨˜éŒ„\n  const paymentRecords = payments.filter(p => p.type === 'æ”¶æ¬¾');\n\n  // è¡¨å–®ç‹€æ…‹\n  const [selectedOrderId, setSelectedOrderId] = useState('');\n  const [receiptDate, setReceiptDate] = useState(new Date().toISOString().split('T')[0]);\n  const [note, setNote] = useState('');\n  const [paymentItems, setPaymentItems] = useState<PaymentItem[]>([\n    {\n      id: '1',\n      paymentMethod: 'ç¾é‡‘',\n      amount: 0,\n      transactionDate: new Date().toISOString().split('T')[0]\n    }\n  ]);\n\n  // éæ¿¾å¯ç”¨è¨‚å–®ï¼ˆæœªæ”¶æ¬¾æˆ–éƒ¨åˆ†æ”¶æ¬¾ï¼‰\n  const availableOrders = useMemo(() => {\n    return orders.filter(order =>\n      order.payment_status === 'unpaid' || order.payment_status === 'partial'\n    );\n  }, [orders]);\n\n  // é¸ä¸­çš„è¨‚å–®è³‡è¨Š\n  const selectedOrder = useMemo(() => {\n    return orders.find(order => order.id === selectedOrderId);\n  }, [orders, selectedOrderId]);\n\n  // è¨ˆç®—ç¸½æ”¶æ¬¾é‡‘é¡\n  const total_amount = useMemo(() => {\n    return paymentItems.reduce((sum, item) => sum + (item.amount || 0), 0);\n  }, [paymentItems]);\n\n  // æ–°å¢æ”¶æ¬¾é …ç›®\n  const addPaymentItem = () => {\n    const newItem: PaymentItem = {\n      id: Date.now().toString(),\n      paymentMethod: 'ç¾é‡‘',\n      amount: 0,\n      transactionDate: new Date().toISOString().split('T')[0]\n    };\n    setPaymentItems(prev => [...prev, newItem]);\n  };\n\n  // ç§»é™¤æ”¶æ¬¾é …ç›®\n  const removePaymentItem = (id: string) => {\n    if (paymentItems.length > 1) {\n      setPaymentItems(prev => prev.filter(item => item.id !== id));\n    }\n  };\n\n  // æ›´æ–°æ”¶æ¬¾é …ç›®\n  const updatePaymentItem = (id: string, updates: Partial<PaymentItem>) => {\n    setPaymentItems(prev => prev.map(item =>\n      item.id === id ? { ...item, ...updates } : item\n    ));\n  };\n\n  // é‡ç½®è¡¨å–®\n  const resetForm = () => {\n    setSelectedOrderId('');\n    setReceiptDate(new Date().toISOString().split('T')[0]);\n    setNote('');\n    setPaymentItems([\n      {\n        id: '1',\n        paymentMethod: 'ç¾é‡‘',\n        amount: 0,\n        transactionDate: new Date().toISOString().split('T')[0]\n      }\n    ]);\n  };\n\n  // è™•ç†å„²å­˜\n  const handleSave = () => {\n    if (!selectedOrderId || paymentItems.length === 0 || total_amount <= 0) {\n      alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š');\n      return;\n    }\n\n    // TODO: ä¿å­˜æ”¶æ¬¾å–®åˆ° store æˆ– API\n    console.log('å„²å­˜æ”¶æ¬¾å–®', {\n      order_id: selectedOrderId,\n      receiptDate,\n      paymentItems,\n      total_amount,\n      note\n    });\n\n    // é—œé–‰å°è©±æ¡†ä¸¦é‡ç½®è¡¨å–®\n    setIsDialogOpen(false);\n    resetForm();\n  };\n\n  // å®šç¾©è¡¨æ ¼æ¬„ä½\n  const columns = [\n    {\n      key: 'created_at',\n      label: 'æ—¥æœŸ',\n      sortable: true,\n      render: (value: string) => (\n        <div className=\"flex items-center text-sm\">\n          <Calendar size={14} className=\"mr-1 text-morandi-secondary\" />\n          {new Date(value).toLocaleDateString('zh-TW')}\n        </div>\n      )\n    },\n    {\n      key: 'amount',\n      label: 'é‡‘é¡',\n      sortable: true,\n      render: (value: number) => (\n        <div className=\"text-sm font-medium text-morandi-green\">\n          NT$ {value.toLocaleString()}\n        </div>\n      )\n    },\n    {\n      key: 'description',\n      label: 'èªªæ˜',\n      sortable: false,\n      render: (value: string) => (\n        <div className=\"text-sm text-morandi-primary\">\n          {value}\n        </div>\n      )\n    },\n    {\n      key: 'order_id',\n      label: 'è¨‚å–®ç·¨è™Ÿ',\n      sortable: true,\n      render: (value: string) => (\n        <div className=\"text-sm text-morandi-primary\">\n          {value || '-'}\n        </div>\n      )\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      render: (value: string) => (\n        <span className={cn(\n          'text-sm font-medium',\n          value === 'å·²ç¢ºèª' ? 'text-morandi-green' : 'text-morandi-gold'\n        )}>\n          {value}\n        </span>\n      )\n    }\n  ];\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"æ”¶æ¬¾ç®¡ç†\"\n        actions={\n          <Button\n            onClick={() => setIsDialogOpen(true)}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n          >\n            <Plus size={16} className=\"mr-2\" />\n            æ–°å¢æ”¶æ¬¾\n          </Button>\n        }\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n          className=\"min-h-full\"\n          data={paymentRecords}\n          columns={columns}\n          defaultSort={{ key: 'created_at', direction: 'desc' }}\n          searchable\n          searchPlaceholder=\"æœå°‹èªªæ˜æˆ–è¨‚å–®ç·¨è™Ÿ...\"\n        />\n      </div>\n\n      {/* æ–°å¢æ”¶æ¬¾å°è©±æ¡† */}\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-xl font-semibold\">æ–°å¢æ”¶æ¬¾å–®</DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-6 py-4\">\n            {/* åŸºæœ¬è³‡è¨Š */}\n            <div>\n              <h3 className=\"text-lg font-semibold mb-4\">åŸºæœ¬è³‡è¨Š</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é¸æ“‡è¨‚å–®</label>\n                  <Select value={selectedOrderId} onValueChange={setSelectedOrderId}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"è«‹é¸æ“‡å¾…æ”¶æ¬¾çš„è¨‚å–®...\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {availableOrders.map(order => (\n                        <SelectItem key={order.id} value={order.id}>\n                          <div>\n                            <div className=\"font-medium\">{order.order_number} - {order.tour_name}</div>\n                            <div className=\"text-sm text-morandi-secondary\">\n                              {order.contact_person} | å¾…æ”¶: NT$ {order.remaining_amount?.toLocaleString() || 0}\n                            </div>\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾æ—¥æœŸ</label>\n                  <Input\n                    type=\"date\"\n                    value={receiptDate}\n                    onChange={(e) => setReceiptDate(e.target.value)}\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾å–®è™Ÿ</label>\n                  <Input\n                    value=\"REC-2024004ï¼ˆè‡ªå‹•ç”¢ç”Ÿï¼‰\"\n                    disabled\n                    className=\"bg-morandi-container/30\"\n                  />\n                </div>\n\n                {selectedOrder && (\n                  <div>\n                    <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">å¾…æ”¶é‡‘é¡</label>\n                    <Input\n                      value={`NT$ ${selectedOrder.remaining_amount?.toLocaleString() || 0}`}\n                      disabled\n                      className=\"bg-morandi-container/30\"\n                    />\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* æ”¶æ¬¾é …ç›® */}\n            <div>\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold\">æ”¶æ¬¾é …ç›®</h3>\n                <Button onClick={addPaymentItem} variant=\"outline\" size=\"sm\">\n                  <Plus size={16} className=\"mr-2\" />\n                  æ–°å¢é …ç›®\n                </Button>\n              </div>\n\n              <div className=\"space-y-4\">\n                {paymentItems.map((item, index) => (\n                  <div key={item.id} className=\"border border-border rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <h4 className=\"font-medium\">æ”¶æ¬¾é …ç›® {index + 1}</h4>\n                      {paymentItems.length > 1 && (\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => removePaymentItem(item.id)}\n                          className=\"text-morandi-red hover:text-morandi-red/80\"\n                        >\n                          <Trash2 size={16} />\n                        </Button>\n                      )}\n                    </div>\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾æ–¹å¼</label>\n                        <Select\n                          value={item.paymentMethod}\n                          onValueChange={(value) => updatePaymentItem(item.id, { paymentMethod: value })}\n                        >\n                          <SelectTrigger>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {paymentMethods.map(method => (\n                              <SelectItem key={method.value} value={method.value}>\n                                {method.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é‡‘é¡</label>\n                        <Input\n                          type=\"number\"\n                          value={item.amount || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { amount: Number(e.target.value) })}\n                          placeholder=\"è«‹è¼¸å…¥æ”¶æ¬¾é‡‘é¡\"\n                        />\n                      </div>\n\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">äº¤æ˜“æ—¥æœŸ</label>\n                        <Input\n                          type=\"date\"\n                          value={item.transactionDate}\n                          onChange={(e) => updatePaymentItem(item.id, { transactionDate: e.target.value })}\n                        />\n                      </div>\n\n                      {/* æ ¹æ“šæ”¶æ¬¾æ–¹å¼é¡¯ç¤ºé¡å¤–æ¬„ä½ */}\n                      {item.paymentMethod === 'ç¾é‡‘' && (\n                        <div>\n                          <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">ç¶“æ‰‹äºº</label>\n                          <Input\n                            value={item.handlerName || ''}\n                            onChange={(e) => updatePaymentItem(item.id, { handlerName: e.target.value })}\n                            placeholder=\"è«‹è¼¸å…¥ç¶“æ‰‹äººå§“å\"\n                          />\n                        </div>\n                      )}\n\n                      {item.paymentMethod === 'åŒ¯æ¬¾' && (\n                        <>\n                          <div>\n                            <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">åŒ¯å…¥å¸³æˆ¶</label>\n                            <Select\n                              value={item.accountInfo || ''}\n                              onValueChange={(value) => updatePaymentItem(item.id, { accountInfo: value })}\n                            >\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"è«‹é¸æ“‡å¸³æˆ¶\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {bankAccounts.map(account => (\n                                  <SelectItem key={account.value} value={account.label}>\n                                    {account.label}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                          <div>\n                            <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ‰‹çºŒè²»</label>\n                            <Input\n                              type=\"number\"\n                              value={item.fees || ''}\n                              onChange={(e) => updatePaymentItem(item.id, { fees: Number(e.target.value) })}\n                              placeholder=\"æ‰‹çºŒè²»é‡‘é¡\"\n                            />\n                          </div>\n                        </>\n                      )}\n\n                      {item.paymentMethod === 'åˆ·å¡' && (\n                        <>\n                          <div>\n                            <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">å¡è™Ÿå¾Œå››ç¢¼</label>\n                            <Input\n                              value={item.cardLastFour || ''}\n                              onChange={(e) => updatePaymentItem(item.id, { cardLastFour: e.target.value })}\n                              placeholder=\"****\"\n                              maxLength={4}\n                            />\n                          </div>\n                          <div>\n                            <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æˆæ¬Šç¢¼</label>\n                            <Input\n                              value={item.authCode || ''}\n                              onChange={(e) => updatePaymentItem(item.id, { authCode: e.target.value })}\n                              placeholder=\"æˆæ¬Šç¢¼\"\n                            />\n                          </div>\n                        </>\n                      )}\n\n                      {item.paymentMethod === 'æ”¯ç¥¨' && (\n                        <>\n                          <div>\n                            <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¯ç¥¨è™Ÿç¢¼</label>\n                            <Input\n                              value={item.checkNumber || ''}\n                              onChange={(e) => updatePaymentItem(item.id, { checkNumber: e.target.value })}\n                              placeholder=\"æ”¯ç¥¨è™Ÿç¢¼\"\n                            />\n                          </div>\n                          <div>\n                            <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é–‹ç¥¨éŠ€è¡Œ</label>\n                            <Input\n                              value={item.checkBank || ''}\n                              onChange={(e) => updatePaymentItem(item.id, { checkBank: e.target.value })}\n                              placeholder=\"é–‹ç¥¨éŠ€è¡Œ\"\n                            />\n                          </div>\n                        </>\n                      )}\n\n                      <div className=\"md:col-span-3\">\n                        <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">å‚™è¨»</label>\n                        <Input\n                          value={item.note || ''}\n                          onChange={(e) => updatePaymentItem(item.id, { note: e.target.value })}\n                          placeholder=\"æ”¶æ¬¾å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* æ‘˜è¦å’Œå‚™è¨» */}\n            <div>\n              <h3 className=\"text-lg font-semibold mb-4\">æ”¶æ¬¾æ‘˜è¦</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">ç¸½æ”¶æ¬¾é‡‘é¡</label>\n                  <Input\n                    value={`NT$ ${total_amount.toLocaleString()}`}\n                    disabled\n                    className=\"bg-morandi-container/30 text-lg font-medium\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾å¾Œç‹€æ…‹</label>\n                  <Input\n                    value={selectedOrder ?\n                      (total_amount >= (selectedOrder.remaining_amount || 0) ? 'å·²æ”¶æ¬¾' : 'éƒ¨åˆ†æ”¶æ¬¾')\n                      : 'è«‹é¸æ“‡è¨‚å–®'}\n                    disabled\n                    className=\"bg-morandi-container/30\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">æ”¶æ¬¾å–®å‚™è¨»</label>\n                  <textarea\n                    value={note}\n                    onChange={(e) => setNote(e.target.value)}\n                    placeholder=\"æ•´å¼µæ”¶æ¬¾å–®çš„å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n                    className=\"w-full p-3 border border-border rounded-lg resize-none h-20\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* æ“ä½œæŒ‰éˆ• */}\n            <div className=\"flex justify-end gap-4\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setIsDialogOpen(false);\n                  resetForm();\n                }}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleSave}\n                disabled={!selectedOrderId || total_amount <= 0}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                å„²å­˜æ”¶æ¬¾å–®\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/reports/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'orders' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":12,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[551,554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[551,554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { Card } from '@/components/ui/card';\nimport { useTourStore, useOrderStore } from '@/stores';\n// TODO: usePaymentStore deprecated - è²¡å‹™å ±è¡¨åŠŸèƒ½æœªå®Œæ•´å¯¦ä½œ\nimport { BarChart3, TrendingUp, TrendingDown, DollarSign, PieChart } from 'lucide-react';\n\nexport default function ReportsPage() {\n  const { items: tours } = useTourStore();\n  const { items: orders } = useOrderStore();\n  const payments: any[] = []; // TODO: å¯¦ä½œå®Œæ•´è²¡å‹™å ±è¡¨\n\n  const total_revenue = payments.filter(p => p.type === 'æ”¶æ¬¾').reduce((sum, p) => sum + p.amount, 0);\n  const totalCosts = payments.filter(p => p.type === 'è«‹æ¬¾').reduce((sum, p) => sum + p.amount, 0);\n  const netProfit = total_revenue - totalCosts;\n\n  return (\n    <div className=\"space-y-6 \">\n      <ResponsiveHeader\n        title=\"è²¡å‹™å ±è¡¨\"\n      />\n\n      {/* è²¡å‹™æ¦‚è¦½ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">è²¡å‹™æ¦‚è¦½</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4\">\n          <Card className=\"p-4 border border-border\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-morandi-secondary mb-1\">ç¸½æ”¶å…¥</p>\n                <p className=\"text-2xl font-bold text-morandi-green\">\n                  NT$ {total_revenue.toLocaleString()}\n                </p>\n              </div>\n              <TrendingUp size={24} className=\"text-morandi-green\" />\n            </div>\n          </Card>\n\n          <Card className=\"p-4 border border-border\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-morandi-secondary mb-1\">ç¸½æ”¯å‡º</p>\n                <p className=\"text-2xl font-bold text-morandi-red\">\n                  NT$ {totalCosts.toLocaleString()}\n                </p>\n              </div>\n              <TrendingDown size={24} className=\"text-morandi-red\" />\n            </div>\n          </Card>\n\n          <Card className=\"p-4 border border-border\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-morandi-secondary mb-1\">æ·¨åˆ©æ½¤</p>\n                <p className={`text-2xl font-bold ${netProfit >= 0 ? 'text-morandi-green' : 'text-morandi-red'}`}>\n                  NT$ {netProfit.toLocaleString()}\n                </p>\n              </div>\n              <DollarSign size={24} className={netProfit >= 0 ? 'text-morandi-green' : 'text-morandi-red'} />\n            </div>\n          </Card>\n        </div>\n      </ContentContainer>\n\n      {/* æ—…éŠåœ˜è²¡å‹™åˆ†æ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æ—…éŠåœ˜è²¡å‹™åˆ†æ</h3>\n        <div className=\"space-y-4\">\n          {tours.map((tour) => (\n            <div key={tour.id} className=\"p-4 bg-card border border-border rounded-lg\">\n              <div className=\"flex justify-between items-start mb-2\">\n                <div>\n                  <h4 className=\"font-medium text-morandi-primary\">{tour.name}</h4>\n                  <p className=\"text-sm text-morandi-secondary\">{tour.code}</p>\n                </div>\n                <div className=\"text-right\">\n                  <p className={`font-medium ${tour.profit >= 0 ? 'text-morandi-green' : 'text-morandi-red'}`}>\n                    åˆ©æ½¤: NT$ {tour.profit.toLocaleString()}\n                  </p>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                <div>\n                  <p className=\"text-morandi-secondary\">æ”¶å…¥</p>\n                  <p className=\"font-medium text-morandi-green\">NT$ {tour.total_revenue.toLocaleString()}</p>\n                </div>\n                <div>\n                  <p className=\"text-morandi-secondary\">æ”¯å‡º</p>\n                  <p className=\"font-medium text-morandi-red\">NT$ {tour.total_cost.toLocaleString()}</p>\n                </div>\n                <div>\n                  <p className=\"text-morandi-secondary\">åˆ©æ½¤ç‡</p>\n                  <p className=\"font-medium text-morandi-primary\">\n                    {tour.total_revenue > 0 ? ((tour.profit / tour.total_revenue) * 100).toFixed(1) : 0}%\n                  </p>\n                </div>\n              </div>\n            </div>\n          ))}\n\n          {tours.length === 0 && (\n            <div className=\"text-center py-8 text-morandi-secondary\">\n              <BarChart3 size={48} className=\"mx-auto mb-4 opacity-50\" />\n              <p>æš«ç„¡æ—…éŠåœ˜è²¡å‹™æ•¸æ“š</p>\n            </div>\n          )}\n        </div>\n      </ContentContainer>\n\n      {/* å ±è¡¨åŠŸèƒ½ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">å ±è¡¨åŠŸèƒ½</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div className=\"p-4 bg-card border border-border rounded-lg text-center\">\n            <PieChart size={32} className=\"mx-auto mb-2 text-morandi-gold\" />\n            <p className=\"font-medium text-morandi-primary mb-2\">æœˆåº¦æç›Šè¡¨</p>\n            <p className=\"text-sm text-morandi-secondary\">åŠŸèƒ½é–‹ç™¼ä¸­...</p>\n          </div>\n          <div className=\"p-4 bg-card border border-border rounded-lg text-center\">\n            <BarChart3 size={32} className=\"mx-auto mb-2 text-morandi-primary\" />\n            <p className=\"font-medium text-morandi-primary mb-2\">ç¾é‡‘æµåˆ†æ</p>\n            <p className=\"text-sm text-morandi-secondary\">åŠŸèƒ½é–‹ç™¼ä¸­...</p>\n          </div>\n        </div>\n      </ContentContainer>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/requests/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7487,7490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7487,7490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":338,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10838,10841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10838,10841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":400,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12463,12466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12463,12466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":714,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":714,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":1044,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":1044,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { EnhancedTable, TableColumn, useEnhancedTable } from '@/components/ui/enhanced-table';\nimport { usePayments } from '@/features/payments/hooks/usePayments';\nimport { useTours } from '@/features/tours/hooks/useTours';\nimport { useOrders } from '@/features/orders/hooks/useOrders';\nimport { useSupplierStore } from '@/stores';\nimport { PaymentRequest, PaymentRequestItem } from '@/stores/types';\nimport { FileText, Plus, Trash2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nconst statusLabels: Record<PaymentRequest['status'], string> = {\n  pending: 'è«‹æ¬¾ä¸­',\n  processing: 'è™•ç†ä¸­',\n  confirmed: 'å·²ç¢ºèª',\n  paid: 'å·²ä»˜æ¬¾'\n};\n\nconst statusColors: Record<PaymentRequest['status'], string> = {\n  pending: 'bg-morandi-gold',\n  processing: 'bg-morandi-gold',\n  confirmed: 'bg-morandi-green',\n  paid: 'bg-morandi-primary'\n};\n\nconst categoryOptions = [\n  { value: 'ä½å®¿', label: 'ğŸ¨ ä½å®¿' },\n  { value: 'äº¤é€š', label: 'ğŸšŒ äº¤é€š' },\n  { value: 'é¤é£Ÿ', label: 'ğŸ½ï¸ é¤é£Ÿ' },\n  { value: 'é–€ç¥¨', label: 'ğŸ« é–€ç¥¨' },\n  { value: 'å°éŠ', label: 'ğŸ‘¥ å°éŠ' },\n  { value: 'å…¶ä»–', label: 'ğŸ“¦ å…¶ä»–' }\n];\n\nexport default function RequestsPage() {\n  const {\n    payment_requests,\n    createPaymentRequest,\n    addPaymentItem\n  } = usePayments();\n\n  const { tours } = useTours();\n  const { orders } = useOrders();\n  const { items: suppliers } = useSupplierStore();\n\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isBatchDialogOpen, setIsBatchDialogOpen] = useState(false);\n\n  const [newRequest, setNewRequest] = useState({\n    tour_id: '',\n    order_id: '',\n    request_date: '',\n    note: '',\n    is_special_billing: false, // ç‰¹æ®Šå‡ºå¸³æ¨™è¨˜\n    created_by: '1' // æ¨¡æ“¬ç•¶å‰ç”¨æˆ¶ID\n  });\n\n  // æ‰¹æ¬¡è«‹æ¬¾ç‹€æ…‹\n  const [selectedTourIds, setSelectedTourIds] = useState<string[]>([]);\n  const [batchRequest, setBatchRequest] = useState({\n    request_date: '',\n    note: '',\n    is_special_billing: false,\n    created_by: '1'\n  });\n  const [batchTourSearch, setBatchTourSearch] = useState('');\n  const [showBatchTourDropdown, setShowBatchTourDropdown] = useState(false);\n\n  // æœå°‹ç›¸é—œç‹€æ…‹\n  const [tourSearchValue, setTourSearchValue] = useState('');\n  const [orderSearchValue, setOrderSearchValue] = useState('');\n  const [showTourDropdown, setShowTourDropdown] = useState(false);\n  const [showOrderDropdown, setShowOrderDropdown] = useState(false);\n\n  const [requestItems, setRequestItems] = useState<Array<{\n    id: string;\n    category: PaymentRequestItem['category'];\n    supplier_id: string;\n    supplierName: string;\n    description: string;\n    unit_price: number;\n    quantity: number;\n  }>>([]);\n\n  const [newItem, setNewItem] = useState({\n    category: 'ä½å®¿' as PaymentRequestItem['category'],\n    supplier_id: '',\n    description: '',\n    unit_price: 0,\n    quantity: 1\n  });\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'request_number',\n      label: 'è«‹æ¬¾å–®è™Ÿ',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <div className=\"font-medium text-morandi-primary\">{value}</div>\n      )\n    },\n    {\n      key: 'tour_name',\n      label: 'åœ˜è™Ÿ',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <div className=\"font-medium text-morandi-primary\">{value}</div>\n      )\n    },\n    {\n      key: 'order_number',\n      label: 'è¨‚å–®ç·¨è™Ÿ',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-primary\">{value || 'ç„¡'}</div>\n      )\n    },\n    {\n      key: 'request_date',\n      label: 'è«‹æ¬¾æ—¥æœŸ',\n      sortable: true,\n      filterable: true,\n      filterType: 'date',\n      render: (value, row) => (\n        <div className=\"text-sm\">\n          <div className={row.is_special_billing ? 'text-morandi-gold font-medium' : 'text-morandi-secondary'}>\n            {value ? new Date(value).toLocaleDateString('zh-TW') : 'æœªè¨­å®š'}\n          </div>\n          {row.is_special_billing && (\n            <div className=\"text-xs text-morandi-gold\">âš ï¸ ç‰¹æ®Šå‡ºå¸³</div>\n          )}\n        </div>\n      )\n    },\n    {\n      key: 'total_amount',\n      label: 'é‡‘é¡',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <div className=\"font-semibold text-morandi-gold\">\n          NT$ {value.toLocaleString()}\n        </div>\n      )\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { value: 'pending', label: 'è«‹æ¬¾ä¸­' },\n        { value: 'processing', label: 'è™•ç†ä¸­' },\n        { value: 'confirmed', label: 'å·²ç¢ºèª' },\n        { value: 'paid', label: 'å·²ä»˜æ¬¾' }\n      ],\n      render: (value) => {\n        const statusBadge = getStatusBadge(value);\n        return (\n          <Badge className={cn('text-xs text-white', statusBadge.color)}>\n            {statusBadge.label}\n          </Badge>\n        );\n      }\n    }\n  ], []);\n\n  // æ’åºå’Œç¯©é¸å‡½æ•¸\n  const sortFunction = useCallback((data: PaymentRequest[], column: string, direction: 'asc' | 'desc') => {\n    return [...data].sort((a, b) => {\n      let aValue: string | number | Date, bValue: string | number | Date;\n\n      switch (column) {\n        case 'request_number':\n          aValue = a.request_number;\n          bValue = b.request_number;\n          break;\n        case 'tour_name':\n          aValue = a.tour_name || '';\n          bValue = b.tour_name || '';\n          break;\n        case 'order_number':\n          aValue = a.order_number || '';\n          bValue = b.order_number || '';\n          break;\n        case 'request_date':\n          aValue = new Date(a.request_date || 0);\n          bValue = new Date(b.request_date || 0);\n          break;\n        case 'total_amount':\n          aValue = a.total_amount;\n          bValue = b.total_amount;\n          break;\n        case 'status':\n          aValue = statusLabels[a.status];\n          bValue = statusLabels[b.status];\n          break;\n        default:\n          return 0;\n      }\n\n      if (aValue < bValue) return direction === 'asc' ? -1 : 1;\n      if (aValue > bValue) return direction === 'asc' ? 1 : -1;\n      return 0;\n    });\n  }, []);\n\n  const filterFunction = useCallback((data: PaymentRequest[], filters: Record<string, string>) => {\n    return data.filter(request => {\n      return (\n        (!filters.request_number || request.request_number.toLowerCase().includes(filters.request_number.toLowerCase())) &&\n        (!filters.tour_name || (request.tour_name || '').toLowerCase().includes(filters.tour_name.toLowerCase())) &&\n        (!filters.order_number || (request.order_number || '').toLowerCase().includes(filters.order_number.toLowerCase())) &&\n        (!filters.request_date || (request.request_date || '').includes(filters.request_date)) &&\n        (!filters.total_amount || request.total_amount.toString().includes(filters.total_amount)) &&\n        (!filters.status || request.status === filters.status)\n      );\n    });\n  }, []);\n\n  const { data: filteredAndSortedRequests, handleSort, handleFilter } = useEnhancedTable(\n    payment_requests as any, // ä½¿ç”¨æ–°çš„ Store å‹åˆ¥\n    sortFunction,\n    filterFunction\n  );\n\n  // ç”Ÿæˆè«‹æ¬¾å–®è™Ÿé è¦½ï¼ˆå¯¦éš›ç·¨è™Ÿç”± Store è‡ªå‹•ç”Ÿæˆï¼‰\n  const generateRequestNumber = useCallback(() => {\n    const year = new Date().getFullYear();\n    const count = payment_requests.length + 1;\n    return `PR${year}${count.toString().padStart(4, '0')}`;\n  }, [payment_requests.length]);\n\n  // æ·»åŠ é …ç›®åˆ°åˆ—è¡¨\n  const addItemToList = useCallback(() => {\n    if (!newItem.supplier_id || !newItem.description) return;\n\n    const selectedSupplier = suppliers.find(s => s.id === newItem.supplier_id);\n    if (!selectedSupplier) return;\n\n    const itemId = Math.random().toString(36).substr(2, 9);\n    setRequestItems(prev => [...prev, {\n      id: itemId,\n      ...newItem,\n      supplierName: selectedSupplier.name,\n    }]);\n\n    setNewItem({\n      category: 'ä½å®¿',\n      supplier_id: '',\n      description: '',\n      unit_price: 0,\n      quantity: 1\n    });\n  }, [newItem, suppliers]);\n\n  // ç§»é™¤é …ç›®\n  const removeItem = useCallback((itemId: string) => {\n    setRequestItems(prev => prev.filter(item => item.id !== itemId));\n  }, []);\n\n  // è¨ˆç®—ç¸½é‡‘é¡\n  const total_amount = useMemo(() =>\n    requestItems.reduce((sum, item) => sum + (item.unit_price * item.quantity), 0)\n  , [requestItems]);\n\n  // éæ¿¾æ—…éŠåœ˜ - å¯ä»¥æœå°‹åœ˜è™Ÿã€åœ˜åã€å‡ºç™¼æ—¥æœŸ\n  const filteredTours = useMemo(() =>\n    tours.filter(tour => {\n      const searchTerm = tourSearchValue.toLowerCase();\n      if (!searchTerm) return true;\n\n      const tourCode = tour.code?.toLowerCase() || '';\n      const tour_name = tour.name?.toLowerCase() || '';\n      const departure_date = tour.departure_date || '';\n\n      // æå–æ—¥æœŸä¸­çš„æ•¸å­— (ä¾‹å¦‚: 2024-08-20 -> \"0820\")\n      const dateNumbers = departure_date.replace(/\\D/g, '').slice(-4); // å–æœ€å¾Œ4ä½æ•¸å­— (MMDD)\n\n      return tourCode.includes(searchTerm) ||\n             tour_name.includes(searchTerm) ||\n             dateNumbers.includes(searchTerm.replace(/\\D/g, '')); // ç§»é™¤æœå°‹è©ä¸­çš„éæ•¸å­—å­—ç¬¦\n    })\n  , [tours, tourSearchValue]);\n\n  // éæ¿¾è¨‚å–® - å¯ä»¥æœå°‹è¨‚å–®è™Ÿã€è¯çµ¡äºº\n  const filteredOrders = useMemo(() =>\n    orders.filter(order => {\n      if (!newRequest.tour_id) return false; // å¿…é ˆå…ˆé¸æ“‡æ—…éŠåœ˜\n      if (order.tour_id !== newRequest.tour_id) return false; // åªé¡¯ç¤ºç•¶å‰åœ˜çš„è¨‚å–®\n\n      const searchTerm = orderSearchValue.toLowerCase();\n      if (!searchTerm) return true;\n\n      const order_number = order.order_number?.toLowerCase() || '';\n      const contact_person = order.contact_person?.toLowerCase() || '';\n\n      return order_number.includes(searchTerm) || contact_person.includes(searchTerm);\n    })\n  , [orders, newRequest.tour_id, orderSearchValue]);\n\n\n  const handleAddRequest = async () => {\n    if (!newRequest.tour_id || requestItems.length === 0) return;\n\n    const selectedTour = tours.find(t => t.id === newRequest.tour_id);\n    const selectedOrder = orders.find(o => o.id === newRequest.order_id);\n\n    if (!selectedTour) return;\n\n    // å‰µå»ºè«‹æ¬¾å–®ï¼ˆä¸åŒ…å« itemsï¼Œå› ç‚ºæœƒé€é service æ·»åŠ ï¼‰\n    const request = await createPaymentRequest({\n      tour_id: newRequest.tour_id,\n      code: selectedTour.code,\n      tour_name: selectedTour.name,\n      order_id: newRequest.order_id || undefined,\n      order_number: selectedOrder?.order_number,\n      request_date: newRequest.request_date,\n      items: [], // åˆå§‹ç‚ºç©ºé™£åˆ—\n      total_amount: 0, // åˆå§‹ç‚º 0ï¼Œæœƒåœ¨æ·»åŠ é …ç›®æ™‚è‡ªå‹•è¨ˆç®—\n      status: 'pending',\n      note: newRequest.note,\n      budget_warning: false\n      // created_by æœƒåœ¨ service å±¤è‡ªå‹•å¡«å…¥\n    } as any);\n\n    // ä¾åºæ·»åŠ æ‰€æœ‰é …ç›®ï¼ˆä½¿ç”¨ for...of ç¢ºä¿é †åºåŸ·è¡Œï¼‰\n    for (let i = 0; i < requestItems.length; i++) {\n      const item = requestItems[i];\n      await addPaymentItem(request.id, {\n        category: item.category,\n        supplier_id: item.supplier_id,\n        supplier_name: item.supplierName,\n        description: item.description,\n        unit_price: item.unit_price,\n        quantity: item.quantity,\n        note: '',\n        sort_order: i + 1\n      });\n    }\n\n    // é‡ç½®è¡¨å–®\n    setNewRequest({\n      tour_id: '',\n      order_id: '',\n      request_date: '',\n      note: '',\n      is_special_billing: false,\n      created_by: '1'\n    });\n    setRequestItems([]);\n    setTourSearchValue('');\n    setOrderSearchValue('');\n    setShowTourDropdown(false);\n    setShowOrderDropdown(false);\n    setIsAddDialogOpen(false);\n  };\n\n\n  const getStatusBadge = (status: PaymentRequest['status']) => {\n    return {\n      label: statusLabels[status],\n      color: statusColors[status]\n    };\n  };\n\n  // æ‰¹æ¬¡è«‹æ¬¾è™•ç†\n  const handleBatchRequest = async () => {\n    if (selectedTourIds.length === 0 || requestItems.length === 0) return;\n\n    // ç‚ºæ¯å€‹é¸ä¸­çš„æ—…éŠåœ˜å»ºç«‹è«‹æ¬¾å–®\n    for (const tourId of selectedTourIds) {\n      const selectedTour = tours.find(t => t.id === tourId);\n      if (!selectedTour) continue;\n\n      // å‰µå»ºè«‹æ¬¾å–®\n      const request = await createPaymentRequest({\n        tour_id: tourId,\n        code: selectedTour.code,\n        tour_name: selectedTour.name,\n        request_date: batchRequest.request_date,\n        items: [],\n        total_amount: 0,\n        status: 'pending',\n        note: batchRequest.note,\n        budget_warning: false\n      } as any);\n\n      // æ·»åŠ æ‰€æœ‰é …ç›®\n      for (let i = 0; i < requestItems.length; i++) {\n        const item = requestItems[i];\n        await addPaymentItem(request.id, {\n          category: item.category,\n          supplier_id: item.supplier_id,\n          supplier_name: item.supplierName,\n          description: item.description,\n          unit_price: item.unit_price,\n          quantity: item.quantity,\n          note: '',\n          sort_order: i + 1\n        });\n      }\n    }\n\n    // é‡ç½®è¡¨å–®\n    setSelectedTourIds([]);\n    setBatchRequest({\n      request_date: '',\n      note: '',\n      is_special_billing: false,\n      created_by: '1'\n    });\n    setRequestItems([]);\n    setBatchTourSearch('');\n    setShowBatchTourDropdown(false);\n    setIsBatchDialogOpen(false);\n  };\n\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"è«‹æ¬¾ç®¡ç†\"\n        actions={\n          <>\n            <button\n              onClick={() => setIsAddDialogOpen(true)}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center transition-colors\"\n            >\n              <Plus size={16} className=\"mr-2\" />\n              æ–°å¢è«‹æ¬¾\n            </button>\n            <button\n              onClick={() => setIsBatchDialogOpen(true)}\n              className=\"bg-morandi-primary hover:bg-morandi-primary/90 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center transition-colors\"\n            >\n              <FileText size={16} className=\"mr-2\" />\n              æ‰¹æ¬¡è«‹æ¬¾\n            </button>\n          </>\n        }\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n          className=\"min-h-full\"\n          columns={tableColumns}\n          data={filteredAndSortedRequests}\n          onSort={handleSort}\n          onFilter={handleFilter}\n          selection={undefined}\n        />\n      </div>\n\n      {/* æ–°å¢è«‹æ¬¾å–®å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-7xl max-h-[95vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢è«‹æ¬¾å–®</DialogTitle>\n            <p className=\"text-sm text-morandi-secondary\">\n              è«‹æ¬¾å–®è™Ÿ: {generateRequestNumber()} (è‡ªå‹•ç”Ÿæˆ)\n            </p>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* åŸºæœ¬è³‡è¨Šå€å¡Š */}\n            <div className=\"border border-border rounded-lg p-4\">\n              <h3 className=\"text-sm font-medium text-morandi-primary mb-4\">åŸºæœ¬è³‡è¨Š</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">é¸æ“‡æ—…éŠåœ˜ *</label>\n                  <div className=\"relative\">\n                    <Input\n                      placeholder=\"æœå°‹åœ˜è™Ÿã€åœ˜åæˆ–æ—¥æœŸ (å¦‚: 0820)...\"\n                      value={tourSearchValue}\n                      onChange={(e) => setTourSearchValue(e.target.value)}\n                      onClick={() => setShowTourDropdown(true)}\n                      onBlur={() => setTimeout(() => setShowTourDropdown(false), 200)}\n                      className=\"mt-1 bg-background\"\n                    />\n                    {showTourDropdown && (\n                      <div className=\"absolute z-50 w-full mt-1 bg-background border border-border rounded-md shadow-lg max-h-[200px] overflow-y-auto\">\n                        {filteredTours.length > 0 ? (\n                          filteredTours.map((tour) => (\n                            <div\n                              key={tour.id}\n                              onClick={() => {\n                                setNewRequest(prev => ({\n                                  ...prev,\n                                  tour_id: tour.id,\n                                  order_id: '' // é‡ç½®è¨‚å–®é¸æ“‡\n                                }));\n                                setTourSearchValue(`${tour.code} - ${tour.name}`);\n                                setOrderSearchValue(''); // é‡ç½®è¨‚å–®æœå°‹\n                                setShowTourDropdown(false);\n                              }}\n                              className=\"p-3 hover:bg-morandi-container/20 cursor-pointer border-b border-border last:border-b-0\"\n                            >\n                              <div className=\"font-medium\">{tour.code} - {tour.name}</div>\n                              <div className=\"text-sm text-morandi-secondary\">\n                                å‡ºç™¼: {new Date(tour.departure_date).toLocaleDateString()}\n                              </div>\n                            </div>\n                          ))\n                        ) : (\n                          <div className=\"p-3 text-sm text-morandi-secondary\">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„æ—…éŠåœ˜</div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">é¸æ“‡è¨‚å–®ï¼ˆå¯é¸ï¼‰</label>\n                  <div className=\"relative\">\n                    <Input\n                      placeholder={newRequest.tour_id ? \"æœå°‹è¨‚å–®è™Ÿæˆ–è¯çµ¡äºº...\" : \"è«‹å…ˆé¸æ“‡æ—…éŠåœ˜\"}\n                      value={orderSearchValue}\n                      onChange={(e) => setOrderSearchValue(e.target.value)}\n                      onClick={() => newRequest.tour_id && setShowOrderDropdown(true)}\n                      onBlur={() => setTimeout(() => setShowOrderDropdown(false), 200)}\n                      className=\"mt-1 bg-background\"\n                      disabled={!newRequest.tour_id}\n                    />\n                    {showOrderDropdown && newRequest.tour_id && (\n                      <div className=\"absolute z-50 w-full mt-1 bg-background border border-border rounded-md shadow-lg max-h-[200px] overflow-y-auto\">\n                        {filteredOrders.length > 0 ? (\n                          filteredOrders.map((order) => (\n                            <div\n                              key={order.id}\n                              onClick={() => {\n                                setNewRequest(prev => ({\n                                  ...prev,\n                                  order_id: order.id\n                                }));\n                                setOrderSearchValue(`${order.order_number} - ${order.contact_person}`);\n                                setShowOrderDropdown(false);\n                              }}\n                              className=\"p-3 hover:bg-morandi-container/20 cursor-pointer border-b border-border last:border-b-0\"\n                            >\n                              <div className=\"font-medium\">{order.order_number}</div>\n                              <div className=\"text-sm text-morandi-secondary\">\n                                è¯çµ¡äºº: {order.contact_person}\n                              </div>\n                            </div>\n                          ))\n                        ) : (\n                          <div className=\"p-3 text-sm text-morandi-secondary\">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„è¨‚å–®</div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">è«‹æ¬¾æ—¥æœŸ</label>\n                  <Input\n                    type=\"date\"\n                    value={newRequest.request_date}\n                    onChange={(e) => {\n                      const selectedDate = e.target.value;\n                      const isThursday = selectedDate ? new Date(selectedDate + 'T00:00:00').getDay() === 4 : false;\n\n                      setNewRequest(prev => ({\n                        ...prev,\n                        request_date: selectedDate,\n                        is_special_billing: !isThursday // éé€±å››è‡ªå‹•æ¨™è¨˜ç‚ºç‰¹æ®Šå‡ºå¸³\n                      }));\n                    }}\n                    className={cn(\n                      \"mt-1\",\n                      newRequest.request_date && new Date(newRequest.request_date + 'T00:00:00').getDay() !== 4\n                        ? \"bg-morandi-gold/10 border-morandi-gold/50\"\n                        : \"bg-background\"\n                    )}\n                  />\n                  {newRequest.request_date && (\n                    <p className={cn(\n                      \"text-xs mt-1\",\n                      new Date(newRequest.request_date + 'T00:00:00').getDay() === 4\n                        ? \"text-morandi-secondary\"\n                        : \"text-morandi-gold\"\n                    )}>\n                      {new Date(newRequest.request_date + 'T00:00:00').getDay() === 4\n                        ? \"ğŸ’¼ ä¸€èˆ¬è«‹æ¬¾ï¼šé€±å››å‡ºå¸³\"\n                        : \"âš ï¸ ç‰¹æ®Šå‡ºå¸³ï¼šéé€±å››è«‹æ¬¾\"}\n                    </p>\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">å‚™è¨»</label>\n                  <Input\n                    value={newRequest.note}\n                    onChange={(e) => setNewRequest(prev => ({ ...prev, note: e.target.value }))}\n                    placeholder=\"è¼¸å…¥å‚™è¨»ï¼ˆå¯é¸ï¼‰\"\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* é …ç›®æ–°å¢å€å¡Š */}\n            <div className=\"border border-border rounded-lg p-6\">\n              <div className=\"flex justify-between items-center mb-6\">\n                <h3 className=\"text-lg font-medium text-morandi-primary\">æ–°å¢è«‹æ¬¾é …ç›®</h3>\n                <Button\n                  type=\"button\"\n                  onClick={addItemToList}\n                  disabled={!newItem.supplier_id || !newItem.description}\n                  className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-6\"\n                  size=\"lg\"\n                >\n                  <Plus size={18} className=\"mr-2\" />\n                  æ–°å¢é …ç›®\n                </Button>\n              </div>\n\n              <div className=\"grid grid-cols-12 gap-4\">\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">é¡åˆ¥</label>\n                  <Select value={newItem.category} onValueChange={(value) => setNewItem(prev => ({ ...prev, category: value as PaymentRequestItem['category'] }))}>\n                    <SelectTrigger className=\"mt-2 bg-background\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-background\">\n                      {categoryOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"col-span-3\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">ä¾›æ‡‰å•†</label>\n                  <Select value={newItem.supplier_id} onValueChange={(value) => setNewItem(prev => ({ ...prev, supplier_id: value }))}>\n                    <SelectTrigger className=\"mt-2 bg-background\">\n                      <SelectValue placeholder=\"é¸æ“‡ä¾›æ‡‰å•†\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-background\">\n                      {suppliers.map((supplier) => (\n                        <SelectItem key={supplier.id} value={supplier.id}>\n                          {supplier.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"col-span-4\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">é …ç›®æè¿°</label>\n                  <Input\n                    value={newItem.description}\n                    onChange={(e) => setNewItem(prev => ({ ...prev, description: e.target.value }))}\n                    placeholder=\"è¼¸å…¥é …ç›®æè¿°\"\n                    className=\"mt-2\"\n                  />\n                </div>\n\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">å–®åƒ¹</label>\n                  <Input\n                    type=\"number\"\n                    value={newItem.unit_price}\n                    onChange={(e) => setNewItem(prev => ({ ...prev, unit_price: parseFloat(e.target.value) || 0 }))}\n                    placeholder=\"0\"\n                    className=\"mt-2\"\n                  />\n                </div>\n\n                <div className=\"col-span-1\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">æ•¸é‡</label>\n                  <Input\n                    type=\"number\"\n                    value={newItem.quantity}\n                    onChange={(e) => setNewItem(prev => ({ ...prev, quantity: parseInt(e.target.value) || 1 }))}\n                    placeholder=\"1\"\n                    className=\"mt-2\"\n                  />\n                </div>\n              </div>\n\n              {/* å°è¨ˆé¡¯ç¤º */}\n              <div className=\"mt-4 flex justify-end\">\n                <div className=\"bg-morandi-container/20 rounded px-4 py-2\">\n                  <span className=\"text-sm font-medium text-morandi-secondary mr-2\">å°è¨ˆ:</span>\n                  <span className=\"text-lg font-semibold text-morandi-gold\">\n                    NT$ {(newItem.unit_price * newItem.quantity).toLocaleString()}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* é …ç›®åˆ—è¡¨ */}\n            {requestItems.length > 0 && (\n              <div className=\"border border-border rounded-lg p-4\">\n                <h3 className=\"text-sm font-medium text-morandi-primary mb-4\">è«‹æ¬¾é …ç›®åˆ—è¡¨</h3>\n                <div className=\"space-y-2\">\n                  {requestItems.map((item, index) => (\n                    <div key={item.id} className=\"flex items-center justify-between p-3 bg-morandi-container/10 rounded\">\n                      <div className=\"flex-1 grid grid-cols-6 gap-4 text-sm\">\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">é¡åˆ¥:</span>\n                          <div className=\"font-medium\">{categoryOptions.find(c => c.value === item.category)?.label}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">ä¾›æ‡‰å•†:</span>\n                          <div className=\"font-medium\">{item.supplierName}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">é …ç›®:</span>\n                          <div className=\"font-medium\">{item.description}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">å–®åƒ¹:</span>\n                          <div className=\"font-medium\">NT$ {item.unit_price.toLocaleString()}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">æ•¸é‡:</span>\n                          <div className=\"font-medium\">{item.quantity}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">å°è¨ˆ:</span>\n                          <div className=\"font-semibold text-morandi-gold\">NT$ {(item.unit_price * item.quantity).toLocaleString()}</div>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => removeItem(item.id)}\n                        className=\"ml-4 text-morandi-red hover:bg-morandi-red/10\"\n                      >\n                        <Trash2 size={16} />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n\n                {/* ç¸½è¨ˆ */}\n                <div className=\"mt-4 pt-4 border-t border-border\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-lg font-semibold text-morandi-primary\">ç¸½é‡‘é¡:</span>\n                    <span className=\"text-xl font-bold text-morandi-gold\">NT$ {total_amount.toLocaleString()}</span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* åº•éƒ¨æ“ä½œæŒ‰éˆ• */}\n            <div className=\"flex justify-end space-x-2 pt-4 border-t border-border\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setIsAddDialogOpen(false);\n                  setRequestItems([]);\n                  setNewRequest({\n                    tour_id: '',\n                    order_id: '',\n                    request_date: '',\n                    note: '',\n                    is_special_billing: false,\n                    created_by: '1'\n                  });\n                  setTourSearchValue('');\n                  setOrderSearchValue('');\n                  setShowTourDropdown(false);\n                  setShowOrderDropdown(false);\n                }}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleAddRequest}\n                disabled={!newRequest.tour_id || requestItems.length === 0}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢è«‹æ¬¾å–® (å…± {requestItems.length} é …ï¼ŒNT$ {total_amount.toLocaleString()})\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* æ‰¹æ¬¡è«‹æ¬¾å°è©±æ¡† */}\n      <Dialog open={isBatchDialogOpen} onOpenChange={setIsBatchDialogOpen}>\n        <DialogContent className=\"max-w-7xl max-h-[95vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>æ‰¹æ¬¡è«‹æ¬¾</DialogTitle>\n            <p className=\"text-sm text-morandi-secondary\">\n              ç‚ºå¤šå€‹æ—…éŠåœ˜å»ºç«‹ç›¸åŒå…§å®¹çš„è«‹æ¬¾å–®\n            </p>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* é¸æ“‡æ—…éŠåœ˜å€å¡Š */}\n            <div className=\"border border-border rounded-lg p-4\">\n              <h3 className=\"text-sm font-medium text-morandi-primary mb-4\">é¸æ“‡æ—…éŠåœ˜</h3>\n              <div className=\"relative\">\n                <Input\n                  placeholder=\"æœå°‹åœ˜è™Ÿã€åœ˜åæˆ–æ—¥æœŸ (å¦‚: 0820)...\"\n                  value={batchTourSearch}\n                  onChange={(e) => setBatchTourSearch(e.target.value)}\n                  onClick={() => setShowBatchTourDropdown(true)}\n                  onBlur={() => setTimeout(() => setShowBatchTourDropdown(false), 200)}\n                  className=\"bg-background\"\n                />\n                {showBatchTourDropdown && (\n                  <div className=\"absolute z-50 w-full mt-1 bg-background border border-border rounded-md shadow-lg max-h-[300px] overflow-y-auto\">\n                    {filteredTours.length > 0 ? (\n                      filteredTours.map((tour) => {\n                        const isSelected = selectedTourIds.includes(tour.id);\n                        return (\n                          <div\n                            key={tour.id}\n                            onClick={() => {\n                              setSelectedTourIds(prev =>\n                                isSelected\n                                  ? prev.filter(id => id !== tour.id)\n                                  : [...prev, tour.id]\n                              );\n                            }}\n                            className={cn(\n                              \"p-3 hover:bg-morandi-container/20 cursor-pointer border-b border-border last:border-b-0 flex items-center\",\n                              isSelected && \"bg-morandi-gold/10\"\n                            )}\n                          >\n                            <input\n                              type=\"checkbox\"\n                              checked={isSelected}\n                              onChange={() => {}}\n                              className=\"mr-3\"\n                            />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium\">{tour.code} - {tour.name}</div>\n                              <div className=\"text-sm text-morandi-secondary\">\n                                å‡ºç™¼: {new Date(tour.departure_date).toLocaleDateString()}\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })\n                    ) : (\n                      <div className=\"p-3 text-sm text-morandi-secondary\">æ‰¾ä¸åˆ°ç›¸ç¬¦çš„æ—…éŠåœ˜</div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {/* å·²é¸æ“‡çš„æ—…éŠåœ˜ */}\n              {selectedTourIds.length > 0 && (\n                <div className=\"mt-4 p-3 bg-morandi-container/10 rounded\">\n                  <div className=\"text-sm font-medium text-morandi-primary mb-2\">\n                    å·²é¸æ“‡ {selectedTourIds.length} å€‹æ—…éŠåœ˜ï¼š\n                  </div>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {selectedTourIds.map(tourId => {\n                      const tour = tours.find(t => t.id === tourId);\n                      if (!tour) return null;\n                      return (\n                        <Badge\n                          key={tourId}\n                          className=\"bg-morandi-gold text-white flex items-center gap-2\"\n                        >\n                          {tour.code}\n                          <button\n                            onClick={() => setSelectedTourIds(prev => prev.filter(id => id !== tourId))}\n                            className=\"hover:bg-morandi-gold-hover rounded-full\"\n                          >\n                            âœ•\n                          </button>\n                        </Badge>\n                      );\n                    })}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* åŸºæœ¬è³‡è¨Šå€å¡Š */}\n            <div className=\"border border-border rounded-lg p-4\">\n              <h3 className=\"text-sm font-medium text-morandi-primary mb-4\">åŸºæœ¬è³‡è¨Š</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">è«‹æ¬¾æ—¥æœŸ</label>\n                  <Input\n                    type=\"date\"\n                    value={batchRequest.request_date}\n                    onChange={(e) => {\n                      const selectedDate = e.target.value;\n                      const isThursday = selectedDate ? new Date(selectedDate + 'T00:00:00').getDay() === 4 : false;\n\n                      setBatchRequest(prev => ({\n                        ...prev,\n                        request_date: selectedDate,\n                        is_special_billing: !isThursday\n                      }));\n                    }}\n                    className={cn(\n                      \"mt-1\",\n                      batchRequest.request_date && new Date(batchRequest.request_date + 'T00:00:00').getDay() !== 4\n                        ? \"bg-morandi-gold/10 border-morandi-gold/50\"\n                        : \"bg-background\"\n                    )}\n                  />\n                  {batchRequest.request_date && (\n                    <p className={cn(\n                      \"text-xs mt-1\",\n                      new Date(batchRequest.request_date + 'T00:00:00').getDay() === 4\n                        ? \"text-morandi-secondary\"\n                        : \"text-morandi-gold\"\n                    )}>\n                      {new Date(batchRequest.request_date + 'T00:00:00').getDay() === 4\n                        ? \"ğŸ’¼ ä¸€èˆ¬è«‹æ¬¾ï¼šé€±å››å‡ºå¸³\"\n                        : \"âš ï¸ ç‰¹æ®Šå‡ºå¸³ï¼šéé€±å››è«‹æ¬¾\"}\n                    </p>\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">å‚™è¨»</label>\n                  <Input\n                    value={batchRequest.note}\n                    onChange={(e) => setBatchRequest(prev => ({ ...prev, note: e.target.value }))}\n                    placeholder=\"è¼¸å…¥å‚™è¨»ï¼ˆå¯é¸ï¼‰\"\n                    className=\"mt-1\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* é …ç›®æ–°å¢å€å¡Š - èˆ‡å–®ä¸€è«‹æ¬¾å…±ç”¨ */}\n            <div className=\"border border-border rounded-lg p-6\">\n              <div className=\"flex justify-between items-center mb-6\">\n                <h3 className=\"text-lg font-medium text-morandi-primary\">æ–°å¢è«‹æ¬¾é …ç›®</h3>\n                <Button\n                  type=\"button\"\n                  onClick={addItemToList}\n                  disabled={!newItem.supplier_id || !newItem.description}\n                  className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-6\"\n                  size=\"lg\"\n                >\n                  <Plus size={18} className=\"mr-2\" />\n                  æ–°å¢é …ç›®\n                </Button>\n              </div>\n\n              <div className=\"grid grid-cols-12 gap-4\">\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">é¡åˆ¥</label>\n                  <Select value={newItem.category} onValueChange={(value) => setNewItem(prev => ({ ...prev, category: value as PaymentRequestItem['category'] }))}>\n                    <SelectTrigger className=\"mt-2 bg-background\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-background\">\n                      {categoryOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"col-span-3\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">ä¾›æ‡‰å•†</label>\n                  <Select value={newItem.supplier_id} onValueChange={(value) => setNewItem(prev => ({ ...prev, supplier_id: value }))}>\n                    <SelectTrigger className=\"mt-2 bg-background\">\n                      <SelectValue placeholder=\"é¸æ“‡ä¾›æ‡‰å•†\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-background\">\n                      {suppliers.map((supplier) => (\n                        <SelectItem key={supplier.id} value={supplier.id}>\n                          {supplier.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"col-span-4\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">é …ç›®æè¿°</label>\n                  <Input\n                    value={newItem.description}\n                    onChange={(e) => setNewItem(prev => ({ ...prev, description: e.target.value }))}\n                    placeholder=\"è¼¸å…¥é …ç›®æè¿°\"\n                    className=\"mt-2\"\n                  />\n                </div>\n\n                <div className=\"col-span-2\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">å–®åƒ¹</label>\n                  <Input\n                    type=\"number\"\n                    value={newItem.unit_price}\n                    onChange={(e) => setNewItem(prev => ({ ...prev, unit_price: parseFloat(e.target.value) || 0 }))}\n                    placeholder=\"0\"\n                    className=\"mt-2\"\n                  />\n                </div>\n\n                <div className=\"col-span-1\">\n                  <label className=\"text-sm font-medium text-morandi-secondary\">æ•¸é‡</label>\n                  <Input\n                    type=\"number\"\n                    value={newItem.quantity}\n                    onChange={(e) => setNewItem(prev => ({ ...prev, quantity: parseInt(e.target.value) || 1 }))}\n                    placeholder=\"1\"\n                    className=\"mt-2\"\n                  />\n                </div>\n              </div>\n\n              {/* å°è¨ˆé¡¯ç¤º */}\n              <div className=\"mt-4 flex justify-end\">\n                <div className=\"bg-morandi-container/20 rounded px-4 py-2\">\n                  <span className=\"text-sm font-medium text-morandi-secondary mr-2\">å°è¨ˆ:</span>\n                  <span className=\"text-lg font-semibold text-morandi-gold\">\n                    NT$ {(newItem.unit_price * newItem.quantity).toLocaleString()}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* é …ç›®åˆ—è¡¨ */}\n            {requestItems.length > 0 && (\n              <div className=\"border border-border rounded-lg p-4\">\n                <h3 className=\"text-sm font-medium text-morandi-primary mb-4\">è«‹æ¬¾é …ç›®åˆ—è¡¨</h3>\n                <div className=\"space-y-2\">\n                  {requestItems.map((item, index) => (\n                    <div key={item.id} className=\"flex items-center justify-between p-3 bg-morandi-container/10 rounded\">\n                      <div className=\"flex-1 grid grid-cols-6 gap-4 text-sm\">\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">é¡åˆ¥:</span>\n                          <div className=\"font-medium\">{categoryOptions.find(c => c.value === item.category)?.label}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">ä¾›æ‡‰å•†:</span>\n                          <div className=\"font-medium\">{item.supplierName}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">é …ç›®:</span>\n                          <div className=\"font-medium\">{item.description}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">å–®åƒ¹:</span>\n                          <div className=\"font-medium\">NT$ {item.unit_price.toLocaleString()}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">æ•¸é‡:</span>\n                          <div className=\"font-medium\">{item.quantity}</div>\n                        </div>\n                        <div>\n                          <span className=\"text-xs text-morandi-secondary\">å°è¨ˆ:</span>\n                          <div className=\"font-semibold text-morandi-gold\">NT$ {(item.unit_price * item.quantity).toLocaleString()}</div>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => removeItem(item.id)}\n                        className=\"ml-4 text-morandi-red hover:bg-morandi-red/10\"\n                      >\n                        <Trash2 size={16} />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n\n                {/* ç¸½è¨ˆ */}\n                <div className=\"mt-4 pt-4 border-t border-border\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-lg font-semibold text-morandi-primary\">\n                      å–®å€‹åœ˜ç¸½é‡‘é¡:\n                    </span>\n                    <span className=\"text-xl font-bold text-morandi-gold\">NT$ {total_amount.toLocaleString()}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center mt-2 text-sm text-morandi-secondary\">\n                    <span>æ‰¹æ¬¡ç¸½é‡‘é¡ ({selectedTourIds.length} å€‹åœ˜):</span>\n                    <span className=\"font-semibold text-morandi-primary\">\n                      NT$ {(total_amount * selectedTourIds.length).toLocaleString()}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* åº•éƒ¨æ“ä½œæŒ‰éˆ• */}\n            <div className=\"flex justify-end space-x-2 pt-4 border-t border-border\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setIsBatchDialogOpen(false);\n                  setSelectedTourIds([]);\n                  setBatchRequest({\n                    request_date: '',\n                    note: '',\n                    is_special_billing: false,\n                    created_by: '1'\n                  });\n                  setRequestItems([]);\n                  setBatchTourSearch('');\n                  setShowBatchTourDropdown(false);\n                }}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleBatchRequest}\n                disabled={selectedTourIds.length === 0 || requestItems.length === 0}\n                className=\"bg-morandi-primary hover:bg-morandi-primary/90 text-white\"\n              >\n                å»ºç«‹æ‰¹æ¬¡è«‹æ¬¾ ({selectedTourIds.length} å€‹åœ˜ï¼Œå…± {requestItems.length} é …ï¼Œç¸½è¨ˆ NT$ {(total_amount * selectedTourIds.length).toLocaleString()})\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/travel-invoice/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileEdit' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1608,1611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1608,1611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n/**\n * ç™¼ç¥¨è©³æƒ…é é¢\n */\n\nimport { useEffect, useState } from 'react'\n\nimport Link from 'next/link'\nimport { useParams, useRouter } from 'next/navigation'\n\nimport { ArrowLeft, FileX, FileEdit } from 'lucide-react'\n\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useTravelInvoiceStore } from '@/stores/useTravelInvoiceStore'\n\nexport default function InvoiceDetailPage() {\n  const params = useParams()\n  const router = useRouter()\n  const { currentInvoice, fetchInvoiceById, voidInvoice, isLoading } = useTravelInvoiceStore()\n\n  const [showVoidDialog, setShowVoidDialog] = useState(false)\n  const [voidReason, setVoidReason] = useState('')\n\n  useEffect(() => {\n    if (params.id) {\n      fetchInvoiceById(params.id as string)\n    }\n  }, [params.id, fetchInvoiceById])\n\n  const handleVoid = async () => {\n    if (!currentInvoice || !voidReason.trim()) return\n\n    try {\n      await voidInvoice(currentInvoice.id, voidReason, 'current_user') // TODO: å¾ç™»å…¥ç‹€æ…‹å–å¾—\n      setShowVoidDialog(false)\n      setVoidReason('')\n    } catch (error: any) {\n      alert(error.message)\n    }\n  }\n\n  if (isLoading || !currentInvoice) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <p className=\"text-center text-muted-foreground\">è¼‰å…¥ä¸­...</p>\n      </div>\n    )\n  }\n\n  const getStatusBadge = (status: string) => {\n    const statusMap: Record<string, { label: string; variant: any }> = {\n      pending: { label: 'å¾…è™•ç†', variant: 'secondary' },\n      issued: { label: 'å·²é–‹ç«‹', variant: 'default' },\n      voided: { label: 'å·²ä½œå»¢', variant: 'destructive' },\n      allowance: { label: 'å·²æŠ˜è®“', variant: 'outline' },\n      failed: { label: 'å¤±æ•—', variant: 'destructive' },\n    }\n    const config = statusMap[status] || { label: status, variant: 'secondary' }\n    return <Badge variant={config.variant}>{config.label}</Badge>\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* æ¨™é¡Œåˆ— */}\n      <div className=\"flex justify-between items-start\">\n        <div className=\"flex items-center gap-4\">\n          <Link href=\"/finance/travel-invoice\">\n            <Button variant=\"ghost\" size=\"icon\">\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-3xl font-bold\">{currentInvoice.transactionNo}</h1>\n            <p className=\"text-muted-foreground mt-1\">\n              {currentInvoice.invoice_number || 'å°šæœªå–å¾—ç™¼ç¥¨è™Ÿç¢¼'}\n            </p>\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          {getStatusBadge(currentInvoice.status)}\n          {currentInvoice.status === 'issued' && (\n            <Button variant=\"destructive\" onClick={() => setShowVoidDialog(true)}>\n              <FileX className=\"mr-2 h-4 w-4\" />\n              ä½œå»¢ç™¼ç¥¨\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* åŸºæœ¬è³‡è¨Š */}\n      <Card>\n        <CardHeader>\n          <CardTitle>åŸºæœ¬è³‡è¨Š</CardTitle>\n        </CardHeader>\n        <CardContent className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n          <div>\n            <p className=\"text-sm text-muted-foreground\">ç‰¹åº—ç·¨è™Ÿ</p>\n            <p className=\"font-medium\">{currentInvoice.merchantId}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">é–‹ç«‹æ—¥æœŸ</p>\n            <p className=\"font-medium\">{currentInvoice.invoice_date}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">èª²ç¨…åˆ¥</p>\n            <p className=\"font-medium\">\n              {currentInvoice.tax_type === 'dutiable'\n                ? 'æ‡‰ç¨…'\n                : currentInvoice.tax_type === 'zero'\n                  ? 'é›¶ç¨…ç‡'\n                  : 'å…ç¨…'}\n            </p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">ç¸½é‡‘é¡</p>\n            <p className=\"font-medium text-lg\">NT$ {currentInvoice.total_amount.toLocaleString()}</p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* è²·å—äººè³‡è¨Š */}\n      <Card>\n        <CardHeader>\n          <CardTitle>è²·å—äººè³‡è¨Š</CardTitle>\n        </CardHeader>\n        <CardContent className=\"grid grid-cols-2 gap-6\">\n          <div>\n            <p className=\"text-sm text-muted-foreground\">åç¨±</p>\n            <p className=\"font-medium\">{currentInvoice.buyerInfo.buyerName || '-'}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">çµ±ä¸€ç·¨è™Ÿ</p>\n            <p className=\"font-medium\">{currentInvoice.buyerInfo.buyerUBN || '-'}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">Email</p>\n            <p className=\"font-medium\">{currentInvoice.buyerInfo.buyerEmail || '-'}</p>\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">æ‰‹æ©Ÿ</p>\n            <p className=\"font-medium\">{currentInvoice.buyerInfo.buyerMobile || '-'}</p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* å•†å“æ˜ç´° */}\n      <Card>\n        <CardHeader>\n          <CardTitle>å•†å“æ˜ç´°</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <table className=\"w-full\">\n            <thead className=\"border-b\">\n              <tr>\n                <th className=\"text-left py-2\">å•†å“åç¨±</th>\n                <th className=\"text-center py-2\">æ•¸é‡</th>\n                <th className=\"text-center py-2\">å–®ä½</th>\n                <th className=\"text-right py-2\">å–®åƒ¹</th>\n                <th className=\"text-right py-2\">é‡‘é¡</th>\n              </tr>\n            </thead>\n            <tbody>\n              {currentInvoice.items.map((item, index) => (\n                <tr key={index} className=\"border-b\">\n                  <td className=\"py-3\">{item.item_name}</td>\n                  <td className=\"text-center\">{item.item_count}</td>\n                  <td className=\"text-center\">{item.item_unit}</td>\n                  <td className=\"text-right\">NT$ {item.item_price.toLocaleString()}</td>\n                  <td className=\"text-right font-medium\">NT$ {item.itemAmt.toLocaleString()}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </CardContent>\n      </Card>\n\n      {/* ç™¼ç¥¨è³‡è¨Š */}\n      {currentInvoice.status === 'issued' && currentInvoice.randomNum && (\n        <Card>\n          <CardHeader>\n            <CardTitle>ç™¼ç¥¨è³‡è¨Š</CardTitle>\n          </CardHeader>\n          <CardContent className=\"grid grid-cols-2 gap-6\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">éš¨æ©Ÿç¢¼</p>\n              <p className=\"font-medium font-mono\">{currentInvoice.randomNum}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">æ¢ç¢¼</p>\n              <p className=\"font-medium font-mono text-sm\">{currentInvoice.barcode || '-'}</p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* ä½œå»¢è³‡è¨Š */}\n      {currentInvoice.status === 'voided' && (\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle>ä½œå»¢è³‡è¨Š</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">ä½œå»¢æ™‚é–“</p>\n                <p className=\"font-medium\">\n                  {currentInvoice.voidDate\n                    ? new Date(currentInvoice.voidDate).toLocaleString('zh-TW')\n                    : '-'}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-muted-foreground\">ä½œå»¢åŸå› </p>\n                <p className=\"font-medium\">{currentInvoice.voidReason || '-'}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* ä½œå»¢å°è©±æ¡† */}\n      {showVoidDialog && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n          <Card className=\"w-full max-w-md\">\n            <CardHeader>\n              <CardTitle>ä½œå»¢ç™¼ç¥¨</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"voidReason\">ä½œå»¢åŸå›  *</Label>\n                <Input\n                  id=\"voidReason\"\n                  value={voidReason}\n                  onChange={e => setVoidReason(e.target.value)}\n                  placeholder=\"è«‹è¼¸å…¥ä½œå»¢åŸå› \"\n                />\n              </div>\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setShowVoidDialog(false)}>\n                  å–æ¶ˆ\n                </Button>\n                <Button\n                  variant=\"destructive\"\n                  onClick={handleVoid}\n                  disabled={!voidReason.trim() || isLoading}\n                >\n                  ç¢ºèªä½œå»¢\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/travel-invoice/create/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1827,1830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1827,1830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2888,2891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2888,2891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":169,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4487,4490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4487,4490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n/**\n * é–‹ç«‹ä»£è½‰ç™¼ç¥¨é é¢\n */\n\nimport { useState } from 'react'\n\nimport Link from 'next/link'\nimport { useRouter } from 'next/navigation'\n\nimport { Plus, Trash2, ArrowLeft } from 'lucide-react'\n\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { useTravelInvoiceStore, TravelInvoiceItem, BuyerInfo } from '@/stores/useTravelInvoiceStore'\n\nexport default function CreateInvoicePage() {\n  const router = useRouter()\n  const { issueInvoice, isLoading } = useTravelInvoiceStore()\n  const [error, setError] = useState<string | null>(null)\n\n  // åŸºæœ¬è³‡è¨Š\n  const [invoice_date, setInvoiceDate] = useState(new Date().toISOString().split('T')[0])\n  const [tax_type, setTaxType] = useState<'dutiable' | 'zero' | 'free'>('dutiable')\n\n  // è²·å—äººè³‡è¨Š\n  const [buyerInfo, setBuyerInfo] = useState<BuyerInfo>({\n    buyerName: '',\n    buyerUBN: '',\n    buyerAddress: '',\n    buyerEmail: '',\n    buyerMobileCode: '+886',\n    buyerMobile: '',\n    carrierType: '',\n    carrierNum: '',\n    loveCode: '',\n    printFlag: 'Y',\n  })\n\n  // å•†å“æ˜ç´°\n  const [items, setItems] = useState<TravelInvoiceItem[]>([\n    {\n      item_name: '',\n      item_count: 1,\n      item_unit: 'å¼',\n      item_price: 0,\n      itemAmt: 0,\n      itemWord: '',\n    },\n  ])\n\n  const addItem = () => {\n    setItems([\n      ...items,\n      {\n        item_name: '',\n        item_count: 1,\n        item_unit: 'å¼',\n        item_price: 0,\n        itemAmt: 0,\n        itemWord: '',\n      },\n    ])\n  }\n\n  const removeItem = (index: number) => {\n    if (items.length > 1) {\n      setItems(items.filter((_, i) => i !== index))\n    }\n  }\n\n  const updateItem = (index: number, field: keyof TravelInvoiceItem, value: any) => {\n    const newItems = [...items]\n    newItems[index] = { ...newItems[index], [field]: value }\n\n    // è‡ªå‹•è¨ˆç®—é‡‘é¡\n    if (field === 'item_price' || field === 'item_count') {\n      const price = field === 'item_price' ? value : newItems[index].item_price\n      const count = field === 'item_count' ? value : newItems[index].item_count\n      newItems[index].itemAmt = price * count\n    }\n\n    setItems(newItems)\n  }\n\n  const total_amount = items.reduce((sum, item) => sum + item.itemAmt, 0)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError(null)\n\n    // é©—è­‰\n    if (!buyerInfo.buyerName) {\n      setError('è«‹è¼¸å…¥è²·å—äººåç¨±')\n      return\n    }\n\n    if (items.some(item => !item.item_name || item.item_price <= 0)) {\n      setError('è«‹å®Œæ•´å¡«å¯«å•†å“è³‡è¨Š')\n      return\n    }\n\n    try {\n      await issueInvoice({\n        invoice_date,\n        total_amount,\n        tax_type,\n        buyerInfo,\n        items,\n        created_by: 'current_user', // TODO: å¾ç™»å…¥ç‹€æ…‹å–å¾—\n      })\n\n      router.push('/finance/travel-invoice')\n    } catch (error: any) {\n      setError(error.message)\n    }\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* æ¨™é¡Œåˆ— */}\n      <div className=\"flex items-center gap-4\">\n        <Link href=\"/finance/travel-invoice\">\n          <Button variant=\"ghost\" size=\"icon\">\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-3xl font-bold\">é–‹ç«‹æ–°ç™¼ç¥¨</h1>\n          <p className=\"text-muted-foreground mt-1\">å¡«å¯«ç™¼ç¥¨è³‡è¨Šä¸¦é€å‡ºé–‹ç«‹</p>\n        </div>\n      </div>\n\n      {/* éŒ¯èª¤è¨Šæ¯ */}\n      {error && (\n        <Card className=\"border-destructive\">\n          <CardContent className=\"pt-6\">\n            <p className=\"text-destructive\">{error}</p>\n          </CardContent>\n        </Card>\n      )}\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {/* åŸºæœ¬è³‡è¨Š */}\n        <Card>\n          <CardHeader>\n            <CardTitle>åŸºæœ¬è³‡è¨Š</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"invoice_date\">é–‹ç«‹æ—¥æœŸ</Label>\n                <Input\n                  id=\"invoice_date\"\n                  type=\"date\"\n                  value={invoice_date}\n                  onChange={e => setInvoiceDate(e.target.value)}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"tax_type\">èª²ç¨…åˆ¥</Label>\n                <select\n                  id=\"tax_type\"\n                  value={tax_type}\n                  onChange={e => setTaxType(e.target.value as any)}\n                  className=\"w-full px-3 py-2 border rounded-md\"\n                >\n                  <option value=\"dutiable\">æ‡‰ç¨…</option>\n                  <option value=\"zero\">é›¶ç¨…ç‡</option>\n                  <option value=\"free\">å…ç¨…</option>\n                </select>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* è²·å—äººè³‡è¨Š */}\n        <Card>\n          <CardHeader>\n            <CardTitle>è²·å—äººè³‡è¨Š</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"buyerName\">è²·å—äººåç¨± *</Label>\n                <Input\n                  id=\"buyerName\"\n                  value={buyerInfo.buyerName}\n                  onChange={e => setBuyerInfo({ ...buyerInfo, buyerName: e.target.value })}\n                  required\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"buyerUBN\">çµ±ä¸€ç·¨è™Ÿ</Label>\n                <Input\n                  id=\"buyerUBN\"\n                  value={buyerInfo.buyerUBN}\n                  onChange={e => setBuyerInfo({ ...buyerInfo, buyerUBN: e.target.value })}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"buyerEmail\">Email</Label>\n                <Input\n                  id=\"buyerEmail\"\n                  type=\"email\"\n                  value={buyerInfo.buyerEmail}\n                  onChange={e => setBuyerInfo({ ...buyerInfo, buyerEmail: e.target.value })}\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"buyerMobile\">æ‰‹æ©Ÿè™Ÿç¢¼</Label>\n                <Input\n                  id=\"buyerMobile\"\n                  value={buyerInfo.buyerMobile}\n                  onChange={e => setBuyerInfo({ ...buyerInfo, buyerMobile: e.target.value })}\n                />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* å•†å“æ˜ç´° */}\n        <Card>\n          <CardHeader>\n            <div className=\"flex justify-between items-center\">\n              <CardTitle>å•†å“æ˜ç´°</CardTitle>\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={addItem}>\n                <Plus className=\"mr-2 h-4 w-4\" />\n                æ–°å¢é …ç›®\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {items.map((item, index) => (\n              <div key={index} className=\"p-4 border rounded-lg space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <h4 className=\"font-medium\">é …ç›® {index + 1}</h4>\n                  {items.length > 1 && (\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => removeItem(index)}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n                <div className=\"grid grid-cols-4 gap-4\">\n                  <div className=\"col-span-2\">\n                    <Label>å•†å“åç¨± *</Label>\n                    <Input\n                      value={item.item_name}\n                      onChange={e => updateItem(index, 'item_name', e.target.value)}\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label>æ•¸é‡</Label>\n                    <Input\n                      type=\"number\"\n                      min=\"1\"\n                      value={item.item_count}\n                      onChange={e => updateItem(index, 'item_count', parseInt(e.target.value))}\n                    />\n                  </div>\n                  <div>\n                    <Label>å–®ä½</Label>\n                    <Input\n                      value={item.item_unit}\n                      onChange={e => updateItem(index, 'item_unit', e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <Label>å–®åƒ¹</Label>\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      value={item.item_price}\n                      onChange={e => updateItem(index, 'item_price', parseFloat(e.target.value))}\n                    />\n                  </div>\n                  <div>\n                    <Label>é‡‘é¡</Label>\n                    <Input value={item.itemAmt} readOnly className=\"bg-muted\" />\n                  </div>\n                  <div className=\"col-span-2\">\n                    <Label>å‚™è¨»</Label>\n                    <Input\n                      value={item.itemWord}\n                      onChange={e => updateItem(index, 'itemWord', e.target.value)}\n                    />\n                  </div>\n                </div>\n              </div>\n            ))}\n\n            <div className=\"flex justify-end items-center pt-4 border-t\">\n              <div className=\"text-right\">\n                <p className=\"text-sm text-muted-foreground\">ç¸½é‡‘é¡</p>\n                <p className=\"text-2xl font-bold\">NT$ {total_amount.toLocaleString()}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* é€å‡ºæŒ‰éˆ• */}\n        <div className=\"flex justify-end gap-4\">\n          <Link href=\"/finance/travel-invoice\">\n            <Button type=\"button\" variant=\"outline\">\n              å–æ¶ˆ\n            </Button>\n          </Link>\n          <Button type=\"submit\" disabled={isLoading}>\n            {isLoading ? 'é–‹ç«‹ä¸­...' : 'é–‹ç«‹ç™¼ç¥¨'}\n          </Button>\n        </div>\n      </form>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/travel-invoice/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1341,1344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1341,1344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n/**\n * ä»£è½‰ç™¼ç¥¨ç®¡ç†é é¢\n */\n\nimport { useEffect, useState } from 'react'\n\nimport Link from 'next/link'\n\nimport { Plus, Search, FileText, Eye } from 'lucide-react'\n\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { useTravelInvoiceStore } from '@/stores/useTravelInvoiceStore'\n\nexport default function TravelInvoicePage() {\n  const { invoices, isLoading, error, fetchInvoices } = useTravelInvoiceStore()\n  const [searchTerm, setSearchTerm] = useState('')\n  const [statusFilter, setStatusFilter] = useState<string>('')\n\n  useEffect(() => {\n    fetchInvoices()\n  }, [fetchInvoices])\n\n  const filteredInvoices = (invoices || []).filter(invoice => {\n    const matchesSearch =\n      invoice.transactionNo.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      invoice.invoice_number?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      invoice.buyerInfo.buyerName?.toLowerCase().includes(searchTerm.toLowerCase())\n\n    const matchesStatus = statusFilter ? invoice.status === statusFilter : true\n\n    return matchesSearch && matchesStatus\n  })\n\n  const getStatusBadge = (status: string) => {\n    const statusMap: Record<string, { label: string; variant: any }> = {\n      pending: { label: 'å¾…è™•ç†', variant: 'secondary' },\n      issued: { label: 'å·²é–‹ç«‹', variant: 'default' },\n      voided: { label: 'å·²ä½œå»¢', variant: 'destructive' },\n      allowance: { label: 'å·²æŠ˜è®“', variant: 'outline' },\n      failed: { label: 'å¤±æ•—', variant: 'destructive' },\n    }\n    const config = statusMap[status] || { label: status, variant: 'secondary' }\n    return <Badge variant={config.variant}>{config.label}</Badge>\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      {/* æ¨™é¡Œåˆ— */}\n      <div className=\"flex justify-between items-center\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">ä»£è½‰ç™¼ç¥¨ç®¡ç†</h1>\n          <p className=\"text-muted-foreground mt-1\">è—æ–°æ—…è¡Œæ¥­é›»å­ç™¼ç¥¨ç³»çµ±</p>\n        </div>\n        <Link href=\"/finance/travel-invoice/create\">\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" />\n            é–‹ç«‹æ–°ç™¼ç¥¨\n          </Button>\n        </Link>\n      </div>\n\n      {/* ç¯©é¸å€ */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex gap-4\">\n            <div className=\"flex-1\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"æœå°‹äº¤æ˜“ç·¨è™Ÿã€ç™¼ç¥¨è™Ÿç¢¼ã€è²·å—äºº...\"\n                  value={searchTerm}\n                  onChange={e => setSearchTerm(e.target.value)}\n                  className=\"pl-9\"\n                />\n              </div>\n            </div>\n            <select\n              value={statusFilter}\n              onChange={e => setStatusFilter(e.target.value)}\n              className=\"px-4 py-2 border rounded-md\"\n            >\n              <option value=\"\">å…¨éƒ¨ç‹€æ…‹</option>\n              <option value=\"pending\">å¾…è™•ç†</option>\n              <option value=\"issued\">å·²é–‹ç«‹</option>\n              <option value=\"voided\">å·²ä½œå»¢</option>\n              <option value=\"allowance\">å·²æŠ˜è®“</option>\n              <option value=\"failed\">å¤±æ•—</option>\n            </select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* éŒ¯èª¤è¨Šæ¯ */}\n      {error && (\n        <Card className=\"border-destructive\">\n          <CardContent className=\"pt-6\">\n            <p className=\"text-destructive\">{error}</p>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* ç™¼ç¥¨åˆ—è¡¨ */}\n      <div className=\"grid gap-4\">\n        {isLoading ? (\n          <Card>\n            <CardContent className=\"pt-6 text-center\">\n              <p className=\"text-muted-foreground\">è¼‰å…¥ä¸­...</p>\n            </CardContent>\n          </Card>\n        ) : filteredInvoices.length === 0 ? (\n          <Card>\n            <CardContent className=\"pt-6 text-center\">\n              <FileText className=\"mx-auto h-12 w-12 text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground\">å°šç„¡ç™¼ç¥¨è³‡æ–™</p>\n            </CardContent>\n          </Card>\n        ) : (\n          filteredInvoices.map(invoice => (\n            <Card key={invoice.id} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader>\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <CardTitle className=\"text-lg\">{invoice.transactionNo}</CardTitle>\n                    <p className=\"text-sm text-muted-foreground mt-1\">\n                      {invoice.invoice_number || 'å°šæœªå–å¾—ç™¼ç¥¨è™Ÿç¢¼'}\n                    </p>\n                  </div>\n                  <div className=\"text-right space-y-2\">{getStatusBadge(invoice.status)}</div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">é–‹ç«‹æ—¥æœŸ</p>\n                    <p className=\"font-medium\">{invoice.invoice_date}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">è²·å—äºº</p>\n                    <p className=\"font-medium\">{invoice.buyerInfo.buyerName || '-'}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">é‡‘é¡</p>\n                    <p className=\"font-medium\">NT$ {invoice.total_amount.toLocaleString()}</p>\n                  </div>\n                  <div className=\"flex justify-end items-end\">\n                    <Link href={`/finance/travel-invoice/${invoice.id}`}>\n                      <Button variant=\"outline\" size=\"sm\">\n                        <Eye className=\"mr-2 h-4 w-4\" />\n                        æŸ¥çœ‹è©³æƒ…\n                      </Button>\n                    </Link>\n                  </div>\n                </div>\n                {invoice.voidReason && (\n                  <div className=\"mt-4 p-3 bg-muted rounded-md\">\n                    <p className=\"text-sm\">\n                      <span className=\"font-medium\">ä½œå»¢åŸå› ï¼š</span>\n                      {invoice.voidReason}\n                    </p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/treasury/disbursement/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Textarea' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEnhancedTable' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DisbursementOrder' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Banknote' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":75},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2007,2010],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2007,2010],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'pendingRequests' conditional could make the dependencies of useMemo Hook (at line 119) change on every render. To fix this, wrap the initialization of 'pendingRequests' in its own useMemo() Hook.","line":90,"column":9,"nodeType":"VariableDeclarator","endLine":90,"endColumn":87},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'processingRequests' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":91,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":91,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleSelectAll' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":131,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5356,5359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5356,5359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5366,5369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5366,5369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'pendingRequests'. Either exclude it or remove the dependency array.","line":223,"column":6,"nodeType":"ArrayExpression","endLine":223,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [selectedRequests]","fix":{"range":[6818,6853],"text":"[selectedRequests]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'handleRemoveFromDisbursement'. Either include it or remove the dependency array.","line":282,"column":6,"nodeType":"ArrayExpression","endLine":282,"endColumn":20,"suggestions":[{"desc":"Update the dependencies array to be: [currentOrder?.status, handleRemoveFromDisbursement]","fix":{"range":[8356,8370],"text":"[currentOrder?.status, handleRemoveFromDisbursement]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":357,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":357,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10451,10454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10451,10454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nexport const dynamic = 'force-dynamic';\n\nimport { useState, useMemo, useEffect } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { EnhancedTable, TableColumn, useEnhancedTable } from '@/components/ui/enhanced-table';\n// TODO: usePaymentStore deprecated - import { usePaymentStore } from '@/stores';\nimport { DisbursementOrder, PaymentRequest } from '@/stores/types';\nimport { FileText, Calendar, Wallet, CheckCircle, Clock, Banknote, X, Plus } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nconst statusLabels = {\n  pending: 'å·²æäº¤',\n  processing: 'è™•ç†ä¸­',\n  confirmed: 'å·²ç¢ºèª',\n  paid: 'å·²ä»˜æ¬¾'\n};\n\nconst statusColors = {\n  pending: 'bg-morandi-gold',\n  processing: 'bg-blue-500',\n  confirmed: 'bg-morandi-green',\n  paid: 'bg-morandi-primary'\n};\n\nconst disbursementStatusLabels = {\n  pending: 'å¾…ç¢ºèª',\n  confirmed: 'å·²ç¢ºèª',\n  paid: 'å·²ä»˜æ¬¾'\n};\n\nconst disbursementStatusColors = {\n  pending: 'bg-morandi-gold',\n  confirmed: 'bg-morandi-green',\n  paid: 'bg-morandi-primary'\n};\n\nexport default function DisbursementPage() {\n  const searchParams = useSearchParams();\n\n  // TODO: æš«æ™‚ä½¿ç”¨ç©ºè³‡æ–™ï¼Œç­‰å¾… payment store å®Œæ•´å¯¦ä½œ\n  const {\n    payment_requests = [],\n    disbursement_orders = [],\n    addToCurrentDisbursementOrder = () => {},\n    removeFromDisbursementOrder = () => {},\n    confirmDisbursementOrder = () => {},\n    getCurrentWeekDisbursementOrder = () => null,\n    getPendingPaymentRequests = () => [],\n    getProcessingPaymentRequests = () => [],\n    getNextThursday = () => new Date().toLocaleDateString('zh-TW'),\n    createDisbursementOrder = () => {},\n    generateDisbursementNumber = () => 'DISB-000001'\n  } = {} as any;\n\n  const [activeTab, setActiveTab] = useState<'pending' | 'current' | 'all'>('pending');\n  const [selectedRequests, setSelectedRequests] = useState<string[]>([]);\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [selectedRequestsForNew, setSelectedRequestsForNew] = useState<string[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [dialogSearchTerm, setDialogSearchTerm] = useState('');\n\n  // æ”¯æ´ URL åƒæ•¸è¨­å®šåˆå§‹åˆ†é \n  useEffect(() => {\n    const tab = searchParams.get('tab');\n    if (tab && ['pending', 'current', 'all'].includes(tab)) {\n      setActiveTab(tab as 'pending' | 'current' | 'all');\n    }\n  }, [searchParams]);\n\n  // æ–°å¢å‡ºç´å–®\n  const handleCreateDisbursement = () => {\n    if (selectedRequestsForNew.length === 0) return;\n\n    createDisbursementOrder(selectedRequestsForNew);\n    setIsAddDialogOpen(false);\n    setSelectedRequestsForNew([]);\n    setDialogSearchTerm('');\n    setActiveTab('current'); // åˆ‡æ›åˆ°æœ¬é€±å‡ºå¸³æŸ¥çœ‹æ–°å»ºçš„å‡ºç´å–®\n  };\n\n  // ç²å–æ•¸æ“š - åŠ ä¸Šé˜²ç¦¦æ€§æª¢æŸ¥ï¼Œé¿å… deprecated store å°è‡´å´©æ½°\n  const pendingRequests = getPendingPaymentRequests ? getPendingPaymentRequests() : [];\n  const processingRequests = getProcessingPaymentRequests ? getProcessingPaymentRequests() : [];\n  const currentOrder = getCurrentWeekDisbursementOrder ? getCurrentWeekDisbursementOrder() : null;\n  const nextThursday = getNextThursday ? getNextThursday() : new Date();\n\n  // æ–°å¢å‡ºç´å–®æ™‚çš„è«‹æ¬¾å–®å‹¾é¸\n  const handleSelectRequestForNew = (requestId: string) => {\n    setSelectedRequestsForNew(prev =>\n      prev.includes(requestId)\n        ? prev.filter(id => id !== requestId)\n        : [...prev, requestId]\n    );\n  };\n\n  // å…¨é¸/å–æ¶ˆå…¨é¸ï¼ˆæ–°å¢å‡ºç´å–®ç”¨ï¼‰\n  const handleSelectAllForNew = () => {\n    if (selectedRequestsForNew.length === pendingRequests.length) {\n      setSelectedRequestsForNew([]);\n    } else {\n      setSelectedRequestsForNew(pendingRequests.map((r: PaymentRequest) => r.id));\n    }\n  };\n\n  // è¨ˆç®—é¸ä¸­é‡‘é¡\n  const selectedAmount = useMemo(() => {\n    return selectedRequests.reduce((sum, requestId) => {\n      const request = pendingRequests.find((r: PaymentRequest) => r.id === requestId);\n      return sum + (request?.total_amount || 0);\n    }, 0);\n  }, [selectedRequests, pendingRequests]);\n\n  // è™•ç†å‹¾é¸\n  const handleSelectRequest = (requestId: string) => {\n    setSelectedRequests(prev =>\n      prev.includes(requestId)\n        ? prev.filter(id => id !== requestId)\n        : [...prev, requestId]\n    );\n  };\n\n  // å…¨é¸/å–æ¶ˆå…¨é¸\n  const handleSelectAll = () => {\n    if (selectedRequests.length === pendingRequests.length) {\n      setSelectedRequests([]);\n    } else {\n      setSelectedRequests(pendingRequests.map((r: PaymentRequest) => r.id));\n    }\n  };\n\n  // åŠ å…¥å‡ºç´å–®\n  const handleAddToDisbursement = () => {\n    if (selectedRequests.length === 0) return;\n\n    addToCurrentDisbursementOrder(selectedRequests);\n    setSelectedRequests([]);\n  };\n\n  // å¾å‡ºç´å–®ç§»é™¤\n  const handleRemoveFromDisbursement = (paymentRequestId: string) => {\n    if (!currentOrder) return;\n    removeFromDisbursementOrder(currentOrder.id, paymentRequestId);\n  };\n\n  // ç¢ºèªå‡ºç´å–®\n  const handleConfirmDisbursement = () => {\n    if (!currentOrder) return;\n    confirmDisbursementOrder(currentOrder.id, '1'); // TODO: ä½¿ç”¨å¯¦éš›ç”¨æˆ¶ID\n  };\n\n  // å¾…å‡ºå¸³è¡¨æ ¼é…ç½®\n  const pendingColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'select',\n      label: '',\n      width: '50px',\n      render: (_value: any, row: any) => (\n        <input\n          type=\"checkbox\"\n          checked={selectedRequests.includes(row.id)}\n          onChange={() => handleSelectRequest(row.id)}\n          className=\"rounded border-morandi-secondary\"\n        />\n      )\n    },\n    {\n      key: 'request_number',\n      label: 'è«‹æ¬¾å–®è™Ÿ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium text-morandi-primary\">{value}</div>\n      )\n    },\n    {\n      key: 'code',\n      label: 'åœ˜è™Ÿ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium\">{value}</div>\n      )\n    },\n    {\n      key: 'tour_name',\n      label: 'åœ˜é«”åç¨±',\n      sortable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-secondary truncate max-w-[200px]\">{value}</div>\n      )\n    },\n    {\n      key: 'total_amount',\n      label: 'é‡‘é¡',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium text-right\">NT$ {value.toLocaleString()}</div>\n      )\n    },\n    {\n      key: 'request_date',\n      label: 'è«‹æ¬¾æ—¥æœŸ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-secondary\">{value}</div>\n      )\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      render: (value) => (\n        <Badge className={cn('text-white', statusColors[value as keyof typeof statusColors])}>\n          {statusLabels[value as keyof typeof statusLabels]}\n        </Badge>\n      )\n    }\n  ], [selectedRequests, pendingRequests]);\n\n  // æœ¬é€±å‡ºå¸³è¡¨æ ¼é…ç½®\n  const currentOrderColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'request_number',\n      label: 'è«‹æ¬¾å–®è™Ÿ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium text-morandi-primary\">{value}</div>\n      )\n    },\n    {\n      key: 'code',\n      label: 'åœ˜è™Ÿ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium\">{value}</div>\n      )\n    },\n    {\n      key: 'tour_name',\n      label: 'åœ˜é«”åç¨±',\n      sortable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-secondary truncate max-w-[200px]\">{value}</div>\n      )\n    },\n    {\n      key: 'total_amount',\n      label: 'é‡‘é¡',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium text-right\">NT$ {value.toLocaleString()}</div>\n      )\n    },\n    {\n      key: 'request_date',\n      label: 'è«‹æ¬¾æ—¥æœŸ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-secondary\">{value}</div>\n      )\n    },\n    {\n      key: 'actions',\n      label: 'æ“ä½œ',\n      width: '80px',\n      render: (_value, row) => (\n        <button\n          onClick={() => handleRemoveFromDisbursement(row.id)}\n          disabled={currentOrder?.status !== 'pending'}\n          className=\"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"ç§»é™¤\"\n        >\n          <X size={14} />\n        </button>\n      )\n    }\n  ], [currentOrder]);\n\n  // æ­·å²è¨˜éŒ„è¡¨æ ¼é…ç½®\n  const historyColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'order_number',\n      label: 'å‡ºç´å–®è™Ÿ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium text-morandi-primary\">{value}</div>\n      )\n    },\n    {\n      key: 'disbursementDate',\n      label: 'å‡ºå¸³æ—¥æœŸ',\n      sortable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-secondary\">{value}</div>\n      )\n    },\n    {\n      key: 'total_amount',\n      label: 'ç¸½é‡‘é¡',\n      sortable: true,\n      render: (value) => (\n        <div className=\"font-medium text-right\">NT$ {value.toLocaleString()}</div>\n      )\n    },\n    {\n      key: 'paymentRequestIds',\n      label: 'è«‹æ¬¾å–®æ•¸',\n      render: (value) => (\n        <div className=\"text-center\">{value.length} ç­†</div>\n      )\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      render: (value) => (\n        <Badge className={cn('text-white', disbursementStatusColors[value as keyof typeof disbursementStatusColors])}>\n          {disbursementStatusLabels[value as keyof typeof disbursementStatusLabels]}\n        </Badge>\n      )\n    },\n    {\n      key: 'created_at',\n      label: 'å»ºç«‹æ™‚é–“',\n      sortable: true,\n      render: (value) => (\n        <div className=\"text-sm text-morandi-secondary\">\n          {new Date(value).toLocaleDateString('zh-TW')}\n        </div>\n      )\n    }\n  ], []);\n\n  // ç²å–æœ¬é€±å‡ºå¸³çš„è«‹æ¬¾å–®è©³æƒ…\n  const currentOrderRequests = useMemo(() => {\n    if (!currentOrder) return [];\n    return currentOrder.payment_request_ids.map((id: string) =>\n      payment_requests.find((r: PaymentRequest) => r.id === id)\n    ).filter(Boolean) as PaymentRequest[];\n  }, [currentOrder, payment_requests]);\n\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"å‡ºç´å–®ç®¡ç†\"\n        tabs={[\n          { value: 'pending', label: 'å¾…å‡ºå¸³', icon: FileText },\n          { value: 'current', label: 'æœ¬é€±å‡ºå¸³', icon: Calendar },\n          { value: 'all', label: 'å‡ºç´å–®åˆ—è¡¨', icon: Wallet }\n        ]}\n        activeTab={activeTab}\n        onTabChange={(tab) => setActiveTab(tab as any)}\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢å‡ºç´å–®\"\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹è«‹æ¬¾å–®è™Ÿã€åœ˜è™Ÿæˆ–åœ˜å...\"\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        {/* å¾…å‡ºå¸³é é¢ */}\n        {activeTab === 'pending' && (\n          <>\n            {/* æ‰¹æ¬¡æ“ä½œåˆ— */}\n            {selectedRequests.length > 0 && (\n              <div className=\"bg-morandi-gold/10 border border-morandi-gold/20 rounded-lg p-4 mb-4\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-morandi-secondary\">\n                    å·²é¸ {selectedRequests.length} ç­†ï¼Œç¸½é‡‘é¡ NT$ {selectedAmount.toLocaleString()}\n                  </span>\n                  <Button\n                    onClick={handleAddToDisbursement}\n                    className=\"bg-morandi-gold hover:bg-morandi-gold/90\"\n                  >\n                    åŠ å…¥æœ¬é€±å‡ºå¸³\n                  </Button>\n                </div>\n              </div>\n            )}\n\n            {/* è¡¨æ ¼ */}\n            {pendingRequests.length > 0 && (\n              <div className=\"mb-4 flex items-center justify-end\">\n                <div className=\"text-sm text-morandi-secondary\">\n                  {pendingRequests.length} ç­† â€¢ ä¸‹æ¬¡å‡ºå¸³æ—¥ï¼š{nextThursday}\n                </div>\n              </div>\n            )}\n            <EnhancedTable\n              className=\"min-h-full\"\n              data={pendingRequests}\n              columns={pendingColumns}\n              searchableFields={['request_number', 'code', 'tour_name']}\n              initialPageSize={20}\n              searchTerm={searchTerm}\n            />\n          </>\n        )}\n\n        {/* æœ¬é€±å‡ºå¸³é é¢ */}\n        {activeTab === 'current' && (\n          <div className=\"space-y-4\">\n            {currentOrder ? (\n              <>\n                <div className=\"flex items-center justify-between mb-4\">\n                  <div>\n                    <h3 className=\"text-lg font-semibold text-morandi-primary\">\n                      {currentOrder.order_number}\n                    </h3>\n                    <p className=\"text-sm text-morandi-secondary\">\n                      å‡ºå¸³æ—¥æœŸï¼š{currentOrder.disbursement_date} â€¢ {currentOrder.payment_request_ids.length} ç­†è«‹æ¬¾å–®\n                    </p>\n                  </div>\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"text-right\">\n                      <p className=\"text-2xl font-bold text-morandi-primary\">\n                        NT$ {currentOrder.total_amount.toLocaleString()}\n                      </p>\n                    </div>\n                    {currentOrder.status === 'pending' && (\n                      <Button\n                        onClick={handleConfirmDisbursement}\n                        className=\"bg-morandi-green hover:bg-morandi-green/90\"\n                      >\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                        ç¢ºèªå‡ºå¸³\n                      </Button>\n                    )}\n                  </div>\n                </div>\n\n                <EnhancedTable\n                  className=\"min-h-full\"\n                  data={currentOrderRequests}\n                  columns={currentOrderColumns}\n                  searchableFields={['request_number', 'code', 'tour_name']}\n                  initialPageSize={20}\n                  searchTerm={searchTerm}\n                />\n              </>\n            ) : (\n              <div className=\"text-center py-12\">\n                <Calendar className=\"h-16 w-16 text-morandi-secondary mx-auto mb-4 opacity-50\" />\n                <h3 className=\"text-lg font-medium text-morandi-primary mb-2\">\n                  æœ¬é€±å°šç„¡å‡ºå¸³è¨ˆåŠƒ\n                </h3>\n                <p className=\"text-morandi-secondary mb-4\">\n                  è«‹å…ˆåˆ°ã€Œå¾…å‡ºå¸³ã€é é¢å‹¾é¸éœ€è¦å‡ºå¸³çš„è«‹æ¬¾å–®\n                </p>\n                <Button\n                  onClick={() => setActiveTab('pending')}\n                  variant=\"outline\"\n                >\n                  å‰å¾€é¸æ“‡è«‹æ¬¾å–®\n                </Button>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* å‡ºç´å–®åˆ—è¡¨é é¢ */}\n        {activeTab === 'all' && (\n          <EnhancedTable\n            className=\"min-h-full\"\n            data={disbursement_orders}\n            columns={historyColumns}\n            searchableFields={['order_number']}\n            initialPageSize={20}\n            searchTerm={searchTerm}\n          />\n        )}\n      </div>\n\n      {/* æ–°å¢å‡ºç´å–®å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col\">\n          <DialogHeader className=\"pb-4\">\n            <DialogTitle className=\"text-xl\">æ–°å¢å‡ºç´å–®</DialogTitle>\n            <p className=\"text-sm text-morandi-secondary\">\n              {generateDisbursementNumber ? generateDisbursementNumber() : 'è¼‰å…¥ä¸­...'} â€¢ {nextThursday}\n            </p>\n          </DialogHeader>\n\n          <div className=\"flex-1 overflow-hidden flex flex-col\">\n            {pendingRequests.length === 0 ? (\n              <div className=\"flex-1 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <FileText className=\"h-16 w-16 mx-auto mb-4 text-morandi-secondary opacity-50\" />\n                  <p className=\"text-lg text-morandi-secondary\">ç›®å‰æ²’æœ‰å¾…å‡ºå¸³çš„è«‹æ¬¾å–®</p>\n                </div>\n              </div>\n            ) : (\n              <>\n                {/* çµ±è¨ˆå’Œæœå°‹ */}\n                <div className=\"flex items-center justify-between py-3 px-4 border-b bg-gray-50\">\n                  <div className=\"flex items-center space-x-4\">\n                    <span className=\"font-medium\">å…± {pendingRequests.length} ç­†è«‹æ¬¾å–®</span>\n                    {selectedRequestsForNew.length > 0 && (\n                      <span className=\"text-sm text-morandi-secondary\">\n                        â€¢ å·²é¸ {selectedRequestsForNew.length} ç­† â€¢\n                        <span className=\"font-bold text-morandi-primary ml-1\">\n                          NT$ {selectedRequestsForNew.reduce((sum, id: string) => {\n                            const request = pendingRequests.find((r: PaymentRequest) => r.id === id);\n                            return sum + (request?.total_amount || 0);\n                          }, 0).toLocaleString()}\n                        </span>\n                      </span>\n                    )}\n                  </div>\n\n                  <div className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"text\"\n                      placeholder=\"æœå°‹è«‹æ¬¾å–®è™Ÿã€åœ˜è™Ÿæˆ–åœ˜å...\"\n                      value={dialogSearchTerm}\n                      onChange={(e) => setDialogSearchTerm(e.target.value)}\n                      className=\"w-64 px-3 py-1 text-sm border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-morandi-primary\"\n                    />\n                  </div>\n                </div>\n\n                {/* è¡¨æ ¼ */}\n                <div className=\"flex-1 overflow-hidden\">\n                  <EnhancedTable\n                    data={pendingRequests}\n                    columns={[\n                      {\n                        key: 'select',\n                        label: (\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedRequestsForNew.length === pendingRequests.length && pendingRequests.length > 0}\n                            onChange={handleSelectAllForNew}\n                            className=\"rounded border-morandi-secondary\"\n                          />\n                        ),\n                        width: '50px',\n                        render: (_value, row) => (\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedRequestsForNew.includes(row.id)}\n                            onChange={() => handleSelectRequestForNew(row.id)}\n                            className=\"rounded border-morandi-secondary\"\n                          />\n                        )\n                      },\n                      {\n                        key: 'request_number',\n                        label: 'è«‹æ¬¾å–®è™Ÿ',\n                        sortable: true,\n                        render: (value) => (\n                          <div className=\"font-medium text-morandi-primary\">{value}</div>\n                        )\n                      },\n                      {\n                        key: 'code',\n                        label: 'åœ˜è™Ÿ',\n                        sortable: true,\n                        render: (value) => (\n                          <div className=\"font-medium\">{value}</div>\n                        )\n                      },\n                      {\n                        key: 'tour_name',\n                        label: 'åœ˜å',\n                        sortable: true,\n                        render: (value) => (\n                          <div className=\"text-morandi-secondary\">{value}</div>\n                        )\n                      },\n                      {\n                        key: 'request_date',\n                        label: 'è«‹æ¬¾æ—¥æœŸ',\n                        sortable: true,\n                        render: (value) => (\n                          <div className=\"text-sm text-morandi-secondary\">{value}</div>\n                        )\n                      },\n                      {\n                        key: 'total_amount',\n                        label: 'é‡‘é¡',\n                        sortable: true,\n                        render: (value) => (\n                          <div className=\"font-bold text-morandi-primary text-right\">\n                            NT$ {value.toLocaleString()}\n                          </div>\n                        )\n                      }\n                    ]}\n                    searchableFields={['request_number', 'code', 'tour_name']}\n                    searchTerm={dialogSearchTerm}\n                    initialPageSize={15}\n                  />\n                </div>\n              </>\n            )}\n          </div>\n\n          {/* åº•éƒ¨æ“ä½œå€ */}\n          <div className=\"border-t pt-4 mt-4\">\n            <div className=\"flex justify-end space-x-3\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setIsAddDialogOpen(false);\n                  setSelectedRequestsForNew([]);\n                  setDialogSearchTerm('');\n                }}\n                className=\"px-6\"\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleCreateDisbursement}\n                disabled={selectedRequestsForNew.length === 0}\n                className=\"bg-morandi-gold hover:bg-morandi-gold/90 px-6\"\n              >\n                å»ºç«‹å‡ºç´å–® ({selectedRequestsForNew.length} ç­†)\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/finance/treasury/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/fix-database/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FixResult' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[279,282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[279,282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6717,6720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6717,6720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":232,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6722,6725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6722,6725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Wrench, AlertTriangle, CheckCircle, Info } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\n\ninterface FixResult {\n  success: boolean;\n  message: string;\n  details?: any;\n}\n\ninterface Issue {\n  id: string;\n  title: string;\n  description: string;\n  status: 'pending' | 'fixing' | 'success' | 'failed';\n  error?: string;\n}\n\nexport default function FixDatabasePage() {\n  const [isFixing, setIsFixing] = useState(false);\n  const [issues, setIssues] = useState<Issue[]>([\n    {\n      id: 'version',\n      title: 'è³‡æ–™åº«ç‰ˆæœ¬å‡ç´š',\n      description: 'æª¢æŸ¥ä¸¦å‡ç´šåˆ°æœ€æ–°ç‰ˆæœ¬ (v2)',\n      status: 'pending'\n    },\n    {\n      id: 'regions',\n      title: 'åœ°å€è³‡æ–™è¡¨',\n      description: 'ç¢ºä¿ regions è¡¨å­˜åœ¨ä¸¦æœ‰æ­£ç¢ºçµæ§‹',\n      status: 'pending'\n    },\n    {\n      id: 'duplicates',\n      title: 'é‡è¤‡è³‡æ–™æ¸…ç†',\n      description: 'ç§»é™¤ code æ¬„ä½çš„é‡è¤‡å€¼',\n      status: 'pending'\n    },\n    {\n      id: 'validation',\n      title: 'çµæ§‹é©—è­‰',\n      description: 'ç¢ºèªæ‰€æœ‰å¿…è¦çš„è¡¨å’Œç´¢å¼•éƒ½å­˜åœ¨',\n      status: 'pending'\n    }\n  ]);\n  const [logs, setLogs] = useState<string[]>([]);\n\n  const addLog = (message: string) => {\n    setLogs(prev => [...prev, `[${new Date().toLocaleTimeString()}] ${message}`]);\n  };\n\n  const updateIssue = (id: string, updates: Partial<Issue>) => {\n    setIssues(prev => prev.map(issue => \n      issue.id === id ? { ...issue, ...updates } : issue\n    ));\n  };\n\n  const fixDatabase = async () => {\n    setIsFixing(true);\n    setLogs([]);\n    addLog('é–‹å§‹ä¿®å¾©è³‡æ–™åº«å•é¡Œ...');\n\n    try {\n      // 1. ç‰ˆæœ¬å‡ç´š\n      updateIssue('version', { status: 'fixing' });\n      addLog('æª¢æŸ¥è³‡æ–™åº«ç‰ˆæœ¬...');\n      await fixVersion();\n      updateIssue('version', { status: 'success' });\n      addLog('âœ… è³‡æ–™åº«ç‰ˆæœ¬æª¢æŸ¥å®Œæˆ');\n\n      // 2. ä¿®å¾© regions è¡¨\n      updateIssue('regions', { status: 'fixing' });\n      addLog('ä¿®å¾© regions è¡¨...');\n      await fixRegionsTable();\n      updateIssue('regions', { status: 'success' });\n      addLog('âœ… regions è¡¨ä¿®å¾©å®Œæˆ');\n\n      // 3. æ¸…ç†é‡è¤‡è³‡æ–™\n      updateIssue('duplicates', { status: 'fixing' });\n      addLog('æ¸…ç†é‡è¤‡è³‡æ–™...');\n      const cleanedCount = await cleanupDuplicates();\n      updateIssue('duplicates', { status: 'success' });\n      addLog(`âœ… æ¸…ç†å®Œæˆï¼Œç§»é™¤ ${cleanedCount} ç­†é‡è¤‡è³‡æ–™`);\n\n      // 4. é©—è­‰çµæ§‹\n      updateIssue('validation', { status: 'fixing' });\n      addLog('é©—è­‰è³‡æ–™åº«çµæ§‹...');\n      await validateStructure();\n      updateIssue('validation', { status: 'success' });\n      addLog('âœ… è³‡æ–™åº«çµæ§‹æ­£å¸¸');\n\n      addLog('ğŸ‰ æ‰€æœ‰å•é¡Œå·²ä¿®å¾©ï¼');\n    } catch (error) {\n      addLog(`âŒ ä¿®å¾©å¤±æ•—: ${error}`);\n      console.error('ä¿®å¾©å¤±æ•—:', error);\n    } finally {\n      setIsFixing(false);\n    }\n  };\n\n  const fixVersion = async (): Promise<void> => {\n    return new Promise((resolve, reject) => {\n      const DB_NAME = 'VenturoOfflineDB';\n      const CURRENT_VERSION = 2;\n      \n      const request = indexedDB.open(DB_NAME, CURRENT_VERSION);\n      \n      request.onupgradeneeded = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        \n        // å¦‚æœ regions è¡¨ä¸å­˜åœ¨ï¼Œå»ºç«‹å®ƒ\n        if (!db.objectStoreNames.contains('regions')) {\n          const regionsStore = db.createObjectStore('regions', {\n            keyPath: 'id',\n            autoIncrement: false,\n          });\n\n          // å»ºç«‹ç´¢å¼•\n          regionsStore.createIndex('code', 'code', { unique: true });\n          regionsStore.createIndex('name', 'name', { unique: false });\n          regionsStore.createIndex('status', 'status', { unique: false });\n          regionsStore.createIndex('is_active', 'is_active', { unique: false });\n          regionsStore.createIndex('created_at', 'created_at', { unique: false });\n          regionsStore.createIndex('updated_at', 'updated_at', { unique: false });\n          regionsStore.createIndex('sync_status', 'sync_status', { unique: false });\n        }\n      };\n\n      request.onsuccess = () => {\n        request.result.close();\n        resolve();\n      };\n\n      request.onerror = () => {\n        reject(new Error(`ç‰ˆæœ¬å‡ç´šå¤±æ•—: ${request.error?.message}`));\n      };\n    });\n  };\n\n  const fixRegionsTable = async (): Promise<void> => {\n    // æ¸…é™¤ localStorage æ¨™è¨˜ï¼Œå…è¨±é‡æ–°åˆå§‹åŒ–\n    localStorage.removeItem('regions_initialized');\n    \n    // æ¸…ç©º regions è¡¨çš„ç¾æœ‰è³‡æ–™\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open('VenturoOfflineDB');\n      \n      request.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        \n        if (db.objectStoreNames.contains('regions')) {\n          const transaction = db.transaction(['regions'], 'readwrite');\n          const objectStore = transaction.objectStore('regions');\n          const clearRequest = objectStore.clear();\n\n          clearRequest.onsuccess = () => {\n            db.close();\n            resolve();\n          };\n\n          clearRequest.onerror = () => {\n            db.close();\n            reject(new Error('æ¸…ç©º regions è¡¨å¤±æ•—'));\n          };\n        } else {\n          db.close();\n          resolve();\n        }\n      };\n\n      request.onerror = () => {\n        reject(new Error('ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«'));\n      };\n    });\n  };\n\n  const cleanupDuplicates = async (): Promise<number> => {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open('VenturoOfflineDB');\n      let totalCleaned = 0;\n\n      request.onsuccess = async (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        \n        const tablesToCheck = [\n          { table: 'regions', uniqueField: 'code' },\n          { table: 'tours', uniqueField: 'code' },\n          { table: 'orders', uniqueField: 'code' },\n          { table: 'customers', uniqueField: 'code' },\n        ];\n\n        for (const { table, uniqueField } of tablesToCheck) {\n          if (!db.objectStoreNames.contains(table)) continue;\n\n          try {\n            const cleaned = await cleanTableDuplicates(db, table, uniqueField);\n            totalCleaned += cleaned;\n            if (cleaned > 0) {\n              addLog(`  æ¸…ç† ${table}: ç§»é™¤ ${cleaned} ç­†é‡è¤‡è³‡æ–™`);\n            }\n          } catch (error) {\n            console.error(`${table} æ¸…ç†å¤±æ•—:`, error);\n          }\n        }\n\n        db.close();\n        resolve(totalCleaned);\n      };\n\n      request.onerror = () => {\n        reject(new Error('ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«'));\n      };\n    });\n  };\n\n  const cleanTableDuplicates = (\n    db: IDBDatabase, \n    tableName: string, \n    uniqueField: string\n  ): Promise<number> => {\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction([tableName], 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const getAllRequest = objectStore.getAll();\n\n      getAllRequest.onsuccess = () => {\n        const records = getAllRequest.result;\n        const seen = new Map<any, any>();\n        const duplicates: string[] = [];\n\n        // æ‰¾å‡ºé‡è¤‡è³‡æ–™\n        for (const record of records) {\n          const key = record[uniqueField];\n          if (key && seen.has(key)) {\n            const existing = seen.get(key);\n            const existingTime = new Date(existing.updated_at || existing.created_at || 0).getTime();\n            const currentTime = new Date(record.updated_at || record.created_at || 0).getTime();\n            \n            if (currentTime > existingTime) {\n              duplicates.push(existing.id);\n              seen.set(key, record);\n            } else {\n              duplicates.push(record.id);\n            }\n          } else if (key) {\n            seen.set(key, record);\n          }\n        }\n\n        // åˆªé™¤é‡è¤‡è³‡æ–™\n        if (duplicates.length > 0) {\n          for (const id of duplicates) {\n            objectStore.delete(id);\n          }\n        }\n\n        transaction.oncomplete = () => {\n          resolve(duplicates.length);\n        };\n\n        transaction.onerror = () => {\n          reject(new Error('åˆªé™¤é‡è¤‡è³‡æ–™å¤±æ•—'));\n        };\n      };\n\n      getAllRequest.onerror = () => {\n        reject(new Error(`è®€å– ${tableName} å¤±æ•—`));\n      };\n    });\n  };\n\n  const validateStructure = async (): Promise<void> => {\n    return new Promise((resolve, reject) => {\n      const request = indexedDB.open('VenturoOfflineDB');\n\n      request.onsuccess = (event) => {\n        const db = (event.target as IDBOpenDBRequest).result;\n        const requiredTables = ['regions', 'tours', 'orders', 'customers', 'employees'];\n        const missingTables: string[] = [];\n\n        for (const table of requiredTables) {\n          if (!db.objectStoreNames.contains(table)) {\n            missingTables.push(table);\n          }\n        }\n\n        db.close();\n\n        if (missingTables.length > 0) {\n          reject(new Error(`ç¼ºå°‘è³‡æ–™è¡¨: ${missingTables.join(', ')}`));\n        } else {\n          resolve();\n        }\n      };\n\n      request.onerror = () => {\n        reject(new Error('ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«'));\n      };\n    });\n  };\n\n  const clearDatabase = async () => {\n    if (!confirm('ç¢ºå®šè¦å®Œå…¨é‡ç½®è³‡æ–™åº«å—ï¼Ÿæ‰€æœ‰è³‡æ–™å°‡è¢«åˆªé™¤ï¼')) {\n      return;\n    }\n\n    try {\n      addLog('æ­£åœ¨åˆªé™¤è³‡æ–™åº«...');\n      await indexedDB.deleteDatabase('VenturoOfflineDB');\n      localStorage.clear();\n      addLog('âœ… è³‡æ–™åº«å·²å®Œå…¨é‡ç½®');\n      addLog('è«‹é‡æ–°æ•´ç†é é¢');\n      \n      setTimeout(() => {\n        window.location.reload();\n      }, 2000);\n    } catch (error) {\n      addLog(`âŒ é‡ç½®å¤±æ•—: ${error}`);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold flex items-center gap-3 mb-2\">\n            <Wrench className=\"text-morandi-gold\" />\n            è³‡æ–™åº«å•é¡Œä¿®å¾©å·¥å…·\n          </h1>\n          <p className=\"text-morandi-secondary\">\n            è‡ªå‹•æª¢æ¸¬ä¸¦ä¿®å¾© IndexedDB ç›¸é—œå•é¡Œ\n          </p>\n        </div>\n\n        {/* Issues List */}\n        <div className=\"bg-card border border-border rounded-lg p-6 mb-6\">\n          <h2 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n            <AlertTriangle className=\"text-yellow-500\" size={20} />\n            æª¢æ¸¬åˆ°çš„å•é¡Œ\n          </h2>\n          <div className=\"space-y-3\">\n            {issues.map(issue => (\n              <div \n                key={issue.id}\n                className={cn(\n                  \"flex items-center justify-between p-3 rounded-lg border\",\n                  issue.status === 'success' && \"bg-green-50 border-green-200 dark:bg-green-900/20\",\n                  issue.status === 'failed' && \"bg-red-50 border-red-200 dark:bg-red-900/20\",\n                  issue.status === 'fixing' && \"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20\",\n                  issue.status === 'pending' && \"bg-gray-50 border-gray-200 dark:bg-gray-800\"\n                )}\n              >\n                <div>\n                  <div className=\"font-medium\">{issue.title}</div>\n                  <div className=\"text-sm text-morandi-secondary\">{issue.description}</div>\n                  {issue.error && (\n                    <div className=\"text-sm text-red-600 mt-1\">{issue.error}</div>\n                  )}\n                </div>\n                <div>\n                  {issue.status === 'pending' && <Info className=\"text-gray-400\" size={20} />}\n                  {issue.status === 'fixing' && (\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-2 border-yellow-500 border-t-transparent\"></div>\n                  )}\n                  {issue.status === 'success' && <CheckCircle className=\"text-green-500\" size={20} />}\n                  {issue.status === 'failed' && <AlertTriangle className=\"text-red-500\" size={20} />}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Action Buttons */}\n        <div className=\"flex gap-3 mb-6\">\n          <Button \n            onClick={fixDatabase} \n            disabled={isFixing}\n            className=\"flex-1\"\n          >\n            {isFixing ? (\n              <>\n                <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\"></div>\n                ä¿®å¾©ä¸­...\n              </>\n            ) : (\n              <>\n                <Wrench className=\"mr-2\" size={16} />\n                é–‹å§‹ä¿®å¾©\n              </>\n            )}\n          </Button>\n          <Button \n            variant=\"destructive\"\n            onClick={clearDatabase}\n            disabled={isFixing}\n          >\n            å®Œå…¨é‡ç½®è³‡æ–™åº«\n          </Button>\n        </div>\n\n        {/* Logs */}\n        {logs.length > 0 && (\n          <div className=\"bg-card border border-border rounded-lg p-4\">\n            <h3 className=\"font-semibold mb-3\">åŸ·è¡Œè¨˜éŒ„</h3>\n            <div className=\"font-mono text-sm space-y-1 max-h-96 overflow-auto\">\n              {logs.map((log, index) => (\n                <div \n                  key={index}\n                  className={cn(\n                    \"text-gray-600 dark:text-gray-400\",\n                    log.includes('âœ…') && \"text-green-600 dark:text-green-400\",\n                    log.includes('âŒ') && \"text-red-600 dark:text-red-400\",\n                    log.includes('ğŸ‰') && \"text-blue-600 dark:text-blue-400 font-semibold\"\n                  )}\n                >\n                  {log}\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/global-error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/hr/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Briefcase' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreVertical' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":83,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":95},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchAll' and 'users.length'. Either include them or remove the dependency array.","line":35,"column":6,"nodeType":"ArrayExpression","endLine":35,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAll, users.length]","fix":{"range":[1474,1476],"text":"[fetchAll, users.length]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2889,2892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2889,2892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3483,3486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3483,3486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3848,3851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3848,3851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7682,7685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7682,7685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { useUserStore, userStoreHelpers } from '@/stores/user-store';\nimport { Employee } from '@/stores/types';\nimport { EmployeeExpandedView } from '@/components/hr/employee-expanded-view';\nimport { AddEmployeeForm } from '@/components/hr/add-employee-form';\nimport { User, Building, Phone, Mail, UserCheck, UserX, Clock, Briefcase, Trash2, MoreVertical } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nconst statusFilters = [\n  { value: 'all', label: 'å…¨éƒ¨' },\n  { value: 'active', label: 'åœ¨è·' },\n  { value: 'probation', label: 'è©¦ç”¨æœŸ' },\n  { value: 'leave', label: 'è«‹å‡' },\n  { value: 'terminated', label: 'é›¢è·' }\n];\n\nexport default function HRPage() {\n  const { items: users, fetchAll, loading: isLoading, update: updateUser, delete: deleteUser } = useUserStore();\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [expandedEmployee, setExpandedEmployee] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n\n  // åˆå§‹åŒ–æ™‚è¼‰å…¥å“¡å·¥è³‡æ–™ï¼ˆåªåœ¨æ²’æœ‰è³‡æ–™æ™‚è¼‰å…¥ï¼‰\n  useEffect(() => {\n    if (users.length === 0) {\n      fetchAll();\n    }\n  }, []);\n\n  const filteredEmployees = useMemo(() => {\n    if (statusFilter === 'all') {\n      return searchTerm ? userStoreHelpers.searchUsers(searchTerm) : users;\n    } else {\n      return userStoreHelpers.getUsersByStatus(statusFilter as Employee['status']).filter((emp: Employee) =>\n        !searchTerm || userStoreHelpers.searchUsers(searchTerm).includes(emp)\n      );\n    }\n  }, [users, statusFilter, searchTerm]);\n\n  const getStatusColor = (status: Employee['status']) => {\n    const colorMap = {\n      active: 'text-green-600',\n      probation: 'text-yellow-600',\n      leave: 'text-blue-600',\n      terminated: 'text-morandi-red'\n    };\n    return colorMap[status];\n  };\n\n  const getStatusLabel = (status: Employee['status']) => {\n    const statusMap = {\n      active: 'åœ¨è·',\n      probation: 'è©¦ç”¨æœŸ',\n      leave: 'è«‹å‡',\n      terminated: 'é›¢è·'\n    };\n    return statusMap[status];\n  };\n\n  const getStatusIcon = (status: Employee['status']) => {\n    const iconMap = {\n      active: UserCheck,\n      probation: Clock,\n      leave: UserX,\n      terminated: UserX\n    };\n    return iconMap[status];\n  };\n\n  const handleEmployeeClick = (employee: Employee) => {\n    setExpandedEmployee(employee.id);\n  };\n\n  const handleTerminateEmployee = async (employee: Employee, e?: React.MouseEvent) => {\n    if (e) {\n      e.stopPropagation();\n    }\n\n    const confirmMessage = `âš ï¸ ç¢ºå®šè¦å°‡å“¡å·¥ã€Œ${employee.display_name || (employee as any).chinese_name || 'æœªå‘½åå“¡å·¥'}ã€è¾¦ç†é›¢è·å—ï¼Ÿ\\n\\né›¢è·å¾Œå°‡ç„¡æ³•ç™»å…¥ç³»çµ±ï¼Œä½†æ­·å²è¨˜éŒ„æœƒä¿ç•™ã€‚`;\n\n    if (!confirm(confirmMessage)) {\n      return;\n    }\n\n    try {\n      await updateUser(employee.id, { status: 'terminated' });\n      if (expandedEmployee === employee.id) {\n        setExpandedEmployee(null);\n      }\n    } catch (err) {\n      console.error('è¾¦ç†é›¢è·å¤±æ•—:', err);\n      alert('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  const handleDeleteEmployee = async (employee: Employee, e?: React.MouseEvent) => {\n    if (e) {\n      e.stopPropagation();\n    }\n\n    const confirmMessage = `âš ï¸âš ï¸âš ï¸ ç¢ºå®šè¦åˆªé™¤å“¡å·¥ã€Œ${employee.display_name || (employee as any).chinese_name || 'æœªå‘½åå“¡å·¥'}ã€å—ï¼Ÿ\\n\\næ­¤æ“ä½œæœƒï¼š\\n- æ°¸ä¹…åˆªé™¤å“¡å·¥æ‰€æœ‰è³‡æ–™\\n- ç§»é™¤æ‰€æœ‰æ­·å²è¨˜éŒ„\\n- ç„¡æ³•å¾©åŸ\\n\\nå»ºè­°ä½¿ç”¨ã€Œè¾¦ç†é›¢è·ã€åŠŸèƒ½ä¾†ä¿ç•™æ­·å²è¨˜éŒ„ã€‚\\n\\nçœŸçš„è¦åˆªé™¤å—ï¼Ÿ`;\n\n    if (!confirm(confirmMessage)) {\n      return;\n    }\n\n    try {\n      await deleteUser(employee.id);\n      if (expandedEmployee === employee.id) {\n        setExpandedEmployee(null);\n      }\n      alert(`âœ… å“¡å·¥ã€Œ${employee.display_name || (employee as any).chinese_name || 'æœªå‘½åå“¡å·¥'}ã€å·²æˆåŠŸåˆªé™¤`);\n    } catch (err) {\n      console.error('åˆªé™¤å“¡å·¥å¤±æ•—:', err);\n      const errorMessage = err instanceof Error ? err.message : 'æœªçŸ¥éŒ¯èª¤';\n      alert(`âŒ åˆªé™¤å¤±æ•—ï¼š${errorMessage}`);\n    }\n  };\n\n  return (\n    <>\n      <ResponsiveHeader\n        title=\"äººè³‡ç®¡ç†\"\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹å“¡å·¥...\"\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢å“¡å·¥\"\n      >\n        {/* ç‹€æ…‹ç¯©é¸ */}\n        <div className=\"flex gap-2\">\n          {statusFilters.map((filter) => (\n            <button\n              key={filter.value}\n              onClick={() => setStatusFilter(filter.value)}\n              className={cn(\n                'px-3 py-1 rounded-lg text-sm font-medium transition-colors',\n                statusFilter === filter.value\n                  ? 'bg-morandi-gold text-white'\n                  : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/30'\n              )}\n            >\n              {filter.label}\n            </button>\n          ))}\n        </div>\n      </ResponsiveHeader>\n\n      {/* å“¡å·¥å¡ç‰‡ç¶²æ ¼ */}\n      <div className=\"mt-6\">\n        {/* è¼‰å…¥ä¸­ç‹€æ…‹ */}\n        {isLoading && (\n          <div className=\"text-center py-12 text-morandi-muted\">\n            <div className=\"animate-spin w-8 h-8 border-2 border-morandi-gold border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <p>è¼‰å…¥å“¡å·¥è³‡æ–™ä¸­...</p>\n          </div>\n        )}\n\n        {/* å“¡å·¥å¡ç‰‡ */}\n        {!isLoading && (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n          {filteredEmployees.map((employee) => {\n            const StatusIcon = getStatusIcon(employee.status);\n            return (\n              <div\n                key={employee.id}\n                onClick={() => handleEmployeeClick(employee)}\n                className=\"bg-white rounded-lg border border-border p-4 hover:shadow-md transition-shadow cursor-pointer relative group\"\n              >\n                {/* å³ä¸Šè§’æ“ä½œæŒ‰éˆ• */}\n                <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1\">\n                  {employee.status !== 'terminated' && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={(e) => handleTerminateEmployee(employee, e)}\n                      className=\"h-7 w-7 p-0 text-orange-600 hover:bg-orange-100\"\n                      title=\"è¾¦ç†é›¢è·\"\n                    >\n                      <UserX size={14} />\n                    </Button>\n                  )}\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={(e) => handleDeleteEmployee(employee, e)}\n                    className=\"h-7 w-7 p-0 text-morandi-red hover:bg-morandi-red/10\"\n                    title=\"åˆªé™¤ï¼ˆä¸å»ºè­°ï¼‰\"\n                  >\n                    <Trash2 size={14} />\n                  </Button>\n                </div>\n\n                {/* å“¡å·¥é ­åƒèˆ‡åŸºæœ¬è³‡è¨Š */}\n                <div className=\"flex flex-col items-center mb-4\">\n                  <div className=\"w-16 h-16 rounded-full bg-morandi-container/30 flex items-center justify-center mb-2\">\n                    {employee.avatar ? (\n                      <img\n                        src={employee.avatar}\n                        alt={employee.display_name}\n                        className=\"w-16 h-16 rounded-full object-cover\"\n                      />\n                    ) : (\n                      <User size={32} className=\"text-morandi-secondary\" />\n                    )}\n                  </div>\n                  <h3 className=\"font-semibold text-morandi-primary text-center\">\n                    {employee.display_name || (employee as any).chinese_name || 'æœªå‘½åå“¡å·¥'}\n                  </h3>\n                  <p className=\"text-sm text-morandi-muted\">\n                    {employee.employee_number}\n                  </p>\n                </div>\n\n                {/* è¯çµ¡è³‡è¨Š */}\n                <div className=\"space-y-2 mb-4\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Phone size={14} className=\"text-morandi-secondary\" />\n                    <span className=\"text-morandi-primary\">{employee.personal_info?.phone || 'æœªæä¾›'}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Mail size={14} className=\"text-morandi-secondary\" />\n                    <span className=\"text-morandi-primary truncate\">{employee.personal_info?.email || 'æœªæä¾›'}</span>\n                  </div>\n                </div>\n\n                {/* ç‹€æ…‹æ¨™ç¤º */}\n                <div className=\"flex items-center justify-between\">\n                  <div className={cn('flex items-center gap-1 text-sm font-medium', getStatusColor(employee.status))}>\n                    <StatusIcon size={14} />\n                    <span>{getStatusLabel(employee.status)}</span>\n                  </div>\n\n                  {/* æ¬Šé™æ•¸é‡ */}\n                  <div className=\"text-xs text-morandi-muted\">\n                    {employee.permissions?.length || 0} é …æ¬Šé™\n                  </div>\n                </div>\n\n                {/* å…¥è·æ—¥æœŸ */}\n                <div className=\"mt-2 pt-2 border-t border-border/50\">\n                  <p className=\"text-xs text-morandi-muted\">\n                    å…¥è·ï¼š{employee.job_info?.hire_date ? new Date(employee.job_info.hire_date).toLocaleDateString() : 'æœªè¨­å®š'}\n                  </p>\n                </div>\n              </div>\n            );\n          })}\n          </div>\n        )}\n\n        {/* ç„¡è³‡æ–™ç‹€æ…‹ */}\n        {!isLoading && filteredEmployees.length === 0 && (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <User size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p className=\"text-lg font-medium text-morandi-primary mb-2\">\n              {statusFilter === 'all' ? 'é‚„æ²’æœ‰ä»»ä½•å“¡å·¥' : `æ²’æœ‰æ‰¾åˆ°ã€Œ${statusFilters.find(f => f.value === statusFilter)?.label}ã€ç‹€æ…‹çš„å“¡å·¥`}\n            </p>\n            <p className=\"text-sm text-morandi-secondary\">\n              {statusFilter === 'all' ? 'é»æ“Šå³ä¸Šè§’ã€Œæ–°å¢å“¡å·¥ã€é–‹å§‹å»ºç«‹' : 'å˜—è©¦èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–æ–°å¢å“¡å·¥'}\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* å“¡å·¥è©³ç´°è³‡æ–™å±•é–‹è¦–åœ– */}\n      {expandedEmployee && (\n        <EmployeeExpandedView\n          employee_id={expandedEmployee}\n          onClose={() => setExpandedEmployee(null)}\n        />\n      )}\n\n      {/* æ–°å¢å“¡å·¥å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢å“¡å·¥</DialogTitle>\n          </DialogHeader>\n          <AddEmployeeForm\n            onSubmit={() => setIsAddDialogOpen(false)}\n            onCancel={() => setIsAddDialogOpen(false)}\n          />\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/itinerary/[slug]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[598,601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[598,601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1120,1123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1120,1123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1872,1875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1872,1875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport { ResponsiveHeader } from \"@/components/layout/responsive-header\";\nimport { TourForm } from \"@/components/editor/TourForm\";\nimport { TourPreview } from \"@/components/editor/TourPreview\";\nimport { PublishButton } from \"@/components/editor/PublishButton\";\nimport { useItineraryStore } from \"@/stores\";\nimport {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n} from \"@tabler/icons-react\";\n\n// Icon mapping\nconst iconMap: any = {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n};\n\nexport default function EditItineraryPage() {\n  const params = useParams();\n  const router = useRouter();\n  const slug = params.slug as string;\n  const { fetchById } = useItineraryStore();\n\n  const [viewMode, setViewMode] = useState<'desktop' | 'mobile'>('desktop');\n  const [scale, setScale] = useState(1);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [itineraryData, setItineraryData] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  // è¼‰å…¥è¡Œç¨‹è³‡æ–™\n  useEffect(() => {\n    const loadItinerary = async () => {\n      try {\n        const itinerary = await fetchById(slug);\n        if (itinerary) {\n          setItineraryData(itinerary);\n        } else {\n          alert('æ‰¾ä¸åˆ°æ­¤è¡Œç¨‹');\n          router.push('/itinerary');\n        }\n      } catch (error) {\n        console.error('è¼‰å…¥è¡Œç¨‹å¤±æ•—:', error);\n        alert('è¼‰å…¥è¡Œç¨‹å¤±æ•—');\n        router.push('/itinerary');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadItinerary();\n  }, [slug, fetchById, router]);\n\n  // Convert icon strings to components for preview\n  const processedData = itineraryData ? {\n    ...itineraryData,\n    features: itineraryData.features?.map((f: any) => ({\n      ...f,\n      iconComponent: iconMap[f.icon] || IconSparkles,\n    })) || [],\n  } : null;\n\n  // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹\n  useEffect(() => {\n    const calculateScale = () => {\n      if (!containerRef.current) return;\n\n      const container = containerRef.current;\n      const containerWidth = container.clientWidth;\n      const containerHeight = container.clientHeight;\n\n      // ç›®æ¨™å°ºå¯¸\n      const targetWidth = viewMode === 'mobile' ? 400 : 1200; // æ‰‹æ©Ÿå«æ¡†æ¶\n      const targetHeight = viewMode === 'mobile' ? 850 : 800;\n\n      // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹ï¼ˆå¯¬é«˜éƒ½è¦è€ƒæ…®ï¼‰\n      const scaleX = containerWidth / targetWidth;\n      const scaleY = containerHeight / targetHeight;\n\n      // å–è¼ƒå°å€¼ç¢ºä¿å®Œå…¨é¡¯ç¤º\n      const finalScale = Math.min(scaleX, scaleY, 1);\n\n      setScale(finalScale);\n    };\n\n    calculateScale();\n    window.addEventListener('resize', calculateScale);\n    return () => window.removeEventListener('resize', calculateScale);\n  }, [viewMode]);\n\n  // è¼‰å…¥ä¸­ç‹€æ…‹\n  if (loading || !itineraryData) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-lg text-morandi-secondary\">è¼‰å…¥ä¸­...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* ========== é é¢é ‚éƒ¨å€åŸŸ ========== */}\n      <ResponsiveHeader\n        title=\"ç·¨è¼¯è¡Œç¨‹\"\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è¡Œç¨‹ç®¡ç†', href: '/itinerary' },\n          { label: 'ç·¨è¼¯è¡Œç¨‹', href: '#' }\n        ]}\n        showBackButton={true}\n        onBack={() => router.push('/itinerary')}\n        actions={<PublishButton data={itineraryData} />}\n      />\n\n      {/* ========== ä¸»è¦å…§å®¹å€åŸŸ ========== */}\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"h-full flex\">\n          {/* å·¦å´ï¼šè¼¸å…¥è¡¨å–® */}\n          <div className=\"w-1/2 bg-white border-r border-border flex flex-col\">\n            <div className=\"h-14 bg-morandi-gold text-white px-6 flex items-center border-b border-border\">\n              <h2 className=\"text-lg font-semibold\">ç·¨è¼¯è¡¨å–®</h2>\n            </div>\n            <div className=\"flex-1 overflow-y-auto\">\n              <TourForm data={itineraryData} onChange={setItineraryData} />\n            </div>\n          </div>\n\n          {/* å³å´ï¼šå³æ™‚é è¦½ */}\n          <div className=\"w-1/2 bg-gray-100 flex flex-col\">\n            {/* æ¨™é¡Œåˆ— */}\n            <div className=\"h-14 bg-white border-b px-6 flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <h2 className=\"text-lg font-semibold text-morandi-primary\">å³æ™‚é è¦½</h2>\n                <div className=\"flex gap-2 bg-morandi-container/30 rounded-lg p-1\">\n                  <button\n                    onClick={() => setViewMode('desktop')}\n                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${\n                      viewMode === 'desktop'\n                        ? 'bg-morandi-gold text-white'\n                        : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/50'\n                    }`}\n                  >\n                    ğŸ’» é›»è…¦\n                  </button>\n                  <button\n                    onClick={() => setViewMode('mobile')}\n                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${\n                      viewMode === 'mobile'\n                        ? 'bg-morandi-gold text-white'\n                        : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/50'\n                    }`}\n                  >\n                    ğŸ“± æ‰‹æ©Ÿ\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* é è¦½å®¹å™¨ */}\n            <div className=\"flex-1 overflow-hidden p-8\" ref={containerRef}>\n              <div className=\"w-full h-full flex items-center justify-center\">\n                {/* ç¸®æ”¾å®¹å™¨ */}\n                <div\n                  style={{\n                    transform: `scale(${scale})`,\n                    transformOrigin: 'center center'\n                  }}\n                >\n                  {viewMode === 'mobile' ? (\n                    // æ‰‹æ©Ÿæ¡†æ¶å’Œå…§å®¹\n                    <div className=\"relative\">\n                      <div className=\"bg-black rounded-[40px] p-2 shadow-2xl\">\n                        <div className=\"bg-black rounded-[32px] p-2\">\n                          <div\n                            className=\"bg-white rounded-[28px] overflow-hidden relative\"\n                            style={{ width: '375px', height: '812px' }}\n                          >\n                            {/* iPhone å‹•æ…‹å³¶ */}\n                            <div className=\"absolute top-0 left-1/2 -translate-x-1/2 z-50\">\n                              <div className=\"bg-black rounded-full w-[120px] h-[30px] mt-2\" />\n                            </div>\n\n                            <div className=\"w-full h-full overflow-y-auto\">\n                              <TourPreview data={processedData} viewMode=\"mobile\" />\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ) : (\n                    // é›»è…¦ç‰ˆ\n                    <div\n                      className=\"bg-white shadow-2xl rounded-lg overflow-hidden\"\n                      style={{\n                        width: '1200px',\n                        height: '800px'\n                      }}\n                    >\n                      <div className=\"w-full h-full overflow-y-auto\">\n                        <TourPreview data={processedData} viewMode=\"desktop\" />\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/itinerary/new/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[541,544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[541,544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { ResponsiveHeader } from \"@/components/layout/responsive-header\";\nimport { TourForm } from \"@/components/editor/TourForm\";\nimport { TourPreview } from \"@/components/editor/TourPreview\";\nimport { PublishButton } from \"@/components/editor/PublishButton\";\nimport {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n} from \"@tabler/icons-react\";\n\n// Icon mapping\nconst iconMap: any = {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n};\n\nexport default function NewItineraryPage() {\n  const router = useRouter();\n  const [viewMode, setViewMode] = useState<'desktop' | 'mobile'>('desktop');\n  const [scale, setScale] = useState(1);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const mobileContentRef = useRef<HTMLDivElement>(null);\n  const [tourData, setTourData] = useState({\n    // å°é¢è³‡è¨Š\n    tagline: \"Corner Travel 2025\",\n    title: \"æ¼«éŠç¦å²¡\",\n    subtitle: \"åŠè‡ªç”±è¡Œ\",\n    description: \"2æ—¥å¸‚å€è‡ªç”±æ´»å‹• Â· ä¿è­‰å…¥ä½æº«æ³‰é£¯åº— Â· æŸ³å·éŠèˆ¹ Â· é˜¿è˜‡ç«å±±\",\n    departureDate: \"2025/10/21\",\n    tourCode: \"25JFO21CIG\",\n    coverImage: \"https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=1200&q=75&auto=format&fit=crop\",\n    country: \"æ—¥æœ¬\",\n    city: \"ç¦å²¡\",\n    status: \"è‰ç¨¿\",\n\n    // èˆªç­è³‡è¨Š\n    outboundFlight: {\n      airline: \"ä¸­è¯èˆªç©º\",\n      flightNumber: \"CI110\",\n      departureAirport: \"TPE\",\n      departureTime: \"06:50\",\n      departureDate: \"10/21\",\n      arrivalAirport: \"FUK\",\n      arrivalTime: \"09:55\",\n      duration: \"2å°æ™‚5åˆ†\",\n    },\n    returnFlight: {\n      airline: \"ä¸­è¯èˆªç©º\",\n      flightNumber: \"CI111\",\n      departureAirport: \"FUK\",\n      departureTime: \"11:00\",\n      departureDate: \"10/25\",\n      arrivalAirport: \"TPE\",\n      arrivalTime: \"12:30\",\n      duration: \"2å°æ™‚30åˆ†\",\n    },\n\n    // è¡Œç¨‹ç‰¹è‰²\n    features: [\n      {\n        icon: \"IconBuilding\",\n        title: \"æº«æ³‰é£¯åº—é«”é©—\",\n        description: \"ä¿è­‰å…¥ä½é˜¿è˜‡æº«æ³‰é£¯åº—ï¼Œäº«å—æ—¥å¼æº«æ³‰æ–‡åŒ–\",\n      },\n      {\n        icon: \"IconToolsKitchen2\",\n        title: \"ç¾é£Ÿé¥—å®´\",\n        description: \"åšå¤šæ‹‰éºµã€æŸ³å·é°»é­šé£¯ã€é•·è…³èŸ¹è‡ªåŠ©é¤\",\n      },\n      {\n        icon: \"IconSparkles\",\n        title: \"ç²¾é¸é«”é©—\",\n        description: \"æŸ³å·éŠèˆ¹ã€é˜¿è˜‡ç«å±±ã€å¤ªå®°åºœå¤©æ»¿å®®\",\n      },\n      {\n        icon: \"IconCalendar\",\n        title: \"è‡ªç”±æ´»å‹•æ™‚é–“\",\n        description: \"2æ—¥ç¦å²¡å¸‚å€è‡ªç”±æ¢ç´¢ï¼Œå½ˆæ€§å®‰æ’å€‹äººè¡Œç¨‹\",\n      },\n      {\n        icon: \"IconPlane\",\n        title: \"ç›´é£›èˆªç­\",\n        description: \"ä¸­è¯èˆªç©ºæ¡ƒåœ’ç›´é£›ç¦å²¡ï¼Œçœæ™‚ä¾¿åˆ©\",\n      },\n      {\n        icon: \"IconMapPin\",\n        title: \"å°ˆæ¥­é ˜éšŠ\",\n        description: \"ç¶“é©—è±å¯Œçš„é ˜éšŠå…¨ç¨‹é™ªåŒï¼Œè²¼å¿ƒæœå‹™\",\n      },\n    ],\n\n    // ç²¾é¸æ™¯é»\n    focusCards: [\n      {\n        title: \"ç”±å¸ƒé™¢æº«æ³‰è¡—\",\n        src: \"https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=400&q=75&auto=format\",\n      },\n      {\n        title: \"é˜¿è˜‡ç«å±±å£\",\n        src: \"https://images.unsplash.com/photo-1578469550956-0e16b69c6a3d?w=400&q=75&auto=format\",\n      },\n      {\n        title: \"æŸ³å·æ°´é„‰\",\n        src: \"https://images.unsplash.com/photo-1528360983277-13d401cdc186?w=400&q=75&auto=format\",\n      },\n      {\n        title: \"å¤ªå®°åºœç¥ç¤¾\",\n        src: \"https://images.unsplash.com/photo-1624253321033-c4eb104e7462?w=400&q=75&auto=format\",\n      },\n    ],\n\n    // é ˜éšŠè³‡è¨Š\n    leader: {\n      name: \"é¾æƒ å¦‚ å°å§\",\n      domesticPhone: \"+886 0928402897\",\n      overseasPhone: \"+81 08074371189\",\n    },\n\n    // é›†åˆè³‡è¨Š\n    meetingInfo: {\n      time: \"2025/10/21 04:50\",\n      location: \"æ¡ƒåœ’æ©Ÿå ´è¯èˆªç¬¬äºŒèˆªå»ˆ 7è™Ÿæ«ƒå°\",\n    },\n\n    // è¡Œç¨‹å‰¯æ¨™é¡Œ\n    itinerarySubtitle: \"5å¤©4å¤œç²¾å½©æ—…ç¨‹è¦åŠƒ\",\n\n    // é€æ—¥è¡Œç¨‹\n    dailyItinerary: [\n      {\n        dayLabel: \"Day 1\",\n        date: \"10/21 (äºŒ)\",\n        title: \"å°åŒ— âœˆ ç¦å²¡ç©ºæ¸¯ â†’ ç”±å¸ƒé™¢ Â· é‡‘éºŸæ¹– â†’ é˜¿è˜‡æº«æ³‰\",\n        highlight: \"âœ¨ ç‰¹åˆ¥å®‰æ’ï¼šç”±å¸ƒé™¢ Â· é‡‘éºŸæ¹– ï½ æ—¥æœ¬ OL äººæ°£ NO.1 æ•£ç­–åœ°\",\n        description: \"é›†åˆæ–¼å°ç£æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ï¼Œç”±å°ˆäººè¾¦ç†å‡ºå¢ƒæ‰‹çºŒï¼Œæ­ä¹˜è±ªè¯å®¢æ©Ÿï¼Œé£›å¾€æ—¥æœ¬ä¹å·ç„é—œâ”€â”€ç¦å²¡ã€‚\",\n        activities: [],\n        recommendations: [],\n        meals: {\n          breakfast: \"æº«æš–çš„å®¶\",\n          lunch: \"åšå¤šæ‹‰éºµ (Â¥1000)\",\n          dinner: \"é•·è…³èŸ¹è‡ªåŠ©é¤\",\n        },\n        accommodation: \"ASO RESORT GRANDVRIO HOTEL\",\n      },\n      {\n        dayLabel: \"Day 2\",\n        date: \"10/22 (ä¸‰)\",\n        title: \"é˜¿è˜‡ç«å±± â†’ æŸ³å·éŠèˆ¹ â†’ æ—…äººåˆ—è»Š â†’ å¤ªå®°åºœå¤©æ»¿å®®\",\n        highlight: \"\",\n        description: \"\",\n        activities: [\n          { icon: \"ğŸŒ‹\", title: \"é˜¿è˜‡ç«å±±\", description: \"è¿‘è·é›¢è§€è³æ´»ç«å±±å£¯éº—æ™¯è§€\" },\n          { icon: \"ğŸš£\", title: \"æŸ³å·éŠèˆ¹\", description: \"ä¹˜èˆ¹éŠè¦½æ°´é„‰é¢¨æƒ…\" },\n          { icon: \"ğŸšƒ\", title: \"æ—…äººåˆ—è»Š\", description: \"é«”é©—æ—¥å¼é¢¨æƒ…åˆ—è»Š\" },\n          { icon: \"â›©ï¸\", title: \"å¤ªå®°åºœå¤©æ»¿å®®\", description: \"åƒæ‹œå­¸å•ä¹‹ç¥\" },\n        ],\n        recommendations: [],\n        meals: {\n          breakfast: \"é£¯åº—å…§æ—©é¤\",\n          lunch: \"æŸ³å·é°»é­šé£¯ (Â¥2400)\",\n          dinner: \"æ¶®æ¶®é‹åƒåˆ°é£½\",\n        },\n        accommodation: \"QUINTESSA HOTEL FUKUOKA TENJIN MINAMI\",\n      },\n      {\n        dayLabel: \"Day 3-4\",\n        date: \"10/23-10/24\",\n        title: \"ç¦å²¡å…¨æ—¥è‡ªç”±æ´»å‹•\",\n        highlight: \"\",\n        description: \"\",\n        activities: [],\n        recommendations: [\n          \"å¤©ç¥å•†åœˆè³¼ç‰©\",\n          \"ç¦å²¡å¡”\",\n          \"é›…è™å·¨è›‹\",\n          \"é³¥æ – PREMIUM OUTLET\",\n          \"é–€å¸æ¸¯æ‡·èˆŠè¡—é“\",\n        ],\n        meals: {\n          breakfast: \"é£¯åº—å…§æ—©é¤\",\n          lunch: \"æ•¬è«‹è‡ªç†\",\n          dinner: \"æ•¬è«‹è‡ªç†\",\n        },\n        accommodation: \"QUINTESSA HOTEL FUKUOKA TENJIN MINAMI\",\n      },\n      {\n        dayLabel: \"Day 5\",\n        date: \"10/25 (å…­)\",\n        title: \"ç¦å²¡ç©ºæ¸¯ âœˆ å°åŒ—\",\n        highlight: \"\",\n        description: \"äº«å—ä¸€å€‹æ²’æœ‰ MORNING CALL çš„æ—©æ™¨ï¼Œæ‚ é–’çš„é£¯åº—ç”¨å®Œæ—©é¤å¾Œï¼Œæ¥è‘—å‰å¾€ç¦å²¡ç©ºæ¸¯ï¼Œæ­ä¹˜è±ªè¯å®¢æ©Ÿè¿”å›å°åŒ—ï¼ŒçµæŸäº†æ„‰å¿«çš„ä¹å·ä¹‹æ—…ã€‚\",\n        activities: [],\n        recommendations: [],\n        meals: {\n          breakfast: \"é£¯åº—å…§æ—©é¤\",\n          lunch: \"æ©Ÿä¸Šé¤é£Ÿ\",\n          dinner: \"æº«æš–çš„å®¶\",\n        },\n        accommodation: \"\",\n      },\n    ],\n  });\n\n  // Convert icon strings to components for preview\n  const processedData = {\n    ...tourData,\n    features: tourData.features.map((f) => ({\n      ...f,\n      iconComponent: iconMap[f.icon] || IconSparkles,\n    })),\n  };\n\n  // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹\n  useEffect(() => {\n    const calculateScale = () => {\n      if (!containerRef.current) return;\n\n      const container = containerRef.current;\n      const containerWidth = container.clientWidth;\n      const containerHeight = container.clientHeight;\n\n      // èª¿æ•´ç›®æ¨™å°ºå¯¸ï¼ˆå«æ‰‹æ©Ÿæ¡†æ¶ï¼‰\n      const targetWidth = viewMode === 'mobile' ? 410 : 1200;  // 390 + é‚Šæ¡†\n      const targetHeight = viewMode === 'mobile' ? 880 : 800;  // 844 + é‚Šæ¡†\n\n      // è¨ˆç®—ç¸®æ”¾ï¼Œç•™ä¸€äº›é‚Šè·\n      const scaleX = (containerWidth - 40) / targetWidth;\n      const scaleY = (containerHeight - 40) / targetHeight;\n\n      const finalScale = Math.min(scaleX, scaleY, 0.9); // æœ€å¤§ 0.9 é¿å…å¤ªå¤§\n\n      setScale(finalScale);\n    };\n\n    calculateScale();\n    window.addEventListener('resize', calculateScale);\n    return () => window.removeEventListener('resize', calculateScale);\n  }, [viewMode]);\n\n  // åˆ‡æ›åˆ°æ‰‹æ©Ÿæ¨¡å¼æ™‚ï¼Œæ»¾å‹•åˆ°æ¨™é¡Œå€åŸŸ\n  useEffect(() => {\n    if (viewMode === 'mobile' && mobileContentRef.current) {\n      // å»¶é²åŸ·è¡Œç¢ºä¿å…§å®¹å·²æ¸²æŸ“\n      setTimeout(() => {\n        if (mobileContentRef.current) {\n          // æ»¾å‹•åˆ°è®“ã€Œæ¢ç´¢ã€æŒ‰éˆ•å‰›å¥½åœ¨åº•éƒ¨å¯è¦‹\n          const heroHeight = window.innerHeight * 0.7; // é ä¼° hero å€åŸŸé«˜åº¦\n          mobileContentRef.current.scrollTop = heroHeight - 400;\n        }\n      }, 100);\n    }\n  }, [viewMode]);\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* ========== é é¢é ‚éƒ¨å€åŸŸ ========== */}\n      <ResponsiveHeader\n        title=\"æ–°å¢è¡Œç¨‹\"\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è¡Œç¨‹ç®¡ç†', href: '/itinerary' },\n          { label: 'æ–°å¢è¡Œç¨‹', href: '#' }\n        ]}\n        showBackButton={true}\n        onBack={() => router.push('/itinerary')}\n        actions={<PublishButton data={tourData} />}\n      />\n\n      {/* ========== ä¸»è¦å…§å®¹å€åŸŸ ========== */}\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"h-full flex\">\n          {/* å·¦å´ï¼šè¼¸å…¥è¡¨å–® */}\n          <div className=\"w-1/2 bg-white border-r border-border flex flex-col\">\n            <div className=\"h-14 bg-morandi-gold text-white px-6 flex items-center border-b border-border\">\n              <h2 className=\"text-lg font-semibold\">ç·¨è¼¯è¡¨å–®</h2>\n            </div>\n            <div className=\"flex-1 overflow-y-auto\">\n              <TourForm data={tourData} onChange={setTourData} />\n            </div>\n          </div>\n\n          {/* å³å´ï¼šå³æ™‚é è¦½ */}\n          <div className=\"w-1/2 bg-gray-100 flex flex-col\">\n            {/* æ¨™é¡Œåˆ— */}\n            <div className=\"h-14 bg-white border-b px-6 flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <h2 className=\"text-lg font-semibold text-morandi-primary\">å³æ™‚é è¦½</h2>\n                <div className=\"flex gap-2 bg-morandi-container/30 rounded-lg p-1\">\n                  <button\n                    onClick={() => setViewMode('desktop')}\n                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${\n                      viewMode === 'desktop'\n                        ? 'bg-morandi-gold text-white'\n                        : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/50'\n                    }`}\n                  >\n                    ğŸ’» é›»è…¦\n                  </button>\n                  <button\n                    onClick={() => setViewMode('mobile')}\n                    className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${\n                      viewMode === 'mobile'\n                        ? 'bg-morandi-gold text-white'\n                        : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/50'\n                    }`}\n                  >\n                    ğŸ“± æ‰‹æ©Ÿ\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {/* é è¦½å®¹å™¨ */}\n            <div className=\"flex-1 overflow-hidden p-8\" ref={containerRef}>\n              <div className=\"w-full h-full flex items-center justify-center\">\n                {/* ç¸®æ”¾å®¹å™¨ */}\n                <div\n                  style={{\n                    transform: `scale(${scale})`,\n                    transformOrigin: 'center center'\n                  }}\n                >\n                  {viewMode === 'mobile' ? (\n                    // æ‰‹æ©Ÿæ¡†æ¶å’Œå…§å®¹\n                    <div className=\"relative\">\n                      {/* iPhone 14 Pro å°ºå¯¸ */}\n                      <div className=\"bg-black rounded-[45px] p-[8px] shadow-2xl\">\n                        {/* é ‚éƒ¨å‡¹æ§½ (Dynamic Island) */}\n                        <div className=\"absolute top-[20px] left-1/2 -translate-x-1/2 z-10\">\n                          <div className=\"bg-black w-[120px] h-[34px] rounded-full\"></div>\n                        </div>\n\n                        {/* è¢å¹• */}\n                        <div\n                          className=\"bg-black rounded-[37px] overflow-hidden relative\"\n                          style={{\n                            width: '390px',\n                            height: '844px'\n                          }}\n                        >\n                          {/* ç‹€æ…‹åˆ—å®‰å…¨å€ */}\n                          <div className=\"absolute top-0 left-0 right-0 h-[50px] bg-transparent z-10\"></div>\n\n                          {/* å…§å®¹å€åŸŸ */}\n                          <div\n                            className=\"w-full h-full overflow-y-auto\"\n                            ref={mobileContentRef}\n                            style={{\n                              scrollBehavior: 'smooth'\n                            }}\n                          >\n                            <TourPreview data={processedData} viewMode=\"mobile\" />\n                          </div>\n\n                          {/* åº•éƒ¨æŒ‡ç¤ºæ¢ */}\n                          <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 z-10\">\n                            <div className=\"w-32 h-1 bg-black/30 rounded-full\"></div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ) : (\n                    // é›»è…¦ç‰ˆ\n                    <div\n                      className=\"bg-white shadow-2xl rounded-lg overflow-hidden\"\n                      style={{\n                        width: '1200px',\n                        height: '800px'\n                      }}\n                    >\n                      <div className=\"w-full h-full overflow-y-auto\">\n                        <TourPreview data={processedData} viewMode=\"desktop\" />\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/itinerary/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'router'. Either exclude it or remove the dependency array.","line":154,"column":6,"nodeType":"ArrayExpression","endLine":154,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [handleDelete, handleDuplicate]","fix":{"range":[4763,4802],"text":"[handleDelete, handleDuplicate]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { EnhancedTable, TableColumn } from '@/components/ui/enhanced-table';\nimport { MapPin, Calendar, Trash2, Copy, Eye } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useItineraryStore, type Itinerary } from '@/stores';\n\nconst statusFilters = ['å…¨éƒ¨', 'è‰ç¨¿', 'å·²ç™¼å¸ƒ'];\n\nexport default function ItineraryPage() {\n  const router = useRouter();\n  const { items: itineraries, delete: deleteItinerary } = useItineraryStore();\n  const [statusFilter, setStatusFilter] = useState<string>('å…¨éƒ¨');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  // è¤‡è£½è¡Œç¨‹\n  const handleDuplicate = async (id: string) => {\n    // TODO: å¯¦ä½œè¤‡è£½é‚è¼¯\n    console.log('è¤‡è£½è¡Œç¨‹:', id);\n  };\n\n  // åˆªé™¤è¡Œç¨‹\n  const handleDelete = async (id: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {\n      try {\n        await deleteItinerary(id);\n        alert('âœ… åˆªé™¤æˆåŠŸï¼');\n        // Store æœƒè‡ªå‹•æ›´æ–°ï¼Œä¸éœ€è¦é‡æ–°è¼‰å…¥\n      } catch (error) {\n        console.error('åˆªé™¤å¤±æ•—:', error);\n        alert('âŒ åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n      }\n    }\n  };\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'tourCode',\n      label: 'è¡Œç¨‹ç·¨è™Ÿ',\n      sortable: true,\n      render: (value, itinerary: Itinerary) => (\n        <span className=\"text-sm text-morandi-secondary font-mono\">\n          {itinerary.tourCode || '-'}\n        </span>\n      ),\n    },\n    {\n      key: 'title',\n      label: 'è¡Œç¨‹åç¨±',\n      sortable: true,\n      render: (value, itinerary: Itinerary) => (\n        <span className=\"text-sm font-medium text-morandi-primary\">{itinerary.title}</span>\n      ),\n    },\n    {\n      key: 'destination',\n      label: 'ç›®çš„åœ°',\n      sortable: true,\n      render: (value, itinerary: Itinerary) => (\n        <div className=\"flex items-center text-sm text-morandi-secondary\">\n          <MapPin size={14} className=\"mr-1\" />\n          {itinerary.country} Â· {itinerary.city}\n        </div>\n      ),\n    },\n    {\n      key: 'days',\n      label: 'å¤©æ•¸',\n      sortable: true,\n      render: (value, itinerary: Itinerary) => (\n        <span className=\"text-sm text-morandi-secondary\">\n          {itinerary.dailyItinerary?.length || 0} å¤© {Math.max(0, (itinerary.dailyItinerary?.length || 0) - 1)} å¤œ\n        </span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      render: (value, itinerary: Itinerary) => (\n        <span className={cn(\n          'text-sm font-medium',\n          itinerary.status === 'published'\n            ? 'text-green-600'\n            : 'text-gray-600'\n        )}>\n          {itinerary.status === 'published' ? 'å·²ç™¼å¸ƒ' : 'è‰ç¨¿'}\n        </span>\n      ),\n    },\n    {\n      key: 'created_at',\n      label: 'å»ºç«‹æ™‚é–“',\n      sortable: true,\n      render: (value, itinerary: Itinerary) => (\n        <span className=\"text-sm text-morandi-muted\">\n          {new Date(itinerary.created_at).toLocaleDateString('zh-TW')}\n        </span>\n      ),\n    },\n    {\n      key: 'actions',\n      label: 'æ“ä½œ',\n      render: (value, itinerary: Itinerary) => (\n        <div className=\"flex items-center gap-1\">\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              // å›ºå®šä½¿ç”¨ ngrok ç¶²å€ï¼ˆçµ¦å¤–éƒ¨åˆ†äº«ç”¨ï¼‰\n              const baseUrl = 'https://frisky-masonic-mellissa.ngrok-free.dev';\n              const shareUrl = `${baseUrl}/view/${itinerary.id}`;\n\n              // è¤‡è£½åˆ°å‰ªè²¼ç°¿\n              navigator.clipboard.writeText(shareUrl).then(() => {\n                alert('âœ… åˆ†äº«é€£çµå·²è¤‡è£½ï¼\\n\\n' + shareUrl);\n              }).catch(err => {\n                console.error('è¤‡è£½å¤±æ•—:', err);\n                alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š\\n' + shareUrl);\n              });\n            }}\n            className=\"p-1 text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/30 rounded transition-colors\"\n            title=\"ç”¢ç”Ÿåˆ†äº«é€£çµ\"\n          >\n            <Eye size={14} />\n          </button>\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              handleDuplicate(itinerary.id);\n            }}\n            className=\"p-1 text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/30 rounded transition-colors\"\n            title=\"è¤‡è£½è¡Œç¨‹\"\n          >\n            <Copy size={14} />\n          </button>\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              handleDelete(itinerary.id);\n            }}\n            className=\"p-1 text-morandi-red/60 hover:text-morandi-red hover:bg-morandi-red/10 rounded transition-colors\"\n            title=\"åˆªé™¤è¡Œç¨‹\"\n          >\n            <Trash2 size={14} />\n          </button>\n        </div>\n      ),\n    },\n  ], [router, handleDelete, handleDuplicate]);\n\n  // éæ¿¾è³‡æ–™\n  const filteredItineraries = useMemo(() => {\n    let filtered = itineraries;\n\n    // ç‹€æ…‹ç¯©é¸\n    if (statusFilter !== 'å…¨éƒ¨') {\n      filtered = filtered.filter(item => item.status === statusFilter);\n    }\n\n    // æœå°‹ - æœå°‹æ‰€æœ‰æ–‡å­—æ¬„ä½\n    if (searchTerm) {\n      const searchLower = searchTerm.toLowerCase();\n      filtered = filtered.filter(item =>\n        item.title.toLowerCase().includes(searchLower) ||\n        item.country.toLowerCase().includes(searchLower) ||\n        item.city.toLowerCase().includes(searchLower) ||\n        item.tourCode.toLowerCase().includes(searchLower) ||\n        item.status.toLowerCase().includes(searchLower) ||\n        item.description?.toLowerCase().includes(searchLower)\n      );\n    }\n\n    return filtered;\n  }, [itineraries, statusFilter, searchTerm]);\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"è¡Œç¨‹ç®¡ç†\"\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹è¡Œç¨‹...\"\n        onAdd={() => router.push('/itinerary/new')}\n        addLabel=\"æ–°å¢è¡Œç¨‹\"\n      >\n        {/* ç‹€æ…‹ç¯©é¸ */}\n        <div className=\"flex gap-2\">\n          {statusFilters.map((filter) => (\n            <button\n              key={filter}\n              onClick={() => setStatusFilter(filter)}\n              className={cn(\n                'px-3 py-1 rounded-lg text-sm font-medium transition-colors',\n                statusFilter === filter\n                  ? 'bg-morandi-gold text-white'\n                  : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/30'\n              )}\n            >\n              {filter}\n            </button>\n          ))}\n        </div>\n      </ResponsiveHeader>\n\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n          columns={tableColumns}\n          data={filteredItineraries}\n          onRowClick={(itinerary: Itinerary) => router.push(`/itinerary/${itinerary.id}`)}\n        />\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/login/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[805,808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[805,808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[874,877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[874,877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { useLocalAuthStore } from '@/lib/auth/local-auth-manager';\nimport { User, Lock, AlertCircle, Eye, EyeOff, LogIn, X } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\n\nexport default function LoginPage() {\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [showProfileCards, setShowProfileCards] = useState(true);\n  const [profileCards, setProfileCards] = useState<any[]>([]);\n  const [selectedProfile, setSelectedProfile] = useState<any | null>(null);\n  const router = useRouter();\n  const { validateLogin, switchProfile } = useAuthStore();\n  const localAuthStore = useLocalAuthStore();\n\n  // åœ¨ client ç«¯è¼‰å…¥è§’è‰²å¡\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const cards = localAuthStore.getProfileCards();\n      setProfileCards(cards);\n    }\n  }, [localAuthStore]);\n  \n  // å–å¾—ç™»å…¥å¾Œè¦è·³è½‰çš„é é¢\n  const getRedirectPath = (): string => {\n    // å¾ localStorage è®€å–æœ€å¾Œè¨ªå•çš„é é¢\n    const lastPath = localStorage.getItem('last-visited-path');\n    // æ’é™¤ç™»å…¥é é¢\n    if (lastPath && lastPath !== '/login') {\n      return lastPath;\n    }\n    // é è¨­è·³åˆ°é¦–é \n    return '/';\n  };\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    try {\n      const result = await validateLogin(username, password);\n\n      if (result.success) {\n        // ç™»å…¥æˆåŠŸ\n        console.log('âœ… ç™»å…¥æˆåŠŸ');\n        const redirectPath = getRedirectPath();\n        router.push(redirectPath);\n      } else {\n        // ç™»å…¥å¤±æ•—\n        setError(result.message || 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');\n      }\n    } catch (error) {\n      console.error('ç™»å…¥éŒ¯èª¤:', error);\n      setError('ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // è§’è‰²å¡é»æ“Š - ç›´æ¥ç™»å…¥ï¼ˆå·²ç¶“é©—è­‰éäº†ï¼‰\n  const handleProfileCardClick = async (profileId: string) => {\n    const profile = localAuthStore.profiles.find(p => p.id === profileId);\n    if (!profile) return;\n\n    setError('');\n    setIsLoading(true);\n\n    try {\n      // ç›´æ¥åˆ‡æ›è§’è‰²ï¼ˆä½¿ç”¨ switchProfileï¼‰\n      const success = switchProfile(profileId);\n\n      if (success) {\n        console.log('âœ… è§’è‰²å¡å¿«é€Ÿç™»å…¥æˆåŠŸ');\n        const redirectPath = getRedirectPath();\n        router.push(redirectPath);\n      } else {\n        setError('åˆ‡æ›è§’è‰²å¤±æ•—ï¼Œè«‹ä½¿ç”¨å¯†ç¢¼ç™»å…¥');\n        setShowProfileCards(false);\n      }\n    } catch (error) {\n      console.error('å¿«é€Ÿç™»å…¥éŒ¯èª¤:', error);\n      setError('å¿«é€Ÿç™»å…¥å¤±æ•—ï¼Œè«‹ä½¿ç”¨å¯†ç¢¼ç™»å…¥');\n      setShowProfileCards(false);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // åˆªé™¤è§’è‰²å¡\n  const handleDeleteProfile = (e: React.MouseEvent, profileId: string) => {\n    e.stopPropagation(); // é˜²æ­¢è§¸ç™¼ç™»å…¥\n\n    const profile = localAuthStore.profiles.find(p => p.id === profileId);\n    if (!profile) return;\n\n    if (confirm(`ç¢ºå®šè¦ç§»é™¤ã€Œ${profile.display_name}ã€çš„è§’è‰²å¡å—ï¼Ÿ\\n\\nç§»é™¤å¾Œéœ€è¦é‡æ–°å¾ç¶²è·¯ç™»å…¥ã€‚`)) {\n      localAuthStore.removeProfile(profileId);\n      // é‡æ–°è¼‰å…¥è§’è‰²å¡åˆ—è¡¨\n      const cards = localAuthStore.getProfileCards();\n      setProfileCards(cards);\n      console.log('ğŸ—‘ï¸ è§’è‰²å¡å·²åˆªé™¤:', profile.display_name);\n    }\n  };\n\n\n  return (\n    <div className=\"flex items-center justify-center h-screen bg-gradient-to-br from-morandi-light via-white to-morandi-container/20\">\n      <div className=\"bg-white p-8 rounded-xl shadow-lg max-w-md w-full\">\n        {/* Logo å€åŸŸ */}\n        <div className=\"text-center mb-8\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 bg-morandi-gold rounded-full mb-4\">\n            <User size={32} className=\"text-white\" />\n          </div>\n          <h2 className=\"text-2xl font-bold text-morandi-primary\">Venturo ç³»çµ±ç™»å…¥</h2>\n          <p className=\"text-sm text-morandi-secondary mt-2\">è«‹è¼¸å…¥æ‚¨çš„å“¡å·¥å¸³è™Ÿ</p>\n        </div>\n        \n        {/* è§’è‰²å¡å€åŸŸ */}\n        {showProfileCards && profileCards.length > 0 && (\n          <div className=\"mb-6\">\n            <p className=\"text-sm text-morandi-secondary mb-3\">é¸æ“‡è§’è‰²å¿«é€Ÿç™»å…¥ï¼š</p>\n            <div className=\"space-y-2\">\n              {profileCards.map((card) => (\n                <div key={card.id} className=\"relative group\">\n                  <button\n                    type=\"button\"\n                    onClick={() => handleProfileCardClick(card.id)}\n                    className=\"w-full p-3 rounded-lg border border-gray-200 hover:border-morandi-gold hover:bg-morandi-light/20 transition-all flex items-center gap-3 text-left\"\n                  >\n                    <div className=\"w-10 h-10 rounded-full bg-morandi-gold/10 flex items-center justify-center group-hover:bg-morandi-gold/20\">\n                      <User size={20} className=\"text-morandi-gold\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"font-medium text-morandi-primary\">{card.display_name}</div>\n                      <div className=\"text-xs text-morandi-secondary\">{card.english_name} Â· {card.role}</div>\n                    </div>\n                    <LogIn size={18} className=\"text-morandi-secondary group-hover:text-morandi-gold\" />\n                  </button>\n\n                  {/* åˆªé™¤æŒ‰éˆ• - å³ä¸Šè§’ */}\n                  <button\n                    type=\"button\"\n                    onClick={(e) => handleDeleteProfile(e, card.id)}\n                    className=\"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-md\"\n                    title=\"ç§»é™¤è§’è‰²å¡\"\n                  >\n                    <X size={14} />\n                  </button>\n                </div>\n              ))}\n            </div>\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\n              <button\n                type=\"button\"\n                onClick={() => setShowProfileCards(false)}\n                className=\"text-sm text-morandi-secondary hover:text-morandi-primary\"\n              >\n                ä½¿ç”¨å…¶ä»–å¸³è™Ÿç™»å…¥ â†’\n              </button>\n            </div>\n          </div>\n        )}\n\n\n        {/* éŒ¯èª¤è¨Šæ¯ */}\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2\">\n            <AlertCircle size={18} className=\"text-red-500 mt-0.5\" />\n            <span className=\"text-sm text-red-700\">{error}</span>\n          </div>\n        )}\n\n        {/* ç™»å…¥è¡¨å–® */}\n        {(!showProfileCards || profileCards.length === 0) && (\n          <>\n            {/* é¡¯ç¤ºé¸ä¸­çš„è§’è‰² */}\n            {selectedProfile && (\n              <div className=\"mb-6 p-4 rounded-lg bg-morandi-light/30 border border-morandi-gold/20\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-full bg-morandi-gold/20 flex items-center justify-center\">\n                    <User size={24} className=\"text-morandi-gold\" />\n                  </div>\n                  <div>\n                    <div className=\"font-semibold text-morandi-primary\">{selectedProfile.display_name}</div>\n                    <div className=\"text-sm text-morandi-secondary\">{selectedProfile.english_name} Â· {selectedProfile.role}</div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-2\">\n                  å“¡å·¥ç·¨è™Ÿ\n                </label>\n                <div className=\"relative\">\n                  <User size={18} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" />\n                  <Input\n                    type=\"text\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value)}\n                    className=\"pl-10\"\n                    placeholder=\"ä¾‹ï¼šadmin æˆ– john01\"\n                    required\n                    autoComplete=\"username\"\n                    autoFocus={!selectedProfile}\n                    readOnly={!!selectedProfile}\n                  />\n                </div>\n              </div>\n          \n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-2\">\n              å¯†ç¢¼\n            </label>\n            <div className=\"relative\">\n              <Lock size={18} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" />\n              <Input\n                type={showPassword ? \"text\" : \"password\"}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                className=\"pl-10 pr-10\"\n                placeholder=\"è¼¸å…¥å¯†ç¢¼\"\n                required\n                autoComplete=\"current-password\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-morandi-secondary hover:text-morandi-primary\"\n              >\n                {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}\n              </button>\n            </div>\n          </div>\n          \n          <Button\n            type=\"submit\"\n            className=\"w-full bg-morandi-gold hover:bg-morandi-gold/90\"\n            disabled={isLoading}\n          >\n            {isLoading ? 'ç™»å…¥ä¸­...' : 'ç™»å…¥'}\n          </Button>\n        </form>\n          </>\n        )}\n\n        {/* è¿”å›è§’è‰²å¡é¸æ“‡ */}\n        {!showProfileCards && profileCards.length > 0 && (\n          <div className=\"mt-4\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                setShowProfileCards(true);\n                setSelectedProfile(null);\n                setUsername('');\n                setPassword('');\n                setError('');\n              }}\n              className=\"text-sm text-morandi-secondary hover:text-morandi-primary\"\n            >\n              â† è¿”å›è§’è‰²é¸æ“‡\n            </button>\n          </div>\n        )}\n\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/orders/[orderId]/documents/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'type' is defined but never used. Allowed unused args must match /^_/u.","line":63,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":28},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":68,"column":39,"nodeType":"Identifier","endLine":68,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'row' is defined but never used. Allowed unused args must match /^_/u.","line":134,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":134,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4276,4279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4276,4279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4820,4823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4820,4823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useEnhancedTable\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":188,"column":74,"nodeType":"Identifier","endLine":188,"endColumn":90}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useMemo } from 'react';\nimport { useRouter, useParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { Button } from '@/components/ui/button';\nimport { EnhancedTable, TableColumn, useEnhancedTable } from '@/components/ui/enhanced-table';\nimport { useOrderStore } from '@/stores';\nimport { ArrowLeft, FileText, Upload, Download, Eye, Trash2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function DocumentsDetailPage() {\n  const router = useRouter();\n  const params = useParams();\n  const order_id = params.order_id as string;\n  const { items: orders } = useOrderStore();\n\n  const order = orders.find(o => o.id === order_id);\n\n  if (!order) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <p className=\"text-morandi-secondary mb-4\">æ‰¾ä¸åˆ°è©²è¨‚å–®</p>\n          <Button onClick={() => router.push('/orders')} variant=\"outline\">\n            <ArrowLeft size={16} className=\"mr-1\" />\n            è¿”å›è¨‚å–®åˆ—è¡¨\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // æ¨¡æ“¬æ–‡ä»¶æ•¸æ“š\n  const documents = [\n    {\n      id: '1',\n      name: 'è¡Œç¨‹ç¢ºèªæ›¸.pdf',\n      type: 'PDF',\n      size: '2.4 MB',\n      uploadDate: '2024-11-15',\n      category: 'åˆç´„æ–‡ä»¶'\n    },\n    {\n      id: '2',\n      name: 'ä¿éšªæ¸…å–®.xlsx',\n      type: 'Excel',\n      size: '1.2 MB',\n      uploadDate: '2024-11-14',\n      category: 'ä¿éšªæ–‡ä»¶'\n    },\n    {\n      id: '3',\n      name: 'æˆå“¡åå–®.docx',\n      type: 'Word',\n      size: '0.8 MB',\n      uploadDate: '2024-11-13',\n      category: 'æˆå“¡è³‡æ–™'\n    }\n  ];\n\n  const getFileIcon = (type: string) => {\n    return <FileText size={16} className=\"text-morandi-gold\" />;\n  };\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'name',\n      label: 'æ–‡ä»¶åç¨±',\n      sortable: true,\n      filterable: true,\n      render: (value, row) => (\n        <div className=\"flex items-center space-x-2\">\n          {getFileIcon(row.type)}\n          <span className=\"font-medium text-morandi-primary\">{value}</span>\n        </div>\n      )\n    },\n    {\n      key: 'category',\n      label: 'åˆ†é¡',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { value: 'åˆç´„æ–‡ä»¶', label: 'åˆç´„æ–‡ä»¶' },\n        { value: 'ä¿éšªæ–‡ä»¶', label: 'ä¿éšªæ–‡ä»¶' },\n        { value: 'æˆå“¡è³‡æ–™', label: 'æˆå“¡è³‡æ–™' }\n      ],\n      render: (value) => (\n        <span className={cn(\n          'inline-flex items-center px-2 py-1 rounded text-xs font-medium',\n          'bg-morandi-container text-morandi-primary'\n        )}>\n          {value}\n        </span>\n      )\n    },\n    {\n      key: 'type',\n      label: 'é¡å‹',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">{value}</span>\n      )\n    },\n    {\n      key: 'size',\n      label: 'å¤§å°',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">{value}</span>\n      )\n    },\n    {\n      key: 'uploadDate',\n      label: 'ä¸Šå‚³æ—¥æœŸ',\n      sortable: true,\n      filterable: true,\n      filterType: 'date',\n      render: (value) => (\n        <span className=\"text-morandi-secondary\">{value}</span>\n      )\n    },\n    {\n      key: 'actions',\n      label: 'æ“ä½œ',\n      sortable: false,\n      filterable: false,\n      render: (_, row) => (\n        <div className=\"flex items-center space-x-2\">\n          <button\n            className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n            title=\"é è¦½æ–‡ä»¶\"\n          >\n            <Eye size={14} className=\"text-morandi-secondary\" />\n          </button>\n          <button\n            className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n            title=\"ä¸‹è¼‰æ–‡ä»¶\"\n          >\n            <Download size={14} className=\"text-morandi-secondary\" />\n          </button>\n          <button\n            className=\"p-1 hover:bg-morandi-red/10 rounded transition-colors\"\n            title=\"åˆªé™¤æ–‡ä»¶\"\n          >\n            <Trash2 size={14} className=\"text-morandi-red\" />\n          </button>\n        </div>\n      )\n    }\n  ], []);\n\n  // æ’åºå’Œç¯©é¸å‡½æ•¸\n  const sortFunction = (data: any[], column: string, direction: 'asc' | 'desc') => {\n    return [...data].sort((a, b) => {\n      let aValue: string | number | Date = a[column as keyof typeof a];\n      let bValue: string | number | Date = b[column as keyof typeof b];\n\n      if (column === 'uploadDate') {\n        aValue = new Date(aValue);\n        bValue = new Date(bValue);\n      }\n\n      if (aValue < bValue) return direction === 'asc' ? -1 : 1;\n      if (aValue > bValue) return direction === 'asc' ? 1 : -1;\n      return 0;\n    });\n  };\n\n  const filterFunction = (data: any[], filters: Record<string, string>) => {\n    return data.filter(doc => {\n      return (\n        (!filters.name || doc.name.toLowerCase().includes(filters.name.toLowerCase())) &&\n        (!filters.category || doc.category === filters.category) &&\n        (!filters.type || doc.type.toLowerCase().includes(filters.type.toLowerCase())) &&\n        (!filters.size || doc.size.includes(filters.size)) &&\n        (!filters.uploadDate || doc.uploadDate.includes(filters.uploadDate))\n      );\n    });\n  };\n\n  const { data: filteredAndSortedDocuments, handleSort, handleFilter } = useEnhancedTable(\n    documents,\n    sortFunction,\n    filterFunction\n  );\n\n  return (\n    <div className=\"space-y-6 \">\n      <ResponsiveHeader\n        title={`æ–‡ä»¶ç®¡ç† - ${order.order_number}`}\n        onAdd={() => {/* TODO: ä¸Šå‚³æ–‡ä»¶ */}}\n        addLabel=\"ä¸Šå‚³æ–‡ä»¶\"\n      >\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"text-sm text-morandi-secondary\">\n            æ—…éŠåœ˜: <span className=\"text-morandi-primary font-medium\">{order.tour_name}</span>\n          </div>\n          <Button\n            onClick={() => router.push('/orders')}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"p-2\"\n          >\n            <ArrowLeft size={16} />\n          </Button>\n        </div>\n      </ResponsiveHeader>\n\n      <ContentContainer>\n        <EnhancedTable\n          columns={tableColumns}\n          data={filteredAndSortedDocuments}\n          onSort={handleSort}\n          onFilter={handleFilter}\n        />\n\n        {filteredAndSortedDocuments.length === 0 && (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <FileText size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p>å°šæœªä¸Šå‚³ä»»ä½•æ–‡ä»¶</p>\n            <p className=\"text-sm mt-1\">é»æ“Šä¸Šæ–¹ã€Œä¸Šå‚³æ–‡ä»¶ã€æŒ‰éˆ•é–‹å§‹ä¸Šå‚³</p>\n          </div>\n        )}\n      </ContentContainer>\n\n      {/* ä¸Šå‚³å€åŸŸ */}\n      <div className=\"mt-8 border border-dashed border-morandi-container rounded-lg p-8 text-center bg-morandi-container/5\">\n        <Upload size={48} className=\"mx-auto mb-4 text-morandi-secondary opacity-50\" />\n        <p className=\"text-morandi-secondary mb-2\">æ‹–æ‹½æ–‡ä»¶è‡³æ­¤è™•æˆ–é»æ“Šä¸Šå‚³</p>\n        <p className=\"text-sm text-morandi-secondary/70\">æ”¯æ´ PDF, DOC, DOCX, XLS, XLSX, JPG, PNG ç­‰æ ¼å¼</p>\n        <Button className=\"mt-4 bg-morandi-gold hover:bg-morandi-gold-hover text-white\">\n          <Upload size={16} className=\"mr-1\" />\n          é¸æ“‡æ–‡ä»¶\n        </Button>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/orders/[orderId]/members/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useRef } from 'react';\nimport { useRouter, useParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { useOrderStore, useTourStore } from '@/stores';\nimport { ArrowLeft, Plus } from 'lucide-react';\nimport { ExcelMemberTable, MemberTableRef } from '@/components/members/excel-member-table';\n\nexport default function MemberDetailPage() {\n  const router = useRouter();\n  const params = useParams();\n  const orderId = params.orderId as string;\n  const { items: orders } = useOrderStore()\n  const { items: tours } = useTourStore();\n  const memberTableRef = useRef<MemberTableRef | null>(null);\n\n  const order = orders.find(o => o.id === orderId);\n  const tour = tours.find(t => t.id === order?.tour_id);\n\n  if (!order) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <p className=\"text-morandi-secondary mb-4\">æ‰¾ä¸åˆ°è©²è¨‚å–®</p>\n          <Button onClick={() => router.push('/orders')} variant=\"outline\">\n            <ArrowLeft size={16} className=\"mr-1\" />\n            è¿”å›è¨‚å–®åˆ—è¡¨\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 \">\n      <ResponsiveHeader\n        title={`æˆå“¡ç®¡ç† - ${order.order_number}`}\n        onAdd={() => memberTableRef.current?.addRow()}\n        addLabel=\"æ–°å¢æˆå“¡\"\n      >\n        {/* è¨‚å–®è³‡è¨Š */}\n        <div className=\"flex items-center space-x-6 text-sm text-morandi-secondary\">\n          <div className=\"flex items-center space-x-2\">\n            <span>æ—…éŠåœ˜:</span>\n            <span className=\"text-morandi-primary font-medium\">{order.tour_name}</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <span>è¯çµ¡äºº:</span>\n            <span className=\"text-morandi-primary font-medium\">{order.contact_person}</span>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <span>é å®šäººæ•¸:</span>\n            <span className=\"text-morandi-primary font-medium\">{order.member_count}äºº</span>\n          </div>\n          <Button\n            onClick={() => router.push('/orders')}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"p-2 ml-auto\"\n          >\n            <ArrowLeft size={16} />\n          </Button>\n        </div>\n      </ResponsiveHeader>\n\n      {/* æˆå“¡ç®¡ç†è¡¨æ ¼ */}\n      <div className=\"px-6 pb-6\">\n        <div className=\"border border-border rounded-lg overflow-hidden bg-card\">\n          <ExcelMemberTable\n            ref={memberTableRef}\n            order_id={orderId}\n            departure_date={tour?.departure_date || ''}\n            member_count={order.member_count}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/orders/[orderId]/overview/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/orders/[orderId]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/orders/[orderId]/payment/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[925,928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[925,928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[987,990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[987,990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1049,1052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1049,1052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1144,1147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1144,1147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getPaymentStatusBadge' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":43,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getPaymentTypeIcon' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":52,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":52,"endColumn":27},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":58,"column":39,"nodeType":"Identifier","endLine":58,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4101,4104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4101,4104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4647,4650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4647,4650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useEnhancedTable\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":163,"column":73,"nodeType":"Identifier","endLine":163,"endColumn":89}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useMemo } from 'react';\nimport { useRouter, useParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { Button } from '@/components/ui/button';\nimport { EnhancedTable, TableColumn, useEnhancedTable } from '@/components/ui/enhanced-table';\nimport { useOrderStore } from '@/stores';\n// TODO: usePaymentStore deprecated\nimport { ArrowLeft, CreditCard, Plus, TrendingUp, TrendingDown } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport default function PaymentDetailPage() {\n  const router = useRouter();\n  const params = useParams();\n  const orderId = params.orderId as string;\n  const orderStore = useOrderStore();\n  const paymentStore = { payment_requests: [] }; // TODO: usePaymentStore deprecated\n\n  // ç­‰å¾… store è¼‰å…¥\n  const orders = (orderStore as any).orders || [];\n  const paymentRequests = (paymentStore as any).payment_requests || [];\n\n  const order = orders.find((o: any) => o.id === orderId);\n  // æ‰¾å‡ºæ­¤è¨‚å–®ç›¸é—œçš„è«‹æ¬¾å–®\n  const orderPayments = paymentRequests.filter((p: any) => p.order_id === orderId);\n\n  if (!order) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <p className=\"text-morandi-secondary mb-4\">æ‰¾ä¸åˆ°è©²è¨‚å–®</p>\n          <Button onClick={() => router.push('/orders')} variant=\"outline\">\n            <ArrowLeft size={16} className=\"mr-1\" />\n            è¿”å›è¨‚å–®åˆ—è¡¨\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const getPaymentStatusBadge = (status: string) => {\n    const badges: Record<string, string> = {\n      'å·²ç¢ºèª': 'bg-morandi-green text-white',\n      'å¾…ç¢ºèª': 'bg-morandi-gold text-white',\n      'å·²å®Œæˆ': 'bg-morandi-container text-morandi-primary'\n    };\n    return badges[status] || 'bg-morandi-container text-morandi-secondary';\n  };\n\n  const getPaymentTypeIcon = () => {\n    // PaymentRequest éƒ½æ˜¯è«‹æ¬¾é¡å‹\n    return <TrendingDown size={16} className=\"text-morandi-red\" />;\n  };\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'request_number',\n      label: 'è«‹æ¬¾å–®è™Ÿ',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <span className=\"text-morandi-primary font-medium\">{value}</span>\n      )\n    },\n    {\n      key: 'request_date',\n      label: 'è«‹æ¬¾æ—¥æœŸ',\n      sortable: true,\n      filterable: true,\n      filterType: 'date',\n      render: (value) => (\n        <span className=\"text-morandi-primary\">\n          {new Date(value).toLocaleDateString()}\n        </span>\n      )\n    },\n    {\n      key: 'tour_name',\n      label: 'åœ˜é«”åç¨±',\n      sortable: true,\n      filterable: true,\n      render: (value) => (\n        <span className=\"text-morandi-primary\">{value}</span>\n      )\n    },\n    {\n      key: 'total_amount',\n      label: 'è«‹æ¬¾é‡‘é¡',\n      sortable: true,\n      filterable: true,\n      filterType: 'number',\n      render: (value) => (\n        <span className=\"font-medium text-morandi-red\">\n          NT$ {value.toLocaleString()}\n        </span>\n      )\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      filterable: true,\n      filterType: 'select',\n      filterOptions: [\n        { value: 'pending', label: 'å¾…è™•ç†' },\n        { value: 'processing', label: 'è™•ç†ä¸­' },\n        { value: 'confirmed', label: 'å·²ç¢ºèª' },\n        { value: 'paid', label: 'å·²ä»˜æ¬¾' }\n      ],\n      render: (value) => {\n        const statusMap = {\n          'pending': 'å¾…è™•ç†',\n          'processing': 'è™•ç†ä¸­',\n          'confirmed': 'å·²ç¢ºèª',\n          'paid': 'å·²ä»˜æ¬¾'\n        };\n        return (\n          <span className={cn(\n            'inline-flex items-center px-2 py-1 rounded text-xs font-medium',\n            value === 'paid' ? 'bg-morandi-green text-white' :\n            value === 'confirmed' ? 'bg-morandi-container text-morandi-primary' :\n            'bg-morandi-gold text-white'\n          )}>\n            {statusMap[value as keyof typeof statusMap] || value}\n          </span>\n        );\n      }\n    }\n  ], []);\n\n  // æ’åºå’Œç¯©é¸å‡½æ•¸\n  const sortFunction = (data: any[], column: string, direction: 'asc' | 'desc') => {\n    return [...data].sort((a, b) => {\n      let aValue: string | number | Date = a[column as keyof typeof a];\n      let bValue: string | number | Date = b[column as keyof typeof b];\n\n      if (column === 'request_date') {\n        aValue = new Date(aValue);\n        bValue = new Date(bValue);\n      }\n\n      if (aValue < bValue) return direction === 'asc' ? -1 : 1;\n      if (aValue > bValue) return direction === 'asc' ? 1 : -1;\n      return 0;\n    });\n  };\n\n  const filterFunction = (data: any[], filters: Record<string, string>) => {\n    return data.filter(payment => {\n      return (\n        (!filters.request_number || payment.request_number.includes(filters.request_number)) &&\n        (!filters.request_date || new Date(payment.request_date).toLocaleDateString().includes(filters.request_date)) &&\n        (!filters.tour_name || payment.tour_name.toLowerCase().includes(filters.tour_name.toLowerCase())) &&\n        (!filters.total_amount || payment.total_amount.toString().includes(filters.total_amount)) &&\n        (!filters.status || payment.status === filters.status)\n      );\n    });\n  };\n\n  const { data: filteredAndSortedPayments, handleSort, handleFilter } = useEnhancedTable(\n    orderPayments,\n    sortFunction,\n    filterFunction\n  );\n\n  return (\n    <div className=\"space-y-6 \">\n      <ResponsiveHeader\n        title={`è«‹æ¬¾è¨˜éŒ„ - ${order.order_number}`}\n        onAdd={() => router.push('/finance/requests')}\n        addLabel=\"å‰å¾€è«‹æ¬¾ç®¡ç†\"\n      >\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"text-sm text-morandi-secondary\">\n            è¯çµ¡äºº: <span className=\"text-morandi-primary font-medium\">{order.contact_person}</span>\n          </div>\n          <Button\n            onClick={() => router.push('/orders')}\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"p-2\"\n          >\n            <ArrowLeft size={16} />\n          </Button>\n        </div>\n      </ResponsiveHeader>\n\n      <ContentContainer>\n        <EnhancedTable\n          columns={tableColumns}\n          data={filteredAndSortedPayments}\n          onSort={handleSort}\n          onFilter={handleFilter}\n          selection={undefined}\n        />\n\n        {filteredAndSortedPayments.length === 0 && (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <CreditCard size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p>æ­¤è¨‚å–®å°šç„¡è«‹æ¬¾è¨˜éŒ„</p>\n            <p className=\"text-sm mt-1\">è«‹å‰å¾€è²¡å‹™ç®¡ç†å»ºç«‹è«‹æ¬¾å–®</p>\n          </div>\n        )}\n      </ContentContainer>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/orders/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Combobox' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setTourFilter' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1944,1947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1944,1947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sevenDaysLater' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":45,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4590,4593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4590,4593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4782,4785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4782,4785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Combobox } from '@/components/ui/combobox';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { useOrderStore, useTourStore } from '@/stores';\nimport { ShoppingCart, AlertCircle, CheckCircle, Clock } from 'lucide-react';\nimport { SimpleOrderTable } from '@/components/orders/simple-order-table';\nimport { AddOrderForm } from '@/components/orders/add-order-form';\nimport { cn } from '@/lib/utils';\n\nexport default function OrdersPage() {\n  const router = useRouter();\n  const { items: orders, create: addOrder } = useOrderStore();\n  const { items: tours } = useTourStore();\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [tourFilter, setTourFilter] = useState('');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n\n  const filteredOrders = orders.filter(order => {\n    const matchesStatus = statusFilter === 'all' || order.payment_status === statusFilter;\n    const matchesTour = !tourFilter || order.tour_id === tourFilter;\n\n    const searchLower = searchQuery.toLowerCase();\n    const matchesSearch = !searchQuery ||\n      order.order_number.toLowerCase().includes(searchLower) ||\n      order.code?.toLowerCase().includes(searchLower) ||\n      order.tour_name?.toLowerCase().includes(searchLower) ||\n      order.contact_person.toLowerCase().includes(searchLower) ||\n      order.sales_person?.toLowerCase().includes(searchLower) ||\n      order.assistant?.toLowerCase().includes(searchLower);\n\n    return matchesStatus && matchesTour && matchesSearch;\n  });\n\n  // è¨ˆç®—å¾…è¾¦äº‹é …\n  const todos = React.useMemo(() => {\n    const result: any[] = [];\n    const today = new Date();\n    const sevenDaysLater = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);\n\n    orders.forEach(order => {\n      const tour = tours.find(t => t.id === order.tour_id);\n      if (!tour) return;\n\n      const departure_date = new Date(tour.departure_date);\n      const daysUntilDeparture = Math.ceil((departure_date.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n\n      // 1. å³å°‡å‡ºç™¼ä½†æœªæ”¶é½Šæ¬¾é …\n      if (daysUntilDeparture <= 7 && daysUntilDeparture >= 0 && order.payment_status !== 'paid') {\n        result.push({\n          type: 'payment',\n          priority: 'high',\n          message: `${order.order_number} - ${daysUntilDeparture}å¤©å¾Œå‡ºç™¼ï¼Œå°šæœªæ”¶é½Šæ¬¾é …`,\n          order_id: order.id\n        });\n      }\n\n      // 2. æœªæ”¶æ¬¾è¶…é30å¤©\n      if (order.payment_status === 'unpaid') {\n        const orderDate = new Date(order.created_at || today);\n        const daysOverdue = Math.ceil((today.getTime() - orderDate.getTime()) / (1000 * 60 * 60 * 24));\n        if (daysOverdue > 30) {\n          result.push({\n            type: 'overdue',\n            priority: 'high',\n            message: `${order.order_number} - è¨‚å–®å·²${daysOverdue}å¤©æœªæ”¶æ¬¾`,\n            order_id: order.id\n          });\n        }\n      }\n\n      // 3. éƒ¨åˆ†æ”¶æ¬¾æé†’\n      if (order.payment_status === 'partial' && daysUntilDeparture <= 14 && daysUntilDeparture >= 0) {\n        result.push({\n          type: 'partial',\n          priority: 'medium',\n          message: `${order.order_number} - å°šæœ‰ NT$ ${order.remaining_amount.toLocaleString()} æœªæ”¶`,\n          order_id: order.id\n        });\n      }\n    });\n\n    return result;\n  }, [orders, tours]);\n\n\n  const handleAddOrder = (orderData: {\n    tour_id: string;\n    contact_person: string;\n    sales_person: string;\n    assistant: string;\n    member_count: number;\n    total_amount: number;\n  }) => {\n    const selectedTour = tours.find(t => t.id === orderData.tour_id);\n    if (!selectedTour) return;\n\n    // è¨ˆç®—è©²åœ˜çš„è¨‚å–®åºè™Ÿ\n    const tourOrders = orders.filter(o => o.tour_id === orderData.tour_id);\n    const nextOrderNumber = tourOrders.length + 1;\n    const orderNumber = `${selectedTour.code}-${nextOrderNumber.toString().padStart(2, '0')}`;\n\n    addOrder({\n      order_number: orderNumber,\n      tour_id: orderData.tour_id,\n      code: selectedTour.code,\n      tour_name: selectedTour.name,\n      contact_person: orderData.contact_person,\n      sales_person: orderData.sales_person,\n      assistant: orderData.assistant,\n      member_count: orderData.member_count,\n      total_amount: orderData.total_amount,\n      paid_amount: 0,\n      payment_status: 'unpaid',\n      remaining_amount: orderData.total_amount\n    } as any);\n\n    setIsAddDialogOpen(false);\n  };\n\n\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        {...{\n        title: \"è¨‚å–®ç®¡ç†\",\n        icon: ShoppingCart} as any}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è¨‚å–®ç®¡ç†', href: '/orders' }\n        ]}\n        showSearch={true}\n        searchTerm={searchQuery}\n        onSearchChange={setSearchQuery}\n        searchPlaceholder=\"æœå°‹è¨‚å–®...\"\n        tabs={[\n          { value: 'all', label: 'å…¨éƒ¨', icon: ShoppingCart },\n          { value: 'unpaid', label: 'æœªæ”¶æ¬¾', icon: AlertCircle },\n          { value: 'partial', label: 'éƒ¨åˆ†æ”¶æ¬¾', icon: Clock },\n          { value: 'paid', label: 'å·²æ”¶æ¬¾', icon: CheckCircle }\n        ]}\n        activeTab={statusFilter}\n        onTabChange={setStatusFilter}\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢è¨‚å–®\"\n        actions={\n          todos.length > 0 && (\n            <div className=\"flex items-center gap-2 px-3 py-1.5 bg-morandi-red/10 text-morandi-red rounded-lg\">\n              <AlertCircle size={16} />\n              <span className=\"text-sm font-medium\">{todos.length} å€‹å¾…è¾¦</span>\n            </div>\n          )\n        }\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        {/* å¾…è¾¦äº‹é …æé†’ */}\n        {todos.length > 0 && (\n        <div className=\"mb-6\">\n          <div className=\"bg-morandi-red/5 border border-morandi-red/20 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <AlertCircle size={20} className=\"text-morandi-red\" />\n              <h3 className=\"font-semibold text-morandi-primary\">å¾…è¾¦äº‹é …</h3>\n            </div>\n            <div className=\"space-y-2\">\n              {todos.map((todo, index) => (\n                <div\n                  key={index}\n                  className=\"flex items-start gap-3 p-3 bg-white rounded-lg hover:bg-morandi-container/20 transition-colors cursor-pointer\"\n                  onClick={() => {\n                    const order = orders.find(o => o.id === todo.order_id);\n                    if (order) {\n                      router.push(`/orders/${order.id}`);\n                    }\n                  }}\n                >\n                  <div className={cn(\n                    \"w-2 h-2 rounded-full mt-1.5 flex-shrink-0\",\n                    todo.priority === 'high' ? \"bg-morandi-red\" : \"bg-morandi-gold\"\n                  )} />\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm text-morandi-primary\">{todo.message}</p>\n                    <p className=\"text-xs text-morandi-secondary mt-1\">\n                      {todo.type === 'payment' && 'ğŸ’° æ”¶æ¬¾æé†’'}\n                      {todo.type === 'overdue' && 'âš ï¸ é€¾æœŸæé†’'}\n                      {todo.type === 'partial' && 'ğŸ’µ å°¾æ¬¾æé†’'}\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n        {/* è¨‚å–®åˆ—è¡¨ */}\n        <SimpleOrderTable\n          className=\"min-h-full\"\n          orders={filteredOrders}\n          showTourInfo={true}\n        />\n      </div>\n\n      {/* æ–°å¢è¨‚å–®å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢è¨‚å–®</DialogTitle>\n          </DialogHeader>\n          <AddOrderForm\n            onSubmit={handleAddOrder}\n            onCancel={() => setIsAddDialogOpen(false)}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[886,889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[886,889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":1,"message":"Unnecessary escape character: \\/.","line":128,"column":15,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":128,"endColumn":16,"suggestions":[{"messageId":"removeEscape","fix":{"range":[3644,3645],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[3644,3644],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":147,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":147,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'DEFAULT_RATES'. Either include it or remove the dependency array.","line":337,"column":6,"nodeType":"ArrayExpression","endLine":337,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [DEFAULT_RATES, selectedCurrency, useCustomRate]","fix":{"range":[11227,11260],"text":"[DEFAULT_RATES, selectedCurrency, useCustomRate]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'calculateForeign', 'calculateTWD', 'direction', 'foreignAmount', and 'twdAmount'. Either include them or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setForeignAmount' needs the current value of 'twdAmount'.","line":375,"column":6,"nodeType":"ArrayExpression","endLine":375,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [calculateForeign, calculateTWD, customRate, direction, foreignAmount, twdAmount]","fix":{"range":[12267,12279],"text":"[calculateForeign, calculateTWD, customRate, direction, foreignAmount, twdAmount]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'calculateForeign' and 'twdAmount'. Either include them or remove the dependency array. You can also replace multiple useState variables with useReducer if 'setForeignAmount' needs the current value of 'twdAmount'.","line":380,"column":6,"nodeType":"ArrayExpression","endLine":380,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [calculateForeign, twdAmount]","fix":{"range":[12372,12374],"text":"[calculateForeign, twdAmount]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":527,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":527,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18328,18331],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18328,18331],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Settings } from 'lucide-react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Card } from '@/components/ui/card';\nimport { Calculator, DollarSign, Clock, Clipboard, BarChart3, CheckSquare, TrendingUp, Briefcase, Calendar } from 'lucide-react';\nimport { useTourStore, useOrderStore } from '@/stores';\n\n// å¯ç”¨çš„å°å·¥å…·é¡å‹\ntype WidgetType = 'calculator' | 'currency' | 'timer' | 'notes' | 'stats';\n\ninterface WidgetConfig {\n  id: WidgetType;\n  name: string;\n  icon: any;\n  component: React.ComponentType;\n  span?: number; // ä½”æ“šçš„åˆ—æ•¸ï¼ˆ1 æˆ– 2ï¼‰\n}\n\n// ç°¡æ˜“è¨ˆç®—æ©Ÿçµ„ä»¶ï¼ˆiPhone é¢¨æ ¼ï¼‰\nfunction CalculatorWidget() {\n  const [inputValue, setInputValue] = useState('');\n  const [sequentialMode, setSequentialMode] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // æ¸…ç†è¼¸å…¥ï¼šç§»é™¤ä¸­æ–‡ã€è½‰æ›å…¨å½¢ç‚ºåŠå½¢ã€ç§»é™¤ç©ºç™½\n  const cleanInput = (text: string): string => {\n    let result = text;\n\n    // ç§»é™¤ä¸­æ–‡å­—ç¬¦\n    result = result.replace(/[\\u4e00-\\u9fa5]/g, '');\n\n    // è½‰æ›å…¨å½¢æ•¸å­—ç‚ºåŠå½¢\n    result = result.replace(/[\\uff10-\\uff19]/g, (char) =>\n      String.fromCharCode(char.charCodeAt(0) - 0xfee0)\n    );\n\n    // è½‰æ›å…¨å½¢ç¬¦è™Ÿç‚ºåŠå½¢\n    result = result.replace(/[\\uff0b\\uff0d\\uff0a\\uff0f\\uff08\\uff09\\uff0e]/g, (char) => {\n      const fullToHalf: Record<string, string> = {\n        'ï¼‹': '+', 'ï¼': '-', 'ï¼Š': '*', 'ï¼': '/',\n        'ï¼ˆ': '(', 'ï¼‰': ')', 'ï¼': '.'\n      };\n      return fullToHalf[char] || char;\n    });\n\n    // ç§»é™¤æ‰€æœ‰ç©ºç™½\n    result = result.replace(/\\s/g, '');\n\n    // åªä¿ç•™æ•¸å­—ã€é‹ç®—ç¬¦è™Ÿã€å°æ•¸é»ã€æ‹¬è™Ÿ\n    result = result.replace(/[^0-9+\\-*/.()]/g, '');\n\n    return result;\n  };\n\n  // é †åºè¨ˆç®—ï¼ˆå¾å·¦åˆ°å³ï¼‰\n  const calculateSequential = (expression: string): number => {\n    // ç§»é™¤æ‹¬è™Ÿï¼ˆé †åºè¨ˆç®—ä¸æ”¯æ´æ‹¬è™Ÿï¼‰\n    const expr = expression.replace(/[()]/g, '');\n\n    // æ‹†åˆ†æ•¸å­—å’Œé‹ç®—ç¬¦è™Ÿ\n    const tokens: (number | string)[] = [];\n    let currentNumber = '';\n\n    for (let i = 0; i < expr.length; i++) {\n      const char = expr[i];\n      if (char >= '0' && char <= '9' || char === '.') {\n        currentNumber += char;\n      } else if (['+', '-', '*', '/'].includes(char)) {\n        // è™•ç†è² è™Ÿï¼šå¦‚æœæ˜¯ç¬¬ä¸€å€‹å­—ç¬¦æˆ–å‰ä¸€å€‹æ˜¯é‹ç®—ç¬¦è™Ÿï¼Œè¦–ç‚ºè² è™Ÿ\n        if (char === '-' && (i === 0 || ['+', '-', '*', '/'].includes(expr[i - 1]))) {\n          currentNumber += char;\n        } else {\n          if (currentNumber) {\n            tokens.push(parseFloat(currentNumber));\n            currentNumber = '';\n          }\n          tokens.push(char);\n        }\n      }\n    }\n    if (currentNumber) {\n      tokens.push(parseFloat(currentNumber));\n    }\n\n    // å¾å·¦åˆ°å³è¨ˆç®—\n    if (tokens.length === 0) return 0;\n    let result = tokens[0] as number;\n    for (let i = 1; i < tokens.length; i += 2) {\n      const operator = tokens[i] as string;\n      const nextNum = tokens[i + 1] as number;\n\n      if (operator === '+') result += nextNum;\n      else if (operator === '-') result -= nextNum;\n      else if (operator === '*') result *= nextNum;\n      else if (operator === '/') result /= nextNum;\n    }\n\n    return result;\n  };\n\n  // å³æ™‚è¨ˆç®—çµæœ\n  const calculateResult = (): string => {\n    if (!inputValue.trim()) return '0';\n\n    try {\n      const sanitized = inputValue.replace(/[^0-9+\\-*/.()]/g, '');\n      if (!sanitized) return '0';\n\n      // æª¢æŸ¥æ˜¯å¦åªæœ‰é‹ç®—ç¬¦è™Ÿï¼Œæ²’æœ‰æ•¸å­—\n      if (!/\\d/.test(sanitized)) {\n        return '0';\n      }\n\n      // æª¢æŸ¥æ˜¯å¦ä»¥é‹ç®—ç¬¦è™Ÿé–‹é ­æˆ–çµå°¾ï¼ˆé™¤äº†è² è™Ÿï¼‰\n      if (/[+*\\/]$/.test(sanitized)) {\n        return inputValue; // é¡¯ç¤ºåŸå§‹è¼¸å…¥\n      }\n\n      let calculationResult: number;\n\n      if (sequentialMode) {\n        // é †åºè¨ˆç®—æ¨¡å¼\n        calculationResult = calculateSequential(sanitized);\n      } else {\n        // æ•¸å­¸å„ªå…ˆæ¨¡å¼\n        calculationResult = Function('\"use strict\"; return (' + sanitized + ')')();\n      }\n\n      if (typeof calculationResult === 'number' && !isNaN(calculationResult)) {\n        // æ ¼å¼åŒ–æ•¸å­—ï¼Œæœ€å¤šé¡¯ç¤º 8 ä½å°æ•¸\n        return parseFloat(calculationResult.toFixed(8)).toString();\n      }\n      return inputValue;\n    } catch (error) {\n      // å¦‚æœè¨ˆç®—å¤±æ•—ï¼Œè¿”å›åŸå§‹è¼¸å…¥è€Œä¸æ˜¯ã€ŒéŒ¯èª¤ã€\n      return inputValue;\n    }\n  };\n\n  // è™•ç†è¼¸å…¥è®Šæ›´\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const cleaned = cleanInput(e.target.value);\n    setInputValue(cleaned);\n  };\n\n  // è™•ç†è²¼ä¸Šäº‹ä»¶\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\n    e.preventDefault();\n    const pastedText = e.clipboardData.getData('text');\n    const cleaned = cleanInput(pastedText);\n    setInputValue(cleaned);\n  };\n\n  // è™•ç†æŒ‰éµäº‹ä»¶\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      const result = calculateResult();\n      setInputValue(result);\n    } else if (e.key === 'Escape') {\n      setInputValue('');\n    }\n  };\n\n  // å¿«é€Ÿæ’å…¥æŒ‰éˆ•é»æ“Š\n  const handleButtonClick = (value: string) => {\n    if (value === '=') {\n      const result = calculateResult();\n      setInputValue(result);\n    } else if (value === 'C') {\n      setInputValue('');\n    } else {\n      setInputValue(prev => prev + value);\n    }\n  };\n\n  const displayResult = calculateResult();\n\n  return (\n    <Card className=\"overflow-hidden flex flex-col h-full border border-[#E6DDD4] shadow-sm rounded-2xl hover:shadow-md hover:border-morandi-gold/50 transition-all duration-200\">\n      <div className=\"bg-morandi-container px-4 py-3 border-b border-[#E6DDD4] flex-shrink-0\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Calculator className=\"h-4 w-4 text-morandi-gold\" />\n            <h3 className=\"font-semibold text-sm text-morandi-primary\">è¨ˆç®—æ©Ÿ</h3>\n          </div>\n          <label className=\"flex items-center gap-1.5 cursor-pointer group\">\n            <input\n              type=\"checkbox\"\n              checked={sequentialMode}\n              onChange={(e) => setSequentialMode(e.target.checked)}\n              className=\"w-3.5 h-3.5 rounded border-morandi-gold/30 text-morandi-gold focus:ring-morandi-gold/20 cursor-pointer\"\n            />\n            <span className=\"text-xs text-morandi-secondary group-hover:text-morandi-primary transition-colors\">é †åºè¨ˆç®—</span>\n          </label>\n        </div>\n      </div>\n      <div className=\"p-4 flex-1 flex flex-col overflow-hidden\">\n        <div className=\"space-y-3 flex-1 flex flex-col min-h-0\">\n        {/* iPhone é¢¨æ ¼é¡¯ç¤ºå€ */}\n        <div\n          className=\"bg-white rounded-xl p-4 min-h-[80px] flex flex-col justify-end border border-[#E6DDD4] cursor-text shadow-sm\"\n          onClick={() => inputRef.current?.focus()}\n        >\n          {/* ç®—å¼è¼¸å…¥ï¼ˆå°å­—ç°è‰²ï¼‰ */}\n          <input\n            ref={inputRef}\n            type=\"text\"\n            inputMode=\"text\"\n            value={inputValue}\n            onChange={handleInputChange}\n            onPaste={handlePaste}\n            onKeyDown={handleKeyDown}\n            autoComplete=\"off\"\n            className=\"w-full bg-transparent border-none outline-none text-right font-mono text-sm text-morandi-secondary mb-1 placeholder:text-morandi-muted/40\"\n            placeholder=\"ç›´æ¥è¼¸å…¥æˆ–é»æ“ŠæŒ‰éˆ•\"\n          />\n          {/* å³æ™‚çµæœï¼ˆå¤§å­—é»‘è‰²ï¼‰ */}\n          <div className=\"text-right text-2xl font-bold text-morandi-primary font-mono tracking-tight\">\n            {displayResult}\n          </div>\n        </div>\n\n        {/* å¿«é€ŸæŒ‰éˆ• */}\n        <div className=\"grid grid-cols-4 gap-1.5 flex-shrink-0\">\n          {['7', '8', '9', '/'].map((btn) => (\n            <Button\n              key={btn}\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleButtonClick(btn)}\n              className=\"h-9 text-sm font-medium bg-white border-[#E6DDD4] hover:border-morandi-gold transition-all rounded-xl\"\n            >\n              {btn}\n            </Button>\n          ))}\n          {['4', '5', '6', '*'].map((btn) => (\n            <Button\n              key={btn}\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleButtonClick(btn)}\n              className=\"h-9 text-sm font-medium bg-white border-[#E6DDD4] hover:border-morandi-gold transition-all rounded-xl\"\n            >\n              {btn}\n            </Button>\n          ))}\n          {['1', '2', '3', '-'].map((btn) => (\n            <Button\n              key={btn}\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleButtonClick(btn)}\n              className=\"h-9 text-sm font-medium bg-white border-[#E6DDD4] hover:border-morandi-gold transition-all rounded-xl\"\n            >\n              {btn}\n            </Button>\n          ))}\n          {['0', '.', '(', ')'].map((btn) => (\n            <Button\n              key={btn}\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleButtonClick(btn)}\n              className=\"h-9 text-sm font-medium bg-white border-[#E6DDD4] hover:border-morandi-gold transition-all rounded-xl\"\n            >\n              {btn}\n            </Button>\n          ))}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => handleButtonClick('+')}\n            className=\"h-9 text-sm font-medium bg-white/80 border-[#E6DDD4]/50 hover:bg-white hover:border-morandi-gold hover:scale-105 transition-all rounded-xl\"\n          >\n            +\n          </Button>\n          <Button\n            size=\"sm\"\n            onClick={() => handleButtonClick('=')}\n            className=\"h-9 text-sm font-medium bg-gradient-to-r from-[#B5986A] to-[#D4C4A8] border-0 text-white shadow-lg transition-all duration-200 active:scale-95 rounded-xl\"\n          >\n            =\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => handleButtonClick('C')}\n            className=\"h-9 text-sm font-medium col-span-2 bg-white/80 border-[#E6DDD4]/50 hover:bg-red-50 hover:text-red-600 hover:border-red-300 hover:scale-105 transition-all rounded-xl\"\n          >\n            æ¸…é™¤\n          </Button>\n        </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n\n// åŒ¯ç‡è½‰æ›çµ„ä»¶ï¼ˆé›™å‘è½‰æ›ï¼‰\nfunction CurrencyWidget() {\n  // é è¨­åŒ¯ç‡ï¼ˆ1 å¤–å¹£ = ? å°å¹£ï¼‰\n  const DEFAULT_RATES = {\n    USD: { rate: 31.5, symbol: '$', name: 'ç¾é‡‘' },\n    JPY: { rate: 0.21, symbol: 'Â¥', name: 'æ—¥å¹£' },\n    KRW: { rate: 0.024, symbol: 'â‚©', name: 'éŸ“å…ƒ' },\n    CNY: { rate: 4.35, symbol: 'Â¥', name: 'äººæ°‘å¹£' },\n    VND: { rate: 0.00127, symbol: 'â‚«', name: 'è¶Šå—ç›¾' },\n    IDR: { rate: 0.002, symbol: 'Rp', name: 'å°å°¼ç›¾' },\n  };\n\n  const [twdAmount, setTwdAmount] = useState('10000');\n  const [foreignAmount, setForeignAmount] = useState('');\n  const [selectedCurrency, setSelectedCurrency] = useState<keyof typeof DEFAULT_RATES>('USD');\n  const [customRate, setCustomRate] = useState(DEFAULT_RATES.USD.rate.toString());\n  const [useCustomRate, setUseCustomRate] = useState(false);\n  const [direction, setDirection] = useState<'twd-to-foreign' | 'foreign-to-twd'>('twd-to-foreign');\n\n  // ç•¶åˆ‡æ›è²¨å¹£æ™‚ï¼Œæ›´æ–°åŒ¯ç‡\n  useEffect(() => {\n    if (!useCustomRate) {\n      setCustomRate(DEFAULT_RATES[selectedCurrency].rate.toString());\n    }\n  }, [selectedCurrency, useCustomRate]);\n\n  // è¨ˆç®—å¤–å¹£é‡‘é¡ï¼ˆå°å¹£ â†’ å¤–å¹£ï¼‰\n  const calculateForeign = (twd: string): string => {\n    const amount = parseFloat(twd) || 0;\n    const rate = parseFloat(customRate) || 0;\n    if (rate === 0) return '0';\n    return (amount / rate).toFixed(2);\n  };\n\n  // è¨ˆç®—å°å¹£é‡‘é¡ï¼ˆå¤–å¹£ â†’ å°å¹£ï¼‰\n  const calculateTWD = (foreign: string): string => {\n    const amount = parseFloat(foreign) || 0;\n    const rate = parseFloat(customRate) || 0;\n    return (amount * rate).toFixed(2);\n  };\n\n  // ç•¶å°å¹£é‡‘é¡è®Šæ›´\n  const handleTwdChange = (value: string) => {\n    setTwdAmount(value);\n    setDirection('twd-to-foreign');\n    setForeignAmount(calculateForeign(value));\n  };\n\n  // ç•¶å¤–å¹£é‡‘é¡è®Šæ›´\n  const handleForeignChange = (value: string) => {\n    setForeignAmount(value);\n    setDirection('foreign-to-twd');\n    setTwdAmount(calculateTWD(value));\n  };\n\n  // ç•¶åŒ¯ç‡è®Šæ›´æ™‚ï¼Œé‡æ–°è¨ˆç®—\n  useEffect(() => {\n    if (direction === 'twd-to-foreign') {\n      setForeignAmount(calculateForeign(twdAmount));\n    } else {\n      setTwdAmount(calculateTWD(foreignAmount));\n    }\n  }, [customRate]);\n\n  // åˆå§‹åŒ–å¤–å¹£é‡‘é¡\n  useEffect(() => {\n    setForeignAmount(calculateForeign(twdAmount));\n  }, []);\n\n  const currencyInfo = DEFAULT_RATES[selectedCurrency];\n\n  // åˆ‡æ›æ–¹å‘\n  const swapDirection = () => {\n    setDirection(prev => prev === 'twd-to-foreign' ? 'foreign-to-twd' : 'twd-to-foreign');\n  };\n\n  return (\n    <Card className=\"overflow-hidden flex flex-col h-full border border-[#E6DDD4] shadow-sm rounded-2xl hover:shadow-md hover:border-morandi-gold/50 transition-all duration-200\">\n      <div className=\"bg-morandi-container px-4 py-3 border-b border-[#E6DDD4] flex-shrink-0\">\n        <div className=\"flex items-center gap-2\">\n          <DollarSign className=\"h-4 w-4 text-morandi-gold\" />\n          <h3 className=\"font-semibold text-sm text-morandi-primary\">åŒ¯ç‡æ›ç®—</h3>\n        </div>\n      </div>\n      <div className=\"p-4 space-y-3 flex-1 overflow-y-auto min-h-0\">\n        {/* è²¨å¹£é¸æ“‡ */}\n        <div>\n          <label className=\"text-xs font-medium text-morandi-primary mb-1.5 block\">é¸æ“‡è²¨å¹£</label>\n          <select\n            value={selectedCurrency}\n            onChange={(e) => {\n              setSelectedCurrency(e.target.value as keyof typeof DEFAULT_RATES);\n              setUseCustomRate(false);\n            }}\n            className=\"w-full px-3 py-2 text-sm border border-[#E6DDD4] rounded-xl bg-white hover:border-morandi-gold focus:border-morandi-gold focus:ring-2 focus:ring-morandi-gold/10 transition-all outline-none\"\n          >\n            {Object.entries(DEFAULT_RATES).map(([code, info]) => (\n              <option key={code} value={code}>\n                {info.symbol} {info.name} ({code})\n              </option>\n            ))}\n          </select>\n        </div>\n\n        {/* å°å¹£å’Œå¤–å¹£è¼¸å…¥ï¼ˆå·¦å³ä¸¦æ’ï¼‰ */}\n        <div className=\"flex items-end gap-2\">\n          {/* å°å¹£è¼¸å…¥ */}\n          <div className=\"flex-1\">\n            <label className=\"text-xs font-medium text-morandi-primary mb-1.5 block\">å°å¹£ (TWD)</label>\n            <div className=\"relative\">\n              <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-muted text-xs font-medium\">NT$</span>\n              <input\n                type=\"number\"\n                value={twdAmount}\n                onChange={(e) => handleTwdChange(e.target.value)}\n                className=\"w-full px-3 py-2 pl-[42px] border border-[#E6DDD4] rounded-xl font-mono text-sm bg-white hover:border-morandi-gold focus:border-morandi-gold focus:ring-2 focus:ring-morandi-gold/10 transition-all outline-none\"\n                placeholder=\"10000\"\n              />\n            </div>\n          </div>\n\n          {/* é›™å‘ç®­é ­ */}\n          <button\n            onClick={swapDirection}\n            className=\"p-2 hover:bg-morandi-gold/10 rounded-xl transition-all group mb-0.5\"\n            title=\"åˆ‡æ›æ–¹å‘\"\n          >\n            <svg\n              className=\"h-4 w-4 text-morandi-gold group-hover:scale-110 transition-transform\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"\n              />\n            </svg>\n          </button>\n\n          {/* å¤–å¹£è¼¸å…¥ */}\n          <div className=\"flex-1\">\n            <label className=\"text-xs font-medium text-morandi-primary mb-1.5 block\">\n              {currencyInfo.name} ({selectedCurrency})\n            </label>\n            <div className=\"relative\">\n              <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-muted text-xs font-medium\">\n                {currencyInfo.symbol}\n              </span>\n              <input\n                type=\"number\"\n                value={foreignAmount}\n                onChange={(e) => handleForeignChange(e.target.value)}\n                className=\"w-full px-3 py-2 pl-[42px] border border-[#E6DDD4] rounded-xl font-mono text-sm bg-white hover:border-morandi-gold focus:border-morandi-gold focus:ring-2 focus:ring-morandi-gold/10 transition-all outline-none\"\n                placeholder=\"0.00\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* åŒ¯ç‡è¨­å®š */}\n        <div className=\"pt-4 border-t border-morandi-container/20\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <label className=\"text-sm font-medium text-morandi-primary\">\n              åŒ¯ç‡ (1 {selectedCurrency} = ? TWD)\n            </label>\n            <button\n              onClick={() => {\n                setUseCustomRate(false);\n                setCustomRate(DEFAULT_RATES[selectedCurrency].rate.toString());\n              }}\n              className=\"text-xs text-morandi-gold hover:text-morandi-gold/80 font-medium transition-colors\"\n            >\n              é‡è¨­é è¨­å€¼\n            </button>\n          </div>\n          <input\n            type=\"number\"\n            step=\"0.001\"\n            value={customRate}\n            onChange={(e) => {\n              setCustomRate(e.target.value);\n              setUseCustomRate(true);\n            }}\n            className=\"w-full px-4 py-2.5 border border-[#E6DDD4] rounded-xl font-mono text-sm bg-white hover:border-morandi-gold focus:border-morandi-gold focus:ring-2 focus:ring-morandi-gold/10 transition-all outline-none\"\n            placeholder=\"è¼¸å…¥åŒ¯ç‡\"\n          />\n          <p className=\"text-xs text-morandi-muted mt-2 flex items-center gap-1.5\">\n            {useCustomRate ? (\n              <>\n                <span className=\"w-1.5 h-1.5 rounded-full bg-morandi-gold\"></span>\n                å·²è‡ªè¨‚åŒ¯ç‡\n              </>\n            ) : (\n              <>\n                <span className=\"w-1.5 h-1.5 rounded-full bg-morandi-muted\"></span>\n                ä½¿ç”¨é è¨­åŒ¯ç‡: {DEFAULT_RATES[selectedCurrency].rate}\n              </>\n            )}\n          </p>\n        </div>\n      </div>\n    </Card>\n  );\n}\n\n// è¨ˆæ™‚å™¨çµ„ä»¶\nfunction TimerWidget() {\n  const [seconds, setSeconds] = useState(0);\n  const [isRunning, setIsRunning] = useState(false);\n\n  useEffect(() => {\n    let interval: any;\n    if (isRunning) {\n      interval = setInterval(() => {\n        setSeconds((s) => s + 1);\n      }, 1000);\n    }\n    return () => clearInterval(interval);\n  }, [isRunning]);\n\n  const formatTime = (s: number) => {\n    const hrs = Math.floor(s / 3600);\n    const mins = Math.floor((s % 3600) / 60);\n    const secs = s % 60;\n    return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <Card className=\"overflow-hidden flex flex-col h-full border border-[#E6DDD4] shadow-sm rounded-2xl hover:shadow-md hover:border-morandi-gold/50 transition-all duration-200\">\n      <div className=\"bg-morandi-container px-4 py-3 border-b border-[#E6DDD4] flex-shrink-0\">\n        <div className=\"flex items-center gap-2\">\n          <Clock className=\"h-4 w-4 text-morandi-gold\" />\n          <h3 className=\"font-semibold text-sm text-morandi-primary\">è¨ˆæ™‚å™¨</h3>\n        </div>\n      </div>\n      <div className=\"p-6 flex-1 flex flex-col justify-center min-h-0\">\n        <div className=\"bg-white rounded-2xl p-8 border border-[#E6DDD4] shadow-sm mb-6\">\n          <div className=\"text-center\">\n            <div className=\"text-5xl font-mono font-bold text-morandi-primary tracking-wider\">\n              {formatTime(seconds)}\n            </div>\n            <div className=\"text-xs text-morandi-muted mt-3 font-medium\">\n              {isRunning ? 'è¨ˆæ™‚ä¸­...' : 'å·²æš«åœ'}\n            </div>\n          </div>\n        </div>\n        <div className=\"flex gap-3 flex-shrink-0\">\n          <Button\n            size=\"lg\"\n            className={`flex-1 rounded-xl transition-all duration-200 ${\n              isRunning\n                ? 'bg-white border border-[#E6DDD4] text-morandi-primary hover:border-morandi-gold'\n                : 'bg-gradient-to-r from-[#B5986A] to-[#D4C4A8] text-white border-0 shadow-lg active:scale-95'\n            }`}\n            onClick={() => setIsRunning(!isRunning)}\n          >\n            {isRunning ? 'æš«åœ' : 'é–‹å§‹'}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"lg\"\n            onClick={() => {\n              setSeconds(0);\n              setIsRunning(false);\n            }}\n            className=\"bg-white border-[#E6DDD4] hover:bg-red-50 hover:text-red-600 hover:border-red-300 transition-all rounded-xl\"\n          >\n            é‡è¨­\n          </Button>\n        </div>\n      </div>\n    </Card>\n  );\n}\n\n// ä¾¿æ¢ç´™çµ„ä»¶ï¼ˆæ”¯æ´åˆ†é ï¼‰\nfunction NotesWidget() {\n  const STORAGE_KEY = 'homepage-notes-tabs';\n  const MAX_TABS = 5;\n\n  // è¼‰å…¥åˆ†é è³‡æ–™\n  const loadTabs = () => {\n    const saved = localStorage.getItem(STORAGE_KEY);\n    if (saved) {\n      return JSON.parse(saved);\n    }\n    return [{ id: '1', name: 'ç­†è¨˜', content: '' }];\n  };\n\n  const [tabs, setTabs] = useState<{ id: string; name: string; content: string }[]>(loadTabs);\n  const [activeTabId, setActiveTabId] = useState(tabs[0].id);\n  const [isEditingTab, setIsEditingTab] = useState<string | null>(null);\n  const [editingName, setEditingName] = useState('');\n\n  // å„²å­˜åˆ° localStorage\n  const saveTabs = (newTabs: typeof tabs) => {\n    setTabs(newTabs);\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(newTabs));\n  };\n\n  // æ›´æ–°å…§å®¹\n  const updateContent = (tabId: string, content: string) => {\n    const newTabs = tabs.map(tab =>\n      tab.id === tabId ? { ...tab, content } : tab\n    );\n    saveTabs(newTabs);\n  };\n\n  // æ–°å¢åˆ†é \n  const addTab = () => {\n    if (tabs.length >= MAX_TABS) return;\n    const newTab = {\n      id: Date.now().toString(),\n      name: `ç­†è¨˜ ${tabs.length + 1}`,\n      content: ''\n    };\n    const newTabs = [...tabs, newTab];\n    saveTabs(newTabs);\n    setActiveTabId(newTab.id);\n  };\n\n  // åˆªé™¤åˆ†é \n  const deleteTab = (tabId: string) => {\n    if (tabs.length === 1) return; // è‡³å°‘ä¿ç•™ä¸€å€‹\n    const newTabs = tabs.filter(tab => tab.id !== tabId);\n    saveTabs(newTabs);\n    if (activeTabId === tabId) {\n      setActiveTabId(newTabs[0].id);\n    }\n  };\n\n  // é‡æ–°å‘½ååˆ†é \n  const renameTab = (tabId: string, newName: string) => {\n    const newTabs = tabs.map(tab =>\n      tab.id === tabId ? { ...tab, name: newName.trim() || tab.name } : tab\n    );\n    saveTabs(newTabs);\n    setIsEditingTab(null);\n  };\n\n  const activeTab = tabs.find(tab => tab.id === activeTabId) || tabs[0];\n\n  return (\n    <Card className=\"overflow-hidden flex flex-col h-full border border-[#E6DDD4] shadow-sm rounded-2xl hover:shadow-md hover:border-morandi-gold/50 transition-all duration-200\">\n      <div className=\"bg-morandi-container px-4 py-3 border-b border-[#E6DDD4] flex-shrink-0\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Clipboard className=\"h-4 w-4 text-morandi-gold\" />\n            <h3 className=\"font-semibold text-sm text-morandi-primary\">ä¾¿æ¢ç´™</h3>\n          </div>\n\n          {/* åˆ†é æ¨™ç±¤ */}\n          <div className=\"flex items-center gap-1\">\n            {tabs.map((tab) => (\n              <div\n                key={tab.id}\n                className={`group relative flex items-center gap-1 px-2 py-1 rounded-lg text-xs font-medium transition-all cursor-pointer ${\n                  activeTabId === tab.id\n                    ? 'bg-[#B5986A]/10 text-morandi-gold scale-105'\n                    : 'text-morandi-muted hover:bg-morandi-gold/5 hover:text-morandi-primary'\n                }`}\n              >\n                {isEditingTab === tab.id ? (\n                  <input\n                    type=\"text\"\n                    value={editingName}\n                    onChange={(e) => setEditingName(e.target.value)}\n                    onBlur={() => renameTab(tab.id, editingName)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter') renameTab(tab.id, editingName);\n                      if (e.key === 'Escape') setIsEditingTab(null);\n                    }}\n                    className=\"w-16 px-1 bg-white border border-morandi-gold rounded outline-none\"\n                    autoFocus\n                  />\n                ) : (\n                  <span\n                    onClick={() => setActiveTabId(tab.id)}\n                    onDoubleClick={() => {\n                      setIsEditingTab(tab.id);\n                      setEditingName(tab.name);\n                    }}\n                    className=\"truncate max-w-[60px]\"\n                  >\n                    {tab.name}\n                  </span>\n                )}\n\n                {/* åˆªé™¤æŒ‰éˆ•ï¼ˆåªåœ¨å¤šæ–¼ä¸€å€‹åˆ†é æ™‚é¡¯ç¤ºï¼‰ */}\n                {tabs.length > 1 && (\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      deleteTab(tab.id);\n                    }}\n                    className=\"opacity-0 group-hover:opacity-100 ml-0.5 text-morandi-muted hover:text-red-500 transition-opacity\"\n                  >\n                    <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                )}\n              </div>\n            ))}\n\n            {/* æ–°å¢åˆ†é æŒ‰éˆ• */}\n            {tabs.length < MAX_TABS && (\n              <button\n                onClick={addTab}\n                className=\"p-1 rounded-lg text-morandi-muted hover:bg-morandi-gold/10 hover:text-morandi-gold transition-all\"\n                title=\"æ–°å¢åˆ†é \"\n              >\n                <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                </svg>\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-4 flex-1 flex flex-col min-h-0\">\n        <textarea\n          value={activeTab.content}\n          onChange={(e) => updateContent(activeTab.id, e.target.value)}\n          className=\"w-full h-full p-4 border border-[#E6DDD4] rounded-xl resize-none bg-white hover:border-morandi-gold focus:border-morandi-gold focus:ring-2 focus:ring-morandi-gold/10 transition-all outline-none font-mono text-sm leading-relaxed\"\n          placeholder=\"åœ¨é€™è£¡å¯«ä¸‹ä½ çš„ç­†è¨˜...\"\n        />\n        <p className=\"text-xs text-morandi-muted mt-2\">è‡ªå‹•å„²å­˜ â€¢ é›™æ“Šåˆ†é åç¨±å¯é‡æ–°å‘½å</p>\n      </div>\n    </Card>\n  );\n}\n\n// çµ±è¨ˆå ±è¡¨çµ„ä»¶\nfunction StatsWidget() {\n  const { items: tours } = useTourStore();\n  const { items: orders } = useOrderStore();\n\n  // è¼‰å…¥ä½¿ç”¨è€…è¨­å®š\n  const loadStatsConfig = () => {\n    const saved = localStorage.getItem('homepage-stats-config');\n    if (saved) {\n      return JSON.parse(saved);\n    }\n    return ['todos', 'paymentsThisWeek', 'paymentsNextWeek', 'depositsThisWeek', 'toursThisWeek', 'toursThisMonth'];\n  };\n\n  const [activeStats, setActiveStats] = useState<string[]>(loadStatsConfig);\n  const [isConfigOpen, setIsConfigOpen] = useState(false);\n\n  // å„²å­˜è¨­å®š\n  const toggleStat = (statId: string) => {\n    const newStats = activeStats.includes(statId)\n      ? activeStats.filter(id => id !== statId)\n      : [...activeStats, statId];\n    setActiveStats(newStats);\n    localStorage.setItem('homepage-stats-config', JSON.stringify(newStats));\n  };\n\n  // éæ¿¾æ‰ç‰¹æ®Šåœ˜\n  const normalTours = tours.filter(t => t.status !== 'special');\n\n  // è¨ˆç®—æœ¬é€±æ™‚é–“ç¯„åœ\n  const today = new Date();\n  const dayOfWeek = today.getDay();\n  const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;\n  const weekStart = new Date(today);\n  weekStart.setDate(today.getDate() + mondayOffset);\n  weekStart.setHours(0, 0, 0, 0);\n\n  const weekEnd = new Date(weekStart);\n  weekEnd.setDate(weekStart.getDate() + 6);\n  weekEnd.setHours(23, 59, 59, 999);\n\n  // ä¸‹é€±æ™‚é–“ç¯„åœ\n  const nextWeekStart = new Date(weekStart);\n  nextWeekStart.setDate(weekStart.getDate() + 7);\n  const nextWeekEnd = new Date(nextWeekStart);\n  nextWeekEnd.setDate(nextWeekStart.getDate() + 6);\n\n  // æœ¬æœˆæ™‚é–“ç¯„åœ\n  const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);\n  const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0, 23, 59, 59, 999);\n\n  // æœ¬é€±å‡ºåœ˜æ•¸é‡ï¼ˆæ’é™¤ç‰¹æ®Šåœ˜ï¼‰\n  const toursThisWeek = normalTours.filter(tour => {\n    const departureDate = new Date(tour.departure_date);\n    return departureDate >= weekStart && departureDate <= weekEnd;\n  }).length;\n\n  // æœ¬æœˆå‡ºåœ˜æ•¸é‡ï¼ˆæ’é™¤ç‰¹æ®Šåœ˜ï¼‰\n  const toursThisMonth = normalTours.filter(tour => {\n    const departureDate = new Date(tour.departure_date);\n    return departureDate >= monthStart && departureDate <= monthEnd;\n  }).length;\n\n  // æœ¬é€±è«‹æ¬¾é‡‘é¡ï¼ˆæœ¬é€±å‡ºç™¼çš„åœ˜ï¼Œæ’é™¤ç‰¹æ®Šåœ˜ï¼‰\n  const paymentsThisWeek = orders\n    .filter(order => {\n      const tour = normalTours.find(t => t.id === order.tour_id);\n      if (!tour) return false;\n      const departureDate = new Date(tour.departure_date);\n      return departureDate >= weekStart && departureDate <= weekEnd;\n    })\n    .reduce((sum, order) => sum + (order.total_amount || 0), 0);\n\n  // ä¸‹é€±è«‹æ¬¾é‡‘é¡ï¼ˆä¸‹é€±å‡ºç™¼çš„åœ˜ï¼Œæ’é™¤ç‰¹æ®Šåœ˜ï¼‰\n  const paymentsNextWeek = orders\n    .filter(order => {\n      const tour = normalTours.find(t => t.id === order.tour_id);\n      if (!tour) return false;\n      const departureDate = new Date(tour.departure_date);\n      return departureDate >= nextWeekStart && departureDate <= nextWeekEnd;\n    })\n    .reduce((sum, order) => sum + (order.total_amount || 0), 0);\n\n  // æœ¬é€±ç”²å­˜é‡‘é¡ï¼ˆæœ¬é€±å‡ºç™¼çš„åœ˜å·²ä»˜æ¬¾ï¼Œæ’é™¤ç‰¹æ®Šåœ˜ï¼‰\n  const depositsThisWeek = orders\n    .filter(order => {\n      const tour = normalTours.find(t => t.id === order.tour_id);\n      if (!tour) return false;\n      const departureDate = new Date(tour.departure_date);\n      return departureDate >= weekStart && departureDate <= weekEnd;\n    })\n    .reduce((sum, order) => sum + (order.paid_amount || 0), 0);\n\n  // å¾…è¾¦äº‹é …æ•¸é‡ï¼ˆç°¡åŒ–ç‰ˆï¼šæœªæ”¶é½Šæ¬¾ä¸”å³å°‡å‡ºç™¼çš„è¨‚å–®ï¼Œæ’é™¤ç‰¹æ®Šåœ˜ï¼‰\n  const todosCount = orders.filter(order => {\n    if (order.payment_status === 'paid') return false;\n    const tour = normalTours.find(t => t.id === order.tour_id);\n    if (!tour) return false;\n    const departureDate = new Date(tour.departure_date);\n    const daysUntilDeparture = Math.ceil((departureDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    return daysUntilDeparture <= 14 && daysUntilDeparture >= 0;\n  }).length;\n\n  const allStats = [\n    {\n      id: 'todos',\n      label: 'å¾…è¾¦äº‹é …',\n      value: todosCount,\n      icon: CheckSquare,\n      color: 'text-morandi-gold',\n      bgColor: 'bg-morandi-gold/10',\n    },\n    {\n      id: 'paymentsThisWeek',\n      label: 'æœ¬é€±è«‹æ¬¾',\n      value: `NT$ ${paymentsThisWeek.toLocaleString()}`,\n      icon: TrendingUp,\n      color: 'text-green-600',\n      bgColor: 'bg-green-50',\n    },\n    {\n      id: 'paymentsNextWeek',\n      label: 'ä¸‹é€±è«‹æ¬¾',\n      value: `NT$ ${paymentsNextWeek.toLocaleString()}`,\n      icon: TrendingUp,\n      color: 'text-blue-600',\n      bgColor: 'bg-blue-50',\n    },\n    {\n      id: 'depositsThisWeek',\n      label: 'æœ¬é€±ç”²å­˜',\n      value: `NT$ ${depositsThisWeek.toLocaleString()}`,\n      icon: Briefcase,\n      color: 'text-purple-600',\n      bgColor: 'bg-purple-50',\n    },\n    {\n      id: 'toursThisWeek',\n      label: 'æœ¬é€±å‡ºåœ˜',\n      value: `${toursThisWeek} åœ˜`,\n      icon: Calendar,\n      color: 'text-orange-600',\n      bgColor: 'bg-orange-50',\n    },\n    {\n      id: 'toursThisMonth',\n      label: 'æœ¬æœˆå‡ºåœ˜',\n      value: `${toursThisMonth} åœ˜`,\n      icon: Calendar,\n      color: 'text-pink-600',\n      bgColor: 'bg-pink-50',\n    },\n  ];\n\n  // åªé¡¯ç¤ºä½¿ç”¨è€…é¸æ“‡çš„çµ±è¨ˆ\n  const stats = allStats.filter(stat => activeStats.includes(stat.id));\n\n  return (\n    <Card className=\"overflow-hidden flex flex-col h-full border border-[#E6DDD4] shadow-sm rounded-2xl hover:shadow-md hover:border-morandi-gold/50 transition-all duration-200\">\n      <div className=\"bg-morandi-container px-4 py-3 border-b border-[#E6DDD4] flex-shrink-0\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-4 w-4 text-morandi-gold\" />\n            <h3 className=\"font-semibold text-sm text-morandi-primary\">çµ±è¨ˆè³‡è¨Š</h3>\n          </div>\n          <button\n            onClick={() => setIsConfigOpen(!isConfigOpen)}\n            className=\"p-1 rounded-lg text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-gold/10 transition-all\"\n            title=\"çµ±è¨ˆè¨­å®š\"\n          >\n            <Settings className=\"h-3.5 w-3.5\" />\n          </button>\n        </div>\n\n        {/* è¨­å®šé¢æ¿ */}\n        {isConfigOpen && (\n          <div className=\"mt-3 pt-3 border-t border-[#E6DDD4]/50\">\n            <div className=\"text-xs text-morandi-secondary mb-2\">é¸æ“‡è¦é¡¯ç¤ºçš„çµ±è¨ˆé …ç›®</div>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {allStats.map((stat) => (\n                <label\n                  key={stat.id}\n                  className=\"flex items-center gap-2 cursor-pointer text-xs p-2 rounded-lg hover:bg-white/50 transition-all\"\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={activeStats.includes(stat.id)}\n                    onChange={() => toggleStat(stat.id)}\n                    className=\"w-3 h-3 rounded border-morandi-gold/30 text-morandi-gold focus:ring-morandi-gold/20\"\n                  />\n                  <span className=\"text-morandi-primary\">{stat.label}</span>\n                </label>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n      <div className=\"p-4 flex-1 overflow-auto min-h-0\">\n        {stats.length === 0 ? (\n          <div className=\"h-full flex items-center justify-center\">\n            <div className=\"text-center text-morandi-muted text-sm\">\n              <Settings className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\n              <p>å°šæœªé¸æ“‡ä»»ä½•çµ±è¨ˆé …ç›®</p>\n              <p className=\"text-xs mt-1\">é»æ“Šå³ä¸Šè§’è¨­å®šåœ–ç¤ºé¸æ“‡</p>\n            </div>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\n            {stats.map((stat) => {\n              const Icon = stat.icon;\n              return (\n                <div\n                  key={stat.id}\n                  className=\"bg-white rounded-xl p-4 border border-[#E6DDD4] hover:border-morandi-gold/50 transition-all\"\n                >\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <div className={`p-2 rounded-lg ${stat.bgColor}`}>\n                      <Icon className={`h-4 w-4 ${stat.color}`} />\n                    </div>\n                  </div>\n                  <div className=\"text-xs text-morandi-secondary mb-1\">{stat.label}</div>\n                  <div className=\"text-lg font-bold text-morandi-primary\">{stat.value}</div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </Card>\n  );\n}\n\n// å°å·¥å…·é…ç½®\nconst AVAILABLE_WIDGETS: WidgetConfig[] = [\n  { id: 'stats', name: 'çµ±è¨ˆè³‡è¨Š', icon: BarChart3, component: StatsWidget, span: 2 },\n  { id: 'calculator', name: 'è¨ˆç®—æ©Ÿ', icon: Calculator, component: CalculatorWidget },\n  { id: 'currency', name: 'åŒ¯ç‡æ›ç®—', icon: DollarSign, component: CurrencyWidget },\n  { id: 'timer', name: 'è¨ˆæ™‚å™¨', icon: Clock, component: TimerWidget },\n  { id: 'notes', name: 'ä¾¿æ¢ç´™', icon: Clipboard, component: NotesWidget },\n];\n\nexport default function Home() {\n  const router = useRouter();\n  const { isAuthenticated } = useAuthStore();\n  const [isLoading, setIsLoading] = useState(true);\n  const [activeWidgets, setActiveWidgets] = useState<WidgetType[]>([\n    'calculator',\n    'currency',\n  ]);\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      router.replace('/login');\n    } else {\n      setIsLoading(false);\n      // å¾ localStorage è¼‰å…¥å°å·¥å…·è¨­å®š\n      const saved = localStorage.getItem('homepage-widgets');\n      if (saved) {\n        setActiveWidgets(JSON.parse(saved));\n      }\n    }\n  }, [isAuthenticated, router]);\n\n  const toggleWidget = (widgetId: WidgetType) => {\n    const newWidgets = activeWidgets.includes(widgetId)\n      ? activeWidgets.filter((id) => id !== widgetId)\n      : [...activeWidgets, widgetId];\n    setActiveWidgets(newWidgets);\n    localStorage.setItem('homepage-widgets', JSON.stringify(newWidgets));\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-morandi-gold mx-auto\"></div>\n          <p className=\"mt-4 text-morandi-muted\">è¼‰å…¥ä¸­...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"é¦–é \"\n        breadcrumb={[{ label: 'é¦–é ', href: '/' }]}\n        actions={\n          <Dialog>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" className=\"gap-2 bg-white border-[#E6DDD4] hover:border-morandi-gold transition-all rounded-xl\">\n                <Settings className=\"h-4 w-4\" />\n                å°å·¥å…·è¨­å®š\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-md border-[#E6DDD4] shadow-lg rounded-2xl\">\n              <DialogHeader>\n                <DialogTitle className=\"text-xl text-morandi-primary\">é¸æ“‡è¦é¡¯ç¤ºçš„å°å·¥å…·</DialogTitle>\n                <p className=\"text-sm text-morandi-muted mt-1\">å‹¾é¸ä½ æƒ³åœ¨é¦–é é¡¯ç¤ºçš„å°å·¥å…·</p>\n              </DialogHeader>\n              <div className=\"space-y-2 py-4\">\n                {AVAILABLE_WIDGETS.map((widget) => {\n                  const Icon = widget.icon;\n                  return (\n                    <div\n                      key={widget.id}\n                      className=\"flex items-center space-x-3 p-4 rounded-xl border border-[#E6DDD4] bg-white hover:border-morandi-gold cursor-pointer transition-all shadow-sm\"\n                      onClick={() => toggleWidget(widget.id)}\n                    >\n                      <Checkbox\n                        checked={activeWidgets.includes(widget.id)}\n                        onCheckedChange={() => toggleWidget(widget.id)}\n                      />\n                      <div className=\"flex items-center gap-3 flex-1\">\n                        <div className=\"w-10 h-10 rounded-xl bg-gradient-to-r from-[#B5986A]/10 to-[#D4C4A8]/10 flex items-center justify-center shadow-sm\">\n                          <Icon className=\"h-5 w-5 text-morandi-gold\" />\n                        </div>\n                        <span className=\"font-medium text-morandi-primary\">{widget.name}</span>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </DialogContent>\n          </Dialog>\n        }\n      />\n\n      <div className=\"flex-1 overflow-auto min-h-0\">\n        {activeWidgets.length === 0 ? (\n          <Card className=\"p-12 text-center border-[#E6DDD4] shadow-sm rounded-2xl bg-white\">\n            <div className=\"max-w-md mx-auto\">\n              <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-r from-[#B5986A]/10 to-[#D4C4A8]/10 flex items-center justify-center mx-auto mb-4 shadow-sm\">\n                <Settings className=\"h-8 w-8 text-morandi-gold\" />\n              </div>\n              <h3 className=\"text-lg font-semibold text-morandi-primary mb-2\">å°šæœªé¸æ“‡ä»»ä½•å°å·¥å…·</h3>\n              <p className=\"text-sm text-morandi-muted mb-6\">\n                é»æ“Šå³ä¸Šè§’ã€Œå°å·¥å…·è¨­å®šã€ä¾†æ–°å¢ä½ éœ€è¦çš„å·¥å…·\n              </p>\n            </div>\n          </Card>\n        ) : (\n          <div className=\"h-full grid md:grid-cols-2 xl:grid-cols-3 md:grid-rows-3 xl:grid-rows-2 gap-6 auto-rows-fr\">\n            {AVAILABLE_WIDGETS.filter((w) => activeWidgets.includes(w.id)).map(\n              (widget) => {\n                const Component = widget.component;\n                return (\n                  <div key={widget.id} className={`h-full ${widget.span === 2 ? 'md:col-span-2' : ''}`}>\n                    <Component />\n                  </div>\n                );\n              }\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/quotes/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ResponsiveHeader' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Copy' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Combobox' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'QuoteItem' is defined but never used. Allowed unused vars must match /^_/u.","line":68,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedCountry' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":141,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":141,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5621,5624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5621,5624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showVersionHistory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":195,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":195,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowVersionHistory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":195,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":195,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6737,6740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6737,6740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getCitiesByCountryCode'. Either include it or remove the dependency array.","line":236,"column":6,"nodeType":"ArrayExpression","endLine":236,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCountry, relatedTour, getCitiesByCountryCode]","fix":{"range":[7515,7545],"text":"[selectedCountry, relatedTour, getCitiesByCountryCode]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleAddAccommodationRoomType'. Either include it or remove the dependency array.","line":333,"column":6,"nodeType":"ArrayExpression","endLine":333,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleAddAccommodationRoomType]","fix":{"range":[10794,10796],"text":"[handleAddAccommodationRoomType]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":493,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":493,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14441,14444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14441,14444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":603,"column":21,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":603,"endColumn":30},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":644,"column":37,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":644,"endColumn":39},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":644,"column":42,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":644,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'transportGroupSummary' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":678,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":678,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'guideCostPerPerson' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":696,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":696,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleOptionSelect' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":702,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":702,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":702,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":702,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22375,22378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22375,22378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'regionOptions' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":723,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":723,"endColumn":22},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":735,"column":19,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":735,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":898,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":898,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29153,29156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29153,29156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":906,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":906,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29475,29478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29475,29478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":907,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":907,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29502,29505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29502,29505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":918,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":918,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29886,29889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29886,29889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":952,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":952,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30778,30781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30778,30781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":959,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":959,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31029,31032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31029,31032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1000,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1000,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32262,32265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32262,32265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1048,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1048,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34049,34052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34049,34052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":1476,"column":43,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":1476,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":1561,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":1561,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":33,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger\n} from '@/components/ui/dropdown-menu';\nimport {\n  Plus,\n  Car,\n  Home,\n  UtensilsCrossed,\n  MapPin,\n  MoreHorizontal,\n  Users,\n  Trash2,\n  Edit,\n  ArrowLeft,\n  Save,\n  History,\n  Plane,\n  Copy,\n  CheckCircle\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useQuotes } from '@/features/quotes/hooks/useQuotes';\nimport { useTourStore, useRegionStore } from '@/stores';\nimport { generateTourCode } from '@/lib/utils';\nimport { Combobox } from '@/components/ui/combobox';\nimport { getRegionOptions, type RegionName } from '@/data/region-options';\nimport { logger } from '@/lib/utils/logger';\n\ninterface CostItem {\n  id: string;\n  name: string;\n  quantity: number;\n  unit_price: number;\n  total: number;\n  note?: string;\n  // ä½å®¿å°ˆç”¨ï¼šå¤©æ•¸å’Œæˆ¿å‹æ•¸æ“š\n  day?: number; // ç¬¬å¹¾å¤©\n  room_type?: string; // æˆ¿å‹åç¨±ï¼ˆå¦‚ï¼šé›™äººæˆ¿ã€ä¸‰äººæˆ¿ï¼‰\n  // äº¤é€šå’Œé ˜éšŠå°éŠå°ˆç”¨ï¼šåœ˜é«”åˆ†æ”¤\n  is_group_cost?: boolean; // æ˜¯å¦ç‚ºåœ˜é«”è²»ç”¨\n  // å¤šèº«ä»½è¨ˆåƒ¹ï¼šæ©Ÿç¥¨å°ˆç”¨\n  pricing_type?: 'uniform' | 'by_identity'; // uniform: çµ±ä¸€åƒ¹æ ¼, by_identity: ä¾èº«ä»½è¨ˆåƒ¹\n  adult_price?: number; // æˆäººåƒ¹\n  child_price?: number; // å°æœ‹å‹åƒ¹\n  infant_price?: number; // å¬°å…’åƒ¹\n}\n\n// CostCategory èˆ‡ QuoteCategory çµæ§‹ç›¸åŒï¼ŒCostItem èˆ‡ QuoteItem ä¹Ÿç›¸åŒ\ninterface CostCategory {\n  id: string;\n  name: string;\n  items: CostItem[];\n  total: number;\n}\n\n// Import QuoteItem from store types for type casting\nimport { QuoteItem } from '@/stores/types';\n\nconst costCategories: CostCategory[] = [\n  { id: 'transport', name: 'äº¤é€š', items: [], total: 0 },\n  { id: 'group-transport', name: 'åœ˜é«”åˆ†æ”¤', items: [], total: 0 },\n  { id: 'accommodation', name: 'ä½å®¿', items: [], total: 0 },\n  { id: 'meals', name: 'é¤é£²', items: [], total: 0 },\n  { id: 'activities', name: 'æ´»å‹•', items: [], total: 0 },\n  { id: 'others', name: 'å…¶ä»–', items: [], total: 0 },\n  { id: 'guide', name: 'é ˜éšŠå°éŠ', items: [], total: 0 }\n];\n\n// åœ–æ¨™æ˜ å°„\nconst categoryIcons: Record<string, React.ElementType> = {\n  transport: Car,\n  'group-transport': Users,\n  accommodation: Home,\n  meals: UtensilsCrossed,\n  activities: MapPin,\n  others: MoreHorizontal,\n  guide: Users\n};\n\nexport default function QuoteDetailPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { quotes, updateQuote } = useQuotes();\n  const { items: tours, create: addTour } = useTourStore();\n  const regionStore = useRegionStore();\n  const { items: regions } = regionStore;\n\n  const quote_id = params.id as string;\n  const quote = quotes.find(q => q.id === quote_id);\n\n  // æª¢æŸ¥æ˜¯å¦ç‚ºç‰¹æ®Šåœ˜å ±åƒ¹å–®\n  const relatedTour = quote?.tour_id ? tours.find(t => t.id === quote.tour_id) : null;\n  const isSpecialTour = relatedTour?.status === 'special';\n  const isReadOnly = isSpecialTour; // ç‰¹æ®Šåœ˜å ±åƒ¹å–®è¨­ç‚ºå”¯è®€\n\n  // æ‡¶è¼‰å…¥ regionsï¼ˆåªåœ¨å ±åƒ¹å–®é é¢æ‰è¼‰å…¥ï¼‰\n  React.useEffect(() => {\n    if (regions.length === 0) {\n      regionStore.fetchAll();\n    }\n  }, [regions.length, regionStore]);\n\n  // å¾ regions å–å¾—å•Ÿç”¨çš„åœ‹å®¶æ¸…å–®\n  const activeCountries = React.useMemo(() => {\n    return regions\n      .filter(r => r.type === 'country' && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [regions]);\n\n  // æ ¹æ“šåœ‹å®¶ä»£ç¢¼å–å¾—åŸå¸‚æ¸…å–®\n  const getCitiesByCountryCode = React.useCallback((countryCode: string) => {\n    return regions\n      .filter(r => r.type === 'city' && r.country_code === countryCode && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [regions]);\n\n  // å¾æ—…éŠåœ˜çš„ location åæŸ¥åœ‹å®¶å’ŒåŸå¸‚ä»£ç¢¼\n  const getCountryAndCityFromLocation = (location: string) => {\n    for (const country of activeCountries) {\n      const cities = getCitiesByCountryCode(country.code);\n      const matchedCity = cities.find(city => city.name === location);\n      if (matchedCity) {\n        return { countryCode: country.code, cityCode: matchedCity.code };\n      }\n    }\n    return { countryCode: '', cityCode: '' };\n  };\n\n  // åœ‹å®¶å’ŒåŸå¸‚é¸æ“‡ state\n  const [selectedCountry, setSelectedCountry] = useState<string>(() => {\n    if (relatedTour) {\n      return getCountryAndCityFromLocation(relatedTour.location).countryCode;\n    }\n    return activeCountries[0]?.code || '';\n  });\n\n  const [selectedCity, setSelectedCity] = useState<string>(() => {\n    if (relatedTour) {\n      return getCountryAndCityFromLocation(relatedTour.location).cityCode;\n    }\n    const defaultCities = selectedCountry ? getCitiesByCountryCode(selectedCountry) : [];\n    return defaultCities[0]?.code || '';\n  });\n\n  const [availableCities, setAvailableCities] = useState(() => {\n    return selectedCountry ? getCitiesByCountryCode(selectedCountry) : [];\n  });\n\n  const [categories, setCategories] = useState<CostCategory[]>(() => {\n    const initialCategories = quote?.categories || costCategories;\n    // ç¢ºä¿æ¯å€‹åˆ†é¡çš„ç¸½è¨ˆéƒ½æ­£ç¢ºè¨ˆç®—\n    return initialCategories.map(cat => ({\n      ...cat,\n      total: cat.items.reduce((sum, item) => sum + (item.total || 0), 0)\n    }));\n  });\n  const [accommodationDays, setAccommodationDays] = useState<number>(quote?.accommodation_days || 0);\n\n  // å¤šèº«ä»½äººæ•¸çµ±è¨ˆ\n  const [participantCounts, setParticipantCounts] = useState<{\n    adult: number;          // æˆäººï¼ˆé›™äººæˆ¿ï¼‰\n    child_with_bed: number; // å°æœ‹å‹ï¼ˆä½”åºŠï¼‰\n    child_no_bed: number;   // ä¸ä½”åºŠ\n    single_room: number;    // å–®äººæˆ¿\n    infant: number;         // å¬°å…’\n  }>((quote as any)?.participant_counts || {\n    adult: 1,\n    child_with_bed: 0,\n    child_no_bed: 0,\n    single_room: 0,\n    infant: 0\n  });\n\n  // ç¸½äººæ•¸ï¼ˆå‘ä¸‹ç›¸å®¹ï¼‰\n  const groupSize = participantCounts.adult + participantCounts.child_with_bed +\n                    participantCounts.child_no_bed + participantCounts.single_room +\n                    participantCounts.infant;\n\n  // å°éŠè²»ç”¨åˆ†æ”¤äººæ•¸ï¼ˆä¸å«å¬°å…’ï¼‰\n  const groupSizeForGuide = participantCounts.adult + participantCounts.child_with_bed +\n                            participantCounts.child_no_bed + participantCounts.single_room;\n\n  const [quoteName, setQuoteName] = useState<string>(quote?.name || '');\n  const [showVersionHistory, setShowVersionHistory] = useState<boolean>(false);\n  const [saveSuccess, setSaveSuccess] = useState<boolean>(false);\n  const [isSaveDialogOpen, setIsSaveDialogOpen] = useState<boolean>(false);\n  const [versionName, setVersionName] = useState<string>('');\n\n  // å¤šèº«ä»½å”®åƒ¹\n  const [sellingPrices, setSellingPrices] = useState<{\n    adult: number;\n    child_with_bed: number;\n    child_no_bed: number;\n    single_room: number;\n    infant: number;\n  }>((quote as any)?.selling_prices || {\n    adult: 0,\n    child_with_bed: 0,\n    child_no_bed: 0,\n    single_room: 0,\n    infant: 0\n  });\n  // èˆŠçš„ selectedRegion ä¿ç•™ç”¨æ–¼ getRegionOptions\n  const [selectedRegion, setSelectedRegion] = useState<RegionName>(\n    relatedTour?.location as RegionName || 'æ¸…é‚'\n  );\n\n  // å¦‚æœæ‰¾ä¸åˆ°å ±åƒ¹å–®ï¼Œè¿”å›åˆ—è¡¨é ï¼ˆåªæœ‰åœ¨è³‡æ–™å·²è¼‰å…¥æ™‚æ‰åˆ¤æ–·ï¼‰\n  useEffect(() => {\n    // åªæœ‰ç•¶ quotes é™£åˆ—æœ‰è³‡æ–™ï¼ˆè¡¨ç¤ºå·²è¼‰å…¥ï¼‰ä¸”æ‰¾ä¸åˆ°å°æ‡‰çš„ quote æ™‚ï¼Œæ‰è·³è½‰\n    if (quotes.length > 0 && !quote) {\n      router.push('/quotes');\n    }\n  }, [quote, quotes.length, router]);\n\n  // ç•¶åœ‹å®¶æ”¹è®Šæ™‚ï¼Œæ›´æ–°åŸå¸‚æ¸…å–®\n  useEffect(() => {\n    if (selectedCountry && !relatedTour) {\n      const cities = getCitiesByCountryCode(selectedCountry);\n      setAvailableCities(cities);\n      if (cities.length > 0) {\n        setSelectedCity(cities[0].code);\n      }\n    }\n  }, [selectedCountry, relatedTour]);\n\n  // ç•¶äººæ•¸æ”¹è®Šæ™‚ï¼Œé‡æ–°è¨ˆç®—æ‰€æœ‰åœ˜é«”åˆ†æ”¤é …ç›®\n  useEffect(() => {\n    setCategories(prevCategories => {\n      return prevCategories.map(category => {\n        if (category.id === 'group-transport' || category.id === 'transport' || category.id === 'guide') {\n          const updatedItems = category.items.map(item => {\n            const effectiveQuantity = (item.quantity && item.quantity !== 1) ? item.quantity : 1;\n            let total = 0;\n\n            if (category.id === 'group-transport') {\n              // åœ˜é«”åˆ†æ”¤åˆ†é¡ï¼šè‡ªå‹•åŸ·è¡Œåœ˜é«”åˆ†æ”¤é‚è¼¯\n              if (item.name === 'é ˜éšŠåˆ†æ”¤') {\n                // é ˜éšŠåˆ†æ”¤ï¼š(å–®åƒ¹ Ã— æ•¸é‡) Ã· äººæ•¸ï¼ˆä¸å«å¬°å…’ï¼‰\n                const guideTotalCost = (item.unit_price || 0) * effectiveQuantity;\n                total = groupSizeForGuide > 0 ? Math.ceil(guideTotalCost / groupSizeForGuide) : 0;\n              } else if (groupSizeForGuide > 1) {\n                // å…¶ä»–åœ˜é«”åˆ†æ”¤é …ç›®ï¼šåŸ·è¡Œä¸€èˆ¬åœ˜é«”åˆ†æ”¤é‚è¼¯ï¼ˆä¸å«å¬°å…’ï¼‰\n                const total_cost = effectiveQuantity * (item.unit_price || 0);\n                total = Math.ceil(total_cost / groupSizeForGuide);\n              } else {\n                // äººæ•¸ç‚º1æ™‚ï¼Œä¸åˆ†æ”¤\n                total = Math.ceil(effectiveQuantity * (item.unit_price || 0));\n              }\n            } else if ((category.id === 'transport' || category.id === 'guide') && item.is_group_cost && groupSize > 1) {\n              // äº¤é€šå’Œé ˜éšŠå°éŠçš„åœ˜é«”åˆ†æ”¤é‚è¼¯ï¼šå°è¨ˆ = (æ•¸é‡ Ã— å–®åƒ¹) Ã· åœ˜é«”äººæ•¸\n              const total_cost = effectiveQuantity * (item.unit_price || 0);\n              total = Math.ceil(total_cost / groupSize);\n            } else {\n              // ç¶­æŒåŸæœ‰çš„ total å€¼\n              total = item.total || 0;\n            }\n\n            return { ...item, total };\n          });\n\n          const categoryTotal = updatedItems.reduce((sum, item) => sum + (item.total || 0), 0);\n          return { ...category, items: updatedItems, total: categoryTotal };\n        }\n        return category;\n      });\n    });\n  }, [participantCounts, groupSize, groupSizeForGuide]); // ç›£è½äººæ•¸è®ŠåŒ–\n\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const scrollTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      if (scrollRef.current) {\n        scrollRef.current.classList.add('scrolling');\n\n        if (scrollTimeoutRef.current) {\n          clearTimeout(scrollTimeoutRef.current);\n        }\n\n        scrollTimeoutRef.current = setTimeout(() => {\n          if (scrollRef.current) {\n            scrollRef.current.classList.remove('scrolling');\n          }\n        }, 1000);\n      }\n    };\n\n    const element = scrollRef.current;\n    if (element) {\n      element.addEventListener('scroll', handleScroll);\n      return () => element.removeEventListener('scroll', handleScroll);\n    }\n  }, []);\n\n  const handleAddRow = useCallback((category_id: string) => {\n    if (category_id === 'accommodation') {\n      // ä½å®¿ç”¨å°ˆç”¨å‡½æ•¸\n      handleAddAccommodationRoomType();\n      return;\n    }\n\n    const newItem: CostItem = {\n      id: Date.now().toString(),\n      name: '',\n      quantity: 0,\n      unit_price: 0,\n      total: 0,\n      note: ''\n    };\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === category_id) {\n        return {\n          ...cat,\n          items: [...cat.items, newItem]\n        };\n      }\n      return cat;\n    }));\n  }, []);\n\n  // æ–°å¢å°éŠé …ç›®\n  const handleAddGuideRow = (category_id: string) => {\n    const totalGuideCost = calculateGuideWithCategories(categories);\n\n    const newItem: CostItem = {\n      id: Date.now().toString(),\n      name: 'é ˜éšŠåˆ†æ”¤',\n      quantity: 1,\n      unit_price: totalGuideCost,\n      total: groupSizeForGuide > 0 ? Math.ceil(totalGuideCost / groupSizeForGuide) : 0,\n      note: 'è‡ªå‹•è¨ˆç®—ï¼šä½å®¿ç¬¬ä¸€æˆ¿å‹ + æˆäººæ©Ÿç¥¨'\n    };\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === category_id) {\n        return {\n          ...cat,\n          items: [...cat.items, newItem]\n        };\n      }\n      return cat;\n    }));\n  };\n\n  // æ–°å¢æˆäººæ©Ÿç¥¨\n  const handleAddAdultTicket = (category_id: string) => {\n    const newItem: CostItem = {\n      id: Date.now().toString(),\n      name: 'æˆäººæ©Ÿç¥¨',\n      quantity: 0,\n      unit_price: 0,\n      total: 0,\n      note: '',\n      pricing_type: 'by_identity',\n      adult_price: 0\n    };\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === category_id) {\n        return {\n          ...cat,\n          items: [...cat.items, newItem]\n        };\n      }\n      return cat;\n    }));\n  };\n\n  // æ–°å¢å°å­©æ©Ÿç¥¨\n  const handleAddChildTicket = (category_id: string) => {\n    const newItem: CostItem = {\n      id: Date.now().toString(),\n      name: 'å°å­©æ©Ÿç¥¨',\n      quantity: 0,\n      unit_price: 0,\n      total: 0,\n      note: '',\n      pricing_type: 'by_identity',\n      child_price: 0\n    };\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === category_id) {\n        return {\n          ...cat,\n          items: [...cat.items, newItem]\n        };\n      }\n      return cat;\n    }));\n  };\n\n  // æ–°å¢å¬°å…’æ©Ÿç¥¨\n  const handleAddInfantTicket = (category_id: string) => {\n    const newItem: CostItem = {\n      id: Date.now().toString(),\n      name: 'å¬°å…’æ©Ÿç¥¨',\n      quantity: 0,\n      unit_price: 0,\n      total: 0,\n      note: '',\n      pricing_type: 'by_identity',\n      infant_price: 0\n    };\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === category_id) {\n        return {\n          ...cat,\n          items: [...cat.items, newItem]\n        };\n      }\n      return cat;\n    }));\n  };\n\n  // ä½å®¿ï¼šæ–°å¢å¤©æ•¸\n  const handleAddAccommodationDay = useCallback(() => {\n    const newDayCount = accommodationDays + 1;\n    setAccommodationDays(newDayCount);\n\n    // æ–°å¢ä¸€å¤©ï¼Œé è¨­åŠ ä¸€å€‹ç©ºæˆ¿å‹\n    const timestamp = Date.now();\n    const newItem: CostItem = {\n      id: `accommodation-day${newDayCount}-${timestamp}`,\n      name: '',\n      quantity: 0,\n      unit_price: 0,\n      total: 0,\n      note: '',\n      day: newDayCount,\n      room_type: ''\n    };\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === 'accommodation') {\n        return {\n          ...cat,\n          items: [...cat.items, newItem]\n        };\n      }\n      return cat;\n    }));\n  }, [accommodationDays]);\n\n  // ä½å®¿ï¼šæ–°å¢æˆ¿å‹ï¼ˆåœ¨æ‰€æœ‰ç¾æœ‰å¤©æ•¸éƒ½æ–°å¢åŒæ¨£çš„æˆ¿å‹ï¼‰\n  const handleAddAccommodationRoomType = useCallback(() => {\n    if (accommodationDays === 0) return; // å¿…é ˆå…ˆæœ‰å¤©æ•¸\n\n    const timestamp = Date.now();\n    const newItems: CostItem[] = [];\n\n    // ç‚ºæ¯ä¸€å¤©éƒ½æ–°å¢åŒæ¨£çš„æˆ¿å‹\n    for (let day = 1; day <= accommodationDays; day++) {\n      newItems.push({\n        id: `accommodation-day${day}-${timestamp}`,\n        name: '',\n        quantity: 0,\n        unit_price: 0,\n        total: 0,\n        note: '',\n        day: day,\n        room_type: ''\n      });\n    }\n\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === 'accommodation') {\n        return {\n          ...cat,\n          items: [...cat.items, ...newItems]\n        };\n      }\n      return cat;\n    }));\n  }, [accommodationDays]);\n\n\n  const handleUpdateItem = (category_id: string, itemId: string, field: keyof CostItem, value: any) => {\n    setCategories(prev => {\n      const newCategories = prev.map(cat => {\n        if (cat.id === category_id) {\n          const updatedItems = cat.items.map(item => {\n            if (item.id === itemId) {\n              const updatedItem = { ...item, [field]: value };\n              // è‡ªå‹•è¨ˆç®—ç¸½åƒ¹\n              if (field === 'quantity' || field === 'unit_price' || field === 'is_group_cost' || field === 'adult_price' || field === 'child_price' || field === 'infant_price') {\n                // æ•¸é‡é è¨­ç‚º 1ï¼Œåªæœ‰ç•¶ç”¨æˆ¶è¼¸å…¥æ™‚æ‰ä½¿ç”¨è¼¸å…¥å€¼\n                const effectiveQuantity = updatedItem.quantity === 0 ? 1 : (updatedItem.quantity || 1);\n\n                // æˆäººã€å°å­©ã€å¬°å…’æ©Ÿç¥¨ï¼šé¡¯ç¤ºå°æ‡‰ç¥¨åƒ¹åœ¨å°è¨ˆæ¬„ä½\n                if (updatedItem.name === 'æˆäººæ©Ÿç¥¨') {\n                  updatedItem.total = updatedItem.adult_price || 0;\n                } else if (updatedItem.name === 'å°å­©æ©Ÿç¥¨') {\n                  updatedItem.total = updatedItem.child_price || 0;\n                } else if (updatedItem.name === 'å¬°å…’æ©Ÿç¥¨') {\n                  updatedItem.total = updatedItem.infant_price || 0;\n                }\n                else if (category_id === 'accommodation') {\n                  // ä½å®¿ç‰¹æ®Šé‚è¼¯ï¼šå°è¨ˆ = å–®åƒ¹ Ã· äººæ•¸\n                  updatedItem.total = effectiveQuantity > 0 ? Math.ceil((updatedItem.unit_price || 0) / effectiveQuantity) : 0;\n                } else if ((category_id === 'transport' || category_id === 'guide') && updatedItem.is_group_cost && groupSize > 1) {\n                  // äº¤é€šå’Œé ˜éšŠå°éŠçš„åœ˜é«”åˆ†æ”¤é‚è¼¯ï¼šå°è¨ˆ = (æ•¸é‡ Ã— å–®åƒ¹) Ã· åœ˜é«”äººæ•¸\n                  const total_cost = effectiveQuantity * (updatedItem.unit_price || 0);\n                  updatedItem.total = Math.ceil(total_cost / groupSize);\n                } else if (category_id === 'group-transport') {\n                  // åœ˜é«”åˆ†æ”¤åˆ†é¡ï¼šè‡ªå‹•åŸ·è¡Œåœ˜é«”åˆ†æ”¤é‚è¼¯\n                  if (updatedItem.name === 'é ˜éšŠåˆ†æ”¤') {\n                    // é ˜éšŠåˆ†æ”¤ï¼š(å–®åƒ¹ Ã— æ•¸é‡) Ã· äººæ•¸ï¼ˆä¸å«å¬°å…’ï¼‰\n                    const guideTotalCost = (updatedItem.unit_price || 0) * effectiveQuantity;\n                    updatedItem.total = groupSizeForGuide > 0 ? Math.ceil(guideTotalCost / groupSizeForGuide) : 0;\n                  } else if (groupSizeForGuide > 1) {\n                    // å…¶ä»–åœ˜é«”åˆ†æ”¤é …ç›®ï¼šåŸ·è¡Œä¸€èˆ¬åœ˜é«”åˆ†æ”¤é‚è¼¯ï¼ˆä¸å«å¬°å…’ï¼‰\n                    const total_cost = effectiveQuantity * (updatedItem.unit_price || 0);\n                    updatedItem.total = Math.ceil(total_cost / groupSizeForGuide);\n                  } else {\n                    // äººæ•¸ç‚º1æ™‚ï¼Œä¸åˆ†æ”¤\n                    updatedItem.total = Math.ceil(effectiveQuantity * (updatedItem.unit_price || 0));\n                  }\n                } else {\n                  // ä¸€èˆ¬é‚è¼¯ï¼šå°è¨ˆ = æ•¸é‡ Ã— å–®åƒ¹\n                  updatedItem.total = Math.ceil(effectiveQuantity * (updatedItem.unit_price || 0));\n                }\n              }\n              return updatedItem;\n            }\n            return item;\n          });\n\n          return {\n            ...cat,\n            items: updatedItems,\n            total: updatedItems.reduce((sum, item) => sum + item.total, 0)\n          };\n        }\n        return cat;\n      });\n\n      // å¦‚æœæœ‰ä½å®¿æˆ–äº¤é€šæ•¸æ“šè®Šæ›´ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰é ˜éšŠåˆ†æ”¤é …ç›®\n      if (category_id === 'accommodation' || category_id === 'transport') {\n        return updateGuideItems(newCategories);\n      }\n\n      return newCategories;\n    });\n  };\n\n  // æ›´æ–°æ‰€æœ‰é ˜éšŠåˆ†æ”¤é …ç›®\n  const updateGuideItems = (categories: CostCategory[]) => {\n    // é‡æ–°è¨ˆç®—é ˜éšŠè²»ç”¨\n    const totalGuideCost = calculateGuideWithCategories(categories);\n\n    return categories.map(cat => {\n      if (cat.id === 'group-transport') {\n        const updatedItems = cat.items.map(item => {\n          if (item.name === 'é ˜éšŠåˆ†æ”¤') {\n            const effectiveQuantity = (item.quantity && item.quantity !== 1) ? item.quantity : 1;\n            return {\n              ...item,\n              unit_price: totalGuideCost,\n              total: groupSizeForGuide > 0 ? Math.ceil(totalGuideCost * effectiveQuantity / groupSizeForGuide) : 0\n            };\n          }\n          return item;\n        });\n\n        return {\n          ...cat,\n          items: updatedItems,\n          total: updatedItems.reduce((sum, item) => sum + item.total, 0)\n        };\n      }\n      return cat;\n    });\n  };\n\n  // ä½¿ç”¨ç‰¹å®šçš„ categories ä¾†è¨ˆç®—é ˜éšŠè²»ç”¨\n  const calculateGuideWithCategories = (categories: CostCategory[]) => {\n    // 1. è¨ˆç®—ä½å®¿æ¯æ—¥ç¬¬ä¸€å€‹æˆ¿å‹çš„å–®åƒ¹ç¸½å’Œ\n    const accommodationCategory = categories.find(cat => cat.id === 'accommodation');\n    let dailyFirstRoomCost = 0;\n\n    if (accommodationCategory && accommodationCategory.items.length > 0) {\n      const accommodationItems = accommodationCategory.items.filter(item => item.day !== undefined);\n      const groupedByDay: Record<number, CostItem[]> = {};\n\n      // æŒ‰å¤©åˆ†çµ„\n      accommodationItems.forEach(item => {\n        const day = item.day!;\n        if (!groupedByDay[day]) groupedByDay[day] = [];\n        groupedByDay[day].push(item);\n      });\n\n      // è¨ˆç®—æ¯å¤©ç¬¬ä¸€å€‹æˆ¿å‹çš„å–®åƒ¹\n      Object.keys(groupedByDay).forEach(dayStr => {\n        const dayItems = groupedByDay[Number(dayStr)];\n        if (dayItems.length > 0) {\n          dailyFirstRoomCost += dayItems[0].unit_price || 0;\n        }\n      });\n    }\n\n    // 2. è¨ˆç®—æˆäººæ©Ÿç¥¨è²»ç”¨\n    const transportCategory = categories.find(cat => cat.id === 'transport');\n    let adultTicketCost = 0;\n\n    if (transportCategory && transportCategory.items.length > 0) {\n      const adultTicket = transportCategory.items.find(item => item.name === 'æˆäººæ©Ÿç¥¨');\n      if (adultTicket) {\n        adultTicketCost = adultTicket.adult_price || 0;\n      }\n    }\n\n    // 3. é ˜éšŠç¸½æˆæœ¬ = ä½å®¿ç¬¬ä¸€æˆ¿å‹ç¸½å’Œ + æˆäººæ©Ÿç¥¨è²»ç”¨ï¼ˆä¸é™¤æ³•ï¼‰\n    const totalGuideCost = dailyFirstRoomCost + adultTicketCost;\n\n    return totalGuideCost;\n  };\n\n\n  const handleRemoveItem = useCallback((category_id: string, itemId: string) => {\n    setCategories(prev => prev.map(cat => {\n      if (cat.id === category_id) {\n        const updatedItems = cat.items.filter(item => item.id !== itemId);\n\n        // å¦‚æœæ˜¯ä½å®¿é¡åˆ¥ï¼Œéœ€è¦é‡æ–°è¨ˆç®—å¤©æ•¸ä¸¦é‡æ–°ç·¨è™Ÿ\n        if (category_id === 'accommodation' && updatedItems.length > 0) {\n          // å–å¾—æ‰€æœ‰å”¯ä¸€çš„å¤©æ•¸\n          const uniqueDays = Array.from(new Set(updatedItems.map(item => item.day).filter(d => d !== undefined)));\n          uniqueDays.sort((a, b) => a! - b!);\n\n          // é‡æ–°ç·¨è™Ÿå¤©æ•¸ï¼ˆå¾ 1 é–‹å§‹ï¼‰\n          const reorderedItems = updatedItems.map(item => {\n            const oldDay = item.day;\n            const newDay = uniqueDays.findIndex(d => d === oldDay) + 1;\n            return {\n              ...item,\n              day: newDay\n            };\n          });\n\n          // æ›´æ–° accommodationDays ç‚ºå¯¦éš›å¤©æ•¸\n          const actualDays = Math.max(...reorderedItems.map(item => item.day || 0));\n          setAccommodationDays(actualDays);\n\n          return {\n            ...cat,\n            items: reorderedItems,\n            total: reorderedItems.reduce((sum, item) => sum + item.total, 0)\n          };\n        }\n\n        return {\n          ...cat,\n          items: updatedItems,\n          total: updatedItems.reduce((sum, item) => sum + item.total, 0)\n        };\n      }\n      return cat;\n    }));\n  }, []);\n\n  // è¨ˆç®—äº¤é€šåœ˜é«”åˆ†æ”¤ä¿¡æ¯\n  const transportGroupSummary = useMemo(() => {\n    const transportCategory = categories.find(cat => cat.id === 'transport');\n    if (!transportCategory || transportCategory.items.length === 0) return null;\n\n    const groupCostItems = transportCategory.items.filter(item => item.is_group_cost);\n    if (groupCostItems.length === 0) return null;\n\n    const totalGroupCost = groupCostItems.reduce((sum, item) => sum + (item.quantity * item.unit_price), 0);\n    const perPersonCost = groupSize > 0 ? totalGroupCost / groupSize : 0;\n\n    return {\n      totalGroupCost,\n      perPersonCost,\n      item_count: groupCostItems.length\n    };\n  }, [categories, groupSize]);\n\n  // è¨ˆç®—é ˜éšŠåˆ†æ”¤é‡‘é¡\n  const guideCostPerPerson = useMemo(() => {\n    const totalGuideCost = calculateGuideWithCategories(categories);\n    return groupSizeForGuide > 0 ? Math.ceil(totalGuideCost / groupSizeForGuide) : 0;\n  }, [categories, groupSizeForGuide]);\n\n  // è™•ç†ä¸‹æ‹‰é¸å–®é …ç›®é¸æ“‡\n  const handleOptionSelect = (category_id: string, itemId: string, option: any) => {\n    // æ›´æ–°é …ç›®åç¨±\n    handleUpdateItem(category_id, itemId, 'name', option.name);\n\n    // æ ¹æ“šé¸é …é¡å‹è¨­å®šåƒ¹æ ¼å’Œåœ˜é«”åˆ†æ”¤ç‹€æ…‹\n    if (option.pricePerGroup && option.is_group_cost) {\n      // åœ˜é«”è²»ç”¨\n      handleUpdateItem(category_id, itemId, 'unit_price', option.pricePerGroup);\n      handleUpdateItem(category_id, itemId, 'is_group_cost', true);\n    } else if (option.price_per_person) {\n      // å€‹äººè²»ç”¨\n      handleUpdateItem(category_id, itemId, 'unit_price', option.price_per_person);\n      handleUpdateItem(category_id, itemId, 'is_group_cost', false);\n    } else if (option.adultPrice !== undefined) {\n      // æ´»å‹•é–€ç¥¨ (ä½¿ç”¨æˆäººåƒ¹æ ¼)\n      handleUpdateItem(category_id, itemId, 'unit_price', option.adultPrice);\n      handleUpdateItem(category_id, itemId, 'is_group_cost', false);\n    }\n  };\n\n  // å–å¾—ç•¶å‰åœ°å€çš„é¸é …\n  const regionOptions = getRegionOptions(selectedRegion);\n\n  // è¨ˆç®—ä½å®¿çš„æˆ¿å‹ä½ç½®å¹³å‡è²»ç”¨\n  const accommodationSummary = useMemo(() => {\n    const accommodationCategory = categories.find(cat => cat.id === 'accommodation');\n    if (!accommodationCategory || accommodationCategory.items.length === 0) return [];\n\n    const accommodationItems = accommodationCategory.items.filter(item => item.day !== undefined);\n    const groupedByDay: Record<number, CostItem[]> = {};\n\n    // æŒ‰å¤©åˆ†çµ„\n    accommodationItems.forEach(item => {\n      const day = item.day!;\n      if (!groupedByDay[day]) groupedByDay[day] = [];\n      groupedByDay[day].push(item);\n    });\n\n    const days = Object.keys(groupedByDay).map(d => Number(d)).sort((a, b) => a - b);\n    if (days.length === 0) return [];\n\n    // æ‰¾å‡ºæœ€å¤§æˆ¿å‹æ•¸é‡\n    const maxRoomTypes = Math.max(...days.map(day => groupedByDay[day].length));\n    const roomTypeSummaries = [];\n\n    // æŒ‰æˆ¿å‹ä½ç½®è¨ˆç®—\n    for (let roomIndex = 0; roomIndex < maxRoomTypes; roomIndex++) {\n      let total_cost = 0;\n      let roomTypeName = '';\n      let validDays = 0;\n\n      days.forEach(day => {\n        const dayItems = groupedByDay[day];\n        if (dayItems[roomIndex]) {\n          total_cost += dayItems[roomIndex].total;\n          validDays++;\n          if (!roomTypeName && dayItems[roomIndex].name) {\n            roomTypeName = dayItems[roomIndex].name;\n          }\n        }\n      });\n\n      if (validDays > 0) {\n        roomTypeSummaries.push({\n          name: roomTypeName || `æˆ¿å‹${roomIndex + 1}`,\n          total_cost,\n          averageCost: total_cost / validDays,\n          days: validDays\n        });\n      }\n    }\n\n    return roomTypeSummaries;\n  }, [categories]);\n  // ä½å®¿ç¸½æˆæœ¬ = æˆ¿å‹ä¸€ç¸½æˆæœ¬ + æˆ¿å‹äºŒç¸½æˆæœ¬ + ...\n  const accommodationTotal = useMemo(() =>\n    accommodationSummary.reduce((sum, room) => sum + room.total_cost, 0)\n  , [accommodationSummary]);\n\n  // æ›´æ–°ä½å®¿åˆ†é¡çš„ç¸½è¨ˆç‚ºæˆ¿å‹åŠ ç¸½\n  const updatedCategories = useMemo(() =>\n    categories.map(cat => {\n      if (cat.id === 'accommodation') {\n        return { ...cat, total: accommodationTotal };\n      }\n      return cat;\n    })\n  , [categories, accommodationTotal]);\n\n  // è¨ˆç®—å„èº«ä»½çš„ç¸½æˆæœ¬\n  const identityCosts = useMemo(() => {\n    const costs = {\n      adult: 0,\n      child_with_bed: 0,\n      child_no_bed: 0,\n      single_room: 0,\n      infant: 0\n    };\n\n    updatedCategories.forEach(category => {\n      category.items.forEach(item => {\n        if (category.id === 'transport') {\n          // äº¤é€šé¡åˆ¥ï¼šä¾ç…§é …ç›®åç¨±å€åˆ†èº«ä»½\n          if (item.name === 'æˆäººæ©Ÿç¥¨') {\n            // æˆäººæ©Ÿç¥¨ï¼šåªåŠ çµ¦æˆäººå’Œå–®äººæˆ¿\n            costs.adult += (item.adult_price || 0);\n            costs.single_room += (item.adult_price || 0);\n          } else if (item.name === 'å°å­©æ©Ÿç¥¨') {\n            // å°å­©æ©Ÿç¥¨ï¼šåªåŠ çµ¦å°å­©ï¼ˆä½”åºŠã€ä¸ä½”åºŠï¼‰\n            costs.child_with_bed += (item.child_price || 0);\n            costs.child_no_bed += (item.child_price || 0);\n          } else if (item.name === 'å¬°å…’æ©Ÿç¥¨') {\n            // å¬°å…’æ©Ÿç¥¨ï¼šåªåŠ çµ¦å¬°å…’\n            costs.infant += (item.infant_price || 0);\n          } else {\n            // å…¶ä»–äº¤é€šè²»ç”¨ï¼ˆéŠè¦½è»Šç­‰çµ±ä¸€åƒ¹ï¼‰ï¼šæˆäººã€å°å­©ä½”åºŠã€å–®äººæˆ¿\n            const itemCost = item.unit_price || 0;\n            costs.adult += itemCost;\n            costs.child_with_bed += itemCost;\n            costs.single_room += itemCost;\n            // ä¸ä½”åºŠå’Œå¬°å…’ä¸å«ä¸€èˆ¬äº¤é€š\n          }\n        } else if (category.id === 'accommodation') {\n          // ä½å®¿ï¼šæˆäººå’Œå°æœ‹å‹ä½”åºŠæ˜¯Ã·2ï¼Œå–®äººæˆ¿æ˜¯å…¨é¡\n          const roomPrice = item.unit_price || 0;\n          costs.adult += Math.ceil(roomPrice / 2);\n          costs.child_with_bed += Math.ceil(roomPrice / 2);\n          // ä¸ä½”åºŠä¸å«ä½å®¿\n          costs.single_room += roomPrice; // å–®äººæˆ¿å…¨é¡\n          // å¬°å…’ä¸å«ä½å®¿\n        } else if (category.id === 'meals' || category.id === 'activities' || category.id === 'others') {\n          // é¤é£²ã€æ´»å‹•ã€å…¶ä»–ï¼šæˆäººã€å°æœ‹å‹ä½”åºŠã€å–®äººæˆ¿æœ‰ï¼Œä¸ä½”åºŠå’Œå¬°å…’æ²’æœ‰\n          const itemCost = item.unit_price || 0;\n          costs.adult += itemCost;\n          costs.child_with_bed += itemCost;\n          // ä¸ä½”åºŠä¸å«é¤é£²å’Œæ´»å‹•\n          costs.single_room += itemCost;\n          // å¬°å…’ä¸å«é¤é£²å’Œæ´»å‹•\n        } else if (category.id === 'group-transport' || category.id === 'guide') {\n          // åœ˜é«”åˆ†æ”¤ã€é ˜éšŠå°éŠï¼šä¸å«å¬°å…’çš„èº«ä»½åˆ†æ”¤\n          const itemCost = item.total || 0;\n          costs.adult += itemCost;\n          costs.child_with_bed += itemCost;\n          costs.child_no_bed += itemCost;\n          costs.single_room += itemCost;\n          // å¬°å…’ä¸åˆ†æ”¤å°éŠè²»ç”¨\n        }\n      });\n    });\n\n    return costs;\n  }, [updatedCategories]);\n\n  // è¨ˆç®—ç¸½æˆæœ¬ï¼ˆæ¯å€‹èº«ä»½æˆæœ¬ Ã— äººæ•¸ï¼‰\n  const total_cost = useMemo(() =>\n    identityCosts.adult * participantCounts.adult +\n    identityCosts.child_with_bed * participantCounts.child_with_bed +\n    identityCosts.child_no_bed * participantCounts.child_no_bed +\n    identityCosts.single_room * participantCounts.single_room +\n    identityCosts.infant * participantCounts.infant\n  , [identityCosts, participantCounts]);\n\n  // è¨ˆç®—å„èº«ä»½çš„åˆ©æ½¤\n  const identityProfits = useMemo(() => ({\n    adult: sellingPrices.adult - identityCosts.adult,\n    child_with_bed: sellingPrices.child_with_bed - identityCosts.child_with_bed,\n    child_no_bed: sellingPrices.child_no_bed - identityCosts.child_no_bed,\n    single_room: sellingPrices.single_room - identityCosts.single_room,\n    infant: sellingPrices.infant - identityCosts.infant\n  }), [sellingPrices, identityCosts]);\n\n  // ä¿å­˜ç‰ˆæœ¬\n  const handleSaveVersion = useCallback((note?: string) => {\n    if (!quote) return;\n\n    try {\n      // å‰µå»ºæ–°çš„ç‰ˆæœ¬è¨˜éŒ„\n      const currentVersion = quote.version || 1;\n      const newVersionRecord = {\n        id: Date.now().toString(),\n        version: currentVersion,\n        categories: updatedCategories,\n        total_cost,\n        group_size: groupSize,\n        accommodation_days: accommodationDays,\n        participant_counts: participantCounts,\n        selling_prices: sellingPrices,\n        note: note || versionName || `ç‰ˆæœ¬ ${currentVersion}`,\n        created_at: new Date().toISOString()\n      };\n\n      // å–å¾—ç¾æœ‰çš„ç‰ˆæœ¬æ­·å²\n      const existingVersions = quote.versions || [];\n\n      // æ›´æ–°å ±åƒ¹å–®ï¼šå¢åŠ ç‰ˆæœ¬è™Ÿï¼Œå°‡ç•¶å‰ç‹€æ…‹åŠ å…¥ç‰ˆæœ¬æ­·å²\n      updateQuote(quote.id, {\n        categories: updatedCategories as any,\n        total_cost,\n        group_size: groupSize,\n        name: quoteName,\n        accommodation_days: accommodationDays,\n        participant_counts: participantCounts,\n        selling_prices: sellingPrices,\n        version: currentVersion + 1, // ç‰ˆæœ¬è™Ÿ +1\n        versions: [...existingVersions, newVersionRecord] as any // åŠ å…¥æ–°ç‰ˆæœ¬åˆ°æ­·å²\n      } as any);\n\n      // é¡¯ç¤ºæˆåŠŸæç¤º\n      setSaveSuccess(true);\n      setTimeout(() => setSaveSuccess(false), 2000);\n    } catch (error) {\n      logger.error('ä¿å­˜ç‰ˆæœ¬å¤±æ•—:', error);\n    }\n  }, [quote, updatedCategories, total_cost, groupSize, quoteName, accommodationDays, participantCounts, sellingPrices, versionName, updateQuote]);\n\n  // è¼‰å…¥ç‰¹å®šç‰ˆæœ¬\n  const handleLoadVersion = useCallback((versionData: any) => {\n    setCategories(versionData.categories);\n    setAccommodationDays(versionData.accommodation_days || 0);\n    if (versionData.participant_counts) {\n      setParticipantCounts(versionData.participant_counts);\n    }\n    if (versionData.selling_prices) {\n      setSellingPrices(versionData.selling_prices);\n    }\n    // ç‰ˆæœ¬åˆ‡æ›ä¸æ”¹è®ŠåŸºæœ¬è³‡è¨Šï¼ˆåç¨±ã€ç‹€æ…‹ç­‰ï¼‰ï¼Œåªæ”¹è®Šè²»ç”¨çµæ§‹å’Œäººæ•¸\n  }, []);\n\n  // æ ¼å¼åŒ–æ™‚é–“\n  const formatDateTime = useCallback((dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleString('zh-TW', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  }, []);\n\n  // è½‰ç‚ºæœ€çµ‚ç‰ˆæœ¬\n  const handleFinalize = () => {\n    if (!quote) return;\n\n    // å…ˆä¿å­˜ç•¶å‰ç‰ˆæœ¬\n    handleSaveVersion('è½‰ç‚ºæœ€çµ‚ç‰ˆæœ¬å‰çš„ç‹€æ…‹');\n\n    // æ›´æ–°ç‹€æ…‹ç‚ºæœ€çµ‚ç‰ˆæœ¬\n    updateQuote(quote.id, {\n      status: 'approved',\n      categories: updatedCategories as any, // CostCategory[] èˆ‡ QuoteCategory[] çµæ§‹ç›¸åŒ\n      total_cost,\n      group_size: groupSize,\n      name: quoteName,\n      accommodation_days: accommodationDays,\n      participant_counts: participantCounts,\n      selling_prices: sellingPrices\n    } as any);\n\n    // è‡ªå‹•è·³è½‰åˆ°æ—…éŠåœ˜æ–°å¢é é¢ï¼Œä¸¦å¸¶ä¸Šå ±åƒ¹å–®ID\n    router.push(`/tours?fromQuote=${quote.id}`);\n  };\n\n  // é–‹æ—…éŠåœ˜\n  const handleCreateTour = async () => {\n    if (!quote) return;\n\n    // å…ˆä¿å­˜ç›®å‰çš„å ±åƒ¹å–®ç‹€æ…‹\n    handleSaveVersion('è½‰ç‚ºæ—…éŠåœ˜å‰çš„ç‰ˆæœ¬');\n\n    // æ›´æ–°å ±åƒ¹å–®ç‹€æ…‹ç‚ºæœ€çµ‚ç‰ˆæœ¬\n    updateQuote(quote.id, { status: 'approved' });\n\n    // å‰µå»ºæ—…éŠåœ˜ï¼ˆä½¿ç”¨å ±åƒ¹å–®é¸æ“‡çš„åŸå¸‚ï¼‰\n    const departure_date = new Date();\n    departure_date.setDate(departure_date.getDate() + 30); // é è¨­30å¤©å¾Œå‡ºç™¼\n    const return_date = new Date(departure_date);\n    return_date.setDate(return_date.getDate() + 5); // é è¨­5å¤©è¡Œç¨‹\n\n    // å–å¾—é¸æ“‡çš„åŸå¸‚åç¨±\n    const selectedCityObj = availableCities.find(c => c.code === selectedCity);\n    const cityName = selectedCityObj?.name || selectedCity;\n\n    // å¾é¸æ“‡çš„åœ°å€ç”Ÿæˆåœ˜è™Ÿ\n    const tourCode = generateTourCode(selectedCity, departure_date, false);\n\n    const newTour = await addTour({\n      name: quoteName,\n      location: cityName, // ä½¿ç”¨åŸå¸‚åç¨±\n      departure_date: departure_date.toISOString().split('T')[0],\n      return_date: return_date.toISOString().split('T')[0],\n      price: Math.round(total_cost / groupSize), // æ¯äººå–®åƒ¹\n      status: 'draft',\n      code: tourCode,\n      contract_status: 'pending',\n      total_revenue: 0,\n      total_cost: total_cost,\n      profit: 0,\n    } as any);\n\n    // æ›´æ–°å ±åƒ¹å–®çš„ tour_id\n    if (newTour?.id) {\n      await updateQuote(quote.id, { tour_id: newTour.id });\n    }\n\n    // è·³è½‰åˆ°æ—…éŠåœ˜ç®¡ç†é é¢ï¼Œä¸¦é«˜äº®æ–°å»ºçš„åœ˜\n    router.push(`/tours?highlight=${newTour?.id}`);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* ç‰¹æ®Šåœ˜é–å®šè­¦å‘Š */}\n      {isSpecialTour && (\n        <div className=\"fixed top-18 right-0 left-16 bg-orange-50 border-b border-orange-200 z-30 px-6 py-2\">\n          <div className=\"flex items-center space-x-2 text-orange-800\">\n            <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n            </svg>\n            <span className=\"text-sm font-medium\">æ­¤ç‚ºç‰¹æ®Šåœ˜å ±åƒ¹å–®ï¼Œæ‰€æœ‰æ¬„ä½å·²é–å®šç„¡æ³•ç·¨è¼¯</span>\n          </div>\n        </div>\n      )}\n\n      {/* æ­£ç¢ºçš„å…©å€åŸŸæ¨™é¡Œè¨­è¨ˆ */}\n      <div className={cn(\n        \"fixed top-0 right-0 left-16 h-18 bg-background border-b border-border z-40 flex items-center justify-between px-6\",\n        isSpecialTour && \"border-b-0\"\n      )}>\n        {/* å·¦å€ï¼šå…§å®¹æ¨™é¡Œå€åŸŸ - ç·Šæ¹Šæ’åˆ— */}\n        <div className=\"flex items-center space-x-3 flex-shrink-0\">\n          <button\n            onClick={() => router.push('/quotes')}\n            className=\"p-2 hover:bg-morandi-container rounded-lg transition-colors\"\n            title=\"è¿”å›å ±åƒ¹å–®åˆ—è¡¨\"\n          >\n            <ArrowLeft size={20} className=\"text-morandi-secondary\" />\n          </button>\n\n          {/* é¡¯ç¤ºç·¨è™Ÿ */}\n          <div className=\"text-sm font-mono text-morandi-secondary\">\n            {relatedTour ? (\n              <span className=\"text-morandi-gold\" title=\"æ—…éŠåœ˜ç·¨è™Ÿ\">\n                {relatedTour.code || '-'}\n              </span>\n            ) : (\n              <span>\n                {(quote as any)?.code || '-'}\n              </span>\n            )}\n          </div>\n\n          <input\n            type=\"text\"\n            value={quoteName}\n            onChange={(e) => setQuoteName(e.target.value)}\n            disabled={isReadOnly}\n            className={cn(\n              \"text-lg font-bold text-morandi-primary bg-transparent border-0 focus:outline-none focus:bg-white px-2 py-1 rounded w-[180px]\",\n              isReadOnly && \"cursor-not-allowed opacity-60\"\n            )}\n            placeholder=\"è¼¸å…¥åœ˜é«”åç¨±\"\n          />\n\n        </div>\n\n        {/* å³å€ï¼šåŠŸèƒ½å€åŸŸ (åŸä¸­+å³åˆä½µ) */}\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"flex items-center space-x-1 whitespace-nowrap\">\n            <span className=\"text-sm text-morandi-secondary\">åœ°å€:</span>\n            {relatedTour ? (\n              // æœ‰é—œè¯æ—…éŠåœ˜ï¼šé¡¯ç¤ºæ—…éŠåœ˜åœ°å€ï¼ˆå”¯è®€ï¼‰\n              <input\n                type=\"text\"\n                value={relatedTour.location}\n                readOnly\n                className=\"px-2 py-1 text-sm border border-border rounded bg-morandi-container/30 text-morandi-secondary cursor-not-allowed\"\n                title=\"å¾æ—…éŠåœ˜è‡ªå‹•å¸¶å…¥\"\n              />\n            ) : (\n              // æ²’æœ‰é—œè¯æ—…éŠåœ˜ï¼šå¯é¸æ“‡åœ°å€\n              <select\n                value={selectedRegion}\n                onChange={(e) => setSelectedRegion(e.target.value as RegionName)}\n                disabled={isReadOnly}\n                className={cn(\n                  \"px-2 py-1 text-sm border border-border rounded bg-background text-morandi-primary\",\n                  isReadOnly && \"cursor-not-allowed opacity-60\"\n                )}\n              >\n                <option value=\"æ¸…é‚\">æ¸…é‚</option>\n                <option value=\"æ›¼è°·\">æ›¼è°·</option>\n                <option value=\"æ±äº¬\">æ±äº¬</option>\n              </select>\n            )}\n          </div>\n\n          {/* äººæ•¸çµ±è¨ˆ - 5å€‹èº«ä»½ */}\n          <div className=\"flex items-center space-x-2 whitespace-nowrap text-xs\">\n            <div className=\"flex items-center space-x-1\">\n              <span className=\"text-morandi-secondary\">æˆäºº:</span>\n              <input\n                type=\"number\"\n                value={participantCounts.adult}\n                onChange={(e) => setParticipantCounts(prev => ({ ...prev, adult: Number(e.target.value) || 0 }))}\n                disabled={isReadOnly}\n                className={cn(\"w-12 px-1 py-1 text-xs text-center border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                min=\"0\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <span className=\"text-morandi-secondary\">å°å­©:</span>\n              <input\n                type=\"number\"\n                value={participantCounts.child_with_bed}\n                onChange={(e) => setParticipantCounts(prev => ({ ...prev, child_with_bed: Number(e.target.value) || 0 }))}\n                disabled={isReadOnly}\n                className={cn(\"w-12 px-1 py-1 text-xs text-center border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                min=\"0\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <span className=\"text-morandi-secondary\">ä¸ä½”åºŠ:</span>\n              <input\n                type=\"number\"\n                value={participantCounts.child_no_bed}\n                onChange={(e) => setParticipantCounts(prev => ({ ...prev, child_no_bed: Number(e.target.value) || 0 }))}\n                disabled={isReadOnly}\n                className={cn(\"w-12 px-1 py-1 text-xs text-center border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                min=\"0\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <span className=\"text-morandi-secondary\">å–®äººæˆ¿:</span>\n              <input\n                type=\"number\"\n                value={participantCounts.single_room}\n                onChange={(e) => setParticipantCounts(prev => ({ ...prev, single_room: Number(e.target.value) || 0 }))}\n                disabled={isReadOnly}\n                className={cn(\"w-12 px-1 py-1 text-xs text-center border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                min=\"0\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <span className=\"text-morandi-secondary\">å¬°å…’:</span>\n              <input\n                type=\"number\"\n                value={participantCounts.infant}\n                onChange={(e) => setParticipantCounts(prev => ({ ...prev, infant: Number(e.target.value) || 0 }))}\n                disabled={isReadOnly}\n                className={cn(\"w-12 px-1 py-1 text-xs text-center border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                min=\"0\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex items-center space-x-1 whitespace-nowrap\">\n            <span className=\"text-sm text-morandi-secondary\">ç‹€æ…‹:</span>\n            <span className={cn(\n              'inline-flex items-center px-2 py-1 rounded text-sm font-medium',\n              quote && quote.status === 'proposed'\n                ? 'bg-morandi-gold text-white'\n                : 'bg-morandi-green text-white'\n            )}>\n              {quote?.status === 'proposed' ? 'ææ¡ˆ' : quote?.status === 'approved' ? 'å·²æ ¸å‡†' : quote?.status || 'ææ¡ˆ'}\n            </span>\n          </div>\n\n          <Button\n            onClick={() => setIsSaveDialogOpen(true)}\n            disabled={isReadOnly}\n            className={cn(\n              \"h-8 px-3 text-sm transition-all duration-200\",\n              saveSuccess\n                ? \"bg-morandi-green hover:bg-morandi-green text-white\"\n                : \"bg-morandi-green hover:bg-morandi-green-hover text-white\",\n              isReadOnly && \"cursor-not-allowed opacity-60\"\n            )}\n          >\n            <Save size={14} className=\"mr-1.5\" />\n            {saveSuccess ? 'å·²ä¿å­˜' : 'ä¿å­˜ç‰ˆæœ¬'}\n          </Button>\n\n          <DropdownMenu>\n            <DropdownMenuTrigger\n              disabled={isReadOnly}\n              className={cn(\n                \"h-8 px-3 text-sm border-morandi-container text-morandi-secondary hover:bg-morandi-container\",\n                isReadOnly && \"cursor-not-allowed opacity-60\"\n              )}\n            >\n              <History size={14} className=\"mr-1.5\" />\n              ç‰ˆæœ¬ {quote?.version || 1}\n            </DropdownMenuTrigger>\n            <DropdownMenuContent className=\"w-64\">\n              <div className=\"px-2 py-1 text-sm font-medium text-morandi-primary border-b border-border\">\n                ç‰ˆæœ¬æ­·å²\n              </div>\n\n              {/* ç•¶å‰ç‰ˆæœ¬ */}\n              <DropdownMenuItem className=\"flex items-center justify-between py-2\">\n                <div className=\"flex flex-col\">\n                  <span className=\"font-medium\">ç‰ˆæœ¬ {quote?.version || 1} (ç•¶å‰)</span>\n                  <span className=\"text-xs text-morandi-secondary\">\n                    {quote?.updated_at ? formatDateTime(quote.updated_at) : ''}\n                  </span>\n                </div>\n                <div className=\"text-xs bg-morandi-gold text-white px-2 py-1 rounded\">\n                  ç•¶å‰\n                </div>\n              </DropdownMenuItem>\n\n              {/* æ­·å²ç‰ˆæœ¬ */}\n              {quote?.versions && quote.versions.length > 0 && (\n                <>\n                  {quote.versions\n                    .sort((a, b) => b.version - a.version)\n                    .map((version) => (\n                      <DropdownMenuItem\n                        key={version.id}\n                        className=\"flex items-center justify-between py-2 cursor-pointer hover:bg-morandi-container/30\"\n                        onClick={() => handleLoadVersion(version)}\n                      >\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">{version.note || `ç‰ˆæœ¬ ${version.version}`}</span>\n                          <span className=\"text-xs text-morandi-secondary\">\n                            {formatDateTime(version.created_at)}\n                          </span>\n                        </div>\n                        <div className=\"text-xs text-morandi-secondary\">\n                          NT$ {version.total_cost.toLocaleString()}\n                        </div>\n                      </DropdownMenuItem>\n                    ))\n                  }\n                </>\n              )}\n\n              {(!quote?.versions || quote.versions.length === 0) && (\n                <div className=\"px-2 py-3 text-sm text-morandi-secondary text-center\">\n                  å°šç„¡æ­·å²ç‰ˆæœ¬\n                </div>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          {quote && quote.status === 'proposed' && (\n            <Button\n              onClick={handleFinalize}\n              disabled={isReadOnly}\n              className={cn(\n                \"h-8 px-3 text-sm bg-morandi-primary hover:bg-morandi-primary/90 text-white\",\n                isReadOnly && \"cursor-not-allowed opacity-60\"\n              )}\n            >\n              <CheckCircle size={14} className=\"mr-1.5\" />\n              è½‰ç‚ºæœ€çµ‚ç‰ˆæœ¬\n            </Button>\n          )}\n\n          {quote && quote.status === 'approved' && (\n            relatedTour ? (\n              // å·²æœ‰é—œè¯æ—…éŠåœ˜ï¼šå‰å¾€è©²æ—…éŠåœ˜\n              <Button\n                onClick={() => router.push(`/tours?highlight=${relatedTour.id}`)}\n                className=\"h-8 px-3 text-sm bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                <Plane size={14} className=\"mr-1.5\" />\n                å‰å¾€æ—…éŠåœ˜\n              </Button>\n            ) : (\n              // æ²’æœ‰é—œè¯æ—…éŠåœ˜ï¼šå»ºç«‹æ–°æ—…éŠåœ˜\n              <Button\n                onClick={handleCreateTour}\n                disabled={isReadOnly}\n                className={cn(\n                  \"h-8 px-3 text-sm bg-morandi-gold hover:bg-morandi-gold-hover text-white\",\n                  isReadOnly && \"cursor-not-allowed opacity-60\"\n                )}\n              >\n                <Plane size={14} className=\"mr-1.5\" />\n                é–‹æ—…éŠåœ˜\n              </Button>\n            )\n          )}\n        </div>\n      </div>\n\n      <div className=\"px-6 pb-6\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-10 gap-6\">\n          {/* å·¦å´å…§å®¹å€ - 70% */}\n          <div className={cn(\n            \"lg:col-span-7\",\n            isReadOnly && \"opacity-70 pointer-events-none select-none\"\n          )}>\n            <div className=\"border border-border bg-card rounded-lg overflow-hidden shadow-sm\">\n              <div ref={scrollRef} className=\"scrollable-content overflow-x-auto\">\n                <table className=\"w-full min-w-[800px] border-collapse\">\n                <thead className=\"bg-morandi-container/50\">\n                  <tr className=\"border-b-2 border-border\">\n                    <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary w-12 table-divider\">åˆ†é¡</th>\n                    <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary w-70 table-divider\">é …ç›®</th>\n                    <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary w-8 table-divider\">æ•¸é‡</th>\n                    <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary w-28 table-divider\">å–®åƒ¹</th>\n                    <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary w-28 table-divider whitespace-nowrap\">å°è¨ˆ</th>\n                    <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary w-32 table-divider\">å‚™è¨»</th>\n                    <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary w-24\">æ“ä½œ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {categories.map((category) => {\n                    const Icon = categoryIcons[category.id];\n\n                    return (\n                      <React.Fragment key={category.id}>\n                        {/* åˆ†é¡æ¨™é¡Œè¡Œ */}\n                        <tr className=\"bg-morandi-container/20 border-b border-border\">\n                          <td colSpan={2} className=\"py-2 px-4 font-medium text-morandi-primary\">\n                            <div className=\"flex items-center space-x-2\">\n                              <Icon size={16} className=\"text-morandi-gold\" />\n                              <span>{category.name}</span>\n                            </div>\n                          </td>\n                          <td className=\"py-2 px-4\"></td>\n                          <td className=\"py-2 px-4\"></td>\n                          <td className=\"py-2 px-4 font-medium text-morandi-primary text-center whitespace-nowrap\">\n                            NT$ {category.id === 'accommodation' ? accommodationTotal.toLocaleString() :\n                                 category.items.reduce((sum, item) => sum + (item.total || 0), 0).toLocaleString()}\n                          </td>\n                          <td colSpan={2} className=\"py-2 px-4 text-right\">\n                            {category.id === 'accommodation' ? (\n                              <div className=\"flex gap-1 justify-end\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={handleAddAccommodationDay}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-gold hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  æ–°å¢å¤©æ•¸\n                                </Button>\n                                {accommodationDays > 0 && (\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => handleAddRow(category.id)}\n                                    disabled={isReadOnly}\n                                    className={cn(\n                                      \"h-6 px-2 text-xs text-morandi-secondary hover:bg-morandi-gold/10\",\n                                      isReadOnly && \"cursor-not-allowed opacity-60\"\n                                    )}\n                                  >\n                                    <Plus size={12} className=\"mr-1\" />\n                                    æ–°å¢\n                                  </Button>\n                                )}\n                              </div>\n                            ) : category.id === 'group-transport' ? (\n                              <div className=\"flex gap-1 justify-end\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddRow(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-gold hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  æ–°å¢\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddGuideRow(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-secondary hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Users size={12} className=\"mr-1\" />\n                                  æ–°å¢\n                                </Button>\n                              </div>\n                            ) : category.id === 'transport' ? (\n                              <div className=\"flex gap-1 justify-end\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddAdultTicket(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-gold hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  æˆäººæ©Ÿç¥¨\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddChildTicket(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-secondary hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  å°å­©æ©Ÿç¥¨\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddInfantTicket(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-secondary hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  å¬°å…’æ©Ÿç¥¨\n                                </Button>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddRow(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-secondary hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  å…¶ä»–\n                                </Button>\n                              </div>\n                            ) : (\n                              <div className=\"flex justify-end\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  onClick={() => handleAddRow(category.id)}\n                                  disabled={isReadOnly}\n                                  className={cn(\n                                    \"h-6 px-2 text-xs text-morandi-gold hover:bg-morandi-gold/10\",\n                                    isReadOnly && \"cursor-not-allowed opacity-60\"\n                                  )}\n                                >\n                                  <Plus size={12} className=\"mr-1\" />\n                                  æ–°å¢\n                                </Button>\n                              </div>\n                            )}\n                          </td>\n                        </tr>\n\n\n                        {/* é …ç›®æ˜ç´°è¡Œ */}\n                        {category.id === 'accommodation' ? (\n                          // ä½å®¿ç‰¹æ®Šæ¸²æŸ“ï¼šæŒ‰å¤©åˆ†çµ„ï¼Œæ¯å¤©å…§é¡¯ç¤ºå„æˆ¿å‹\n                          (() => {\n                            const accommodationItems = category.items.filter(item => item.day !== undefined);\n                            const groupedByDay: Record<number, CostItem[]> = {};\n\n                            // æŒ‰å¤©åˆ†çµ„\n                            accommodationItems.forEach(item => {\n                              const day = item.day!;\n                              if (!groupedByDay[day]) groupedByDay[day] = [];\n                              groupedByDay[day].push(item);\n                            });\n\n                            return Object.keys(groupedByDay)\n                              .sort((a, b) => Number(a) - Number(b))\n                              .map(dayStr => {\n                                const day = Number(dayStr);\n                                const dayItems = groupedByDay[day];\n\n                                return dayItems.map((item, roomIndex) => (\n                                  <tr\n                                    key={item.id}\n                                    className=\"border-b border-border hover:bg-morandi-container/10 transition-colors\"\n                                  >\n                                    {/* åˆ†é¡æ¬„ï¼šç¬¬ä¸€å€‹æˆ¿å‹é¡¯ç¤ºå¤©æ•¸ */}\n                                    <td className=\"py-2 px-4 text-sm text-morandi-primary text-center table-divider\">\n                                      {roomIndex === 0 ? `DAY${day}` : ''}\n                                    </td>\n\n                                    {/* é …ç›®æ¬„ï¼šæˆ¿å‹åç¨± */}\n                                    <td className=\"py-2 px-4 text-sm text-morandi-primary text-center table-divider\">\n                                      <input\n                                        type=\"text\"\n                                        value={item.name}\n                                        onChange={(e) => handleUpdateItem(category.id, item.id, 'name', e.target.value)}\n                                        className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white\"\n                                        placeholder=\"æˆ¿å‹åç¨±\"\n                                      />\n                                    </td>\n\n                                    {/* äººæ•¸æ¬„ */}\n                                    <td className=\"py-2 px-4 text-sm text-morandi-secondary text-center table-divider\">\n                                      <input\n                                        type=\"number\"\n                                        value={item.quantity && item.quantity !== 1 ? item.quantity : ''}\n                                        onChange={(e) => handleUpdateItem(category.id, item.id, 'quantity', Number(e.target.value) || 0)}\n                                        className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                        placeholder=\"äººæ•¸\"\n                                      />\n                                    </td>\n\n                                    {/* å–®åƒ¹æ¬„ */}\n                                    <td className=\"py-2 px-4 text-sm text-morandi-secondary text-center table-divider\">\n                                      <input\n                                        type=\"number\"\n                                        value={item.unit_price || ''}\n                                        onChange={(e) => handleUpdateItem(category.id, item.id, 'unit_price', Number(e.target.value) || 0)}\n                                        className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                        placeholder=\"å–®åƒ¹\"\n                                      />\n                                    </td>\n\n                                    {/* å°è¨ˆæ¬„ */}\n                                    <td className=\"py-2 px-4 text-sm text-morandi-primary text-center font-medium table-divider whitespace-nowrap\">\n                                      {item.total.toLocaleString()}\n                                    </td>\n\n\n                                    {/* å‚™è¨» / æ“ä½œåˆä½µæ¬„ */}\n                                    <td colSpan={2} className=\"py-2 px-4 text-sm text-morandi-secondary\">\n                                      <div className=\"flex items-center justify-between\">\n                                        <input\n                                          type=\"text\"\n                                          value={item.note || ''}\n                                          onChange={(e) => handleUpdateItem(category.id, item.id, 'note', e.target.value)}\n                                          className=\"flex-1 px-1 py-1 text-sm bg-transparent border-0 focus:outline-none focus:bg-white\"\n                                          placeholder=\"å‚™è¨»\"\n                                        />\n                                        <button\n                                          onClick={() => handleRemoveItem(category.id, item.id)}\n                                          className=\"ml-2 w-4 h-4 flex items-center justify-center text-xs text-morandi-secondary hover:text-morandi-red hover:bg-morandi-red/10 rounded transition-all flex-shrink-0\"\n                                          title=\"åˆªé™¤\"\n                                        >\n                                          Ã—\n                                        </button>\n                                      </div>\n                                    </td>\n                                  </tr>\n                                ));\n                              });\n                          })()\n                        ) : (\n                          // ä¸€èˆ¬åˆ†é¡çš„æ¸²æŸ“\n                          category.items.map((item, index) => (\n                            <tr\n                              key={item.id}\n                              className=\"border-b border-border hover:bg-morandi-container/10 transition-colors\"\n                            >\n                              <td colSpan={2} className={`py-2 px-4 text-sm text-morandi-primary text-center ${(item.quantity && item.quantity !== 1) ? 'table-divider' : ''}`}>\n                                <input\n                                  type=\"text\"\n                                  value={item.name}\n                                  onChange={(e) => handleUpdateItem(category.id, item.id, 'name', e.target.value)}\n                                  className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white\"\n                                  placeholder=\"è¼¸å…¥é …ç›®åç¨±\"\n                                />\n                              </td>\n                              <td className=\"py-2 px-4 text-sm text-morandi-secondary text-center table-divider\">\n                                <input\n                                  type=\"number\"\n                                  value={item.quantity && item.quantity !== 1 ? item.quantity : ''}\n                                  onChange={(e) => handleUpdateItem(category.id, item.id, 'quantity', Number(e.target.value) || 0)}\n                                  className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                />\n                              </td>\n                              <td className=\"py-2 px-4 text-sm text-morandi-secondary text-center table-divider\">\n                                {item.name === 'æˆäººæ©Ÿç¥¨' ? (\n                                  <input\n                                    type=\"number\"\n                                    value={item.adult_price || ''}\n                                    onChange={(e) => handleUpdateItem(category.id, item.id, 'adult_price', Number(e.target.value) || 0)}\n                                    className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                    placeholder=\"æˆäººç¥¨åƒ¹\"\n                                  />\n                                ) : item.name === 'å°å­©æ©Ÿç¥¨' ? (\n                                  <input\n                                    type=\"number\"\n                                    value={item.child_price || ''}\n                                    onChange={(e) => handleUpdateItem(category.id, item.id, 'child_price', Number(e.target.value) || 0)}\n                                    className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                    placeholder=\"å°å­©ç¥¨åƒ¹\"\n                                  />\n                                ) : item.name === 'å¬°å…’æ©Ÿç¥¨' ? (\n                                  <input\n                                    type=\"number\"\n                                    value={item.infant_price || ''}\n                                    onChange={(e) => handleUpdateItem(category.id, item.id, 'infant_price', Number(e.target.value) || 0)}\n                                    className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                    placeholder=\"å¬°å…’ç¥¨åƒ¹\"\n                                  />\n                                ) : (\n                                  <input\n                                    type=\"number\"\n                                    value={item.unit_price || ''}\n                                    onChange={(e) => handleUpdateItem(category.id, item.id, 'unit_price', Number(e.target.value) || 0)}\n                                    className=\"w-full px-1 py-1 text-sm text-center bg-transparent border-0 focus:outline-none focus:bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                                  />\n                                )}\n                              </td>\n                              <td className=\"py-2 px-4 text-sm text-morandi-primary text-center font-medium table-divider whitespace-nowrap\">\n                                {item.total.toLocaleString()}\n                              </td>\n\n\n                              {/* å‚™è¨» / æ“ä½œåˆä½µæ¬„ */}\n                              <td colSpan={2} className=\"py-2 px-4 text-sm text-morandi-secondary\">\n                                <div className=\"flex items-center justify-between\">\n                                  <input\n                                    type=\"text\"\n                                    value={item.note || ''}\n                                    onChange={(e) => handleUpdateItem(category.id, item.id, 'note', e.target.value)}\n                                    className=\"flex-1 px-1 py-1 text-sm bg-transparent border-0 focus:outline-none focus:bg-white\"\n                                    placeholder=\"å‚™è¨»\"\n                                  />\n                                  <button\n                                    onClick={() => handleRemoveItem(category.id, item.id)}\n                                    className=\"ml-2 w-4 h-4 flex items-center justify-center text-xs text-morandi-secondary hover:text-morandi-red hover:bg-morandi-red/10 rounded transition-all flex-shrink-0\"\n                                    title=\"åˆªé™¤\"\n                                  >\n                                    Ã—\n                                  </button>\n                                </div>\n                              </td>\n                          </tr>\n                        )))}\n\n\n                      </React.Fragment>\n                    );\n                  })}\n\n                  {/* ç¸½è¨ˆè¡Œ - é¡¯ç¤ºå„èº«ä»½æˆæœ¬ */}\n                  <tr className=\"bg-morandi-gold/10 border-t-2 border-morandi-gold\">\n                    <td colSpan={2} className=\"py-3 px-4 font-bold text-morandi-primary\">èº«ä»½æˆæœ¬</td>\n                    <td colSpan={5} className=\"py-3 px-4\">\n                      <div className=\"flex flex-wrap gap-4 text-sm\">\n                        {participantCounts.adult > 0 && (\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-morandi-secondary\">æˆäºº:</span>\n                            <span className=\"font-bold text-morandi-primary\">\n                              NT$ {identityCosts.adult.toLocaleString()}\n                            </span>\n                          </div>\n                        )}\n                        {participantCounts.child_with_bed > 0 && (\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-morandi-secondary\">å°å­©:</span>\n                            <span className=\"font-bold text-morandi-primary\">\n                              NT$ {identityCosts.child_with_bed.toLocaleString()}\n                            </span>\n                          </div>\n                        )}\n                        {participantCounts.child_no_bed > 0 && (\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-morandi-secondary\">ä¸ä½”åºŠ:</span>\n                            <span className=\"font-bold text-morandi-primary\">\n                              NT$ {identityCosts.child_no_bed.toLocaleString()}\n                            </span>\n                          </div>\n                        )}\n                        {participantCounts.single_room > 0 && (\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-morandi-secondary\">å–®äººæˆ¿:</span>\n                            <span className=\"font-bold text-morandi-primary\">\n                              NT$ {identityCosts.single_room.toLocaleString()}\n                            </span>\n                          </div>\n                        )}\n                        {participantCounts.infant > 0 && (\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-morandi-secondary\">å¬°å…’:</span>\n                            <span className=\"font-bold text-morandi-primary\">\n                              NT$ {identityCosts.infant.toLocaleString()}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n\n          {/* å³å´å”®åƒ¹é¡¯ç¤ºå€ - 30% */}\n          <div className=\"lg:col-span-3\">\n            <div className=\"bg-card border border-border rounded-lg overflow-hidden shadow-sm sticky top-6\">\n              <div className=\"px-4 py-3 border-b border-border bg-morandi-container/50\">\n                <h3 className=\"font-medium text-morandi-primary\">åƒ¹æ ¼ç¸½è¦½</h3>\n              </div>\n\n              <table className=\"w-full text-xs\">\n                <tbody>\n                  {/* æˆäºº */}\n                  {participantCounts.adult > 0 && (\n                    <>\n                      <tr className=\"border-b-2 border-morandi-gold bg-morandi-container/20\">\n                        <td colSpan={2} className=\"py-2 px-4 font-medium text-morandi-primary\">\n                          æˆäºº ({participantCounts.adult}äºº)\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">æˆæœ¬</td>\n                        <td className=\"py-1 px-4 text-right text-morandi-primary\">\n                          {identityCosts.adult.toLocaleString()}\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">å”®åƒ¹</td>\n                        <td className=\"py-1 px-4 text-right\">\n                          <input\n                            type=\"number\"\n                            value={sellingPrices.adult || ''}\n                            onChange={(e) => setSellingPrices(prev => ({ ...prev, adult: Number(e.target.value) || 0 }))}\n                            disabled={isReadOnly}\n                            className={cn(\"w-full px-2 py-1 text-xs text-right border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                          />\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border bg-morandi-container/10\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">åˆ©æ½¤</td>\n                        <td className={cn(\"py-1 px-4 text-right font-medium\", identityProfits.adult >= 0 ? \"text-morandi-green\" : \"text-morandi-red\")}>\n                          {identityProfits.adult.toLocaleString()}\n                        </td>\n                      </tr>\n                    </>\n                  )}\n\n                  {/* å°æœ‹å‹ï¼ˆä½”åºŠï¼‰ */}\n                  {participantCounts.child_with_bed > 0 && (\n                    <>\n                      <tr className=\"border-b-2 border-morandi-gold bg-morandi-container/20\">\n                        <td colSpan={2} className=\"py-2 px-4 font-medium text-morandi-primary\">\n                          å°æœ‹å‹ï¼ˆä½”åºŠï¼‰ ({participantCounts.child_with_bed}äºº)\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">æˆæœ¬</td>\n                        <td className=\"py-1 px-4 text-right text-morandi-primary\">\n                          {identityCosts.child_with_bed.toLocaleString()}\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">å”®åƒ¹</td>\n                        <td className=\"py-1 px-4 text-right\">\n                          <input\n                            type=\"number\"\n                            value={sellingPrices.child_with_bed || ''}\n                            onChange={(e) => setSellingPrices(prev => ({ ...prev, child_with_bed: Number(e.target.value) || 0 }))}\n                            disabled={isReadOnly}\n                            className={cn(\"w-full px-2 py-1 text-xs text-right border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                          />\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border bg-morandi-container/10\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">åˆ©æ½¤</td>\n                        <td className={cn(\"py-1 px-4 text-right font-medium\", identityProfits.child_with_bed >= 0 ? \"text-morandi-green\" : \"text-morandi-red\")}>\n                          {identityProfits.child_with_bed.toLocaleString()}\n                        </td>\n                      </tr>\n                    </>\n                  )}\n\n                  {/* ä¸ä½”åºŠ */}\n                  {participantCounts.child_no_bed > 0 && (\n                    <>\n                      <tr className=\"border-b-2 border-morandi-gold bg-morandi-container/20\">\n                        <td colSpan={2} className=\"py-2 px-4 font-medium text-morandi-primary\">\n                          ä¸ä½”åºŠ ({participantCounts.child_no_bed}äºº)\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">æˆæœ¬</td>\n                        <td className=\"py-1 px-4 text-right text-morandi-primary\">\n                          {identityCosts.child_no_bed.toLocaleString()}\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">å”®åƒ¹</td>\n                        <td className=\"py-1 px-4 text-right\">\n                          <input\n                            type=\"number\"\n                            value={sellingPrices.child_no_bed || ''}\n                            onChange={(e) => setSellingPrices(prev => ({ ...prev, child_no_bed: Number(e.target.value) || 0 }))}\n                            disabled={isReadOnly}\n                            className={cn(\"w-full px-2 py-1 text-xs text-right border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                          />\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border bg-morandi-container/10\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">åˆ©æ½¤</td>\n                        <td className={cn(\"py-1 px-4 text-right font-medium\", identityProfits.child_no_bed >= 0 ? \"text-morandi-green\" : \"text-morandi-red\")}>\n                          {identityProfits.child_no_bed.toLocaleString()}\n                        </td>\n                      </tr>\n                    </>\n                  )}\n\n                  {/* å–®äººæˆ¿ */}\n                  {participantCounts.single_room > 0 && (\n                    <>\n                      <tr className=\"border-b-2 border-morandi-gold bg-morandi-container/20\">\n                        <td colSpan={2} className=\"py-2 px-4 font-medium text-morandi-primary\">\n                          å–®äººæˆ¿ ({participantCounts.single_room}äºº)\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">æˆæœ¬</td>\n                        <td className=\"py-1 px-4 text-right text-morandi-primary\">\n                          {identityCosts.single_room.toLocaleString()}\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">å”®åƒ¹</td>\n                        <td className=\"py-1 px-4 text-right\">\n                          <input\n                            type=\"number\"\n                            value={sellingPrices.single_room || ''}\n                            onChange={(e) => setSellingPrices(prev => ({ ...prev, single_room: Number(e.target.value) || 0 }))}\n                            disabled={isReadOnly}\n                            className={cn(\"w-full px-2 py-1 text-xs text-right border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                          />\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border bg-morandi-container/10\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">åˆ©æ½¤</td>\n                        <td className={cn(\"py-1 px-4 text-right font-medium\", identityProfits.single_room >= 0 ? \"text-morandi-green\" : \"text-morandi-red\")}>\n                          {identityProfits.single_room.toLocaleString()}\n                        </td>\n                      </tr>\n                    </>\n                  )}\n\n                  {/* å¬°å…’ */}\n                  {participantCounts.infant > 0 && (\n                    <>\n                      <tr className=\"border-b-2 border-morandi-gold bg-morandi-container/20\">\n                        <td colSpan={2} className=\"py-2 px-4 font-medium text-morandi-primary\">\n                          å¬°å…’ ({participantCounts.infant}äºº)\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">æˆæœ¬</td>\n                        <td className=\"py-1 px-4 text-right text-morandi-primary\">\n                          {identityCosts.infant.toLocaleString()}\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">å”®åƒ¹</td>\n                        <td className=\"py-1 px-4 text-right\">\n                          <input\n                            type=\"number\"\n                            value={sellingPrices.infant || ''}\n                            onChange={(e) => setSellingPrices(prev => ({ ...prev, infant: Number(e.target.value) || 0 }))}\n                            disabled={isReadOnly}\n                            className={cn(\"w-full px-2 py-1 text-xs text-right border border-border rounded\", isReadOnly && \"cursor-not-allowed opacity-60\")}\n                          />\n                        </td>\n                      </tr>\n                      <tr className=\"border-b border-border bg-morandi-container/10\">\n                        <td className=\"py-1 px-4 text-morandi-secondary\">åˆ©æ½¤</td>\n                        <td className={cn(\"py-1 px-4 text-right font-medium\", identityProfits.infant >= 0 ? \"text-morandi-green\" : \"text-morandi-red\")}>\n                          {identityProfits.infant.toLocaleString()}\n                        </td>\n                      </tr>\n                    </>\n                  )}\n                </tbody>\n              </table>\n\n              <div className=\"p-4\">\n                <Button className=\"w-full bg-morandi-gold hover:bg-morandi-gold-hover text-white\">\n                  ç”¢ç”Ÿå ±åƒ¹å–®\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* ä¿å­˜ç‰ˆæœ¬å°è©±æ¡† */}\n      <Dialog open={isSaveDialogOpen} onOpenChange={setIsSaveDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>ä¿å­˜ç‰ˆæœ¬</DialogTitle>\n          </DialogHeader>\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              handleSaveVersion(versionName);\n              setIsSaveDialogOpen(false);\n              setVersionName('');\n            }}\n            className=\"space-y-4\"\n          >\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">ç‰ˆæœ¬åç¨±</label>\n              <Input\n                value={versionName}\n                onChange={(e) => setVersionName(e.target.value)}\n                placeholder=\"ä¾‹å¦‚ï¼šåˆç‰ˆã€ä¿®æ­£ç‰ˆã€æœ€çµ‚ç‰ˆç­‰\"\n                className=\"mt-1\"\n                autoFocus\n              />\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  setIsSaveDialogOpen(false);\n                  setVersionName('');\n                }}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"bg-morandi-green hover:bg-morandi-green-hover text-white\"\n              >\n                ä¿å­˜ <span className=\"ml-1 text-xs opacity-70\">(Enter)</span>\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/quotes/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'statusFilters' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadQuotes'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadQuotes]","fix":{"range":[1724,1726],"text":"[loadQuotes]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3293,3296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3293,3296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'tours'. Either include it or remove the dependency array.","line":151,"column":6,"nodeType":"ArrayExpression","endLine":151,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [tours]","fix":{"range":[4705,4707],"text":"[tours]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6731,6734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6731,6734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7000,7003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7000,7003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7076,7079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7076,7079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo, useEffect } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { EnhancedTable, TableColumn } from '@/components/ui/enhanced-table';\nimport { useQuotes } from '@/features/quotes/hooks/useQuotes';\nimport { useTourStore } from '@/stores';\nimport { Calculator, FileText, Users, Trash2, Copy } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/utils/logger';\nimport { QUOTE_STATUS_LABELS } from '@/constants/quote-status';\n\nconst statusFilters = ['all', 'proposed', 'approved'];\n\nexport default function QuotesPage() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { items: tours } = useTourStore();\n  const { quotes, addQuote, deleteQuote, duplicateQuote, loadQuotes } = useQuotes();\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [newQuote, setNewQuote] = useState<{\n    name: string;\n    status: 'proposed' | 'approved';\n    group_size: number;\n  }>({\n    name: '',\n    status: 'proposed',\n    group_size: 1,\n  });\n\n  // è¼‰å…¥å ±åƒ¹å–®è³‡æ–™ - å»¶é²è¼‰å…¥å„ªåŒ–\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      loadQuotes();\n    }, 100);\n    return () => clearTimeout(timer);\n  }, []); // âœ… åªåœ¨çµ„ä»¶æ›è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡\n\n  // æª¢æŸ¥ URL åƒæ•¸ï¼Œè‡ªå‹•é–‹å•Ÿæ–°å¢å°è©±æ¡†\n  useEffect(() => {\n    const tourId = searchParams.get('tour_id');\n    // åªåœ¨æœ‰ tour_id ä¸”å°è©±æ¡†æœªé–‹å•Ÿæ™‚æª¢æŸ¥ï¼ˆé¿å…æ–°å¢å®Œå¾Œé‡è¤‡è§¸ç™¼ï¼‰\n    if (tourId && !isAddDialogOpen) {\n      // æª¢æŸ¥è©²åœ˜æ˜¯å¦å·²æœ‰å ±åƒ¹å–®\n      const existingQuote = quotes.find(q => q.tour_id === tourId);\n      if (!existingQuote) {\n        // æ²’æœ‰å ±åƒ¹å–®ï¼Œæ‰¾åˆ°æ—…éŠåœ˜è³‡æ–™ä¸¦é–‹å•Ÿå°è©±æ¡†\n        const tour = tours.find(t => t.id === tourId);\n        if (tour) {\n          console.log('ğŸ“‹ è‡ªå‹•é–‹å•Ÿæ–°å¢å°è©±æ¡†ï¼Œåœ˜å:', tour.name);\n          setNewQuote({\n            name: tour.name,\n            status: 'proposed',\n            group_size: tour.max_participants || 1,\n          });\n          setIsAddDialogOpen(true);\n        }\n      } else {\n        // å·²æœ‰å ±åƒ¹å–®ï¼Œç›´æ¥è·³è½‰åˆ°è©²å ±åƒ¹å–®\n        console.log('ğŸ”„ è©²åœ˜å·²æœ‰å ±åƒ¹å–®ï¼Œè·³è½‰åˆ°:', existingQuote.id);\n        router.replace(`/quotes/${existingQuote.id}`);\n      }\n    }\n  }, [searchParams, quotes, tours, router, isAddDialogOpen]);\n\n  // è¡¨æ ¼é…ç½®\n  const tableColumns: TableColumn[] = useMemo(() => [\n    {\n      key: 'quote_number',\n      label: 'ç·¨è™Ÿ',\n      sortable: true,\n      render: (value, quote) => {\n        // å¦‚æœæœ‰é—œè¯æ—…éŠåœ˜ï¼Œé¡¯ç¤ºæ—…éŠåœ˜ç·¨è™Ÿ\n        if (quote.tour_id) {\n          const relatedTour = tours.find(t => t.id === quote.tour_id);\n          if (relatedTour?.code) {\n            return (\n              <span className=\"text-sm text-morandi-gold font-mono\" title=\"æ—…éŠåœ˜ç·¨è™Ÿ\">\n                {relatedTour.code}\n              </span>\n            );\n          }\n        }\n        // å¦å‰‡é¡¯ç¤ºå ±åƒ¹å–®è‡ªå·±çš„ç·¨è™Ÿ\n        return (\n          <span className=\"text-sm text-morandi-secondary font-mono\">\n            {(quote as any).code || '-'}\n          </span>\n        );\n      },\n    },\n    {\n      key: 'name',\n      label: 'åœ˜é«”åç¨±',\n      sortable: true,\n      render: (value, quote) => (\n        <span className=\"text-sm font-medium text-morandi-primary\">{quote.name}</span>\n      ),\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      render: (value, quote) => (\n        <span className={cn(\n          'text-sm font-medium',\n          getStatusColor(quote.status)\n        )}>\n          {QUOTE_STATUS_LABELS[quote.status as keyof typeof QUOTE_STATUS_LABELS] || quote.status}\n        </span>\n      ),\n    },\n    {\n      key: 'group_size',\n      label: 'äººæ•¸',\n      sortable: true,\n      render: (value, quote) => (\n        <div className=\"flex items-center text-sm text-morandi-secondary\">\n          <Users size={14} className=\"mr-1\" />\n          {quote.group_size}äºº\n        </div>\n      ),\n    },\n    {\n      key: 'total_cost',\n      label: 'ç¸½æˆæœ¬',\n      sortable: true,\n      render: (value, quote) => (\n        <span className=\"text-sm text-morandi-secondary\">\n          NT$ {quote.total_cost.toLocaleString()}\n        </span>\n      ),\n    },\n    {\n      key: 'created_at',\n      label: 'å»ºç«‹æ™‚é–“',\n      sortable: true,\n      render: (value, quote) => (\n        <span className=\"text-sm text-morandi-secondary\">\n          {new Date(quote.created_at).toLocaleDateString()}\n        </span>\n      ),\n    },\n  ], []);\n\n  const filteredQuotes = quotes.filter(quote => {\n    const matchesStatus = statusFilter === 'all' || quote.status === statusFilter;\n\n    // æœå°‹ - æœå°‹æ‰€æœ‰æ–‡å­—æ¬„ä½\n    const searchLower = searchTerm.toLowerCase();\n    const matchesSearch = !searchTerm ||\n      quote.name.toLowerCase().includes(searchLower) ||\n      quote.quote_number?.toLowerCase().includes(searchLower) ||\n      quote.status.toLowerCase().includes(searchLower);\n\n    return matchesStatus && matchesSearch;\n  });\n\n  const handleAddQuote = async () => {\n    if (!newQuote.name.trim()) return;\n\n    const defaultCategories = [\n      { id: 'transport', name: 'äº¤é€š', items: [], total: 0 },\n      { id: 'group-transport', name: 'åœ˜é«”åˆ†æ”¤', items: [], total: 0 },\n      { id: 'accommodation', name: 'ä½å®¿', items: [], total: 0 },\n      { id: 'meals', name: 'é¤é£²', items: [], total: 0 },\n      { id: 'activities', name: 'æ´»å‹•', items: [], total: 0 },\n      { id: 'others', name: 'å…¶ä»–', items: [], total: 0 },\n      { id: 'guide', name: 'é ˜éšŠå°éŠ', items: [], total: 0 }\n    ];\n\n    try {\n      // å¾ URL å–å¾— tour_idï¼ˆå¦‚æœæœ‰ï¼‰\n      const tourId = searchParams.get('tour_id');\n\n      // æ–°å¢å ±åƒ¹å–®ä¸¦å–å¾—å®Œæ•´ç‰©ä»¶\n      const newQuoteObj = await addQuote({\n        ...newQuote,\n        ...(tourId && { tour_id: tourId }), // å¦‚æœæœ‰ tour_idï¼ŒåŠ å…¥å ±åƒ¹å–®è³‡æ–™\n        accommodation_days: 0,\n        categories: defaultCategories,\n        total_cost: 0,\n      });\n\n      console.log('âœ… æ–°å¢å ±åƒ¹å–®å®Œæˆ:', newQuoteObj);\n      console.log('å ±åƒ¹å–® ID:', newQuoteObj?.id);\n\n      // é‡ç½®è¡¨å–®ä¸¦é—œé–‰å°è©±æ¡†\n      setNewQuote({\n        name: '',\n        status: 'proposed',\n        group_size: 1,\n      });\n      setIsAddDialogOpen(false);\n\n      // ç›´æ¥è·³è½‰åˆ°è©³ç´°é é¢é–‹å§‹ç·¨è¼¯\n      if (newQuoteObj?.id) {\n        console.log('ğŸ”„ æº–å‚™è·³è½‰åˆ°:', `/quotes/${newQuoteObj.id}`);\n        // ä½¿ç”¨ replace é¿å…è¿”å›æ™‚å›åˆ°å¸¶åƒæ•¸çš„åˆ—è¡¨é \n        router.replace(`/quotes/${newQuoteObj.id}`);\n      } else {\n        console.error('âŒ å ±åƒ¹å–® ID ä¸å­˜åœ¨ï¼Œç„¡æ³•è·³è½‰');\n      }\n    } catch (error) {\n      logger.error('æ–°å¢å ±åƒ¹å–®å¤±æ•—:', error);\n      alert('æ–°å¢å ±åƒ¹å–®å¤±æ•—ï¼Œè«‹é‡è©¦');\n    }\n  };\n\n  const handleQuoteClick = (quote: any) => {\n    router.push(`/quotes/${quote.id}`);\n  };\n\n  const handleDuplicateQuote = async (quote_id: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    try {\n      const duplicated = await duplicateQuote(quote_id);\n      if (duplicated && (duplicated as any).id) {\n        // è·³è½‰åˆ°æ–°å ±åƒ¹å–®\n        router.push(`/quotes/${(duplicated as any).id}`);\n      } else {\n        alert('è¤‡è£½å ±åƒ¹å–®å¤±æ•—ï¼Œè«‹é‡è©¦');\n      }\n    } catch (error) {\n      logger.error('âŒ è¤‡è£½å ±åƒ¹å–®å¤±æ•—:', error);\n      alert('è¤‡è£½å ±åƒ¹å–®å¤±æ•—ï¼Œè«‹é‡è©¦');\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      'proposed': 'text-morandi-gold',\n      'approved': 'text-green-600'\n    };\n    return colors[status] || 'text-morandi-secondary';\n  };\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"å ±åƒ¹å–®ç®¡ç†\"\n        icon={Calculator}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'å ±åƒ¹å–®ç®¡ç†', href: '/quotes' }\n        ]}\n        tabs={[\n          { value: 'all', label: 'å…¨éƒ¨', icon: Calculator },\n          { value: 'proposed', label: 'ææ¡ˆ', icon: FileText },\n          { value: 'approved', label: 'å·²æ ¸å‡†', icon: FileText }\n        ]}\n        activeTab={statusFilter}\n        onTabChange={setStatusFilter}\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹å ±åƒ¹å–®åç¨±...\"\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢å ±åƒ¹å–®\"\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n        className=\"min-h-full\"\n        columns={tableColumns}\n        data={filteredQuotes}\n        searchableFields={['name']}\n        searchTerm={searchTerm}\n        onRowClick={(quote) => handleQuoteClick(quote)}\n        bordered={true}\n        actions={(quote) => (\n          <div className=\"flex items-center gap-1\">\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                handleQuoteClick(quote);\n              }}\n              className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n              title=\"ç·¨è¼¯å ±åƒ¹å–®\"\n            >\n              <Calculator size={14} className=\"text-morandi-gold\" />\n            </button>\n            <button\n              onClick={(e) => handleDuplicateQuote(quote.id, e)}\n              className=\"p-1 hover:bg-morandi-blue/10 rounded transition-colors\"\n              title=\"è¤‡è£½å ±åƒ¹å–®\"\n            >\n              <Copy size={14} className=\"text-morandi-blue\" />\n            </button>\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                deleteQuote(quote.id);\n              }}\n              className=\"p-1 hover:bg-morandi-red/10 rounded transition-colors\"\n              title=\"åˆªé™¤å ±åƒ¹å–®\"\n            >\n              <Trash2 size={14} className=\"text-morandi-red\" />\n            </button>\n          </div>\n        )}\n      />\n      </div>\n\n      {/* æ–°å¢å ±åƒ¹å–®å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢å ±åƒ¹å–®</DialogTitle>\n          </DialogHeader>\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              if (newQuote.name.trim()) {\n                handleAddQuote();\n              }\n            }}\n            className=\"space-y-4\"\n          >\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">åœ˜é«”åç¨±</label>\n              <Input\n                value={newQuote.name}\n                onChange={(e) => setNewQuote(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"è¼¸å…¥åœ˜é«”åç¨±\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">äººæ•¸</label>\n              <Input\n                type=\"number\"\n                value={newQuote.group_size}\n                onChange={(e) => setNewQuote(prev => ({ ...prev, group_size: Number(e.target.value) || 0 }))}\n                placeholder=\"1\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">ç‹€æ…‹</label>\n              <Select\n                value={newQuote.status}\n                onValueChange={(value) => setNewQuote(prev => ({ ...prev, status: value as 'proposed' | 'approved' }))}\n              >\n                <SelectTrigger className=\"mt-1\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"proposed\">ææ¡ˆ</SelectItem>\n                  <SelectItem value=\"approved\">å·²æ ¸å‡†</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setIsAddDialogOpen(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={!newQuote.name.trim()}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢ <span className=\"ml-1 text-xs opacity-70\">(Enter)</span>\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/settings/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Monitor' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPageReady' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2656,2659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2656,2659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2913,2916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2913,2916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2938,2941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2938,2941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3913,3916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3913,3916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useThemeStore } from '@/stores/theme-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Palette, Monitor, Moon, Sun, Check, LogOut, User, Lock, Eye, EyeOff } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/utils/logger';\n\n// å¼·åˆ¶å®¢æˆ¶ç«¯æ¸²æŸ“ï¼Œä¸é å–ä¼ºæœå™¨è³‡æ–™\nexport const dynamic = 'force-dynamic';\nexport const fetchCache = 'force-no-store';\n\nexport default function SettingsPage() {\n  const { currentTheme, setTheme } = useThemeStore();\n  const { user, logout } = useAuthStore();\n  const [isPageReady, setIsPageReady] = useState(false);\n\n  // å¿«é€Ÿè¼‰å…¥é é¢ï¼ˆä¸ç­‰å¾…ä»»ä½•éåŒæ­¥æ“ä½œï¼‰\n  useEffect(() => {\n    setIsPageReady(true);\n  }, []);\n\n  // å¯†ç¢¼ä¿®æ”¹ç‹€æ…‹\n  const [showPasswordSection, setShowPasswordSection] = useState(false);\n  const [passwordData, setPasswordData] = useState({\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: ''\n  });\n  const [showPassword, setShowPassword] = useState(false);\n  const [passwordUpdateLoading, setPasswordUpdateLoading] = useState(false);\n\n  const handleLogout = () => {\n    logout();\n    window.location.href = '/login';\n  };\n\n  const handlePasswordUpdate = async () => {\n    if (!user) {\n      alert('è«‹å…ˆç™»å…¥');\n      return;\n    }\n\n    if (!passwordData.currentPassword) {\n      alert('è«‹è¼¸å…¥ç›®å‰å¯†ç¢¼ï¼');\n      return;\n    }\n\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\n      alert('æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ç¬¦ï¼');\n      return;\n    }\n\n    if (passwordData.newPassword.length < 8) {\n      alert('å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦8å€‹å­—å…ƒï¼');\n      return;\n    }\n\n    // æª¢æŸ¥ç¶²è·¯ç‹€æ…‹\n    if (!navigator.onLine) {\n      alert('âš ï¸ ç›®å‰é›¢ç·šï¼Œç„¡æ³•ä¿®æ”¹å¯†ç¢¼ã€‚è«‹é€£æ¥ç¶²è·¯å¾Œå†è©¦ã€‚');\n      return;\n    }\n\n    setPasswordUpdateLoading(true);\n\n    try {\n      // å‹•æ…‹å°å…¥ï¼ˆåªåœ¨éœ€è¦æ™‚è¼‰å…¥ï¼‰\n      const [authModule, supabaseModule] = await Promise.all([\n        import('@/lib/auth'),\n        import('@/lib/supabase/client')\n      ]);\n\n      const { hashPassword, verifyPassword } = authModule;\n      const { supabase } = supabaseModule;\n\n      // 1. é©—è­‰ç›®å‰å¯†ç¢¼\n      const { data: userData, error: fetchError } = await supabase\n        .from('employees')\n        .select('password_hash')\n        .eq('employee_number', user.employee_number)\n        .single();\n\n      if (fetchError || !userData) {\n        alert('é©—è­‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n        setPasswordUpdateLoading(false);\n        return;\n      }\n\n      const isPasswordValid = await verifyPassword(passwordData.currentPassword, (userData as any).password_hash);\n      if (!isPasswordValid) {\n        alert('ç›®å‰å¯†ç¢¼éŒ¯èª¤ï¼');\n        setPasswordUpdateLoading(false);\n        return;\n      }\n\n      // 2. æ›´æ–°æ–°å¯†ç¢¼\n      const hashedPassword = await hashPassword(passwordData.newPassword);\n\n      const result: any = await (supabase as any)\n        .from('employees')\n        .update({ password_hash: hashedPassword })\n        .eq('employee_number', user.employee_number);\n\n      const { error } = result;\n\n      if (error) {\n        logger.error('å¯†ç¢¼æ›´æ–°å¤±æ•—:', error);\n        alert('å¯†ç¢¼æ›´æ–°å¤±æ•—ï¼š' + error.message);\n        setPasswordUpdateLoading(false);\n        return;\n      }\n\n      // 3. æ¸…é™¤è§’è‰²å¡ï¼ˆé‡è¦ï¼å¦å‰‡èˆŠå¯†ç¢¼é‚„èƒ½ç™»å…¥ï¼‰\n      try {\n        const { useLocalAuthStore } = await import('@/lib/auth/local-auth-manager');\n        const localAuthStore = useLocalAuthStore.getState();\n\n        // åˆªé™¤ç•¶å‰ç”¨æˆ¶çš„è§’è‰²å¡\n        localAuthStore.removeProfile(user.id);\n        logger.log('ğŸ—‘ï¸ å·²åˆªé™¤è§’è‰²å¡ï¼Œä¸‹æ¬¡ç™»å…¥éœ€å¾ç¶²è·¯é©—è­‰');\n      } catch (profileError) {\n        logger.warn('âš ï¸ æ¸…é™¤è§’è‰²å¡å¤±æ•—ï¼ˆä¸å½±éŸ¿å¯†ç¢¼æ›´æ–°ï¼‰:', profileError);\n      }\n\n      // 4. åŒæ­¥æ›´æ–° IndexedDB çš„å¯†ç¢¼\n      try {\n        const { localDB } = await import('@/lib/db');\n        const { TABLES } = await import('@/lib/db/schemas');\n\n        const employee = await localDB.read(TABLES.EMPLOYEES, user.id) as any;\n        if (employee) {\n          await localDB.put(TABLES.EMPLOYEES, {\n            ...employee,\n            password_hash: hashedPassword,\n            last_password_change: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          });\n          logger.log('âœ… IndexedDB å¯†ç¢¼å·²æ›´æ–°');\n        }\n      } catch (dbError) {\n        logger.warn('âš ï¸ IndexedDB æ›´æ–°å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½ï¼‰:', dbError);\n      }\n\n      alert('âœ… å¯†ç¢¼æ›´æ–°æˆåŠŸï¼ä¸‹æ¬¡ç™»å…¥éœ€é‡æ–°é©—è­‰ã€‚');\n      setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });\n      setShowPasswordSection(false);\n    } catch (error) {\n      logger.error('å¯†ç¢¼æ›´æ–°éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);\n      alert('å¯†ç¢¼æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setPasswordUpdateLoading(false);\n    }\n  };\n\n  const themes = [\n    {\n      id: 'morandi' as const,\n      name: 'è«è˜­è¿ªå„ªé›…',\n      description: 'æŸ”å’Œçš„è‰²å½©ï¼Œæº«æš–çš„ç±³è‰²èƒŒæ™¯ï¼Œé©åˆé•·æ™‚é–“ä½¿ç”¨',\n      icon: Sun,\n      preview: {\n        bg: '#F6F4F1',\n        primary: '#3A3633',\n        secondary: '#8B8680',\n        accent: '#C4A572',\n        card: '#FFFFFF',\n      },\n    },\n    {\n      id: 'modern-dark' as const,\n      name: 'ç¾ä»£æ·±è‰²',\n      description: 'æ·±è‰²èƒŒæ™¯ï¼Œé«˜å°æ¯”åº¦ï¼Œç¾ä»£æ„Ÿåè¶³çš„è¨­è¨ˆ',\n      icon: Moon,\n      preview: {\n        bg: '#36393f',           // Discord æ·±ç°èƒŒæ™¯\n        primary: '#dcddde',      // ä¸»æ–‡å­—è‰²ï¼ˆæŸ”å’Œç™½ï¼‰\n        secondary: '#b9bbbe',    // æ¬¡æ–‡å­—è‰²ï¼ˆç°ç™½ï¼‰\n        accent: '#5865f2',       // Discord ç´«è—è‰²\n        card: '#2f3136',         // å¡ç‰‡èƒŒæ™¯\n      },\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <ResponsiveHeader\n        title=\"ç³»çµ±è¨­å®š\"\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'è¨­å®š', href: '/settings' },\n        ]}\n        actions={\n          <div className=\"flex items-center gap-3\">\n            {/* ç”¨æˆ¶è³‡è¨Š */}\n            {user && (\n              <div className=\"flex items-center gap-2 px-3 py-2 bg-morandi-container rounded-lg\">\n                <User className=\"h-4 w-4 text-morandi-secondary\" />\n                <span className=\"text-sm font-medium text-morandi-primary\">\n                  {user.display_name}\n                </span>\n              </div>\n            )}\n\n            {/* ç™»å‡ºæŒ‰éˆ• */}\n            <Button\n              variant=\"outline\"\n              onClick={handleLogout}\n              className=\"flex items-center gap-2 text-morandi-red border-morandi-red hover:bg-morandi-red hover:text-white\"\n            >\n              <LogOut className=\"h-4 w-4\" />\n              ç™»å‡º\n            </Button>\n          </div>\n        }\n      />\n\n      <div className=\"max-w-4xl mx-auto space-y-8\">\n        {/* ä¸»é¡Œè¨­å®šå€å¡Š */}\n        <Card className=\"p-6\">\n          <div className=\"flex items-center gap-3 mb-6\">\n            <Palette className=\"h-6 w-6 text-morandi-gold\" />\n            <h2 className=\"text-xl font-semibold\">ä¸»é¡Œè¨­å®š</h2>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-6\">\n            {themes.map((theme) => {\n              const Icon = theme.icon;\n              const is_active = currentTheme === theme.id;\n\n              return (\n                <button\n                  key={theme.id}\n                  onClick={() => setTheme(theme.id)}\n                  className={cn(\n                    'relative group text-left transition-all duration-300',\n                    'border-2 rounded-xl overflow-hidden',\n                    is_active\n                      ? 'border-morandi-gold shadow-lg scale-[1.02]'\n                      : 'border-border hover:border-morandi-gold/50 hover:shadow-md'\n                  )}\n                >\n                  {/* é¸ä¸­æ¨™è¨˜ */}\n                  {is_active && (\n                    <div className=\"absolute top-3 right-3 z-10 bg-morandi-gold text-white rounded-full p-1\">\n                      <Check className=\"h-4 w-4\" />\n                    </div>\n                  )}\n\n                  {/* é è¦½å€åŸŸ */}\n                  <div\n                    className=\"h-32 p-4 relative overflow-hidden\"\n                    style={{\n                      background: theme.preview.bg,\n                    }}\n                  >\n                    {/* æ¨¡æ“¬ä»‹é¢å…ƒç´  */}\n                    <div className=\"space-y-2\">\n                      {/* æ¨¡æ“¬å°èˆªæ¬„ */}\n                      <div className=\"flex gap-2\">\n                        <div\n                          className=\"h-2 w-16 rounded-full opacity-80\"\n                          style={{ backgroundColor: theme.preview.accent }}\n                        />\n                        <div\n                          className=\"h-2 w-12 rounded-full opacity-60\"\n                          style={{ backgroundColor: theme.preview.secondary }}\n                        />\n                      </div>\n                      \n                      {/* æ¨¡æ“¬å¡ç‰‡ */}\n                      <div\n                        className=\"p-2 rounded-lg shadow-sm\"\n                        style={{ backgroundColor: theme.preview.card }}\n                      >\n                        <div\n                          className=\"h-1.5 w-20 rounded-full mb-1\"\n                          style={{ backgroundColor: theme.preview.primary }}\n                        />\n                        <div\n                          className=\"h-1 w-16 rounded-full opacity-60\"\n                          style={{ backgroundColor: theme.preview.secondary }}\n                        />\n                      </div>\n\n                      {/* æ¨¡æ“¬æŒ‰éˆ• */}\n                      <div className=\"flex gap-2\">\n                        <div\n                          className=\"h-6 w-14 rounded-md\"\n                          style={{ backgroundColor: theme.preview.accent }}\n                        />\n                        <div\n                          className=\"h-6 w-14 rounded-md border\"\n                          style={{ borderColor: theme.preview.secondary }}\n                        />\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* ä¸»é¡Œè³‡è¨Š */}\n                  <div className=\"p-4 bg-card\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Icon className=\"h-5 w-5 text-morandi-gold\" />\n                      <h3 className=\"font-semibold text-base\">{theme.name}</h3>\n                    </div>\n                    <p className=\"text-sm text-morandi-secondary\">\n                      {theme.description}\n                    </p>\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n\n          <div className=\"mt-6 p-4 bg-morandi-container/20 rounded-lg\">\n            <p className=\"text-sm text-morandi-secondary\">\n              <strong>æç¤ºï¼š</strong>ä¸»é¡Œè¨­å®šæœƒç«‹å³ç”Ÿæ•ˆä¸¦è‡ªå‹•å„²å­˜ã€‚\n              ä¸åŒä¸»é¡Œé©åˆä¸åŒçš„ä½¿ç”¨å ´æ™¯å’Œå€‹äººå–œå¥½ã€‚\n            </p>\n          </div>\n        </Card>\n\n        {/* å¸³è™Ÿå®‰å…¨è¨­å®š */}\n        <Card className=\"p-6\">\n          <div className=\"flex items-center gap-3 mb-6\">\n            <Lock className=\"h-6 w-6 text-morandi-gold\" />\n            <h2 className=\"text-xl font-semibold\">å¸³è™Ÿå®‰å…¨</h2>\n          </div>\n\n          <div className=\"space-y-4\">\n            {/* ä¿®æ”¹å¯†ç¢¼å€å¡Š */}\n            <div className=\"p-4 border border-border rounded-lg\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <div>\n                  <h3 className=\"font-medium mb-1\">ä¿®æ”¹å¯†ç¢¼</h3>\n                  <p className=\"text-sm text-morandi-secondary\">å®šæœŸæ›´æ›å¯†ç¢¼ä»¥ä¿è­·æ‚¨çš„å¸³è™Ÿå®‰å…¨</p>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowPasswordSection(!showPasswordSection)}\n                >\n                  {showPasswordSection ? 'å–æ¶ˆ' : 'ä¿®æ”¹å¯†ç¢¼'}\n                </Button>\n              </div>\n\n              {showPasswordSection && (\n                <div className=\"mt-4 space-y-4 pt-4 border-t border-border\">\n                  {/* ç›®å‰å¯†ç¢¼ */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                      ç›®å‰å¯†ç¢¼\n                    </label>\n                    <div className=\"relative\">\n                      <Input\n                        type={showPassword ? \"text\" : \"password\"}\n                        value={passwordData.currentPassword}\n                        onChange={(e) => setPasswordData({\n                          ...passwordData,\n                          currentPassword: e.target.value\n                        })}\n                        placeholder=\"è«‹è¼¸å…¥ç›®å‰å¯†ç¢¼\"\n                        className=\"pr-10\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => setShowPassword(!showPassword)}\n                        className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary hover:text-morandi-primary\"\n                      >\n                        {showPassword ? <EyeOff size={16} /> : <Eye size={16} />}\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* æ–°å¯†ç¢¼ */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                      æ–°å¯†ç¢¼\n                    </label>\n                    <Input\n                      type={showPassword ? \"text\" : \"password\"}\n                      value={passwordData.newPassword}\n                      onChange={(e) => setPasswordData({\n                        ...passwordData,\n                        newPassword: e.target.value\n                      })}\n                      placeholder=\"è‡³å°‘8å€‹å­—å…ƒ\"\n                    />\n                  </div>\n\n                  {/* ç¢ºèªæ–°å¯†ç¢¼ */}\n                  <div>\n                    <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                      ç¢ºèªæ–°å¯†ç¢¼\n                    </label>\n                    <Input\n                      type={showPassword ? \"text\" : \"password\"}\n                      value={passwordData.confirmPassword}\n                      onChange={(e) => setPasswordData({\n                        ...passwordData,\n                        confirmPassword: e.target.value\n                      })}\n                      placeholder=\"å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼\"\n                    />\n                  </div>\n\n                  {/* å¯†ç¢¼ç¢ºèªæç¤º */}\n                  {passwordData.newPassword && passwordData.confirmPassword && (\n                    <div className=\"text-sm\">\n                      {passwordData.newPassword === passwordData.confirmPassword ? (\n                        <span className=\"text-green-600\">âœ“ å¯†ç¢¼ç¢ºèªä¸€è‡´</span>\n                      ) : (\n                        <span className=\"text-red-600\">âœ— å¯†ç¢¼ç¢ºèªä¸ä¸€è‡´</span>\n                      )}\n                    </div>\n                  )}\n\n                  {/* æ“ä½œæŒ‰éˆ• */}\n                  <div className=\"flex gap-2 pt-2\">\n                    <Button\n                      onClick={handlePasswordUpdate}\n                      disabled={\n                        passwordUpdateLoading ||\n                        !passwordData.currentPassword ||\n                        !passwordData.newPassword ||\n                        passwordData.newPassword !== passwordData.confirmPassword ||\n                        passwordData.newPassword.length < 8\n                      }\n                      className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n                    >\n                      {passwordUpdateLoading ? 'æ›´æ–°ä¸­...' : 'æ›´æ–°å¯†ç¢¼'}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => {\n                        setShowPasswordSection(false);\n                        setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' });\n                      }}\n                    >\n                      å–æ¶ˆ\n                    </Button>\n                  </div>\n\n                  {/* å¯†ç¢¼è¦æ±‚æç¤º */}\n                  <div className=\"text-xs text-morandi-muted bg-morandi-container/30 p-3 rounded\">\n                    <p className=\"font-medium mb-1\">ğŸ“ å¯†ç¢¼è¦æ±‚ï¼š</p>\n                    <ul className=\"list-disc list-inside space-y-1\">\n                      <li>è‡³å°‘8å€‹å­—å…ƒ</li>\n                      <li>å»ºè­°åŒ…å«æ•¸å­—å’Œå­—æ¯</li>\n                      <li>éœ€è¦å…ˆè¼¸å…¥ç›®å‰å¯†ç¢¼é€²è¡Œé©—è­‰</li>\n                    </ul>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </Card>\n\n        {/* å…¶ä»–è¨­å®šå€å¡Š */}\n        <Card className=\"p-6\">\n          <h2 className=\"text-xl font-semibold mb-4\">å…¶ä»–è¨­å®š</h2>\n          <div className=\"space-y-4\">\n            <div className=\"p-4 border border-border rounded-lg\">\n              <h3 className=\"font-medium mb-2\">èªè¨€è¨­å®š</h3>\n              <p className=\"text-sm text-morandi-secondary\">ç¹é«”ä¸­æ–‡ï¼ˆé è¨­ï¼‰</p>\n            </div>\n            <div className=\"p-4 border border-border rounded-lg\">\n              <h3 className=\"font-medium mb-2\">é€šçŸ¥è¨­å®š</h3>\n              <p className=\"text-sm text-morandi-secondary\">ç³»çµ±é€šçŸ¥ï¼šé–‹å•Ÿ</p>\n            </div>\n            <div className=\"p-4 border border-border rounded-lg\">\n              <h3 className=\"font-medium mb-2\">è³‡æ–™å‚™ä»½</h3>\n              <p className=\"text-sm text-morandi-secondary\">è‡ªå‹•å‚™ä»½ï¼šæ¯æ—¥å‡Œæ™¨ 2:00</p>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/templates/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { use, useState, useRef } from 'react'\n\nimport { useRouter } from 'next/navigation'\n\nimport { Save, Eye, Download, ChevronLeft } from 'lucide-react'\n\nimport { ResponsiveHeader } from '@/components/layout/responsive-header'\nimport { TemplateExcelEditor } from '@/components/templates/template-excel-editor'\nimport { TemplatePDFPreview } from '@/components/templates/template-pdf-preview'\nimport { Button } from '@/components/ui/button'\nimport { useTemplateStore } from '@/stores/template-store'\n\ninterface PageProps {\n  params: Promise<{ id: string }>\n}\n\nexport default function TemplateEditorPage({ params }: PageProps) {\n  const { id } = use(params)\n  const router = useRouter()\n  const { getTemplate, updateTemplate } = useTemplateStore()\n  const template = getTemplate(id)\n\n  const [excelData, setExcelData] = useState(template?.excel_structure || null)\n  const [isSaving, setIsSaving] = useState(false)\n  const [columnWidths, setColumnWidths] = useState<number[]>([\n    80, 100, 150, 120, 100, 100, 100, 100, 100, 100, 100, 100,\n  ])\n\n  if (!template) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-screen\">\n        <div className=\"text-6xl mb-4\">ğŸ“„</div>\n        <h2 className=\"text-xl font-bold text-morandi-primary mb-2\">æ‰¾ä¸åˆ°æ­¤æ¨¡æ¿</h2>\n        <Button onClick={() => router.push('/templates')}>è¿”å›åˆ—è¡¨</Button>\n      </div>\n    )\n  }\n\n  const handleSave = async () => {\n    setIsSaving(true)\n    try {\n      await updateTemplate(id, {\n        excel_structure: excelData || undefined,\n      })\n      alert('å„²å­˜æˆåŠŸï¼')\n    } catch (error) {\n      console.error('å„²å­˜å¤±æ•—:', error)\n      alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  const handlePreview = () => {\n    // TODO: å¯¦ä½œé è¦½åŠŸèƒ½\n    alert('PDF é è¦½åŠŸèƒ½å³å°‡æ¨å‡º')\n  }\n\n  const handleExport = () => {\n    // TODO: å¯¦ä½œåŒ¯å‡ºåŠŸèƒ½\n    alert('PDF åŒ¯å‡ºåŠŸèƒ½å³å°‡æ¨å‡º')\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title={template.name}\n        showBackButton={true}\n        onBack={() => router.push('/templates')}\n        actions={\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" size=\"sm\" onClick={handlePreview}>\n              <Eye size={16} className=\"mr-2\" />\n              é è¦½\n            </Button>\n            <Button variant=\"outline\" size=\"sm\" onClick={handleExport}>\n              <Download size={16} className=\"mr-2\" />\n              åŒ¯å‡º PDF\n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleSave}\n              disabled={isSaving}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n            >\n              <Save size={16} className=\"mr-2\" />\n              {isSaving ? 'å„²å­˜ä¸­...' : 'å„²å­˜'}\n            </Button>\n          </div>\n        }\n      />\n\n      {/* ä¸»è¦ç·¨è¼¯å€ï¼šå·¦å³åˆ†å‰²ï¼ˆå›ºå®š 50/50ï¼‰ */}\n      <div className=\"flex-1 flex gap-4 overflow-hidden\">\n        {/* å·¦å´ï¼šExcel ç·¨è¼¯å™¨ */}\n        <div className=\"flex-1 overflow-hidden\">\n          <TemplateExcelEditor\n            data={excelData}\n            onChange={setExcelData}\n            onColumnWidthChange={setColumnWidths}\n            field_mappings={template.field_mappings}\n          />\n        </div>\n\n        {/* åˆ†éš”ç·š */}\n        <div className=\"w-px bg-morandi-muted/70\" />\n\n        {/* å³å´ï¼šå³æ™‚ PDF é è¦½ */}\n        <div className=\"flex-1 overflow-hidden\">\n          <TemplatePDFPreview\n            data={excelData}\n            columnWidths={columnWidths}\n            fieldMappings={template.field_mappings}\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/templates/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Template' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addTemplate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":19,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\nimport { useRouter } from 'next/navigation'\n\nimport { Plus } from 'lucide-react'\n\nimport { ResponsiveHeader } from '@/components/layout/responsive-header'\nimport { TemplateCard } from '@/components/templates/template-card'\nimport { TemplateEditorDialog } from '@/components/templates/template-editor-dialog'\nimport { Button } from '@/components/ui/button'\nimport { useTemplateStore } from '@/stores/template-store'\n\nimport { Template } from '@/types/template'\n\nexport default function TemplatesPage() {\n  const router = useRouter()\n  const { templates, addTemplate } = useTemplateStore()\n  const [createDialogOpen, setCreateDialogOpen] = useState(false)\n\n  // åªé¡¯ç¤ºæœªåˆªé™¤çš„æ¨¡æ¿\n  const activeTemplates = templates.filter(t => !t.is_deleted)\n\n  return (\n    <div className=\"space-y-6\">\n      <ResponsiveHeader\n        title=\"æ¨¡æ¿ç®¡ç†\"\n        actions={\n          <Button onClick={() => setCreateDialogOpen(true)}>\n            <Plus size={16} className=\"mr-2\" />\n            æ–°å¢æ¨¡æ¿\n          </Button>\n        }\n      />\n\n      {/* æ¨¡æ¿åˆ—è¡¨ */}\n      {activeTemplates.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center py-20\">\n          <div className=\"text-center\">\n            <div className=\"text-6xl mb-4\">ğŸ“„</div>\n            <h3 className=\"text-lg font-bold text-morandi-primary mb-2\">å°šæœªå»ºç«‹ä»»ä½•æ¨¡æ¿</h3>\n            <p className=\"text-sm text-morandi-secondary mb-6\">\n              å»ºç«‹æ¨¡æ¿ä»¥å¿«é€Ÿç”¢ç”Ÿå ±åƒ¹å–®ã€è¡Œç¨‹è¡¨ç­‰æ–‡ä»¶\n            </p>\n            <Button onClick={() => setCreateDialogOpen(true)}>\n              <Plus size={16} className=\"mr-2\" />\n              å»ºç«‹ç¬¬ä¸€å€‹æ¨¡æ¿\n            </Button>\n          </div>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {activeTemplates.map(template => (\n            <TemplateCard\n              key={template.id}\n              template={template}\n              onEdit={template => {\n                // å°èˆªåˆ°å®Œæ•´çš„ç·¨è¼¯é é¢\n                router.push(`/templates/${template.id}`)\n              }}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* æ–°å¢æ¨¡æ¿å°è©±æ¡† */}\n      <TemplateEditorDialog\n        open={createDialogOpen}\n        onOpenChange={setCreateDialogOpen}\n        template={null}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/box-dialogs/basic-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/box-dialogs/reminder-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/box-dialogs/workout-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'allCompleted' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":172,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":172,"endColumn":21},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":377,"column":51,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":377,"endColumn":88}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\n\nimport { Check, Clock, Dumbbell, Trash2, Plus, Edit2, X } from 'lucide-react'\n\nimport { Button } from '@/components/ui/button'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\nimport { useTimeboxStore, WorkoutData, WorkoutExercise, ScheduledBox } from '@/stores/timebox-store'\n\ninterface WorkoutDialogProps {\n  scheduledBox: ScheduledBox\n  onClose: () => void\n}\n\nexport default function WorkoutDialog({ scheduledBox, onClose }: WorkoutDialogProps) {\n  const {\n    boxes,\n    toggleBoxCompletion,\n    removeScheduledBox,\n    addWorkoutExercise,\n    removeWorkoutExercise,\n    updateWorkoutExercise,\n    toggleSetCompletion,\n    scheduledBoxes\n  } = useTimeboxStore()\n\n  const [showAddExercise, setShowAddExercise] = useState(false)\n  const [editingExerciseId, setEditingExerciseId] = useState<string | null>(null)\n  const [isAdding, setIsAdding] = useState(false)\n  const [exerciseForm, setExerciseForm] = useState({\n    equipment: '',\n    weight: 0,\n    reps: 0,\n    sets: 3,\n  })\n\n  const box = boxes.find(b => b.id === scheduledBox.boxId)\n\n  // å³æ™‚ç²å–æœ€æ–°çš„ scheduledBox è³‡æ–™\n  const currentScheduledBox = scheduledBoxes.find(sb => sb.id === scheduledBox.id) || scheduledBox\n  const workoutData = (currentScheduledBox.data as WorkoutData) || { exercises: [] }\n\n  // é‡ç½®è¡¨å–®\n  const resetForm = () => {\n    setExerciseForm({\n      equipment: '',\n      weight: 0,\n      reps: 0,\n      sets: 3,\n    })\n    setShowAddExercise(false)\n    setEditingExerciseId(null)\n  }\n\n  // æ–°å¢å‹•ä½œ\n  const handleAddExercise = () => {\n    if (!exerciseForm.equipment.trim()) return\n\n    setIsAdding(true)\n    addWorkoutExercise(scheduledBox.id, {\n      ...exerciseForm,\n      setsCompleted: Array(exerciseForm.sets).fill(false),\n      completedSetsTime: Array(exerciseForm.sets).fill(null)\n    })\n\n    // å»¶é²é—œé–‰è¡¨å–®ï¼Œè®“ç”¨æˆ¶çœ‹åˆ°ç¢ºèªå‹•ç•«\n    setTimeout(() => {\n      resetForm()\n      setIsAdding(false)\n    }, 300)\n  }\n\n  // ç·¨è¼¯å‹•ä½œ\n  const handleEditExercise = (exercise: WorkoutExercise) => {\n    setExerciseForm({\n      equipment: exercise.equipment,\n      weight: exercise.weight,\n      reps: exercise.reps,\n      sets: exercise.sets,\n    })\n    setEditingExerciseId(exercise.id)\n    setShowAddExercise(true)\n  }\n\n  // å„²å­˜ç·¨è¼¯\n  const handleSaveEdit = () => {\n    if (!editingExerciseId) return\n\n    setIsAdding(true)\n    updateWorkoutExercise(scheduledBox.id, editingExerciseId, exerciseForm)\n\n    // å»¶é²é—œé–‰è¡¨å–®ï¼Œè®“ç”¨æˆ¶çœ‹åˆ°ç¢ºèªå‹•ç•«\n    setTimeout(() => {\n      resetForm()\n      setIsAdding(false)\n    }, 300)\n  }\n\n  // åˆªé™¤å‹•ä½œ\n  const handleDeleteExercise = (exerciseId: string) => {\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å‹•ä½œå—ï¼Ÿ')) return\n    removeWorkoutExercise(scheduledBox.id, exerciseId)\n  }\n\n  // é»æ“Šçµ„æ•¸æ™‚çš„è™•ç†ï¼ˆè‡ªå‹•æª¢æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆï¼‰\n  const handleSetClick = (exerciseId: string, setIndex: number) => {\n    toggleSetCompletion(scheduledBox.id, exerciseId, setIndex)\n\n    // å»¶é²æª¢æŸ¥ä»¥ç¢ºä¿ç‹€æ…‹æ›´æ–°\n    setTimeout(() => {\n      const updatedBox = scheduledBoxes.find(sb => sb.id === scheduledBox.id)\n      if (!updatedBox) return\n\n      const updatedData = updatedBox.data as WorkoutData\n      if (!updatedData?.exercises || updatedData.exercises.length === 0) return\n\n      // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰å‹•ä½œçš„æ‰€æœ‰çµ„éƒ½å®Œæˆäº†\n      const allCompleted = updatedData.exercises.every(ex =>\n        ex.setsCompleted.every(completed => completed === true)\n      )\n\n      // å¦‚æœå…¨éƒ¨å®Œæˆä¸”å°šæœªæ¨™è¨˜å®Œæˆï¼Œè‡ªå‹•æ¨™è¨˜\n      if (allCompleted && !updatedBox.completed) {\n        toggleBoxCompletion(scheduledBox.id)\n      }\n    }, 100)\n  }\n\n  // åˆªé™¤æ’ç¨‹\n  const handleDelete = () => {\n    if (!confirm(`ç¢ºå®šè¦ç§»é™¤æ­¤è¨“ç·´æ’ç¨‹å—ï¼Ÿ\\n\\nç®±å­ï¼š${box?.name}`)) return\n    removeScheduledBox(scheduledBox.id)\n    onClose()\n  }\n\n  // è¨ˆç®—ç¸½è¨“ç·´é‡\n  const getTotalVolume = () => {\n    if (!workoutData.exercises) return 0\n    return workoutData.exercises.reduce((total, exercise) => {\n      const completedSets = exercise.setsCompleted.filter(Boolean).length\n      return total + (completedSets * exercise.weight * exercise.reps)\n    }, 0)\n  }\n\n  // è¨ˆç®—ç¸½å®Œæˆçµ„æ•¸\n  const getTotalCompletedSets = () => {\n    if (!workoutData.exercises) return 0\n    return workoutData.exercises.reduce((total, exercise) => {\n      return total + exercise.setsCompleted.filter(Boolean).length\n    }, 0)\n  }\n\n  // è¨ˆç®—ç¸½çµ„æ•¸\n  const getTotalSets = () => {\n    if (!workoutData.exercises) return 0\n    return workoutData.exercises.reduce((total, exercise) => {\n      return total + exercise.sets\n    }, 0)\n  }\n\n  if (!box) return null\n\n  const formatDateTime = (dayOfWeek: number, start_time: string) => {\n    const days = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­']\n    return `${days[dayOfWeek]} ${start_time}`\n  }\n\n  const totalCompletedSets = getTotalCompletedSets()\n  const totalSets = getTotalSets()\n  const allCompleted = totalSets > 0 && totalCompletedSets === totalSets\n  const isBoxCompleted = currentScheduledBox.completed\n\n  return (\n    <Dialog open={true} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-2xl max-h-[85vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center space-x-2\">\n            <Dumbbell className=\"h-5 w-5\" />\n            <span>{box.name}</span>\n          </DialogTitle>\n          <p className=\"text-sm text-gray-500\">\n            {formatDateTime(scheduledBox.dayOfWeek, scheduledBox.start_time)}\n          </p>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* å‹•ä½œåˆ—è¡¨ */}\n          <div>\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"font-medium\">è¨“ç·´å‹•ä½œ</h3>\n              {!showAddExercise && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setShowAddExercise(true)}\n                  className=\"text-morandi-gold border-morandi-gold hover:bg-morandi-gold/10\"\n                >\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  æ–°å¢å‹•ä½œ\n                </Button>\n              )}\n            </div>\n\n            {/* æ–°å¢/ç·¨è¼¯è¡¨å–® */}\n            {showAddExercise && (\n              <div className=\"bg-morandi-container/10 rounded-lg p-4 mb-4 border-2 border-morandi-gold/30\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h4 className=\"text-sm font-medium text-morandi-gold\">\n                    {editingExerciseId ? 'ç·¨è¼¯å‹•ä½œ' : 'æ–°å¢å‹•ä½œ'}\n                  </h4>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={resetForm}\n                    className=\"h-6 w-6 p-0\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n\n                <div className=\"grid grid-cols-4 gap-3 mb-3\">\n                  <div className=\"col-span-2\">\n                    <label className=\"text-xs text-morandi-secondary\">å‹•ä½œåç¨± *</label>\n                    <Input\n                      value={exerciseForm.equipment}\n                      onChange={(e) => setExerciseForm(prev => ({ ...prev, equipment: e.target.value }))}\n                      placeholder=\"ä¾‹: æ§“éˆ´è‡¥æ¨\"\n                      className=\"mt-1\"\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"text-xs text-morandi-secondary\">é‡é‡ (kg)</label>\n                    <Input\n                      type=\"number\"\n                      value={exerciseForm.weight}\n                      onChange={(e) => setExerciseForm(prev => ({\n                        ...prev,\n                        weight: e.target.value === '' ? 0 : Number(e.target.value)\n                      }))}\n                      className=\"mt-1\"\n                      min={0}\n                      step={0.5}\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-2\">\n                    <div>\n                      <label className=\"text-xs text-morandi-secondary\">æ¬¡æ•¸</label>\n                      <Input\n                        type=\"number\"\n                        value={exerciseForm.reps}\n                        onChange={(e) => setExerciseForm(prev => ({\n                          ...prev,\n                          reps: e.target.value === '' ? 0 : Number(e.target.value)\n                        }))}\n                        className=\"mt-1\"\n                        min={0}\n                      />\n                    </div>\n                    <div>\n                      <label className=\"text-xs text-morandi-secondary\">çµ„æ•¸</label>\n                      <Input\n                        type=\"number\"\n                        value={exerciseForm.sets}\n                        onChange={(e) => setExerciseForm(prev => ({\n                          ...prev,\n                          sets: e.target.value === '' ? 1 : Number(e.target.value)\n                        }))}\n                        min={1}\n                        max={10}\n                        className=\"mt-1\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Button\n                  onClick={editingExerciseId ? handleSaveEdit : handleAddExercise}\n                  disabled={!exerciseForm.equipment.trim() || isAdding}\n                  className={`w-full transition-all duration-300 ${\n                    isAdding\n                      ? 'bg-morandi-green border-morandi-green scale-105'\n                      : 'bg-morandi-gold hover:bg-morandi-gold/90'\n                  }`}\n                  size=\"sm\"\n                >\n                  {isAdding ? (\n                    <span className=\"flex items-center gap-2\">\n                      <Check className=\"h-4 w-4 animate-in zoom-in\" />\n                      å·²æ–°å¢ï¼\n                    </span>\n                  ) : (\n                    editingExerciseId ? 'å„²å­˜ä¿®æ”¹' : 'æ–°å¢'\n                  )}\n                </Button>\n              </div>\n            )}\n\n            {/* å‹•ä½œåˆ—è¡¨ */}\n            {!workoutData.exercises || workoutData.exercises.length === 0 ? (\n              <div className=\"text-center py-8 text-morandi-secondary\">\n                <Dumbbell className=\"h-12 w-12 mx-auto mb-2 opacity-30\" />\n                <p>å°šæœªæ–°å¢ä»»ä½•è¨“ç·´å‹•ä½œ</p>\n                <p className=\"text-sm\">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢å‹•ä½œã€é–‹å§‹è¨˜éŒ„</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {workoutData.exercises.map((exercise, index) => {\n                  const completedSets = exercise.setsCompleted.filter(Boolean).length\n                  return (\n                    <div\n                      key={exercise.id}\n                      className=\"bg-white rounded-lg border border-border p-4 hover:border-morandi-gold/50 transition-colors\"\n                    >\n                      {/* å‹•ä½œæ¨™é¡Œ */}\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"text-xs text-morandi-secondary font-medium\">\n                              å‹•ä½œ {index + 1}\n                            </span>\n                            <h4 className=\"font-medium\">{exercise.equipment}</h4>\n                          </div>\n                          <p className=\"text-sm text-morandi-secondary mt-1\">\n                            {exercise.weight}kg Ã— {exercise.reps}æ¬¡ Ã— {exercise.sets}çµ„\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleEditExercise(exercise)}\n                            className=\"h-8 w-8 p-0 text-morandi-secondary hover:text-morandi-gold\"\n                          >\n                            <Edit2 className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteExercise(exercise.id)}\n                            className=\"h-8 w-8 p-0 text-morandi-secondary hover:text-morandi-red\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n\n                      {/* çµ„æ•¸é€²åº¦ */}\n                      <div>\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <span className=\"text-xs text-morandi-secondary\">\n                            å®Œæˆé€²åº¦: {completedSets}/{exercise.sets} çµ„\n                          </span>\n                          <span className=\"text-xs text-morandi-secondary\">\n                            è¨“ç·´é‡: {(completedSets * exercise.weight * exercise.reps).toLocaleString()} kg\n                          </span>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          {exercise.setsCompleted.map((completed, setIndex) => (\n                            <button\n                              key={setIndex}\n                              onClick={() => handleSetClick(exercise.id, setIndex)}\n                              className={`\n                                relative w-12 h-12 rounded-lg border-2 transition-all duration-200\n                                flex flex-col items-center justify-center\n                                active:scale-95\n                                ${completed\n                                  ? 'bg-morandi-green border-morandi-green text-white shadow-lg scale-105 animate-pulse'\n                                  : 'border-morandi-container hover:border-morandi-gold hover:bg-morandi-gold/5 bg-white hover:scale-105'\n                                }\n                              `}\n                              title={exercise.completedSetsTime[setIndex]\n                                ? `å®Œæˆæ–¼ ${new Date(exercise.completedSetsTime[setIndex]!).toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' })}`\n                                : `é»æ“Šå®Œæˆç¬¬ ${setIndex + 1} çµ„`\n                              }\n                            >\n                              {completed ? (\n                                <Check className=\"h-5 w-5 animate-in zoom-in duration-200\" />\n                              ) : (\n                                <span className=\"text-sm font-semibold text-morandi-secondary\">\n                                  {setIndex + 1}\n                                </span>\n                              )}\n                            </button>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  )\n                })}\n              </div>\n            )}\n          </div>\n\n          {/* çµ±è¨ˆ */}\n          {workoutData.exercises && workoutData.exercises.length > 0 && (\n            <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n              <h3 className=\"font-medium mb-3\">æœ¬æ¬¡çµ±è¨ˆ</h3>\n              <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                <div>\n                  <span className=\"text-morandi-secondary\">ç¸½å‹•ä½œæ•¸:</span>\n                  <p className=\"font-medium text-lg\">{workoutData.exercises.length}</p>\n                </div>\n                <div>\n                  <span className=\"text-morandi-secondary\">å®Œæˆçµ„æ•¸:</span>\n                  <p className=\"font-medium text-lg\">{totalCompletedSets}/{totalSets}</p>\n                </div>\n                <div>\n                  <span className=\"text-morandi-secondary\">ç¸½è¨“ç·´é‡:</span>\n                  <p className=\"font-medium text-lg\">{getTotalVolume().toLocaleString()} kg</p>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* æŒ‰éˆ•èˆ‡å®Œæˆç‹€æ…‹ */}\n          <div className=\"pt-4 border-t space-y-3\">\n            {/* å®Œæˆç‹€æ…‹æç¤º */}\n            {isBoxCompleted && (\n              <div className=\"bg-morandi-green/10 border border-morandi-green/30 rounded-lg p-3 flex items-center justify-center gap-2\">\n                <Check className=\"h-5 w-5 text-morandi-green\" />\n                <span className=\"text-morandi-green font-medium\">\n                  æ­¤è¨“ç·´å·²å®Œæˆ âœ“\n                </span>\n              </div>\n            )}\n\n            <div className=\"flex justify-between\">\n              <Button\n                variant=\"outline\"\n                onClick={handleDelete}\n                className=\"text-morandi-red border-morandi-red hover:bg-morandi-red/10\"\n              >\n                <Trash2 size={16} className=\"mr-1\" />\n                ç§»é™¤æ’ç¨‹\n              </Button>\n              <Button variant=\"outline\" onClick={onClose}>\n                é—œé–‰\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/box-manager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1833,1836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1833,1836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { useTimeboxStore, morandiColors } from '@/stores/timebox-store'\nimport { useAuthStore } from '@/stores/auth-store'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport ColorPicker from '@/components/ui/color-picker'\nimport { Plus, Dumbbell, MessageSquare, Package, Edit, Trash2 } from 'lucide-react'\n\nconst typeIcons = {\n  workout: Dumbbell,\n  reminder: MessageSquare,\n  basic: Package,\n}\n\nconst typeLabels = {\n  workout: 'é‡è¨“ç®±å­',\n  reminder: 'æ–‡å­—æç¤ºç®±å­',\n  basic: 'æ™®é€šç®±å­',\n}\n\nexport default function BoxManager() {\n  const { boxes, createBox, updateBox, deleteBox } = useTimeboxStore()\n  const { user } = useAuthStore()\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false)\n  const [editingBox, setEditingBox] = useState<string | null>(null)\n\n  // æ–°å¢/ç·¨è¼¯è¡¨å–®ç‹€æ…‹\n  const [formData, setFormData] = useState({\n    name: '',\n    type: 'basic' as 'workout' | 'reminder' | 'basic',\n    color: morandiColors[0].value,\n  })\n\n  const handleSubmit = () => {\n    if (!formData.name.trim()) return\n\n    if (editingBox) {\n      updateBox(editingBox, {\n        name: formData.name,\n        type: formData.type,\n        color: formData.color,\n      })\n      setEditingBox(null)\n    } else {\n      createBox({\n        name: formData.name,\n        type: formData.type,\n        color: formData.color,\n        user_id: user?.employee_number || 'guest',\n      })\n    }\n\n    setFormData({\n      name: '',\n      type: 'basic',\n      color: morandiColors[0].value,\n    })\n    setIsCreateDialogOpen(false)\n  }\n\n  const handleEdit = (box: any) => {\n    setFormData({\n      name: box.name,\n      type: box.type,\n      color: box.color,\n    })\n    setEditingBox(box.id)\n    setIsCreateDialogOpen(true)\n  }\n\n  const handleDelete = (id: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç®±å­å—ï¼Ÿ')) {\n      deleteBox(id)\n    }\n  }\n\n  return (\n    <div className=\"w-full bg-white flex flex-col\">\n      {/* æ¨™é¡Œèˆ‡æ–°å¢æŒ‰éˆ• */}\n      <div className=\"p-4 border-b border-gray-200\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-lg font-semibold text-gray-900\">æˆ‘çš„ç®±å­</h2>\n          <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>\n            <DialogTrigger asChild>\n              <Button size=\"sm\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                æ–°å¢ç®±å­\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>\n                  {editingBox ? 'ç·¨è¼¯ç®±å­' : 'æ–°å¢ç®±å­'}\n                </DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                {/* ç®±å­åç¨± */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    ç®±å­åç¨± *\n                  </label>\n                  <Input\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    placeholder=\"è«‹è¼¸å…¥ç®±å­åç¨±\"\n                  />\n                </div>\n\n                {/* ç®±å­é¡å‹ */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    ç®±å­é¡å‹\n                  </label>\n                  <Select\n                    value={formData.type}\n                    onValueChange={(value: 'workout' | 'reminder' | 'basic') =>\n                      setFormData({ ...formData, type: value })\n                    }\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"basic\">æ™®é€šç®±å­</SelectItem>\n                      <SelectItem value=\"workout\">é‡è¨“ç®±å­</SelectItem>\n                      <SelectItem value=\"reminder\">æ–‡å­—æç¤ºç®±å­</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* é¡è‰²é¸æ“‡ */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    é¡è‰²é¸æ“‡\n                  </label>\n                  <ColorPicker\n                    value={formData.color}\n                    onChange={(color) => setFormData({ ...formData, color })}\n                  />\n                </div>\n\n                {/* æŒ‰éˆ• */}\n                <div className=\"flex justify-end space-x-2 pt-4\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setIsCreateDialogOpen(false)\n                      setEditingBox(null)\n                      setFormData({\n                        name: '',\n                        type: 'basic',\n                        color: morandiColors[0].value,\n                      })\n                    }}\n                  >\n                    å–æ¶ˆ\n                  </Button>\n                  <Button onClick={handleSubmit} disabled={!formData.name.trim()}>\n                    {editingBox ? 'æ›´æ–°' : 'å»ºç«‹'}\n                  </Button>\n                </div>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* ç®±å­åˆ—è¡¨ */}\n      <div className=\"flex-1 overflow-y-auto p-4\">\n        {boxes.length === 0 ? (\n          <div className=\"text-center text-gray-500 py-8\">\n            é‚„æ²’æœ‰å»ºç«‹ä»»ä½•ç®±å­\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {boxes.map((box) => {\n              const Icon = typeIcons[box.type]\n              return (\n                <div\n                  key={box.id}\n                  className=\"group relative p-3 rounded-lg border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all duration-200 cursor-move transform hover:scale-105\"\n                  style={{ borderLeftColor: box.color, borderLeftWidth: '4px' }}\n                  draggable\n                  onDragStart={(e) => {\n                    e.dataTransfer.setData('application/json', JSON.stringify({\n                      type: 'box',\n                      boxId: box.id,\n                    }))\n                  }}\n                >\n                  <div className=\"flex items-center space-x-3\">\n                    {/* åœ–ç¤º */}\n                    <div\n                      className=\"w-8 h-8 rounded-md flex items-center justify-center text-white\"\n                      style={{ backgroundColor: box.color }}\n                    >\n                      <Icon className=\"h-4 w-4\" />\n                    </div>\n\n                    {/* ç®±å­è³‡è¨Š */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium text-gray-900 truncate\">\n                        {box.name}\n                      </div>\n                      <div className=\"text-sm text-gray-500\">\n                        {typeLabels[box.type]}\n                      </div>\n                    </div>\n\n                    {/* æ“ä½œæŒ‰éˆ• */}\n                    <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => {\n                          e.stopPropagation()\n                          handleEdit(box)\n                        }}\n                      >\n                        <Edit className=\"h-3 w-3\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => {\n                          e.stopPropagation()\n                          handleDelete(box.id)\n                        }}\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/box-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/create-box-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/review-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/scheduled-box-item.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/statistics-panel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { memo } from 'react'\nimport { useTimeboxStore } from '@/stores/timebox-store'\nimport { Card } from '@/components/ui/card'\n\nfunction StatisticsPanel() {\n  const { getWeekStatistics } = useTimeboxStore()\n  const stats = getWeekStatistics()\n\n  const formatTime = (minutes: number) => {\n    const hours = Math.floor(minutes / 60)\n    const mins = minutes % 60\n    if (hours > 0) {\n      return `${hours}å°æ™‚${mins > 0 ? ` ${mins}åˆ†é˜` : ''}`\n    }\n    return `${mins}åˆ†é˜`\n  }\n\n  const completionRate = stats?.completionRate ?? 0\n  const totalWorkoutTime = stats?.totalWorkoutTime ?? 0\n  const completedByType = stats?.completedByType ?? { workout: 0, reminder: 0, basic: 0 }\n  const totalWorkoutVolume = stats?.totalWorkoutVolume ?? 0\n  const totalWorkoutSessions = stats?.totalWorkoutSessions ?? 0\n\n  const hasWorkoutStats = totalWorkoutSessions > 0 && totalWorkoutVolume > 0\n\n  return (\n    <div className=\"bg-card border-b border-border px-6 py-4\">\n      <div className={`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-${hasWorkoutStats ? '4' : '3'} gap-4`}>\n        {/* å®Œæˆç‡ */}\n        <div className=\"morandi-card p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs sm:text-sm font-medium text-morandi-secondary\">æœ¬é€±å®Œæˆç‡</p>\n              <p className=\"text-lg sm:text-2xl font-bold text-morandi-primary\">\n                {Math.round(completionRate * 100)}%\n              </p>\n            </div>\n            <div className=\"w-8 h-8 sm:w-12 sm:h-12 rounded-full bg-morandi-container flex items-center justify-center\">\n              <div className=\"text-morandi-gold font-semibold text-xs sm:text-base\">\n                {Math.round(completionRate * 100)}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* é‹å‹•æ™‚é–“ */}\n        <div className=\"morandi-card p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-xs sm:text-sm font-medium text-morandi-secondary\">é‹å‹•æ™‚é–“</p>\n              <p className=\"text-lg sm:text-2xl font-bold text-morandi-primary\">\n                <span className=\"hidden sm:inline\">{formatTime(totalWorkoutTime)}</span>\n                <span className=\"sm:hidden\">{Math.floor(totalWorkoutTime / 60)}h</span>\n              </p>\n            </div>\n            <div className=\"w-8 h-8 sm:w-12 sm:h-12 rounded-full bg-morandi-container flex items-center justify-center\">\n              <div className=\"text-morandi-green font-semibold text-xs sm:text-sm\">\n                {Math.floor(totalWorkoutTime / 60)}h\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* å®Œæˆé …ç›®åˆ†å¸ƒ */}\n        <div className=\"morandi-card p-4\">\n          <div>\n            <p className=\"text-xs sm:text-sm font-medium text-morandi-secondary mb-2\">å®Œæˆé …ç›®</p>\n            <div className=\"space-y-1.5\">\n              <div className=\"flex justify-between text-xs sm:text-sm\">\n                <span className=\"text-morandi-secondary\">é‹å‹•</span>\n                <span className=\"font-medium text-morandi-primary\">{completedByType.workout} æ¬¡</span>\n              </div>\n              <div className=\"flex justify-between text-xs sm:text-sm\">\n                <span className=\"text-morandi-secondary\">ä¿é¤Š</span>\n                <span className=\"font-medium text-morandi-primary\">{completedByType.reminder} æ¬¡</span>\n              </div>\n              <div className=\"flex justify-between text-xs sm:text-sm\">\n                <span className=\"text-morandi-secondary\">å…¶ä»–</span>\n                <span className=\"font-medium text-morandi-primary\">{completedByType.basic} æ¬¡</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* é‡è¨“çµ±è¨ˆ */}\n        {hasWorkoutStats && (\n          <div className=\"morandi-card p-4\">\n            <div>\n              <p className=\"text-xs sm:text-sm font-medium text-morandi-secondary mb-2\">é‡è¨“çµ±è¨ˆ</p>\n              <div className=\"space-y-1.5\">\n                <div className=\"flex justify-between text-xs sm:text-sm\">\n                  <span className=\"text-morandi-secondary\">æœ¬é€±è¨“ç·´é‡</span>\n                  <span className=\"font-medium text-morandi-primary\">{totalWorkoutVolume.toLocaleString()} kg</span>\n                </div>\n                <div className=\"flex justify-between text-xs sm:text-sm\">\n                  <span className=\"text-morandi-secondary\">è¨“ç·´æ¬¡æ•¸</span>\n                  <span className=\"font-medium text-morandi-primary\">{totalWorkoutSessions} æ¬¡</span>\n                </div>\n                <div className=\"flex justify-between text-xs sm:text-sm\">\n                  <span className=\"text-morandi-secondary\">å¹³å‡æ¯æ¬¡</span>\n                  <span className=\"font-medium text-morandi-primary\">\n                    {Math.round(totalWorkoutVolume / (totalWorkoutSessions || 1)).toLocaleString()} kg\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default memo(StatisticsPanel)","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/time-grid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isTimeSlotOccupied' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":149,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4958,4961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4958,4961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hour' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":204,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":204,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useTimeboxStore } from '@/stores/timebox-store'\n\nimport ScheduledBoxItem from './scheduled-box-item'\nimport { logger } from '@/lib/utils/logger'\n\ninterface TimeGridProps {\n  weekDays: Date[]\n  timeInterval: 30 | 60\n}\n\nexport default function TimeGrid({ weekDays, timeInterval }: TimeGridProps) {\n  const { scheduledBoxes, addScheduledBox, currentWeek, initializeCurrentWeek, boxes, createBox } = useTimeboxStore()\n\n  // ç”Ÿæˆæ™‚é–“æ®µ - æ ¹æ“š timeInterval å‹•æ…‹ç”Ÿæˆ\n  const timeSlots: string[] = []\n  for (let hour = 6; hour < 24; hour++) {\n    timeSlots.push(`${hour.toString().padStart(2, '0')}:00`)\n    if (timeInterval === 30) {\n      timeSlots.push(`${hour.toString().padStart(2, '0')}:30`)\n    }\n  }\n\n  // æª¢æŸ¥æ™‚é–“è¡çª\n  const hasConflict = (dayOfWeek: number, start_time: string, duration: number) => {\n    const startMinutes = timeToMinutes(start_time)\n    const endMinutes = startMinutes + duration\n\n    return scheduledBoxes.some(box => {\n      if (box.dayOfWeek !== dayOfWeek) return false\n\n      const boxStartMinutes = timeToMinutes(box.start_time)\n      const boxEndMinutes = boxStartMinutes + box.duration\n\n      return (startMinutes < boxEndMinutes && endMinutes > boxStartMinutes)\n    })\n  }\n\n  const timeToMinutes = (time: string) => {\n    const [hours, minutes] = time.split(':').map(Number)\n    return hours * 60 + minutes\n  }\n\n  const minutesToTime = (minutes: number) => {\n    const hours = Math.floor(minutes / 60)\n    const mins = minutes % 60\n    return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`\n  }\n\n  // é€±é–‹å§‹è¨ˆç®—å‡½æ•¸ï¼ˆèˆ‡é é¢ä¸­çš„ä¿æŒä¸€è‡´ï¼‰\n  const getWeekStart = (date: Date) => {\n    const d = new Date(date)\n    const day = d.getDay()\n    const diff = d.getDate() - day + (day === 0 ? -6 : 1) // èª¿æ•´ç‚ºé€±ä¸€é–‹å§‹\n    return new Date(d.setDate(diff))\n  }\n\n  // ç°¡å–®çš„ ID ç”Ÿæˆå™¨\n  const generateId = () => {\n    return Date.now().toString(36) + Math.random().toString(36).substr(2)\n  }\n\n  // ç²å–æˆ–å‰µå»ºé è¨­çš„æ™®é€šç®±å­\n  const getDefaultBasicBox = () => {\n    // å°‹æ‰¾å·²å­˜åœ¨çš„æ™®é€šç®±å­\n    let basicBox = boxes.find(box => box.type === 'basic')\n\n    // å¦‚æœæ²’æœ‰ï¼Œå‰µå»ºä¸€å€‹é è¨­çš„æ™®é€šç®±å­\n    if (!basicBox) {\n      createBox({\n        name: 'æ—¥å¸¸å®‰æ’',\n        color: '#D4D4D4', // é›²çŸ³ç°\n        type: 'basic',\n        user_id: 'current-user',\n      })\n      // é‡æ–°ç²å–\n      basicBox = boxes.find(box => box.type === 'basic')\n    }\n\n    return basicBox\n  }\n\n  // ç›´æ¥æ–°å¢æ™®é€šç®±å­åˆ°æ™‚é–“æ ¼\n  const handleAddBasicBox = (dayOfWeek: number, start_time: string) => {\n    // ç¢ºä¿æœ‰ currentWeek\n    let weekId = currentWeek?.id\n    if (!currentWeek) {\n      const weekDays = []\n      const today = new Date()\n      const weekStart = getWeekStart(today)\n\n      for (let i = 0; i < 7; i++) {\n        const day = new Date(weekStart)\n        day.setDate(weekStart.getDate() + i)\n        weekDays.push(day)\n      }\n\n      initializeCurrentWeek(weekDays[0])\n      weekId = generateId()\n    }\n\n    // ç²å–é è¨­æ™®é€šç®±å­\n    const basicBox = getDefaultBasicBox()\n    if (!basicBox) return\n\n    // é è¨­æ™‚é•·ä½¿ç”¨ç•¶å‰çš„æ™‚é–“é–“éš”\n    const defaultDuration = timeInterval\n\n    // æª¢æŸ¥è¡çª\n    if (hasConflict(dayOfWeek, start_time, defaultDuration)) {\n      alert('æ­¤æ™‚æ®µå·²æœ‰å…¶ä»–ç®±å­ï¼Œè«‹é¸æ“‡å…¶ä»–æ™‚é–“')\n      return\n    }\n\n    // ç›´æ¥æ–°å¢ç®±å­\n    addScheduledBox({\n      boxId: basicBox.id,\n      weekId: weekId || generateId(),\n      dayOfWeek,\n      start_time,\n      duration: defaultDuration,\n      completed: false,\n    })\n  }\n\n  // ç²å–å–®å…ƒæ ¼ä¸­çš„ç®±å­ï¼ˆèµ·å§‹æ™‚æ®µï¼‰\n  const getBoxesInCell = (dayOfWeek: number, timeSlot: string) => {\n    // 30 åˆ†é˜è¦–åœ–ï¼šåªè¿”å›ç²¾ç¢ºåŒ¹é…çš„ç®±å­\n    if (timeInterval === 30) {\n      const box = scheduledBoxes.find(box =>\n        box.dayOfWeek === dayOfWeek && box.start_time === timeSlot\n      )\n      return box ? [box] : []\n    }\n\n    // 60 åˆ†é˜è¦–åœ–ï¼šè¿”å›é€™å€‹å°æ™‚å…§æ‰€æœ‰é–‹å§‹çš„ç®±å­\n    const currentMinutes = timeToMinutes(timeSlot)\n    const nextHourMinutes = currentMinutes + 60\n\n    return scheduledBoxes.filter(box => {\n      if (box.dayOfWeek !== dayOfWeek) return false\n      const boxStartMinutes = timeToMinutes(box.start_time)\n      return boxStartMinutes >= currentMinutes && boxStartMinutes < nextHourMinutes\n    })\n  }\n\n  // æª¢æŸ¥æ™‚æ®µæ˜¯å¦è¢«ä»»ä½•ç®±å­ä½”ç”¨\n  const isTimeSlotOccupied = (dayOfWeek: number, timeSlot: string) => {\n    const currentMinutes = timeToMinutes(timeSlot)\n\n    return scheduledBoxes.some(box => {\n      if (box.dayOfWeek !== dayOfWeek) return false\n\n      const boxStartMinutes = timeToMinutes(box.start_time)\n      const boxEndMinutes = boxStartMinutes + box.duration\n\n      return currentMinutes >= boxStartMinutes && currentMinutes < boxEndMinutes\n    })\n  }\n\n  // ç²å–ä½”ç”¨æ­¤æ™‚æ®µçš„ç®±å­\n  const getOccupyingBox = (dayOfWeek: number, timeSlot: string) => {\n    const currentMinutes = timeToMinutes(timeSlot)\n\n    return scheduledBoxes.find(box => {\n      if (box.dayOfWeek !== dayOfWeek) return false\n\n      const boxStartMinutes = timeToMinutes(box.start_time)\n      const boxEndMinutes = boxStartMinutes + box.duration\n\n      return currentMinutes >= boxStartMinutes && currentMinutes < boxEndMinutes\n    })\n  }\n\n  // åˆ¤æ–·ç®±å­åœ¨æ­¤æ™‚æ®µçš„ä½ç½®é¡å‹\n  const getBoxPositionType = (scheduledBox: any, timeSlot: string) => {\n    const currentMinutes = timeToMinutes(timeSlot)\n    const boxStartMinutes = timeToMinutes(scheduledBox.start_time)\n    const boxEndMinutes = boxStartMinutes + scheduledBox.duration\n\n    if (currentMinutes === boxStartMinutes) return 'start'\n    if (currentMinutes + timeInterval === boxEndMinutes) return 'end'\n    return 'middle'\n  }\n\n  // è¨ˆç®—ç®±å­é«˜åº¦\n  const getBoxHeight = (duration: number) => {\n    // æ¯æ ¼çš„é«˜åº¦ï¼ˆæ ¹æ“šè¦–åœ–æ¨¡å¼ï¼‰\n    const slotHeight = timeInterval === 30 ? 32 : 64 // 30åˆ†=32px, 60åˆ†=64px\n\n    // è¨ˆç®—ä½”ç”¨å¹¾æ ¼\n    const slotsNeeded = duration / timeInterval\n\n    return slotsNeeded * slotHeight\n  }\n\n  // è¨ˆç®—ç®±å­åœ¨æ ¼å­å…§çš„ top åç§»é‡\n  const getBoxTopOffset = (start_time: string) => {\n    // åœ¨ 30 åˆ†é˜è¦–åœ–ä¸‹ï¼Œæ¯å€‹ç®±å­éƒ½åœ¨æ ¼å­é ‚éƒ¨\n    if (timeInterval === 30) return 0\n\n    // åœ¨ 60 åˆ†é˜è¦–åœ–ä¸‹ï¼Œéœ€è¦è¨ˆç®—ç®±å­åœ¨æ•´é»æ ¼å­å…§çš„åç§»\n    const [hour, minute] = start_time.split(':').map(Number)\n\n    // å¦‚æœæ˜¯æ•´é»ï¼ˆ:00ï¼‰ï¼Œåœ¨æ ¼å­é ‚éƒ¨\n    if (minute === 0) return 0\n\n    // å¦‚æœæ˜¯åŠé»ï¼ˆ:30ï¼‰ï¼Œåœ¨æ ¼å­ä¸­é–“ï¼ˆåç§» 32pxï¼‰\n    if (minute === 30) return 32\n\n    // å…¶ä»–æƒ…æ³æŒ‰æ¯”ä¾‹è¨ˆç®—\n    return (minute / 60) * 64\n  }\n\n  return (\n    <div className=\"relative\">\n      <div className=\"grid grid-cols-8 min-h-[600px]\">\n        {/* æ™‚é–“è»¸ */}\n        <div className=\"border-r border-border bg-morandi-container/10\">\n          {timeSlots.map((timeSlot) => (\n            <div\n              key={timeSlot}\n              className={`${timeInterval === 30 ? 'h-8' : 'h-16'} flex items-center justify-center text-xs sm:text-sm text-morandi-secondary border-b border-border/50`}\n            >\n              {timeSlot}\n            </div>\n          ))}\n        </div>\n\n        {/* æ—¥æœŸåˆ— */}\n        {weekDays.map((day, dayIndex) => (\n          <div key={dayIndex} className=\"border-r border-border last:border-r-0 relative bg-card\">\n            {timeSlots.map((timeSlot, timeIndex) => {\n              const boxesInCell = getBoxesInCell(dayIndex, timeSlot)\n              const occupyingBox = getOccupyingBox(dayIndex, timeSlot)\n              const isOccupied = !!occupyingBox\n              const hasBoxes = boxesInCell.length > 0\n\n              // å¦‚æœæ™‚æ®µè¢«ä½”ç”¨ä½†ä¸æ˜¯èµ·å§‹æ ¼ï¼ˆ30åˆ†é˜è¦–åœ–çš„ä¸­é–“éƒ¨åˆ†ï¼‰ï¼Œæ¸²æŸ“ä½”ä½\n              if (isOccupied && !hasBoxes && timeInterval === 30) {\n                const baseBox = boxes.find(b => b.id === occupyingBox.boxId)\n                const positionType = getBoxPositionType(occupyingBox, timeSlot)\n\n                const borderRadius = positionType === 'start' ? 'rounded-t-md' :\n                                    positionType === 'end' ? 'rounded-b-md' : ''\n\n                return (\n                  <div\n                    key={`${dayIndex}-${timeIndex}`}\n                    className={`h-8 border-b border-border/50 relative cursor-pointer ${borderRadius}`}\n                    style={{ backgroundColor: baseBox?.color }}\n                    onClick={() => {\n                      // é»æ“Šä¸­é–“éƒ¨åˆ†ï¼Œé€šé window äº‹ä»¶é€šçŸ¥æ‰“é–‹å°è©±æ¡†\n                      window.dispatchEvent(new CustomEvent('openBoxDialog', {\n                        detail: { scheduledBoxId: occupyingBox.id }\n                      }))\n                    }}\n                  >\n                    {/* ä¸­é–“å’Œçµå°¾éƒ¨åˆ†å¯ä»¥é¡¯ç¤ºç°¡åŒ–è³‡è¨Š */}\n                    {positionType === 'end' && (\n                      <div className=\"absolute bottom-1 right-2 text-xs text-white opacity-75\">\n                        {minutesToTime(timeToMinutes(occupyingBox.start_time) + occupyingBox.duration)}\n                      </div>\n                    )}\n                  </div>\n                )\n              }\n\n              return (\n                <div\n                  key={`${dayIndex}-${timeIndex}`}\n                  className={`${timeInterval === 30 ? 'h-8' : 'h-16'} border-b border-border/50 relative cursor-pointer hover:bg-morandi-container/20 transition-colors duration-150`}\n                  onClick={() => {\n                    if (!isOccupied) {\n                      handleAddBasicBox(dayIndex, timeSlot)\n                    }\n                  }}\n                >\n                  {/* æ¸²æŸ“é€™å€‹æ ¼å­å…§æ‰€æœ‰çš„ç®±å­ */}\n                  {boxesInCell.map((box) => (\n                    <ScheduledBoxItem\n                      key={box.id}\n                      scheduledBox={box}\n                      height={getBoxHeight(box.duration)}\n                      topOffset={getBoxTopOffset(box.start_time)}\n                    />\n                  ))}\n                </div>\n              )\n            })}\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/components/week-view.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/timebox/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/todos/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Suspense' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTrigger' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":92},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronDown' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":54},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Receipt' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":69},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":71,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":79},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":86},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserPlus' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":100,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":108},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":110,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":121},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Grid3x3' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":138,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":145},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'List' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":147,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":151},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":153,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":159},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Cloud' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":161,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":166},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CloudOff' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":168,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":176},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":178,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":187},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":189,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":193},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7123,7126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7123,7126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7935,7938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7935,7938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9767,9770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9767,9770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":387,"column":17,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":387,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":408,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":408,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13584,13587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13584,13587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, useMemo, useCallback, Suspense } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from '@/components/ui/dialog';\nimport { useTodoStore } from '@/stores';\nimport { useUserStore } from '@/stores/user-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { CheckCircle, Clock, Calendar, ChevronDown, X, Star, Receipt, FileText, Users, DollarSign, UserPlus, AlertCircle, Trash2, Edit2, Grid3x3, List, Search, Cloud, CloudOff, RefreshCw, Plus } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/utils/logger';\nimport { EnhancedTable } from '@/components/ui/enhanced-table';\nimport { TodoExpandedView } from '@/components/todos/todo-expanded-view';\nimport { StarRating } from '@/components/ui/star-rating';\nimport { Todo } from '@/stores/types';\n\nexport const dynamic = 'force-dynamic';\n\n\nconst statusFilters = [\n  { value: 'all', label: 'å…¨éƒ¨' },\n  { value: 'pending', label: 'å¾…è¾¦' },\n  { value: 'in_progress', label: 'é€²è¡Œä¸­' },\n  { value: 'completed', label: 'å®Œæˆ' }\n];\n\nexport default function TodosPage() {\n  const todoStore = useTodoStore();\n  const todos = todoStore.items;\n  const { create: addTodo, update: updateTodo, delete: deleteTodo, fetchAll } = todoStore;\n  const { user } = useAuthStore(); // å–å¾—ç•¶å‰ç™»å…¥ç”¨æˆ¶\n  const searchParams = useSearchParams();\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [expandedTodo, setExpandedTodo] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [isLoading, setIsLoading] = useState(false); // ä½¿ç”¨å¿«å–è³‡æ–™ï¼Œä¸éœ€è¦è¼‰å…¥\n  const [isSubmitting, setIsSubmitting] = useState(false); // é˜²æ­¢é‡è¤‡æäº¤\n  const [isComposing, setIsComposing] = useState(false); // ä¸­æ–‡è¼¸å…¥æ³•ç‹€æ…‹\n\n  // è¼‰å…¥å¾…è¾¦äº‹é …è³‡æ–™\n  useEffect(() => {\n    fetchAll();\n  }, [fetchAll]);\n\n  // è™•ç†å¾å…¶ä»–é é¢è·³è½‰ä¾†çš„æƒ…æ³\n  useEffect(() => {\n    const expandId = searchParams.get('expand');\n    if (expandId) {\n      setExpandedTodo(expandId);\n    }\n  }, [searchParams]);\n\n  // ç¯©é¸å¾…è¾¦ - ä½¿ç”¨ useMemo å„ªåŒ–\n  const filteredTodos = useMemo(() => {\n    if (!todos || !Array.isArray(todos)) return [];\n    const currentUserId = user?.id;\n\n    return todos.filter(todo => {\n      // âœ… å¯è¦‹æ€§ç¯©é¸ - åªé¡¯ç¤ºç•¶å‰ç”¨æˆ¶ç›¸é—œçš„å¾…è¾¦\n      if (currentUserId) {\n        const isCreator = todo.creator === currentUserId;\n        const isAssignee = todo.assignee === currentUserId;\n        const inVisibility = todo.visibility?.includes(currentUserId);\n\n        // å¿…é ˆæ˜¯å»ºç«‹è€…ã€è¢«æŒ‡æ´¾è€…æˆ–åœ¨å¯è¦‹åˆ—è¡¨ä¸­\n        if (!isCreator && !isAssignee && !inVisibility) {\n          return false;\n        }\n      }\n\n      // ç‹€æ…‹ç¯©é¸\n      if (statusFilter !== 'all' && todo.status !== statusFilter) return false;\n\n      // æœå°‹ç¯©é¸\n      if (searchTerm && !todo.title.toLowerCase().includes(searchTerm.toLowerCase())) return false;\n\n      return true;\n    });\n  }, [todos, statusFilter, searchTerm, user?.id]);\n\n  // ç‹€æ…‹æ¨™ç±¤ - ä½¿ç”¨ useCallback å„ªåŒ–\n  const getStatusLabel = useCallback((status: Todo['status']) => {\n    const statusMap = {\n      pending: 'å¾…è¾¦',\n      in_progress: 'é€²è¡Œä¸­',\n      completed: 'å®Œæˆ',\n      cancelled: 'å–æ¶ˆ'\n    };\n    return statusMap[status];\n  }, []);\n\n  // ç‹€æ…‹é¡è‰² - ä½¿ç”¨ useCallback å„ªåŒ–\n  const getStatusColor = useCallback((status: Todo['status']) => {\n    const colorMap = {\n      pending: 'text-morandi-muted',\n      in_progress: 'text-blue-600',\n      completed: 'text-green-600',\n      cancelled: 'text-morandi-red'\n    };\n    return colorMap[status];\n  }, []);\n\n  // æˆªæ­¢æ—¥æœŸé¡è‰² - ä½¿ç”¨ useCallback å„ªåŒ–\n  const getDeadlineColor = useCallback((deadline?: string) => {\n    if (!deadline) return 'text-morandi-secondary';\n\n    const deadlineDate = new Date(deadline);\n    const today = new Date();\n    const diffDays = Math.ceil((deadlineDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n\n    if (diffDays < 0) return 'text-morandi-red'; // é€¾æœŸ\n    if (diffDays === 0) return 'text-orange-500'; // ä»Šå¤©\n    if (diffDays <= 3) return 'text-yellow-600'; // 3å¤©å…§\n    return 'text-morandi-secondary'; // å……è£•\n  }, []);\n\n  const columns = [\n    {\n      key: 'title',\n      label: 'ä»»å‹™æ¨™é¡Œ',\n      sortable: true,\n      render: (value: string, todo: Todo) => (\n        <div>\n          <div className=\"text-sm font-medium text-morandi-primary\">{value}</div>\n          {todo.related_items && todo.related_items.length > 0 && (\n            <div className=\"flex gap-1 mt-1\">\n              {todo.related_items.map((item, index) => (\n                <button\n                  key={index}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    const basePath = {\n                      'group': '/tours',\n                      'quote': '/quotes',\n                      'order': '/orders',\n                      'invoice': '/finance/treasury/disbursement',\n                      'receipt': '/finance/payments'\n                    }[item.type];\n                    if (basePath) {\n                      window.location.href = `${basePath}?highlight=${item.id}`;\n                    }\n                  }}\n                  className=\"text-xs bg-morandi-gold/20 text-morandi-primary px-2 py-0.5 rounded hover:bg-morandi-gold/30 transition-colors\"\n                >\n                  {item.title}\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n      )\n    },\n    {\n      key: 'priority',\n      label: 'å„ªå…ˆç´š',\n      sortable: true,\n      render: (value: number, todo: Todo) => (\n        <StarRating value={todo.priority} readonly size=\"sm\" />\n      )\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      render: (value: Todo['status']) => (\n        <span className={cn('text-sm font-medium', getStatusColor(value))}>\n          {getStatusLabel(value)}\n        </span>\n      )\n    },\n    {\n      key: 'deadline',\n      label: 'æœŸé™',\n      sortable: true,\n      render: (value: string) => (\n        <div className=\"flex items-center gap-2\">\n          <Calendar size={14} className=\"text-morandi-secondary\" />\n          <span className={cn('text-sm', getDeadlineColor(value))}>\n            {value ? new Date(value).toLocaleDateString() : 'æœªè¨­å®š'}\n          </span>\n        </div>\n      )\n    }\n  ];\n\n  const handleRowClick = useCallback((todo: Todo) => {\n    setExpandedTodo(todo.id);\n  }, []);\n\n  const handleDeleteTodo = useCallback((todo: Todo, e?: React.MouseEvent) => {\n    if (e) e.stopPropagation();\n\n    const confirmMessage = `ç¢ºå®šè¦åˆªé™¤å¾…è¾¦äº‹é …ã€Œ${todo.title}ã€å—ï¼Ÿ\\n\\næ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`;\n\n    if (!confirm(confirmMessage)) {\n      return;\n    }\n\n    try {\n      deleteTodo(todo.id);\n      // å¦‚æœæ­£åœ¨é¡¯ç¤ºè©²å¾…è¾¦çš„è©³ç´°æª¢è¦–ï¼Œé—œé–‰å®ƒ\n      if (expandedTodo === todo.id) {\n        setExpandedTodo(null);\n      }\n    } catch (err) {\n      logger.error('åˆªé™¤å¾…è¾¦äº‹é …å¤±æ•—:', err);\n      alert('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  }, [deleteTodo, expandedTodo]);\n\n  const handleAddTodo = useCallback(async (formData: any) => {\n    if (!user?.id) {\n      alert('è«‹å…ˆç™»å…¥');\n      return;\n    }\n\n    try {\n      // è¨ˆç®— visibility - åŒ…å«å»ºç«‹è€…å’Œè¢«æŒ‡æ´¾è€…\n      const visibilityList = [user.id];\n      if (formData.assignee && formData.assignee !== user.id) {\n        visibilityList.push(formData.assignee);\n      }\n\n      const newTodoData = {\n        title: formData.title,\n        priority: formData.priority,\n        deadline: formData.deadline,\n        status: 'pending' as const,\n        completed: false,\n        creator: user.id, // âœ… ä½¿ç”¨ç•¶å‰ç™»å…¥ç”¨æˆ¶\n        assignee: formData.assignee || null,\n        visibility: visibilityList, // âœ… åŒ…å«å»ºç«‹è€…å’Œè¢«æŒ‡æ´¾è€…\n        related_items: [],\n        sub_tasks: [],\n        notes: [],\n        enabled_quick_actions: formData.enabled_quick_actions || ['receipt', 'quote']\n      };\n\n      await addTodo(newTodoData as any);\n      setIsAddDialogOpen(false);\n    } catch (error) {\n      logger.error('æ–°å¢å¾…è¾¦äº‹é …å¤±æ•—:', error);\n      alert('æ–°å¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  }, [addTodo, user?.id]);\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"å¾…è¾¦äº‹é …\"\n        showSearch={true}\n        searchTerm={searchTerm}\n        onSearchChange={setSearchTerm}\n        searchPlaceholder=\"æœå°‹ä»»å‹™...\"\n        onAdd={() => setIsAddDialogOpen(true)}\n        addLabel=\"æ–°å¢ä»»å‹™\"\n        actions={\n          <Input\n            placeholder=\"å¿«é€Ÿæ–°å¢... (Enter)\"\n            className=\"w-64\"\n            onCompositionStart={() => setIsComposing(true)}\n            onCompositionEnd={() => setIsComposing(false)}\n            onKeyDown={async (e) => {\n              // å¦‚æœæ­£åœ¨ä½¿ç”¨è¼¸å…¥æ³•ï¼ˆå¦‚æ³¨éŸ³ã€æ‹¼éŸ³ï¼‰ï¼Œä¸è¦è§¸ç™¼æ–°å¢\n              if (e.key === 'Enter' && e.currentTarget.value.trim() && !isSubmitting && !isComposing) {\n                e.preventDefault();\n                if (!user?.id) {\n                  alert('è«‹å…ˆç™»å…¥');\n                  return;\n                }\n                const title = e.currentTarget.value.trim();\n                const inputElement = e.currentTarget;\n                inputElement.value = '';\n                setIsSubmitting(true);\n\n                const newTodoData = {\n                  title,\n                  priority: 3 as 1 | 2 | 3 | 4 | 5,\n                  deadline: '',\n                  status: 'pending' as const,\n                  completed: false,\n                  creator: user.id,\n                  assignee: null,\n                  visibility: [user.id],\n                  related_items: [],\n                  sub_tasks: [],\n                  notes: [],\n                  enabled_quick_actions: ['receipt', 'quote'] as ('receipt' | 'quote')[]\n                };\n\n                try {\n                  await addTodo(newTodoData as any);\n                  logger.log('âœ… å¾…è¾¦äº‹é …æ–°å¢æˆåŠŸ');\n                } catch (error) {\n                  logger.error('å¿«é€Ÿæ–°å¢å¤±æ•—:', error);\n                  if (inputElement) {\n                    inputElement.value = title;\n                  }\n                  alert('æ–°å¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n                } finally {\n                  setIsSubmitting(false);\n                }\n              }\n            }}\n          />\n        }\n      >\n        {/* ç‹€æ…‹ç¯©é¸ */}\n        <div className=\"flex gap-2\">\n          {statusFilters.map((filter) => (\n            <button\n              key={filter.value}\n              onClick={() => setStatusFilter(filter.value)}\n              className={cn(\n                'px-3 py-1 rounded-lg text-sm font-medium transition-colors',\n                statusFilter === filter.value\n                  ? 'bg-morandi-gold text-white'\n                  : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/30'\n              )}\n            >\n              {filter.label}\n            </button>\n          ))}\n        </div>\n      </ResponsiveHeader>\n\n      {/* å¾…è¾¦äº‹é …åˆ—è¡¨ */}\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n          columns={columns}\n          data={filteredTodos}\n          onRowClick={handleRowClick}\n          actions={(todo: Todo) => (\n            <div className=\"flex items-center gap-1\">\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  const newStatus = todo.status === 'completed' ? 'pending' : 'completed';\n                  updateTodo(todo.id, {\n                    status: newStatus,\n                    completed: newStatus === 'completed'\n                  });\n                }}\n                className={cn(\n                  \"p-1 rounded transition-colors\",\n                  todo.status === 'completed'\n                    ? \"text-green-600 hover:text-green-700 hover:bg-green-50\"\n                    : \"text-morandi-secondary hover:text-green-600 hover:bg-green-50\"\n                )}\n                title={todo.status === 'completed' ? 'å–æ¶ˆå®Œæˆ' : 'æ¨™è¨˜å®Œæˆ'}\n              >\n                <CheckCircle size={14} />\n              </button>\n              <button\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setExpandedTodo(todo.id);\n                }}\n                className=\"p-1 hover:bg-morandi-gold/10 rounded transition-colors\"\n                title=\"ç·¨è¼¯\"\n              >\n                <Edit2 size={14} />\n              </button>\n              <button\n                onClick={(e) => handleDeleteTodo(todo, e)}\n                className=\"p-1 text-morandi-red hover:bg-morandi-red/10 rounded transition-colors\"\n                title=\"åˆªé™¤\"\n              >\n                <Trash2 size={14} />\n              </button>\n            </div>\n          )}\n          searchableFields={['title']}\n          searchTerm={searchTerm}\n          showFilters={false}\n          initialPageSize={15}\n        />\n      </div>\n\n      {/* å±•é–‹çš„å¾…è¾¦äº‹é …è¦–åœ– */}\n      {expandedTodo && (\n        <TodoExpandedView\n          todo={todos.find(t => t.id === expandedTodo)!}\n          onUpdate={(updates) => updateTodo(expandedTodo, updates)}\n          onClose={() => setExpandedTodo(null)}\n        />\n      )}\n\n      {/* æ–°å¢å¾…è¾¦äº‹é …å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢å¾…è¾¦äº‹é …</DialogTitle>\n            <DialogDescription>å»ºç«‹æ–°çš„å¾…è¾¦ä»»å‹™ï¼Œè¨­å®šå„ªå…ˆç´šå’Œæˆªæ­¢æ—¥æœŸ</DialogDescription>\n          </DialogHeader>\n          <AddTodoForm onSubmit={handleAddTodo} onCancel={() => setIsAddDialogOpen(false)} />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n// æ–°å¢å¾…è¾¦äº‹é …è¡¨å–®çµ„ä»¶\nfunction AddTodoForm({ onSubmit, onCancel }: { onSubmit: (data: any) => void; onCancel: () => void }) {\n  const { items: users, fetchAll: loadUsersFromDatabase } = useUserStore();\n  const [isLoadingUsers, setIsLoadingUsers] = useState(false);\n  const [formData, setFormData] = useState({\n    title: '',\n    priority: 3 as 1 | 2 | 3 | 4 | 5,\n    deadline: '',\n    assignee: '',\n    enabled_quick_actions: ['receipt', 'quote'] as ('receipt' | 'invoice' | 'group' | 'quote' | 'assign')[]\n  });\n\n  // ç•¶é»æ“Šæˆ–èšç„¦æŒ‡æ´¾é¸å–®æ™‚ï¼Œæ‰è¼‰å…¥å“¡å·¥è³‡æ–™\n  const handleAssigneeDropdownFocus = async () => {\n    if (users.length === 0 && !isLoadingUsers) {\n      setIsLoadingUsers(true);\n      try {\n        await loadUsersFromDatabase();\n      } catch (error) {\n        logger.error('è¼‰å…¥å“¡å·¥è³‡æ–™å¤±æ•—:', error);\n      } finally {\n        setIsLoadingUsers(false);\n      }\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.title.trim()) return;\n    onSubmit(formData);\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div>\n        <label className=\"block text-sm font-medium text-morandi-primary mb-1\">ä»»å‹™æ¨™é¡Œ</label>\n        <Input\n          value={formData.title}\n          onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n          placeholder=\"è¼¸å…¥ä»»å‹™æ¨™é¡Œ...\"\n          required\n        />\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-morandi-primary mb-1\">ç·Šæ€¥åº¦</label>\n        <StarRating\n          value={formData.priority}\n          onChange={(value) => setFormData({ ...formData, priority: value as 1 | 2 | 3 | 4 | 5 })}\n        />\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-morandi-primary mb-1\">æœŸé™</label>\n        <Input\n          type=\"date\"\n          value={formData.deadline}\n          onChange={(e) => setFormData({ ...formData, deadline: e.target.value })}\n        />\n      </div>\n\n      <div>\n        <label className=\"block text-sm font-medium text-morandi-primary mb-1\">æŒ‡æ´¾çµ¦ï¼ˆå¯é¸ï¼‰</label>\n        <select\n          value={formData.assignee}\n          onChange={(e) => setFormData({ ...formData, assignee: e.target.value })}\n          onFocus={handleAssigneeDropdownFocus}\n          className=\"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-morandi-primary\"\n          disabled={isLoadingUsers}\n        >\n          <option value=\"\">\n            {isLoadingUsers ? 'è¼‰å…¥å“¡å·¥è³‡æ–™ä¸­...' : 'ä¸æŒ‡æ´¾ï¼ˆå€‹äººä»»å‹™ï¼‰'}\n          </option>\n          {users && users.map((user) => (\n            <option key={user.id} value={user.id}>\n              {user.display_name} ({user.employee_number})\n            </option>\n          ))}\n        </select>\n      </div>\n\n      <div className=\"flex gap-2 pt-4\">\n        <Button type=\"submit\" className=\"flex-1\">\n          å»ºç«‹ä»»å‹™\n        </Button>\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n          å–æ¶ˆ\n        </Button>\n      </div>\n    </form>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/tours/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1670,1673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1670,1673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { useTourStore } from '@/stores';\nimport { TourOverview } from '@/components/tours/tour-overview';\nimport { TourOrders } from '@/components/tours/tour-orders';\nimport { TourMembers } from '@/components/tours/tour-members';\nimport { TourOperations } from '@/components/tours/tour-operations';\nimport { TourPayments } from '@/components/tours/tour-payments';\nimport { TourCosts } from '@/components/tours/tour-costs';\nimport { TourDocuments } from '@/components/tours/tour-documents';\nimport { TourAddOns } from '@/components/tours/tour-add-ons';\nimport { TourRefunds } from '@/components/tours/tour-refunds';\n\nconst tabs = [\n  { value: 'overview', label: 'ç¸½è¦½' },\n  { value: 'orders', label: 'è¨‚å–®ç®¡ç†' },\n  { value: 'members', label: 'åœ˜å“¡åå–®' },\n  { value: 'operations', label: 'åœ˜å‹™' },\n  { value: 'addons', label: 'åŠ è³¼' },\n  { value: 'refunds', label: 'é€€è²»' },\n  { value: 'payments', label: 'æ”¶æ¬¾ç´€éŒ„' },\n  { value: 'costs', label: 'æˆæœ¬æ”¯å‡º' },\n  { value: 'documents', label: 'æ–‡ä»¶ç¢ºèª' },\n];\n\nexport default function TourDetailPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { items: tours } = useTourStore();\n  const [activeTab, setActiveTab] = useState('overview');\n  const [triggerAddOnAdd, setTriggerAddOnAdd] = useState(false);\n  const [triggerPaymentAdd, setTriggerPaymentAdd] = useState(false);\n  const [triggerRefundAdd, setTriggerRefundAdd] = useState(false);\n\n  const tour = tours.find((t: any) => t.id === params.id);\n\n  if (!tour) {\n    return (\n      <div className=\"p-6\">\n        <ContentContainer>\n          <div className=\"text-center py-12\">\n            <p className=\"text-morandi-secondary\">æ‰¾ä¸åˆ°æŒ‡å®šçš„æ—…éŠåœ˜</p>\n          </div>\n        </ContentContainer>\n      </div>\n    );\n  }\n\n  // çµ±ä¸€çš„æŒ‰éˆ•é…ç½®\n  const getButtonConfig = () => {\n    // æ ¹æ“šåˆ†é æ±ºå®šæŒ‰éˆ•æ–‡å­—å’ŒåŠŸèƒ½\n    const getButtonLabel = () => {\n      switch (activeTab) {\n        case 'overview':\n          return 'ç·¨è¼¯';\n        case 'operations':\n          return 'æ–°å¢æ¬„ä½';\n        case 'addons':\n          return 'æ–°å¢åŠ è³¼';\n        case 'payments':\n          return 'æ–°å¢æ”¶æ¬¾';\n        case 'costs':\n          return 'æ–°å¢æˆæœ¬';\n        case 'refunds':\n          return 'æ–°å¢é€€è²»';\n        case 'orders':\n          return 'æ–°å¢è¨‚å–®';\n        case 'members':\n          return 'æ–°å¢åœ˜å“¡';\n        default:\n          return null; // ä¸é¡¯ç¤ºæŒ‰éˆ•\n      }\n    };\n\n    const buttonLabel = getButtonLabel();\n    if (!buttonLabel) return null;\n\n    return {\n      onAdd: () => {\n        // æ ¹æ“šä¸åŒåˆ†é åŸ·è¡Œä¸åŒçš„é‚è¼¯\n        switch (activeTab) {\n          case 'overview':\n            // TODO: ç·¨è¼¯æ—…éŠåœ˜åŸºæœ¬è³‡æ–™\n            console.log('ç·¨è¼¯æ—…éŠåœ˜:', tour.id);\n            break;\n          case 'operations':\n            // TODO: æ–°å¢åœ˜å‹™æ¬„ä½\n            break;\n          case 'addons':\n            setTriggerAddOnAdd(true);\n            break;\n          case 'payments':\n            setTriggerPaymentAdd(true);\n            break;\n          case 'costs':\n            // TODO: æ–°å¢æˆæœ¬æ”¯å‡º\n            break;\n          case 'refunds':\n            setTriggerRefundAdd(true);\n            break;\n          case 'orders':\n            // TODO: æ–°å¢è¨‚å–®\n            break;\n          case 'members':\n            // TODO: æ–°å¢åœ˜å“¡\n            break;\n        }\n      },\n      addLabel: buttonLabel\n    };\n  };\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case 'overview':\n        return <TourOverview tour={tour} />;\n      case 'orders':\n        return <TourOrders tour={tour} />;\n      case 'members':\n        return <TourMembers tour={tour} />;\n      case 'operations':\n        return <TourOperations tour={tour} />;\n      case 'addons':\n        return <TourAddOns tour={tour} triggerAdd={triggerAddOnAdd} onTriggerAddComplete={() => setTriggerAddOnAdd(false)} />;\n      case 'refunds':\n        return <TourRefunds tour={tour} triggerAdd={triggerRefundAdd} onTriggerAddComplete={() => setTriggerRefundAdd(false)} />;\n      case 'payments':\n        return <TourPayments tour={tour} triggerAdd={triggerPaymentAdd} onTriggerAddComplete={() => setTriggerPaymentAdd(false)} />;\n      case 'costs':\n        return <TourCosts tour={tour} />;\n      case 'documents':\n        return <TourDocuments tour={tour} />;\n      default:\n        return <TourOverview tour={tour} />;\n    }\n  };\n\n  const buttonConfig = getButtonConfig();\n\n  return (\n    <>\n      <ResponsiveHeader\n        title={`${tour.name} (${tour.code})`}\n        tabs={tabs}\n        activeTab={activeTab}\n        onTabChange={setActiveTab}\n        showBackButton={true}\n        onBack={() => router.push('/tours')}\n        {...(buttonConfig ? { onAdd: buttonConfig.onAdd, addLabel: buttonConfig.addLabel } : {})}\n      />\n\n      <ContentContainer>\n        {renderTabContent()}\n      </ContentContainer>\n    </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/tours/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileX' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":143,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":148},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":167,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":173},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Grid3x3' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":175,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":182},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'List' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":184,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":188},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Combobox' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TourCard' is defined but never used. Allowed unused vars must match /^_/u.","line":32,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tourStore' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":67,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3802,3805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3802,3805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedTour' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":92,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedRows' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":98,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":98,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedRows' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":98,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":98,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":101,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setViewMode' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":101,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'totalCount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":116,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":116,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":50},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6801,6804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6801,6804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":372,"column":11,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":372,"endColumn":34},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":375,"column":11,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":375,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":533,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18155,18158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18155,18158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":534,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18245,18248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18245,18248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":535,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":535,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18287,18290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18287,18290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handlePaginationChange' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":561,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":561,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'pageSize' is defined but never used. Allowed unused args must match /^_/u.","line":561,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":561,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":763,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":763,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26306,26309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26306,26309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":801,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":801,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27816,27819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27816,27819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":853,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":853,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29401,29404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29401,29404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1151,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1151,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41605,41608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41605,41608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1152,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1152,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41713,41716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41713,41716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1155,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1155,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41810,41813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41810,41813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1156,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1156,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41896,41899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41896,41899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1156,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1156,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41908,41911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41908,41911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1159,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1159,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42013,42016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42013,42016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1160,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1160,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42049,42052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42049,42052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1177,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1177,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42846,42849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42846,42849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1183,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1183,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43025,43028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43025,43028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1184,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1184,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43094,43097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43094,43097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1184,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1184,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43108,43111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43108,43111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1185,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1185,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43175,43178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43175,43178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1186,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1186,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43273,43276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43273,43276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1186,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1186,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43284,43287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43284,43287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1463,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1463,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56742,56745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56742,56745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1464,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1464,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56821,56824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56821,56824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tourStore' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":1466,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":1466,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1472,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1472,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57081,57084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57081,57084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1475,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1475,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57189,57192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57189,57192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1476,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1476,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57225,57228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57225,57228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1480,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1480,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57339,57342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57339,57342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1516,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1516,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58353,58356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58353,58356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1517,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1517,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58432,58435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58432,58435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":1559,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":1559,"endColumn":46,"suggestions":[{"messageId":"addBrackets","fix":{"range":[59287,59748],"text":"{ const fieldName = prompt('è«‹è¼¸å…¥æ¬„ä½åç¨±:');\n        if (fieldName && fieldName.trim()) {\n          const fieldId = Date.now().toString();\n          setTourExtraFields(prev => ({\n            ...prev,\n            [tour_id]: {\n              ...prev[tour_id],\n              customFields: [\n                ...(prev[tour_id]?.customFields || []),\n                { id: fieldId, name: fieldName.trim() }\n              ]\n            }\n          }));\n        }\n        break; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has missing dependencies: 'activeCountries', 'getCitiesByCountryCode', and 'newTour.countryCode'. Either include them or remove the dependency array.","line":180,"column":6,"nodeType":"ArrayExpression","endLine":180,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [activeCountries, getCitiesByCountryCode, newTour.countryCode]","fix":{"range":[7336,7338],"text":"[activeCountries, getCitiesByCountryCode, newTour.countryCode]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":50,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useCallback, useEffect } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { SmartDateInput } from '@/components/ui/smart-date-input';\nimport { useTours } from '@/features/tours/hooks/useTours-advanced';\nimport { tourService } from '@/features/tours/services/tour.service';\nimport { PageRequest } from '@/core/types/common';\nimport { Calendar, FileText, MapPin, Calculator, BarChart3, ShoppingCart, Users, FileCheck, AlertCircle, Clipboard, Plus, Package, RefreshCw, FileX, Edit2, UserPlus, Search, Grid3x3, List, Trash2, Archive, ArchiveRestore } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/utils/logger';\nimport { ExpandableOrderTable } from '@/components/orders/expandable-order-table';\nimport { AddOrderForm, type OrderFormData } from '@/components/orders/add-order-form';\nimport { useTourStore, useOrderStore, useMemberStore, useEmployeeStore, useRegionStore } from '@/stores';\nimport { useQuotes } from '@/features/quotes/hooks/useQuotes';\nimport { Combobox } from '@/components/ui/combobox';\n// TODO: usePaymentStore deprecated - import { usePaymentStore } from '@/stores';\nimport { Tour } from '@/stores/types';\nimport { EnhancedTable, TableColumn } from '@/components/ui/enhanced-table';\nimport { useDialog } from '@/hooks/useDialog';\nimport { TourMembers } from '@/components/tours/tour-members';\nimport { TourOperations } from '@/components/tours/tour-operations';\nimport { TourAddOns } from '@/components/tours/tour-add-ons';\nimport { TourRefunds } from '@/components/tours/tour-refunds';\nimport { TourPayments } from '@/components/tours/tour-payments';\nimport { TourCosts } from '@/components/tours/tour-costs';\nimport { TourTaskAssignment } from '@/components/tours/tour-task-assignment';\nimport { TourCard } from '@/components/tours/tour-card';\n\n// ä½¿ç”¨èˆ‡è©³ç´°æ¨¡å¼ç›¸åŒçš„æ¨™ç±¤å®šç¾©\nconst tourTabs = [\n  { id: 'overview', label: 'ç¸½è¦½', icon: BarChart3 },\n  { id: 'orders', label: 'è¨‚å–®ç®¡ç†', icon: ShoppingCart },\n  { id: 'members', label: 'åœ˜å“¡åå–®', icon: Users },\n  { id: 'operations', label: 'åœ˜å‹™', icon: Clipboard },\n  { id: 'addons', label: 'åŠ è³¼', icon: Package },\n  { id: 'refunds', label: 'é€€è²»', icon: RefreshCw },\n  { id: 'payments', label: 'æ”¶æ¬¾ç´€éŒ„', icon: Calculator },\n  { id: 'costs', label: 'æˆæœ¬æ”¯å‡º', icon: AlertCircle },\n  { id: 'documents', label: 'æ–‡ä»¶ç¢ºèª', icon: FileCheck },\n  { id: 'tasks', label: 'æŒ‡æ´¾ä»»å‹™', icon: UserPlus },\n];\n\ninterface NewTourData {\n  name: string;\n  countryCode: string;       // åœ‹å®¶ä»£ç¢¼ (å¦‚: JPN, THI)\n  cityCode: string;          // åŸå¸‚ä»£ç¢¼ (å¦‚: TYO, BKK)\n  customCountry?: string;    // è‡ªè¨‚åœ‹å®¶åç¨±\n  customLocation?: string;   // è‡ªè¨‚åŸå¸‚åç¨±\n  customCityCode?: string;   // è‡ªè¨‚åŸå¸‚ä»£è™Ÿ\n  departure_date: string;\n  return_date: string;\n  price: number;\n  status: Tour['status'];\n  isSpecial: boolean;\n  max_participants: number;\n  description?: string;\n}\n\nexport default function ToursPage() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const tourStore = useTourStore();\n  const orderStore = useOrderStore();\n  const { items: orders } = orderStore;\n  const addOrder = orderStore.create;\n  const { items: members } = useMemberStore();\n  const employeeStore = useEmployeeStore();\n  const { items: employees } = employeeStore;\n  const regionStore = useRegionStore();\n  const { items: regions } = regionStore;\n  const { quotes, updateQuote } = useQuotes();\n  const { dialog, openDialog, closeDialog } = useDialog();\n\n  // æ‡¶è¼‰å…¥ï¼šæ‰“é–‹æ–°å¢å°è©±æ¡†æ™‚æ‰è¼‰å…¥åœ°å€å’Œå“¡å·¥è³‡æ–™\n  const handleOpenCreateDialog = useCallback(async (tour: any = null, fromQuoteId?: string) => {\n    // åªåœ¨è³‡æ–™ç‚ºç©ºæ™‚æ‰è¼‰å…¥ï¼ˆé¿å…é‡è¤‡ï¼‰\n    if (regions.length === 0) {\n      await regionStore.fetchAll();\n    }\n    if (employees.length === 0) {\n      await employeeStore.fetchAll();\n    }\n    openDialog('create', tour, fromQuoteId);\n  }, [regions.length, employees.length, regionStore, employeeStore, openDialog]);\n\n  // é¸ä¸­çš„æ—…éŠåœ˜\n  const [selectedTour, setSelectedTour] = useState<Tour | null>(null);\n\n  // åˆ†é å’Œç¯©é¸ç‹€æ…‹\n  const [currentPage, setCurrentPage] = useState(1);\n  const [sortBy, setSortBy] = useState('created_at');\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\n  const [selectedRows, setSelectedRows] = useState<string[]>([]);\n  const [expandedRows, setExpandedRows] = useState<string[]>([]);\n  const [activeStatusTab, setActiveStatusTab] = useState('all');\n  const [viewMode, setViewMode] = useState<'card' | 'list'>('list');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [deleteConfirm, setDeleteConfirm] = useState<{ isOpen: boolean; tour: Tour | null }>({ isOpen: false, tour: null });\n  const pageSize = 10;\n\n  // å»ºç«‹ PageRequest åƒæ•¸\n  const pageRequest: PageRequest = {\n    page: currentPage,\n    pageSize,\n    search: '',\n    sortBy,\n    sortOrder,\n  };\n\n  // ä½¿ç”¨æ–°çš„ hook\n  const { data: tours, totalCount, loading, error, actions } = useTours(pageRequest);\n\n  // UI ç‹€æ…‹\n  const [activeTabs, setActiveTabs] = useState<Record<string, string>>({});\n  const [submitting, setSubmitting] = useState(false);\n  const [formError, setFormError] = useState<string | null>(null);\n\n  // å±•é–‹æ¨¡å¼åˆ†é è§¸ç™¼ç‹€æ…‹ - å°æ‡‰æ¯å€‹æ—…éŠåœ˜çš„è§¸ç™¼ç‹€æ…‹\n  const [triggerAddOnAdd, setTriggerAddOnAdd] = useState<Record<string, boolean>>({});\n  const [triggerRefundAdd, setTriggerRefundAdd] = useState<Record<string, boolean>>({});\n  const [triggerPaymentAdd, setTriggerPaymentAdd] = useState<Record<string, boolean>>({});\n  const [triggerCostAdd, setTriggerCostAdd] = useState<Record<string, boolean>>({});\n\n  // å‹•æ…‹æ¬„ä½ç‹€æ…‹ - è¨˜éŒ„æ¯å€‹æ—…éŠåœ˜å•Ÿç”¨çš„é¡å¤–æ¬„ä½\n  const [tourExtraFields, setTourExtraFields] = useState<Record<string, {\n    addOns: boolean;\n    refunds: boolean;\n    customFields: Array<{ id: string; name: string; }>;\n  }>>({});\n\n  // å¾ regions å–å¾—åœ‹å®¶åˆ—è¡¨\n  const activeCountries = React.useMemo(() => {\n    return regions\n      .filter(r => r.type === 'country' && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [regions]);\n\n  // æ ¹æ“šåœ‹å®¶ä»£ç¢¼å–å¾—åŸå¸‚åˆ—è¡¨\n  const getCitiesByCountryCode = React.useCallback((countryCode: string) => {\n    return regions\n      .filter(r => r.type === 'city' && r.country_code === countryCode && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [regions]);\n\n  const [newTour, setNewTour] = useState<NewTourData>({\n    name: '',\n    countryCode: '',\n    cityCode: '',\n    departure_date: '',\n    return_date: '',\n    price: 0,\n    status: 'draft',\n    isSpecial: false,\n    max_participants: 20,\n    description: '',\n  });\n\n  const [availableCities, setAvailableCities] = useState<any[]>([]);\n\n  // åˆå§‹åŒ–é è¨­åœ‹å®¶å’ŒåŸå¸‚\n  React.useEffect(() => {\n    if (activeCountries.length > 0 && !newTour.countryCode) {\n      const defaultCountry = activeCountries[0];\n      const defaultCities = getCitiesByCountryCode(defaultCountry.code);\n      const defaultCity = defaultCities[0];\n\n      setNewTour(prev => ({\n        ...prev,\n        countryCode: defaultCountry.code,\n        cityCode: defaultCity?.code || '',\n      }));\n      setAvailableCities(defaultCities);\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // æ–°å¢è¨‚å–®ç‹€æ…‹ï¼ˆä½¿ç”¨ OrderFormData é¡å‹ï¼‰\n  const [newOrder, setNewOrder] = useState<Partial<OrderFormData>>({\n    contact_person: '',\n    sales_person: '',\n    assistant: '',\n    member_count: 1,\n    total_amount: 0,\n  });\n\n  // æ ¹æ“šç‹€æ…‹æ¨™ç±¤å’Œæœå°‹é—œéµå­—ç¯©é¸æ—…éŠåœ˜\n  const filteredTours = (tours || []).filter(tour => {\n    // ç‹€æ…‹ç¯©é¸\n    const statusMatch = activeStatusTab === 'all' || tour.status === activeStatusTab;\n\n    // æœå°‹ç¯©é¸ - æœå°‹æ‰€æœ‰æ–‡å­—æ¬„ä½\n    const searchLower = searchQuery.toLowerCase();\n    const searchMatch = !searchQuery ||\n      tour.name.toLowerCase().includes(searchLower) ||\n      tour.code.toLowerCase().includes(searchLower) ||\n      tour.location.toLowerCase().includes(searchLower) ||\n      tour.status.toLowerCase().includes(searchLower) ||\n      tour.description?.toLowerCase().includes(searchLower);\n\n    return statusMatch && searchMatch;\n  });\n\n  // è™•ç†ç·¨è¼¯æ¨¡å¼ï¼šç•¶ dialog é–‹å•Ÿä¸”ç‚ºç·¨è¼¯æ¨¡å¼æ™‚ï¼Œè¼‰å…¥æ—…éŠåœ˜è³‡æ–™\n  useEffect(() => {\n    if (dialog.type === 'edit' && dialog.data) {\n      const tour = dialog.data as Tour;\n      console.log('ğŸ”§ ç·¨è¼¯æ¨¡å¼ï¼šè¼‰å…¥æ—…éŠåœ˜è³‡æ–™', {\n        tourName: tour.name,\n        location: tour.location\n      });\n\n      // å¾ location åæŸ¥åœ‹å®¶å’ŒåŸå¸‚ä»£ç¢¼\n      let countryCode = '';\n      let cityCode = '';\n\n      // å˜—è©¦å¾ destinations ä¸­æ‰¾åˆ°åŒ¹é…çš„åŸå¸‚\n      for (const country of activeCountries) {\n        const cities = getCitiesByCountryCode(country.code);\n        const matchedCity = cities.find(city => city.name === tour.location);\n        if (matchedCity) {\n          countryCode = country.code;\n          cityCode = matchedCity.code;\n          setAvailableCities(cities);\n          console.log('âœ… æ‰¾åˆ°åŒ¹é…çš„åŸå¸‚:', {\n            country: country.name,\n            city: matchedCity.name,\n            countryCode,\n            cityCode\n          });\n          break;\n        }\n      }\n\n      // å¦‚æœæ‰¾ä¸åˆ°ï¼Œè¨­ç‚ºè‡ªè¨‚\n      if (!countryCode) {\n        countryCode = '__custom__';\n        cityCode = '__custom__';\n        console.log('âš ï¸ æ‰¾ä¸åˆ°åŒ¹é…çš„åŸå¸‚ï¼Œè¨­ç‚ºè‡ªè¨‚:', tour.location);\n      }\n\n      setNewTour({\n        name: tour.name,\n        countryCode,\n        cityCode,\n        customLocation: countryCode === '__custom__' ? tour.location : undefined,\n        departure_date: tour.departure_date,\n        return_date: tour.return_date,\n        price: tour.price,\n        status: tour.status,\n        isSpecial: tour.status === 'special',\n        max_participants: tour.max_participants || 20,\n        description: tour.description || '',\n      });\n\n      console.log('ğŸ“ è¨­å®šè¡¨å–®è³‡æ–™:', {\n        countryCode,\n        cityCode,\n        customLocation: countryCode === '__custom__' ? tour.location : undefined\n      });\n    }\n  }, [dialog.type, dialog.data, activeCountries, getCitiesByCountryCode]);\n\n  // è™•ç†å¾å ±åƒ¹å–®è·³è½‰ä¾†çš„æƒ…æ³\n  useEffect(() => {\n    const fromQuoteId = searchParams.get('fromQuote');\n    const highlightId = searchParams.get('highlight');\n    const departure_date = searchParams.get('departure_date');\n    const shouldOpenDialog = searchParams.get('openDialog');\n\n    if (fromQuoteId) {\n      // æ‰¾åˆ°å°æ‡‰çš„å ±åƒ¹å–®\n      const sourceQuote = quotes.find(quote => quote.id === fromQuoteId);\n      if (sourceQuote) {\n        // è‡ªå‹•å¡«å…¥å ±åƒ¹å–®çš„è³‡æ–™åˆ°æ–°å¢æ—…éŠåœ˜è¡¨å–®\n        setNewTour(prev => ({\n          ...prev,\n          name: sourceQuote.name,\n          price: Math.round(sourceQuote.total_cost / sourceQuote.group_size), // è¨ˆç®—å–®äººåƒ¹æ ¼\n        }));\n\n        // è‡ªå‹•é–‹å•Ÿæ–°å¢æ—…éŠåœ˜å°è©±æ¡†\n        handleOpenCreateDialog(null, fromQuoteId);\n      }\n    }\n\n    // è™•ç†å¾è¡Œäº‹æ›†è·³è½‰ä¾†çš„æƒ…æ³\n    if (departure_date && shouldOpenDialog === 'true') {\n      setNewTour(prev => ({\n        ...prev,\n        departure_date: departure_date\n      }));\n      handleOpenCreateDialog();\n    }\n\n    // è™•ç†å¾å¾…è¾¦äº‹é …è·³è½‰ä¾†çš„æƒ…æ³\n    if (highlightId) {\n      // è‡ªå‹•å±•é–‹æŒ‡å®šçš„æ—…éŠåœ˜ä¸¦åˆ‡æ›åˆ°ä»»å‹™åˆ†é \n      setExpandedRows([highlightId]);\n      setActiveTabs(prev => ({\n        ...prev,\n        [highlightId]: 'tasks'\n      }));\n    }\n  }, [searchParams, quotes, handleOpenCreateDialog]);\n\n  const resetForm = useCallback(() => {\n    const defaultCountry = activeCountries[0];\n    const defaultCities = defaultCountry ? getCitiesByCountryCode(defaultCountry.code) : [];\n    const defaultCity = defaultCities[0];\n\n    setNewTour({\n      name: '',\n      countryCode: defaultCountry?.code || '',\n      cityCode: defaultCity?.code || '',\n      departure_date: '',\n      return_date: '',\n      price: 0,\n      status: 'draft',\n      isSpecial: false,\n      max_participants: 20,\n      description: '',\n    });\n    setAvailableCities(defaultCities);\n    setNewOrder({\n      contact_person: '',\n      sales_person: '',\n      assistant: '',\n      member_count: 1,\n      total_amount: 0,\n    });\n    setFormError(null); // æ¸…é™¤è¡¨å–®éŒ¯èª¤\n  }, [activeCountries, getCitiesByCountryCode]);\n\n  const handleAddTour = useCallback(async () => {\n    if (!newTour.name.trim() || !newTour.departure_date || !newTour.return_date) {\n      return;\n    }\n\n    // æª¢æŸ¥è‡ªè¨‚ç›®çš„åœ°\n    if (newTour.countryCode === '__custom__') {\n      if (!newTour.customCountry?.trim()) {\n        alert('è«‹å¡«å¯«åœ‹å®¶åç¨±');\n        return;\n      }\n      if (!newTour.customLocation?.trim()) {\n        alert('è«‹å¡«å¯«åŸå¸‚åç¨±');\n        return;\n      }\n      if (!newTour.customCityCode?.trim()) {\n        alert('è«‹å¡«å¯«åŸå¸‚ä»£è™Ÿ');\n        return;\n      }\n      if (newTour.customCityCode.length !== 3) {\n        alert('åŸå¸‚ä»£è™Ÿå¿…é ˆæ˜¯ 3 ç¢¼');\n        return;\n      }\n    }\n\n    try {\n      setSubmitting(true);\n      setFormError(null); // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤\n\n      const departure_date = new Date(newTour.departure_date);\n\n      // æ±ºå®šè¦ä½¿ç”¨çš„åŸå¸‚ä»£è™Ÿå’Œåç¨±\n      const cityCode = newTour.countryCode === '__custom__'\n        ? newTour.customCityCode!\n        : newTour.cityCode;\n      const cityName = newTour.countryCode === '__custom__'\n        ? newTour.customLocation!\n        : availableCities.find(c => c.code === newTour.cityCode)?.name || newTour.cityCode;\n\n      // ç·¨è¼¯æ¨¡å¼ï¼šæ›´æ–°ç¾æœ‰æ—…éŠåœ˜\n      if (dialog.type === 'edit' && dialog.data) {\n        const existingTour = dialog.data as Tour;\n\n        const tourData = {\n          name: newTour.name,\n          location: cityName,\n          departure_date: newTour.departure_date,\n          return_date: newTour.return_date,\n          status: newTour.status,\n          price: newTour.price,\n          max_participants: newTour.max_participants,\n          description: newTour.description,\n        };\n\n        await actions.update(existingTour.id, tourData);\n        resetForm();\n        closeDialog();\n        return;\n      }\n\n      // æ–°å¢æ¨¡å¼ï¼šå‰µå»ºæ–°æ—…éŠåœ˜\n      const code = await tourService.generateTourCode(cityCode, departure_date, newTour.isSpecial);\n\n      // æª¢æŸ¥æ˜¯å¦å¾å ±åƒ¹å–®å‰µå»º\n      const fromQuoteId = searchParams.get('fromQuote');\n\n      // ğŸ”§ åªå– Tour ä»‹é¢éœ€è¦çš„æ¬„ä½ï¼Œé¿å…å‚³å…¥ cityCode ç­‰é¡å¤–æ¬„ä½\n      const tourData = {\n        name: newTour.name,\n        location: cityName,  // å­˜åŸå¸‚åç¨±\n        departure_date: newTour.departure_date,\n        return_date: newTour.return_date,\n        status: newTour.status,\n        price: newTour.price,\n        max_participants: newTour.max_participants,\n        code,\n        contract_status: 'pending' as const,\n        total_revenue: 0,\n        total_cost: 0,\n        profit: 0,\n        current_participants: 0,\n        quote_id: fromQuoteId || undefined, // å¦‚æœå¾å ±åƒ¹å–®å‰µå»ºï¼Œé—œè¯å ±åƒ¹å–®ID\n      };\n\n      const createdTour = await actions.create(tourData);\n\n      // å¦‚æœæœ‰å¡«å¯«è¯çµ¡äººï¼ŒåŒæ™‚æ–°å¢è¨‚å–®\n      if (newOrder.contact_person?.trim()) {\n        const order_number = `${code}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`; // ç”Ÿæˆè¨‚å–®ç·¨è™Ÿï¼ˆä½¿ç”¨éš¨æ©Ÿæ•¸è€Œéæ™‚é–“æˆ³è¨˜ï¼‰\n        const memberCount = newOrder.member_count || 1;\n        const totalAmount = newOrder.total_amount || (newTour.price * memberCount);\n        const orderData = {\n          order_number,\n          tour_id: createdTour.id,\n          code: code,\n          tour_name: newTour.name,\n          contact_person: newOrder.contact_person,\n          sales_person: newOrder.sales_person || '',\n          assistant: newOrder.assistant || '',\n          member_count: memberCount,\n          payment_status: 'unpaid' as const,\n          total_amount: totalAmount,\n          paid_amount: 0,\n          remaining_amount: totalAmount,\n        };\n\n        addOrder(orderData);\n      }\n\n      // å¦‚æœæ˜¯å¾å ±åƒ¹å–®å‰µå»ºï¼Œæ›´æ–°å ±åƒ¹å–®çš„ tourId\n      if (fromQuoteId) {\n        updateQuote(fromQuoteId, { tour_id: createdTour.id });\n\n        // æ¸…é™¤ URL åƒæ•¸\n        router.replace('/tours');\n      }\n\n      resetForm();\n      closeDialog();\n    } catch (err) {\n      // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯åœ¨è¡¨å–®å…§\n      const errorMessage = err instanceof Error ? err.message : dialog.type === 'edit' ? 'æ›´æ–°æ—…éŠåœ˜å¤±æ•—' : 'å»ºç«‹æ—…éŠåœ˜å¤±æ•—';\n      setFormError(errorMessage);\n      logger.error('Failed to create/update tour:', err);\n    } finally {\n      setSubmitting(false);\n    }\n  }, [newTour, newOrder, availableCities, actions, addOrder, resetForm, closeDialog, searchParams, router, updateQuote, dialog.type, dialog.data]);\n\n  const toggleRowExpand = useCallback((tour_id: string) => {\n    setExpandedRows(prev =>\n      prev.includes(tour_id)\n        ? prev.filter(id => id !== tour_id)\n        : [...prev, tour_id]\n    );\n    // è¨­å®šé è¨­åˆ†é ç‚ºç¸½è¦½\n    if (!activeTabs[tour_id]) {\n      setActiveTabs(prev => ({ ...prev, [tour_id]: 'overview' }));\n    }\n  }, [activeTabs]);\n\n  const setActiveTab = useCallback((tour_id: string, tabId: string) => {\n    setActiveTabs(prev => ({ ...prev, [tour_id]: tabId }));\n  }, []);\n\n  const getStatusColor = useCallback((status: string) => {\n    const colors: Record<string, string> = {\n      'ææ¡ˆ': 'text-[#6B7280]',\n      'é€²è¡Œä¸­': 'text-[#6B8E7F]',\n      'å¾…çµæ¡ˆ': 'text-[#9B7E4A]',\n      'çµæ¡ˆ': 'text-[#8A8A8A]',\n      'ç‰¹æ®Šåœ˜': 'text-[#A17676]'\n    };\n    return colors[status] || 'text-morandi-secondary';\n  }, []);\n\n  // å®šç¾© EnhancedTable æ¬„ä½\n  const columns: TableColumn[] = [\n    {\n      key: 'code',\n      label: 'åœ˜è™Ÿ',\n      sortable: true,\n      render: (value) => <span className=\"text-sm text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'name',\n      label: 'æ—…éŠåœ˜åç¨±',\n      sortable: true,\n      render: (value) => <span className=\"text-sm text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'departure_date',\n      label: 'å‡ºç™¼æ—¥æœŸ',\n      sortable: true,\n      render: (value, tour) => {\n        if (!tour.departure_date) return <span className=\"text-sm text-morandi-red\">æœªè¨­å®š</span>;\n        const date = new Date(tour.departure_date);\n        return <span className=\"text-sm text-morandi-primary\">{isNaN(date.getTime()) ? 'ç„¡æ•ˆæ—¥æœŸ' : date.toLocaleDateString()}</span>;\n      },\n    },\n    {\n      key: 'return_date',\n      label: 'å›ç¨‹æ—¥æœŸ',\n      sortable: true,\n      render: (value, tour) => {\n        if (!tour.return_date) return <span className=\"text-sm text-morandi-secondary\">-</span>;\n        const date = new Date(tour.return_date);\n        return <span className=\"text-sm text-morandi-primary\">{isNaN(date.getTime()) ? 'ç„¡æ•ˆæ—¥æœŸ' : date.toLocaleDateString()}</span>;\n      },\n    },\n    {\n      key: 'participants',\n      label: 'äººæ•¸',\n      render: (value, tour) => {\n        const tourOrders = orders.filter((order: any) => order.tour_id === tour.id);\n        const actualMembers = members.filter((member: any) =>\n          tourOrders.some((order: any) => order.id === member.order_id)\n        ).length;\n        return <span className=\"text-sm text-morandi-primary\">{actualMembers}</span>;\n      },\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      sortable: true,\n      render: (value, tour) => (\n        <span className={cn(\n          'text-sm font-medium',\n          getStatusColor(tour.status)\n        )}>\n          {tour.status}\n        </span>\n      ),\n    },\n  ];\n\n  const handleSortChange = useCallback((field: string, order: 'asc' | 'desc') => {\n    setSortBy(field);\n    setSortOrder(order);\n    setCurrentPage(1);\n  }, []);\n\n  const handlePaginationChange = useCallback((page: number, pageSize: number) => {\n    setCurrentPage(page);\n  }, []);\n\n  const handleRowClick = useCallback((tour: Tour) => {\n    setSelectedTour(tour);\n    router.push(`/tours/${tour.id}`);\n  }, [router]);\n\n  const handleDeleteTour = useCallback(async () => {\n    if (!deleteConfirm.tour) return;\n\n    try {\n      await actions.delete(deleteConfirm.tour.id);\n      setDeleteConfirm({ isOpen: false, tour: null });\n    } catch (err) {\n      logger.error('åˆªé™¤æ—…éŠåœ˜å¤±æ•—:', err);\n    }\n  }, [deleteConfirm.tour, actions]);\n\n  const handleArchiveTour = useCallback(async (tour: Tour) => {\n    try {\n      await actions.update(tour.id, { archived: !tour.archived });\n      logger.info(tour.archived ? 'å·²è§£é™¤å°å­˜æ—…éŠåœ˜' : 'å·²å°å­˜æ—…éŠåœ˜');\n    } catch (err) {\n      logger.error('å°å­˜/è§£å°æ—…éŠåœ˜å¤±æ•—:', err);\n    }\n  }, [actions]);\n\n  const renderActions = (tour: Tour) => {\n    // æª¢æŸ¥æ˜¯å¦æœ‰è©²æ—…éŠåœ˜çš„å ±åƒ¹å–®\n    const tourQuote = quotes.find(q => q.tour_id === tour.id);\n    const hasQuote = !!tourQuote;\n\n    return (\n      <div className=\"flex items-center gap-1\">\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            openDialog('edit', tour);\n          }}\n          className=\"p-1 text-morandi-gold hover:bg-morandi-gold/10 rounded transition-colors\"\n          title=\"ç·¨è¼¯\"\n        >\n          <Edit2 size={14} />\n        </button>\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            setSelectedTour(tour);\n            if (hasQuote) {\n              // æœ‰å ±åƒ¹å–®ï¼šå‰å¾€æŸ¥çœ‹/ç·¨è¼¯è©²å ±åƒ¹å–®\n              router.push(`/quotes/${tourQuote.id}`);\n            } else {\n              // æ²’æœ‰å ±åƒ¹å–®ï¼šå‰å¾€å ±åƒ¹å–®åˆ—è¡¨é ï¼Œä¸¦å¸¶ä¸Š tour_id ä»¥é–‹å•Ÿæ–°å¢å°è©±æ¡†\n              router.push(`/quotes?tour_id=${tour.id}`);\n            }\n          }}\n          className=\"p-1 text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/30 rounded transition-colors\"\n          title={hasQuote ? 'æŸ¥çœ‹å ±åƒ¹å–®' : 'æ–°å¢å ±åƒ¹å–®'}\n        >\n          <Calculator size={14} />\n        </button>\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            // è·³è½‰åˆ°è¡Œç¨‹è¡¨ç·¨è¼¯é é¢ï¼Œå¸¶å…¥æ—…éŠåœ˜ ID\n            router.push(`/itinerary/${tour.id}`);\n          }}\n          className=\"p-1 text-morandi-primary hover:bg-morandi-primary/10 rounded transition-colors\"\n          title=\"ç·¨è¼¯è¡Œç¨‹è¡¨\"\n        >\n          <FileText size={14} />\n        </button>\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            handleArchiveTour(tour);\n          }}\n          className={cn(\n            \"p-1 rounded transition-colors\",\n            tour.archived\n              ? \"text-morandi-gold/60 hover:text-morandi-gold hover:bg-morandi-gold/10\"\n              : \"text-morandi-secondary/60 hover:text-morandi-secondary hover:bg-morandi-container\"\n          )}\n          title={tour.archived ? \"è§£é™¤å°å­˜\" : \"å°å­˜\"}\n        >\n          {tour.archived ? <ArchiveRestore size={14} /> : <Archive size={14} />}\n        </button>\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            setDeleteConfirm({ isOpen: true, tour });\n          }}\n          className=\"p-1 text-morandi-red/60 hover:text-morandi-red hover:bg-morandi-red/10 rounded transition-colors\"\n          title=\"åˆªé™¤\"\n        >\n          <Trash2 size={14} />\n        </button>\n      </div>\n    );\n  };\n\n  const renderExpanded = (tour: Tour) => (\n    <div>\n      {/* Tab å°èˆª - çµ±ä¸€è¨­è¨ˆï¼šæ¨™ç±¤é å·¦ï¼ŒæŒ‰éˆ•é å³ */}\n      <div className=\"flex border-b border-border justify-between items-center\">\n        {/* å·¦å´ï¼šæ¨™ç±¤åˆ—è¡¨ */}\n        <div className=\"flex\">\n          {tourTabs.map((tab) => {\n            const is_active = activeTabs[tour.id] === tab.id;\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tour.id, tab.id)}\n                className={cn(\n                  'flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-colors',\n                  is_active\n                    ? 'text-morandi-primary bg-white border-b-2 border-morandi-gold'\n                    : 'text-morandi-secondary hover:text-morandi-primary'\n                )}\n              >\n                <tab.icon size={16} />\n                <span>{tab.label}</span>\n              </button>\n            );\n          })}\n        </div>\n\n        {/* å³å´ï¼šåˆ†é å°ˆå±¬æŒ‰éˆ• */}\n        <div className=\"flex items-center gap-2 px-4\">\n\n          {activeTabs[tour.id] === 'overview' && (\n            <button\n              onClick={() => openDialog('edit', tour)}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n            >\n              <Edit2 size={14} className=\"mr-1\" />\n              ç·¨è¼¯\n            </button>\n          )}\n          {activeTabs[tour.id] === 'orders' && (\n            <button\n              onClick={() => {\n                // é–‹å•Ÿæ–°å¢è¨‚å–®å°è©±æ¡†çš„é‚è¼¯\n                openDialog('new');\n              }}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n            >\n              <Plus size={14} className=\"mr-1\" />\n              æ–°å¢è¨‚å–®\n            </button>\n          )}\n          {activeTabs[tour.id] === 'operations' && (\n            <TourOperationsAddButton tour={tour} tourExtraFields={tourExtraFields} setTourExtraFields={setTourExtraFields} />\n          )}\n          {activeTabs[tour.id] === 'addons' && (\n            <button\n              onClick={() => setTriggerAddOnAdd(prev => ({ ...prev, [tour.id]: true }))}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n            >\n              <Plus size={14} className=\"mr-1\" />\n              æ–°å¢åŠ è³¼\n            </button>\n          )}\n          {activeTabs[tour.id] === 'refunds' && (\n            <button\n              onClick={() => setTriggerRefundAdd(prev => ({ ...prev, [tour.id]: true }))}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n            >\n              <Plus size={14} className=\"mr-1\" />\n              æ–°å¢é€€è²»\n            </button>\n          )}\n          {activeTabs[tour.id] === 'payments' && (\n            <button\n              onClick={() => setTriggerPaymentAdd(prev => ({ ...prev, [tour.id]: true }))}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n            >\n              <Plus size={14} className=\"mr-1\" />\n              æ–°å¢æ”¶æ¬¾\n            </button>\n          )}\n          {activeTabs[tour.id] === 'costs' && (\n            <button\n              onClick={() => setTriggerCostAdd(prev => ({ ...prev, [tour.id]: true }))}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n            >\n              <Plus size={14} className=\"mr-1\" />\n              æ–°å¢æ”¯å‡º\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Tab å…§å®¹ */}\n      <div>\n        {activeTabs[tour.id] === 'overview' && (\n          <TourOverviewTab tour={tour} />\n        )}\n        {activeTabs[tour.id] === 'orders' && (\n          <ExpandableOrderTable\n            orders={orders.filter((order: any) => order.tour_id === tour.id)}\n            showTourInfo={false}\n            tourDepartureDate={tour.departure_date}\n          />\n        )}\n        {activeTabs[tour.id] === 'members' && (\n          <TourMembers tour={tour} />\n        )}\n        {activeTabs[tour.id] === 'operations' && (\n          <TourOperations tour={tour} extraFields={tourExtraFields[tour.id]} />\n        )}\n        {activeTabs[tour.id] === 'addons' && (\n          <TourAddOns\n            tour={tour}\n            triggerAdd={triggerAddOnAdd[tour.id] || false}\n            onTriggerAddComplete={() => setTriggerAddOnAdd(prev => ({ ...prev, [tour.id]: false }))}\n          />\n        )}\n        {activeTabs[tour.id] === 'refunds' && (\n          <TourRefunds\n            tour={tour}\n            triggerAdd={triggerRefundAdd[tour.id] || false}\n            onTriggerAddComplete={() => setTriggerRefundAdd(prev => ({ ...prev, [tour.id]: false }))}\n          />\n        )}\n        {activeTabs[tour.id] === 'payments' && (\n          <TourPayments\n            tour={tour}\n            triggerAdd={triggerPaymentAdd[tour.id] || false}\n            onTriggerAddComplete={() => setTriggerPaymentAdd(prev => ({ ...prev, [tour.id]: false }))}\n          />\n        )}\n        {activeTabs[tour.id] === 'costs' && (\n          <TourCosts\n            {...{\n              tour,\n              triggerAdd: triggerCostAdd[tour.id] || false,\n              onTriggerAddComplete: () => setTriggerCostAdd(prev => ({ ...prev, [tour.id]: false }))\n            } as any}\n          />\n        )}\n        {activeTabs[tour.id] === 'documents' && (\n          <div className=\"text-center py-8 text-morandi-secondary\">\n            <FileCheck size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p>æ–‡ä»¶ç¢ºèªåŠŸèƒ½é–‹ç™¼ä¸­...</p>\n          </div>\n        )}\n        {activeTabs[tour.id] === 'tasks' && (\n          <TourTaskAssignment tour={tour} />\n        )}\n      </div>\n    </div>\n  );\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-morandi-secondary\">è¼‰å…¥ä¸­...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        {...{\n          title: \"æ—…éŠåœ˜ç®¡ç†\",\n          icon: MapPin,\n          breadcrumb: [\n            { label: 'é¦–é ', href: '/' },\n            { label: 'æ—…éŠåœ˜ç®¡ç†', href: '/tours' }\n          ],\n          showSearch: true,\n          searchTerm: searchQuery,\n          onSearchChange: setSearchQuery,\n          searchPlaceholder: \"æœå°‹æ—…éŠåœ˜...\",\n          onAdd: handleOpenCreateDialog,\n          addLabel: \"æ–°å¢æ—…éŠåœ˜\",\n          tabs: [\n          { value: 'all', label: 'å…¨éƒ¨', icon: BarChart3 },\n          { value: 'ææ¡ˆ', label: 'ææ¡ˆ', icon: FileText },\n          { value: 'é€²è¡Œä¸­', label: 'é€²è¡Œä¸­', icon: Calendar },\n          { value: 'å¾…çµæ¡ˆ', label: 'å¾…çµæ¡ˆ', icon: AlertCircle },\n          { value: 'çµæ¡ˆ', label: 'çµæ¡ˆ', icon: FileCheck },\n        ],\n          activeTab: activeStatusTab,\n          onTabChange: (tab: string) => {\n            setActiveStatusTab(tab);\n            setCurrentPage(1); // åˆ‡æ›æ¨™ç±¤æ™‚é‡ç½®é ç¢¼\n          }\n        } as any}\n      />\n\n      {/* æ—…éŠåœ˜åˆ—è¡¨ */}\n      <div className=\"flex-1 overflow-auto\">\n        <EnhancedTable\n          className=\"min-h-full\"\n          columns={columns}\n          data={filteredTours}\n          loading={loading}\n          onSort={handleSortChange}\n          expandable={{\n            expanded: expandedRows,\n            onExpand: toggleRowExpand,\n            renderExpanded,\n          }}\n          actions={renderActions}\n          onRowClick={handleRowClick}\n          bordered={true}\n        />\n      </div>\n\n      {/* æ–°å¢/ç·¨è¼¯æ—…éŠåœ˜å°è©±æ¡† */}\n      <Dialog open={dialog.isOpen} onOpenChange={(open) => {\n        if (!open) {\n          // é—œé–‰å°è©±æ¡†æ™‚é‡ç½®è¡¨å–®\n          resetForm();\n          closeDialog();\n        }\n      }}>\n        <DialogContent className=\"max-w-6xl w-[90vw] h-[80vh] overflow-hidden\" aria-describedby={undefined}>\n          <DialogHeader>\n            <DialogTitle>\n              {dialog.type === 'edit' ? 'ç·¨è¼¯æ—…éŠåœ˜' : 'æ–°å¢æ—…éŠåœ˜ & è¨‚å–®'}\n            </DialogTitle>\n          </DialogHeader>\n\n          {/* éŒ¯èª¤è¨Šæ¯ */}\n          {formError && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-4\">\n              <div className=\"flex items-start gap-2\">\n                <AlertCircle size={18} className=\"mt-0.5 shrink-0\" />\n                <div className=\"text-sm\">{formError}</div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"flex h-full overflow-hidden\">\n            {/* å·¦åŠéƒ¨ - æ–°å¢æ—…éŠåœ˜ */}\n            <div className=\"flex-1 pr-6 border-r border-border\">\n              <div className=\"h-full overflow-y-auto\">\n                <h3 className=\"text-lg font-medium text-morandi-primary mb-4\">æ—…éŠåœ˜è³‡è¨Š</h3>\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"text-sm font-medium text-morandi-primary\">æ—…éŠåœ˜åç¨±</label>\n                    <Input\n                      value={newTour.name}\n                      onChange={(e) => setNewTour(prev => ({ ...prev, name: e.target.value }))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n\n                  {/* ç›®çš„åœ°é¸æ“‡ */}\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-primary\">åœ‹å®¶/åœ°å€</label>\n                      <select\n                        value={newTour.countryCode}\n                        onChange={(e) => {\n                          const countryCode = e.target.value;\n                          const cities = countryCode === '__custom__' ? [] : getCitiesByCountryCode(countryCode);\n                          setAvailableCities(cities);\n                          setNewTour(prev => ({\n                            ...prev,\n                            countryCode,\n                            cityCode: countryCode === '__custom__' ? '__custom__' : cities[0]?.code || '',\n                          }));\n                        }}\n                        className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n                      >\n                        {activeCountries.map((country) => (\n                          <option key={country.code} value={country.code}>\n                            {country.name}\n                          </option>\n                        ))}\n                        <option value=\"__custom__\">+ æ–°å¢å…¶ä»–ç›®çš„åœ°</option>\n                      </select>\n                    </div>\n\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-primary\">åŸå¸‚</label>\n                      {newTour.countryCode === '__custom__' ? (\n                        <Input\n                          value={newTour.customLocation || ''}\n                          onChange={(e) => setNewTour(prev => ({ ...prev, customLocation: e.target.value }))}\n                          placeholder=\"è¼¸å…¥åŸå¸‚åç¨± (å¦‚ï¼šæ›¼è°·)\"\n                          className=\"mt-1\"\n                        />\n                      ) : (\n                        <select\n                          value={newTour.cityCode}\n                          onChange={(e) => setNewTour(prev => ({ ...prev, cityCode: e.target.value }))}\n                          className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n                        >\n                          {availableCities.map((city) => (\n                            <option key={city.code} value={city.code}>\n                              {city.name} ({city.code})\n                            </option>\n                          ))}\n                        </select>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* è‡ªè¨‚ç›®çš„åœ°è©³ç´°è³‡è¨Š */}\n                  {newTour.countryCode === '__custom__' && (\n                    <>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary\">åœ‹å®¶åç¨±</label>\n                        <Input\n                          value={newTour.customCountry || ''}\n                          onChange={(e) => setNewTour(prev => ({ ...prev, customCountry: e.target.value }))}\n                          placeholder=\"è¼¸å…¥åœ‹å®¶åç¨± (å¦‚ï¼šæ³°åœ‹)\"\n                          className=\"mt-1\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"text-sm font-medium text-morandi-primary\">3 ç¢¼åŸå¸‚ä»£è™Ÿ</label>\n                        <Input\n                          value={newTour.customCityCode || ''}\n                          onChange={(e) => {\n                            const value = e.target.value.toUpperCase().slice(0, 3);\n                            setNewTour(prev => ({ ...prev, customCityCode: value }));\n                          }}\n                          placeholder=\"è¼¸å…¥ 3 ç¢¼ä»£è™Ÿ (å¦‚ï¼šBKK)\"\n                          className=\"mt-1\"\n                          maxLength={3}\n                        />\n                        <p className=\"text-xs text-morandi-secondary mt-1\">\n                          ğŸ’¡ ç”¨æ–¼ç”Ÿæˆåœ˜è™Ÿï¼Œå»ºè­°ä½¿ç”¨åœ‹éš›æ©Ÿå ´ä»£ç¢¼æˆ–åŸå¸‚ç¸®å¯«\n                        </p>\n                      </div>\n                    </>\n                  )}\n\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-primary\">å‡ºç™¼æ—¥æœŸ</label>\n                      <SmartDateInput\n                        value={newTour.departure_date}\n                        onChange={(departure_date) => {\n                          setNewTour(prev => {\n                            // å¦‚æœå›ç¨‹æ—¥æœŸæ—©æ–¼æ–°çš„å‡ºç™¼æ—¥æœŸï¼Œè‡ªå‹•èª¿æ•´å›ç¨‹æ—¥æœŸ\n                            const newReturnDate = prev.return_date && prev.return_date < departure_date\n                              ? departure_date\n                              : prev.return_date;\n\n                            return {\n                              ...prev,\n                              departure_date,\n                              return_date: newReturnDate\n                            };\n                          });\n                        }}\n                        min={new Date().toISOString().split('T')[0]}\n                        className=\"mt-1\"\n                        required\n                      />\n                    </div>\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-primary\">è¿”å›æ—¥æœŸ</label>\n                      <SmartDateInput\n                        value={newTour.return_date}\n                        onChange={(return_date) => {\n                          setNewTour(prev => ({ ...prev, return_date }));\n                        }}\n                        min={newTour.departure_date || new Date().toISOString().split('T')[0]}\n                        initialMonth={newTour.departure_date}\n                        className=\"mt-1\"\n                        required\n                      />\n                    </div>\n                  </div>\n\n                  <div>\n                    <label className=\"text-sm font-medium text-morandi-primary\">æè¿°</label>\n                    <Input\n                      value={newTour.description || ''}\n                      onChange={(e) => setNewTour(prev => ({ ...prev, description: e.target.value }))}\n                      className=\"mt-1\"\n                    />\n                  </div>\n\n                  <div className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"checkbox\"\n                      id=\"isSpecial\"\n                      checked={newTour.isSpecial}\n                      onChange={(e) => setNewTour(prev => ({ ...prev, isSpecial: e.target.checked }))}\n                      className=\"rounded\"\n                    />\n                    <label htmlFor=\"isSpecial\" className=\"text-sm text-morandi-primary\">ç‰¹æ®Šåœ˜</label>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* å³åŠéƒ¨ - æ–°å¢è¨‚å–® */}\n            <div className=\"flex-1 pl-6\">\n              <div className=\"h-full overflow-y-auto\">\n                <h3 className=\"text-lg font-medium text-morandi-primary mb-4\">åŒæ™‚æ–°å¢è¨‚å–®ï¼ˆé¸å¡«ï¼‰</h3>\n\n                <AddOrderForm\n                  tourId=\"embedded\"\n                  value={newOrder}\n                  onChange={setNewOrder}\n                />\n\n                <div className=\"bg-morandi-container/20 p-3 rounded-lg mt-4\">\n                  <p className=\"text-xs text-morandi-secondary\">\n                    æç¤ºï¼šå¦‚æœå¡«å¯«äº†è¯çµ¡äººï¼Œå°‡æœƒåŒæ™‚å»ºç«‹ä¸€ç­†è¨‚å–®ã€‚å¦‚æœç•™ç©ºï¼Œå‰‡åªå»ºç«‹æ—…éŠåœ˜ã€‚\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* åº•éƒ¨æŒ‰éˆ• */}\n          <div className=\"flex justify-end space-x-2 pt-6 border-t border-border mt-6\">\n            <Button\n              variant=\"outline\"\n              onClick={() => closeDialog()}\n              disabled={submitting}\n            >\n              å–æ¶ˆ\n            </Button>\n            <Button\n              onClick={handleAddTour}\n              disabled={submitting || !newTour.name.trim() || !newTour.departure_date || !newTour.return_date}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              {submitting ? 'å»ºç«‹ä¸­...' : (newOrder.contact_person ? 'æ–°å¢æ—…éŠåœ˜ & è¨‚å–®' : 'æ–°å¢æ—…éŠåœ˜')}\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* åˆªé™¤ç¢ºèªå°è©±æ¡† */}\n      <Dialog open={deleteConfirm.isOpen} onOpenChange={(open) => !open && setDeleteConfirm({ isOpen: false, tour: null })}>\n        <DialogContent className=\"max-w-md\" aria-describedby={undefined}>\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2 text-morandi-red\">\n              <AlertCircle size={20} />\n              ç¢ºèªåˆªé™¤æ—…éŠåœ˜\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <p className=\"text-sm text-morandi-primary\">\n              ç¢ºå®šè¦åˆªé™¤æ—…éŠåœ˜ <span className=\"font-semibold\">ã€Œ{deleteConfirm.tour?.name}ã€</span> å—ï¼Ÿ\n            </p>\n            <div className=\"bg-morandi-red/5 border border-morandi-red/20 rounded-lg p-3 space-y-2\">\n              <p className=\"text-sm font-medium text-morandi-red\">æ­¤æ“ä½œæœƒå½±éŸ¿ï¼š</p>\n              <ul className=\"text-sm text-morandi-secondary space-y-1 ml-4\">\n                <li>â€¢ ç›¸é—œè¨‚å–®å’Œåœ˜å“¡è³‡æ–™</li>\n                <li>â€¢ æ”¶ä»˜æ¬¾è¨˜éŒ„</li>\n                <li>â€¢ å ±åƒ¹å–®</li>\n              </ul>\n              <p className=\"text-xs text-morandi-red font-medium mt-2\">âš ï¸ æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼</p>\n            </div>\n          </div>\n          <div className=\"flex justify-end gap-2 mt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setDeleteConfirm({ isOpen: false, tour: null })}\n            >\n              å–æ¶ˆ\n            </Button>\n            <Button\n              onClick={handleDeleteTour}\n              className=\"bg-morandi-red hover:bg-morandi-red/90 text-white\"\n            >\n              ç¢ºèªåˆªé™¤\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n\n// ç¸½è¦½åˆ†é çµ„ä»¶\nfunction TourOverviewTab({ tour }: { tour: Tour }) {\n  const { quotes } = useQuotes();\n  const { items: orders } = useOrderStore();\n  const { items: members } = useMemberStore();\n\n  // æ‰¾åˆ°è©²æ—…éŠåœ˜çš„å ±åƒ¹å–®ï¼ˆé€šå¸¸å–æœ€æ–°çš„æˆ–å·²æ ¸å‡†ç‰ˆæœ¬ï¼‰\n  const tourQuote = quotes.find((quote: any) => quote.tour_id === tour.id && quote.status === 'approved') ||\n                   quotes.find((quote: any) => quote.tour_id === tour.id);\n\n  // è¨ˆç®—è©²æ—…éŠåœ˜çš„è¨‚å–®è³‡è¨Š\n  const tourOrders = orders.filter((order: any) => order.tour_id === tour.id);\n  const totalPaidAmount = tourOrders.reduce((sum: any, order: any) => sum + order.paid_amount, 0);\n\n  // è¨ˆç®—ç•¶å‰åƒèˆ‡äººæ•¸ï¼ˆå¾åœ˜å“¡çµ±è¨ˆï¼‰\n  const tourMembers = members.filter((member: any) =>\n    tourOrders.some((order: any) => order.id === member.order_id)\n  );\n  const currentParticipants = tourMembers.length;\n\n  // è²¡å‹™è¨ˆç®—\n  const quotePrice = tourQuote?.total_cost || tour.price; // å ±åƒ¹å–®åƒ¹æ ¼\n  const expectedRevenue = quotePrice * currentParticipants; // æ‡‰æ”¶å¸³æ¬¾ = å ±åƒ¹å–®åƒ¹æ ¼ Ã— åœ˜é«”äººæ•¸\n  const actualRevenue = totalPaidAmount; // å¯¦æ”¶å¸³æ¬¾\n  const grossProfit = actualRevenue - tour.total_cost; // æ¯›åˆ© = å¯¦æ”¶ - ç¸½æˆæœ¬\n  const netProfit = grossProfit - (grossProfit * 0.05); // æ·¨åˆ©æ½¤ï¼ˆå‡è¨­5%ç¨…è²»ï¼Œå¯èª¿æ•´ï¼‰\n\n  // æº–å‚™é ç®—vså¯¦éš›æ”¯å‡ºçš„å°æ¯”è³‡æ–™\n// TODO: usePaymentStore deprecated -   const paymentStore = usePaymentStore();\n  const paymentStore = { payment_requests: [] }; // TODO: usePaymentStore deprecated\n  const paymentRequests = paymentStore.payment_requests; // TODO: å¾ paymentStore å–å¾—\n\n  // ç²å–è©²æ—…éŠåœ˜çš„è«‹æ¬¾å–®\n  const tourPaymentRequests = paymentRequests.filter((req: any) => req.tour_id === tour.id);\n\n  // å ±åƒ¹å–®ä¸­çš„é¡åˆ¥é ç®—\n  const quoteBudget = tourQuote?.categories || [];\n\n  // è¨ˆç®—å„é¡åˆ¥çš„å¯¦éš›æ”¯å‡º (å¾è«‹æ¬¾å–®çµ±è¨ˆ)\n  const actualExpenses = quoteBudget.map((category: any) => {\n    const categoryTotal = tourPaymentRequests.reduce((sum: any, request: any) => {\n      const categoryItems = request.items?.filter((item: any) => item.category === category.name) || [];\n      return sum + categoryItems.reduce((itemSum: any, item: any) => itemSum + (item.unit_price * item.quantity), 0);\n    }, 0);\n\n    return {\n      name: category.name,\n      budgetPerPerson: category.total || 0, // å ±åƒ¹å–®ä¸­çš„å–®äººé ç®—\n      budgetTotal: (category.total || 0) * currentParticipants, // é ç®—ç¸½é¡ = å–®äººé ç®— Ã— äººæ•¸\n      actualTotal: categoryTotal, // å¯¦éš›æ”¯å‡º\n      variance: categoryTotal - ((category.total || 0) * currentParticipants) // å·®é¡ (æ­£æ•¸=è¶…æ”¯ï¼Œè² æ•¸=ç¯€çœ)\n    };\n  });\n\n  return (\n    <div className=\"px-6 py-4 space-y-8\">\n      {/* ä¸ŠåŠéƒ¨ï¼šä¸‰æ¬„å¼è²¡å‹™ç¸½è¦½ */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* åŸºæœ¬è³‡è¨Š */}\n        <div className=\"space-y-3\">\n          <div className=\"text-lg font-medium text-morandi-primary border-b border-border pb-2\">åŸºæœ¬è³‡è¨Š</div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">åœ˜è™Ÿ:</span>\n              <span className=\"text-morandi-primary font-medium\">{tour.code}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">ç›®çš„åœ°:</span>\n              <span className=\"text-morandi-primary\">{tour.location}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">å‡ºç™¼æ—¥æœŸ:</span>\n              <span className=\"text-morandi-primary\">{new Date(tour.departure_date).toLocaleDateString()}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">è¿”å›æ—¥æœŸ:</span>\n              <span className=\"text-morandi-primary\">{new Date(tour.return_date).toLocaleDateString()}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">åƒèˆ‡äººæ•¸:</span>\n              <span className=\"text-morandi-primary font-medium\">{(() => {\n                const tourOrders = orders.filter(order => order.tour_id === tour.id);\n                const actualMembers = members.filter(member =>\n                  tourOrders.some(order => order.id === member.order_id)\n                ).length;\n                return actualMembers;\n              })()}/{tour.max_participants}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">å»ºç«‹æ™‚é–“:</span>\n              <span className=\"text-morandi-secondary text-sm\">{new Date(tour.created_at).toLocaleDateString()}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* å ±åƒ¹èˆ‡æ”¶å…¥ */}\n        <div className=\"space-y-3\">\n          <div className=\"text-lg font-medium text-morandi-primary border-b border-border pb-2\">å ±åƒ¹èˆ‡æ”¶å…¥</div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">å ±åƒ¹å–®åƒ¹æ ¼:</span>\n              <span className=\"text-morandi-primary font-medium\">NT$ {quotePrice.toLocaleString()}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">æ‡‰æ”¶å¸³æ¬¾:</span>\n              <span className=\"text-morandi-blue font-medium\">NT$ {expectedRevenue.toLocaleString()}</span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">å¯¦æ”¶å¸³æ¬¾:</span>\n              <span className=\"text-morandi-green font-semibold\">NT$ {actualRevenue.toLocaleString()}</span>\n            </div>\n            <div className=\"flex justify-between pt-2 border-t border-border\">\n              <span className=\"text-morandi-secondary\">æ”¶æ¬¾ç‡:</span>\n              <span className={cn(\n                \"font-medium\",\n                expectedRevenue > 0 ?\n                  (actualRevenue / expectedRevenue >= 0.8 ? \"text-morandi-green\" : \"text-morandi-gold\") :\n                  \"text-morandi-secondary\"\n              )}>\n                {expectedRevenue > 0 ? `${((actualRevenue / expectedRevenue) * 100).toFixed(1)}%` : '0%'}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">å¾…æ”¶é¤˜é¡:</span>\n              <span className={cn(\n                \"font-medium\",\n                (expectedRevenue - actualRevenue) > 0 ? \"text-morandi-red\" : \"text-morandi-green\"\n              )}>\n                NT$ {(expectedRevenue - actualRevenue).toLocaleString()}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* æˆæœ¬èˆ‡åˆ©æ½¤ */}\n        <div className=\"space-y-3\">\n          <div className=\"text-lg font-medium text-morandi-primary border-b border-border pb-2\">æˆæœ¬èˆ‡åˆ©æ½¤</div>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">ç¸½æˆæœ¬:</span>\n              <span className=\"text-morandi-red font-medium\">NT$ {tour.total_cost.toLocaleString()}</span>\n            </div>\n            <div className=\"flex justify-between pt-2 border-t border-border\">\n              <span className=\"text-morandi-secondary\">æ¯›åˆ©æ½¤:</span>\n              <span className={cn(\n                \"font-semibold\",\n                grossProfit >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n              )}>\n                NT$ {grossProfit.toLocaleString()}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">æ·¨åˆ©æ½¤:</span>\n              <span className={cn(\n                \"font-bold text-lg\",\n                netProfit >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n              )}>\n                NT$ {netProfit.toLocaleString()}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-morandi-secondary\">åˆ©æ½¤ç‡:</span>\n              <span className={cn(\n                \"font-medium\",\n                netProfit >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n              )}>\n                {actualRevenue > 0 ? `${((netProfit / actualRevenue) * 100).toFixed(1)}%` : '0%'}\n              </span>\n            </div>\n          </div>\n\n          {/* ç‹€æ…‹æŒ‡æ¨™ */}\n          <div className=\"mt-4 p-3 rounded-lg border border-border bg-morandi-container/10\">\n            <div className=\"text-sm font-medium text-morandi-secondary mb-2\">è²¡å‹™ç‹€æ³</div>\n            <div className=\"flex items-center space-x-2\">\n              {netProfit >= 0 ? (\n                <div className=\"w-3 h-3 rounded-full bg-morandi-green\"></div>\n              ) : (\n                <div className=\"w-3 h-3 rounded-full bg-morandi-red\"></div>\n              )}\n              <span className={cn(\n                \"text-sm font-medium\",\n                netProfit >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n              )}>\n                {netProfit >= 0 ? \"ç›ˆåˆ©ä¸­\" : \"è™§æä¸­\"}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* ä¸‹åŠéƒ¨ï¼šé ç®—vså¯¦éš›æ”¯å‡ºæ˜ç´°è¡¨ */}\n      <div className=\"border border-border rounded-lg p-6\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <h3 className=\"text-xl font-semibold text-morandi-primary\">é ç®— vs å¯¦éš›æ”¯å‡ºæ˜ç´°</h3>\n          <div className=\"text-sm text-morandi-secondary\">\n            åŸºæº–ï¼š{currentParticipants}äººåœ˜é«”\n          </div>\n        </div>\n\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-morandi-container/20 border-b border-border\">\n              <tr>\n                <th className=\"text-left py-3 px-4 text-sm font-semibold text-morandi-primary\">é¡åˆ¥</th>\n                <th className=\"text-right py-3 px-4 text-sm font-semibold text-morandi-primary\">å–®äººé ç®—</th>\n                <th className=\"text-right py-3 px-4 text-sm font-semibold text-morandi-primary\">é ç®—ç¸½é¡</th>\n                <th className=\"text-right py-3 px-4 text-sm font-semibold text-morandi-primary\">å¯¦éš›æ”¯å‡º</th>\n                <th className=\"text-right py-3 px-4 text-sm font-semibold text-morandi-primary\">å·®é¡</th>\n                <th className=\"text-right py-3 px-4 text-sm font-semibold text-morandi-primary\">å·®é¡ç‡</th>\n              </tr>\n            </thead>\n            <tbody>\n              {actualExpenses.map((expense, index) => {\n                const varianceRate = expense.budgetTotal > 0 ? (expense.variance / expense.budgetTotal * 100) : 0;\n                return (\n                  <tr key={expense.name} className={cn(\n                    \"border-b border-border hover:bg-morandi-container/10\",\n                    index === actualExpenses.length - 1 && \"border-b-0\"\n                  )}>\n                    <td className=\"py-3 px-4\">\n                      <div className=\"flex items-center space-x-2\">\n                        <span className=\"font-medium text-morandi-primary\">{expense.name}</span>\n                        {Math.abs(varianceRate) > 20 && (\n                          <span className={cn(\n                            \"px-2 py-1 rounded text-xs font-medium\",\n                            varianceRate > 20 ? \"bg-morandi-red/10 text-morandi-red\" : \"bg-morandi-green/10 text-morandi-green\"\n                          )}>\n                            {varianceRate > 20 ? \"è¶…æ”¯\" : \"ç¯€çœ\"}\n                          </span>\n                        )}\n                      </div>\n                    </td>\n                    <td className=\"py-3 px-4 text-right text-morandi-secondary\">\n                      NT$ {expense.budgetPerPerson.toLocaleString()}\n                    </td>\n                    <td className=\"py-3 px-4 text-right text-morandi-primary font-medium\">\n                      NT$ {expense.budgetTotal.toLocaleString()}\n                    </td>\n                    <td className=\"py-3 px-4 text-right\">\n                      <span className={cn(\n                        \"font-medium\",\n                        expense.actualTotal > expense.budgetTotal ? \"text-morandi-red\" : \"text-morandi-primary\"\n                      )}>\n                        NT$ {expense.actualTotal.toLocaleString()}\n                      </span>\n                    </td>\n                    <td className=\"py-3 px-4 text-right\">\n                      <span className={cn(\n                        \"font-semibold\",\n                        expense.variance > 0 ? \"text-morandi-red\" :\n                        expense.variance < 0 ? \"text-morandi-green\" : \"text-morandi-secondary\"\n                      )}>\n                        {expense.variance > 0 ? \"+\" : \"\"}NT$ {expense.variance.toLocaleString()}\n                      </span>\n                    </td>\n                    <td className=\"py-3 px-4 text-right\">\n                      <span className={cn(\n                        \"font-medium\",\n                        Math.abs(varianceRate) > 20 ? (varianceRate > 0 ? \"text-morandi-red\" : \"text-morandi-green\") : \"text-morandi-secondary\"\n                      )}>\n                        {varianceRate > 0 ? \"+\" : \"\"}{varianceRate.toFixed(1)}%\n                      </span>\n                    </td>\n                  </tr>\n                );\n              })}\n\n              {/* ç¸½è¨ˆè¡Œ */}\n              <tr className=\"bg-morandi-container/10 font-semibold\">\n                <td className=\"py-4 px-4 text-morandi-primary\">ç¸½è¨ˆ</td>\n                <td className=\"py-4 px-4 text-right text-morandi-secondary\">\n                  NT$ {(actualExpenses.reduce((sum, exp) => sum + exp.budgetPerPerson, 0)).toLocaleString()}\n                </td>\n                <td className=\"py-4 px-4 text-right text-morandi-primary\">\n                  NT$ {(actualExpenses.reduce((sum, exp) => sum + exp.budgetTotal, 0)).toLocaleString()}\n                </td>\n                <td className=\"py-4 px-4 text-right text-morandi-primary\">\n                  NT$ {(actualExpenses.reduce((sum, exp) => sum + exp.actualTotal, 0)).toLocaleString()}\n                </td>\n                <td className=\"py-4 px-4 text-right\">\n                  <span className={cn(\n                    \"font-bold\",\n                    actualExpenses.reduce((sum, exp) => sum + exp.variance, 0) > 0 ? \"text-morandi-red\" : \"text-morandi-green\"\n                  )}>\n                    {actualExpenses.reduce((sum, exp) => sum + exp.variance, 0) > 0 ? \"+\" : \"\"}\n                    NT$ {(actualExpenses.reduce((sum, exp) => sum + exp.variance, 0)).toLocaleString()}\n                  </span>\n                </td>\n                <td className=\"py-4 px-4 text-right\">\n                  <span className=\"text-morandi-primary font-bold\">\n                    {actualExpenses.reduce((sum, exp) => sum + exp.budgetTotal, 0) > 0 ?\n                      `${((actualExpenses.reduce((sum, exp) => sum + exp.variance, 0) / actualExpenses.reduce((sum, exp) => sum + exp.budgetTotal, 0)) * 100).toFixed(1)}%` :\n                      '0%'\n                    }\n                  </span>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n\n        {/* èªªæ˜ */}\n        <div className=\"mt-4 p-3 bg-morandi-container/5 rounded-lg text-sm text-morandi-secondary\">\n          <div className=\"flex items-center space-x-4\">\n            <span>ğŸ’¡ <strong>èªªæ˜ï¼š</strong></span>\n            <span>ç¶ è‰²æ•¸å­—è¡¨ç¤ºç¯€çœé ç®—</span>\n            <span>ç´…è‰²æ•¸å­—è¡¨ç¤ºè¶…å‡ºé ç®—</span>\n            <span>å·®é¡ç‡è¶…é20%æœƒç‰¹åˆ¥æ¨™ç¤º</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// åœ˜å‹™æ“ä½œæ–°å¢æŒ‰éˆ•çµ„ä»¶\nfunction TourOperationsAddButton({ tour, tourExtraFields, setTourExtraFields }: {\n  tour: Tour;\n  tourExtraFields: Record<string, any>;\n  setTourExtraFields: React.Dispatch<React.SetStateAction<Record<string, any>>>;\n}) {\n  const tourStore = useTourStore();\n  const orderStore = useOrderStore();\n  const memberStore = useMemberStore();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  // ç²å–å±¬æ–¼é€™å€‹æ—…éŠåœ˜çš„æ‰€æœ‰è¨‚å–®\n  const tourOrders = orderStore.items.filter((order: any) => order.tour_id === tour.id);\n\n  // ç²å–åœ˜å“¡æ•¸æ“š\n  const allTourMembers = memberStore.items.filter((member: any) =>\n    tourOrders.some((order: any) => order.id === member.order_id)\n  );\n\n  // è¨ˆç®—å·²åˆ†æˆ¿äººæ•¸\n  const assignedMembers = allTourMembers.filter((member: any) => member.assignedRoom).length;\n\n  return (\n    <>\n      {/* å·²åˆ†æˆ¿çµ±è¨ˆ */}\n      <span className=\"px-2 py-1 bg-morandi-green/20 text-morandi-green rounded text-xs\">\n        å·²åˆ†æˆ¿: {assignedMembers}äºº\n      </span>\n\n      {/* åœ˜å‹™æ–°å¢æŒ‰éˆ• */}\n      <button\n        onClick={() => setIsDialogOpen(true)}\n        className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-3 py-1.5 rounded text-sm font-medium flex items-center transition-colors\"\n        title=\"æ–°å¢é …ç›®\"\n      >\n        <Plus size={14} className=\"mr-1\" />\n        æ–°å¢æ¬„ä½\n      </button>\n\n      {/* é¸æ“‡è¦–çª— */}\n      <TourOperationsAddDialog\n        isOpen={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n        tour={tour}\n        tourExtraFields={tourExtraFields}\n        setTourExtraFields={setTourExtraFields}\n      />\n    </>\n  );\n}\n\n// åœ˜å‹™æ“ä½œæ–°å¢å°è©±æ¡†çµ„ä»¶\nfunction TourOperationsAddDialog({ isOpen, onClose, tour, tourExtraFields, setTourExtraFields }: {\n  isOpen: boolean;\n  onClose: () => void;\n  tour: Tour;\n  tourExtraFields: Record<string, any>;\n  setTourExtraFields: React.Dispatch<React.SetStateAction<Record<string, any>>>;\n}) {\n  const handleOptionSelect = useCallback((option: string) => {\n    const tour_id = tour.id;\n\n    // åˆå§‹åŒ–è©²æ—…éŠåœ˜çš„æ¬„ä½ç‹€æ…‹ï¼ˆå¦‚æœé‚„æ²’æœ‰ï¼‰\n    if (!tourExtraFields[tour_id]) {\n      setTourExtraFields(prev => ({\n        ...prev,\n        [tour_id]: {\n          addOns: false,\n          refunds: false,\n          customFields: []\n        }\n      }));\n    }\n\n    switch (option) {\n      case 'addon':\n        // å•Ÿç”¨åŠ è³¼é …ç›®æ¬„ä½\n        setTourExtraFields(prev => ({\n          ...prev,\n          [tour_id]: {\n            ...prev[tour_id],\n            addOns: true\n          }\n        }));\n        break;\n\n      case 'refund':\n        // å•Ÿç”¨é€€è²»é …ç›®æ¬„ä½\n        setTourExtraFields(prev => ({\n          ...prev,\n          [tour_id]: {\n            ...prev[tour_id],\n            refunds: true\n          }\n        }));\n        break;\n\n      case 'blank':\n        // æ–°å¢è‡ªå®šç¾©ç©ºç™½æ¬„ä½\n        const fieldName = prompt('è«‹è¼¸å…¥æ¬„ä½åç¨±:');\n        if (fieldName && fieldName.trim()) {\n          const fieldId = Date.now().toString();\n          setTourExtraFields(prev => ({\n            ...prev,\n            [tour_id]: {\n              ...prev[tour_id],\n              customFields: [\n                ...(prev[tour_id]?.customFields || []),\n                { id: fieldId, name: fieldName.trim() }\n              ]\n            }\n          }));\n        }\n        break;\n    }\n\n    onClose();\n  }, [tour.id, tourExtraFields, setTourExtraFields, onClose]);\n\n  const options = [\n    {\n      id: 'blank',\n      label: 'ç©ºç™½æ¬„ä½',\n      description: 'æ–°å¢è‡ªå®šç¾©ç©ºç™½é …ç›®',\n      icon: FileText,\n      color: 'text-morandi-secondary',\n      bgColor: 'hover:bg-morandi-container/30'\n    },\n    {\n      id: 'addon',\n      label: 'åŠ è³¼é …ç›®',\n      description: 'æ–°å¢é¡å¤–è³¼è²·é …ç›®',\n      icon: Package,\n      color: 'text-morandi-blue',\n      bgColor: 'hover:bg-morandi-blue/10'\n    },\n    {\n      id: 'refund',\n      label: 'é€€è²»é …ç›®',\n      description: 'æ–°å¢é€€æ¬¾ç›¸é—œé …ç›®',\n      icon: RefreshCw,\n      color: 'text-morandi-red',\n      bgColor: 'hover:bg-morandi-red/10'\n    }\n  ];\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-md\" aria-describedby={undefined}>\n        <DialogHeader>\n          <DialogTitle>æ–°å¢é …ç›®</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-3\">\n          <div className=\"text-sm text-morandi-secondary mb-4\">\n            ç‚ºæ—…éŠåœ˜ã€Œ{tour.name}ã€é¸æ“‡è¦æ–°å¢çš„é …ç›®é¡å‹ï¼š\n          </div>\n\n          {options.map((option) => {\n            const Icon = option.icon;\n            return (\n              <button\n                key={option.id}\n                onClick={() => handleOptionSelect(option.id)}\n                className={cn(\n                  'w-full flex items-center space-x-4 p-4 rounded-lg border border-border transition-colors text-left',\n                  option.bgColor\n                )}\n              >\n                <div className={cn('w-10 h-10 rounded-full bg-morandi-container/20 flex items-center justify-center', option.color)}>\n                  <Icon size={18} />\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"font-medium text-morandi-primary\">{option.label}</div>\n                  <div className=\"text-sm text-morandi-secondary\">{option.description}</div>\n                </div>\n                <div className=\"text-morandi-secondary\">\n                  <FileText size={16} />\n                </div>\n              </button>\n            );\n          })}\n        </div>\n\n        <div className=\"flex justify-end pt-4\">\n          <Button variant=\"outline\" onClick={onClose}>\n            å–æ¶ˆ\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/unauthorized/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/view/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[359,362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[359,362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[661,664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[661,664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1011,1014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1011,1014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useParams } from \"next/navigation\";\nimport TourPage from \"@/components/TourPage\";\nimport { useTourStore } from \"@/stores\";\nimport {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n} from \"@tabler/icons-react\";\n\n// Icon mapping\nconst iconMap: any = {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n};\n\nexport default function ViewItineraryPage() {\n  const params = useParams();\n  const id = params.id as string;\n  const { fetchById } = useTourStore();\n\n  const [tourData, setTourData] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  // è¼‰å…¥è¡Œç¨‹è³‡æ–™\n  useEffect(() => {\n    const loadTour = async () => {\n      try {\n        const tour = await fetchById(id);\n        if (tour) {\n          // Convert icon strings to components\n          const processedData = {\n            ...tour,\n            features: tour.features?.map((f: any) => ({\n              ...f,\n              iconComponent: iconMap[f.icon] || IconSparkles,\n            })) || [],\n          };\n          setTourData(processedData);\n        } else {\n          console.error('æ‰¾ä¸åˆ°æ­¤è¡Œç¨‹');\n        }\n      } catch (error) {\n        console.error('è¼‰å…¥è¡Œç¨‹å¤±æ•—:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadTour();\n  }, [id, fetchById]);\n\n  // è¼‰å…¥ä¸­ç‹€æ…‹\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <p className=\"text-lg text-gray-600\">è¼‰å…¥ä¸­...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // æ‰¾ä¸åˆ°è³‡æ–™\n  if (!tourData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <p className=\"text-lg text-gray-600\">æ‰¾ä¸åˆ°æ­¤è¡Œç¨‹</p>\n        </div>\n      </div>\n    );\n  }\n\n  return <TourPage data={tourData} viewMode=\"desktop\" />;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/view/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/visas/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'VISA_STATUS_MAP' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2894,2897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2894,2897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2961,2964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2961,2964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'contact_info.tour_id' and 'fetchTours'. Either include them or remove the dependency array.","line":108,"column":6,"nodeType":"ArrayExpression","endLine":108,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [contact_info.tour_id, fetchTours]","fix":{"range":[3863,3865],"text":"[contact_info.tour_id, fetchTours]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'applicants.length'. Either include it or remove the dependency array.","line":142,"column":6,"nodeType":"ArrayExpression","endLine":142,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [applicants.length, contact_info.applicant_name]","fix":{"range":[4544,4573],"text":"[applicants.length, contact_info.applicant_name]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5146,5149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5146,5149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7361,7364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7361,7364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":282,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":282,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getStatusBadge' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":347,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":347,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":444,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":444,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13493,13496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13493,13496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { ResponsiveHeader } from '@/components/layout/responsive-header';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { EnhancedTable, TableColumn } from '@/components/ui/enhanced-table';\nimport { Combobox, ComboboxOption } from '@/components/ui/combobox';\nimport { useVisaStore, useTourStore, useOrderStore } from '@/stores';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { FileCheck, Clock, CheckCircle, XCircle, AlertCircle, FileText, Edit2, Trash2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Visa } from '@/stores/types';\nimport { logger } from '@/lib/utils/logger';\nimport { tourService } from '@/features/tours/services/tour.service';\nimport { VISA_STATUS_MAP, getVisaStatusLabel } from '@/constants/status-maps';\n\nexport default function VisasPage() {\n  const { items: visas, create: addVisa, update: updateVisa, delete: deleteVisa } = useVisaStore();\n  const { items: tours, create: addTour, fetchAll: fetchTours } = useTourStore();\n  const { items: orders, create: addOrder } = useOrderStore();\n  const { user } = useAuthStore();\n\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [selectedRows, setSelectedRows] = useState<string[]>([]);\n  const [activeTab, setActiveTab] = useState('all');\n\n  // è¨ˆç®—ä¸‹ä»¶æ™‚é–“ï¼šè­·ç…§ 21å¤©ã€è­·ç…§æ€¥ä»¶ 3å¤©ã€å°èƒè­‰ 14å¤©ã€å°èƒè­‰æ€¥ä»¶ 6å¤©ï¼ˆæ‰€æœ‰å¤©æ•¸å«ä¾‹å‡æ—¥ï¼‰\n  const calculateReceivedDate = useCallback((submissionDate: string, visaType: string): string => {\n    if (!submissionDate) return '';\n\n    const date = new Date(submissionDate);\n\n    // æ ¹æ“šç°½è­‰é¡å‹æ±ºå®šå¤©æ•¸ï¼ˆæ‰€æœ‰å¤©æ•¸éƒ½å«ä¾‹å‡æ—¥ï¼Œä¸éœ€è¦é †å»¶ï¼‰\n    let days = 21; // é è¨­è­·ç…§ä¸€èˆ¬ä»¶\n\n    if (visaType.includes('å°èƒè­‰') && visaType.includes('æ€¥ä»¶')) {\n      days = 6;\n    } else if (visaType.includes('è­·ç…§') && visaType.includes('æ€¥ä»¶')) {\n      days = 3;\n    } else if (visaType.includes('å°èƒè­‰')) {\n      days = 14;\n    } else if (visaType.includes('è­·ç…§')) {\n      days = 21;\n    }\n\n    date.setDate(date.getDate() + days);\n\n    return date.toISOString().split('T')[0];\n  }, []);\n\n  // æ–°å¢ç°½è­‰è¡¨å–® - è¯çµ¡äººè³‡è¨Š\n  const [contact_info, setContactInfo] = useState({\n    tour_id: '',\n    order_id: '', // æ–°å¢è¨‚å–®IDæ¬„ä½\n    applicant_name: '',\n    contact_person: '',\n    contact_phone: '',\n  });\n\n  // åœ˜è™Ÿé¸é …ï¼ˆè½‰æ›ç‚º Combobox æ ¼å¼ï¼‰\n  const tourOptions: ComboboxOption[] = useMemo(() => {\n    console.log('ğŸ“‹ ç•¶å‰ tours æ•¸é‡:', tours.length);\n    console.log('ğŸ“‹ Tours:', tours);\n    return tours.map(tour => ({\n      value: tour.id,\n      label: `${tour.code} - ${tour.name}`,\n    }));\n  }, [tours]);\n\n  // è¨‚å–®é¸é …ï¼ˆæ ¹æ“šé¸æ“‡çš„åœ˜è™Ÿéæ¿¾ï¼‰\n  const orderOptions: ComboboxOption[] = React.useMemo(() => {\n    if (!contact_info.tour_id) return [];\n    const { items: orders } = useOrderStore.getState();\n    return orders\n      .filter((order: any) => order.tour_id === contact_info.tour_id)\n      .map((order: any) => ({\n        value: order.id,\n        label: `${order.order_number} - ${order.contact_person}`,\n      }));\n  }, [contact_info.tour_id]);\n\n  // ç•¶é é¢è¼‰å…¥æ™‚ï¼Œè‡ªå‹•å–å¾—æˆ–å»ºç«‹ç•¶å¹´åº¦ç°½è­‰å°ˆç”¨åœ˜\n  useEffect(() => {\n    const initVisaTour = async () => {\n      try {\n        console.log('ğŸ” é–‹å§‹å»ºç«‹/å–å¾—ç°½è­‰å°ˆç”¨åœ˜...');\n        const visaTour = await tourService.getOrCreateVisaTour();\n        console.log('âœ… ç°½è­‰å°ˆç”¨åœ˜:', visaTour);\n\n        // é‡æ–°è¼‰å…¥ tours ä»¥ç¢ºä¿æ–°å»ºç«‹çš„ç°½è­‰å°ˆç”¨åœ˜å‡ºç¾åœ¨åˆ—è¡¨ä¸­\n        console.log('ğŸ”„ é‡æ–°è¼‰å…¥ tours...');\n        await fetchTours();\n        console.log('âœ… Tours é‡æ–°è¼‰å…¥å®Œæˆ');\n\n        if (visaTour && !contact_info.tour_id) {\n          console.log('âœ… è¨­å®šé è¨­åœ˜è™Ÿ:', visaTour.id);\n          setContactInfo(prev => ({ ...prev, tour_id: visaTour.id }));\n        }\n      } catch (error) {\n        console.error('âŒ å»ºç«‹ç°½è­‰å°ˆç”¨åœ˜å¤±æ•—:', error);\n        logger.error('Failed to get or create visa tour', error);\n      }\n    };\n\n    initVisaTour();\n  }, []);\n\n  // æ‰¹æ¬¡è¾¦ç†äººåˆ—è¡¨\n  interface VisaApplicant {\n    id: string;\n    name: string;\n    country: string;\n    is_urgent: boolean;\n    submission_date: string;\n    received_date: string;\n    cost: number;\n  }\n\n  const [applicants, setApplicants] = useState<VisaApplicant[]>([\n    {\n      id: '1',\n      name: '',\n      country: 'è­·ç…§ æˆäºº',\n      is_urgent: false,\n      submission_date: '',\n      received_date: '',\n      cost: 0,\n    }\n  ]);\n\n  // ç¬¬ä¸€å€‹è¾¦ç†äººè‡ªå‹•å¸¶å…¥ç”³è«‹äººå§“åï¼ˆå³æ™‚åŒæ­¥ï¼‰\n  useEffect(() => {\n    if (applicants.length > 0) {\n      setApplicants(prev => {\n        const updated = [...prev];\n        updated[0].name = contact_info.applicant_name;\n        return updated;\n      });\n    }\n  }, [contact_info.applicant_name]);\n\n  // æ–°å¢è¾¦ç†äºº\n  const addApplicant = useCallback(() => {\n    setApplicants(prev => [...prev, {\n      id: Date.now().toString(),\n      name: '',\n      country: 'è­·ç…§ æˆäºº',\n      is_urgent: false,\n      submission_date: '',\n      received_date: '',\n      cost: 0,\n    }]);\n  }, []);\n\n  // ç§»é™¤è¾¦ç†äºº\n  const removeApplicant = useCallback((id: string) => {\n    if (applicants.length > 1) {\n      setApplicants(prev => prev.filter(a => a.id !== id));\n    }\n  }, [applicants.length]);\n\n  // æ›´æ–°è¾¦ç†äººè³‡æ–™\n  const updateApplicant = useCallback((id: string, field: keyof VisaApplicant, value: any) => {\n    setApplicants(prev => prev.map(a => {\n      if (a.id !== id) return a;\n\n      const updated = { ...a, [field]: value };\n\n      // å¦‚æœæ˜¯é€ä»¶æ™‚é–“æˆ–ç°½è­‰é¡å‹æ”¹è®Šï¼Œè‡ªå‹•è¨ˆç®—ä¸‹ä»¶æ™‚é–“\n      if (field === 'submission_date' || field === 'country' || field === 'is_urgent') {\n        if (updated.submission_date) {\n          const visaTypeWithUrgent = updated.is_urgent ? `${updated.country} æ€¥ä»¶` : updated.country;\n          updated.received_date = calculateReceivedDate(updated.submission_date, visaTypeWithUrgent);\n        }\n      }\n\n      // å¦‚æœå‹¾é¸/å–æ¶ˆæ€¥ä»¶ï¼Œè‡ªå‹•èª¿æ•´æˆæœ¬ Â±900\n      if (field === 'is_urgent') {\n        if (value === true) {\n          // å‹¾é¸æ€¥ä»¶ï¼š+900\n          updated.cost = a.cost + 900;\n        } else {\n          // å–æ¶ˆæ€¥ä»¶ï¼š-900\n          updated.cost = Math.max(0, a.cost - 900);\n        }\n      }\n\n      return updated;\n    }));\n  }, [calculateReceivedDate]);\n\n  // æ ¹æ“š tab ç¯©é¸ç°½è­‰\n  const filteredVisas = useMemo(() =>\n    activeTab === 'all'\n      ? visas\n      : visas.filter((v) => v.status === activeTab)\n  , [visas, activeTab]);\n\n  // è¨ˆç®—ä»£è¾¦è²»\n  const calculateFee = useCallback((country: string): number => {\n    if (country.includes('å…’ç«¥')) return 1500;\n    if (country.includes('é¦–è¾¦')) return 800;\n    if (country.includes('å°èƒè­‰') && country.includes('éºå¤±ä»¶')) return 2900;\n    return 1800;\n  }, []);\n\n  // è™•ç†æ‰¹æ¬¡æ–°å¢ç°½è­‰\n  const handleAddVisa = async () => {\n    if (!contact_info.applicant_name || !user) return;\n\n    let selectedTour;\n\n    // å¦‚æœæ²’é¸åœ˜è™Ÿï¼Œè‡ªå‹•å»ºç«‹æˆ–ä½¿ç”¨é è¨­çš„ã€Œç°½è­‰ä»£è¾¦åœ˜ã€\n    if (!contact_info.tour_id) {\n      const currentYear = new Date().getFullYear();\n      const defaultTourCode = `VISA-${currentYear}`;\n\n      const existingDefaultTour = tours.find(t => t.code === defaultTourCode);\n\n      if (existingDefaultTour) {\n        selectedTour = existingDefaultTour;\n      } else {\n        const endOfYear = `${currentYear}-12-31`;\n        selectedTour = await addTour({\n          name: `${currentYear}å¹´åº¦ç°½è­‰ä»£è¾¦`,\n          departure_date: endOfYear,\n          return_date: endOfYear,\n          status: 'special' as const,\n          location: 'VISA',\n          price: 0,\n          max_participants: 9999,\n          contract_status: 'pending' as const,\n          total_revenue: 0,\n          total_cost: 0,\n          profit: 0,\n        } as any);\n      }\n    } else {\n      selectedTour = tours.find(t => t.id === contact_info.tour_id);\n      if (!selectedTour) return;\n    }\n\n    // å–å¾—æˆ–å»ºç«‹è¨‚å–®\n    const totalFee = applicants.reduce((sum, a) => sum + calculateFee(a.country), 0);\n    let targetOrder;\n\n    if (contact_info.order_id) {\n      // å¦‚æœæœ‰é¸æ“‡è¨‚å–®ï¼Œä½¿ç”¨ç¾æœ‰è¨‚å–®\n      targetOrder = orders.find(o => o.id === contact_info.order_id);\n      if (!targetOrder) return;\n    } else {\n      // å¦‚æœæ²’æœ‰é¸æ“‡è¨‚å–®ï¼Œè‡ªå‹•å»ºç«‹æ–°è¨‚å–®\n      // è¨ˆç®—è©²åœ˜çš„è¨‚å–®æµæ°´è™Ÿï¼ˆ3ä½æ•¸ï¼‰\n      const tourOrders = orders.filter(o => o.tour_id === selectedTour.id);\n      const nextNumber = (tourOrders.length + 1).toString().padStart(3, '0');\n      const order_number = `${selectedTour.code}-${nextNumber}`;\n\n      targetOrder = await addOrder({\n        order_number,\n        tour_id: selectedTour.id,\n        code: order_number, // è¨‚å–®ç·¨è™ŸåŒæ™‚ä½œç‚º codeï¼ˆå”¯ä¸€è­˜åˆ¥ï¼‰\n        tour_name: selectedTour.name,\n        contact_person: contact_info.contact_person || contact_info.applicant_name,\n        sales_person: user.display_name || 'ç³»çµ±',\n        assistant: user.display_name || 'ç³»çµ±',\n        member_count: applicants.filter(a => a.name).length,\n        total_amount: totalFee,\n        paid_amount: 0,\n        remaining_amount: totalFee,\n        payment_status: 'unpaid' as const,\n      });\n    }\n\n    if (!targetOrder) {\n      logger.error('è¨‚å–®å»ºç«‹å¤±æ•—');\n      return;\n    }\n\n    // æ‰¹æ¬¡å»ºç«‹ç°½è­‰ï¼ˆç‚ºæ¯å€‹è¾¦ç†äººå»ºç«‹ï¼Œå…±ç”¨åŒä¸€å€‹è¨‚å–®ï¼‰\n    applicants.forEach((applicant, index) => {\n      if (!applicant.name) return;\n\n      const fee = calculateFee(applicant.country);\n      const total_cost = applicant.is_urgent ? applicant.cost + 900 : applicant.cost;\n\n      // å»ºç«‹ç°½è­‰è¨˜éŒ„\n      addVisa({\n        applicant_name: applicant.name,\n        contact_person: contact_info.contact_person,\n        contact_phone: contact_info.contact_phone,\n        visa_type: applicant.country, // ç°½è­‰é¡å‹\n        country: applicant.country,   // åœ‹å®¶ï¼ˆä¿ç•™ç›¸å®¹æ€§ï¼‰\n        submission_date: applicant.submission_date,\n        received_date: applicant.received_date,\n        fee,\n        cost: total_cost,\n        status: 'pending',\n        order_id: targetOrder.id,\n        order_number: targetOrder.order_number,\n        tour_id: selectedTour.id,\n        code: selectedTour.code,\n        created_by: user.id,\n        note: '',\n      });\n    });\n\n    // é‡ç½®è¡¨å–®ï¼ˆä¿æŒé è¨­åœ˜è™Ÿï¼‰\n    const currentYear = new Date().getFullYear();\n    const visaCode = `VISA${currentYear}001`;\n    const defaultVisaTour = tours.find(t => t.code === visaCode);\n    setContactInfo({\n      tour_id: defaultVisaTour?.id || '',\n      order_id: '',\n      applicant_name: '',\n      contact_person: '',\n      contact_phone: '',\n    });\n    setApplicants([{\n      id: '1',\n      name: '',\n      country: 'è­·ç…§ æˆäºº',\n      is_urgent: false,\n      submission_date: '',\n      received_date: '',\n      cost: 0,\n    }]);\n\n    setIsDialogOpen(false);\n  };\n\n  // æ‰¹æ¬¡é€ä»¶\n  const handleBatchSubmit = async () => {\n    if (selectedRows.length === 0) return;\n    const today = new Date().toISOString().split('T')[0];\n\n    // ä½¿ç”¨æ¨™æº– API æ‰¹æ¬¡æ›´æ–°\n    for (const id of selectedRows) {\n      await updateVisa(id, { status: 'submitted', submission_date: today });\n    }\n\n    setSelectedRows([]);\n  };\n\n  // ç‹€æ…‹å¾½ç« æ¨£å¼\n  const getStatusBadge = (status: Visa['status']) => {\n    const badges: Record<Visa['status'], string> = {\n      'pending': 'bg-morandi-gold/20 text-morandi-gold',\n      'submitted': 'bg-morandi-blue/20 text-morandi-blue',\n      'issued': 'bg-morandi-green/20 text-morandi-green',\n      'collected': 'bg-morandi-container text-morandi-secondary',\n      'rejected': 'bg-morandi-red/20 text-morandi-red',\n    };\n    return badges[status] || 'bg-morandi-container text-morandi-secondary';\n  };\n\n  // Table æ¬„ä½å®šç¾©\n  const columns: TableColumn[] = [\n    {\n      key: 'applicant_name',\n      label: 'ç”³è«‹äºº',\n      sortable: true,\n      render: (value) => <span className=\"text-sm text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'contact_person',\n      label: 'è¯çµ¡äºº',\n      render: (value) => <span className=\"text-sm text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'contact_phone',\n      label: 'è¯çµ¡é›»è©±',\n      render: (value) => <span className=\"text-sm text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'country',\n      label: 'ç°½è­‰',\n      render: (value) => <span className=\"text-sm text-morandi-primary\">{value}</span>,\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      render: (value, visa) => (\n        <span className={cn(\n          'text-sm font-medium',\n          visa.status === 'submitted' ? 'text-morandi-gold' :\n          visa.status === 'issued' ? 'text-morandi-green' :\n          'text-morandi-secondary'\n        )}>\n          {getVisaStatusLabel(visa.status)}\n        </span>\n      ),\n    },\n    {\n      key: 'submission_date',\n      label: 'é€ä»¶æ™‚é–“',\n      render: (value) => <span className=\"text-sm text-morandi-secondary\">{value ? new Date(value).toLocaleDateString() : '-'}</span>,\n    },\n    {\n      key: 'received_date',\n      label: 'ä¸‹ä»¶æ™‚é–“',\n      render: (value) => <span className=\"text-sm text-morandi-secondary\">{value ? new Date(value).toLocaleDateString() : '-'}</span>,\n    },\n    {\n      key: 'fee',\n      label: 'ä»£è¾¦è²»',\n      render: (value) => <span className=\"text-sm text-morandi-primary\">NT$ {value.toLocaleString()}</span>,\n    },\n  ];\n\n  const renderActions = (visa: Visa) => (\n    <div className=\"flex items-center gap-1\">\n      <button\n        onClick={(e) => {\n          e.stopPropagation();\n          // ç·¨è¼¯åŠŸèƒ½\n        }}\n        className=\"p-1 text-morandi-gold hover:bg-morandi-gold/10 rounded transition-colors\"\n        title=\"ç·¨è¼¯\"\n      >\n        <Edit2 size={14} />\n      </button>\n      <button\n        onClick={(e) => {\n          e.stopPropagation();\n          if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤ç°½è­‰è¨˜éŒ„å—ï¼Ÿ')) {\n            deleteVisa(visa.id);\n          }\n        }}\n        className=\"p-1 text-morandi-red/60 hover:text-morandi-red hover:bg-morandi-red/10 rounded transition-colors\"\n        title=\"åˆªé™¤\"\n      >\n        <Trash2 size={14} />\n      </button>\n    </div>\n  );\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        {...{\n        title: \"ç°½è­‰ç®¡ç†\",\n        icon: FileText} as any}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'ç°½è­‰ç®¡ç†', href: '/visas' }\n        ]}\n        onAdd={() => setIsDialogOpen(true)}\n        addLabel=\"æ–°å¢ç°½è­‰\"\n        tabs={[\n          { value: 'all', label: 'å…¨éƒ¨', icon: FileText },\n          { value: 'pending', label: 'å¾…é€ä»¶', icon: Clock },\n          { value: 'submitted', label: 'å·²é€ä»¶', icon: AlertCircle },\n          { value: 'issued', label: 'å·²ä¸‹ä»¶', icon: CheckCircle },\n          { value: 'collected', label: 'å·²å–ä»¶', icon: FileCheck },\n          { value: 'rejected', label: 'é€€ä»¶', icon: XCircle },\n        ]}        activeTab={activeTab}\n        onTabChange={setActiveTab}\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        {/* æ‰¹æ¬¡æ“ä½œæŒ‰éˆ• */}\n        {selectedRows.length > 0 && (\n        <div className=\"bg-morandi-container p-4 rounded-lg flex items-center justify-between\">\n          <span className=\"text-sm text-morandi-primary\">\n            å·²é¸æ“‡ {selectedRows.length} ç­†ç°½è­‰\n          </span>\n          <div className=\"flex gap-2\">\n            <Button\n              onClick={handleBatchSubmit}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              æ‰¹æ¬¡é€ä»¶\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => setSelectedRows([])}\n            >\n              å–æ¶ˆé¸æ“‡\n            </Button>\n          </div>\n        </div>\n      )}\n\n        {/* ç°½è­‰åˆ—è¡¨ */}\n        <EnhancedTable\n          className=\"min-h-full\"\n          columns={columns}\n          data={filteredVisas}\n          loading={false}\n          selection={{\n            selected: selectedRows,\n            onChange: setSelectedRows,\n          }}\n          actions={renderActions}\n          bordered={true}\n        />\n      </div>\n\n      {/* æ–°å¢ç°½è­‰å°è©±æ¡† */}\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢ç°½è­‰</DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* ä¸ŠåŠéƒ¨ï¼šè¯çµ¡äººè³‡è¨Š */}\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">é¸æ“‡åœ˜è™Ÿ</label>\n                  <Combobox\n                    value={contact_info.tour_id}\n                    onChange={(value) => {\n                      setContactInfo(prev => ({ ...prev, tour_id: value, order_id: '' }));\n                    }}\n                    options={tourOptions}\n                    placeholder=\"è«‹è¼¸å…¥æˆ–é¸æ“‡åœ˜è™Ÿï¼ˆä¾‹å¦‚ï¼š0810ï¼‰\"\n                    className=\"mt-1\"\n                    showSearchIcon\n                    showClearButton\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">\n                    é¸æ“‡è¨‚å–® <span className=\"text-xs text-morandi-secondary\">(é¸å¡«ï¼Œæœªé¸æ“‡å°‡è‡ªå‹•å»ºç«‹)</span>\n                  </label>\n                  <Combobox\n                    value={contact_info.order_id}\n                    onChange={(value) => setContactInfo(prev => ({ ...prev, order_id: value }))}\n                    options={orderOptions}\n                    placeholder={contact_info.tour_id ? \"è«‹é¸æ“‡è¨‚å–®æˆ–ç•™ç©ºè‡ªå‹•å»ºç«‹\" : \"è«‹å…ˆé¸æ“‡åœ˜è™Ÿ\"}\n                    className=\"mt-1\"\n                    disabled={!contact_info.tour_id}\n                    showSearchIcon\n                    showClearButton\n                  />\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">è¯çµ¡äºº</label>\n                  <Input\n                    value={contact_info.contact_person}\n                    onChange={(e) => setContactInfo(prev => ({ ...prev, contact_person: e.target.value }))}\n                    className=\"mt-1\"\n                    placeholder=\"è«‹è¼¸å…¥è¯çµ¡äºº\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">ç”³è«‹äºº</label>\n                  <Input\n                    value={contact_info.applicant_name}\n                    onChange={(e) => setContactInfo(prev => ({ ...prev, applicant_name: e.target.value }))}\n                    className=\"mt-1\"\n                    placeholder=\"è«‹è¼¸å…¥ç”³è«‹äººå§“å\"\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-primary\">è¯çµ¡é›»è©±</label>\n                  <Input\n                    value={contact_info.contact_phone}\n                    onChange={(e) => setContactInfo(prev => ({ ...prev, contact_phone: e.target.value }))}\n                    className=\"mt-1\"\n                    placeholder=\"è«‹è¼¸å…¥è¯çµ¡é›»è©±\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* åˆ†å‰²ç·š */}\n            <div className=\"border-t border-border\"></div>\n\n            {/* ä¸‹åŠéƒ¨ï¼šæ‰¹æ¬¡è¾¦ç†äººåˆ—è¡¨ */}\n            <div className=\"space-y-2\">\n              {applicants.map((applicant, index) => (\n                <div key={applicant.id} className=\"flex gap-2 items-center\">\n                  <Input\n                    value={applicant.name}\n                    onChange={(e) => updateApplicant(applicant.id, 'name', e.target.value)}\n                    placeholder={index === 0 ? \"è¾¦ç†äººï¼ˆè‡ªå‹•å¸¶å…¥ï¼‰\" : \"è¾¦ç†äºº\"}\n                    className=\"flex-[1.5]\"\n                  />\n\n                  <select\n                    value={applicant.country}\n                    onChange={(e) => updateApplicant(applicant.id, 'country', e.target.value)}\n                    className=\"flex-[2] p-2 border border-border rounded-md bg-background h-10\"\n                  >\n                    <option value=\"è­·ç…§ æˆäºº\">è­·ç…§ æˆäºº</option>\n                    <option value=\"è­·ç…§ å…’ç«¥\">è­·ç…§ å…’ç«¥</option>\n                    <option value=\"è­·ç…§ æˆäºº éºå¤±ä»¶\">è­·ç…§ æˆäºº éºå¤±ä»¶</option>\n                    <option value=\"è­·ç…§ å…’ç«¥ éºå¤±ä»¶\">è­·ç…§ å…’ç«¥ éºå¤±ä»¶</option>\n                    <option value=\"å°èƒè­‰\">å°èƒè­‰</option>\n                    <option value=\"å°èƒè­‰ éºå¤±ä»¶\">å°èƒè­‰ éºå¤±ä»¶</option>\n                    <option value=\"å°èƒè­‰ é¦–è¾¦\">å°èƒè­‰ é¦–è¾¦</option>\n                  </select>\n\n                  <Input\n                    type=\"date\"\n                    value={applicant.submission_date}\n                    onChange={(e) => updateApplicant(applicant.id, 'submission_date', e.target.value)}\n                    className=\"flex-1\"\n                  />\n\n                  <Input\n                    type=\"date\"\n                    value={applicant.received_date}\n                    readOnly\n                    className=\"flex-1 bg-muted\"\n                  />\n\n                  <Input\n                    type=\"number\"\n                    value={calculateFee(applicant.country)}\n                    readOnly\n                    className=\"w-20 bg-muted\"\n                  />\n\n                  <Input\n                    type=\"number\"\n                    value={applicant.cost}\n                    onChange={(e) => updateApplicant(applicant.id, 'cost', Number(e.target.value))}\n                    placeholder=\"æˆæœ¬\"\n                    className=\"w-20\"\n                  />\n\n                  <div className=\"flex items-center gap-1\">\n                    <input\n                      type=\"checkbox\"\n                      checked={applicant.is_urgent}\n                      onChange={(e) => updateApplicant(applicant.id, 'is_urgent', e.target.checked)}\n                      className=\"w-4 h-4\"\n                    />\n                    <span className=\"text-sm whitespace-nowrap\">æ€¥ä»¶</span>\n                  </div>\n\n                  <Button\n                    type=\"button\"\n                    onClick={index === applicants.length - 1 ? addApplicant : () => removeApplicant(applicant.id)}\n                    size=\"sm\"\n                    className={index === applicants.length - 1\n                      ? \"h-8 w-8 p-0 flex-shrink-0 bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n                      : \"h-8 w-8 p-0 flex-shrink-0 text-morandi-red hover:bg-red-50\"}\n                    variant={index === applicants.length - 1 ? \"default\" : \"ghost\"}\n                  >\n                    {index === applicants.length - 1 ? '+' : 'âœ•'}\n                  </Button>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"flex justify-end space-x-2 pt-4 border-t border-border mt-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsDialogOpen(false)}\n            >\n              å–æ¶ˆ\n            </Button>\n            <Button\n              onClick={handleAddVisa}\n              disabled={!contact_info.applicant_name || applicants.every(a => !a.name)}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              æ‰¹æ¬¡æ–°å¢ç°½è­‰\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/app/workspace/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/AppInitializer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ErrorLogger.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/SmartAttractions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/TourPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconBuilding' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'IconToolsKitchen2' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[541,544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[541,544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6863,6866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6863,6866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":479,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20157,20160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20157,20160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":593,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":593,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25624,25627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25624,25627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":621,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":621,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27061,27064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27061,27064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":824,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":824,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36325,36328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36325,36328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":862,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":862,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37779,37782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37779,37782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":883,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":883,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38577,38580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38577,38580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { TracingBeam } from \"@/components/ui/tracing-beam\";\nimport { FocusCards } from \"@/components/ui/focus-cards\";\nimport { FloatingDock } from \"@/components/ui/floating-dock\";\nimport { motion } from \"framer-motion\";\nimport {\n  IconHome,\n  IconCalendar,\n  IconMapPin,\n  IconPhone,\n  IconPlane,\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n} from \"@tabler/icons-react\";\n\nexport default function TourPage({ data, isPreview = false, viewMode = 'desktop' }: { data: any; isPreview?: boolean; viewMode?: 'desktop' | 'mobile' }) {\n  const [scrollOpacity, setScrollOpacity] = useState(0);\n  const [attractionsProgress, setAttractionsProgress] = useState(0); // 0-1 ä¹‹é–“çš„é€²åº¦å€¼\n  const [showGallery, setShowGallery] = useState(false);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const galleryRef = useRef<HTMLElement>(null);\n\n  // ç›£è½çˆ¶å®¹å™¨çš„æ»¾å‹•äº‹ä»¶\n  useEffect(() => {\n    let scrollContainer: HTMLElement | null = null;\n\n    const handleScroll = (e: Event) => {\n      const target = e.target as HTMLElement;\n      const scrollTop = target.scrollTop;\n\n      // åœ¨ 0-150px ä¹‹é–“å¹³æ»‘éæ¸¡ï¼Œ0 = å®Œå…¨é€æ˜ï¼Œ150 = å®Œå…¨ä¸é€æ˜\n      const opacity = Math.min(scrollTop / 150, 1);\n      setScrollOpacity(opacity);\n    };\n\n    // æ‰¾åˆ°æœ€è¿‘çš„å¯æ»¾å‹•çˆ¶å…ƒç´ \n    const findScrollableParent = (element: HTMLElement | null): HTMLElement | null => {\n      if (!element) return null;\n\n      const parent = element.parentElement;\n      if (!parent) return null;\n\n      const overflowY = window.getComputedStyle(parent).overflowY;\n      if (overflowY === 'auto' || overflowY === 'scroll') {\n        return parent;\n      }\n\n      return findScrollableParent(parent);\n    };\n\n    // å»¶é²ä¸€ä¸‹ç¢ºä¿ DOM å·²ç¶“æ¸²æŸ“\n    const timer = setTimeout(() => {\n      const topElement = document.getElementById('top');\n      if (topElement) {\n        scrollContainer = findScrollableParent(topElement);\n        if (scrollContainer) {\n          scrollContainer.addEventListener('scroll', handleScroll);\n        }\n      }\n    }, 100);\n\n    return () => {\n      clearTimeout(timer);\n      if (scrollContainer) {\n        scrollContainer.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, []);\n\n  // ç›£è½ç²¾é¸æ™¯é»å€å¡Šçš„æ»¾å‹•é€²åº¦ï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰\n  useEffect(() => {\n    if (viewMode !== 'mobile') return;\n\n    // é è¦½æ¨¡å¼ï¼šè‡ªå‹•æ¼¸é€²åˆ° 1\n    if (isPreview) {\n      let progress = 0;\n      const interval = setInterval(() => {\n        progress += 0.02; // æ¯æ¬¡å¢åŠ  2%\n        if (progress >= 1) {\n          progress = 1;\n          clearInterval(interval);\n        }\n        setAttractionsProgress(progress);\n      }, 50); // æ¯ 50ms æ›´æ–°ä¸€æ¬¡ï¼Œç¸½å…±ç´„ 2.5 ç§’å®Œæˆ\n\n      return () => clearInterval(interval);\n    }\n\n    // å¯¦éš›é é¢ï¼šåŸºæ–¼æ»¾å‹•ä½ç½®è¨ˆç®—é€²åº¦\n    let scrollContainer: HTMLElement | null = null;\n\n    const handleScroll = () => {\n      const attractionsElement = document.getElementById('attractions');\n      if (!attractionsElement || !scrollContainer) return;\n\n      const rect = attractionsElement.getBoundingClientRect();\n      const containerRect = scrollContainer.getBoundingClientRect();\n\n      // è¨ˆç®—å€å¡Šé ‚éƒ¨ç›¸å°æ–¼è¦–çª—é ‚éƒ¨çš„ä½ç½®\n      const elementTop = rect.top - containerRect.top;\n      const viewportHeight = containerRect.height;\n\n      // å®šç¾©å‹•ç•«è§¸ç™¼ç¯„åœï¼š\n      // startPoint: å€å¡Šé ‚éƒ¨åœ¨è¦–çª—åº•éƒ¨ 80% ä½ç½®ï¼ˆé‚„æ²’å®Œå…¨é€²å…¥ï¼‰\n      // endPoint: å€å¡Šé ‚éƒ¨åœ¨è¦–çª—é ‚éƒ¨ 20% ä½ç½®ï¼ˆå·²ç¶“é€²å…¥ä¸¦ä½”æ“šå¤§éƒ¨åˆ†ç•«é¢ï¼‰\n      const startPoint = viewportHeight * 0.8; // åœ¨è¦–çª—åº•éƒ¨ 80% è™•é–‹å§‹\n      const endPoint = viewportHeight * 0.2;    // åœ¨è¦–çª—é ‚éƒ¨ 20% è™•çµæŸ\n\n      // è¨ˆç®—é€²åº¦ï¼ˆ0 åˆ° 1ï¼‰\n      // ç•¶ elementTop > startPoint æ™‚ï¼Œprogress = 0ï¼ˆå€å¡Šé‚„åœ¨ä¸‹æ–¹ï¼Œä¿æŒç™½è‰²ï¼‰\n      // ç•¶ elementTop < endPoint æ™‚ï¼Œprogress = 1ï¼ˆå€å¡Šå·²ç¶“ä¸Šä¾†ï¼Œå®Œå…¨é»‘è‰²ï¼‰\n      const rawProgress = (startPoint - elementTop) / (startPoint - endPoint);\n      const progress = Math.max(0, Math.min(1, rawProgress));\n\n      setAttractionsProgress(progress);\n    };\n\n    // æ‰¾åˆ°æ»¾å‹•å®¹å™¨\n    const findScrollableParent = (element: HTMLElement | null): HTMLElement | null => {\n      if (!element) return null;\n      const parent = element.parentElement;\n      if (!parent) return null;\n      const overflowY = window.getComputedStyle(parent).overflowY;\n      if (overflowY === 'auto' || overflowY === 'scroll') {\n        return parent;\n      }\n      return findScrollableParent(parent);\n    };\n\n    const timer = setTimeout(() => {\n      const attractionsElement = document.getElementById('attractions');\n      if (attractionsElement) {\n        scrollContainer = findScrollableParent(attractionsElement);\n        if (scrollContainer) {\n          scrollContainer.addEventListener('scroll', handleScroll);\n          handleScroll(); // åˆå§‹è¨ˆç®—ä¸€æ¬¡\n        }\n      }\n    }, 100);\n\n    return () => {\n      clearTimeout(timer);\n      if (scrollContainer) {\n        scrollContainer.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, [viewMode, isPreview]);\n\n  // æª¢æ¸¬ç²¾é¸æ™¯é»å€å¡Šæ˜¯å¦é€²å…¥è¦–çª—ï¼ˆè§¸ç™¼å…¨å±ç›¸ç°¿ï¼‰\n  useEffect(() => {\n    if (viewMode !== 'mobile') return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach(entry => {\n          if (entry.isIntersecting && entry.intersectionRatio > 0.7) {\n            setShowGallery(true);\n            document.body.style.overflow = 'hidden';\n          }\n        });\n      },\n      { threshold: 0.7 }\n    );\n\n    if (galleryRef.current) {\n      observer.observe(galleryRef.current);\n    }\n\n    return () => {\n      observer.disconnect();\n      document.body.style.overflow = '';\n    };\n  }, [viewMode]);\n\n  // å°èˆªé …ç›®\n  const navLinks = data.navLinks || [\n    { title: \"é¦–é \", icon: IconHome, href: \"#top\" },\n    { title: \"èˆªç­\", icon: IconPlane, href: \"#flight\" },\n    { title: \"æ™¯é»\", icon: IconMapPin, href: \"#attractions\" },\n    { title: \"è¡Œç¨‹\", icon: IconCalendar, href: \"#itinerary\" },\n    { title: \"è¯çµ¡\", icon: IconPhone, href: \"#contact\" },\n  ];\n\n  // ç²¾é¸æ™¯é»è³‡æ–™\n  const focusCards = data.focusCards || [];\n\n  // è¡Œç¨‹ç‰¹è‰²è³‡æ–™\n  const features = data.features || [];\n\n  return (\n    <div className={viewMode === 'mobile' ? 'min-h-screen bg-gray-50' : 'min-h-screen bg-white'}>\n      {/* ç½®é ‚å°èˆªåˆ— - æ¡Œé¢ç‰ˆæˆ–éé è¦½æ¨¡å¼æ‰é¡¯ç¤º */}\n      {(!isPreview || viewMode === 'desktop') && (\n        <nav\n          className=\"fixed left-0 right-0 z-40 transition-all duration-300 hidden md:block\"\n          style={{\n            backgroundColor: `rgba(255, 255, 255, ${scrollOpacity * 0.9})`,\n            backdropFilter: scrollOpacity > 0.1 ? 'blur(12px)' : 'none',\n            boxShadow: scrollOpacity > 0.5 ? '0 4px 6px -1px rgba(0, 0, 0, 0.1)' : 'none'\n          }}\n        >\n        <div className=\"max-w-7xl mx-auto px-4\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div\n              className=\"text-xl font-bold transition-colors duration-300\"\n              style={{\n                color: scrollOpacity > 0.5 ? 'rgb(var(--morandi-primary))' : 'white'\n              }}\n            >\n              Corner Travel\n            </div>\n            <div className=\"flex items-center gap-8\">\n              {navLinks.map((link: any) => {\n                const IconComponent = link.icon || IconHome;\n                return (\n                  <a\n                    key={link.href}\n                    href={link.href}\n                    className=\"flex items-center gap-2 transition-colors\"\n                    style={{\n                      color: scrollOpacity > 0.5\n                        ? 'rgb(var(--morandi-secondary))'\n                        : 'rgba(255, 255, 255, 0.8)'\n                    }}\n                  >\n                    <IconComponent className=\"w-4 h-4\" />\n                    <span className=\"text-sm font-medium\">{link.title}</span>\n                  </a>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </nav>\n      )}\n\n      {/* å…¨è¢å¹•ç¾åŒ–å°é¢ */}\n      <section id=\"top\" className=\"relative h-screen overflow-hidden bg-slate-900\">\n        {/* å‹•æ…‹èƒŒæ™¯ */}\n        <div className=\"absolute inset-0\">\n          <img\n            src={data.coverImage || \"https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=1200&q=75&auto=format&fit=crop\"}\n            alt=\"Cover\"\n            className=\"absolute inset-0 w-full h-full object-cover transition-opacity duration-700\"\n            style={{\n              filter: \"brightness(0.7)\",\n            }}\n          />\n          <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-black/30 to-black/70\" />\n        </div>\n\n        {/* ä¸»è¦å…§å®¹ */}\n        <div className={viewMode === 'mobile' ? 'relative z-10 h-full flex flex-col items-center justify-center px-4' : 'relative z-10 h-full flex flex-col items-center justify-center px-4'}>\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 1 }}\n            className={viewMode === 'mobile' ? 'text-center mb-40' : 'text-center mb-16'}\n          >\n            <motion.span\n              initial={{ opacity: 0, scale: 0.9 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ delay: 0.2 }}\n              className={viewMode === 'mobile' ? 'inline-block px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-white/90 text-xs font-medium mb-8' : 'inline-block px-4 py-1.5 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-white/90 text-xs sm:text-sm font-medium mb-4'}\n            >\n              {data.tagline || \"Venturo Travel 2025 ç§‹å­£ç²¾é¸\"}\n            </motion.span>\n\n            <motion.h1\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 1, delay: 0.3 }}\n              className={viewMode === 'mobile' ? 'text-2xl font-bold text-white mb-4' : 'text-4xl md:text-6xl lg:text-8xl font-bold text-white mb-4'}\n            >\n              {data.title}\n              <br />\n              <span className={viewMode === 'mobile' ? 'text-base text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500' : 'text-2xl md:text-4xl lg:text-6xl text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-orange-500'}>\n                {data.subtitle}\n              </span>\n            </motion.h1>\n\n            <motion.p\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              transition={{ delay: 0.5 }}\n              className={viewMode === 'mobile' ? 'text-xs text-white/80 max-w-3xl mx-auto mb-8 px-4' : 'text-base md:text-xl lg:text-2xl text-white/80 max-w-3xl mx-auto mb-8 px-4'}\n            >\n              {data.description}\n            </motion.p>\n\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.7 }}\n              className=\"flex flex-wrap justify-center gap-4 sm:gap-6 px-4\"\n            >\n              <div className={viewMode === 'mobile' ? 'bg-white/10 backdrop-blur-md border border-white/20 px-4 py-2 rounded-full text-center' : 'bg-white/10 backdrop-blur-md border border-white/20 px-6 sm:px-8 py-4 rounded-full text-center'}>\n                <div className={viewMode === 'mobile' ? 'text-xs text-white/70' : 'text-xs sm:text-sm text-white/70'}>å‡ºç™¼æ—¥æœŸ</div>\n                <div className={viewMode === 'mobile' ? 'font-bold text-sm text-white' : 'font-bold text-base sm:text-xl text-white'}>{data.departureDate}</div>\n              </div>\n              <div className={viewMode === 'mobile' ? 'bg-white/10 backdrop-blur-md border border-white/20 px-4 py-2 rounded-full text-center' : 'bg-white/10 backdrop-blur-md border border-white/20 px-6 sm:px-8 py-4 rounded-full text-center'}>\n                <div className={viewMode === 'mobile' ? 'text-xs text-white/70' : 'text-xs sm:text-sm text-white/70'}>è¡Œç¨‹ä»£ç¢¼</div>\n                <div className={viewMode === 'mobile' ? 'font-bold text-sm text-white' : 'font-bold text-base sm:text-xl text-white'}>{data.tourCode}</div>\n              </div>\n            </motion.div>\n          </motion.div>\n\n          {/* æ»¾å‹•æç¤º */}\n          <motion.div\n            className=\"text-white/80 text-center\"\n            animate={{ y: [0, 10, 0] }}\n            transition={{ duration: 2, repeat: Infinity }}\n          >\n            <p className={viewMode === 'mobile' ? 'text-sm mb-2 font-medium' : 'text-sm mb-2'}>æ¢ç´¢è¡Œç¨‹</p>\n            <svg className=\"w-6 h-6 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 14l-7 7m0 0l-7-7m7 7V3\" />\n            </svg>\n          </motion.div>\n        </div>\n      </section>\n\n      {/* åˆ†éš”ç·š */}\n      <div className=\"border-t border-border\"></div>\n\n      {/* èˆªç­è³‡è¨Š */}\n      <section id=\"flight\" className={viewMode === 'mobile' ? 'pt-4 pb-8 bg-white' : 'pt-8 pb-16 bg-white'}>\n        <div className={viewMode === 'mobile' ? 'px-4' : 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'}>\n          <div className={viewMode === 'mobile' ? 'grid grid-cols-1 gap-4' : 'grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6'}>\n            {/* å»ç¨‹èˆªç­ */}\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              whileInView={{ opacity: 1, x: 0 }}\n              viewport={{ once: true }}\n              className=\"bg-white rounded-2xl shadow-xl p-6 border border-border\"\n            >\n              <div className=\"flex items-center gap-3 mb-4\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg\">\n                  <IconPlane className=\"w-6 h-6 text-white\" />\n                </div>\n                <div>\n                  <div className=\"text-xs text-morandi-secondary\">å»ç¨‹èˆªç­</div>\n                  <div className=\"text-xl font-bold text-morandi-primary\">\n                    {data.outboundFlight?.airline || \"ä¸­è¯èˆªç©º\"} {data.outboundFlight?.flightNumber || \"CI110\"}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"text-xs text-morandi-secondary mb-1\">å‡ºç™¼</div>\n                    <div className=\"text-2xl font-bold text-morandi-primary\">\n                      {data.outboundFlight?.departureAirport || \"TPE\"}\n                    </div>\n                    <div className=\"text-base text-blue-600 font-semibold\">\n                      {data.outboundFlight?.departureTime || \"06:50\"}\n                    </div>\n                    <div className=\"text-xs text-morandi-secondary mt-0.5\">\n                      {data.outboundFlight?.departureDate || \"10/21\"}\n                    </div>\n                  </div>\n\n                  <div className=\"flex-1 flex flex-col items-center px-3\">\n                    <div className=\"text-xs text-morandi-secondary mb-3\">é£›è¡Œæ™‚é–“</div>\n                    <div className=\"w-full border-t-2 border-dashed border-border relative my-2\">\n                      <div className=\"absolute -top-1.5 left-1/2 -translate-x-1/2 bg-blue-100 px-1.5 py-0.5 rounded-full\">\n                        <IconPlane className=\"w-3 h-3 text-blue-600\" />\n                      </div>\n                    </div>\n                    <div className=\"text-xs font-semibold text-morandi-primary mt-3\">\n                      {data.outboundFlight?.duration || \"2å°æ™‚5åˆ†\"}\n                    </div>\n                  </div>\n\n                  <div className=\"flex-1 text-right\">\n                    <div className=\"text-xs text-morandi-secondary mb-1\">æŠµé”</div>\n                    <div className=\"text-2xl font-bold text-morandi-primary\">\n                      {data.outboundFlight?.arrivalAirport || \"FUK\"}\n                    </div>\n                    <div className=\"text-base text-blue-600 font-semibold\">\n                      {data.outboundFlight?.arrivalTime || \"09:55\"}\n                    </div>\n                    <div className=\"text-xs text-morandi-secondary mt-0.5\">\n                      ç•¶åœ°æ™‚é–“\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n\n            {/* å›ç¨‹èˆªç­ */}\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              whileInView={{ opacity: 1, x: 0 }}\n              viewport={{ once: true }}\n              transition={{ delay: 0.2 }}\n              className=\"bg-white rounded-2xl shadow-xl p-6 border border-border\"\n            >\n              <div className=\"flex items-center gap-3 mb-4\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg\">\n                  <IconPlane className=\"w-6 h-6 text-white rotate-180\" />\n                </div>\n                <div>\n                  <div className=\"text-xs text-morandi-secondary\">å›ç¨‹èˆªç­</div>\n                  <div className=\"text-xl font-bold text-morandi-primary\">\n                    {data.returnFlight?.airline || \"ä¸­è¯èˆªç©º\"} {data.returnFlight?.flightNumber || \"CI111\"}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"text-xs text-morandi-secondary mb-1\">å‡ºç™¼</div>\n                    <div className=\"text-2xl font-bold text-morandi-primary\">\n                      {data.returnFlight?.departureAirport || \"FUK\"}\n                    </div>\n                    <div className=\"text-base text-indigo-600 font-semibold\">\n                      {data.returnFlight?.departureTime || \"11:00\"}\n                    </div>\n                    <div className=\"text-xs text-morandi-secondary mt-0.5\">\n                      {data.returnFlight?.departureDate || \"10/25\"}\n                    </div>\n                  </div>\n\n                  <div className=\"flex-1 flex flex-col items-center px-3\">\n                    <div className=\"text-xs text-morandi-secondary mb-3\">é£›è¡Œæ™‚é–“</div>\n                    <div className=\"w-full border-t-2 border-dashed border-border relative my-2\">\n                      <div className=\"absolute -top-1.5 left-1/2 -translate-x-1/2 bg-indigo-100 px-1.5 py-0.5 rounded-full\">\n                        <IconPlane className=\"w-3 h-3 text-indigo-600 rotate-180\" />\n                      </div>\n                    </div>\n                    <div className=\"text-xs font-semibold text-morandi-primary mt-3\">\n                      {data.returnFlight?.duration || \"2å°æ™‚30åˆ†\"}\n                    </div>\n                  </div>\n\n                  <div className=\"flex-1 text-right\">\n                    <div className=\"text-xs text-morandi-secondary mb-1\">æŠµé”</div>\n                    <div className=\"text-2xl font-bold text-morandi-primary\">\n                      {data.returnFlight?.arrivalAirport || \"TPE\"}\n                    </div>\n                    <div className=\"text-base text-indigo-600 font-semibold\">\n                      {data.returnFlight?.arrivalTime || \"12:30\"}\n                    </div>\n                    <div className=\"text-xs text-morandi-secondary mt-0.5\">\n                      å°ç£æ™‚é–“\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n          </div>\n        </div>\n      </section>\n\n      {/* åˆ†éš”ç·š */}\n      <div className=\"border-t border-border\"></div>\n\n      {/* è¡Œç¨‹ç‰¹è‰² */}\n      <section className={viewMode === 'mobile' ? 'pt-4 pb-8 bg-white' : 'pt-8 pb-16 bg-white'}>\n        <div className={viewMode === 'mobile' ? 'px-4' : 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'}>\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            className={viewMode === 'mobile' ? 'text-center mb-6' : 'text-center mb-8'}\n          >\n            <h2 className={viewMode === 'mobile' ? 'text-2xl font-bold text-morandi-primary' : 'text-4xl font-bold text-morandi-primary'}>\n              è¡Œç¨‹ç‰¹è‰²\n            </h2>\n          </motion.div>\n\n          {/* å„ªåŒ–ç‰ˆç‰¹è‰²å¡ç‰‡ */}\n          <div className={viewMode === 'mobile' ? 'space-y-4' : 'grid grid-cols-2 md:grid-cols-3 gap-6'}>\n            {features.map((feature: any, index: number) => {\n              const FeatureIcon = feature.iconComponent || IconSparkles;\n              return (\n                <motion.div\n                  key={index}\n                  initial={{ opacity: 0, y: 20 }}\n                  whileInView={{ opacity: 1, y: 0 }}\n                  viewport={{ once: true }}\n                  transition={{ delay: index * 0.1 }}\n                  whileHover={{ y: -5, scale: 1.02 }}\n                  className=\"group relative\"\n                >\n                  {/* èƒŒæ™¯å…‰æšˆæ•ˆæœ */}\n                  <div className=\"absolute -inset-0.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-2xl blur opacity-30 group-hover:opacity-60 transition duration-500\" />\n\n                  {/* å¡ç‰‡å…§å®¹ */}\n                  <div className={viewMode === 'mobile' ? 'relative bg-white rounded-2xl p-4 h-full flex items-center gap-4' : 'relative bg-white rounded-2xl p-6 h-full'}>\n                    {/* åœ–æ¨™ */}\n                    <div className={viewMode === 'mobile' ? 'w-12 h-12 bg-gradient-to-br from-amber-500/10 to-orange-500/10 rounded-xl flex items-center justify-center flex-shrink-0' : 'w-14 h-14 bg-gradient-to-br from-amber-500/10 to-orange-500/10 rounded-xl flex items-center justify-center mb-4'}>\n                      <FeatureIcon className={viewMode === 'mobile' ? 'w-6 h-6 text-amber-600' : 'w-7 h-7 text-amber-600'} />\n                    </div>\n\n                    {/* æ–‡å­— */}\n                    <div className={viewMode === 'mobile' ? 'flex-1 min-w-0' : ''}>\n                      <h3 className={viewMode === 'mobile' ? 'font-bold text-base mb-1 text-morandi-primary' : 'font-bold text-lg mb-2 text-morandi-primary'}>{feature.title}</h3>\n                      <p className=\"text-sm text-morandi-secondary\">\n                        {feature.description}\n                      </p>\n                    </div>\n\n                    {/* Hover æ™‚é¡¯ç¤ºçš„è£é£¾ */}\n                    {viewMode !== 'mobile' && (\n                      <div className=\"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition\">\n                        <IconSparkles className=\"w-4 h-4 text-amber-500\" />\n                      </div>\n                    )}\n                  </div>\n                </motion.div>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* åˆ†éš”ç·š */}\n      {viewMode !== 'mobile' && <div className=\"border-t border-border\"></div>}\n\n      {/* ç²¾é¸æ™¯é»å±•ç¤º */}\n      <section\n        ref={galleryRef}\n        id=\"attractions\"\n        className={viewMode === 'mobile'\n          ? 'min-h-screen flex flex-col items-center justify-center py-12'\n          : 'pt-8 pb-16 bg-white'}\n        style={viewMode === 'mobile' ? {\n          backgroundColor: `rgb(${Math.round(255 * (1 - attractionsProgress))}, ${Math.round(255 * (1 - attractionsProgress))}, ${Math.round(255 * (1 - attractionsProgress))})`,\n          transition: 'background-color 0.3s ease-out',\n        } : {}}\n      >\n        <div className={viewMode === 'mobile' ? 'px-4 w-full' : 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'}>\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            transition={{ delay: 0.2 }}\n            className={viewMode === 'mobile' ? 'text-center mb-8' : 'text-center mb-8'}\n            style={viewMode === 'mobile' ? {\n              color: `rgb(${Math.round(255 * attractionsProgress)}, ${Math.round(255 * attractionsProgress)}, ${Math.round(255 * attractionsProgress)})`,\n              transition: 'color 0.3s ease-out',\n            } : {}}\n          >\n            <h2 className={viewMode === 'mobile' ? 'text-2xl font-bold' : 'text-4xl font-bold text-morandi-primary'}>\n              ç²¾é¸æ™¯é»\n            </h2>\n          </motion.div>\n          <motion.div\n            initial={viewMode === 'mobile' ? { opacity: 0 } : { opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1 }}\n            viewport={{ once: true }}\n            transition={{ delay: 0.4, duration: 0.8, ease: \"easeOut\" }}\n            style={viewMode === 'mobile' ? {\n              transform: `scale(${0.8 + 0.2 * attractionsProgress})`,\n              transition: 'transform 0.3s ease-out',\n            } : {}}\n          >\n            <FocusCards cards={focusCards} viewMode={viewMode} />\n          </motion.div>\n        </div>\n      </section>\n\n      {/* åˆ†éš”ç·š */}\n      {viewMode !== 'mobile' && <div className=\"border-t border-border\"></div>}\n\n      {/* Itinerary Section */}\n      <section id=\"itinerary\" className={viewMode === 'mobile' ? 'bg-white pt-4 pb-8' : 'bg-white pt-8 pb-16'}>\n        <div className={viewMode === 'mobile' ? 'px-4' : 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'}>\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            className=\"text-center mb-12\"\n          >\n            <h2 className={viewMode === 'mobile' ? 'text-2xl font-bold text-morandi-primary mb-4' : 'text-4xl font-bold text-morandi-primary mb-4'}>\n              è©³ç´°è¡Œç¨‹\n            </h2>\n            <p className=\"text-xl text-morandi-secondary\">\n              {data.itinerarySubtitle || \"ç²¾å½©æ—…ç¨‹è¦åŠƒ\"}\n            </p>\n          </motion.div>\n\n          {/* Main Timeline */}\n          <div className=\"max-w-4xl mx-auto\">\n            <TracingBeam>\n              <div className=\"space-y-8\">\n                {data.dailyItinerary?.map((day: any, index: number) => (\n                    <div key={index} className=\"bg-white rounded-2xl shadow-lg p-8 border border-border\">\n                      <div className=\"flex items-center gap-4 mb-6\">\n                        <span className=\"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-full font-bold text-lg\">\n                          {day.dayLabel}\n                        </span>\n                        <span className=\"text-morandi-secondary\">{day.date}</span>\n                      </div>\n                      <h3 className=\"text-2xl font-bold text-morandi-primary mb-4\">\n                        {day.title}\n                      </h3>\n\n                      {day.highlight && (\n                        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\n                          <p className=\"text-blue-800 font-medium\">\n                            {day.highlight}\n                          </p>\n                        </div>\n                      )}\n\n                      {day.description && (\n                        <p className=\"text-morandi-secondary mb-6\">\n                          {day.description}\n                        </p>\n                      )}\n\n                      {day.activities && day.activities.length > 0 && (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n                          {day.activities.map((activity: any, actIndex: number) => (\n                            <div key={actIndex} className=\"border border-border rounded-lg p-4\">\n                              <h4 className=\"font-bold text-morandi-primary mb-2\">{activity.icon} {activity.title}</h4>\n                              <p className=\"text-sm text-morandi-secondary\">{activity.description}</p>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n\n                      {day.recommendations && day.recommendations.length > 0 && (\n                        <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-6 mb-6\">\n                          <h4 className=\"font-bold text-green-900 mb-3\">\n                            ğŸ‰ æ¨è–¦è¡Œç¨‹\n                          </h4>\n                          <ul className=\"space-y-2 text-green-800\">\n                            {day.recommendations.map((rec: string, recIndex: number) => (\n                              <li key={recIndex} className=\"flex items-center gap-2\">\n                                <span className=\"w-2 h-2 bg-green-500 rounded-full\"></span>\n                                {rec}\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                        <div className=\"bg-morandi-container/20 rounded-lg p-4\">\n                          <p className=\"text-sm text-morandi-secondary mb-1\">æ—©é¤</p>\n                          <p className=\"font-medium text-morandi-primary\">{day.meals?.breakfast || \"æ•¬è«‹è‡ªç†\"}</p>\n                        </div>\n                        <div className=\"bg-morandi-container/20 rounded-lg p-4\">\n                          <p className=\"text-sm text-morandi-secondary mb-1\">åˆé¤</p>\n                          <p className=\"font-medium text-morandi-primary\">{day.meals?.lunch || \"æ•¬è«‹è‡ªç†\"}</p>\n                        </div>\n                        <div className=\"bg-morandi-container/20 rounded-lg p-4\">\n                          <p className=\"text-sm text-morandi-secondary mb-1\">æ™šé¤</p>\n                          <p className=\"font-medium text-morandi-primary\">{day.meals?.dinner || \"æ•¬è«‹è‡ªç†\"}</p>\n                        </div>\n                      </div>\n\n                      {day.accommodation && (\n                        <div className=\"mt-6 bg-amber-50 border border-amber-200 rounded-lg p-4\">\n                          <p className=\"text-sm text-amber-800\">\n                            ğŸ¨ ä½å®¿ï¼š{day.accommodation}\n                          </p>\n                        </div>\n                      )}\n                  </div>\n                ))}\n              </div>\n            </TracingBeam>\n          </div>\n        </div>\n      </section>\n\n      {/* åˆ†éš”ç·š */}\n      <div className=\"border-t border-border\"></div>\n\n      {/* é ˜éšŠèˆ‡é›†åˆè³‡è¨Š */}\n      <section className=\"bg-white pt-8 pb-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            className=\"text-center mb-12\"\n          >\n            <h2 className={viewMode === 'mobile' ? 'text-2xl font-bold text-morandi-primary mb-4' : 'text-4xl font-bold text-morandi-primary mb-4'}>\n              é ˜éšŠèˆ‡é›†åˆè³‡è¨Š\n            </h2>\n          </motion.div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n            {/* é ˜éšŠè³‡è¨Š */}\n            <motion.div\n              initial={{ opacity: 0, x: -20 }}\n              whileInView={{ opacity: 1, x: 0 }}\n              viewport={{ once: true }}\n              className=\"bg-white rounded-2xl shadow-lg p-8 border border-border\"\n            >\n              <h3 className=\"text-2xl font-bold text-morandi-primary mb-6 flex items-center gap-3\">\n                <span className=\"text-3xl\">ğŸ‘¤</span>\n                é ˜éšŠè³‡è¨Š\n              </h3>\n              <div className=\"space-y-4\">\n                <div>\n                  <p className=\"text-sm text-morandi-secondary mb-1\">é ˜éšŠå§“å</p>\n                  <p className=\"text-lg font-semibold text-morandi-primary\">{data.leader?.name || \"å¾…å®š\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-morandi-secondary mb-1\">åœ‹å…§é›»è©±</p>\n                  <p className=\"text-lg font-semibold text-morandi-primary\">{data.leader?.domesticPhone || \"å¾…å®š\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-morandi-secondary mb-1\">åœ‹å¤–é›»è©±</p>\n                  <p className=\"text-lg font-semibold text-morandi-primary\">{data.leader?.overseasPhone || \"å¾…å®š\"}</p>\n                </div>\n              </div>\n            </motion.div>\n\n            {/* é›†åˆè³‡è¨Š */}\n            <motion.div\n              initial={{ opacity: 0, x: 20 }}\n              whileInView={{ opacity: 1, x: 0 }}\n              viewport={{ once: true }}\n              className=\"bg-white rounded-2xl shadow-lg p-8 border border-border\"\n            >\n              <h3 className=\"text-2xl font-bold text-morandi-primary mb-6 flex items-center gap-3\">\n                <span className=\"text-3xl\">ğŸ“</span>\n                é›†åˆè³‡è¨Š\n              </h3>\n              <div className=\"space-y-4\">\n                <div>\n                  <p className=\"text-sm text-morandi-secondary mb-1\">é›†åˆæ™‚é–“</p>\n                  <p className=\"text-xl font-semibold text-blue-600\">\n                    {data.meetingInfo?.time || \"å¾…å®š\"}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm text-morandi-secondary mb-1\">é›†åˆåœ°é»</p>\n                  <p className=\"text-lg font-semibold text-morandi-primary\">\n                    {data.meetingInfo?.location || \"å¾…å®š\"}\n                  </p>\n                </div>\n              </div>\n            </motion.div>\n          </div>\n        </div>\n      </section>\n\n      {/* åˆ†éš”ç·š */}\n      <div className=\"border-t border-border\"></div>\n\n      {/* Contact Section */}\n      <section id=\"contact\" className={viewMode === 'mobile' ? 'bg-gradient-to-br from-blue-600 to-indigo-600 py-12' : 'bg-gradient-to-br from-blue-600 to-indigo-600 py-20'}>\n        <div className={viewMode === 'mobile' ? 'px-4' : 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'}>\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            whileInView={{ opacity: 1, y: 0 }}\n            viewport={{ once: true }}\n            className=\"text-center mb-12\"\n          >\n            <h2 className={viewMode === 'mobile' ? 'text-2xl font-bold text-white mb-4' : 'text-4xl font-bold text-white mb-4'}>\n              è¯çµ¡æˆ‘å€‘\n            </h2>\n            <p className=\"text-xl text-blue-100\">\n              æœ‰ä»»ä½•å•é¡Œæ­¡è¿éš¨æ™‚è¯ç¹«\n            </p>\n          </motion.div>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto\">\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              viewport={{ once: true }}\n              transition={{ delay: 0.1 }}\n              className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-8 text-center\"\n            >\n              <div className=\"text-4xl mb-4\">ğŸ‘¤</div>\n              <h3 className=\"text-xl font-bold text-white mb-2\">é ˜éšŠ</h3>\n              <p className=\"text-blue-100\">{data.leader?.name || \"å¾…å®š\"}</p>\n            </motion.div>\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              viewport={{ once: true }}\n              transition={{ delay: 0.2 }}\n              className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-8 text-center\"\n            >\n              <div className=\"text-4xl mb-4\">ğŸ“±</div>\n              <h3 className=\"text-xl font-bold text-white mb-2\">åœ‹å…§é›»è©±</h3>\n              <p className=\"text-blue-100\">{data.leader?.domesticPhone || \"å¾…å®š\"}</p>\n            </motion.div>\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              whileInView={{ opacity: 1, y: 0 }}\n              viewport={{ once: true }}\n              transition={{ delay: 0.3 }}\n              className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-8 text-center\"\n            >\n              <div className=\"text-4xl mb-4\">ğŸ“</div>\n              <h3 className=\"text-xl font-bold text-white mb-2\">åœ‹å¤–é›»è©±</h3>\n              <p className=\"text-blue-100\">{data.leader?.overseasPhone || \"å¾…å®š\"}</p>\n            </motion.div>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-slate-900 py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <h3 className=\"text-2xl font-bold text-white mb-2\">Corner Travel</h3>\n            <p className=\"text-slate-300 mb-8\">æ¢ç´¢ä¸–ç•Œï¼Œå‰µé€ å›æ†¶</p>\n            <p className=\"text-slate-400 text-sm\">\n              Â© 2025 Corner Travel. All rights reserved.\n            </p>\n          </div>\n        </div>\n      </footer>\n\n      {/* æ‰‹æ©Ÿç‰ˆåº•éƒ¨å°èˆª */}\n      <div className=\"fixed bottom-4 left-1/2 -translate-x-1/2 z-50 md:hidden\">\n        <FloatingDock\n          items={navLinks.map((link: any) => ({\n            title: link.title,\n            icon: <link.icon className=\"w-5 h-5\" />,\n            href: link.href,\n          }))}\n          mobileClassName=\"block md:hidden\"\n        />\n      </div>\n\n      {/* å…¨å±ç›¸ç°¿è¦†è“‹å±¤ */}\n      {showGallery && viewMode === 'mobile' && (\n        <div className=\"fixed inset-0 bg-black z-[100] animate-fadeIn flex flex-col\">\n          {/* é ‚éƒ¨é—œé–‰æŒ‰éˆ• */}\n          <div className=\"flex-shrink-0 p-4 pt-safe\">\n            <button\n              onClick={() => {\n                setShowGallery(false);\n                document.body.style.overflow = '';\n              }}\n              className=\"text-white/80 text-lg font-medium hover:text-white transition-colors\"\n            >\n              âœ• é—œé–‰\n            </button>\n          </div>\n\n          {/* åœ–ç‰‡å®¹å™¨ - ä½”æ“šå‰©é¤˜ç©ºé–“ */}\n          <div className=\"flex-1 flex flex-col items-center justify-center overflow-hidden px-4 pb-16\">\n            <div\n              className=\"w-full h-full overflow-x-auto snap-x snap-mandatory flex hide-scrollbar\"\n              style={{ scrollSnapType: 'x mandatory' }}\n              onScroll={(e) => {\n                const container = e.currentTarget;\n                const scrollLeft = container.scrollLeft;\n                const cardWidth = container.clientWidth;\n                const index = Math.round(scrollLeft / cardWidth);\n                setCurrentImageIndex(index);\n              }}\n            >\n              {focusCards.map((card: any, index: number) => (\n                <div\n                  key={index}\n                  className=\"w-full flex-shrink-0 snap-center flex flex-col items-center justify-center gap-4 px-2\"\n                >\n                  <img\n                    src={card.src}\n                    alt={card.title}\n                    className=\"max-w-full max-h-[50vh] object-contain rounded-xl\"\n                  />\n                  <h3 className=\"text-white text-center text-xl font-medium\">\n                    {card.title}\n                  </h3>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* åº•éƒ¨æŒ‡ç¤ºå™¨ - å›ºå®šåœ¨åº•éƒ¨ */}\n          <div className=\"flex-shrink-0 pb-8 pb-safe\">\n            <div className=\"flex justify-center gap-2\">\n              {focusCards.map((_: any, index: number) => (\n                <div\n                  key={index}\n                  className={`h-2 rounded-full transition-all duration-300 ${\n                    currentImageIndex === index\n                      ? 'bg-white w-8'\n                      : 'bg-white/40 w-2'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/accounting/accounts-management.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreHorizontal' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'expandedAccount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setExpandedAccount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { useAccountingStore } from '@/stores/accounting-store';\nimport { Button } from '@/components/ui/button';\nimport {\n  Wallet,\n  CreditCard,\n  PiggyBank,\n  TrendingUp,\n  MoreHorizontal,\n  Edit,\n  Trash2,\n  Eye,\n  EyeOff\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nconst accountTypeIcons = {\n  cash: Wallet,\n  bank: CreditCard,\n  credit: CreditCard,\n  investment: TrendingUp,\n  other: PiggyBank,\n};\n\nconst accountTypeLabels = {\n  cash: 'ç¾é‡‘',\n  bank: 'éŠ€è¡Œå¸³æˆ¶',\n  credit: 'ä¿¡ç”¨å¡',\n  investment: 'æŠ•è³‡å¸³æˆ¶',\n  other: 'å…¶ä»–å¸³æˆ¶',\n};\n\nexport const AccountsManagement = React.memo(function AccountsManagement() {\n  const { accounts, updateAccount, deleteAccount } = useAccountingStore();\n  const [expandedAccount, setExpandedAccount] = useState<string | null>(null);\n\n  const handleToggleActive = (account_id: string, is_active: boolean) => {\n    updateAccount(account_id, { is_active: !is_active });\n  };\n\n  const handleDeleteAccount = (account_id: string, account_name: string) => {\n    if (confirm(`ç¢ºå®šè¦åˆªé™¤å¸³æˆ¶ã€Œ${account_name}ã€å—ï¼Ÿé€™å€‹æ“ä½œç„¡æ³•å¾©åŸã€‚`)) {\n      deleteAccount(account_id);\n    }\n  };\n\n  // æŒ‰å¸³æˆ¶é¡å‹åˆ†çµ„\n  const accountsByType = accounts.reduce((groups, account) => {\n    if (!groups[account.type]) {\n      groups[account.type] = [];\n    }\n    groups[account.type].push(account);\n    return groups;\n  }, {} as Record<string, typeof accounts>);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-xl font-semibold text-morandi-primary\">å¸³æˆ¶ç®¡ç†</h3>\n        <div className=\"text-sm text-morandi-secondary\">\n          å…± {accounts.length} å€‹å¸³æˆ¶ â€¢ æ´»èº {accounts.filter(a => a.is_active).length} å€‹\n        </div>\n      </div>\n\n      {/* å¸³æˆ¶åˆ—è¡¨ */}\n      <div className=\"space-y-8\">\n        {Object.entries(accountsByType).map(([type, accountsOfType]) => {\n          const Icon = accountTypeIcons[type as keyof typeof accountTypeIcons] || Wallet;\n          const typeLabel = accountTypeLabels[type as keyof typeof accountTypeLabels] || type;\n          const totalBalance = accountsOfType.reduce((sum, acc) => sum + acc.balance, 0);\n\n          return (\n            <div key={type} className=\"space-y-4\">\n              {/* é¡å‹æ¨™é¡Œ */}\n              <div className=\"flex items-center justify-between p-4 bg-morandi-container/20 rounded-lg\">\n                <div className=\"flex items-center space-x-3\">\n                  <Icon size={24} className=\"text-morandi-secondary\" />\n                  <div>\n                    <div className=\"font-semibold text-morandi-primary\">{typeLabel}</div>\n                    <div className=\"text-sm text-morandi-secondary\">{accountsOfType.length} å€‹å¸³æˆ¶</div>\n                  </div>\n                </div>\n                <div className={cn(\n                  \"text-xl font-bold\",\n                  totalBalance >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n                )}>\n                  {totalBalance >= 0 ? '+' : ''}NT$ {totalBalance.toLocaleString()}\n                </div>\n              </div>\n\n              {/* è©²é¡å‹çš„å¸³æˆ¶å¡ç‰‡ */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {accountsOfType.map((account) => (\n                  <div\n                    key={account.id}\n                    className={cn(\n                      \"border rounded-xl p-6 transition-all duration-200 hover:shadow-lg\",\n                      account.is_active\n                        ? \"border-border bg-white hover:border-morandi-gold/50\"\n                        : \"border-morandi-container bg-morandi-container/30 opacity-75\"\n                    )}\n                  >\n                    {/* å¸³æˆ¶æ¨™é¡Œ */}\n                    <div className=\"flex items-center justify-between mb-4\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div\n                          className=\"w-4 h-4 rounded-full flex-shrink-0\"\n                          style={{ backgroundColor: account.color }}\n                        />\n                        <div>\n                          <div className=\"font-semibold text-morandi-primary\">{account.name}</div>\n                          {account.description && (\n                            <div className=\"text-sm text-morandi-secondary\">{account.description}</div>\n                          )}\n                        </div>\n                      </div>\n\n                      {/* ç‹€æ…‹æŒ‡æ¨™ */}\n                      <div className=\"flex items-center space-x-1\">\n                        {account.is_active ? (\n                          <Eye size={16} className=\"text-morandi-green\" />\n                        ) : (\n                          <EyeOff size={16} className=\"text-morandi-secondary\" />\n                        )}\n                      </div>\n                    </div>\n\n                    {/* é¤˜é¡é¡¯ç¤º */}\n                    <div className=\"mb-4\">\n                      <div className=\"text-sm text-morandi-secondary mb-1\">\n                        {account.type === 'credit' ? 'ç›®å‰æ¬ æ¬¾' : 'å¸³æˆ¶é¤˜é¡'}\n                      </div>\n                      <div className={cn(\n                        \"text-2xl font-bold\",\n                        account.balance >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n                      )}>\n                        {account.balance >= 0 ? '+' : ''}NT$ {Math.abs(account.balance).toLocaleString()}\n                      </div>\n                    </div>\n\n                    {/* ä¿¡ç”¨å¡é¡åº¦è³‡è¨Š */}\n                    {account.type === 'credit' && account.credit_limit && (\n                      <div className=\"mb-4 p-3 bg-morandi-container/20 rounded-lg\">\n                        <div className=\"flex justify-between items-center mb-2\">\n                          <span className=\"text-sm text-morandi-secondary\">ä¿¡ç”¨é¡åº¦</span>\n                          <span className=\"text-sm font-medium text-morandi-primary\">\n                            NT$ {account.credit_limit.toLocaleString()}\n                          </span>\n                        </div>\n                        <div className=\"flex justify-between items-center\">\n                          <span className=\"text-sm text-morandi-secondary\">å¯ç”¨é¡åº¦</span>\n                          <span className=\"text-sm font-semibold text-morandi-blue\">\n                            NT$ {((account.credit_limit || 0) + account.balance).toLocaleString()}\n                          </span>\n                        </div>\n                        {/* é¡åº¦ä½¿ç”¨ç‡æ¢ */}\n                        <div className=\"mt-3\">\n                          <div className=\"flex justify-between text-xs text-morandi-secondary mb-1\">\n                            <span>ä½¿ç”¨ç‡</span>\n                            <span>{(((Math.abs(account.balance) / (account.credit_limit || 1)) * 100)).toFixed(1)}%</span>\n                          </div>\n                          <div className=\"w-full bg-morandi-container/30 rounded-full h-2\">\n                            <div\n                              className={cn(\n                                \"h-2 rounded-full transition-all duration-300\",\n                                Math.abs(account.balance) / (account.credit_limit || 1) > 0.8\n                                  ? \"bg-morandi-red\"\n                                  : Math.abs(account.balance) / (account.credit_limit || 1) > 0.5\n                                  ? \"bg-morandi-gold\"\n                                  : \"bg-morandi-green\"\n                              )}\n                              style={{\n                                width: `${Math.min(((Math.abs(account.balance) / (account.credit_limit || 1)) * 100), 100)}%`\n                              }}\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    {/* æ“ä½œæŒ‰éˆ• */}\n                    <div className=\"flex items-center justify-between pt-4 border-t border-morandi-container\">\n                      <div className=\"flex space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleToggleActive(account.id, account.is_active)}\n                          className={cn(\n                            \"text-xs\",\n                            account.is_active\n                              ? \"text-morandi-secondary hover:text-morandi-red\"\n                              : \"text-morandi-secondary hover:text-morandi-green\"\n                          )}\n                        >\n                          {account.is_active ? (\n                            <>\n                              <EyeOff size={12} className=\"mr-1\" />\n                              éš±è—\n                            </>\n                          ) : (\n                            <>\n                              <Eye size={12} className=\"mr-1\" />\n                              é¡¯ç¤º\n                            </>\n                          )}\n                        </Button>\n                      </div>\n\n                      <div className=\"flex space-x-1\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          className=\"text-xs text-morandi-secondary hover:text-morandi-primary\"\n                        >\n                          <Edit size={12} className=\"mr-1\" />\n                          ç·¨è¼¯\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteAccount(account.id, account.name)}\n                          className=\"text-xs text-morandi-secondary hover:text-morandi-red\"\n                        >\n                          <Trash2 size={12} className=\"mr-1\" />\n                          åˆªé™¤\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* å»ºç«‹æ—¥æœŸ */}\n                    <div className=\"mt-3 text-xs text-morandi-secondary\">\n                      å»ºç«‹æ–¼ {new Date(account.created_at).toLocaleDateString('zh-TW')}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          );\n        })}\n\n        {accounts.length === 0 && (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <Wallet size={24} className=\"mx-auto mb-4 opacity-50\" />\n            <p className=\"text-lg mb-2\">é‚„æ²’æœ‰ä»»ä½•å¸³æˆ¶</p>\n            <p className=\"text-sm\">é»æ“Šå³ä¸Šè§’çš„ã€Œæ–°å¢å¸³æˆ¶ã€é–‹å§‹å»ºç«‹ä½ çš„ç¬¬ä¸€å€‹éŒ¢åŒ…å§ï¼</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/accounting/accounts-overview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/accounting/add-account-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3692,3695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3692,3695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { useAccountingStore } from '@/stores/accounting-store';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  Wallet,\n  CreditCard,\n  PiggyBank,\n  TrendingUp,\n  Building2\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useEnterSubmit } from '@/hooks/useEnterSubmit';\n\ninterface AddAccountDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst accountTypes = [\n  { id: 'cash', label: 'ç¾é‡‘', icon: Wallet, color: '#10B981', description: 'ç¾é‡‘éŒ¢åŒ…ã€é›¶éŒ¢' },\n  { id: 'bank', label: 'éŠ€è¡Œå¸³æˆ¶', icon: Building2, color: '#3B82F6', description: 'å„²è“„å¸³æˆ¶ã€æ´»æœŸå­˜æ¬¾' },\n  { id: 'credit', label: 'ä¿¡ç”¨å¡', icon: CreditCard, color: '#EF4444', description: 'ä¿¡ç”¨å¡ã€ä¿¡è²¸é¡åº¦' },\n  { id: 'investment', label: 'æŠ•è³‡å¸³æˆ¶', icon: TrendingUp, color: '#8B5CF6', description: 'è‚¡ç¥¨ã€åŸºé‡‘ã€æŠ•è³‡' },\n  { id: 'other', label: 'å…¶ä»–å¸³æˆ¶', icon: PiggyBank, color: '#F59E0B', description: 'æ•¸ä½éŒ¢åŒ…ã€å…¶ä»–è³‡ç”¢' },\n];\n\nconst predefinedColors = [\n  '#10B981', // ç¶ è‰²\n  '#3B82F6', // è—è‰²\n  '#EF4444', // ç´…è‰²\n  '#8B5CF6', // ç´«è‰²\n  '#F59E0B', // æ©˜è‰²\n  '#EC4899', // ç²‰ç´…\n  '#6B7280', // ç°è‰²\n  '#84CC16', // èŠå§†ç¶ \n];\n\nexport function AddAccountDialog({ isOpen, onClose }: AddAccountDialogProps) {\n  const { addAccount } = useAccountingStore();\n  const [formData, setFormData] = useState<{\n    name: string;\n    type: 'cash' | 'bank' | 'credit' | 'investment' | 'other';\n    balance: string;\n    credit_limit: string;\n    color: string;\n    description: string;\n  }>({\n    name: '',\n    type: 'cash',\n    balance: '',\n    credit_limit: '', // ä¿¡ç”¨é¡åº¦\n    color: '#10B981',\n    description: '',\n  });\n\n  const handleSubmit = () => {\n    if (!formData.name.trim()) return;\n\n    const selectedType = accountTypes.find(t => t.id === formData.type);\n\n    const accountData = {\n      name: formData.name.trim(),\n      type: formData.type,\n      balance: parseFloat(formData.balance) || 0,\n      currency: 'TWD',\n      icon: selectedType?.icon.name || 'Wallet',\n      color: formData.color,\n      is_active: true,\n      description: formData.description.trim(),\n      // ä¿¡ç”¨å¡ç›¸é—œæ¬„ä½\n      ...(formData.type === 'credit' && {\n        credit_limit: parseFloat(formData.credit_limit) || 0,\n        available_credit: (parseFloat(formData.credit_limit) || 0) + (parseFloat(formData.balance) || 0),\n      }),\n    };\n\n    addAccount(accountData);\n    resetForm();\n    onClose();\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      type: 'cash',\n      balance: '',\n      credit_limit: '',\n      color: '#10B981',\n      description: '',\n    });\n  };\n\n  const handleClose = () => {\n    resetForm();\n    onClose();\n  };\n\n  const selectedAccountType = accountTypes.find(t => t.id === formData.type);\n  const { handleKeyDown, compositionProps } = useEnterSubmit(handleSubmit);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-lg\">\n        <DialogHeader>\n          <DialogTitle>æ–°å¢å¸³æˆ¶</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* å¸³æˆ¶é¡å‹é¸æ“‡ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary mb-3 block\">å¸³æˆ¶é¡å‹</label>\n            <div className=\"grid grid-cols-1 gap-3\">\n              {accountTypes.map((type) => {\n                const Icon = type.icon;\n                const isSelected = formData.type === type.id;\n                return (\n                  <button\n                    key={type.id}\n                    onClick={() => setFormData(prev => ({\n                      ...prev,\n                      type: type.id as any,\n                      color: type.color\n                    }))}\n                    className={cn(\n                      'p-4 rounded-lg border-2 transition-all flex items-center space-x-4 text-left',\n                      isSelected\n                        ? 'border-morandi-gold bg-morandi-gold/5'\n                        : 'border-morandi-container hover:border-morandi-container-hover'\n                    )}\n                  >\n                    <div\n                      className=\"w-10 h-10 rounded-lg flex items-center justify-center text-white\"\n                      style={{ backgroundColor: type.color }}\n                    >\n                      <Icon size={20} />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"font-medium text-morandi-primary\">{type.label}</div>\n                      <div className=\"text-sm text-morandi-secondary\">{type.description}</div>\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* å¸³æˆ¶åç¨± */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">å¸³æˆ¶åç¨±</label>\n            <Input\n              value={formData.name}\n              onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n              onKeyDown={handleKeyDown}\n              {...compositionProps}\n              placeholder={`è¼¸å…¥${selectedAccountType?.label}åç¨±`}\n              className=\"mt-1\"\n            />\n          </div>\n\n          {/* åˆå§‹é¤˜é¡ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">\n              {formData.type === 'credit' ? 'ç›®å‰æ¬ æ¬¾é‡‘é¡' : 'åˆå§‹é¤˜é¡'}\n            </label>\n            <div className=\"mt-1 relative\">\n              <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary\">NT$</span>\n              <Input\n                type=\"number\"\n                value={formData.balance}\n                onChange={(e) => setFormData(prev => ({ ...prev, balance: e.target.value }))}\n                onKeyDown={handleKeyDown}\n                {...compositionProps}\n                placeholder=\"0\"\n                className=\"pl-12\"\n                step=\"1\"\n              />\n            </div>\n            {formData.type === 'credit' && (\n              <div className=\"text-xs text-morandi-secondary mt-1\">\n                ğŸ’¡ ä¿¡ç”¨å¡è«‹è¼¸å…¥è² æ•¸ï¼ˆå¦‚ï¼š-5000 è¡¨ç¤ºæ¬ æ¬¾5000å…ƒï¼‰\n              </div>\n            )}\n          </div>\n\n          {/* ä¿¡ç”¨å¡é¡åº¦ */}\n          {formData.type === 'credit' && (\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">ä¿¡ç”¨é¡åº¦</label>\n              <div className=\"mt-1 relative\">\n                <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary\">NT$</span>\n                <Input\n                  type=\"number\"\n                  value={formData.credit_limit}\n                  onChange={(e) => setFormData(prev => ({ ...prev, credit_limit: e.target.value }))}\n                  onKeyDown={handleKeyDown}\n                  {...compositionProps}\n                  placeholder=\"50000\"\n                  className=\"pl-12\"\n                  min=\"0\"\n                  step=\"1000\"\n                />\n              </div>\n              <div className=\"text-xs text-morandi-secondary mt-1\">\n                è¨­å®šé€™å¼µä¿¡ç”¨å¡çš„ç¸½é¡åº¦é™åˆ¶\n              </div>\n            </div>\n          )}\n\n          {/* é¡è‰²é¸æ“‡ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">é¡è‰²æ¨™è­˜</label>\n            <div className=\"mt-2 flex flex-wrap gap-3\">\n              {predefinedColors.map((color) => (\n                <button\n                  key={color}\n                  onClick={() => setFormData(prev => ({ ...prev, color }))}\n                  className={cn(\n                    'w-8 h-8 rounded-full border-2 transition-all',\n                    formData.color === color\n                      ? 'border-morandi-primary scale-110'\n                      : 'border-morandi-container hover:border-morandi-container-hover'\n                  )}\n                  style={{ backgroundColor: color }}\n                />\n              ))}\n            </div>\n          </div>\n\n          {/* æè¿° */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">å‚™è¨»èªªæ˜</label>\n            <Input\n              value={formData.description}\n              onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n              onKeyDown={handleKeyDown}\n              {...compositionProps}\n              placeholder=\"è¼¸å…¥å¸³æˆ¶å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n              className=\"mt-1\"\n            />\n          </div>\n\n          {/* é è¦½å¡ç‰‡ */}\n          {formData.name && (\n            <div className=\"p-4 bg-morandi-container/10 rounded-lg\">\n              <div className=\"text-sm font-medium text-morandi-secondary mb-2\">é è¦½</div>\n              <div className=\"flex items-center space-x-3\">\n                <div\n                  className=\"w-4 h-4 rounded-full\"\n                  style={{ backgroundColor: formData.color }}\n                />\n                <div className=\"flex-1\">\n                  <div className=\"font-medium text-morandi-primary\">{formData.name}</div>\n                  {formData.description && (\n                    <div className=\"text-sm text-morandi-secondary\">{formData.description}</div>\n                  )}\n                </div>\n                <div className={cn(\n                  \"font-semibold\",\n                  parseFloat(formData.balance) >= 0 ? \"text-morandi-green\" : \"text-morandi-red\"\n                )}>\n                  {parseFloat(formData.balance) >= 0 ? '+' : ''}\n                  NT$ {Math.abs(parseFloat(formData.balance) || 0).toLocaleString()}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* æŒ‰éˆ• */}\n          <div className=\"flex justify-end space-x-3 pt-4\">\n            <Button variant=\"outline\" onClick={handleClose}>\n              å–æ¶ˆ\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={!formData.name.trim()}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              å»ºç«‹å¸³æˆ¶\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/accounting/add-transaction-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3911,3914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3911,3914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { useAccountingStore } from '@/stores/accounting-store';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { ArrowUpRight, ArrowDownRight, ArrowRightLeft } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useEnterSubmit } from '@/hooks/useEnterSubmit';\n\ninterface AddTransactionDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function AddTransactionDialog({ isOpen, onClose }: AddTransactionDialogProps) {\n  const { accounts, categories, addTransaction } = useAccountingStore();\n  const [transactionType, setTransactionType] = useState<'income' | 'expense' | 'transfer'>('expense');\n  const [formData, setFormData] = useState({\n    account_id: accounts.length > 0 ? accounts[0].id : '',\n    category_id: '',\n    amount: '',\n    description: '',\n    date: new Date().toISOString().split('T')[0],\n    to_account_id: '', // è½‰å¸³ç›®æ¨™å¸³æˆ¶\n  });\n\n  const handleSubmit = () => {\n    if (!formData.account_id || !formData.amount || (!formData.category_id && transactionType !== 'transfer')) {\n      return;\n    }\n\n    const account = accounts.find(acc => acc.id === formData.account_id);\n    const category = categories.find(cat => cat.id === formData.category_id);\n    const toAccount = formData.to_account_id ? accounts.find(acc => acc.id === formData.to_account_id) : undefined;\n\n    const transactionData = {\n      account_id: formData.account_id,\n      account_name: account?.name || '',\n      category_id: transactionType === 'transfer' ? categories.find(c => c.type === 'transfer')?.id || '' : formData.category_id,\n      category_name: transactionType === 'transfer' ? 'è½‰å¸³' : (category?.name || ''),\n      type: transactionType,\n      amount: parseFloat(formData.amount),\n      currency: 'TWD',\n      description: formData.description,\n      date: formData.date,\n      ...(transactionType === 'transfer' && {\n        to_account_id: formData.to_account_id,\n        to_account_name: toAccount?.name || '',\n      }),\n    };\n\n    addTransaction(transactionData);\n    resetForm();\n    onClose();\n  };\n\n  const resetForm = () => {\n    setFormData({\n      account_id: '',\n      category_id: '',\n      amount: '',\n      description: '',\n      date: new Date().toISOString().split('T')[0],\n      to_account_id: '',\n    });\n    setTransactionType('expense');\n  };\n\n  const handleClose = () => {\n    resetForm();\n    onClose();\n  };\n\n  const filteredCategories = categories.filter(category =>\n    transactionType === 'transfer' ? category.type === 'transfer' : category.type === transactionType\n  );\n\n  const transactionTypes = [\n    { id: 'income', label: 'æ”¶å…¥', icon: ArrowUpRight, color: 'text-morandi-green', bgColor: 'bg-morandi-green/10' },\n    { id: 'expense', label: 'æ”¯å‡º', icon: ArrowDownRight, color: 'text-morandi-red', bgColor: 'bg-morandi-red/10' },\n    { id: 'transfer', label: 'è½‰å¸³', icon: ArrowRightLeft, color: 'text-morandi-blue', bgColor: 'bg-morandi-blue/10' },\n  ];\n\n  const { handleKeyDown, compositionProps } = useEnterSubmit(handleSubmit);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-md\">\n        <DialogHeader>\n          <DialogTitle>æ–°å¢äº¤æ˜“</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* äº¤æ˜“é¡å‹é¸æ“‡ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary mb-3 block\">äº¤æ˜“é¡å‹</label>\n            <div className=\"grid grid-cols-3 gap-2\">\n              {transactionTypes.map((type) => {\n                const Icon = type.icon;\n                const isSelected = transactionType === type.id;\n                return (\n                  <button\n                    key={type.id}\n                    onClick={() => setTransactionType(type.id as any)}\n                    className={cn(\n                      'p-3 rounded-lg border-2 transition-all flex flex-col items-center space-y-2',\n                      isSelected\n                        ? `border-current ${type.color} ${type.bgColor}`\n                        : 'border-morandi-container hover:border-morandi-container-hover text-morandi-secondary'\n                    )}\n                  >\n                    <Icon size={24} />\n                    <span className=\"text-sm font-medium\">{type.label}</span>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* å¸³æˆ¶é¸æ“‡ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">\n              {transactionType === 'transfer' ? 'å¾å¸³æˆ¶' : 'å¸³æˆ¶'}\n            </label>\n            <select\n              value={formData.account_id}\n              onChange={(e) => setFormData(prev => ({ ...prev, account_id: e.target.value }))}\n              className=\"mt-1 w-full p-3 border border-border rounded-md bg-background\"\n            >\n              <option value=\"\">è«‹é¸æ“‡å¸³æˆ¶</option>\n              {accounts.map((account) => (\n                <option key={account.id} value={account.id}>\n                  {account.name} (NT$ {account.balance.toLocaleString()})\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* è½‰å¸³ç›®æ¨™å¸³æˆ¶ */}\n          {transactionType === 'transfer' && (\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">è½‰å…¥å¸³æˆ¶</label>\n              <select\n                value={formData.to_account_id}\n                onChange={(e) => setFormData(prev => ({ ...prev, to_account_id: e.target.value }))}\n                className=\"mt-1 w-full p-3 border border-border rounded-md bg-background\"\n              >\n                <option value=\"\">è«‹é¸æ“‡ç›®æ¨™å¸³æˆ¶</option>\n                {accounts\n                  .filter(account => account.id !== formData.account_id)\n                  .map((account) => (\n                    <option key={account.id} value={account.id}>\n                      {account.name} (NT$ {account.balance.toLocaleString()})\n                    </option>\n                  ))}\n              </select>\n            </div>\n          )}\n\n          {/* åˆ†é¡é¸æ“‡ */}\n          {transactionType !== 'transfer' && (\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">åˆ†é¡</label>\n              <select\n                value={formData.category_id}\n                onChange={(e) => setFormData(prev => ({ ...prev, category_id: e.target.value }))}\n                className=\"mt-1 w-full p-3 border border-border rounded-md bg-background\"\n              >\n                <option value=\"\">è«‹é¸æ“‡åˆ†é¡</option>\n                {filteredCategories.map((category) => (\n                  <option key={category.id} value={category.id}>\n                    {category.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n          )}\n\n          {/* é‡‘é¡ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">é‡‘é¡</label>\n            <div className=\"mt-1 relative\">\n              <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary\">NT$</span>\n              <Input\n                type=\"number\"\n                value={formData.amount}\n                onChange={(e) => setFormData(prev => ({ ...prev, amount: e.target.value }))}\n                onKeyDown={handleKeyDown}\n                {...compositionProps}\n                placeholder=\"0\"\n                className=\"pl-12 text-lg font-semibold\"\n                min=\"0\"\n                step=\"1\"\n              />\n            </div>\n          </div>\n\n          {/* æ—¥æœŸ */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">æ—¥æœŸ</label>\n            <Input\n              type=\"date\"\n              value={formData.date}\n              onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}\n              className=\"mt-1\"\n            />\n          </div>\n\n          {/* å‚™è¨» */}\n          <div>\n            <label className=\"text-sm font-medium text-morandi-primary\">å‚™è¨»</label>\n            <Input\n              value={formData.description}\n              onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n              onKeyDown={handleKeyDown}\n              {...compositionProps}\n              placeholder=\"è¼¸å…¥å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n              className=\"mt-1\"\n            />\n          </div>\n\n          {/* æŒ‰éˆ• */}\n          <div className=\"flex justify-end space-x-3 pt-4\">\n            <Button variant=\"outline\" onClick={handleClose}>\n              å–æ¶ˆ\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={!formData.account_id || !formData.amount || (!formData.category_id && transactionType !== 'transfer') || (transactionType === 'transfer' && !formData.to_account_id)}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              æ–°å¢äº¤æ˜“\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/accounting/transaction-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'categories' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'accounts' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":45},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":66,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":66,"endColumn":75,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2082,2213],"text":"{ const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n        matchesDate = transactionDate >= weekAgo;\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3262,3265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3262,3265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3710,3713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3710,3713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { useAccountingStore } from '@/stores/accounting-store';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  ArrowUpRight,\n  ArrowDownRight,\n  ArrowRightLeft,\n  Calendar,\n  Filter,\n  Search,\n  Trash2\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nconst transactionTypeIcons = {\n  income: ArrowUpRight,\n  expense: ArrowDownRight,\n  transfer: ArrowRightLeft,\n};\n\nexport const TransactionList = React.memo(function TransactionList() {\n  const { transactions, categories, accounts, deleteTransaction } = useAccountingStore();\n  const [searchText, setSearchText] = useState('');\n  const [filterType, setFilterType] = useState<'all' | 'income' | 'expense' | 'transfer'>('all');\n  const [dateRange, setDateRange] = useState<'all' | 'today' | 'week' | 'month'>('month');\n\n  const handleDeleteTransaction = (transactionId: string, description: string, amount: number) => {\n    const confirmMessage = `ç¢ºå®šè¦åˆªé™¤æ­¤ç­†äº¤æ˜“å—ï¼Ÿ\\n\\né‡‘é¡ï¼šNT$ ${amount.toLocaleString()}\\nèªªæ˜ï¼š${description || 'ç„¡'}\\n\\næ­¤æ“ä½œæœƒå½±éŸ¿å¸³æˆ¶é¤˜é¡çµ±è¨ˆã€‚`;\n\n    if (!confirm(confirmMessage)) {\n      return;\n    }\n\n    try {\n      deleteTransaction(transactionId);\n    } catch (err) {\n      console.error('åˆªé™¤äº¤æ˜“å¤±æ•—:', err);\n      alert('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  // ç¯©é¸äº¤æ˜“\n  const filteredTransactions = transactions.filter(transaction => {\n    // æœå°‹ç¯©é¸\n    const matchesSearch = !searchText ||\n      transaction.description?.toLowerCase().includes(searchText.toLowerCase()) ||\n      transaction.category_name.toLowerCase().includes(searchText.toLowerCase()) ||\n      transaction.account_name.toLowerCase().includes(searchText.toLowerCase());\n\n    // é¡å‹ç¯©é¸\n    const matchesType = filterType === 'all' || transaction.type === filterType;\n\n    // æ—¥æœŸç¯©é¸\n    let matchesDate = true;\n    const transactionDate = new Date(transaction.date);\n    const now = new Date();\n\n    switch (dateRange) {\n      case 'today':\n        matchesDate = transactionDate.toDateString() === now.toDateString();\n        break;\n      case 'week':\n        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n        matchesDate = transactionDate >= weekAgo;\n        break;\n      case 'month':\n        matchesDate = transactionDate.getMonth() === now.getMonth() &&\n                     transactionDate.getFullYear() === now.getFullYear();\n        break;\n    }\n\n    return matchesSearch && matchesType && matchesDate;\n  });\n\n  // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰\n  const sortedTransactions = filteredTransactions.sort((a, b) =>\n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n\n  return (\n    <div className=\"space-y-6\">\n      {/* ç¯©é¸å’Œæœå°‹ */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1 relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary\" size={16} />\n          <Input\n            placeholder=\"æœå°‹äº¤æ˜“...\"\n            value={searchText}\n            onChange={(e) => setSearchText(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n\n        <div className=\"flex gap-2\">\n          {/* é¡å‹ç¯©é¸ */}\n          <select\n            value={filterType}\n            onChange={(e) => setFilterType(e.target.value as any)}\n            className=\"px-3 py-2 border border-border rounded-md bg-background text-sm\"\n          >\n            <option value=\"all\">å…¨éƒ¨é¡å‹</option>\n            <option value=\"income\">æ”¶å…¥</option>\n            <option value=\"expense\">æ”¯å‡º</option>\n            <option value=\"transfer\">è½‰å¸³</option>\n          </select>\n\n          {/* æ—¥æœŸç¯©é¸ */}\n          <select\n            value={dateRange}\n            onChange={(e) => setDateRange(e.target.value as any)}\n            className=\"px-3 py-2 border border-border rounded-md bg-background text-sm\"\n          >\n            <option value=\"all\">å…¨éƒ¨æ™‚é–“</option>\n            <option value=\"today\">ä»Šå¤©</option>\n            <option value=\"week\">æœ¬é€±</option>\n            <option value=\"month\">æœ¬æœˆ</option>\n          </select>\n        </div>\n      </div>\n\n      {/* çµ±è¨ˆæ‘˜è¦ */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 p-4 bg-morandi-container/10 rounded-lg\">\n        <div className=\"text-center\">\n          <div className=\"text-sm text-morandi-secondary\">æ”¶å…¥</div>\n          <div className=\"text-lg font-semibold text-morandi-green\">\n            +NT$ {filteredTransactions\n              .filter(t => t.type === 'income')\n              .reduce((sum, t) => sum + t.amount, 0)\n              .toLocaleString()}\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-sm text-morandi-secondary\">æ”¯å‡º</div>\n          <div className=\"text-lg font-semibold text-morandi-red\">\n            -NT$ {filteredTransactions\n              .filter(t => t.type === 'expense')\n              .reduce((sum, t) => sum + t.amount, 0)\n              .toLocaleString()}\n          </div>\n        </div>\n        <div className=\"text-center\">\n          <div className=\"text-sm text-morandi-secondary\">çµé¤˜</div>\n          <div className={cn(\n            \"text-lg font-semibold\",\n            (filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0) -\n             filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0)) >= 0\n             ? \"text-morandi-green\" : \"text-morandi-red\"\n          )}>\n            {(filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0) -\n              filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0)) >= 0 ? '+' : ''}\n            NT$ {(filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0) -\n                  filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0))\n                  .toLocaleString()}\n          </div>\n        </div>\n      </div>\n\n      {/* äº¤æ˜“åˆ—è¡¨ */}\n      <div className=\"space-y-2\">\n        {sortedTransactions.length === 0 ? (\n          <div className=\"space-y-6\">\n            {/* ç©ºç‹€æ…‹æç¤º */}\n            <div className=\"text-center py-8 text-morandi-secondary\">\n              <Calendar size={48} className=\"mx-auto mb-4 opacity-50\" />\n              <p className=\"text-lg font-medium text-morandi-primary mb-2\">æ²’æœ‰æ‰¾åˆ°ç›¸ç¬¦çš„äº¤æ˜“è¨˜éŒ„</p>\n              <p className=\"text-sm text-morandi-secondary\">\n                {searchText || filterType !== 'all' || dateRange !== 'all'\n                  ? 'å˜—è©¦èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–æ–°å¢äº¤æ˜“è¨˜éŒ„'\n                  : 'é–‹å§‹æ–°å¢æ”¶å…¥ã€æ”¯å‡ºæˆ–è½‰å¸³è¨˜éŒ„'}\n              </p>\n            </div>\n\n            {/* ç¤ºä¾‹äº¤æ˜“è¨˜éŒ„ */}\n            <div className=\"border-t border-border pt-6\">\n              <h3 className=\"text-lg font-medium text-morandi-primary mb-4\">é è¦½ï¼šäº¤æ˜“è¨˜éŒ„æ¨£å¼</h3>\n              <div className=\"space-y-2\">\n                {[\n                  {\n                    type: 'income',\n                    category_name: 'è–ªè³‡æ”¶å…¥',\n                    account_name: 'å°å¹£ç¾é‡‘',\n                    description: '2024å¹´1æœˆè–ªæ°´',\n                    amount: 45000,\n                    date: new Date().toLocaleDateString('zh-TW')\n                  },\n                  {\n                    type: 'expense',\n                    category_name: 'é¤è²»',\n                    account_name: 'ä¿¡ç”¨å¡',\n                    description: 'åˆé¤ - ä¾¿ç•¶',\n                    amount: 120,\n                    date: new Date().toLocaleDateString('zh-TW')\n                  },\n                  {\n                    type: 'transfer',\n                    category_name: 'è½‰å¸³',\n                    account_name: 'éŠ€è¡Œå¸³æˆ¶',\n                    to_account_name: 'æŠ•è³‡å¸³æˆ¶',\n                    description: 'å®šæœŸæŠ•è³‡',\n                    amount: 10000,\n                    date: new Date().toLocaleDateString('zh-TW')\n                  },\n                  {\n                    type: 'expense',\n                    category_name: 'äº¤é€š',\n                    account_name: 'æ‚ éŠå¡',\n                    description: 'æ·é‹é€šå‹¤',\n                    amount: 30,\n                    date: new Date().toLocaleDateString('zh-TW')\n                  }\n                ].map((transaction, index) => {\n                  const Icon = transactionTypeIcons[transaction.type as keyof typeof transactionTypeIcons];\n                  const isIncome = transaction.type === 'income';\n                  const isExpense = transaction.type === 'expense';\n\n                  return (\n                    <div\n                      key={index}\n                      className=\"flex items-center justify-between p-4 border border-border rounded-lg opacity-60\"\n                    >\n                      <div className=\"flex items-center space-x-4\">\n                        <div className={cn(\n                          \"w-10 h-10 rounded-full flex items-center justify-center\",\n                          isIncome && \"bg-morandi-green/10\",\n                          isExpense && \"bg-morandi-red/10\",\n                          transaction.type === 'transfer' && \"bg-morandi-blue/10\"\n                        )}>\n                          <Icon className={cn(\n                            \"w-5 h-5\",\n                            isIncome && \"text-morandi-green\",\n                            isExpense && \"text-morandi-red\",\n                            transaction.type === 'transfer' && \"text-morandi-blue\"\n                          )} />\n                        </div>\n\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"font-medium text-morandi-primary\">\n                              {transaction.category_name}\n                            </span>\n                            <span className=\"text-sm text-morandi-secondary\">\n                              â€¢ {transaction.account_name}\n                            </span>\n                          </div>\n                          <div className=\"text-sm text-morandi-secondary\">\n                            {transaction.description || 'ç„¡å‚™è¨»'}\n                          </div>\n                          <div className=\"text-xs text-morandi-secondary\">\n                            {transaction.date}\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"text-right\">\n                        <div className={cn(\n                          \"text-lg font-semibold\",\n                          isIncome && \"text-morandi-green\",\n                          isExpense && \"text-morandi-red\",\n                          transaction.type === 'transfer' && \"text-morandi-blue\"\n                        )}>\n                          {isIncome && '+'}\n                          {isExpense && '-'}\n                          {transaction.type === 'transfer' && ''}\n                          NT$ {transaction.amount.toLocaleString()}\n                        </div>\n                        {transaction.type === 'transfer' && transaction.to_account_name && (\n                          <div className=\"text-xs text-morandi-secondary\">\n                            è½‰è‡³ {transaction.to_account_name}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              <div className=\"mt-6 p-4 bg-morandi-container/10 rounded-lg text-center\">\n                <p className=\"text-sm text-morandi-secondary\">\n                  ğŸ’¡ ä»¥ä¸Šç‚ºäº¤æ˜“è¨˜éŒ„æ¨£å¼é è¦½ï¼Œå¯¦éš›è³‡æ–™å»ºç«‹å¾Œå°‡é¡¯ç¤ºçœŸå¯¦å…§å®¹\n                </p>\n              </div>\n            </div>\n          </div>\n        ) : (\n          sortedTransactions.map((transaction) => {\n            const Icon = transactionTypeIcons[transaction.type];\n            const isIncome = transaction.type === 'income';\n            const isExpense = transaction.type === 'expense';\n\n            return (\n              <div\n                key={transaction.id}\n                className=\"flex items-center justify-between p-4 border border-border rounded-lg hover:bg-morandi-container/20 transition-colors group\"\n              >\n                <div className=\"flex items-center space-x-4 flex-1\">\n                  <div className={cn(\n                    \"w-10 h-10 rounded-full flex items-center justify-center\",\n                    isIncome && \"bg-morandi-green/10\",\n                    isExpense && \"bg-morandi-red/10\",\n                    transaction.type === 'transfer' && \"bg-morandi-blue/10\"\n                  )}>\n                    <Icon className={cn(\n                      \"w-5 h-5\",\n                      isIncome && \"text-morandi-green\",\n                      isExpense && \"text-morandi-red\",\n                      transaction.type === 'transfer' && \"text-morandi-blue\"\n                    )} />\n                  </div>\n\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center space-x-2\">\n                      <span className=\"font-medium text-morandi-primary\">\n                        {transaction.category_name}\n                      </span>\n                      <span className=\"text-sm text-morandi-secondary\">\n                        â€¢ {transaction.account_name}\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-morandi-secondary\">\n                      {transaction.description || 'ç„¡å‚™è¨»'}\n                    </div>\n                    <div className=\"text-xs text-morandi-secondary\">\n                      {new Date(transaction.date).toLocaleDateString('zh-TW')}\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"text-right\">\n                    <div className={cn(\n                      \"text-lg font-semibold\",\n                      isIncome && \"text-morandi-green\",\n                      isExpense && \"text-morandi-red\",\n                      transaction.type === 'transfer' && \"text-morandi-blue\"\n                    )}>\n                      {isIncome && '+'}\n                      {isExpense && '-'}\n                      {transaction.type === 'transfer' && ''}\n                      NT$ {transaction.amount.toLocaleString()}\n                    </div>\n                    {transaction.type === 'transfer' && transaction.to_account_name && (\n                      <div className=\"text-xs text-morandi-secondary\">\n                        è½‰è‡³ {transaction.to_account_name}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* åˆªé™¤æŒ‰éˆ• - æ‡¸åœé¡¯ç¤º */}\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleDeleteTransaction(transaction.id, transaction.description || '', transaction.amount)}\n                    className=\"h-8 w-8 p-0 text-morandi-red hover:bg-morandi-red/10 opacity-0 group-hover:opacity-100 transition-opacity\"\n                    title=\"åˆªé™¤äº¤æ˜“\"\n                  >\n                    <Trash2 size={14} />\n                  </Button>\n                </div>\n              </div>\n            );\n          })\n        )}\n      </div>\n\n      {/* è¼‰å…¥æ›´å¤šæŒ‰éˆ• */}\n      {sortedTransactions.length > 0 && (\n        <div className=\"text-center\">\n          <Button variant=\"outline\" size=\"sm\">\n            è¼‰å…¥æ›´å¤šäº¤æ˜“\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/calendar/calendar-settings-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/common/virtual-list.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/database-init-provider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isInitialized' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":30,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\n/**\n * è³‡æ–™åº«åˆå§‹åŒ– Provider\n *\n * åœ¨æ‡‰ç”¨å•Ÿå‹•æ™‚è‡ªå‹•æª¢æŸ¥ä¸¦åˆå§‹åŒ– IndexedDB\n * ç¢ºä¿ William ç®¡ç†å“¡å¸³è™Ÿå­˜åœ¨\n */\n\nimport { useEffect, useState } from 'react';\nimport { DatabaseInitializer } from '@/lib/db/database-initializer';\n\ninterface DatabaseInitProviderProps {\n  children: React.ReactNode;\n}\n\nexport function DatabaseInitProvider({ children }: DatabaseInitProviderProps) {\n  const [isInitialized, setIsInitialized] = useState(false);\n\n  useEffect(() => {\n    async function initializeDatabase() {\n      try {\n        await DatabaseInitializer.ensureInitialized();\n        setIsInitialized(true);\n\n        // è¼‰å…¥é©—è­‰å·¥å…·åˆ° windowï¼ˆé–‹ç™¼ç”¨ï¼‰\n        if (process.env.NODE_ENV === 'development') {\n          try {\n            await import('@/lib/db/verify-and-fix');\n          } catch (e) {\n            // å¿½ç•¥éŒ¯èª¤\n          }\n        }\n      } catch (error) {\n        console.error('âŒ è³‡æ–™åº«åˆå§‹åŒ–å¤±æ•—:', error);\n        // å³ä½¿å¤±æ•—ä¹Ÿè®“æ‡‰ç”¨ç¹¼çºŒé‹è¡Œ\n        setIsInitialized(true);\n      }\n    }\n\n    initializeDatabase();\n  }, []);\n\n  // ä¸é¡¯ç¤º loading ç•«é¢ï¼Œè®“æ‡‰ç”¨ç«‹å³æ¸²æŸ“\n  // åˆå§‹åŒ–åœ¨èƒŒæ™¯åŸ·è¡Œ\n  return <>{children}</>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/dev-auto-login.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[979,982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[979,982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\n/**\n * é–‹ç™¼æ¨¡å¼è‡ªå‹•ç™»å…¥\n * é–‹ç™¼ç’°å¢ƒä¸‹è‡ªå‹•è¨­å®šç®¡ç†å“¡èº«ä»½\n */\n\nimport { useEffect } from 'react';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { useRouter } from 'next/navigation';\n\nexport function DevAutoLogin() {\n  const router = useRouter();\n  const { user, login } = useAuthStore();\n  \n  useEffect(() => {\n    // é–‹ç™¼æ¨¡å¼ + æ²’æœ‰ç™»å…¥ = è‡ªå‹•ç™»å…¥\n    if (process.env.NODE_ENV === 'development' && !user) {\n      console.log('ğŸ”§ é–‹ç™¼æ¨¡å¼ï¼šè‡ªå‹•ç™»å…¥ç®¡ç†å“¡');\n      \n      // è¨­å®šé–‹ç™¼ç”¨æˆ¶\n      const devUser = {\n        id: '1',\n        employee_number: 'william01',\n        english_name: 'William',\n        display_name: 'William',\n        personal_info: {},\n        job_info: {\n          department: 'Management',\n          position: 'Administrator',\n        },\n        salary_info: {},\n        permissions: ['admin'], // ç®¡ç†å“¡æ¬Šé™ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½èƒ½çœ‹åˆ°\n        attendance: { leave_records: [], overtime_records: [] },\n        contracts: [],\n        status: 'active' as const\n      };\n\n      // ç™»å…¥\n      login(devUser as any);\n      \n      // å°å‘æ—…éŠåœ˜é é¢\n      router.push('/tours');\n    }\n  }, [user, login, router]);\n  \n  return null;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/editor/ExportButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62,65],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62,65],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[410,413],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[410,413],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1985,1988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1985,1988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nexport function ExportButton({ data }: { data: any }) {\n  const exportHTML = () => {\n    const html = generateFullHTML(data);\n    const blob = new Blob([html], { type: 'text/html' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${data.tourCode || 'tour'}.html`;\n    a.click();\n  };\n\n  const generateFullHTML = (data: any) => {\n    return `\n<!DOCTYPE html>\n<html lang=\"zh-TW\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${data.title} - Venturo Travel</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n</head>\n<body>\n    <!-- Hero Section -->\n    <section class=\"relative h-screen bg-gradient-to-br from-purple-900 to-blue-900 text-white\">\n      <div class=\"absolute inset-0 bg-black/30\"></div>\n      <div class=\"relative z-10 h-full flex items-center justify-center\">\n        <div class=\"text-center px-4\">\n          <h1 class=\"text-5xl md:text-7xl font-bold mb-4\">${data.title}</h1>\n          <p class=\"text-xl md:text-2xl mb-8 opacity-90\">${data.subtitle}</p>\n          <div class=\"flex flex-wrap justify-center gap-6\">\n            <div class=\"bg-white/20 backdrop-blur px-6 py-3 rounded-full\">\n              <div class=\"text-sm opacity-80\">å‡ºç™¼æ—¥æœŸ</div>\n              <div class=\"text-xl font-bold\">${data.departureDate}</div>\n            </div>\n            <div class=\"bg-white/20 backdrop-blur px-6 py-3 rounded-full\">\n              <div class=\"text-sm opacity-80\">åœ˜è²»</div>\n              <div class=\"text-xl font-bold\">NT$ ${data.price?.toLocaleString()}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <!-- Attractions -->\n    <section class=\"py-20 bg-gray-50\">\n      <div class=\"max-w-7xl mx-auto px-4\">\n        <h2 class=\"text-4xl font-bold text-center mb-12\">ç²¾é¸æ™¯é»</h2>\n        <div class=\"grid md:grid-cols-3 gap-6\">\n          ${data.attractions.map((a: any) => `\n            <div class=\"bg-white rounded-xl shadow-lg overflow-hidden\">\n              <div class=\"h-48 bg-gradient-to-br from-blue-400 to-purple-400\"></div>\n              <div class=\"p-6\">\n                <h3 class=\"text-xl font-bold mb-2\">${a.title}</h3>\n                <p class=\"text-gray-600\">${a.description}</p>\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    </section>\n\n    <!-- Leader Info -->\n    <section class=\"py-12 bg-white\">\n      <div class=\"max-w-4xl mx-auto px-4\">\n        <div class=\"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-8\">\n          <h3 class=\"text-2xl font-bold mb-6\">é ˜éšŠè³‡è¨Š</h3>\n          <div class=\"grid md:grid-cols-3 gap-4\">\n            <div>\n              <div class=\"text-sm text-gray-600\">é ˜éšŠå§“å</div>\n              <div class=\"font-bold\">${data.leader.name}</div>\n            </div>\n            <div>\n              <div class=\"text-sm text-gray-600\">åœ‹å…§é›»è©±</div>\n              <div class=\"font-bold\">${data.leader.phone}</div>\n            </div>\n            <div>\n              <div class=\"text-sm text-gray-600\">åœ‹å¤–é›»è©±</div>\n              <div class=\"font-bold\">${data.leader.overseasPhone}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n</body>\n</html>\n    `;\n  };\n\n  return (\n    <button\n      onClick={exportHTML}\n      className=\"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600\"\n    >\n      ğŸ“¥ åŒ¯å‡º HTML\n    </button>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/editor/PublishButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[241,244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[241,244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":11,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[685,688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[685,688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState } from \"react\";\nimport { useItineraryStore } from \"@/stores\";\nimport { useAuthStore } from \"@/stores/auth-store\";\nimport { useRouter } from \"next/navigation\";\n\nexport function PublishButton({ data }: { data: any }) {\n  const [saving, setSaving] = useState(false);\n  const { create, update } = useItineraryStore();\n  const { user } = useAuthStore();\n  const router = useRouter();\n\n  const saveItinerary = async () => {\n    setSaving(true);\n\n    try {\n      console.log('ğŸ” æº–å‚™å­˜æª”çš„åŸå§‹è³‡æ–™:', data);\n\n      // æ¸…ç†è³‡æ–™ï¼šç§»é™¤ React çµ„ä»¶ï¼ˆiconComponentï¼‰é¿å…åºåˆ—åŒ–éŒ¯èª¤\n      const cleanedData = {\n        ...data,\n        features: data.features?.map(({ iconComponent, ...rest }: any) => rest),\n      };\n\n      console.log('ğŸ§¹ æ¸…ç†å¾Œçš„è³‡æ–™:', cleanedData);\n\n      // å¦‚æœæœ‰ ID å°±æ›´æ–°ï¼Œæ²’æœ‰å°±æ–°å¢\n      if (data.id) {\n        await update(data.id, cleanedData);\n        alert('âœ… æ›´æ–°è¡Œç¨‹è¡¨æˆåŠŸï¼');\n      } else {\n        const newItinerary = await create(cleanedData);\n        alert('âœ… å„²å­˜è¡Œç¨‹è¡¨æˆåŠŸï¼');\n        // æ–°å¢å¾Œè·³è½‰åˆ°ç·¨è¼¯é é¢\n        if (newItinerary && newItinerary.id) {\n          router.replace(`/itinerary/${newItinerary.id}`);\n        }\n      }\n    } catch (error) {\n      console.error('å„²å­˜å¤±æ•—:', error);\n      alert('âŒ å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const isEditMode = !!data.id;\n\n  return (\n    <button\n      onClick={saveItinerary}\n      disabled={saving}\n      className=\"px-4 py-2 bg-morandi-gold hover:bg-morandi-gold-hover text-white rounded-lg text-sm font-medium disabled:opacity-50 transition-colors\"\n    >\n      {saving ? \"å„²å­˜ä¸­...\" : isEditMode ? \"ğŸ’¾ æ›´æ–°è¡Œç¨‹è¡¨\" : \"ğŸ’¾ å­˜æª”è¡Œç¨‹è¡¨\"}\n    </button>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/editor/TourForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10348,10351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10348,10351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10370,10373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10370,10373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'selectedCountry'. Either include it or remove the dependency array.","line":224,"column":6,"nodeType":"ArrayExpression","endLine":224,"endColumn":39,"suggestions":[{"desc":"Update the dependencies array to be: [data.country, countryNameToCode, selectedCountry]","fix":{"range":[11949,11982],"text":"[data.country, countryNameToCode, selectedCountry]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12031,12034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12031,12034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":239,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12327,12330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12327,12330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13629,13632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13629,13632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14206,14209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14206,14209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14809,14812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14809,14812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":328,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15118,15121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15118,15121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15167,15170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15167,15170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":358,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":358,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16204,16207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16204,16207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":382,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17096,17099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17096,17099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":693,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":693,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30288,30291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30288,30291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":752,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":752,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32765,32768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32765,32768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":875,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":875,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38000,38003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38000,38003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":959,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":959,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41575,41578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41575,41578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React from \"react\";\nimport { useAuthStore } from \"@/stores/auth-store\";\nimport { useRegionStore } from \"@/stores\";\nimport {\n  IconBuilding,\n  IconToolsKitchen2,\n  IconSparkles,\n  IconCalendar,\n  IconPlane,\n  IconMapPin,\n} from \"@tabler/icons-react\";\n\nconst iconOptions = [\n  { value: \"IconBuilding\", label: \"ğŸ¨ å»ºç¯‰/é£¯åº—\", component: IconBuilding },\n  { value: \"IconToolsKitchen2\", label: \"ğŸ½ï¸ é¤é£Ÿ\", component: IconToolsKitchen2 },\n  { value: \"IconSparkles\", label: \"âœ¨ ç‰¹è‰²\", component: IconSparkles },\n  { value: \"IconCalendar\", label: \"ğŸ“… è¡Œç¨‹\", component: IconCalendar },\n  { value: \"IconPlane\", label: \"âœˆï¸ èˆªç­\", component: IconPlane },\n  { value: \"IconMapPin\", label: \"ğŸ“ æ™¯é»\", component: IconMapPin },\n];\n\n// åŸå¸‚åœ–ç‰‡å°ç…§è¡¨ï¼ˆæ“´å……ç‰ˆï¼‰\nconst cityImages: Record<string, string> = {\n  // æ—¥æœ¬\n  \"æ±äº¬\": \"https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=1200&q=75&auto=format&fit=crop\",\n  \"äº¬éƒ½\": \"https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=1200&q=75&auto=format&fit=crop\",\n  \"å¤§é˜ª\": \"https://images.unsplash.com/photo-1590559899731-a382839e5549?w=1200&q=75&auto=format&fit=crop\",\n  \"æœ­å¹Œ\": \"https://images.unsplash.com/photo-1560932124-d6095cd5d5d7?w=1200&q=75&auto=format&fit=crop\",\n  \"æ²–ç¹©\": \"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=1200&q=75&auto=format&fit=crop\",\n  \"åå¤å±‹\": \"https://images.unsplash.com/photo-1583499976516-20fdb6a0d463?w=1200&q=75&auto=format&fit=crop\",\n  \"ç¦å²¡\": \"https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=1200&q=75&auto=format&fit=crop\",\n  \"å»£å³¶\": \"https://images.unsplash.com/photo-1578469550956-0e16b69c6a3d?w=1200&q=75&auto=format&fit=crop\",\n\n  // ä¸­åœ‹å¤§é™¸\n  \"åŒ—äº¬\": \"https://images.unsplash.com/photo-1508804185872-d7badad00f7d?w=1200&q=75&auto=format&fit=crop\",\n  \"ä¸Šæµ·\": \"https://images.unsplash.com/photo-1545893835-abaa50cbe628?w=1200&q=75&auto=format&fit=crop\",\n  \"å»£å·\": \"https://images.unsplash.com/photo-1590735213920-68192a487bc2?w=1200&q=75&auto=format&fit=crop\",\n  \"æ·±åœ³\": \"https://images.unsplash.com/photo-1548919973-5cef591cdbc9?w=1200&q=75&auto=format&fit=crop\",\n  \"å»ˆé–€\": \"https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=1200&q=75&auto=format&fit=crop\",\n  \"æ­å·\": \"https://images.unsplash.com/photo-1581481615985-ba4775734a9b?w=1200&q=75&auto=format&fit=crop\",\n  \"å—äº¬\": \"https://images.unsplash.com/photo-1569949381669-ecf31ae8e613?w=1200&q=75&auto=format&fit=crop\",\n  \"æˆéƒ½\": \"https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=1200&q=75&auto=format&fit=crop\",\n\n  // æ³°åœ‹\n  \"æ›¼è°·\": \"https://images.unsplash.com/photo-1508009603885-50cf7c579365?w=1200&q=75&auto=format&fit=crop\",\n  \"æ¸…é‚\": \"https://images.unsplash.com/photo-1563492065213-4c4bb194eefc?w=1200&q=75&auto=format&fit=crop\",\n  \"æ™®å‰\": \"https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?w=1200&q=75&auto=format&fit=crop\",\n  \"è˜‡ç¾å³¶\": \"https://images.unsplash.com/photo-1537956965359-7573183d1f57?w=1200&q=75&auto=format&fit=crop\",\n  \"ç”²ç±³\": \"https://images.unsplash.com/photo-1589394815804-964ed0be2eb5?w=1200&q=75&auto=format&fit=crop\",\n  \"çƒéš†\": \"https://images.unsplash.com/photo-1598971639058-fab3c3109a00?w=1200&q=75&auto=format&fit=crop\",\n\n  // è¶Šå—\n  \"æ²³å…§\": \"https://images.unsplash.com/photo-1509030458710-f24f3682df0d?w=1200&q=75&auto=format&fit=crop\",\n  \"èƒ¡å¿—æ˜\": \"https://images.unsplash.com/photo-1583417319070-4a69db38a482?w=1200&q=75&auto=format&fit=crop\",\n  \"å³´æ¸¯\": \"https://images.unsplash.com/photo-1559592413-7cec4d0cae2b?w=1200&q=75&auto=format&fit=crop\",\n  \"å¯Œåœ‹å³¶\": \"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=1200&q=75&auto=format&fit=crop\",\n  \"é †åŒ–\": \"https://images.unsplash.com/photo-1555881675-d8d8d7b1c157?w=1200&q=75&auto=format&fit=crop\",\n  \"å¤§å»\": \"https://images.unsplash.com/photo-1578469550956-0e16b69c6a3d?w=1200&q=75&auto=format&fit=crop\",\n\n  // éŸ“åœ‹\n  \"é¦–çˆ¾\": \"https://images.unsplash.com/photo-1517154421773-0529f29ea451?w=1200&q=75&auto=format&fit=crop\",\n  \"é‡œå±±\": \"https://images.unsplash.com/photo-1541996861-12e48df50bf5?w=1200&q=75&auto=format&fit=crop\",\n  \"æ¿Ÿå·\": \"https://images.unsplash.com/photo-1598973621853-f9a8a6e9a592?w=1200&q=75&auto=format&fit=crop\",\n  \"ä»å·\": \"https://images.unsplash.com/photo-1585124804253-3e34e05c9120?w=1200&q=75&auto=format&fit=crop\",\n  \"å¤§é‚±\": \"https://images.unsplash.com/photo-1590559899731-a382839e5549?w=1200&q=75&auto=format&fit=crop\",\n\n  // é¦¬ä¾†è¥¿äº\n  \"å‰éš†å¡\": \"https://images.unsplash.com/photo-1596422846543-75c6fc197f07?w=1200&q=75&auto=format&fit=crop\",\n  \"æª³åŸ\": \"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=1200&q=75&auto=format&fit=crop\",\n  \"æ–°å±±\": \"https://images.unsplash.com/photo-1589394815804-964ed0be2eb5?w=1200&q=75&auto=format&fit=crop\",\n  \"å¤æ™‰\": \"https://images.unsplash.com/photo-1598971639058-fab3c3109a00?w=1200&q=75&auto=format&fit=crop\",\n  \"è˜­å¡å¨\": \"https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?w=1200&q=75&auto=format&fit=crop\",\n  \"æ²™å·´\": \"https://images.unsplash.com/photo-1537956965359-7573183d1f57?w=1200&q=75&auto=format&fit=crop\",\n\n  // æ–°åŠ å¡\n  \"æ–°åŠ å¡\": \"https://images.unsplash.com/photo-1525625293386-3f8f99389edd?w=1200&q=75&auto=format&fit=crop\",\n\n  // å°å°¼\n  \"é›…åŠ é”\": \"https://images.unsplash.com/photo-1555333145-4acf190da336?w=1200&q=75&auto=format&fit=crop\",\n  \"å³‡é‡Œå³¶\": \"https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=1200&q=75&auto=format&fit=crop\",\n  \"æ—¥æƒ¹\": \"https://images.unsplash.com/photo-1558007652-8e8f7238e978?w=1200&q=75&auto=format&fit=crop\",\n  \"æ¢­ç¾…\": \"https://images.unsplash.com/photo-1589394815804-964ed0be2eb5?w=1200&q=75&auto=format&fit=crop\",\n\n  // è²å¾‹è³“\n  \"é¦¬å°¼æ‹‰\": \"https://images.unsplash.com/photo-1542704792-e30daa0f905e?w=1200&q=75&auto=format&fit=crop\",\n  \"å®¿éœ§\": \"https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=1200&q=75&auto=format&fit=crop\",\n  \"é”æ²ƒ\": \"https://images.unsplash.com/photo-1589394815804-964ed0be2eb5?w=1200&q=75&auto=format&fit=crop\",\n  \"æ€¡æœ—\": \"https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?w=1200&q=75&auto=format&fit=crop\",\n\n  // ç¾åœ‹\n  \"æ´›æ‰ç£¯\": \"https://images.unsplash.com/photo-1534190239940-9ba8944ea261?w=1200&q=75&auto=format&fit=crop\",\n  \"ç´ç´„\": \"https://images.unsplash.com/photo-1496442226666-8d4d0e62e6e9?w=1200&q=75&auto=format&fit=crop\",\n  \"æ‹‰æ–¯ç¶­åŠ æ–¯\": \"https://images.unsplash.com/photo-1605833556294-ea5c7a74f57d?w=1200&q=75&auto=format&fit=crop\",\n  \"èˆŠé‡‘å±±\": \"https://images.unsplash.com/photo-1506146332389-18140dc7b2fb?w=1200&q=75&auto=format&fit=crop\",\n  \"è¥¿é›…åœ–\": \"https://images.unsplash.com/photo-1555883006-0f5a0915a80f?w=1200&q=75&auto=format&fit=crop\",\n  \"èŠåŠ å“¥\": \"https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=1200&q=75&auto=format&fit=crop\",\n\n  // åŠ æ‹¿å¤§\n  \"æº«å“¥è¯\": \"https://images.unsplash.com/photo-1559511260-66a654ae982a?w=1200&q=75&auto=format&fit=crop\",\n  \"å¤šå€«å¤š\": \"https://images.unsplash.com/photo-1517935706615-2717063c2225?w=1200&q=75&auto=format&fit=crop\",\n  \"è’™ç‰¹å©\": \"https://images.unsplash.com/photo-1519451241324-20b4ea2c4220?w=1200&q=75&auto=format&fit=crop\",\n  \"å¡åŠ åˆ©\": \"https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=1200&q=75&auto=format&fit=crop\",\n\n  // æ¾³æ´²\n  \"é›ªæ¢¨\": \"https://images.unsplash.com/photo-1506973035872-a4ec16b8e8d9?w=1200&q=75&auto=format&fit=crop\",\n  \"å¢¨çˆ¾æœ¬\": \"https://images.unsplash.com/photo-1514395462725-fb4566210144?w=1200&q=75&auto=format&fit=crop\",\n  \"å¸ƒé‡Œæ–¯æœ¬\": \"https://images.unsplash.com/photo-1524168272322-bf73616d9cb5?w=1200&q=75&auto=format&fit=crop\",\n  \"ä¼¯æ–¯\": \"https://images.unsplash.com/photo-1591695287818-5f5d1e0bf9d3?w=1200&q=75&auto=format&fit=crop\",\n  \"é˜¿å¾·èŠå¾·\": \"https://images.unsplash.com/photo-1585779034823-7e9ac8faec70?w=1200&q=75&auto=format&fit=crop\",\n\n  // ç´è¥¿è˜­\n  \"å¥§å…‹è˜­\": \"https://images.unsplash.com/photo-1507699622108-4be3abd695ad?w=1200&q=75&auto=format&fit=crop\",\n  \"åŸºç£åŸ\": \"https://images.unsplash.com/photo-1568454537842-d933259bb258?w=1200&q=75&auto=format&fit=crop\",\n  \"å¨éˆé “\": \"https://images.unsplash.com/photo-1589690810328-8bc609bb749c?w=1200&q=75&auto=format&fit=crop\",\n  \"çš‡åé®\": \"https://images.unsplash.com/photo-1507699622108-4be3abd695ad?w=1200&q=75&auto=format&fit=crop\",\n\n  // æ­æ´²\n  \"å€«æ•¦\": \"https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=1200&q=75&auto=format&fit=crop\",\n  \"å·´é»\": \"https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=1200&q=75&auto=format&fit=crop\",\n  \"ç¾…é¦¬\": \"https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=1200&q=75&auto=format&fit=crop\",\n  \"å·´å¡éš†ç´\": \"https://images.unsplash.com/photo-1583422409516-2895a77efded?w=1200&q=75&auto=format&fit=crop\",\n  \"æŸæ—\": \"https://images.unsplash.com/photo-1560969184-10fe8719e047?w=1200&q=75&auto=format&fit=crop\",\n  \"é˜¿å§†æ–¯ç‰¹ä¸¹\": \"https://images.unsplash.com/photo-1512470876302-972faa2aa9a4?w=1200&q=75&auto=format&fit=crop\",\n  \"è˜‡é»ä¸–\": \"https://images.unsplash.com/photo-1565530844911-ec9e0d0cd81b?w=1200&q=75&auto=format&fit=crop\",\n  \"ç¶­ä¹Ÿç´\": \"https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=1200&q=75&auto=format&fit=crop\",\n\n  // åœŸè€³å…¶\n  \"ä¼Šæ–¯å¦å ¡\": \"https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?w=1200&q=75&auto=format&fit=crop\",\n  \"å®‰å¡”åˆ©äº\": \"https://images.unsplash.com/photo-1605640840605-14ac1855827b?w=1200&q=75&auto=format&fit=crop\",\n  \"å®‰å¡æ‹‰\": \"https://images.unsplash.com/photo-1611415008993-8a88f0d67e67?w=1200&q=75&auto=format&fit=crop\",\n};\n\n// æ™‚å·®å°ç…§è¡¨ï¼ˆç›¸å°æ–¼å°ç£ UTC+8ï¼‰\nconst timezoneOffset: Record<string, number> = {\n  \"ä¸­åœ‹å¤§é™¸\": 0,  // UTC+8 (èˆ‡å°ç£ç›¸åŒ)\n  \"æ—¥æœ¬\": 1,      // UTC+9\n  \"éŸ“åœ‹\": 1,      // UTC+9\n  \"æ³°åœ‹\": -1,     // UTC+7\n  \"è¶Šå—\": -1,     // UTC+7\n  \"é¦¬ä¾†è¥¿äº\": 0,  // UTC+8\n  \"æ–°åŠ å¡\": 0,    // UTC+8\n  \"å°å°¼\": 0,      // UTC+8 (é›…åŠ é”)\n  \"è²å¾‹è³“\": 0,    // UTC+8\n  \"ç¾åœ‹\": -16,    // UTC-8 (æ´›æ‰ç£¯) - æ³¨æ„ï¼šç¾åœ‹è·¨å¤šå€‹æ™‚å€\n  \"åŠ æ‹¿å¤§\": -16,  // UTC-8 (æº«å“¥è¯) - æ³¨æ„ï¼šåŠ æ‹¿å¤§è·¨å¤šå€‹æ™‚å€\n  \"æ¾³æ´²\": 2,      // UTC+10 (é›ªæ¢¨) - æ³¨æ„ï¼šæ¾³æ´²è·¨å¤šå€‹æ™‚å€\n  \"ç´è¥¿è˜­\": 4,    // UTC+12\n  \"æ­æ´²\": -7,     // UTC+1 (å€«æ•¦) - æ³¨æ„ï¼šæ­æ´²è·¨å¤šå€‹æ™‚å€\n  \"åœŸè€³å…¶\": -5,   // UTC+3\n};\n\n// è¨ˆç®—é£›è¡Œæ™‚é–“\nfunction calculateFlightDuration(\n  departureTime: string,  // æ ¼å¼: \"06:50\"\n  arrivalTime: string,    // æ ¼å¼: \"09:55\" (ç•¶åœ°æ™‚é–“)\n  timeDiff: number        // æ™‚å·®ï¼ˆå°æ™‚ï¼‰\n): string {\n  if (!departureTime || !arrivalTime) return \"\";\n\n  const [depH, depM] = departureTime.split(\":\").map(Number);\n  const [arrH, arrM] = arrivalTime.split(\":\").map(Number);\n\n  const depMinutes = depH * 60 + depM;\n  const arrMinutes = arrH * 60 + arrM - (timeDiff * 60); // è½‰æ›ç‚ºå°ç£æ™‚é–“\n\n  let duration = arrMinutes - depMinutes;\n  if (duration < 0) duration += 24 * 60; // è·¨æ—¥\n\n  const hours = Math.floor(duration / 60);\n  const minutes = duration % 60;\n\n  return `${hours}å°æ™‚${minutes}åˆ†`;\n}\n\nexport function TourForm({ data, onChange }: { data: any; onChange: (data: any) => void }) {\n  const [selectedCountry, setSelectedCountry] = React.useState<string>(data.country || \"\");\n  const [selectedCountryCode, setSelectedCountryCode] = React.useState<string>(\"\");\n  const { user } = useAuthStore();\n  const { items: regions, fetchAll } = useRegionStore();\n\n  // æ‡¶è¼‰å…¥ï¼šé€²å…¥è¡¨å–®æ™‚è¼‰å…¥ regions\n  React.useEffect(() => {\n    if (regions.length === 0) {\n      fetchAll();\n    }\n  }, [regions.length, fetchAll]);\n\n  // å¾ regions å–å¾—æ‰€æœ‰åœ‹å®¶åˆ—è¡¨\n  const allDestinations = React.useMemo(() => {\n    return regions\n      .filter(r => r.type === 'country' && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [regions]);\n\n  // å»ºç«‹åœ‹å®¶åç¨±åˆ°ä»£ç¢¼çš„å°ç…§\n  const countryNameToCode = React.useMemo(() => {\n    const map: Record<string, string> = {};\n    allDestinations.forEach(dest => {\n      map[dest.name] = dest.code;\n    });\n    return map;\n  }, [allDestinations]);\n\n  // æ ¹æ“šé¸ä¸­çš„åœ‹å®¶ä»£ç¢¼å–å¾—åŸå¸‚åˆ—è¡¨\n  const availableCities = React.useMemo(() => {\n    if (!selectedCountryCode) return [];\n    return regions\n      .filter(r => r.type === 'city' && r.country_code === selectedCountryCode && r.status === 'active' && !r._deleted)\n      .map(r => ({ code: r.code, name: r.name }));\n  }, [selectedCountryCode, regions]);\n\n  // åªåœ¨ data.country å¾å¤–éƒ¨æ”¹è®Šæ™‚åŒæ­¥ï¼ˆä¸è¦åŒ…å« selectedCountry ä¾è³´ï¼ï¼‰\n  React.useEffect(() => {\n    if (data.country && data.country !== selectedCountry) {\n      setSelectedCountry(data.country);\n      // åŒæ™‚æ›´æ–° country code\n      const code = countryNameToCode[data.country];\n      if (code) {\n        setSelectedCountryCode(code);\n      }\n    }\n  }, [data.country, countryNameToCode]);\n\n  const updateField = (field: string, value: any) => {\n    onChange({ ...data, [field]: value });\n  };\n\n  // æ›´æ–°åŸå¸‚æ™‚è‡ªå‹•è¨­å®šå°é¢åœ–ç‰‡\n  const updateCity = (city: string) => {\n    onChange({\n      ...data,\n      city,\n      coverImage: cityImages[city] || data.coverImage\n    });\n  };\n\n  const updateNestedField = (parent: string, field: string, value: any) => {\n    onChange({\n      ...data,\n      [parent]: { ...data[parent], [field]: value }\n    });\n  };\n\n  // èˆªç­è³‡è¨Šæ›´æ–°ï¼ˆè‡ªå‹•è¨ˆç®—é£›è¡Œæ™‚é–“ï¼‰\n  const updateFlightField = (flightType: 'outboundFlight' | 'returnFlight', field: string, value: string) => {\n    const updatedFlight = { ...data[flightType], [field]: value };\n\n    // è‡ªå‹•è¨ˆç®—é£›è¡Œæ™‚é–“\n    const timeDiff = timezoneOffset[selectedCountry] || 0;\n    if (field === 'departureTime' || field === 'arrivalTime') {\n      const depTime = field === 'departureTime' ? value : updatedFlight.departureTime;\n      const arrTime = field === 'arrivalTime' ? value : updatedFlight.arrivalTime;\n      updatedFlight.duration = calculateFlightDuration(depTime, arrTime, timeDiff);\n    }\n\n    onChange({\n      ...data,\n      [flightType]: updatedFlight\n    });\n  };\n\n  // ç‰¹è‰²ç®¡ç†\n  const addFeature = () => {\n    onChange({\n      ...data,\n      features: [...(data.features || []), { icon: \"IconSparkles\", title: \"\", description: \"\" }]\n    });\n  };\n\n  const updateFeature = (index: number, field: string, value: string) => {\n    const newFeatures = [...data.features];\n    newFeatures[index] = { ...newFeatures[index], [field]: value };\n    onChange({ ...data, features: newFeatures });\n  };\n\n  const removeFeature = (index: number) => {\n    const newFeatures = data.features.filter((_: any, i: number) => i !== index);\n    onChange({ ...data, features: newFeatures });\n  };\n\n  // æ™¯é»ç®¡ç†\n  const addFocusCard = () => {\n    onChange({\n      ...data,\n      focusCards: [...(data.focusCards || []), { title: \"\", src: \"\" }]\n    });\n  };\n\n  const updateFocusCard = (index: number, field: string, value: string) => {\n    const newCards = [...data.focusCards];\n    newCards[index] = { ...newCards[index], [field]: value };\n    onChange({ ...data, focusCards: newCards });\n  };\n\n  const removeFocusCard = (index: number) => {\n    const newCards = data.focusCards.filter((_: any, i: number) => i !== index);\n    onChange({ ...data, focusCards: newCards });\n  };\n\n  // é€æ—¥è¡Œç¨‹ç®¡ç†\n  const addDailyItinerary = () => {\n    onChange({\n      ...data,\n      dailyItinerary: [...(data.dailyItinerary || []), {\n        dayLabel: `Day ${(data.dailyItinerary?.length || 0) + 1}`,\n        date: \"\",\n        title: \"\",\n        highlight: \"\",\n        description: \"\",\n        activities: [],\n        recommendations: [],\n        meals: { breakfast: \"\", lunch: \"\", dinner: \"\" },\n        accommodation: \"\"\n      }]\n    });\n  };\n\n  const updateDailyItinerary = (index: number, field: string, value: any) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[index] = { ...newItinerary[index], [field]: value };\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  const removeDailyItinerary = (index: number) => {\n    const newItinerary = data.dailyItinerary\n      .filter((_: any, i: number) => i !== index)\n      .map((day: any, i: number) => ({\n        ...day,\n        dayLabel: `Day ${i + 1}` // è‡ªå‹•æ›´æ–° dayLabel\n      }));\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  // æ´»å‹•ç®¡ç†\n  const addActivity = (dayIndex: number) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[dayIndex].activities = [\n      ...(newItinerary[dayIndex].activities || []),\n      { icon: \"ğŸŒ‹\", title: \"\", description: \"\" }\n    ];\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  const updateActivity = (dayIndex: number, actIndex: number, field: string, value: string) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[dayIndex].activities[actIndex] = {\n      ...newItinerary[dayIndex].activities[actIndex],\n      [field]: value\n    };\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  const removeActivity = (dayIndex: number, actIndex: number) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[dayIndex].activities = newItinerary[dayIndex].activities.filter(\n      (_: any, i: number) => i !== actIndex\n    );\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  // æ¨è–¦è¡Œç¨‹ç®¡ç†\n  const addRecommendation = (dayIndex: number) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[dayIndex].recommendations = [\n      ...(newItinerary[dayIndex].recommendations || []),\n      \"\"\n    ];\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  const updateRecommendation = (dayIndex: number, recIndex: number, value: string) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[dayIndex].recommendations[recIndex] = value;\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  const removeRecommendation = (dayIndex: number, recIndex: number) => {\n    const newItinerary = [...data.dailyItinerary];\n    newItinerary[dayIndex].recommendations = newItinerary[dayIndex].recommendations.filter(\n      (_: any, i: number) => i !== recIndex\n    );\n    onChange({ ...data, dailyItinerary: newItinerary });\n  };\n\n  return (\n    <div className=\"p-6 space-y-8\">\n      {/* å°é¢è³‡è¨Š */}\n      <div className=\"space-y-4\">\n        <h2 className=\"text-lg font-bold text-gray-800 border-b-2 border-amber-500 pb-2\">ğŸ“¸ å°é¢è¨­å®š</h2>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">æ¨™ç±¤æ–‡å­—</label>\n          <input\n            type=\"text\"\n            value={data.tagline || \"\"}\n            onChange={(e) => updateField(\"tagline\", e.target.value)}\n            className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n            placeholder=\"Venturo Travel 2025 ç§‹å­£ç²¾é¸\"\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">ä¸»æ¨™é¡Œ</label>\n            <input\n              type=\"text\"\n              value={data.title || \"\"}\n              onChange={(e) => updateField(\"title\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n              placeholder=\"æ¼«éŠç¦å²¡\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">å‰¯æ¨™é¡Œ</label>\n            <input\n              type=\"text\"\n              value={data.subtitle || \"\"}\n              onChange={(e) => updateField(\"subtitle\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n              placeholder=\"åŠè‡ªç”±è¡Œ\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">æè¿°</label>\n          <input\n            type=\"text\"\n            value={data.description || \"\"}\n            onChange={(e) => updateField(\"description\", e.target.value)}\n            className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n            placeholder=\"2æ—¥å¸‚å€è‡ªç”±æ´»å‹• Â· ä¿è­‰å…¥ä½æº«æ³‰é£¯åº— Â· æŸ³å·éŠèˆ¹ Â· é˜¿è˜‡ç«å±±\"\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">åœ‹å®¶</label>\n            <select\n              value={selectedCountry}\n              onChange={(e) => {\n                const newCountry = e.target.value;\n                setSelectedCountry(newCountry);\n                // æ›´æ–°åœ‹å®¶ä»£ç¢¼\n                const code = countryNameToCode[newCountry];\n                setSelectedCountryCode(code || \"\");\n                // åŒæ™‚æ›´æ–°åœ‹å®¶å’Œæ¸…ç©ºåŸå¸‚ï¼Œé¿å… data è¦†è“‹å•é¡Œ\n                onChange({\n                  ...data,\n                  country: newCountry,\n                  city: \"\",\n                });\n              }}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n            >\n              <option value=\"\">è«‹é¸æ“‡åœ‹å®¶</option>\n              {allDestinations.map(dest => (\n                <option key={dest.code} value={dest.name}>{dest.name}</option>\n              ))}\n            </select>\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">åŸå¸‚</label>\n            <select\n              value={data.city || \"\"}\n              onChange={(e) => updateCity(e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n              disabled={!selectedCountry}\n            >\n              <option value=\"\">è«‹é¸æ“‡åŸå¸‚</option>\n              {availableCities.map(city => (\n                <option key={city.code} value={city.name}>{city.name}</option>\n              ))}\n            </select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">å‡ºç™¼æ—¥æœŸ</label>\n            <input\n              type=\"text\"\n              value={data.departureDate || \"\"}\n              onChange={(e) => updateField(\"departureDate\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n              placeholder=\"2025/10/21\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">è¡Œç¨‹ä»£ç¢¼</label>\n            <input\n              type=\"text\"\n              value={data.tourCode || \"\"}\n              onChange={(e) => updateField(\"tourCode\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-amber-500\"\n              placeholder=\"25JFO21CIG\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">ä½œè€…</label>\n          <div className=\"w-full px-3 py-2 border rounded-lg bg-gray-50 text-gray-600\">\n            {user?.display_name || user?.english_name || 'æœªç™»å…¥'} ({user?.employee_number || '-'})\n          </div>\n          <p className=\"text-xs text-gray-500 mt-1\">è‡ªå‹•å–å¾—ç•¶å‰ç™»å…¥ç”¨æˆ¶è³‡è¨Š</p>\n        </div>\n      </div>\n\n      {/* èˆªç­è³‡è¨Š */}\n      <div className=\"space-y-4\">\n        <h2 className=\"text-lg font-bold text-gray-800 border-b-2 border-blue-500 pb-2\">âœˆï¸ èˆªç­è³‡è¨Š</h2>\n\n        <div className=\"bg-blue-50 p-4 rounded-lg space-y-3\">\n          <h3 className=\"font-bold text-blue-900\">å»ç¨‹èˆªç­</h3>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">èˆªç©ºå…¬å¸</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.airline || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"airline\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"ä¸­è¯èˆªç©º\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">èˆªç­è™Ÿç¢¼</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.flightNumber || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"flightNumber\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"CI110\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">å‡ºç™¼æ©Ÿå ´</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.departureAirport || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"departureAirport\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"TPE\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">å‡ºç™¼æ™‚é–“</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.departureTime || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"departureTime\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"06:50\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">å‡ºç™¼æ—¥æœŸ</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.departureDate || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"departureDate\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"10/21\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">æŠµé”æ©Ÿå ´</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.arrivalAirport || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"arrivalAirport\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"FUK\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">æŠµé”æ™‚é–“</label>\n              <input\n                type=\"text\"\n                value={data.outboundFlight?.arrivalTime || \"\"}\n                onChange={(e) => updateFlightField(\"outboundFlight\", \"arrivalTime\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"09:55\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">é£›è¡Œæ™‚é–“ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</label>\n              <div className=\"w-full px-2 py-1 border rounded text-sm bg-gray-100 text-gray-700\">\n                {data.outboundFlight?.duration || \"è«‹è¼¸å…¥å‡ºç™¼/æŠµé”æ™‚é–“\"}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-indigo-50 p-4 rounded-lg space-y-3\">\n          <h3 className=\"font-bold text-indigo-900\">å›ç¨‹èˆªç­</h3>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">èˆªç©ºå…¬å¸</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.airline || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"airline\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"ä¸­è¯èˆªç©º\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">èˆªç­è™Ÿç¢¼</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.flightNumber || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"flightNumber\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"CI111\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">å‡ºç™¼æ©Ÿå ´</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.departureAirport || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"departureAirport\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"FUK\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">å‡ºç™¼æ™‚é–“</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.departureTime || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"departureTime\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"11:00\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">å‡ºç™¼æ—¥æœŸ</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.departureDate || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"departureDate\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"10/25\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">æŠµé”æ©Ÿå ´</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.arrivalAirport || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"arrivalAirport\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"TPE\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">æŠµé”æ™‚é–“</label>\n              <input\n                type=\"text\"\n                value={data.returnFlight?.arrivalTime || \"\"}\n                onChange={(e) => updateFlightField(\"returnFlight\", \"arrivalTime\", e.target.value)}\n                className=\"w-full px-2 py-1 border rounded text-sm\"\n                placeholder=\"12:30\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-gray-600 mb-1\">é£›è¡Œæ™‚é–“ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</label>\n              <div className=\"w-full px-2 py-1 border rounded text-sm bg-gray-100 text-gray-700\">\n                {data.returnFlight?.duration || \"è«‹è¼¸å…¥å‡ºç™¼/æŠµé”æ™‚é–“\"}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* è¡Œç¨‹ç‰¹è‰² */}\n      <div className=\"space-y-4\">\n        <div className=\"flex justify-between items-center border-b-2 border-orange-500 pb-2\">\n          <h2 className=\"text-lg font-bold text-gray-800\">âœ¨ è¡Œç¨‹ç‰¹è‰²</h2>\n          <button\n            onClick={addFeature}\n            className=\"px-3 py-1 bg-orange-500 text-white rounded-lg text-sm hover:bg-orange-600\"\n          >\n            + æ–°å¢ç‰¹è‰²\n          </button>\n        </div>\n\n        {data.features?.map((feature: any, index: number) => (\n          <div key={index} className=\"p-4 border-2 border-orange-200 rounded-lg space-y-3 bg-orange-50\">\n            <div className=\"flex justify-between items-start\">\n              <span className=\"text-sm font-medium text-orange-700\">ç‰¹è‰² {index + 1}</span>\n              <button\n                onClick={() => removeFeature(index)}\n                className=\"text-red-500 hover:text-red-700 text-sm\"\n              >\n                åˆªé™¤\n              </button>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">åœ–æ¨™</label>\n              <select\n                value={feature.icon}\n                onChange={(e) => updateFeature(index, \"icon\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500\"\n              >\n                {iconOptions.map(opt => (\n                  <option key={opt.value} value={opt.value}>{opt.label}</option>\n                ))}\n              </select>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">æ¨™é¡Œ</label>\n              <input\n                type=\"text\"\n                value={feature.title}\n                onChange={(e) => updateFeature(index, \"title\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500\"\n                placeholder=\"æº«æ³‰é£¯åº—é«”é©—\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">æè¿°</label>\n              <input\n                type=\"text\"\n                value={feature.description}\n                onChange={(e) => updateFeature(index, \"description\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500\"\n                placeholder=\"ä¿è­‰å…¥ä½é˜¿è˜‡æº«æ³‰é£¯åº—ï¼Œäº«å—æ—¥å¼æº«æ³‰æ–‡åŒ–\"\n              />\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* ç²¾é¸æ™¯é» */}\n      <div className=\"space-y-4\">\n        <div className=\"flex justify-between items-center border-b-2 border-green-500 pb-2\">\n          <h2 className=\"text-lg font-bold text-gray-800\">ğŸ“ ç²¾é¸æ™¯é»</h2>\n          <button\n            onClick={addFocusCard}\n            className=\"px-3 py-1 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600\"\n          >\n            + æ–°å¢æ™¯é»\n          </button>\n        </div>\n\n        {data.focusCards?.map((card: any, index: number) => (\n          <div key={index} className=\"p-4 border-2 border-green-200 rounded-lg space-y-3 bg-green-50\">\n            <div className=\"flex justify-between items-start\">\n              <span className=\"text-sm font-medium text-green-700\">æ™¯é» {index + 1}</span>\n              <button\n                onClick={() => removeFocusCard(index)}\n                className=\"text-red-500 hover:text-red-700 text-sm\"\n              >\n                åˆªé™¤\n              </button>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">æ™¯é»åç¨±</label>\n              <input\n                type=\"text\"\n                value={card.title}\n                onChange={(e) => updateFocusCard(index, \"title\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\n                placeholder=\"ç”±å¸ƒé™¢æº«æ³‰è¡—\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">åœ–ç‰‡ç¶²å€</label>\n              <input\n                type=\"text\"\n                value={card.src}\n                onChange={(e) => updateFocusCard(index, \"src\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500\"\n                placeholder=\"https://images.unsplash.com/...\"\n              />\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* é ˜éšŠ & é›†åˆè³‡è¨Š */}\n      <div className=\"space-y-4\">\n        <h2 className=\"text-lg font-bold text-gray-800 border-b-2 border-purple-500 pb-2\">ğŸ‘¤ é ˜éšŠèˆ‡é›†åˆè³‡è¨Š</h2>\n\n        <div className=\"bg-purple-50 p-4 rounded-lg space-y-3\">\n          <h3 className=\"font-bold text-purple-900\">é ˜éšŠè³‡è¨Š</h3>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">é ˜éšŠå§“å</label>\n            <input\n              type=\"text\"\n              value={data.leader?.name || \"\"}\n              onChange={(e) => updateNestedField(\"leader\", \"name\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500\"\n              placeholder=\"é¾æƒ å¦‚ å°å§\"\n            />\n          </div>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">åœ‹å…§é›»è©±</label>\n              <input\n                type=\"text\"\n                value={data.leader?.domesticPhone || \"\"}\n                onChange={(e) => updateNestedField(\"leader\", \"domesticPhone\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500\"\n                placeholder=\"+886 0928402897\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">åœ‹å¤–é›»è©±</label>\n              <input\n                type=\"text\"\n                value={data.leader?.overseasPhone || \"\"}\n                onChange={(e) => updateNestedField(\"leader\", \"overseasPhone\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500\"\n                placeholder=\"+81 08074371189\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-blue-50 p-4 rounded-lg space-y-3\">\n          <h3 className=\"font-bold text-blue-900\">é›†åˆè³‡è¨Š</h3>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">é›†åˆæ™‚é–“</label>\n            <input\n              type=\"text\"\n              value={data.meetingInfo?.time || \"\"}\n              onChange={(e) => updateNestedField(\"meetingInfo\", \"time\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"2025/10/21 04:50\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">é›†åˆåœ°é»</label>\n            <input\n              type=\"text\"\n              value={data.meetingInfo?.location || \"\"}\n              onChange={(e) => updateNestedField(\"meetingInfo\", \"location\", e.target.value)}\n              className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"æ¡ƒåœ’æ©Ÿå ´è¯èˆªç¬¬äºŒèˆªå»ˆ 7è™Ÿæ«ƒå°\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* é€æ—¥è¡Œç¨‹ */}\n      <div className=\"space-y-4\">\n        <div className=\"flex justify-between items-center border-b-2 border-red-500 pb-2\">\n          <h2 className=\"text-lg font-bold text-gray-800\">ğŸ“… é€æ—¥è¡Œç¨‹</h2>\n          <button\n            onClick={addDailyItinerary}\n            className=\"px-3 py-1 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600\"\n          >\n            + æ–°å¢å¤©æ•¸\n          </button>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">è¡Œç¨‹å‰¯æ¨™é¡Œ</label>\n          <input\n            type=\"text\"\n            value={data.itinerarySubtitle || \"\"}\n            onChange={(e) => updateField(\"itinerarySubtitle\", e.target.value)}\n            className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-red-500\"\n            placeholder=\"5å¤©4å¤œç²¾å½©æ—…ç¨‹è¦åŠƒ\"\n          />\n        </div>\n\n        {data.dailyItinerary?.map((day: any, dayIndex: number) => (\n          <div key={dayIndex} className=\"p-6 border-2 border-red-200 rounded-xl space-y-4 bg-red-50\">\n            <div className=\"flex justify-between items-start\">\n              <div className=\"flex items-center gap-3\">\n                <span className=\"bg-red-500 text-white px-3 py-1 rounded-full font-bold text-sm\">\n                  {day.dayLabel}\n                </span>\n                <span className=\"text-gray-600 text-sm\">{day.date}</span>\n              </div>\n              <button\n                onClick={() => removeDailyItinerary(dayIndex)}\n                className=\"text-red-600 hover:text-red-800 text-sm font-medium\"\n              >\n                åˆªé™¤æ­¤å¤©\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1\">Day æ¨™ç±¤</label>\n                <input\n                  type=\"text\"\n                  value={day.dayLabel}\n                  onChange={(e) => updateDailyItinerary(dayIndex, \"dayLabel\", e.target.value)}\n                  className=\"w-full px-2 py-1 border rounded text-sm\"\n                  placeholder=\"Day 1\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1\">æ—¥æœŸ</label>\n                <input\n                  type=\"text\"\n                  value={day.date}\n                  onChange={(e) => updateDailyItinerary(dayIndex, \"date\", e.target.value)}\n                  className=\"w-full px-2 py-1 border rounded text-sm\"\n                  placeholder=\"10/21 (äºŒ)\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">è¡Œç¨‹æ¨™é¡Œ</label>\n              <input\n                type=\"text\"\n                value={day.title}\n                onChange={(e) => updateDailyItinerary(dayIndex, \"title\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg\"\n                placeholder=\"å°åŒ— âœˆ ç¦å²¡ç©ºæ¸¯ â†’ ç”±å¸ƒé™¢ Â· é‡‘éºŸæ¹– â†’ é˜¿è˜‡æº«æ³‰\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">ç‰¹åˆ¥å®‰æ’ (highlight)</label>\n              <input\n                type=\"text\"\n                value={day.highlight || \"\"}\n                onChange={(e) => updateDailyItinerary(dayIndex, \"highlight\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg\"\n                placeholder=\"âœ¨ ç‰¹åˆ¥å®‰æ’ï¼šç”±å¸ƒé™¢ Â· é‡‘éºŸæ¹– ï½ æ—¥æœ¬ OL äººæ°£ NO.1 æ•£ç­–åœ°\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">æè¿°</label>\n              <textarea\n                value={day.description || \"\"}\n                onChange={(e) => updateDailyItinerary(dayIndex, \"description\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg\"\n                rows={3}\n                placeholder=\"é›†åˆæ–¼å°ç£æ¡ƒåœ’åœ‹éš›æ©Ÿå ´...\"\n              />\n            </div>\n\n            {/* æ´»å‹• */}\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <label className=\"text-sm font-medium text-gray-700\">æ™¯é»æ´»å‹•</label>\n                <button\n                  onClick={() => addActivity(dayIndex)}\n                  className=\"px-2 py-1 bg-blue-500 text-white rounded text-xs\"\n                >\n                  + æ–°å¢æ´»å‹•\n                </button>\n              </div>\n              {day.activities?.map((activity: any, actIndex: number) => (\n                <div key={actIndex} className=\"grid grid-cols-3 gap-2 bg-white p-2 rounded\">\n                  <input\n                    type=\"text\"\n                    value={activity.icon}\n                    onChange={(e) => updateActivity(dayIndex, actIndex, \"icon\", e.target.value)}\n                    className=\"px-2 py-1 border rounded text-sm\"\n                    placeholder=\"ğŸŒ‹\"\n                  />\n                  <input\n                    type=\"text\"\n                    value={activity.title}\n                    onChange={(e) => updateActivity(dayIndex, actIndex, \"title\", e.target.value)}\n                    className=\"px-2 py-1 border rounded text-sm\"\n                    placeholder=\"é˜¿è˜‡ç«å±±\"\n                  />\n                  <div className=\"flex gap-1\">\n                    <input\n                      type=\"text\"\n                      value={activity.description}\n                      onChange={(e) => updateActivity(dayIndex, actIndex, \"description\", e.target.value)}\n                      className=\"flex-1 px-2 py-1 border rounded text-sm\"\n                      placeholder=\"æè¿°\"\n                    />\n                    <button\n                      onClick={() => removeActivity(dayIndex, actIndex)}\n                      className=\"px-2 text-red-500 hover:text-red-700 text-xs\"\n                    >\n                      âœ•\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n\n            {/* æ¨è–¦è¡Œç¨‹ */}\n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between items-center\">\n                <label className=\"text-sm font-medium text-gray-700\">æ¨è–¦è¡Œç¨‹</label>\n                <button\n                  onClick={() => addRecommendation(dayIndex)}\n                  className=\"px-2 py-1 bg-green-500 text-white rounded text-xs\"\n                >\n                  + æ–°å¢æ¨è–¦\n                </button>\n              </div>\n              {day.recommendations?.map((rec: string, recIndex: number) => (\n                <div key={recIndex} className=\"flex gap-2\">\n                  <input\n                    type=\"text\"\n                    value={rec}\n                    onChange={(e) => updateRecommendation(dayIndex, recIndex, e.target.value)}\n                    className=\"flex-1 px-2 py-1 border rounded text-sm bg-white\"\n                    placeholder=\"å¤©ç¥å•†åœˆè³¼ç‰©\"\n                  />\n                  <button\n                    onClick={() => removeRecommendation(dayIndex, recIndex)}\n                    className=\"px-2 text-red-500 hover:text-red-700\"\n                  >\n                    âœ•\n                  </button>\n                </div>\n              ))}\n            </div>\n\n            {/* é¤é£Ÿ */}\n            <div className=\"grid grid-cols-3 gap-2\">\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1\">æ—©é¤</label>\n                <input\n                  type=\"text\"\n                  value={day.meals?.breakfast || \"\"}\n                  onChange={(e) => updateDailyItinerary(dayIndex, \"meals\", { ...day.meals, breakfast: e.target.value })}\n                  className=\"w-full px-2 py-1 border rounded text-sm\"\n                  placeholder=\"é£¯åº—å…§æ—©é¤\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1\">åˆé¤</label>\n                <input\n                  type=\"text\"\n                  value={day.meals?.lunch || \"\"}\n                  onChange={(e) => updateDailyItinerary(dayIndex, \"meals\", { ...day.meals, lunch: e.target.value })}\n                  className=\"w-full px-2 py-1 border rounded text-sm\"\n                  placeholder=\"åšå¤šæ‹‰éºµ (Â¥1000)\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-xs font-medium text-gray-600 mb-1\">æ™šé¤</label>\n                <input\n                  type=\"text\"\n                  value={day.meals?.dinner || \"\"}\n                  onChange={(e) => updateDailyItinerary(dayIndex, \"meals\", { ...day.meals, dinner: e.target.value })}\n                  className=\"w-full px-2 py-1 border rounded text-sm\"\n                  placeholder=\"é•·è…³èŸ¹è‡ªåŠ©é¤\"\n                />\n              </div>\n            </div>\n\n            {/* ä½å®¿ */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">ä½å®¿</label>\n              <input\n                type=\"text\"\n                value={day.accommodation || \"\"}\n                onChange={(e) => updateDailyItinerary(dayIndex, \"accommodation\", e.target.value)}\n                className=\"w-full px-3 py-2 border rounded-lg\"\n                placeholder=\"ASO RESORT GRANDVRIO HOTEL\"\n              />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/editor/TourPreview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[130,133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[130,133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport TourPage from \"@/components/TourPage\";\n\nexport function TourPreview({ data, viewMode = 'desktop' }: { data: any; viewMode?: 'desktop' | 'mobile' }) {\n  return (\n    <div style={{\n      width: viewMode === 'mobile' ? '390px' : '1200px',\n      minHeight: viewMode === 'mobile' ? '844px' : '100%',\n      position: 'relative',\n      overflow: 'hidden'\n    }}>\n      {/* åŒ…è£¹ TourPageï¼Œç¢ºä¿å…§å®¹ä¸æœƒæº¢å‡º */}\n      <div className={viewMode === 'mobile' ? 'mobile-preview-wrapper' : ''}>\n        <TourPage data={data} isPreview={true} viewMode={viewMode} />\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/error-boundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/finance/batch-receipt-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5625,5628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5625,5628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7204,7207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7204,7207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useOrderStore, useReceiptOrderStore } from '@/stores';\nimport { OrderAllocation, ReceiptPaymentItem } from '@/stores/types';\nimport { Plus, Trash2, DollarSign, AlertCircle } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface BatchReceiptDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\n// æ”¶æ¬¾æ–¹å¼é¸é …\nconst paymentMethods = [\n  { value: 'cash', label: 'ç¾é‡‘' },\n  { value: 'transfer', label: 'åŒ¯æ¬¾' },\n  { value: 'card', label: 'åˆ·å¡' },\n  { value: 'check', label: 'æ”¯ç¥¨' }\n];\n\nexport function BatchReceiptDialog({ open, onOpenChange }: BatchReceiptDialogProps) {\n  const { items: orders } = useOrderStore();\n  const { create: createReceiptOrder } = useReceiptOrderStore();\n\n  const [receiptDate, setReceiptDate] = useState(new Date().toISOString().split('T')[0]);\n  const [note, setNote] = useState('');\n\n  // è¨‚å–®åˆ†é…åˆ—è¡¨\n  const [orderAllocations, setOrderAllocations] = useState<OrderAllocation[]>([]);\n\n  // æ”¶æ¬¾é …ç›®\n  const [paymentItems, setPaymentItems] = useState<Partial<ReceiptPaymentItem>[]>([\n    {\n      payment_method: 'cash',\n      amount: 0,\n      transaction_date: new Date().toISOString().split('T')[0]\n    }\n  ]);\n\n  // å¯ç”¨è¨‚å–®ï¼ˆæœªæ”¶æ¬¾æˆ–éƒ¨åˆ†æ”¶æ¬¾ï¼‰\n  const availableOrders = useMemo(() => {\n    return orders.filter(order =>\n      order.payment_status === 'unpaid' || order.payment_status === 'partial'\n    );\n  }, [orders]);\n\n  // è¨ˆç®—ç¸½æ”¶æ¬¾é‡‘é¡\n  const totalPaymentAmount = useMemo(() => {\n    return paymentItems.reduce((sum, item) => sum + (item.amount || 0), 0);\n  }, [paymentItems]);\n\n  // è¨ˆç®—å·²åˆ†é…é‡‘é¡\n  const totalAllocatedAmount = useMemo(() => {\n    return orderAllocations.reduce((sum, allocation) => sum + allocation.allocated_amount, 0);\n  }, [orderAllocations]);\n\n  // æœªåˆ†é…é‡‘é¡\n  const unallocatedAmount = totalPaymentAmount - totalAllocatedAmount;\n\n  // æ–°å¢è¨‚å–®åˆ†é…\n  const addOrderAllocation = () => {\n    if (availableOrders.length === 0) {\n      alert('æ²’æœ‰å¯ç”¨çš„è¨‚å–®');\n      return;\n    }\n\n    const firstAvailableOrder = availableOrders[0];\n    setOrderAllocations(prev => [...prev, {\n      order_id: firstAvailableOrder.id,\n      order_number: firstAvailableOrder.code,\n      tour_id: firstAvailableOrder.tour_id,\n      code: firstAvailableOrder.code || '',\n      tour_name: firstAvailableOrder.tour_name || '',\n      contact_person: firstAvailableOrder.contact_person,\n      allocated_amount: 0\n    }]);\n  };\n\n  // ç§»é™¤è¨‚å–®åˆ†é…\n  const removeOrderAllocation = (index: number) => {\n    setOrderAllocations(prev => prev.filter((_, i) => i !== index));\n  };\n\n  // æ›´æ–°è¨‚å–®åˆ†é…\n  const updateOrderAllocation = (index: number, updates: Partial<OrderAllocation>) => {\n    setOrderAllocations(prev => prev.map((allocation, i) =>\n      i === index ? { ...allocation, ...updates } : allocation\n    ));\n  };\n\n  // é¸æ“‡è¨‚å–®\n  const selectOrder = (index: number, orderId: string) => {\n    const order = orders.find(o => o.id === orderId);\n    if (!order) return;\n\n    updateOrderAllocation(index, {\n      order_id: order.id,\n      order_number: order.code,\n      tour_id: order.tour_id,\n      code: order.code || '',\n      tour_name: order.tour_name || '',\n      contact_person: order.contact_person\n    });\n  };\n\n  // æ–°å¢æ”¶æ¬¾é …ç›®\n  const addPaymentItem = () => {\n    setPaymentItems(prev => [...prev, {\n      payment_method: 'cash',\n      amount: 0,\n      transaction_date: new Date().toISOString().split('T')[0]\n    }]);\n  };\n\n  // ç§»é™¤æ”¶æ¬¾é …ç›®\n  const removePaymentItem = (index: number) => {\n    if (paymentItems.length > 1) {\n      setPaymentItems(prev => prev.filter((_, i) => i !== index));\n    }\n  };\n\n  // æ›´æ–°æ”¶æ¬¾é …ç›®\n  const updatePaymentItem = (index: number, updates: Partial<ReceiptPaymentItem>) => {\n    setPaymentItems(prev => prev.map((item, i) =>\n      i === index ? { ...item, ...updates } : item\n    ));\n  };\n\n  // å¹³å‡åˆ†é…æœªåˆ†é…é‡‘é¡\n  const distributeEvenly = () => {\n    if (orderAllocations.length === 0 || unallocatedAmount <= 0) return;\n\n    const amountPerOrder = Math.floor(unallocatedAmount / orderAllocations.length);\n    const remainder = unallocatedAmount - (amountPerOrder * orderAllocations.length);\n\n    setOrderAllocations(prev => prev.map((allocation, index) => ({\n      ...allocation,\n      allocated_amount: allocation.allocated_amount + amountPerOrder + (index === 0 ? remainder : 0)\n    })));\n  };\n\n  // é‡ç½®è¡¨å–®\n  const resetForm = () => {\n    setReceiptDate(new Date().toISOString().split('T')[0]);\n    setNote('');\n    setOrderAllocations([]);\n    setPaymentItems([{\n      payment_method: 'cash',\n      amount: 0,\n      transaction_date: new Date().toISOString().split('T')[0]\n    }]);\n  };\n\n  // å„²å­˜\n  const handleSave = async () => {\n    if (orderAllocations.length === 0) {\n      alert('è«‹è‡³å°‘æ–°å¢ä¸€å€‹è¨‚å–®åˆ†é…');\n      return;\n    }\n\n    if (totalPaymentAmount === 0) {\n      alert('æ”¶æ¬¾é‡‘é¡ä¸èƒ½ç‚º 0');\n      return;\n    }\n\n    if (unallocatedAmount !== 0) {\n      alert(`é‚„æœ‰ NT$ ${unallocatedAmount.toLocaleString()} æœªåˆ†é…ï¼Œè«‹ç¢ºèªåˆ†é…é‡‘é¡`);\n      return;\n    }\n\n    try {\n      await createReceiptOrder({\n        allocation_mode: 'multiple',\n        order_allocations: orderAllocations,\n        receipt_date: receiptDate,\n        payment_items: paymentItems as ReceiptPaymentItem[],\n        total_amount: totalPaymentAmount,\n        status: 'å·²æ”¶æ¬¾',\n        note,\n        created_by: '1' // TODO: å¾ auth store å–å¾—ç•¶å‰ç”¨æˆ¶\n      } as any);\n\n      alert('âœ… æ‰¹é‡æ”¶æ¬¾å–®å»ºç«‹æˆåŠŸ');\n      onOpenChange(false);\n      resetForm();\n    } catch (error) {\n      console.error('å»ºç«‹æ‰¹é‡æ”¶æ¬¾å–®å¤±æ•—:', error);\n      alert('âŒ å»ºç«‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <DollarSign className=\"h-5 w-5 text-morandi-gold\" />\n            æ‰¹é‡åˆ†é…æ”¶æ¬¾ï¼ˆä¸€ç­†æ¬¾åˆ†å¤šè¨‚å–®ï¼‰\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* æ”¶æ¬¾æ—¥æœŸ */}\n          <div>\n            <Label>æ”¶æ¬¾æ—¥æœŸ</Label>\n            <Input\n              type=\"date\"\n              value={receiptDate}\n              onChange={(e) => setReceiptDate(e.target.value)}\n            />\n          </div>\n\n          {/* æ”¶æ¬¾é …ç›® */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <Label className=\"text-base font-semibold\">æ”¶æ¬¾é …ç›®</Label>\n              <Button size=\"sm\" variant=\"outline\" onClick={addPaymentItem}>\n                <Plus className=\"h-4 w-4 mr-1\" />\n                æ–°å¢æ”¶æ¬¾é …ç›®\n              </Button>\n            </div>\n\n            <div className=\"space-y-2\">\n              {paymentItems.map((item, index) => (\n                <div key={index} className=\"flex items-center gap-3 p-3 border rounded-lg\">\n                  <Select\n                    value={item.payment_method}\n                    onValueChange={(value) => updatePaymentItem(index, { payment_method: value as any })}\n                  >\n                    <SelectTrigger className=\"w-32\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {paymentMethods.map(method => (\n                        <SelectItem key={method.value} value={method.value}>\n                          {method.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n\n                  <Input\n                    type=\"number\"\n                    placeholder=\"é‡‘é¡\"\n                    value={item.amount || ''}\n                    onChange={(e) => updatePaymentItem(index, { amount: parseFloat(e.target.value) || 0 })}\n                    className=\"w-40\"\n                  />\n\n                  <Input\n                    type=\"date\"\n                    value={item.transaction_date}\n                    onChange={(e) => updatePaymentItem(index, { transaction_date: e.target.value })}\n                    className=\"w-40\"\n                  />\n\n                  {paymentItems.length > 1 && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => removePaymentItem(index)}\n                    >\n                      <Trash2 className=\"h-4 w-4 text-morandi-red\" />\n                    </Button>\n                  )}\n                </div>\n              ))}\n            </div>\n\n            <div className=\"text-right text-sm font-semibold\">\n              ç¸½æ”¶æ¬¾é‡‘é¡ï¼š\n              <span className=\"text-lg text-morandi-gold ml-2\">\n                NT$ {totalPaymentAmount.toLocaleString()}\n              </span>\n            </div>\n          </div>\n\n          {/* è¨‚å–®åˆ†é… */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <Label className=\"text-base font-semibold\">è¨‚å–®åˆ†é…</Label>\n              <div className=\"flex gap-2\">\n                <Button size=\"sm\" variant=\"outline\" onClick={distributeEvenly} disabled={orderAllocations.length === 0}>\n                  å¹³å‡åˆ†é…\n                </Button>\n                <Button size=\"sm\" variant=\"outline\" onClick={addOrderAllocation}>\n                  <Plus className=\"h-4 w-4 mr-1\" />\n                  æ–°å¢è¨‚å–®\n                </Button>\n              </div>\n            </div>\n\n            {orderAllocations.length === 0 ? (\n              <div className=\"text-center py-8 text-morandi-secondary border rounded-lg border-dashed\">\n                è«‹æ–°å¢è¨‚å–®åˆ†é…\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {orderAllocations.map((allocation, index) => (\n                  <div key={index} className=\"flex items-center gap-3 p-3 border rounded-lg bg-morandi-container/20\">\n                    <Select\n                      value={allocation.order_id}\n                      onValueChange={(value) => selectOrder(index, value)}\n                    >\n                      <SelectTrigger className=\"flex-1\">\n                        <SelectValue placeholder=\"é¸æ“‡è¨‚å–®\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {availableOrders.map(order => (\n                          <SelectItem key={order.id} value={order.id}>\n                            {order.code} - {order.contact_person} ({order.tour_name})\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n\n                    <Input\n                      type=\"number\"\n                      placeholder=\"åˆ†é…é‡‘é¡\"\n                      value={allocation.allocated_amount || ''}\n                      onChange={(e) => updateOrderAllocation(index, { allocated_amount: parseFloat(e.target.value) || 0 })}\n                      className=\"w-40\"\n                    />\n\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => removeOrderAllocation(index)}\n                    >\n                      <Trash2 className=\"h-4 w-4 text-morandi-red\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            <div className=\"flex items-center justify-between p-3 border rounded-lg bg-morandi-container/10\">\n              <div className=\"text-sm\">\n                <span className=\"text-morandi-secondary\">å·²åˆ†é…ï¼š</span>\n                <span className=\"font-semibold ml-2\">NT$ {totalAllocatedAmount.toLocaleString()}</span>\n              </div>\n              <div className={cn(\n                \"text-sm\",\n                unallocatedAmount > 0 && \"text-morandi-gold\",\n                unallocatedAmount < 0 && \"text-morandi-red\"\n              )}>\n                <span>æœªåˆ†é…ï¼š</span>\n                <span className=\"font-semibold ml-2\">NT$ {unallocatedAmount.toLocaleString()}</span>\n              </div>\n            </div>\n\n            {unallocatedAmount !== 0 && (\n              <div className=\"flex items-center gap-2 p-3 border border-morandi-gold/30 rounded-lg bg-morandi-gold/5 text-sm\">\n                <AlertCircle className=\"h-4 w-4 text-morandi-gold\" />\n                <span className=\"text-morandi-gold\">\n                  {unallocatedAmount > 0 ? 'é‚„æœ‰é‡‘é¡æœªåˆ†é…' : 'åˆ†é…é‡‘é¡è¶…éæ”¶æ¬¾é‡‘é¡'}ï¼Œè«‹èª¿æ•´åˆ†é…é‡‘é¡\n                </span>\n              </div>\n            )}\n          </div>\n\n          {/* å‚™è¨» */}\n          <div>\n            <Label>å‚™è¨»</Label>\n            <Input\n              placeholder=\"æ”¶æ¬¾å‚™è¨»ï¼ˆé¸å¡«ï¼‰\"\n              value={note}\n              onChange={(e) => setNote(e.target.value)}\n            />\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n            å–æ¶ˆ\n          </Button>\n          <Button\n            onClick={handleSave}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n            disabled={unallocatedAmount !== 0 || orderAllocations.length === 0}\n          >\n            å»ºç«‹æ‰¹é‡æ”¶æ¬¾å–®\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/home/home-settings-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/add-employee-form.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Employee' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fetchAll' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":111,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3528,3531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3528,3531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Employee } from '@/stores/types';\nimport { useUserStore, userStoreHelpers } from '@/stores/user-store';\nimport { hashPassword } from '@/lib/auth';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Copy, Check, Plus, Trash2 } from 'lucide-react';\n\ninterface AddEmployeeFormProps {\n  onSubmit: () => void;\n  onCancel: () => void;\n}\n\nexport function AddEmployeeForm({ onSubmit, onCancel }: AddEmployeeFormProps) {\n  const { create: addUser, fetchAll } = useUserStore();\n\n  // æˆåŠŸå‰µå»ºå°è©±æ¡†ç‹€æ…‹\n  const [showSuccessDialog, setShowSuccessDialog] = useState(false);\n  const [createdEmployee, setCreatedEmployee] = useState<{\n    display_name: string;\n    employee_number: string;\n    password: string;\n  } | null>(null);\n  const [copiedField, setCopiedField] = useState<string | null>(null);\n\n  const [formData, setFormData] = useState({\n    english_name: '',\n    display_name: '',\n    chinese_name: '',\n    defaultPassword: 'venturo123', // é è¨­å¯†ç¢¼\n    roles: [] as ('admin' | 'employee' | 'user' | 'tour_leader' | 'sales' | 'accountant' | 'assistant')[],\n    personal_info: {\n      national_id: '',\n      birthday: '',\n      phone: [''], // æ”¹æˆé™£åˆ—\n      email: '',\n      address: '',\n      emergency_contact: {\n        name: '',\n        relationship: '',\n        phone: ''\n      }\n    },\n    job_info: {\n      hire_date: new Date().toISOString().split('T')[0]\n    },\n    salary_info: {\n      base_salary: 0,\n      allowances: [],\n      salaryHistory: []\n    }\n  });\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!formData.english_name.trim() || !formData.display_name.trim()) {\n      alert('è«‹å¡«å¯«å§“å');\n      return;\n    }\n\n    try {\n      // ç”Ÿæˆå“¡å·¥ç·¨è™Ÿ\n      const employee_number = userStoreHelpers.generateUserNumber(formData.english_name);\n\n      // åŠ å¯†é è¨­å¯†ç¢¼\n      const hashedPassword = await hashPassword(formData.defaultPassword);\n\n      // å»ºç«‹è³‡æ–™åº«å“¡å·¥è¨˜éŒ„\n      const dbEmployeeData = {\n        employee_number: employee_number,\n        english_name: formData.english_name,\n        display_name: formData.display_name,\n        chinese_name: formData.chinese_name,\n        password_hash: hashedPassword,\n        roles: formData.roles,\n        personal_info: {\n          national_id: formData.personal_info.national_id,\n          birthday: formData.personal_info.birthday,\n          phone: formData.personal_info.phone.filter(p => p.trim() !== ''), // éæ¿¾ç©ºç™½é›»è©±\n          email: formData.personal_info.email,\n          address: formData.personal_info.address,\n          emergency_contact: {\n            name: formData.personal_info.emergency_contact.name,\n            relationship: formData.personal_info.emergency_contact.relationship,\n            phone: formData.personal_info.emergency_contact.phone\n          }\n        },\n        job_info: {\n          hire_date: formData.job_info.hire_date\n        },\n        salary_info: {\n          base_salary: formData.salary_info.base_salary,\n          allowances: [],\n          salary_history: [\n            {\n              effective_date: formData.job_info.hire_date,\n              base_salary: formData.salary_info.base_salary,\n              reason: 'å…¥è·èµ·è–ª'\n            }\n          ]\n        },\n        permissions: [], // åˆå§‹ç„¡æ¬Šé™ï¼Œéœ€è¦å¾ŒçºŒè¨­å®š\n        status: 'active' // æ–°å“¡å·¥é è¨­ç‚ºåœ¨è·ç‹€æ…‹\n      };\n\n      // å„²å­˜åˆ°æœ¬åœ°ï¼ˆç´”æœ¬åœ°æ¨¡å¼ï¼‰\n      addUser(dbEmployeeData as any);\n\n      console.log('ğŸ“¦ æœ¬åœ°æ¨¡å¼ï¼šå“¡å·¥å·²æ–°å¢', employee_number);\n\n      // é¡¯ç¤ºæˆåŠŸå°è©±æ¡†\n      setCreatedEmployee({\n        display_name: formData.display_name,\n        employee_number: employee_number,\n        password: formData.defaultPassword\n      });\n      setShowSuccessDialog(true);\n    } catch (error) {\n      console.error('å‰µå»ºå“¡å·¥å¤±æ•—:', error);\n      alert('å‰µå»ºå“¡å·¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  // è¤‡è£½åˆ°å‰ªè²¼ç°¿\n  const copyToClipboard = (text: string, field: string) => {\n    navigator.clipboard.writeText(text);\n    setCopiedField(field);\n    setTimeout(() => setCopiedField(null), 2000);\n  };\n\n  // é—œé–‰æˆåŠŸå°è©±æ¡†\n  const handleCloseSuccess = () => {\n    setShowSuccessDialog(false);\n    setCreatedEmployee(null);\n    onSubmit();\n  };\n\n  return (\n    <>\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n      {/* åŸºæœ¬è³‡æ–™ */}\n      <div className=\"space-y-4\">\n        <h3 className=\"text-lg font-semibold text-morandi-primary border-b pb-2\">åŸºæœ¬è³‡æ–™</h3>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n              é¡¯ç¤ºåç¨± *\n            </label>\n            <Input\n              value={formData.display_name}\n              onChange={(e) => setFormData({ ...formData, display_name: e.target.value })}\n              required\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n              ä¸­æ–‡å§“å\n            </label>\n            <Input\n              value={formData.chinese_name}\n              onChange={(e) => setFormData({ ...formData, chinese_name: e.target.value })}\n              placeholder=\"ä¾‹ï¼šç‹å°æ˜\"\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n              è‹±æ–‡å§“å * (ç”¨æ–¼ç”Ÿæˆå“¡å·¥ç·¨è™Ÿ)\n            </label>\n            <Input\n              value={formData.english_name}\n              onChange={(e) => setFormData({ ...formData, english_name: e.target.value })}\n              placeholder=\"ä¾‹ï¼šJohn\"\n              required\n            />\n            {formData.english_name && (\n              <p className=\"text-xs text-morandi-muted mt-1\">\n                å“¡å·¥ç·¨è™Ÿå°‡ç‚ºï¼š{userStoreHelpers.generateUserNumber(formData.english_name)}\n              </p>\n            )}\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n              å“¡å·¥ç·¨è™Ÿï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰\n            </label>\n            <Input\n              value={formData.english_name ? userStoreHelpers.generateUserNumber(formData.english_name) : ''}\n              disabled\n              className=\"bg-morandi-container/20\"\n            />\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-morandi-primary mb-1\">èº«åˆ†è­‰è™Ÿ</label>\n          <Input\n            value={formData.personal_info.national_id}\n            onChange={(e) => setFormData({\n              ...formData,\n              personal_info: { ...formData.personal_info, national_id: e.target.value }\n            })}\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-morandi-primary mb-1\">ç”Ÿæ—¥</label>\n          <Input\n            type=\"date\"\n            value={formData.personal_info.birthday}\n            onChange={(e) => setFormData({\n              ...formData,\n              personal_info: { ...formData.personal_info, birthday: e.target.value }\n            })}\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-morandi-primary mb-1 flex items-center justify-between\">\n            <span>è¯çµ¡é›»è©±</span>\n            <Button\n              type=\"button\"\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => {\n                setFormData({\n                  ...formData,\n                  personal_info: {\n                    ...formData.personal_info,\n                    phone: [...formData.personal_info.phone, '']\n                  }\n                });\n              }}\n              className=\"h-6 text-xs\"\n            >\n              <Plus size={12} className=\"mr-1\" />\n              æ–°å¢é›»è©±\n            </Button>\n          </label>\n          <div className=\"space-y-2\">\n            {formData.personal_info.phone.map((phone, index) => (\n              <div key={index} className=\"flex gap-2\">\n                <Input\n                  value={phone}\n                  onChange={(e) => {\n                    const phones = [...formData.personal_info.phone];\n                    phones[index] = e.target.value;\n                    setFormData({\n                      ...formData,\n                      personal_info: { ...formData.personal_info, phone: phones }\n                    });\n                  }}\n                  placeholder={`é›»è©± ${index + 1}`}\n                />\n                {formData.personal_info.phone.length > 1 && (\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => {\n                      const phones = formData.personal_info.phone.filter((_, i) => i !== index);\n                      setFormData({\n                        ...formData,\n                        personal_info: { ...formData.personal_info, phone: phones }\n                      });\n                    }}\n                    className=\"text-red-500 hover:text-red-700\"\n                  >\n                    <Trash2 size={16} />\n                  </Button>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-morandi-primary mb-1\">Email</label>\n          <Input\n            type=\"email\"\n            value={formData.personal_info.email}\n            onChange={(e) => setFormData({\n              ...formData,\n              personal_info: { ...formData.personal_info, email: e.target.value }\n            })}\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n            é è¨­ç™»å…¥å¯†ç¢¼\n          </label>\n          <Input\n            type=\"text\"\n            value={formData.defaultPassword}\n            onChange={(e) => setFormData({ ...formData, defaultPassword: e.target.value })}\n            placeholder=\"è«‹è¨­å®šé è¨­å¯†ç¢¼\"\n            required\n          />\n          <p className=\"text-xs text-morandi-muted mt-1\">\n            å“¡å·¥å¯ä½¿ç”¨æ­¤å¯†ç¢¼é¦–æ¬¡ç™»å…¥ï¼Œå»ºè­°æé†’å…¶ç™»å…¥å¾Œæ›´æ”¹å¯†ç¢¼\n          </p>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-morandi-primary mb-2\">\n            é™„åŠ èº«ä»½æ¨™ç±¤ï¼ˆå¯è¤‡é¸ï¼‰\n          </label>\n          <div className=\"flex flex-wrap gap-4\">\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"user\"\n                checked={formData.roles.includes('user')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'user'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'user') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">æ™®é€šä½¿ç”¨è€…</span>\n            </label>\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"employee\"\n                checked={formData.roles.includes('employee')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'employee'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'employee') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">å“¡å·¥</span>\n            </label>\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"admin\"\n                checked={formData.roles.includes('admin')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'admin'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'admin') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">ç®¡ç†å“¡</span>\n            </label>\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"tour_leader\"\n                checked={formData.roles.includes('tour_leader')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'tour_leader'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'tour_leader') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">é ˜éšŠ</span>\n            </label>\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"sales\"\n                checked={formData.roles.includes('sales')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'sales'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'sales') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">æ¥­å‹™</span>\n            </label>\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"accountant\"\n                checked={formData.roles.includes('accountant')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'accountant'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'accountant') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">æœƒè¨ˆ</span>\n            </label>\n            <label className=\"flex items-center gap-2 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                value=\"assistant\"\n                checked={formData.roles.includes('assistant')}\n                onChange={(e) => {\n                  if (e.target.checked) {\n                    setFormData({ ...formData, roles: [...formData.roles, 'assistant'] });\n                  } else {\n                    setFormData({ ...formData, roles: formData.roles.filter(r => r !== 'assistant') });\n                  }\n                }}\n                className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n              />\n              <span className=\"text-sm text-morandi-primary\">åŠ©ç†</span>\n            </label>\n          </div>\n          <p className=\"text-xs text-morandi-muted mt-2\">\n            æ­¤æ¨™ç±¤åƒ…ç”¨æ–¼ç¯©é¸ï¼Œä¸å½±éŸ¿å¯¦éš›æ¬Šé™åŠŸèƒ½ã€‚å¯å‹¾é¸å¤šå€‹èº«ä»½\n          </p>\n        </div>\n      </div>\n\n      {/* è·å‹™è³‡æ–™ */}\n      <div className=\"space-y-4\">\n        <h3 className=\"text-lg font-semibold text-morandi-primary border-b pb-2\">è·å‹™è³‡æ–™</h3>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-1\">å…¥è·æ—¥æœŸ</label>\n            <Input\n              type=\"date\"\n              value={formData.job_info.hire_date}\n              onChange={(e) => setFormData({\n                ...formData,\n                job_info: { ...formData.job_info, hire_date: e.target.value }\n              })}\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-primary mb-1\">èµ·è–ª</label>\n            <Input\n              type=\"number\"\n              value={formData.salary_info.base_salary}\n              onChange={(e) => setFormData({\n                ...formData,\n                salary_info: { ...formData.salary_info, base_salary: Number(e.target.value) }\n              })}\n              placeholder=\"0\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* æŒ‰éˆ• */}\n      <div className=\"flex gap-2 pt-4 border-t\">\n        <Button type=\"submit\" className=\"flex-1\">\n          å»ºç«‹å“¡å·¥\n        </Button>\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\n          å–æ¶ˆ\n        </Button>\n      </div>\n    </form>\n\n    {/* æˆåŠŸå‰µå»ºå°è©±æ¡† */}\n    <Dialog open={showSuccessDialog} onOpenChange={setShowSuccessDialog}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"text-green-600\">âœ… å“¡å·¥å‰µå»ºæˆåŠŸ</DialogTitle>\n          <DialogDescription>å“¡å·¥è³‡æ–™å·²æˆåŠŸå»ºç«‹ï¼Œè«‹è¨˜éŒ„ä»¥ä¸‹ç™»å…¥è³‡è¨Š</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div className=\"bg-green-50 border border-green-200 rounded-xl p-6\">\n            <p className=\"text-sm text-morandi-primary mb-4\">\n              å“¡å·¥ <span className=\"font-bold text-morandi-gold\">{createdEmployee?.display_name}</span> å·²æˆåŠŸå‰µå»ºï¼\n            </p>\n\n            <div className=\"space-y-3\">\n              {/* å“¡å·¥ç·¨è™Ÿ */}\n              <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <p className=\"text-xs text-morandi-muted mb-1.5\">å“¡å·¥ç·¨è™Ÿ</p>\n                    <p className=\"font-mono text-base font-semibold text-morandi-primary\">\n                      {createdEmployee?.employee_number}\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => copyToClipboard(createdEmployee?.employee_number || '', 'number')}\n                    className=\"ml-3 p-2 hover:bg-gray-100 rounded-md transition-colors\"\n                    title=\"è¤‡è£½å“¡å·¥ç·¨è™Ÿ\"\n                  >\n                    {copiedField === 'number' ? (\n                      <Check size={20} className=\"text-green-600\" />\n                    ) : (\n                      <Copy size={20} className=\"text-gray-600\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              {/* é è¨­å¯†ç¢¼ */}\n              <div className=\"bg-white rounded-lg p-4 border border-gray-200\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <p className=\"text-xs text-morandi-muted mb-1.5\">é è¨­å¯†ç¢¼</p>\n                    <p className=\"font-mono text-base font-semibold text-morandi-primary\">\n                      {createdEmployee?.password}\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => copyToClipboard(createdEmployee?.password || '', 'password')}\n                    className=\"ml-3 p-2 hover:bg-gray-100 rounded-md transition-colors\"\n                    title=\"è¤‡è£½å¯†ç¢¼\"\n                  >\n                    {copiedField === 'password' ? (\n                      <Check size={20} className=\"text-green-600\" />\n                    ) : (\n                      <Copy size={20} className=\"text-gray-600\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"mt-4 text-sm text-amber-800 bg-amber-50 border border-amber-200 rounded-lg p-3 flex items-start gap-2\">\n              <span className=\"text-base\">ğŸ’¡</span>\n              <span>è«‹æé†’å“¡å·¥é¦–æ¬¡ç™»å…¥å¾Œæ›´æ”¹å¯†ç¢¼</span>\n            </div>\n          </div>\n\n          <Button onClick={handleCloseSuccess} className=\"w-full bg-morandi-gold hover:bg-morandi-gold/90 text-white rounded-lg py-2.5\">\n            å®Œæˆ\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/employee-expanded-view.tsx","messages":[{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":55,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":55,"endColumn":67,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1507,2131],"text":"{ const allowances = employee.salary_info?.allowances || [];\n        const totalAllowances = allowances.reduce((sum, allowance) => sum + allowance.amount, 0);\n        const baseSalary = employee.salary_info?.base_salary || 0;\n        return (\n          <div className=\"flex items-center gap-4 text-morandi-muted\">\n            <span>åº•è–ªï¼šNT$ {baseSalary.toLocaleString()}</span>\n            <span>æ´¥è²¼ï¼šNT$ {totalAllowances.toLocaleString()}</span>\n            <span className=\"text-morandi-primary font-medium\">\n              ç¸½è–ªè³‡ï¼šNT$ {(baseSalary + totalAllowances).toLocaleString()}\n            </span>\n          </div>\n        ); }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":56,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":56,"endColumn":98,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1507,2131],"text":"{ const allowances = employee.salary_info?.allowances || [];\n        const totalAllowances = allowances.reduce((sum, allowance) => sum + allowance.amount, 0);\n        const baseSalary = employee.salary_info?.base_salary || 0;\n        return (\n          <div className=\"flex items-center gap-4 text-morandi-muted\">\n            <span>åº•è–ªï¼šNT$ {baseSalary.toLocaleString()}</span>\n            <span>æ´¥è²¼ï¼šNT$ {totalAllowances.toLocaleString()}</span>\n            <span className=\"text-morandi-primary font-medium\">\n              ç¸½è–ªè³‡ï¼šNT$ {(baseSalary + totalAllowances).toLocaleString()}\n            </span>\n          </div>\n        ); }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":57,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":57,"endColumn":67,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1507,2131],"text":"{ const allowances = employee.salary_info?.allowances || [];\n        const totalAllowances = allowances.reduce((sum, allowance) => sum + allowance.amount, 0);\n        const baseSalary = employee.salary_info?.base_salary || 0;\n        return (\n          <div className=\"flex items-center gap-4 text-morandi-muted\">\n            <span>åº•è–ªï¼šNT$ {baseSalary.toLocaleString()}</span>\n            <span>æ´¥è²¼ï¼šNT$ {totalAllowances.toLocaleString()}</span>\n            <span className=\"text-morandi-primary font-medium\">\n              ç¸½è–ªè³‡ï¼šNT$ {(baseSalary + totalAllowances).toLocaleString()}\n            </span>\n          </div>\n        ); }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":69,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":69,"endColumn":65,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2195,2512],"text":"{ const hasAdmin = employee.permissions.includes('admin');\n        const permissionCount = hasAdmin ? SYSTEM_PERMISSIONS.length : employee.permissions.length;\n\n        return (\n          <div className=\"text-morandi-muted\">\n            å·²æˆæ¬Š {permissionCount} / {SYSTEM_PERMISSIONS.length} é …åŠŸèƒ½\n          </div>\n        ); }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":70,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":70,"endColumn":100,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2195,2512],"text":"{ const hasAdmin = employee.permissions.includes('admin');\n        const permissionCount = hasAdmin ? SYSTEM_PERMISSIONS.length : employee.permissions.length;\n\n        return (\n          <div className=\"text-morandi-muted\">\n            å·²æˆæ¬Š {permissionCount} / {SYSTEM_PERMISSIONS.length} é …åŠŸèƒ½\n          </div>\n        ); }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4525,4528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4525,4528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { useUserStore } from '@/stores/user-store';\nimport { cn } from '@/lib/utils';\nimport {\n  User,\n  DollarSign,\n  Shield,\n  X,\n  Edit,\n  Save\n} from 'lucide-react';\n\n// å°å…¥åˆ†é çµ„ä»¶\nimport { BasicInfoTab } from './tabs/basic-info-tab';\nimport { SalaryTab } from './tabs/salary-tab';\nimport { PermissionsTab } from './tabs/permissions-tab';\nimport { SYSTEM_PERMISSIONS } from '@/stores/types';\n\ninterface EmployeeExpandedViewProps {\n  employee_id: string;\n  onClose: () => void;\n}\n\ntype EmployeeTab = 'basic' | 'salary' | 'permissions';\n\nexport function EmployeeExpandedView({ employee_id, onClose }: EmployeeExpandedViewProps) {\n  const [activeTab, setActiveTab] = useState<EmployeeTab>('basic');\n  const [isEditing, setIsEditing] = useState(false);\n  const basicInfoTabRef = useRef<{ handleSave: () => void }>(null);\n  const salaryTabRef = useRef<{ handleSave: () => void }>(null);\n\n  // âœ¨ ä½¿ç”¨ Zustand selector ä¾†è‡ªå‹•è¨‚é–±å“¡å·¥è³‡æ–™æ›´æ–°\n  const employee = useUserStore(state =>\n    state.items.find(u => u.id === employee_id)\n  );\n\n  if (!employee) {\n    return null;\n  }\n\n  const tabs = [\n    { key: 'basic' as const, label: 'åŸºæœ¬è³‡æ–™', icon: User },\n    { key: 'salary' as const, label: 'è–ªè³‡', icon: DollarSign },\n    { key: 'permissions' as const, label: 'æ¬Šé™', icon: Shield },\n  ];\n\n  const renderTabStats = () => {\n    switch (activeTab) {\n      case 'basic':\n        return null;\n      case 'salary':\n        const allowances = employee.salary_info?.allowances || [];\n        const totalAllowances = allowances.reduce((sum, allowance) => sum + allowance.amount, 0);\n        const baseSalary = employee.salary_info?.base_salary || 0;\n        return (\n          <div className=\"flex items-center gap-4 text-morandi-muted\">\n            <span>åº•è–ªï¼šNT$ {baseSalary.toLocaleString()}</span>\n            <span>æ´¥è²¼ï¼šNT$ {totalAllowances.toLocaleString()}</span>\n            <span className=\"text-morandi-primary font-medium\">\n              ç¸½è–ªè³‡ï¼šNT$ {(baseSalary + totalAllowances).toLocaleString()}\n            </span>\n          </div>\n        );\n      case 'permissions':\n        // å¦‚æœæœ‰ admin æ¬Šé™ï¼Œè¦–ç‚ºå…¨é¸\n        const hasAdmin = employee.permissions.includes('admin');\n        const permissionCount = hasAdmin ? SYSTEM_PERMISSIONS.length : employee.permissions.length;\n\n        return (\n          <div className=\"text-morandi-muted\">\n            å·²æˆæ¬Š {permissionCount} / {SYSTEM_PERMISSIONS.length} é …åŠŸèƒ½\n          </div>\n        );\n      default:\n        return null;\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      // æ ¹æ“šä¸åŒé é¢èª¿ç”¨å°æ‡‰çš„å„²å­˜å‡½æ•¸\n      if (activeTab === 'basic' && basicInfoTabRef.current) {\n        await basicInfoTabRef.current.handleSave();\n      } else if (activeTab === 'salary' && salaryTabRef.current) {\n        await salaryTabRef.current.handleSave();\n      }\n\n      // é‡æ–°è¼‰å…¥å“¡å·¥è³‡æ–™ä»¥ç¢ºä¿é¡¯ç¤ºæœ€æ–°å…§å®¹\n      const { fetchAll } = useUserStore.getState();\n      await fetchAll();\n\n      setIsEditing(false);\n    } catch (error) {\n      console.error('âŒ å„²å­˜å¤±æ•—:', error);\n      alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case 'basic':\n        return <BasicInfoTab ref={basicInfoTabRef} employee={employee} isEditing={isEditing} setIsEditing={setIsEditing} />;\n      case 'salary':\n        return <SalaryTab ref={salaryTabRef} employee={employee} isEditing={isEditing} setIsEditing={setIsEditing} />;\n      case 'permissions':\n        return <PermissionsTab employee={employee} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white rounded-lg w-full max-w-6xl h-[90vh] flex flex-col\">\n        {/* æ¨™é¡Œåˆ— */}\n        <div className=\"flex items-center justify-between p-6 border-b border-border\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"w-12 h-12 rounded-full bg-morandi-container/30 flex items-center justify-center\">\n              {employee.avatar ? (\n                <img\n                  src={employee.avatar}\n                  alt={employee.display_name}\n                  className=\"w-12 h-12 rounded-full object-cover\"\n                />\n              ) : (\n                <User size={24} className=\"text-morandi-secondary\" />\n              )}\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-morandi-primary\">\n                {employee.display_name || (employee as any).chinese_name || 'æœªå‘½åå“¡å·¥'}\n              </h2>\n              <p className=\"text-morandi-secondary\">\n                {employee.employee_number}\n              </p>\n            </div>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n            <X size={16} />\n          </Button>\n        </div>\n\n        {/* åˆ†é å°èˆª */}\n        <div className=\"flex items-center justify-between border-b border-border px-6\">\n          <div className=\"flex\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.key}\n                  onClick={() => setActiveTab(tab.key)}\n                  className={cn(\n                    'flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors relative',\n                    activeTab === tab.key\n                      ? 'text-morandi-primary border-b-2 border-morandi-gold'\n                      : 'text-morandi-secondary hover:text-morandi-primary'\n                  )}\n                >\n                  <Icon size={16} />\n                  {tab.label}\n                </button>\n              );\n            })}\n          </div>\n\n          {/* ä¸­é–“çµ±è¨ˆè³‡è¨Šå€åŸŸ */}\n          <div className=\"flex items-center gap-6 text-sm\">\n            {renderTabStats()}\n          </div>\n\n          {/* ç·¨è¼¯æŒ‰éˆ•å€åŸŸï¼ˆæ¬Šé™åˆ†é ä¸é¡¯ç¤ºï¼‰ */}\n          {activeTab !== 'permissions' && (\n            <div className=\"py-3\">\n              {isEditing ? (\n                <div className=\"flex gap-2\">\n                  <Button size=\"sm\" onClick={handleSave}>\n                    <Save size={14} className=\"mr-1\" />\n                    å„²å­˜\n                  </Button>\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => setIsEditing(false)}>\n                    <X size={14} className=\"mr-1\" />\n                    å–æ¶ˆ\n                  </Button>\n                </div>\n              ) : (\n                <Button size=\"sm\" variant=\"outline\" onClick={() => setIsEditing(true)}>\n                  <Edit size={14} className=\"mr-1\" />\n                  ç·¨è¼¯\n                </Button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* åˆ†é å…§å®¹ */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {renderTabContent()}\n        </div>\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/tabs/attendance-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isEditing' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsEditing' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { forwardRef, useImperativeHandle } from 'react';\nimport { Employee } from '@/stores/types';\nimport { Calendar, Clock } from 'lucide-react';\n\ninterface AttendanceTabProps {\n  employee: Employee;\n  isEditing?: boolean;\n  setIsEditing?: (editing: boolean) => void;\n}\n\nexport const AttendanceTab = forwardRef<{ handleSave: () => void }, AttendanceTabProps>(\n  ({ employee, isEditing, setIsEditing }, ref) => {\n  useImperativeHandle(ref, () => ({\n    handleSave: async () => {\n      // å‡ºå‹¤è³‡è¨Šç›®å‰ç‚ºå”¯è®€ï¼Œæœªä¾†è‹¥éœ€ç·¨è¼¯åŠŸèƒ½å¯åœ¨æ­¤å¯¦ä½œ\n      console.log('AttendanceTab handleSave called');\n    }\n  }));\n\n  const getLeaveTypeLabel = (type: Employee['attendance']['leave_records'][0]['type']) => {\n    const typeMap = {\n      annual: 'å¹´å‡',\n      sick: 'ç—…å‡',\n      personal: 'äº‹å‡',\n      maternity: 'ç”¢å‡',\n      other: 'å…¶ä»–'\n    };\n    return typeMap[type];\n  };\n\n  const getStatusColor = (status: Employee['attendance']['leave_records'][0]['status']) => {\n    const colorMap = {\n      pending: 'text-yellow-600',\n      approved: 'text-green-600',\n      rejected: 'text-red-600'\n    };\n    return colorMap[status];\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* è«‹å‡ç´€éŒ„ */}\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n        <h4 className=\"font-medium text-morandi-primary mb-3\">è«‹å‡ç´€éŒ„</h4>\n\n        {employee.attendance.leave_records.length > 0 ? (\n          <div className=\"space-y-3\">\n            {employee.attendance.leave_records.map((record) => (\n              <div key={record.id} className=\"bg-white rounded border p-3\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div>\n                    <span className=\"font-medium text-morandi-primary\">\n                      {getLeaveTypeLabel(record.type)}\n                    </span>\n                    <span className={`ml-2 text-sm font-medium ${getStatusColor(record.status)}`}>\n                      {record.status === 'pending' ? 'å¾…å¯©æ ¸' :\n                       record.status === 'approved' ? 'å·²æ ¸å‡†' : 'å·²æ‹’çµ•'}\n                    </span>\n                  </div>\n                  <span className=\"text-sm text-morandi-muted\">\n                    {record.days} å¤©\n                  </span>\n                </div>\n                <div className=\"text-sm text-morandi-secondary\">\n                  {new Date(record.start_date).toLocaleDateString()} - {new Date(record.end_date).toLocaleDateString()}\n                </div>\n                {record.reason && (\n                  <div className=\"text-sm text-morandi-muted mt-1\">\n                    åŸå› ï¼š{record.reason}\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-morandi-muted text-sm\">ç„¡è«‹å‡ç´€éŒ„</p>\n        )}\n      </div>\n\n      {/* åŠ ç­ç´€éŒ„ */}\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n        <h4 className=\"font-medium text-morandi-primary mb-3\">åŠ ç­ç´€éŒ„</h4>\n\n        {employee.attendance.overtime_records.length > 0 ? (\n          <div className=\"space-y-3\">\n            {employee.attendance.overtime_records.map((record) => (\n              <div key={record.id} className=\"bg-white rounded border p-3\">\n                <div className=\"flex justify-between items-start mb-2\">\n                  <div className=\"font-medium text-morandi-primary\">\n                    {new Date(record.date).toLocaleDateString()}\n                  </div>\n                  <span className=\"text-sm text-morandi-muted\">\n                    {record.hours} å°æ™‚\n                  </span>\n                </div>\n                <div className=\"text-sm text-morandi-muted\">\n                  åŸå› ï¼š{record.reason}\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-morandi-muted text-sm\">ç„¡åŠ ç­ç´€éŒ„</p>\n        )}\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/tabs/basic-info-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1359,1362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1359,1362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2602,2605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2602,2605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2760,2763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2760,2763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleCancel' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":88,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3391,3394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3391,3394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5029,5032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5029,5032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5054,5057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5054,5057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7130,7133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7130,7133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, forwardRef, useImperativeHandle } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Employee } from '@/stores/types';\nimport { useUserStore, userStoreHelpers } from '@/stores/user-store';\nimport { User, Phone, Mail, MapPin, Calendar, Edit, Save, X, Lock, Eye, EyeOff, Plus, Trash2 } from 'lucide-react';\n\ninterface BasicInfoTabProps {\n  employee: Employee;\n  isEditing: boolean;\n  setIsEditing: (editing: boolean) => void;\n}\n\nexport const BasicInfoTab = forwardRef<{ handleSave: () => void }, BasicInfoTabProps>(\n  ({ employee, isEditing, setIsEditing }, ref) => {\n  const { update: updateUser } = useUserStore();\n  const [showPasswordSection, setShowPasswordSection] = useState(false);\n  const [passwordData, setPasswordData] = useState({\n    newPassword: '',\n    confirmPassword: ''\n  });\n  const [showPassword, setShowPassword] = useState(false);\n  const [passwordUpdateLoading, setPasswordUpdateLoading] = useState(false);\n\n  console.log('ğŸ” BasicInfoTab employee:', employee);\n  console.log('ğŸ” personal_info:', employee.personal_info);\n  console.log('ğŸ” emergency_contact:', employee.personal_info?.emergency_contact);\n\n  const [formData, setFormData] = useState({\n    display_name: employee.display_name || '',\n    chinese_name: (employee as any).chinese_name || '',\n    english_name: employee.english_name || '',\n    personal_info: {\n      national_id: employee.personal_info?.national_id || '',\n      birthday: employee.personal_info?.birthday || '',\n      phone: Array.isArray(employee.personal_info?.phone)\n        ? employee.personal_info.phone\n        : employee.personal_info?.phone\n          ? [employee.personal_info.phone]\n          : [''],\n      email: employee.personal_info?.email || '',\n      address: employee.personal_info?.address || '',\n      emergency_contact: {\n        name: employee.personal_info?.emergency_contact?.name || '',\n        relationship: employee.personal_info?.emergency_contact?.relationship || '',\n        phone: employee.personal_info?.emergency_contact?.phone || ''\n      }\n    },\n    job_info: {\n      supervisor: employee.job_info?.supervisor || '',\n      hire_date: employee.job_info?.hire_date || '',\n      probation_end_date: employee.job_info?.probation_end_date || ''\n    }\n  });\n\n  const handleSave = async () => {\n    console.log('ğŸ”µ [BasicInfoTab] handleSave é–‹å§‹åŸ·è¡Œ');\n    console.log('ğŸ”µ [BasicInfoTab] formData:', formData);\n    console.log('ğŸ”µ [BasicInfoTab] employee.id:', employee.id);\n\n    // å¦‚æœè‹±æ–‡åå­—æ”¹è®Šäº†ï¼ŒåŒæ™‚æ›´æ–°å“¡å·¥ç·¨è™Ÿ\n    const updates: any = { ...formData };\n\n    if (formData.english_name !== employee.english_name) {\n      console.log('ğŸ”µ [BasicInfoTab] è‹±æ–‡åå­—æœ‰è®Šæ›´ï¼Œé‡æ–°ç”Ÿæˆå“¡å·¥ç·¨è™Ÿ');\n      (updates as any).employee_number = userStoreHelpers.generateUserNumber(formData.english_name);\n    }\n\n    console.log('ğŸ”µ [BasicInfoTab] æº–å‚™æ›´æ–°ï¼Œupdates:', updates);\n\n    try {\n      await updateUser(employee.id, updates);\n      console.log('âœ… [BasicInfoTab] æ›´æ–°æˆåŠŸ');\n      setIsEditing(false);\n    } catch (error) {\n      console.error('âŒ [BasicInfoTab] æ›´æ–°å¤±æ•—:', error);\n      alert('å„²å­˜å¤±æ•—ï¼š' + (error as Error).message);\n    }\n  };\n\n  // å°‡ handleSave æš´éœ²çµ¦çˆ¶çµ„ä»¶\n  useImperativeHandle(ref, () => ({\n    handleSave\n  }));\n\n  const handleCancel = () => {\n    setFormData({\n      display_name: employee.display_name || '',\n      chinese_name: (employee as any).chinese_name || '',\n      english_name: employee.english_name || '',\n      personal_info: {\n        national_id: employee.personal_info?.national_id || '',\n        birthday: employee.personal_info?.birthday || '',\n        phone: Array.isArray(employee.personal_info?.phone)\n          ? employee.personal_info.phone\n          : employee.personal_info?.phone\n            ? [employee.personal_info.phone]\n            : [''],\n        email: employee.personal_info?.email || '',\n        address: employee.personal_info?.address || '',\n        emergency_contact: {\n          name: employee.personal_info?.emergency_contact?.name || '',\n          relationship: employee.personal_info?.emergency_contact?.relationship || '',\n          phone: employee.personal_info?.emergency_contact?.phone || ''\n        }\n      },\n      job_info: {\n        supervisor: employee.job_info?.supervisor || '',\n        hire_date: employee.job_info?.hire_date || '',\n        probation_end_date: employee.job_info?.probation_end_date || ''\n      }\n    });\n    setIsEditing(false);\n  };\n\n  const handlePasswordUpdate = async () => {\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\n      alert('æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ç¬¦ï¼');\n      return;\n    }\n\n    if (passwordData.newPassword.length < 8) {\n      alert('å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦8å€‹å­—å…ƒï¼');\n      return;\n    }\n\n    setPasswordUpdateLoading(true);\n\n    try {\n      // å°å…¥å¯†ç¢¼åŠ å¯†å‡½æ•¸\n      const { hashPassword } = await import('@/lib/auth');\n      const hashedPassword = await hashPassword(passwordData.newPassword);\n\n      // å°å…¥ Supabase client\n      const { supabase } = await import('@/lib/supabase/client');\n\n      const result: any = await (supabase as any)\n        .from('employees')\n        .update({ password_hash: hashedPassword })\n        .eq('employee_number', employee.employee_number);\n\n      const { error } = result;\n\n      if (error) {\n        console.error('å¯†ç¢¼æ›´æ–°å¤±æ•—:', error);\n        alert('å¯†ç¢¼æ›´æ–°å¤±æ•—ï¼š' + error.message);\n        return;\n      }\n\n      alert(`æˆåŠŸæ›´æ–° ${employee.display_name} çš„å¯†ç¢¼ï¼`);\n      setPasswordData({ newPassword: '', confirmPassword: '' });\n      setShowPasswordSection(false);\n    } catch (error) {\n      console.error('å¯†ç¢¼æ›´æ–°éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:', error);\n      alert('å¯†ç¢¼æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setPasswordUpdateLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* å·¦å´ï¼šå€‹äººåŸºæœ¬è³‡æ–™ */}\n        <div className=\"space-y-6\">\n          <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n            <h4 className=\"font-medium text-morandi-primary mb-3\">å€‹äººè³‡æ–™</h4>\n\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                    é¡¯ç¤ºåç¨±\n                  </label>\n                  {isEditing ? (\n                    <Input\n                      value={formData.display_name}\n                      onChange={(e) => setFormData({ ...formData, display_name: e.target.value })}\n                    />\n                  ) : (\n                    <p className=\"text-morandi-primary py-2\">{employee.display_name}</p>\n                  )}\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                    ä¸­æ–‡å§“å\n                  </label>\n                  {isEditing ? (\n                    <Input\n                      value={formData.chinese_name}\n                      onChange={(e) => setFormData({ ...formData, chinese_name: e.target.value })}\n                    />\n                  ) : (\n                    <p className=\"text-morandi-primary py-2\">{(employee as any).chinese_name || '-'}</p>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                    è‹±æ–‡å§“å\n                  </label>\n                  {isEditing ? (\n                    <Input\n                      value={formData.english_name}\n                      onChange={(e) => setFormData({ ...formData, english_name: e.target.value })}\n                    />\n                  ) : (\n                    <p className=\"text-morandi-primary py-2\">{employee.english_name}</p>\n                  )}\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                    å“¡å·¥ç·¨è™Ÿ\n                  </label>\n                  <p className=\"text-morandi-primary py-2 bg-morandi-container/20 px-3 rounded\">\n                    {employee.employee_number}\n                  </p>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                  èº«åˆ†è­‰è™Ÿ\n                </label>\n                {isEditing ? (\n                  <Input\n                    value={formData.personal_info.national_id}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: { ...formData.personal_info, national_id: e.target.value }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">{employee.personal_info.national_id}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1 flex items-center gap-1\">\n                  <Calendar size={14} />\n                  ç”Ÿæ—¥\n                </label>\n                {isEditing ? (\n                  <Input\n                    type=\"date\"\n                    value={formData.personal_info.birthday}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: { ...formData.personal_info, birthday: e.target.value }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">\n                    {new Date(employee.personal_info.birthday).toLocaleDateString()}\n                  </p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* è¯çµ¡è³‡è¨Š */}\n          <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n            <h4 className=\"font-medium text-morandi-primary mb-3\">è¯çµ¡è³‡è¨Š</h4>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1 flex items-center justify-between\">\n                  <span className=\"flex items-center gap-1\">\n                    <Phone size={14} />\n                    è¯çµ¡é›»è©±\n                  </span>\n                  {isEditing && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        const phones = Array.isArray(formData.personal_info.phone)\n                          ? formData.personal_info.phone\n                          : [formData.personal_info.phone];\n                        setFormData({\n                          ...formData,\n                          personal_info: {\n                            ...formData.personal_info,\n                            phone: [...phones, '']\n                          }\n                        });\n                      }}\n                      className=\"h-6 text-xs\"\n                    >\n                      <Plus size={12} className=\"mr-1\" />\n                      æ–°å¢é›»è©±\n                    </Button>\n                  )}\n                </label>\n                {isEditing ? (\n                  <div className=\"space-y-2\">\n                    {(Array.isArray(formData.personal_info.phone)\n                      ? formData.personal_info.phone\n                      : [formData.personal_info.phone]\n                    ).map((phone, index) => (\n                      <div key={index} className=\"flex gap-2\">\n                        <Input\n                          value={phone}\n                          onChange={(e) => {\n                            const phones = Array.isArray(formData.personal_info.phone)\n                              ? [...formData.personal_info.phone]\n                              : [formData.personal_info.phone];\n                            phones[index] = e.target.value;\n                            setFormData({\n                              ...formData,\n                              personal_info: { ...formData.personal_info, phone: phones }\n                            });\n                          }}\n                          placeholder={`é›»è©± ${index + 1}`}\n                        />\n                        {(Array.isArray(formData.personal_info.phone)\n                          ? formData.personal_info.phone.length\n                          : 1) > 1 && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => {\n                              const phones = Array.isArray(formData.personal_info.phone)\n                                ? formData.personal_info.phone.filter((_, i) => i !== index)\n                                : [];\n                              setFormData({\n                                ...formData,\n                                personal_info: { ...formData.personal_info, phone: phones }\n                              });\n                            }}\n                            className=\"text-red-500 hover:text-red-700\"\n                          >\n                            <Trash2 size={16} />\n                          </Button>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"space-y-1\">\n                    {(Array.isArray(employee.personal_info.phone)\n                      ? employee.personal_info.phone\n                      : [employee.personal_info.phone]\n                    ).map((phone, index) => (\n                      <p key={index} className=\"text-morandi-primary py-2\">\n                        {phone || '-'}\n                      </p>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1 flex items-center gap-1\">\n                  <Mail size={14} />\n                  Email\n                </label>\n                {isEditing ? (\n                  <Input\n                    type=\"email\"\n                    value={formData.personal_info.email}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: { ...formData.personal_info, email: e.target.value }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">{employee.personal_info.email}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1 flex items-center gap-1\">\n                  <MapPin size={14} />\n                  åœ°å€\n                </label>\n                {isEditing ? (\n                  <Input\n                    value={formData.personal_info.address}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: { ...formData.personal_info, address: e.target.value }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">{employee.personal_info.address}</p>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* å³å´ï¼šè·å‹™è³‡æ–™èˆ‡ç·Šæ€¥è¯çµ¡äºº */}\n        <div className=\"space-y-6\">\n          {/* è·å‹™è³‡æ–™ */}\n          <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n            <h4 className=\"font-medium text-morandi-primary mb-3\">è·å‹™è³‡æ–™</h4>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                  å…¥è·æ—¥æœŸ\n                </label>\n                {isEditing ? (\n                  <Input\n                    type=\"date\"\n                    value={formData.job_info.hire_date}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      job_info: { ...formData.job_info, hire_date: e.target.value }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">\n                    {new Date(employee.job_info.hire_date).toLocaleDateString()}\n                  </p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* ç·Šæ€¥è¯çµ¡äºº */}\n          <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n            <h4 className=\"font-medium text-morandi-primary mb-3\">ç·Šæ€¥è¯çµ¡äºº</h4>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                  å§“å\n                </label>\n                {isEditing ? (\n                  <Input\n                    value={formData.personal_info.emergency_contact.name}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: {\n                        ...formData.personal_info,\n                        emergency_contact: {\n                          ...formData.personal_info.emergency_contact,\n                          name: e.target.value\n                        }\n                      }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">{employee.personal_info?.emergency_contact?.name || '-'}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                  é—œä¿‚\n                </label>\n                {isEditing ? (\n                  <Input\n                    value={formData.personal_info.emergency_contact.relationship}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: {\n                        ...formData.personal_info,\n                        emergency_contact: {\n                          ...formData.personal_info.emergency_contact,\n                          relationship: e.target.value\n                        }\n                      }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">{employee.personal_info?.emergency_contact?.relationship || '-'}</p>\n                )}\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                  é›»è©±\n                </label>\n                {isEditing ? (\n                  <Input\n                    value={formData.personal_info.emergency_contact.phone}\n                    onChange={(e) => setFormData({\n                      ...formData,\n                      personal_info: {\n                        ...formData.personal_info,\n                        emergency_contact: {\n                          ...formData.personal_info.emergency_contact,\n                          phone: e.target.value\n                        }\n                      }\n                    })}\n                  />\n                ) : (\n                  <p className=\"text-morandi-primary py-2\">{employee.personal_info?.emergency_contact?.phone || '-'}</p>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* å¯†ç¢¼ç®¡ç†å€å¡Š */}\n          <div className=\"bg-morandi-container/10 rounded-lg p-4 border-l-4 border-morandi-gold\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <h4 className=\"font-medium text-morandi-primary flex items-center gap-2\">\n                <Lock size={16} />\n                å¯†ç¢¼ç®¡ç†\n              </h4>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => setShowPasswordSection(!showPasswordSection)}\n                className=\"text-sm\"\n              >\n                {showPasswordSection ? 'å–æ¶ˆ' : 'ä¿®æ”¹å¯†ç¢¼'}\n              </Button>\n            </div>\n\n            {!showPasswordSection && (\n              <p className=\"text-sm text-morandi-muted\">\n                é»æ“Šã€Œä¿®æ”¹å¯†ç¢¼ã€ç‚º {employee.display_name} è¨­å®šæ–°å¯†ç¢¼\n              </p>\n            )}\n\n            {showPasswordSection && (\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                    æ–°å¯†ç¢¼\n                  </label>\n                  <div className=\"relative\">\n                    <Input\n                      type={showPassword ? \"text\" : \"password\"}\n                      value={passwordData.newPassword}\n                      onChange={(e) => setPasswordData({\n                        ...passwordData,\n                        newPassword: e.target.value\n                      })}\n                      placeholder=\"è‡³å°‘8å€‹å­—å…ƒ\"\n                      className=\"pr-10\"\n                    />\n                    <button\n                      type=\"button\"\n                      onClick={() => setShowPassword(!showPassword)}\n                      className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary hover:text-morandi-primary\"\n                    >\n                      {showPassword ? <EyeOff size={16} /> : <Eye size={16} />}\n                    </button>\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-morandi-primary mb-1\">\n                    ç¢ºèªæ–°å¯†ç¢¼\n                  </label>\n                  <Input\n                    type={showPassword ? \"text\" : \"password\"}\n                    value={passwordData.confirmPassword}\n                    onChange={(e) => setPasswordData({\n                      ...passwordData,\n                      confirmPassword: e.target.value\n                    })}\n                    placeholder=\"å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼\"\n                  />\n                </div>\n\n                {passwordData.newPassword && passwordData.confirmPassword && (\n                  <div className=\"text-sm\">\n                    {passwordData.newPassword === passwordData.confirmPassword ? (\n                      <span className=\"text-green-600\">âœ“ å¯†ç¢¼ç¢ºèªä¸€è‡´</span>\n                    ) : (\n                      <span className=\"text-red-600\">âœ— å¯†ç¢¼ç¢ºèªä¸ä¸€è‡´</span>\n                    )}\n                  </div>\n                )}\n\n                <div className=\"flex gap-2 pt-2\">\n                  <Button\n                    size=\"sm\"\n                    onClick={handlePasswordUpdate}\n                    disabled={passwordUpdateLoading || !passwordData.newPassword || passwordData.newPassword !== passwordData.confirmPassword || passwordData.newPassword.length < 8}\n                    className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n                  >\n                    {passwordUpdateLoading ? 'æ›´æ–°ä¸­...' : 'æ›´æ–°å¯†ç¢¼'}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setShowPasswordSection(false);\n                      setPasswordData({ newPassword: '', confirmPassword: '' });\n                    }}\n                  >\n                    å–æ¶ˆ\n                  </Button>\n                </div>\n\n                <div className=\"text-xs text-morandi-muted bg-morandi-container/30 p-2 rounded\">\n                  <p>ğŸ“ å¯†ç¢¼è¦æ±‚ï¼š</p>\n                  <ul className=\"list-disc list-inside mt-1 space-y-1\">\n                    <li>è‡³å°‘8å€‹å­—å…ƒ</li>\n                    <li>å»ºè­°åŒ…å«æ•¸å­—å’Œå­—æ¯</li>\n                    <li>å“¡å·¥ä¸‹æ¬¡ç™»å…¥æ™‚éœ€è¦ä½¿ç”¨æ–°å¯†ç¢¼</li>\n                  </ul>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nBasicInfoTab.displayName = 'BasicInfoTab';","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/tabs/contracts-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isEditing' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsEditing' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { forwardRef, useImperativeHandle } from 'react';\nimport { Employee } from '@/stores/types';\nimport { FileText } from 'lucide-react';\n\ninterface ContractsTabProps {\n  employee: Employee;\n  isEditing?: boolean;\n  setIsEditing?: (editing: boolean) => void;\n}\n\nexport const ContractsTab = forwardRef<{ handleSave: () => void }, ContractsTabProps>(\n  ({ employee, isEditing, setIsEditing }, ref) => {\n  useImperativeHandle(ref, () => ({\n    handleSave: async () => {\n      // åˆç´„è³‡è¨Šç›®å‰ç‚ºå”¯è®€ï¼Œæœªä¾†è‹¥éœ€ç·¨è¼¯åŠŸèƒ½å¯åœ¨æ­¤å¯¦ä½œ\n      console.log('ContractsTab handleSave called');\n    }\n  }));\n\n  const getContractTypeLabel = (type: Employee['contracts'][0]['type']) => {\n    const typeMap = {\n      employment: 'æ­£å¼é›‡ç”¨',\n      probation: 'è©¦ç”¨æœŸ',\n      renewal: 'çºŒç´„'\n    };\n    return typeMap[type];\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n\n        {employee.contracts.length > 0 ? (\n          <div className=\"space-y-3\">\n            {employee.contracts.map((contract) => (\n              <div key={contract.id} className=\"bg-white rounded border p-4\">\n                <div className=\"flex justify-between items-start mb-3\">\n                  <div>\n                    <h4 className=\"font-medium text-morandi-primary\">\n                      {getContractTypeLabel(contract.type)}\n                    </h4>\n                    <p className=\"text-sm text-morandi-muted\">\n                      åˆç´„ç·¨è™Ÿï¼š{contract.id}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-morandi-secondary\">\n                      {new Date(contract.start_date).toLocaleDateString()}\n                      {contract.end_date && ` - ${new Date(contract.end_date).toLocaleDateString()}`}\n                    </p>\n                  </div>\n                </div>\n\n                {contract.notes && (\n                  <div className=\"text-sm text-morandi-muted mb-2\">\n                    å‚™è¨»ï¼š{contract.notes}\n                  </div>\n                )}\n\n                {contract.file_path && (\n                  <div className=\"text-sm\">\n                    <a\n                      href={contract.file_path}\n                      className=\"text-morandi-primary hover:underline\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                    >\n                      æª¢è¦–åˆç´„æª”æ¡ˆ\n                    </a>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-morandi-muted text-sm\">ç„¡åˆç´„ç´€éŒ„</p>\n        )}\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/tabs/permissions-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[878,881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[878,881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1130,1133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1130,1133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'employee'. Either include it or remove the dependency array. If 'setSelectedRoles' needs the current value of 'employee', you can also switch to useReducer instead of useState and read 'employee' in the reducer.","line":27,"column":8,"nodeType":"ArrayExpression","endLine":27,"endColumn":55,"suggestions":[{"desc":"Update the dependencies array to be: [employee, employee.permissions]","fix":{"range":[1156,1203],"text":"[employee, employee.permissions]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":27,"column":31,"nodeType":"MemberExpression","endLine":27,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1192,1195],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1192,1195],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2558,2561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2558,2561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2815,2818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2815,2818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3340,3343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3340,3343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3796,3799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3796,3799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4703,4706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4703,4706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'roleLabels' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":184,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":184,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, useImperativeHandle, forwardRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Employee, SYSTEM_PERMISSIONS } from '@/stores/types';\nimport { useUserStore, userStoreHelpers } from '@/stores/user-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { Shield, Check, X, Save, Edit } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface PermissionsTabProps {\n  employee: Employee;\n}\n\nexport const PermissionsTab = forwardRef<{ handleSave: () => void }, PermissionsTabProps>(\n  ({ employee }, ref) => {\n    const { user, login } = useAuthStore();\n    const { update: updateUser } = useUserStore();\n    const [selectedPermissions, setSelectedPermissions] = useState<string[]>(employee.permissions);\n    const [selectedRoles, setSelectedRoles] = useState<string[]>((employee as any).roles || []);\n    const [isSaving, setIsSaving] = useState(false);\n    const [showSavedMessage, setShowSavedMessage] = useState(false);\n\n    useEffect(() => {\n      setSelectedPermissions(employee.permissions);\n      setSelectedRoles((employee as any).roles || []);\n    }, [employee.permissions, (employee as any).roles]);\n\n    const handlePermissionToggle = async (permissionId: string) => {\n      let newPermissions: string[];\n\n      // å¦‚æœå‹¾é¸ç³»çµ±ç®¡ç†å“¡ï¼Œè‡ªå‹•å…¨é¸æ‰€æœ‰æ¬Šé™\n      if (permissionId === 'admin') {\n        const isAdminSelected = selectedPermissions.includes('admin');\n        if (!isAdminSelected) {\n          newPermissions = SYSTEM_PERMISSIONS.map(p => p.id);\n        } else {\n          newPermissions = [];\n        }\n      } else {\n        // åˆ‡æ›å…¶ä»–æ¬Šé™\n        newPermissions = selectedPermissions.includes(permissionId)\n          ? selectedPermissions.filter(id => id !== permissionId)\n          : [...selectedPermissions, permissionId];\n\n        // å¦‚æœå–æ¶ˆå‹¾é¸ä»»ä½•æ¬Šé™ï¼Œè‡ªå‹•å–æ¶ˆç³»çµ±ç®¡ç†å“¡\n        if (selectedPermissions.includes('admin') && !newPermissions.includes(permissionId)) {\n          newPermissions = newPermissions.filter(id => id !== 'admin');\n        }\n      }\n\n      setSelectedPermissions(newPermissions);\n\n      // è‡ªå‹•å„²å­˜\n      await autoSave(newPermissions);\n    };\n\n    const handleRoleToggle = async (role: string) => {\n      const newRoles = selectedRoles.includes(role)\n        ? selectedRoles.filter(r => r !== role)\n        : [...selectedRoles, role];\n\n      setSelectedRoles(newRoles);\n      await saveRoles(newRoles);\n    };\n\n    const saveRoles = async (roles: string[]) => {\n      setIsSaving(true);\n      try {\n        await updateUser(employee.id, { roles: roles as any });\n\n        // åŒæ­¥æ›´æ–° IndexedDB\n        try {\n          const { localDB } = await import('@/lib/db');\n          const { TABLES } = await import('@/lib/db/schemas');\n\n          const existingEmployee = await localDB.read(TABLES.EMPLOYEES, employee.id) as any;\n          if (existingEmployee) {\n            await localDB.put(TABLES.EMPLOYEES, {\n              ...existingEmployee,\n              roles: roles,\n              updated_at: new Date().toISOString()\n            });\n          }\n        } catch (error) {\n          console.error('âš ï¸ IndexedDB æ›´æ–°å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½ï¼‰:', error);\n        }\n\n        // å¦‚æœä¿®æ”¹çš„æ˜¯ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼Œæ›´æ–° auth-store å’Œ LocalProfile\n        if (user && user.id === employee.id) {\n          // æ›´æ–° auth-store\n          login({\n            ...user,\n            roles: roles as any\n          });\n\n          // ğŸ´ åŒæ­¥æ›´æ–° LocalProfileï¼ˆè§’è‰²å¡ï¼‰\n          try {\n            const { useLocalAuthStore } = await import('@/lib/auth/local-auth-manager');\n            const localAuthStore = useLocalAuthStore.getState();\n            const currentProfile = localAuthStore.currentProfile;\n\n            if (currentProfile && currentProfile.id === employee.id) {\n              localAuthStore.updateProfile(employee.id, {\n                roles: roles as any\n              });\n              console.log('âœ… LocalProfile è§’è‰²å·²æ›´æ–°:', roles);\n            }\n          } catch (error) {\n            console.error('âš ï¸ LocalProfile æ›´æ–°å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½ï¼‰:', error);\n          }\n        }\n\n        // é¡¯ç¤ºå„²å­˜æˆåŠŸè¨Šæ¯\n        setShowSavedMessage(true);\n        setTimeout(() => setShowSavedMessage(false), 2000);\n      } catch (error) {\n        console.error('âŒ å„²å­˜å¤±æ•—:', error);\n        alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n      } finally {\n        setIsSaving(false);\n      }\n    };\n\n    const autoSave = async (permissions: string[]) => {\n      setIsSaving(true);\n      try {\n        await userStoreHelpers.updateUserPermissions(employee.id, permissions);\n\n        // åŒæ­¥æ›´æ–° IndexedDB\n        try {\n          const { localDB } = await import('@/lib/db');\n          const { TABLES } = await import('@/lib/db/schemas');\n\n          const existingEmployee = await localDB.read(TABLES.EMPLOYEES, employee.id) as any;\n          if (existingEmployee) {\n            await localDB.put(TABLES.EMPLOYEES, {\n              ...existingEmployee,\n              permissions: permissions,\n              updated_at: new Date().toISOString()\n            });\n          }\n        } catch (error) {\n          console.error('âš ï¸ IndexedDB æ›´æ–°å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½ï¼‰:', error);\n        }\n\n        // å¦‚æœä¿®æ”¹çš„æ˜¯ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼Œæ›´æ–° auth-store\n        if (user && user.id === employee.id) {\n          login({\n            ...user,\n            permissions: permissions\n          });\n        }\n\n        // é¡¯ç¤ºå„²å­˜æˆåŠŸè¨Šæ¯\n        setShowSavedMessage(true);\n        setTimeout(() => setShowSavedMessage(false), 2000);\n      } catch (error) {\n        console.error('âŒ å„²å­˜å¤±æ•—:', error);\n        alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n      } finally {\n        setIsSaving(false);\n      }\n    };\n\n    // æš´éœ²ç©ºçš„ handleSaveï¼ˆä¿æŒç›¸å®¹æ€§ï¼‰\n    useImperativeHandle(ref, () => ({\n      handleSave: async () => {\n        // æ¬Šé™å·²è‡ªå‹•å„²å­˜ï¼Œé€™è£¡ä¸éœ€è¦åšä»»ä½•äº‹\n      }\n    }));\n\n  // æŒ‰é¡åˆ¥åˆ†çµ„æ¬Šé™\n  const permissionsByCategory = SYSTEM_PERMISSIONS.reduce((acc, permission) => {\n    if (!acc[permission.category]) {\n      acc[permission.category] = [];\n    }\n    acc[permission.category].push(permission);\n    return acc;\n  }, {} as Record<string, typeof SYSTEM_PERMISSIONS>);\n\n  const categories = Object.keys(permissionsByCategory);\n\n  const roleLabels = {\n    admin: 'ç®¡ç†å“¡',\n    employee: 'å“¡å·¥',\n    user: 'æ™®é€šä½¿ç”¨è€…',\n    tour_leader: 'é ˜éšŠ',\n    sales: 'æ¥­å‹™',\n    accountant: 'æœƒè¨ˆ',\n    assistant: 'åŠ©ç†'\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* è‡ªå‹•å„²å­˜æç¤º */}\n      {showSavedMessage && (\n        <div className=\"bg-green-50 border border-green-200 rounded-lg p-3 flex items-center gap-2 text-green-700\">\n          <Check size={16} />\n          <span className=\"text-sm font-medium\">âœ“ å·²è‡ªå‹•å„²å­˜</span>\n        </div>\n      )}\n\n      {/* å„²å­˜ä¸­æç¤º */}\n      {isSaving && (\n        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center gap-2 text-blue-700\">\n          <div className=\"animate-spin w-4 h-4 border-2 border-blue-700 border-t-transparent rounded-full\"></div>\n          <span className=\"text-sm font-medium\">å„²å­˜ä¸­...</span>\n        </div>\n      )}\n\n      {/* è§’è‰²é¸æ“‡ */}\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n        <h4 className=\"font-medium text-morandi-primary mb-3\">é™„åŠ èº«ä»½æ¨™ç±¤ï¼ˆå¯è¤‡é¸ï¼‰</h4>\n        <p className=\"text-xs text-morandi-muted mb-3\">æ­¤æ¨™ç±¤åƒ…ç”¨æ–¼ç¯©é¸ï¼Œä¸å½±éŸ¿å¯¦éš›æ¬Šé™åŠŸèƒ½ã€‚å¯å‹¾é¸å¤šå€‹èº«ä»½</p>\n        <div className=\"flex flex-wrap gap-4\">\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"user\"\n              checked={selectedRoles.includes('user')}\n              onChange={() => handleRoleToggle('user')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">æ™®é€šä½¿ç”¨è€…</span>\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"employee\"\n              checked={selectedRoles.includes('employee')}\n              onChange={() => handleRoleToggle('employee')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">å“¡å·¥</span>\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"admin\"\n              checked={selectedRoles.includes('admin')}\n              onChange={() => handleRoleToggle('admin')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">ç®¡ç†å“¡</span>\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"tour_leader\"\n              checked={selectedRoles.includes('tour_leader')}\n              onChange={() => handleRoleToggle('tour_leader')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">é ˜éšŠ</span>\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"sales\"\n              checked={selectedRoles.includes('sales')}\n              onChange={() => handleRoleToggle('sales')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">æ¥­å‹™</span>\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"accountant\"\n              checked={selectedRoles.includes('accountant')}\n              onChange={() => handleRoleToggle('accountant')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">æœƒè¨ˆ</span>\n          </label>\n          <label className=\"flex items-center gap-2 cursor-pointer\">\n            <input\n              type=\"checkbox\"\n              value=\"assistant\"\n              checked={selectedRoles.includes('assistant')}\n              onChange={() => handleRoleToggle('assistant')}\n              className=\"w-4 h-4 text-morandi-gold focus:ring-morandi-gold rounded\"\n            />\n            <span className=\"text-sm text-morandi-primary\">åŠ©ç†</span>\n          </label>\n        </div>\n      </div>\n\n      {/* æ¬Šé™åˆ†é¡åˆ—è¡¨ */}\n      <div className=\"space-y-6\">\n        {categories.map((category) => (\n          <div key={category} className=\"bg-morandi-container/10 rounded-lg p-4\">\n            <h4 className=\"font-medium text-morandi-primary mb-4 pb-2 border-b border-border/50\">\n              {category}\n            </h4>\n\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3\">\n              {permissionsByCategory[category].map((permission) => {\n                // å¦‚æœæœ‰ admin æ¬Šé™ï¼Œè¦–ç‚ºå…¨é¸\n                const hasAdmin = selectedPermissions.includes('admin');\n                const isSelected = hasAdmin || selectedPermissions.includes(permission.id);\n\n                return (\n                  <div\n                    key={permission.id}\n                    onClick={() => handlePermissionToggle(permission.id)}\n                    className={cn(\n                      'flex items-center gap-2 p-2.5 rounded-lg border transition-all cursor-pointer hover:bg-morandi-container/20',\n                      isSelected\n                        ? 'border-morandi-gold bg-morandi-gold/10'\n                        : 'border-border bg-white'\n                    )}\n                  >\n                    <div className={cn(\n                      'w-4 h-4 rounded border-2 flex items-center justify-center transition-colors flex-shrink-0',\n                      isSelected\n                        ? 'border-morandi-gold bg-morandi-gold text-white'\n                        : 'border-morandi-muted'\n                    )}>\n                      {isSelected && <Check size={10} />}\n                    </div>\n                    <p className=\"text-sm font-medium text-morandi-primary truncate\">\n                      {permission.label}\n                    </p>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        ))}\n      </div>\n\n    </div>\n  );\n});\n\nPermissionsTab.displayName = 'PermissionsTab';","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/hr/tabs/salary-tab.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isEditing' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsEditing' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2894,2897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2894,2897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { forwardRef, useImperativeHandle } from 'react';\nimport { Employee } from '@/stores/types';\nimport { DollarSign, TrendingUp } from 'lucide-react';\n\ninterface SalaryTabProps {\n  employee: Employee;\n  isEditing?: boolean;\n  setIsEditing?: (editing: boolean) => void;\n}\n\nexport const SalaryTab = forwardRef<{ handleSave: () => void }, SalaryTabProps>(\n  ({ employee, isEditing, setIsEditing }, ref) => {\n  useImperativeHandle(ref, () => ({\n    handleSave: async () => {\n      // è–ªè³‡è³‡è¨Šç›®å‰ç‚ºå”¯è®€ï¼Œæœªä¾†è‹¥éœ€ç·¨è¼¯åŠŸèƒ½å¯åœ¨æ­¤å¯¦ä½œ\n      console.log('SalaryTab handleSave called');\n    }\n  }));\n\n  const allowances = employee.salary_info?.allowances || [];\n  const totalAllowances = allowances.reduce((sum, allowance) => sum + allowance.amount, 0);\n  const baseSalary = employee.salary_info?.base_salary || 0;\n  const salaryHistory = employee.salary_info?.salary_history || [];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* ç›®å‰è–ªè³‡è³‡è¨Š */}\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-morandi-primary\">\n              NT$ {baseSalary.toLocaleString()}\n            </p>\n            <p className=\"text-sm text-morandi-muted\">åº•è–ª</p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-morandi-gold\">\n              NT$ {totalAllowances.toLocaleString()}\n            </p>\n            <p className=\"text-sm text-morandi-muted\">æ´¥è²¼</p>\n          </div>\n          <div className=\"text-center\">\n            <p className=\"text-2xl font-bold text-green-600\">\n              NT$ {(baseSalary + totalAllowances).toLocaleString()}\n            </p>\n            <p className=\"text-sm text-morandi-muted\">ç¸½è–ªè³‡</p>\n          </div>\n        </div>\n      </div>\n\n      {/* æ´¥è²¼æ˜ç´° */}\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n        <h4 className=\"font-medium text-morandi-primary mb-3\">æ´¥è²¼æ˜ç´°</h4>\n        {allowances.length > 0 ? (\n          <div className=\"space-y-2\">\n            {allowances.map((allowance, index) => (\n              <div key={index} className=\"flex justify-between items-center py-2 border-b border-border/30\">\n                <span className=\"text-morandi-primary\">{allowance.type}</span>\n                <span className=\"font-medium\">NT$ {allowance.amount.toLocaleString()}</span>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-morandi-muted text-sm\">ç„¡æ´¥è²¼é …ç›®</p>\n        )}\n      </div>\n\n      {/* è–ªè³‡èª¿æ•´æ­·å² */}\n      <div className=\"bg-morandi-container/10 rounded-lg p-4\">\n        <h4 className=\"font-medium text-morandi-primary mb-3 flex items-center gap-2\">\n          <TrendingUp size={16} />\n          è–ªè³‡èª¿æ•´æ­·å²\n        </h4>\n        <div className=\"space-y-3\">\n          {salaryHistory.map((record: any, index: number) => (\n            <div key={index} className=\"flex justify-between items-center p-3 bg-white rounded border\">\n              <div>\n                <p className=\"font-medium text-morandi-primary\">\n                  NT$ {record.base_salary.toLocaleString()}\n                </p>\n                <p className=\"text-sm text-morandi-muted\">{record.reason}</p>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"text-sm text-morandi-secondary\">\n                  {new Date(record.effective_date).toLocaleDateString()}\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/content-container.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/header.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Plus } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { cn } from '@/lib/utils';\n\ninterface HeaderProps {\n  title: string;\n  tabs?: {\n    value: string;\n    label: string;\n  }[];\n  activeTab?: string;\n  onTabChange?: (value: string) => void;\n  onAdd?: () => void;\n  addLabel?: string;\n  children?: React.ReactNode;\n}\n\nexport function Header({\n  title,\n  tabs,\n  activeTab,\n  onTabChange,\n  onAdd,\n  addLabel = 'æ–°å¢',\n  children\n}: HeaderProps) {\n  return (\n    <div className=\"fixed top-0 right-0 left-64 h-[72px] bg-background border-b border-border z-40 flex items-center px-6 transition-all duration-300\">\n      {/* æœ€å·¦å´ - è¿”å›æŒ‰éˆ• */}\n      {children && (\n        <div className=\"flex items-center mr-4\">\n          {children}\n        </div>\n      )}\n\n      {/* å·¦å´ - ä¸»æ¨™é¡Œ */}\n      <h1 className=\"text-lg font-bold text-morandi-primary\">{title}</h1>\n\n      {/* ä¸­é–“ - ç©ºç™½å€åŸŸï¼Œç”¨æ–¼æ¨é–‹å·¦å³å…©å´ */}\n      <div className=\"flex-1\"></div>\n\n      {/* å³å´ - æ¨™ç±¤é  */}\n      {tabs && tabs.length > 0 && (\n        <div className=\"flex items-center\">\n          <div className=\"h-6 w-px bg-border mx-4\"></div>\n          <div className=\"flex items-center space-x-1\">\n            {tabs.map((tab) => (\n              <button\n                key={tab.value}\n                onClick={() => onTabChange?.(tab.value)}\n                className={cn(\n                  'relative px-3 py-2 text-sm font-medium transition-colors',\n                  'text-morandi-secondary hover:text-morandi-primary',\n                  activeTab === tab.value\n                    ? 'text-morandi-primary after:absolute after:bottom-0 after:left-0 after:right-0 after:h-0.5 after:bg-morandi-gold'\n                    : ''\n                )}\n              >\n                {tab.label}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* æœ€å³å´ - æ“ä½œæŒ‰éˆ• */}\n      <div className=\"flex items-center\">\n        {onAdd && (\n          <>\n            <div className=\"h-6 w-px bg-border mx-4\"></div>\n            <Button\n              onClick={onAdd}\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            >\n              <Plus size={16} className=\"mr-2\" />\n              {addLabel}\n            </Button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/main-layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'authUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { useLocalAuthStore } from '@/lib/auth/local-auth-manager';\nimport { Sidebar } from './sidebar';\nimport { cn } from '@/lib/utils';\nimport { usePathname, useRouter } from 'next/navigation';\n\ninterface MainLayoutProps {\n  children: React.ReactNode;\n}\n\nexport function MainLayout({ children }: MainLayoutProps) {\n  const { sidebarCollapsed } = useAuthStore();\n  const { currentProfile } = useLocalAuthStore();\n  const pathname = usePathname();\n  const router = useRouter();\n  const [isClient, setIsClient] = useState(false);\n\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  // è¨˜éŒ„ä½¿ç”¨è€…è¨ªå•çš„é é¢ï¼ˆç”¨æ–¼ç™»å‡ºå¾Œé‡æ–°ç™»å…¥æ™‚è·³å›ï¼‰\n  useEffect(() => {\n    if (!isClient) return;\n    if (pathname === '/login') return;\n\n    // å„²å­˜ç•¶å‰è·¯å¾‘åˆ° localStorage\n    localStorage.setItem('last-visited-path', pathname);\n  }, [isClient, pathname]);\n\n  // ç°¡åŒ–çš„èªè­‰æª¢æŸ¥ - æš«æ™‚åœç”¨,ä½¿ç”¨ auth-store çš„ user\n  useEffect(() => {\n    if (!isClient) return;\n    if (pathname === '/login') return;\n\n    // çµ¦ Zustand persist ä¸€é»æ™‚é–“è¼‰å…¥\n    const checkTimeout = setTimeout(() => {\n      const authUser = useAuthStore.getState().user;\n\n      // æš«æ™‚åœç”¨æª¢æŸ¥,é¿å…ç„¡é™å¾ªç’°\n      // if (!authUser) {\n      //   router.push('/login');\n      // }\n    }, 50);\n\n    return () => clearTimeout(checkTimeout);\n  }, [isClient, pathname, currentProfile, router]);\n\n  // åˆå§‹åŒ–é›¢ç·šè³‡æ–™åº«å’ŒåŸºç¤è³‡æ–™\n  useEffect(() => {\n    if (!isClient) return;\n\n    // é›¢ç·šè³‡æ–™åº«æœƒåœ¨ sync-manager ä¸­è‡ªå‹•åˆå§‹åŒ–\n\n    // è¼‰å…¥åŸºç¤è³‡æ–™ï¼ˆåªè¼‰å…¥å…¨åŸŸéœ€è¦çš„è³‡æ–™ï¼‰\n    const loadInitialData = async () => {\n      try {\n        // è¼‰å…¥å·¥ä½œç©ºé–“ï¼ˆå…¨åŸŸéœ€è¦ï¼‰\n        const { useWorkspaceStore } = await import('@/stores/workspace-store');\n        const workspaceState = useWorkspaceStore.getState();\n        if (!workspaceState.currentWorkspace) {\n          await workspaceState.loadWorkspaces();\n          console.log('âœ… å·¥ä½œç©ºé–“åˆå§‹åŒ–å®Œæˆ');\n        }\n      } catch (error) {\n        console.error('âŒ åˆå§‹è³‡æ–™è¼‰å…¥å¤±æ•—:', error);\n      }\n    };\n\n    loadInitialData();\n  }, [isClient]);\n\n  // ä¸éœ€è¦å´é‚Šæ¬„çš„é é¢\n  const noSidebarPages = ['/login', '/unauthorized'];\n  const shouldShowSidebar = !noSidebarPages.includes(pathname);\n\n  // ä½¿ç”¨è‡ªå®šç¾© layout çš„é é¢ï¼ˆå¦‚è¨˜å¸³ç®¡ç†ï¼‰\n  const customLayoutPages = ['/accounting'];\n  const hasCustomLayout = customLayoutPages.some(page => pathname.startsWith(page));\n\n  // ç™»å…¥é ä¸éœ€è¦å´é‚Šæ¬„\n  if (!shouldShowSidebar) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        {children}\n      </div>\n    );\n  }\n\n  // ä½¿ç”¨è‡ªå®šç¾© layout çš„é é¢åªéœ€è¦å´é‚Šæ¬„\n  if (hasCustomLayout) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        {/* å·¦ä¸‹è±¡é™ - å´é‚Šæ¬„ */}\n        <Sidebar />\n        {/* å…§å®¹ç”±é é¢è‡ªå·±çš„ layout è™•ç† */}\n        {children}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* å·¦ä¸‹è±¡é™ - å´é‚Šæ¬„ */}\n      <Sidebar />\n\n      {/* å³ä¸‹è±¡é™ - ä¸»å…§å®¹å€åŸŸ */}\n      <main className={cn(\n        'fixed top-[72px] bottom-0 right-0 transition-all duration-300',\n        !isClient ? 'left-16' : (sidebarCollapsed ? 'left-16' : 'left-[190px]')\n      )}>\n        <div className=\"p-6 h-full\">\n          {children}\n        </div>\n      </main>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/responsive-header.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[202,205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[202,205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[317,320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[317,320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sidebarCollapsed' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, memo } from 'react';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { cn } from '@/lib/utils';\n\ninterface ResponsiveHeaderProps {\n  title: string;\n  icon?: any;\n  breadcrumb?: { label: string; href: string }[];\n  tabs?: {\n    value: string;\n    label: string;\n    icon?: any;\n  }[];\n  activeTab?: string;\n  onTabChange?: (value: string) => void;\n  onAdd?: () => void;\n  addLabel?: string;\n  children?: React.ReactNode;\n  actions?: React.ReactNode;\n  showBackButton?: boolean;\n  onBack?: () => void;\n  // æœå°‹åŠŸèƒ½\n  showSearch?: boolean;\n  searchTerm?: string;\n  onSearchChange?: (term: string) => void;\n  searchPlaceholder?: string;\n}\n\nexport const ResponsiveHeader = memo(function ResponsiveHeader(props: ResponsiveHeaderProps) {\n  const { sidebarCollapsed } = useAuthStore();\n  const [isSearchOpen, setIsSearchOpen] = useState(false);\n\n  return (\n    <div className={cn(\n      'fixed top-0 right-0 h-[72px] bg-background z-[200] flex items-center justify-between px-6',\n      'left-16'\n    )}\n    >\n      {/* åˆ†å‰²ç·š */}\n      <div className=\"absolute bottom-0 left-0 right-0 pointer-events-none\" style={{ marginLeft: '24px', marginRight: '24px', borderTop: '1px solid var(--border)', height: '1px' }}></div>\n      {/* å·¦å´ - è¿”å›æŒ‰éˆ•å’Œä¸»æ¨™é¡Œ */}\n      <div className=\"flex items-center gap-3 relative z-[300]\">\n        {props.showBackButton && (\n          <button\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              props.onBack?.();\n            }}\n            className=\"text-morandi-secondary hover:text-morandi-primary transition-colors p-2 hover:bg-morandi-container/50 rounded-md cursor-pointer\"\n            type=\"button\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n            </svg>\n          </button>\n        )}\n        <h1 className=\"text-base font-bold text-morandi-primary\">{props.title}</h1>\n      </div>\n\n      {/* å³å´å€åŸŸ - åŠŸèƒ½ã€æ¨™ç±¤é å’Œæ“ä½œæŒ‰éˆ• - çµ±ä¸€ç„¡ç©ºç™½è¨­è¨ˆ */}\n      <div className=\"flex items-center flex-shrink-0 pointer-events-auto\">\n        {/* æœå°‹åŠŸèƒ½ - æœ€å·¦é‚Š */}\n        {props.showSearch && (\n          <div className=\"flex items-center mr-4\">\n            {!isSearchOpen ? (\n              <button\n                onClick={() => setIsSearchOpen(true)}\n                className=\"p-2 text-morandi-secondary hover:text-morandi-primary transition-colors\"\n                title=\"æœå°‹\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                </svg>\n              </button>\n            ) : (\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"text\"\n                  value={props.searchTerm || ''}\n                  onChange={(e) => props.onSearchChange?.(e.target.value)}\n                  placeholder={props.searchPlaceholder || 'æœå°‹...'}\n                  className=\"w-48 px-3 py-1 text-sm border border-border rounded-md focus:outline-none focus:ring-1 focus:ring-morandi-primary\"\n                  autoFocus\n                  onBlur={() => {\n                    if (!props.searchTerm) {\n                      setIsSearchOpen(false);\n                    }\n                  }}\n                />\n                <button\n                  onClick={() => {\n                    props.onSearchChange?.('');\n                    setIsSearchOpen(false);\n                  }}\n                  className=\"p-1 text-morandi-secondary hover:text-morandi-primary transition-colors\"\n                  title=\"æ¸…é™¤æœå°‹\"\n                >\n                  <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* åŠŸèƒ½å€åŸŸ */}\n        {props.children && (\n          <div className=\"flex items-center mr-6\">\n            {props.children}\n          </div>\n        )}\n\n        {/* æ¨™ç±¤é å’Œæ“ä½œæŒ‰éˆ•ç·Šå¯†æ’åˆ— */}\n        <div className=\"flex items-center\">\n          {/* æ¨™ç±¤é  */}\n          {props.tabs && props.tabs.length > 0 && (\n            <div className=\"flex items-center space-x-1 pointer-events-auto\">\n              {props.tabs.map((tab) => (\n                <button\n                  key={tab.value}\n                  onClick={() => props.onTabChange?.(tab.value)}\n                  className={cn(\n                    'relative px-3 py-2 text-sm font-medium transition-colors pointer-events-auto',\n                    'text-morandi-secondary hover:text-morandi-primary',\n                    props.activeTab === tab.value\n                      ? 'text-morandi-primary after:absolute after:bottom-0 after:left-0 after:right-0 after:h-0.5 after:bg-morandi-gold'\n                      : ''\n                  )}\n                >\n                  {tab.label}\n                </button>\n              ))}\n            </div>\n          )}\n\n          {/* æ“ä½œæŒ‰éˆ•ç·Šæ¥åœ¨æ¨™ç±¤é å¾Œé¢ */}\n          {props.actions ? (\n            <div className=\"flex items-center gap-3 ml-3\">\n              {props.actions}\n            </div>\n          ) : props.onAdd ? (\n            <button\n              onClick={props.onAdd}\n              data-create-box\n              className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center transition-colors ml-3\"\n            >\n              <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n              </svg>\n              {props.addLabel || 'æ–°å¢'}\n            </button>\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronLeft' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Receipt' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":28,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleSidebar' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":148,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":148,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logout' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":148,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":148,"endColumn":56}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef, useMemo } from 'react';\nimport Link from 'next/link';\nimport { usePathname } from 'next/navigation';\nimport {\n  ChevronLeft,\n  ChevronRight,\n  Home,\n  MapPin,\n  ShoppingCart,\n  Users,\n  CreditCard,\n  CheckSquare,\n  Settings,\n  Calculator,\n  Database,\n  Building2,\n  Wallet,\n  Clock,\n  UserCog,\n  Receipt,\n  FileText,\n  BarChart3,\n  Calendar,\n  TrendingDown,\n  FileCheck,\n  Edit,\n  Flag\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { SyncStatusIndicator } from './sync-status-indicator';\n\ninterface MenuItem {\n  href: string;\n  label: string;\n  icon: React.ElementType;\n  children?: MenuItem[];\n  requiredPermission?: string;\n}\n\nconst menuItems: MenuItem[] = [\n  {\n    href: '/',\n    label: 'é¦–é ',\n    icon: Home,\n  },\n  {\n    href: '/calendar',\n    label: 'è¡Œäº‹æ›†',\n    icon: Calendar,\n    requiredPermission: 'calendar',\n  },\n  {\n    href: '/workspace',\n    label: 'å·¥ä½œç©ºé–“',\n    icon: Building2,\n    requiredPermission: 'workspace',\n  },\n  {\n    href: '/todos',\n    label: 'å¾…è¾¦äº‹é …',\n    icon: CheckSquare,\n    requiredPermission: 'todos',\n  },\n  {\n    href: '/itinerary',\n    label: 'è¡Œç¨‹ç®¡ç†',\n    icon: Flag,\n    requiredPermission: 'business',\n  },\n  {\n    href: '/tours',\n    label: 'æ—…éŠåœ˜',\n    icon: MapPin,\n    requiredPermission: 'tours',\n  },\n  {\n    href: '/orders',\n    label: 'è¨‚å–®',\n    icon: ShoppingCart,\n    requiredPermission: 'orders',\n  },\n  {\n    href: '/quotes',\n    label: 'å ±åƒ¹å–®',\n    icon: Calculator,\n    requiredPermission: 'quotes',\n  },\n  {\n    href: '/finance',\n    label: 'è²¡å‹™ç³»çµ±',\n    icon: CreditCard,\n    children: [\n      { href: '/finance/payments', label: 'æ”¶æ¬¾ç®¡ç†', icon: CreditCard, requiredPermission: 'payments' },\n      { href: '/finance/requests', label: 'è«‹æ¬¾ç®¡ç†', icon: TrendingDown, requiredPermission: 'requests' },\n      { href: '/finance/treasury', label: 'å‡ºç´ç®¡ç†', icon: Wallet, requiredPermission: 'disbursement' },\n      { href: '/finance/reports', label: 'å ±è¡¨ç®¡ç†', icon: BarChart3, requiredPermission: 'reports' },\n    ]\n  },\n  {\n    href: '/visas',\n    label: 'ç°½è­‰ç®¡ç†',\n    icon: FileCheck,\n    requiredPermission: 'visas',\n  },\n  {\n    href: '/database',\n    label: 'è³‡æ–™ç®¡ç†',\n    icon: Database,\n    requiredPermission: 'database',\n    children: [\n      { href: '/customers', label: 'é¡§å®¢ç®¡ç†', icon: Users, requiredPermission: 'customers' },\n      { href: '/database/regions', label: 'åœ°å€ç®¡ç†', icon: MapPin, requiredPermission: 'database' },\n      { href: '/database/transport', label: 'äº¤é€šé¸é …', icon: ShoppingCart, requiredPermission: 'database' },\n      { href: '/database/activities', label: 'æ´»å‹•é–€ç¥¨', icon: CheckSquare, requiredPermission: 'database' },\n      { href: '/database/pricing', label: 'åƒ¹æ ¼ç®¡ç†', icon: Calculator, requiredPermission: 'database' },\n      { href: '/database/suppliers', label: 'ä¾›æ‡‰å•†ç®¡ç†', icon: Building2, requiredPermission: 'database' },\n    ]\n  },\n  {\n    href: '/hr',\n    label: 'äººè³‡ç®¡ç†',\n    icon: UserCog,\n    requiredPermission: 'hr',\n  },\n];\n\n// åº•éƒ¨å€‹äººå·¥å…·é¸å–®\nconst personalToolItems: MenuItem[] = [\n  {\n    href: '/accounting',\n    label: 'è¨˜å¸³ç®¡ç†',\n    icon: Wallet,\n    requiredPermission: 'accounting',\n  },\n  {\n    href: '/timebox',\n    label: 'ç®±å‹æ™‚é–“',\n    icon: Clock,\n    requiredPermission: 'timebox',\n  },\n];\n\nexport function Sidebar() {\n  const pathname = usePathname();\n  const { sidebarCollapsed, toggleSidebar, user, logout } = useAuthStore();\n  const [hoveredItem, setHoveredItem] = useState<string | null>(null);\n  const [dropdownPosition, setDropdownPosition] = useState({ top: 0, left: 0 });\n  const sidebarRef = useRef<HTMLDivElement>(null);\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const [mounted, setMounted] = useState(false);\n  const [isDropdownHovered, setIsDropdownHovered] = useState(false);\n  const [isSidebarHovered, setIsSidebarHovered] = useState(false);\n\n  // ç¢ºä¿çµ„ä»¶å·²æ›è¼‰\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // æ¸…ç†å®šæ™‚å™¨\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  const handleMouseEnter = (item: MenuItem, element: HTMLElement) => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n\n    if (item.children) {\n      const rect = element.getBoundingClientRect();\n      setDropdownPosition({\n        top: rect.top,\n        left: rect.right + 10  // ç›´æ¥ä½¿ç”¨å…ƒç´ çš„å³é‚Šç•Œ + 10px é–“è·\n      });\n      setHoveredItem(item.href);\n    }\n  };\n\n  const handleMouseLeave = () => {\n    timeoutRef.current = setTimeout(() => {\n      if (!isDropdownHovered) {\n        setHoveredItem(null);\n      }\n    }, 100); // ç¸®çŸ­å»¶é²æ™‚é–“\n  };\n\n  const handleDropdownMouseEnter = () => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n    }\n    setIsDropdownHovered(true);\n  };\n\n  const handleDropdownMouseLeave = () => {\n    setIsDropdownHovered(false);\n    setHoveredItem(null);\n    // åŒæ™‚æ”¶èµ·å´é‚Šæ¬„ï¼ˆå¦‚æœæ˜¯æ‘ºç–Šæ¨¡å¼ï¼‰\n    if (sidebarCollapsed) {\n      setIsSidebarHovered(false);\n    }\n  };\n\n  const is_active = (href: string) => {\n    if (!mounted) return false; // é¿å… hydration error\n    if (href === '/') return pathname === '/';\n    return pathname.startsWith(href);\n  };\n\n  const getHoveredItemChildren = () => {\n    if (!hoveredItem) return [];\n    const item = menuItems.find(item => item.href === hoveredItem);\n    return item?.children || [];\n  };\n\n  // ä½¿ç”¨ useMemo å„ªåŒ–æ¬Šé™éæ¿¾\n  const visibleMenuItems = useMemo(() => {\n    const filterMenuByPermissions = (items: MenuItem[]): MenuItem[] => {\n      if (!user) {\n        return items.filter(item => !item.requiredPermission);\n      }\n\n      const userPermissions = user.permissions || [];\n      const isSuperAdmin = userPermissions.includes('admin');  // admin å°±æ˜¯ç®¡ç†å“¡\n\n      return items\n        .map(item => {\n          // å¦‚æœæœ‰å­é¸å–®ï¼Œå…ˆéæ¿¾å­é¸å–®\n          if (item.children) {\n            const visibleChildren = filterMenuByPermissions(item.children);\n\n            // å¦‚æœæœ‰ä»»ä½•å­é …ç›®å¯è¦‹ï¼Œå°±é¡¯ç¤ºçˆ¶é …ç›®\n            if (visibleChildren.length > 0 || isSuperAdmin) {\n              return {\n                ...item,\n                children: visibleChildren\n              };\n            }\n            // å¦‚æœæ²’æœ‰å¯è¦‹çš„å­é …ç›®ï¼Œéš±è—æ•´å€‹çˆ¶é …ç›®\n            return null;\n          }\n\n          // æ²’æœ‰å­é¸å–®çš„é …ç›®ï¼Œæª¢æŸ¥æ¬Šé™\n          if (!item.requiredPermission) return item;\n          if (isSuperAdmin) return item;\n          return userPermissions.includes(item.requiredPermission) ? item : null;\n        })\n        .filter((item): item is MenuItem => item !== null);\n    };\n\n    return filterMenuByPermissions(menuItems);\n  }, [user]);\n\n  const visiblePersonalToolItems = useMemo(() => {\n    const filterMenuByPermissions = (items: MenuItem[]): MenuItem[] => {\n      if (!user) {\n        return items.filter(item => !item.requiredPermission);\n      }\n\n      const userPermissions = user.permissions || [];\n      const isSuperAdmin = userPermissions.includes('admin');\n\n      return items\n        .map(item => {\n          if (!item.requiredPermission) return item;\n          if (isSuperAdmin) return item;\n          return userPermissions.includes(item.requiredPermission) ? item : null;\n        })\n        .filter((item): item is MenuItem => item !== null);\n    };\n\n    return filterMenuByPermissions(personalToolItems);\n  }, [user]);\n\n  return (\n    <>\n      <div\n        ref={sidebarRef}\n        onMouseEnter={(e) => {\n          // åªæœ‰ç•¶æ»‘é¼ çœŸçš„åœ¨å´é‚Šæ¬„ç¯„åœå…§æ‰è§¸ç™¼ï¼ˆx < 80ï¼‰\n          if (e.clientX < 80) {\n            setIsSidebarHovered(true);\n          }\n        }}\n        onMouseMove={(e) => {\n          // å‹•æ…‹åˆ¤æ–·å®¹å¿ç¯„åœï¼šå±•é–‹æ™‚å…è¨±åˆ° 190pxï¼Œæ”¶èµ·æ™‚åªå…è¨±åˆ° 80px\n          const toleranceWidth = (isSidebarHovered || hoveredItem) ? 190 : 80;\n\n          // æŒçºŒæª¢æŸ¥æ»‘é¼ ä½ç½®\n          if (e.clientX >= toleranceWidth && isSidebarHovered && !isDropdownHovered && !hoveredItem) {\n            setIsSidebarHovered(false);\n          } else if (e.clientX < 80 && !isSidebarHovered) {\n            setIsSidebarHovered(true);\n          }\n        }}\n        onMouseLeave={() => {\n          // åªæœ‰ç•¶æ²’æœ‰ä¸‹æ‹‰é¸å–®æ™‚æ‰æ”¶èµ·\n          if (!hoveredItem && !isDropdownHovered) {\n            setIsSidebarHovered(false);\n          }\n        }}\n        className={cn(\n          'fixed left-0 top-0 h-screen bg-morandi-container border-r border-border z-40 group transition-[width] duration-300',\n          sidebarCollapsed\n            ? (isSidebarHovered || isDropdownHovered)\n              ? 'w-[190px]'\n              : 'w-16'\n            : 'w-[190px]'\n        )}\n      >\n        {/* Logoå€åŸŸ */}\n        <div>\n          <div className=\"h-18 flex items-center relative mx-3\">\n            <div className=\"absolute left-5 top-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 rounded-lg bg-gradient-to-br from-[#d4c5a9] via-[#c9b896] to-[#bfad87] flex items-center justify-center shadow-sm flex-shrink-0 opacity-90\">\n              <span className=\"text-white/95 font-semibold text-lg\">V</span>\n            </div>\n            <div className={cn(\n              \"ml-[58px] text-xl font-bold text-morandi-primary transition-opacity duration-300\",\n              sidebarCollapsed ? ((isSidebarHovered || isDropdownHovered) ? \"opacity-100 pointer-events-auto\" : \"opacity-0 pointer-events-none\") : \"opacity-100 pointer-events-auto\"\n            )}>\n              CORNER\n            </div>\n            {/* ç§»é™¤æ”¶åˆæŒ‰éˆ•ï¼Œä½¿ç”¨ç´” hover æ§åˆ¶ */}\n          </div>\n          <div style={{ marginLeft: '12px', marginRight: '12px', borderTop: '1px solid var(--border)', height: '1px' }}></div>\n        </div>\n\n        {/* å°èˆªé¸å–® */}\n        <nav className=\"flex-1 py-4\">\n          <ul className=\"space-y-1\">\n            {visibleMenuItems.map((item) => (\n              <li key={item.href}>\n                {item.children ? (\n                  // æœ‰å­é¸å–®çš„é …ç›®\n                  <div\n                    className={cn(\n                      'w-full relative h-10 text-sm text-morandi-secondary hover:bg-morandi-container hover:text-morandi-primary transition-colors cursor-pointer',\n                      is_active(item.href) && 'bg-morandi-container text-morandi-primary'\n                    )}\n                    onMouseEnter={(e) => handleMouseEnter(item, e.currentTarget)}\n                    onMouseLeave={handleMouseLeave}\n                  >\n                    <item.icon size={20} className=\"absolute left-8 top-1/2 -translate-x-1/2 -translate-y-1/2\" />\n                    <span className={cn(\n                      \"ml-[58px] block text-left leading-10 transition-opacity duration-300\",\n                      sidebarCollapsed ? ((isSidebarHovered || isDropdownHovered) ? \"opacity-100 pointer-events-auto\" : \"opacity-0 pointer-events-none\") : \"opacity-100 pointer-events-auto\"\n                    )}>\n                      {item.label}\n                    </span>\n                    {!sidebarCollapsed && (\n                      <ChevronRight\n                        size={16}\n                        className=\"absolute right-4 top-1/2 -translate-y-1/2 transition-transform duration-300\"\n                      />\n                    )}\n                  </div>\n                ) : (\n                  // æ²’æœ‰å­é¸å–®çš„é …ç›®\n                  <Link\n                    href={item.href}\n                    prefetch={false}\n                    className={cn(\n                      'w-full relative block h-10 text-sm text-morandi-secondary hover:bg-morandi-container hover:text-morandi-primary transition-colors',\n                      is_active(item.href) && 'bg-morandi-container text-morandi-primary border-r-2 border-morandi-gold'\n                    )}\n                  >\n                    <item.icon size={20} className=\"absolute left-8 top-1/2 -translate-x-1/2 -translate-y-1/2\" />\n                    <span className={cn(\n                      \"ml-[58px] block text-left leading-10 transition-opacity duration-300\",\n                      sidebarCollapsed ? ((isSidebarHovered || isDropdownHovered) ? \"opacity-100 pointer-events-auto\" : \"opacity-0 pointer-events-none\") : \"opacity-100 pointer-events-auto\"\n                    )}>\n                      {item.label}\n                    </span>\n                  </Link>\n                )}\n              </li>\n            ))}\n          </ul>\n        </nav>\n\n        {/* åº•éƒ¨åŠŸèƒ½å€ */}\n        <div className=\"py-4\">\n          <div className=\"mb-4\" style={{ marginLeft: '12px', marginRight: '12px', borderTop: '1px solid var(--border)', height: '1px' }}></div>\n\n          {!sidebarCollapsed && user && (\n            <div className=\"mb-4 mx-4 p-3 bg-morandi-container rounded-lg\">\n              <div className=\"text-sm font-medium text-morandi-primary\">\n                {user.display_name}\n              </div>\n              <div className=\"text-xs text-morandi-secondary\">\n                {user.employee_number}\n              </div>\n            </div>\n          )}\n\n          <ul className=\"space-y-1\">\n            {/* å€‹äººå·¥å…·é¸å–® */}\n            {visiblePersonalToolItems.map((item) => (\n              <li key={item.href}>\n                <Link\n                  href={item.href}\n                  prefetch={false}\n                  className={cn(\n                    'w-full relative block h-10 text-sm text-morandi-secondary hover:bg-morandi-container hover:text-morandi-primary transition-colors',\n                    is_active(item.href) && 'bg-morandi-container text-morandi-primary border-r-2 border-morandi-gold'\n                  )}\n                >\n                  <item.icon size={20} className=\"absolute left-8 top-1/2 -translate-x-1/2 -translate-y-1/2\" />\n                  <span className={cn(\n                    \"ml-[58px] block text-left leading-10 transition-opacity duration-300\",\n                    sidebarCollapsed ? ((isSidebarHovered || isDropdownHovered) ? \"opacity-100\" : \"opacity-0\") : \"opacity-100\"\n                  )}>\n                    {item.label}\n                  </span>\n                </Link>\n              </li>\n            ))}\n\n            {/* åˆ†éš”ç·šï¼ˆå¦‚æœæœ‰å€‹äººå·¥å…·é …ç›®çš„è©±ï¼‰ */}\n            {visiblePersonalToolItems.length > 0 && (\n              <li className=\"my-2\">\n                <div style={{ marginLeft: '12px', marginRight: '12px', borderTop: '1px solid var(--border)', height: '1px' }}></div>\n              </li>\n            )}\n\n            {/* è¨­å®š */}\n            <li>\n              <Link\n                href=\"/settings\"\n                prefetch={false}\n                className={cn(\n                  'w-full relative block h-10 text-sm text-morandi-secondary hover:bg-morandi-container hover:text-morandi-primary transition-colors',\n                  mounted && pathname === '/settings' && 'bg-morandi-container text-morandi-primary border-r-2 border-morandi-gold'\n                )}\n              >\n                <Settings size={20} className=\"absolute left-8 top-1/2 -translate-x-1/2 -translate-y-1/2\" />\n                <span className={cn(\n                  \"ml-[58px] block text-left leading-10 transition-opacity duration-300\",\n                  sidebarCollapsed ? ((isSidebarHovered || isDropdownHovered) ? \"opacity-100 pointer-events-auto\" : \"opacity-0 pointer-events-none\") : \"opacity-100 pointer-events-auto\"\n                )}>\n                  è¨­å®š\n                </span>\n              </Link>\n            </li>\n\n            {/* åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨ */}\n            <li>\n              <SyncStatusIndicator isDropdownHovered={isSidebarHovered || isDropdownHovered} />\n            </li>\n\n          </ul>\n        </div>\n      </div>\n\n      {/* æ‡¸æµ®ä¸‹æ‹‰é¸å–® */}\n      {hoveredItem && getHoveredItemChildren().length > 0 && (\n        <div\n          className=\"fixed bg-card border border-border rounded-lg shadow-lg py-2 min-w-48 z-[60]\"\n          style={{\n            top: dropdownPosition.top,\n            left: dropdownPosition.left,\n          }}\n          onMouseEnter={handleDropdownMouseEnter}\n          onMouseLeave={handleDropdownMouseLeave}\n        >\n          {getHoveredItemChildren().map((child) => (\n            <Link\n              key={child.href}\n              href={child.href}\n              prefetch={false}\n              className={cn(\n                'flex items-center px-4 py-2 text-sm text-morandi-secondary hover:bg-morandi-container hover:text-morandi-primary transition-colors',\n                is_active(child.href) && 'bg-morandi-container text-morandi-primary'\n              )}\n            >\n              <child.icon size={16} className=\"mr-3\" />\n              <span>{child.label}</span>\n            </Link>\n          ))}\n        </div>\n      )}\n    </>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/sync-status-indicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/layout/theme-toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/members/excel-member-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1781,1784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1781,1784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2547,2550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2547,2550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3079,3082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3079,3082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3631,3634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3631,3634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'autoSaveMember'. Either include it or remove the dependency array.","line":120,"column":6,"nodeType":"ArrayExpression","endLine":120,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [departure_date, autoSaveMember]","fix":{"range":[3706,3749],"text":"[departure_date, autoSaveMember]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, useImperativeHandle, forwardRef, useMemo, useCallback } from 'react';\nimport { useMemberStore } from '@/stores';\nimport { Member } from '@/stores/types';\nimport {\n  getGenderFromIdNumber,\n  calculateAge\n} from '@/lib/utils';\nimport { ReactDataSheetWrapper, DataSheetColumn } from '@/components/shared/react-datasheet-wrapper';\n\ninterface MemberTableProps {\n  order_id: string;\n  departure_date: string;\n  member_count: number;\n}\n\nexport interface MemberTableRef {\n  addRow: () => void;\n}\n\ninterface EditingMember extends Omit<Member, 'id' | 'created_at' | 'updated_at'> {\n  id?: string;\n  isNew?: boolean;\n}\n\n\nexport const ExcelMemberTable = forwardRef<MemberTableRef, MemberTableProps>(\n  ({ order_id, departure_date, member_count }, ref) => {\n  const memberStore = useMemberStore();\n  const members = memberStore.items;\n  const [tableMembers, setTableMembers] = useState<EditingMember[]>([]);\n\n  const orderMembers = useMemo(() =>\n    members.filter(member => member.order_id === order_id),\n    [members, order_id]\n  );\n\n  // é…ç½® DataSheet æ¬„ä½\n  const dataSheetColumns: DataSheetColumn[] = [\n    { key: 'index', label: 'åºè™Ÿ', width: 40, readOnly: true },\n    { key: 'name', label: 'å§“å', width: 80 },\n    { key: 'nameEn', label: 'è‹±æ–‡å§“å', width: 100 },\n    { key: 'birthday', label: 'ç”Ÿæ—¥', width: 100 },\n    { key: 'age', label: 'å¹´é½¡', width: 60, readOnly: true },\n    { key: 'gender', label: 'æ€§åˆ¥', width: 50, readOnly: true },\n    { key: 'idNumber', label: 'èº«åˆ†è­‰å­—è™Ÿ', width: 120 },\n    { key: 'passportNumber', label: 'è­·ç…§è™Ÿç¢¼', width: 100 },\n    { key: 'passportExpiry', label: 'è­·ç…§æ•ˆæœŸ', width: 100 },\n    { key: 'reservationCode', label: 'è¨‚ä½ä»£è™Ÿ', width: 100 }\n  ];\n\n  useEffect(() => {\n    const existingMembers = orderMembers.map((member: any) => ({ ...member }));\n\n    // ç¢ºä¿è‡³å°‘æœ‰member_countè¡Œ\n    while (existingMembers.length < member_count) {\n      existingMembers.push({\n        order_id,\n        name: '',\n        name_en: '',\n        birthday: '',\n        passport_number: '',\n        passport_expiry: '',\n        id_number: '',\n        gender: '',\n        age: 0,\n        reservation_code: '',\n        add_ons: [],\n        refunds: [],\n        isNew: true\n      });\n    }\n\n    setTableMembers(existingMembers);\n  }, [orderMembers, member_count, order_id]);\n\n\n  // è‡ªå‹•å„²å­˜æˆå“¡\n  const autoSaveMember = async (member: EditingMember, index: number) => {\n    if (member.isNew && member.name.trim()) {\n      const { isNew, ...memberData } = member;\n      const created = await memberStore.create(memberData as any);\n      const newId = created?.id;\n\n      const updatedMembers = [...tableMembers];\n      updatedMembers[index] = { ...member, id: newId as string, isNew: false };\n      setTableMembers(updatedMembers);\n    } else if (member.id && !member.isNew) {\n      const { isNew, ...memberData } = member;\n      await memberStore.update(member.id, memberData);\n    }\n  };\n\n  // è™•ç†è³‡æ–™æ›´æ–° (ç”¨æ–¼ ReactDataSheet)\n  const handleDataUpdate = useCallback((newData: EditingMember[]) => {\n    // è™•ç†è‡ªå‹•è¨ˆç®—æ¬„ä½\n    const processedData = newData.map((member: any) => {\n      const processed = { ...member };\n\n      // å¾èº«åˆ†è­‰è™Ÿè‡ªå‹•è¨ˆç®—æ€§åˆ¥å’Œå¹´é½¡\n      if (processed.id_number) {\n        processed.gender = getGenderFromIdNumber(processed.id_number);\n        processed.age = calculateAge(processed.id_number, departure_date) as number;\n      }\n      // å¾ç”Ÿæ—¥è¨ˆç®—å¹´é½¡\n      else if (processed.birthday) {\n        processed.age = calculateAge(processed.birthday as string, departure_date) as number;\n      }\n\n      return processed;\n    });\n\n    setTableMembers(processedData);\n\n    // è‡ªå‹•å„²å­˜åˆ° store\n    processedData.forEach((member: any, index: number) => {\n      autoSaveMember(member, index);\n    });\n  }, [departure_date, tableMembers, memberStore]);\n\n  // æ–°å¢è¡Œ\n  const addRow = () => {\n    console.log('addRow called, current tableMembers:', tableMembers.length);\n    const newMember: EditingMember = {\n      order_id,\n      name: '',\n      name_en: '',\n      birthday: '',\n      passport_number: '',\n      passport_expiry: '',\n      id_number: '',\n      gender: '',\n      age: 0,\n      reservation_code: '',\n      add_ons: [],\n      refunds: [],\n      isNew: true\n    };\n    setTableMembers([...tableMembers, newMember]);\n    console.log('New member added, new length should be:', tableMembers.length + 1);\n  };\n\n  // æš´éœ²addRowå‡½æ•¸çµ¦çˆ¶çµ„ä»¶\n  useImperativeHandle(ref, () => ({\n    addRow\n  }));\n\n\n\n\n  return (\n    <div className=\"w-full\">\n      {/* ä½¿ç”¨ ReactDataSheet æ›¿ä»£åŸä¾†çš„è¡¨æ ¼ */}\n      <ReactDataSheetWrapper\n        columns={dataSheetColumns}\n        data={tableMembers.map((member, index) => ({\n          ...member,\n          index: index + 1,\n          age: member.age > 0 ? `${member.age}æ­²` : '',\n          gender: member.gender === 'M' ? 'ç”·' : member.gender === 'F' ? 'å¥³' : ''\n        }))}\n        onDataUpdate={handleDataUpdate}\n        className=\"min-h-[400px]\"\n      />\n\n      <div className=\"text-xs text-morandi-secondary px-6 py-2 space-y-1\">\n        <p>â€¢ é»æ“Šä»»æ„å–®å…ƒæ ¼å³å¯ç·¨è¼¯ï¼Œè‡ªå‹•å„²å­˜</p>\n        <p>â€¢ å¹´é½¡å’Œæ€§åˆ¥ç‚ºè‡ªå‹•è¨ˆç®—æ¬„ä½</p>\n        <p>â€¢ æ”¯æ´ Excel å¼éµç›¤å°èˆªå’Œè¤‡è£½è²¼ä¸Š</p>\n        <p>â€¢ èº«åˆ†è­‰è™Ÿç¢¼æœƒè‡ªå‹•è¨ˆç®—å¹´é½¡å’Œæ€§åˆ¥</p>\n      </div>\n    </div>\n  );\n  }\n);\n\nExcelMemberTable.displayName = 'ExcelMemberTable';","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/network-monitor-initializer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/orders/add-order-form.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2532,2535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2532,2535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2578,2581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2578,2581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2716,2719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2716,2719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3035,3038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3035,3038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3081,3084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3081,3084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3224,3227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3224,3227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useMemo } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Combobox } from '@/components/ui/combobox';\nimport { useTourStore } from '@/stores';\nimport { useUserStore } from '@/stores/user-store';\nimport { useAuthStore } from '@/stores/auth-store';\n\nexport interface OrderFormData {\n  tour_id: string;\n  contact_person: string;\n  sales_person: string;\n  assistant: string;\n  member_count: number;\n  total_amount: number;\n}\n\ninterface AddOrderFormProps {\n  tourId?: string; // å¦‚æœå¾æ—…éŠåœ˜é é¢æ‰“é–‹ï¼Œæœƒå¸¶å…¥ tour_id\n\n  // ç¨ç«‹æ¨¡å¼ï¼ˆç”¨æ–¼ Dialogï¼‰\n  onSubmit?: (orderData: OrderFormData) => void;\n  onCancel?: () => void;\n\n  // åµŒå…¥æ¨¡å¼ï¼ˆç”¨æ–¼åµŒå…¥å…¶ä»–è¡¨å–®ï¼‰\n  value?: Partial<OrderFormData>;\n  onChange?: (orderData: Partial<OrderFormData>) => void;\n}\n\nexport function AddOrderForm({ tourId, onSubmit, onCancel, value, onChange }: AddOrderFormProps) {\n  const { items: tours } = useTourStore();\n  const { items: employees, fetchAll: fetchEmployees } = useUserStore();\n  const { currentProfile } = useAuthStore();\n\n  // åˆ¤æ–·æ˜¯å¦ç‚ºåµŒå…¥æ¨¡å¼\n  const isEmbedded = !!onChange;\n\n  // Debug: æª¢æŸ¥å“¡å·¥è³‡æ–™\n  React.useEffect(() => {\n    console.log('ğŸ” AddOrderForm - å“¡å·¥æ•¸é‡:', employees.length);\n    console.log('ğŸ” AddOrderForm - å“¡å·¥è³‡æ–™:', employees);\n  }, [employees]);\n\n  // å–å¾—ç•¶å‰ç™»å…¥ä½¿ç”¨è€…çš„é¡¯ç¤ºåç¨±\n  const currentUserName = currentProfile?.display_name || currentProfile?.english_name || '';\n\n  // å…§éƒ¨ stateï¼ˆç¨ç«‹æ¨¡å¼ä½¿ç”¨ï¼‰\n  const [internalFormData, setInternalFormData] = useState<Partial<OrderFormData>>({\n    tour_id: tourId || '',\n    contact_person: '',\n    sales_person: currentUserName, // è‡ªå‹•å¸¶å…¥ç•¶å‰ä½¿ç”¨è€…\n    assistant: '',\n    member_count: 1,\n    total_amount: 0,\n  });\n\n  // ä½¿ç”¨å¤–éƒ¨ state æˆ–å…§éƒ¨ state\n  const formData = isEmbedded ? (value || {}) : internalFormData;\n  const updateFormData = isEmbedded ? onChange : setInternalFormData;\n\n  // è¼‰å…¥å“¡å·¥è³‡æ–™\n  React.useEffect(() => {\n    if (employees.length === 0) {\n      fetchEmployees();\n    }\n  }, [employees.length, fetchEmployees]);\n\n  // åªåœ¨åˆå§‹åŒ–æ™‚è‡ªå‹•å¡«å…¥æ¥­å‹™æ¬„ä½ï¼ˆä¹‹å¾Œå…è¨±ç”¨æˆ¶æ¸…ç©ºï¼‰\n  const hasInitialized = React.useRef(false);\n  React.useEffect(() => {\n    if (!isEmbedded && currentUserName && !hasInitialized.current) {\n      setInternalFormData(prev => ({\n        ...prev,\n        sales_person: currentUserName\n      }));\n      hasInitialized.current = true;\n    }\n  }, [currentUserName, isEmbedded]);\n\n  // ç¯©é¸æ¥­å‹™äººå“¡ï¼ˆroles åŒ…å« 'sales'ï¼Œå¦‚æœæ²’æœ‰å‰‡é¡¯ç¤ºå…¨éƒ¨ï¼‰\n  const salesPersons = useMemo(() => {\n    const activeEmployees = employees.filter(emp => {\n      const notDeleted = !(emp as any)._deleted;\n      const isActive = (emp as any).status === 'active';\n      return notDeleted && isActive;\n    });\n\n    const salesOnly = activeEmployees.filter(emp =>\n      (emp as any).roles?.includes('sales')\n    );\n\n    // å¦‚æœæœ‰æ¨™è¨˜æ¥­å‹™çš„å°±åªé¡¯ç¤ºæ¥­å‹™ï¼Œæ²’æœ‰å°±é¡¯ç¤ºæ‰€æœ‰äºº\n    return salesOnly.length > 0 ? salesOnly : activeEmployees;\n  }, [employees]);\n\n  // ç¯©é¸åŠ©ç†ï¼ˆroles åŒ…å« 'assistant'ï¼Œå¦‚æœæ²’æœ‰å‰‡é¡¯ç¤ºå…¨éƒ¨ï¼‰\n  const assistants = useMemo(() => {\n    const activeEmployees = employees.filter(emp => {\n      const notDeleted = !(emp as any)._deleted;\n      const isActive = (emp as any).status === 'active';\n      return notDeleted && isActive;\n    });\n\n    const assistantsOnly = activeEmployees.filter(emp =>\n      (emp as any).roles?.includes('assistant')\n    );\n\n    // å¦‚æœæœ‰æ¨™è¨˜åŠ©ç†çš„å°±åªé¡¯ç¤ºåŠ©ç†ï¼Œæ²’æœ‰å°±é¡¯ç¤ºæ‰€æœ‰äºº\n    return assistantsOnly.length > 0 ? assistantsOnly : activeEmployees;\n  }, [employees]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (onSubmit && !isEmbedded) {\n      onSubmit(formData as OrderFormData);\n    }\n  };\n\n  // åµŒå…¥æ¨¡å¼ç”¨ divï¼Œç¨ç«‹æ¨¡å¼ç”¨ form\n  const Container = isEmbedded ? 'div' : 'form';\n  const containerProps = isEmbedded ? {} : { onSubmit: handleSubmit };\n\n  return (\n    <Container {...containerProps} className=\"space-y-4\">\n      {/* é¸æ“‡æ—…éŠåœ˜ï¼ˆå¦‚æœæ²’æœ‰é è¨­ tour_idï¼‰ */}\n      {!tourId && (\n        <div>\n          <label className=\"text-sm font-medium text-morandi-primary\">é¸æ“‡æ—…éŠåœ˜</label>\n          <Combobox\n            options={tours.map((tour) => ({\n              value: tour.id,\n              label: `${tour.code} - ${tour.name}`,\n              data: tour\n            }))}\n            value={formData.tour_id || ''}\n            onChange={(value) => updateFormData?.({ ...formData, tour_id: value })}\n            placeholder=\"æœå°‹æˆ–é¸æ“‡æ—…éŠåœ˜...\"\n            emptyMessage=\"æ‰¾ä¸åˆ°æ—…éŠåœ˜\"\n            className=\"mt-1\"\n          />\n        </div>\n      )}\n\n      {/* è¯çµ¡äºº */}\n      <div>\n        <label className=\"text-sm font-medium text-morandi-primary\">è¯çµ¡äºº</label>\n        <Input\n          value={formData.contact_person || ''}\n          onChange={(e) => updateFormData?.({ ...formData, contact_person: e.target.value })}\n          placeholder=\"è¼¸å…¥è¯çµ¡äººå§“å\"\n          className=\"mt-1\"\n          required={!isEmbedded}\n        />\n      </div>\n\n      {/* æ¥­å‹™å’ŒåŠ©ç† */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <label className=\"text-sm font-medium text-morandi-primary\">æ¥­å‹™</label>\n          <Combobox\n            options={salesPersons.map((emp) => ({\n              value: emp.display_name || emp.english_name,\n              label: `${emp.display_name || emp.english_name} (${emp.employee_number})`\n            }))}\n            value={formData.sales_person || ''}\n            onChange={(value) => updateFormData?.({ ...formData, sales_person: value })}\n            placeholder=\"é¸æ“‡æ¥­å‹™äººå“¡...\"\n            emptyMessage=\"æ‰¾ä¸åˆ°æ¥­å‹™äººå“¡\"\n            showSearchIcon={true}\n            showClearButton={true}\n            className=\"mt-1\"\n          />\n        </div>\n        <div>\n          <label className=\"text-sm font-medium text-morandi-primary\">åŠ©ç†</label>\n          <Combobox\n            options={assistants.map((emp) => ({\n              value: emp.display_name || emp.english_name,\n              label: `${emp.display_name || emp.english_name} (${emp.employee_number})`\n            }))}\n            value={formData.assistant || ''}\n            onChange={(value) => updateFormData?.({ ...formData, assistant: value })}\n            placeholder=\"é¸æ“‡åŠ©ç†...\"\n            emptyMessage=\"æ‰¾ä¸åˆ°åŠ©ç†\"\n            showSearchIcon={true}\n            showClearButton={true}\n            className=\"mt-1\"\n          />\n        </div>\n      </div>\n\n      {/* åœ˜å“¡äººæ•¸å’Œè¨‚å–®é‡‘é¡ */}\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <label className=\"text-sm font-medium text-morandi-primary\">åœ˜å“¡äººæ•¸</label>\n          <Input\n            type=\"number\"\n            value={formData.member_count || 1}\n            onChange={(e) => updateFormData?.({ ...formData, member_count: Number(e.target.value) })}\n            className=\"mt-1\"\n            min=\"1\"\n          />\n        </div>\n        <div>\n          <label className=\"text-sm font-medium text-morandi-primary\">è¨‚å–®é‡‘é¡</label>\n          <Input\n            type=\"number\"\n            value={formData.total_amount || 0}\n            onChange={(e) => updateFormData?.({ ...formData, total_amount: Number(e.target.value) })}\n            placeholder=\"0\"\n            className=\"mt-1\"\n          />\n        </div>\n      </div>\n\n      {/* æŒ‰éˆ•ï¼ˆåªåœ¨ç¨ç«‹æ¨¡å¼é¡¯ç¤ºï¼‰ */}\n      {!isEmbedded && (\n        <div className=\"flex justify-end space-x-2\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={onCancel}\n          >\n            å–æ¶ˆ\n          </Button>\n          <Button\n            type=\"submit\"\n            disabled={!formData.tour_id || !formData.contact_person}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n          >\n            æ–°å¢è¨‚å–® <span className=\"ml-1 text-xs opacity-70\">(Enter)</span>\n          </Button>\n        </div>\n      )}\n    </Container>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/orders/expandable-order-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ShoppingCart' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":89},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Banknote' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":91,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":99},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":311,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15220,15223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15220,15223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Button } from '@/components/ui/button';\nimport { useTourStore, useOrderStore } from '@/stores';\nimport { ChevronDown, BarChart3, CreditCard, Users, Plus, User, ShoppingCart, DollarSign, Banknote, Trash2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { ExcelMemberTable, MemberTableRef } from '@/components/members/excel-member-table';\nimport { Order } from '@/stores/types';\n\ninterface ExpandableOrderTableProps {\n  orders: Order[];\n  showTourInfo?: boolean;\n  tourDepartureDate?: string; // ç”¨æ–¼æˆå“¡ç®¡ç†çš„å‡ºç™¼æ—¥æœŸ\n  className?: string;\n}\n\nconst orderTabs = [\n  { id: 'overview', label: 'ç¸½è¦½', icon: BarChart3 },\n  { id: 'payment', label: 'ä»˜æ¬¾è¨˜éŒ„', icon: CreditCard },\n  { id: 'members', label: 'æˆå“¡ç®¡ç†', icon: Users },\n];\n\nexport const ExpandableOrderTable = React.memo(function ExpandableOrderTable({ orders, showTourInfo = false, tourDepartureDate, className }: ExpandableOrderTableProps) {\n  const router = useRouter();\n  const tourStore = useTourStore();\n  const tours = tourStore.items;\n  const orderStore = useOrderStore();\n  const deleteOrder = orderStore.delete;\n  const [expandedOrders, setExpandedOrders] = useState<string[]>([]);\n  const [activeTabs, setActiveTabs] = useState<Record<string, string>>({});\n  const memberTableRefs = useRef<Record<string, MemberTableRef | null>>({});\n\n  const toggleOrderExpand = (order_id: string) => {\n    setExpandedOrders(prev =>\n      prev.includes(order_id)\n        ? prev.filter(id => id !== order_id)\n        : [...prev, order_id]\n    );\n    if (!activeTabs[order_id]) {\n      setActiveTabs(prev => ({ ...prev, [order_id]: 'overview' }));\n    }\n  };\n\n  const setActiveTab = (order_id: string, tabId: string) => {\n    setActiveTabs(prev => ({ ...prev, [order_id]: tabId }));\n  };\n\n  const getPaymentBadge = (status: string) => {\n    const badges: Record<string, string> = {\n      'paid': 'bg-morandi-green text-white',\n      'partial': 'bg-morandi-gold text-white',\n      'unpaid': 'bg-morandi-red text-white'\n    };\n    return badges[status] || 'bg-morandi-container text-morandi-secondary';\n  };\n\n  const handleDeleteOrder = async (order: Order, e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    const confirmMessage = `âš ï¸ ç¢ºå®šè¦åˆªé™¤è¨‚å–®ã€Œ${order.order_number}ã€å—ï¼Ÿ\\n\\næ­¤æ“ä½œæœƒå½±éŸ¿ï¼š\\n- åœ˜å“¡åå–®å°‡è¢«ç§»é™¤\\n- æ”¶æ¬¾è¨˜éŒ„å°‡è¢«åˆªé™¤\\n- æ—…éŠåœ˜äººæ•¸çµ±è¨ˆå°‡æ›´æ–°\\n\\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`;\n\n    if (!confirm(confirmMessage)) {\n      return;\n    }\n\n    try {\n      await deleteOrder(order.id);\n      // å¦‚æœè¨‚å–®å±•é–‹ä¸­ï¼Œé—œé–‰å±•é–‹\n      if (expandedOrders.includes(order.id)) {\n        setExpandedOrders(prev => prev.filter(id => id !== order.id));\n      }\n    } catch (err) {\n      console.error('åˆªé™¤è¨‚å–®å¤±æ•—:', err);\n      alert('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <div className={cn(\"border border-border rounded-lg overflow-hidden bg-card shadow-sm flex flex-col\", className)}>\n      <div className=\"overflow-x-auto flex-1\">\n        <table className=\"w-full h-full\">\n          <thead className=\"bg-gradient-to-r from-morandi-container/40 via-morandi-gold/10 to-morandi-container/40 border-b-2 border-morandi-gold/20\">\n            <tr className=\"relative\">\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">è¨‚å–®ç·¨è™Ÿ</span>\n              </th>\n              {showTourInfo && (\n                <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                  <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                  <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ—…éŠåœ˜</span>\n                </th>\n              )}\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">è¯çµ¡äºº</span>\n              </th>\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ¥­å‹™</span>\n              </th>\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">ç‹€æ…‹</span>\n              </th>\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ“ä½œ</span>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {orders.length === 0 ? (\n              <>\n                <tr>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  {showTourInfo && <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>}\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                </tr>\n                <tr>\n                  <td colSpan={showTourInfo ? 6 : 5} className=\"py-8\">\n                  </td>\n                </tr>\n              </>\n            ) : (\n              orders.map((order, index) => (\n              <React.Fragment key={order.id}>\n                <tr\n                  onClick={() => toggleOrderExpand(order.id)}\n                  onDoubleClick={() => {\n                    // é›™æ“Šè·³è½‰åˆ°è¨‚å–®è©³ç´°é é¢\n                    router.push(`/orders/${order.id}`);\n                  }}\n                  className={cn(\n                    \"relative transition-colors cursor-pointer\",\n                    !expandedOrders.includes(order.id) && \"hover:bg-morandi-container/30\"\n                  )}\n                >\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"text-[10px] sm:text-xs font-medium text-morandi-primary\">{order.order_number}</div>\n                  </td>\n\n                  {showTourInfo && (\n                    <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                      <div className=\"text-[10px] sm:text-xs font-medium text-morandi-primary\">{order.tour_name}</div>\n                    </td>\n                  )}\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"flex items-center text-[10px] sm:text-xs\">\n                      <User size={14} className=\"mr-1 text-morandi-secondary\" />\n                      <span className=\"font-medium text-morandi-primary\">{order.contact_person}</span>\n                    </div>\n                  </td>\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"text-[10px] sm:text-xs text-morandi-primary\">{order.sales_person}</div>\n                  </td>\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <span className={cn(\n                      'text-[10px] sm:text-xs font-medium',\n                      order.payment_status === 'paid' ? 'text-morandi-green' :\n                      order.payment_status === 'partial' ? 'text-morandi-gold' :\n                      'text-morandi-red'\n                    )}>\n                      {order.payment_status}\n                    </span>\n                  </td>\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"flex items-center space-x-1\">\n                      {/* å¿«é€Ÿæ”¶æ¬¾æŒ‰éˆ• */}\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          router.push(`/finance/payments?order_id=${order.id}&order_number=${order.order_number}&contact_person=${order.contact_person}&amount=${order.remaining_amount}`);\n                        }}\n                        className=\"h-7 w-7 p-0 text-morandi-green hover:text-morandi-green hover:bg-morandi-green/10 font-bold text-base\"\n                        title=\"å¿«é€Ÿæ”¶æ¬¾\"\n                      >\n                        $\n                      </Button>\n\n                      {/* å¿«é€Ÿè«‹æ¬¾æŒ‰éˆ• */}\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          router.push(`/finance/requests`);\n                        }}\n                        className=\"h-7 w-7 p-0 text-morandi-blue hover:text-morandi-blue hover:bg-morandi-blue/10\"\n                        title=\"å¿«é€Ÿè«‹æ¬¾\"\n                      >\n                        <CreditCard size={14} />\n                      </Button>\n\n                      {/* åˆªé™¤æŒ‰éˆ• */}\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => handleDeleteOrder(order, e)}\n                        className=\"h-7 w-7 p-0 text-morandi-red hover:text-morandi-red hover:bg-morandi-red/10\"\n                        title=\"åˆªé™¤è¨‚å–®\"\n                      >\n                        <Trash2 size={14} />\n                      </Button>\n\n                      <ChevronDown\n                        size={14}\n                        className={cn(\n                          \"text-morandi-secondary transition-transform duration-200\",\n                          expandedOrders.includes(order.id) && \"rotate-180\"\n                        )}\n                      />\n                    </div>\n                  </td>\n\n                  {index < orders.length - 1 && !expandedOrders.includes(order.id) && (\n                    <td className=\"absolute bottom-0 left-4 right-4 h-[1px] bg-border\"></td>\n                  )}\n                </tr>\n\n                {expandedOrders.includes(order.id) && (\n                  <tr>\n                    <td colSpan={showTourInfo ? 6 : 5} className=\"p-0 border-none\">\n                      <div className=\"relative\">\n                        {/* èšç„¦æ•ˆæœï¼šå·¦å´é‡‘è‰²é‚Šæ¢ */}\n                        <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-morandi-gold z-30 rounded-l-lg\"></div>\n\n                        <div className=\"overflow-x-auto ml-1\">\n                          {/* åˆ†é æ¨™ç±¤ */}\n                          <div className=\"flex border-b border-border overflow-x-auto\">\n                            <div className=\"flex min-w-max w-full justify-between\">\n                              <div className=\"flex\">\n                                {orderTabs.map((tab) => {\n                                  const is_active = activeTabs[order.id] === tab.id;\n                                  return (\n                                    <button\n                                      key={tab.id}\n                                      onClick={() => setActiveTab(order.id, tab.id)}\n                                      className={cn(\n                                        'flex items-center space-x-2 px-4 py-3 text-sm font-medium transition-all duration-200 relative whitespace-nowrap flex-shrink-0',\n                                        'hover:bg-morandi-container/50',\n                                        is_active\n                                          ? 'text-morandi-primary bg-white border-b-2 border-morandi-gold shadow-sm'\n                                          : 'text-morandi-secondary hover:text-morandi-primary'\n                                      )}\n                                    >\n                                      <tab.icon size={16} />\n                                      <span>{tab.label}</span>\n                                    </button>\n                                  );\n                                })}\n                              </div>\n\n                              {/* å„åˆ†é çš„å°ˆå±¬æŒ‰éˆ• */}\n                              <div className=\"flex items-center space-x-2 px-4\">\n                                {activeTabs[order.id] === 'members' && (\n                                  <Button\n                                    onClick={(e) => {\n                                      e.preventDefault();\n                                      e.stopPropagation();\n                                      console.log('Button clicked for order:', order.id);\n                                      console.log('Ref available:', !!memberTableRefs.current[order.id]);\n                                      console.log('All refs:', Object.keys(memberTableRefs.current));\n                                      const tableRef = memberTableRefs.current[order.id];\n                                      if (tableRef) {\n                                        console.log('Calling addRow...');\n                                        tableRef.addRow();\n                                      } else {\n                                        console.log('No ref found for order:', order.id);\n                                      }\n                                    }}\n                                    size=\"sm\"\n                                    className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n                                  >\n                                    <Plus size={14} className=\"mr-1\" />\n                                    æ–°å¢è¡Œ\n                                  </Button>\n                                )}\n\n                                {/* çµ±ä¸€çš„è©³ç´°é é¢æŒ‰éˆ• */}\n                                <Button\n                                  onClick={() => {\n                                    // è·³è½‰åˆ°çµ±ä¸€çš„è¨‚å–®è©³ç´°é é¢\n                                    router.push(`/orders/${order.id}`);\n                                  }}\n                                  size=\"sm\"\n                                  variant=\"outline\"\n                                  className=\"border-morandi-container hover:bg-morandi-container text-morandi-secondary hover:text-morandi-primary\"\n                                >\n                                  è©³\n                                </Button>\n                              </div>\n                            </div>\n                          </div>\n\n                          {/* åˆ†é å…§å®¹ */}\n                          {activeTabs[order.id] === 'members' ? (\n                            <ExcelMemberTable\n                              ref={(ref) => { if (ref) memberTableRefs.current[order.id] = ref; }}\n                              order_id={order.id}\n                              departure_date={tourDepartureDate || tours.find((t: any) => t.id === order.tour_id)?.departure_date || ''}\n                              member_count={order.member_count}\n                            />\n                          ) : (\n                            <div className=\"px-6 py-4\">\n                              {activeTabs[order.id] === 'overview' && (\n                                <div className=\"grid grid-cols-2 gap-6\">\n                                  <div className=\"space-y-2\">\n                                    <div className=\"text-sm font-medium text-morandi-secondary\">åŸºæœ¬è³‡è¨Š</div>\n                                    <div className=\"space-y-1\">\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">è¨‚å–®ç·¨è™Ÿ:</span>\n                                        <span className=\"text-morandi-primary\">{order.order_number}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">è¯çµ¡äºº:</span>\n                                        <span className=\"text-morandi-primary\">{order.contact_person}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">æ¥­å‹™:</span>\n                                        <span className=\"text-morandi-primary\">{order.sales_person}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">åŠ©ç†:</span>\n                                        <span className=\"text-morandi-primary\">{order.assistant}</span>\n                                      </div>\n                                    </div>\n                                  </div>\n                                  <div className=\"space-y-2\">\n                                    <div className=\"text-sm font-medium text-morandi-secondary\">ä»˜æ¬¾ç‹€æ…‹</div>\n                                    <div className=\"space-y-1\">\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">ç¸½é‡‘é¡:</span>\n                                        <span className=\"text-morandi-primary font-medium\">NT$ {order.total_amount.toLocaleString()}</span>\n                                      </div>\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">å·²æ”¶æ¬¾:</span>\n                                        <span className=\"text-morandi-green font-medium\">NT$ {order.paid_amount.toLocaleString()}</span>\n                                      </div>\n                                      {order.remaining_amount > 0 && (\n                                        <div className=\"flex justify-between\">\n                                          <span className=\"text-morandi-secondary\">é¤˜æ¬¾:</span>\n                                          <span className=\"text-morandi-red font-medium\">NT$ {order.remaining_amount.toLocaleString()}</span>\n                                        </div>\n                                      )}\n                                      <div className=\"flex justify-between\">\n                                        <span className=\"text-morandi-secondary\">ä»˜æ¬¾ç‹€æ…‹:</span>\n                                        <span className={cn(\n                                          'px-2 py-1 rounded text-xs font-medium',\n                                          getPaymentBadge(order.payment_status)\n                                        )}>\n                                          {order.payment_status}\n                                        </span>\n                                      </div>\n                                    </div>\n                                  </div>\n                                </div>\n                              )}\n\n                              {activeTabs[order.id] === 'payment' && (\n                                <div className=\"space-y-4\">\n                                  <div className=\"border border-border rounded-lg p-4\">\n                                    <div className=\"text-center text-morandi-secondary\">\n                                      <CreditCard size={24} className=\"mx-auto mb-2 opacity-50\" />\n                                      <p>ä»˜æ¬¾è¨˜éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>\n                                    </div>\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </td>\n                  </tr>\n                )}\n              </React.Fragment>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/orders/order-kanban.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1572,1575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1572,1575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { Order, Tour } from '@/stores/types';\nimport { useOrderStore } from '@/stores';\nimport { Users, DollarSign, Calendar, User, AlertTriangle, CheckCircle2, Clock } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Button } from '@/components/ui/button';\n\ninterface OrderKanbanProps {\n  orders: Order[];\n  tours: Tour[];\n  onOrderClick?: (order: Order) => void;\n}\n\ntype PaymentStatus = 'unpaid' | 'partial' | 'paid';\n\nconst columns: Array<{\n  id: PaymentStatus;\n  label: string;\n  color: string;\n  icon: React.ElementType;\n}> = [\n  { id: 'unpaid', label: 'æœªæ”¶æ¬¾', color: 'bg-morandi-gold/10 border-morandi-gold', icon: Clock },\n  { id: 'partial', label: 'éƒ¨åˆ†æ”¶æ¬¾', color: 'bg-morandi-blue/10 border-morandi-blue', icon: CheckCircle2 },\n  { id: 'paid', label: 'å·²æ”¶æ¬¾', color: 'bg-morandi-green/10 border-morandi-green', icon: DollarSign },\n];\n\nexport function OrderKanban({ orders, tours, onOrderClick }: OrderKanbanProps) {\n  const orderStore = useOrderStore();\n  const updateOrder = orderStore.update;\n  const [draggedOrder, setDraggedOrder] = useState<Order | null>(null);\n\n  const getOrdersByStatus = (status: PaymentStatus) => {\n    return orders.filter(order => order.payment_status === status);\n  };\n\n  const handleDragStart = (order: Order) => {\n    setDraggedOrder(order);\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n  };\n\n  const handleDrop = (status: PaymentStatus) => {\n    if (draggedOrder) {\n      updateOrder(draggedOrder.id, { payment_status: status as any });\n      setDraggedOrder(null);\n    }\n  };\n\n  const getTourInfo = (order: Order) => {\n    return tours.find(t => t.id === order.tour_id);\n  };\n\n  const getPaymentProgress = (order: Order) => {\n    if (order.total_amount === 0) return 0;\n    return (order.paid_amount / order.total_amount) * 100;\n  };\n\n  const getDaysUntilDeparture = (tour: Tour | undefined) => {\n    if (!tour) return null;\n    const today = new Date();\n    const departure = new Date(tour.departure_date);\n    const days = Math.ceil((departure.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    return days;\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n      {columns.map((column) => {\n        const columnOrders = getOrdersByStatus(column.id);\n        const Icon = column.icon;\n\n        return (\n          <div\n            key={column.id}\n            className={cn(\n              'flex flex-col rounded-xl border-2 p-4 min-h-[600px]',\n              column.color\n            )}\n            onDragOver={handleDragOver}\n            onDrop={() => handleDrop(column.id)}\n          >\n            {/* æ¬„ä½æ¨™é¡Œ */}\n            <div className=\"flex items-center justify-between mb-4 pb-3 border-b border-border\">\n              <div className=\"flex items-center space-x-2\">\n                <Icon size={18} className=\"text-morandi-primary\" />\n                <h3 className=\"font-semibold text-morandi-primary\">{column.label}</h3>\n              </div>\n              <span className=\"px-2 py-1 bg-morandi-container rounded-full text-xs font-medium text-morandi-secondary\">\n                {columnOrders.length}\n              </span>\n            </div>\n\n            {/* è¨‚å–®å¡ç‰‡åˆ—è¡¨ */}\n            <div className=\"space-y-3 flex-1 overflow-y-auto\">\n              {columnOrders.map((order) => {\n                const tour = getTourInfo(order);\n                const progress = getPaymentProgress(order);\n                const daysUntil = getDaysUntilDeparture(tour);\n                const isUrgent = daysUntil !== null && daysUntil <= 7 && daysUntil >= 0 && order.payment_status !== 'paid';\n\n                return (\n                  <div\n                    key={order.id}\n                    draggable\n                    onDragStart={() => handleDragStart(order)}\n                    onClick={() => onOrderClick?.(order)}\n                    className={cn(\n                      'bg-card border border-border rounded-lg p-4 cursor-move hover:shadow-md transition-all',\n                      'hover:border-morandi-gold',\n                      isUrgent && 'border-morandi-red border-2'\n                    )}\n                  >\n                    {/* ç·Šæ€¥æ¨™ç¤º */}\n                    {isUrgent && (\n                      <div className=\"flex items-center space-x-1 text-morandi-red text-xs font-medium mb-2\">\n                        <AlertTriangle size={12} />\n                        <span>{daysUntil}å¤©å¾Œå‡ºç™¼</span>\n                      </div>\n                    )}\n\n                    {/* è¨‚å–®ç·¨è™Ÿ */}\n                    <div className=\"font-mono text-xs text-morandi-secondary mb-2\">\n                      {order.order_number}\n                    </div>\n\n                    {/* å®¢æˆ¶åç¨± */}\n                    <div className=\"font-semibold text-morandi-primary mb-2 text-lg\">\n                      {order.contact_person}\n                    </div>\n\n                    {/* æ—…éŠåœ˜è³‡è¨Š */}\n                    {tour && (\n                      <div className=\"text-sm text-morandi-secondary mb-3 space-y-1\">\n                        <div className=\"flex items-center space-x-1\">\n                          <Calendar size={12} />\n                          <span>{tour.location}</span>\n                        </div>\n                        <div className=\"text-xs\">\n                          {new Date(tour.departure_date).toLocaleDateString('zh-TW')}\n                        </div>\n                      </div>\n                    )}\n\n                    {/* äººæ•¸ */}\n                    <div className=\"flex items-center space-x-2 text-sm text-morandi-primary mb-3\">\n                      <Users size={14} className=\"text-morandi-secondary\" />\n                      <span>{order.member_count} äºº</span>\n                    </div>\n\n                    {/* é‡‘é¡è³‡è¨Š */}\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-morandi-secondary\">ç¸½é‡‘é¡</span>\n                        <span className=\"font-medium text-morandi-primary\">\n                          ${order.total_amount.toLocaleString()}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between text-sm\">\n                        <span className=\"text-morandi-secondary\">å·²æ”¶</span>\n                        <span className=\"font-medium text-morandi-green\">\n                          ${order.paid_amount.toLocaleString()}\n                        </span>\n                      </div>\n                      {order.remaining_amount > 0 && (\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-morandi-secondary\">æœªæ”¶</span>\n                          <span className=\"font-medium text-morandi-red\">\n                            ${order.remaining_amount.toLocaleString()}\n                          </span>\n                        </div>\n                      )}\n\n                      {/* ä»˜æ¬¾é€²åº¦æ¢ */}\n                      <div className=\"mt-3\">\n                        <div className=\"w-full h-2 bg-morandi-container rounded-full overflow-hidden\">\n                          <div\n                            className={cn(\n                              'h-full transition-all',\n                              progress === 100 ? 'bg-morandi-green' :\n                              progress >= 50 ? 'bg-morandi-gold' : 'bg-morandi-red'\n                            )}\n                            style={{ width: `${progress}%` }}\n                          />\n                        </div>\n                        <div className=\"text-xs text-morandi-secondary mt-1 text-right\">\n                          {progress.toFixed(0)}%\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* æ¥­å‹™è³‡è¨Š */}\n                    <div className=\"mt-3 pt-3 border-t border-border\">\n                      <div className=\"flex items-center space-x-1 text-xs text-morandi-secondary\">\n                        <User size={12} />\n                        <span>{order.sales_person || 'æœªæŒ‡æ´¾'}</span>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n\n              {/* ç©ºç‹€æ…‹ */}\n              {columnOrders.length === 0 && (\n                <div className=\"text-center py-8 text-morandi-secondary\">\n                  <Icon size={32} className=\"mx-auto mb-2 opacity-30\" />\n                  <p className=\"text-sm\">å°šç„¡è¨‚å–®</p>\n                </div>\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/orders/order-list.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/orders/simple-order-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useTourStore' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport { Button } from '@/components/ui/button';\nimport { useTourStore, useOrderStore } from '@/stores';\nimport { User, Trash2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Order } from '@/stores/types';\n\ninterface SimpleOrderTableProps {\n  orders: Order[];\n  showTourInfo?: boolean;\n  className?: string;\n}\n\nexport const SimpleOrderTable = React.memo(function SimpleOrderTable({\n  orders,\n  showTourInfo = false,\n  className\n}: SimpleOrderTableProps) {\n  const router = useRouter();\n  const orderStore = useOrderStore();\n  const deleteOrder = orderStore.delete;\n\n  const handleDeleteOrder = async (order: Order, e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    const confirmMessage = `âš ï¸ ç¢ºå®šè¦åˆªé™¤è¨‚å–®ã€Œ${order.order_number}ã€å—ï¼Ÿ\\n\\næ­¤æ“ä½œæœƒå½±éŸ¿ï¼š\\n- åœ˜å“¡åå–®å°‡è¢«ç§»é™¤\\n- æ”¶æ¬¾è¨˜éŒ„å°‡è¢«åˆªé™¤\\n- æ—…éŠåœ˜äººæ•¸çµ±è¨ˆå°‡æ›´æ–°\\n\\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`;\n\n    if (!confirm(confirmMessage)) {\n      return;\n    }\n\n    try {\n      await deleteOrder(order.id);\n    } catch (err) {\n      console.error('åˆªé™¤è¨‚å–®å¤±æ•—:', err);\n      alert('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <div className={cn(\"border border-border rounded-lg overflow-hidden bg-card shadow-sm flex flex-col\", className)}>\n      <div className=\"overflow-x-auto flex-1\">\n        <table className=\"w-full h-full\">\n          <thead className=\"bg-gradient-to-r from-morandi-container/40 via-morandi-gold/10 to-morandi-container/40 border-b-2 border-morandi-gold/20\">\n            <tr className=\"relative\">\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">è¨‚å–®ç·¨è™Ÿ</span>\n              </th>\n              {showTourInfo && (\n                <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                  <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                  <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ—…éŠåœ˜</span>\n                </th>\n              )}\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">è¯çµ¡äºº</span>\n              </th>\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ¥­å‹™</span>\n              </th>\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">ç‹€æ…‹</span>\n              </th>\n              <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4 relative\">\n                <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ“ä½œ</span>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {orders.length === 0 ? (\n              <>\n                <tr>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  {showTourInfo && <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>}\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4 text-center text-morandi-secondary/50\">-</td>\n                </tr>\n                <tr>\n                  <td colSpan={showTourInfo ? 6 : 5} className=\"py-8\">\n                  </td>\n                </tr>\n              </>\n            ) : (\n              orders.map((order) => (\n                <tr\n                  key={order.id}\n                  onClick={() => {\n                    console.log('è¨‚å–®åˆ—é»æ“Š:', order.id);\n                    router.push(`/orders/${order.id}`);\n                  }}\n                  className=\"relative transition-colors cursor-pointer hover:bg-morandi-container/30\"\n                >\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"text-[10px] sm:text-xs font-medium text-morandi-primary\">{order.order_number}</div>\n                  </td>\n\n                  {showTourInfo && (\n                    <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                      <div className=\"text-[10px] sm:text-xs font-medium text-morandi-primary\">{order.tour_name}</div>\n                    </td>\n                  )}\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"flex items-center text-[10px] sm:text-xs\">\n                      <User size={14} className=\"mr-1 text-morandi-secondary\" />\n                      <span className=\"font-medium text-morandi-primary\">{order.contact_person}</span>\n                    </div>\n                  </td>\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"text-[10px] sm:text-xs text-morandi-primary\">{order.sales_person}</div>\n                  </td>\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <span className={cn(\n                      'text-[10px] sm:text-xs font-medium',\n                      order.payment_status === 'paid' ? 'text-morandi-green' :\n                      order.payment_status === 'partial' ? 'text-morandi-gold' :\n                      'text-morandi-red'\n                    )}>\n                      {order.payment_status}\n                    </span>\n                  </td>\n\n                  <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                    <div className=\"flex items-center space-x-1\">\n                      {/* å¿«é€Ÿæ”¶æ¬¾æŒ‰éˆ• */}\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          router.push(`/finance/payments?order_id=${order.id}&order_number=${order.order_number}&contact_person=${order.contact_person}&amount=${order.remaining_amount}`);\n                        }}\n                        className=\"h-7 w-7 p-0 text-morandi-green hover:text-morandi-green hover:bg-morandi-green/10 font-bold text-base\"\n                        title=\"å¿«é€Ÿæ”¶æ¬¾\"\n                      >\n                        $\n                      </Button>\n\n                      {/* å¿«é€Ÿè«‹æ¬¾æŒ‰éˆ• */}\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          router.push(`/finance/requests`);\n                        }}\n                        className=\"h-7 w-7 p-0 text-morandi-blue hover:text-morandi-blue hover:bg-morandi-blue/10\"\n                        title=\"å¿«é€Ÿè«‹æ¬¾\"\n                      >\n                        Â¥\n                      </Button>\n\n                      {/* åˆªé™¤æŒ‰éˆ• */}\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={(e) => handleDeleteOrder(order, e)}\n                        className=\"h-7 w-7 p-0 text-morandi-red/60 hover:text-morandi-red hover:bg-morandi-red/10\"\n                        title=\"åˆªé™¤è¨‚å–®\"\n                      >\n                        <Trash2 size={14} />\n                      </Button>\n                    </div>\n                  </td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/shared/react-datasheet-wrapper.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[512,515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[512,515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[522,525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[522,525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[532,535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[532,535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[659,662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[659,662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[805,808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[805,808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[909,912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[909,912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[933,936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[933,936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[991,994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[991,994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1034,1037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1034,1037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedRange' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":71,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'columnWidths', 'draggedRow', and 'orderFilter'. Either include them or remove the dependency array.","line":219,"column":6,"nodeType":"ArrayExpression","endLine":219,"endColumn":53,"suggestions":[{"desc":"Update the dependencies array to be: [visibleColumns, data, columnWidths, orderFilter, draggedRow, tour_add_ons, tourPrice]","fix":{"range":[7146,7193],"text":"[visibleColumns, data, columnWidths, orderFilter, draggedRow, tour_add_ons, tourPrice]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7261,7264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7261,7264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cell' is defined but never used. Allowed unused args must match /^_/u.","line":227,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":227,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7888,7891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7888,7891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'enableColumnResize', 'getRoomUsage', 'handleColumnResize', 'isRoomFull', 'onRoomAssign', 'orderFilter', and 'roomOptions'. Either include them or remove the dependency array. If 'onRoomAssign' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":380,"column":6,"nodeType":"ArrayExpression","endLine":380,"endColumn":67,"suggestions":[{"desc":"Update the dependencies array to be: [visibleColumns, enableColumnResize, hoveredColumn, handleColumnResize, onColumnHide, onColumnDelete, orderFilter, roomOptions, onRoomAssign, getRoomUsage, isRoomFull]","fix":{"range":[12891,12952],"text":"[visibleColumns, enableColumnResize, hoveredColumn, handleColumnResize, onColumnHide, onColumnDelete, orderFilter, roomOptions, onRoomAssign, getRoomUsage, isRoomFull]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":617,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19580,19583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19580,19583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19629,19632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19629,19632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cell' is defined but never used. Allowed unused args must match /^_/u.","line":618,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":618,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19640,19643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19640,19643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used. Allowed unused args must match /^_/u.","line":618,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":618,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19648,19651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19648,19651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'j' is defined but never used. Allowed unused args must match /^_/u.","line":618,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":618,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19656,19659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19656,19659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":622,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":622,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19788,19791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19788,19791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":623,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":623,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19851,19854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19851,19854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":628,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":628,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19997,20000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19997,20000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":635,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":635,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20246,20249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20246,20249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":659,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":659,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21172,21175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21172,21175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useCallback, useMemo, useEffect } from 'react';\nimport ReactDataSheet from 'react-datasheet';\nimport { calculateFormula, getMemberContext } from '@/lib/formula-calculator';\nimport { cn } from '@/lib/utils';\nimport { X, EyeOff } from 'lucide-react';\n\n// å¼•å…¥ react-datasheet çš„ CSS (æˆ‘å€‘æœƒè‡ªè¨‚æ¨£å¼)\nimport 'react-datasheet/lib/react-datasheet.css';\n\nexport interface DataSheetColumn {\n  key: string;\n  label: string;\n  width?: number;\n  readOnly?: boolean;\n  dataRenderer?: (value: any, row: any, col: any) => string;\n  valueRenderer?: (cell: any, row: number, col: number) => React.ReactNode;\n  dataEditor?: React.ComponentType<any>;\n  type?: 'text' | 'select' | 'readonly';\n  options?: Array<{ value: string; label: string; disabled?: boolean }>;\n  onCellClick?: (rowData: any, field: string) => void;\n}\n\nexport interface DataSheetProps {\n  columns: DataSheetColumn[];\n  data: any[];\n  tour_add_ons?: any[];\n  tourPrice?: number;\n  onCellsChanged?: (changes: any[]) => void;\n  onDataUpdate?: (newData: any[]) => void;\n  onColumnDelete?: (columnKey: string) => void;\n  onColumnHide?: (columnKey: string) => void;\n  hiddenColumns?: string[];\n  className?: string;\n  orderFilter?: string;\n  roomOptions?: Array<{ value: string; label: string; capacity: number; room_type: string }>;\n  onRoomAssign?: (member_id: string, roomValue: string) => void;\n  getRoomUsage?: (roomValue: string) => { bedCount: number; noBedCount: number; totalCount: number; capacity: number };\n  isRoomFull?: (roomValue: string, excludeMemberId?: string) => boolean;\n  enableColumnResize?: boolean;\n  enableRowDrag?: boolean;\n  tour_id?: string;\n  tourId?: string; // ç›¸å®¹èˆŠåç¨±\n}\n\nexport function ReactDataSheetWrapper({\n  columns,\n  data,\n  tour_add_ons = [],\n  tourPrice = 0,\n  onCellsChanged,\n  onDataUpdate,\n  onColumnDelete,\n  onColumnHide,\n  hiddenColumns = [],\n  className,\n  orderFilter,\n  roomOptions = [],\n  onRoomAssign,\n  getRoomUsage,\n  isRoomFull,\n  enableColumnResize = true,\n  enableRowDrag = true,\n  tour_id,\n  tourId\n}: DataSheetProps) {\n  // çµ±ä¸€ä½¿ç”¨ tour_id (å„ªå…ˆä½¿ç”¨ tour_idï¼Œå…¶æ¬¡ tourId)\n  const finalTourId = tour_id || tourId;\n  const [hoveredColumn, setHoveredColumn] = useState<number | null>(null);\n  const [selectedRange, setSelectedRange] = useState<{start: {i: number, j: number}, end: {i: number, j: number}} | null>(null);\n  const [columnWidths, setColumnWidths] = useState<Record<string, number>>({});\n  const [draggedRow, setDraggedRow] = useState<number | null>(null);\n\n  // éæ¿¾æ‰éš±è—çš„æ¬„ä½\n  const visibleColumns = useMemo(() => {\n    return columns.filter(col => !hiddenColumns.includes(col.key));\n  }, [columns, hiddenColumns]);\n\n  // å¾ localStorage è¼‰å…¥æ¬„ä½å¯¬åº¦\n  useEffect(() => {\n    if (finalTourId) {\n      const savedWidths = localStorage.getItem(`columnWidths_${finalTourId}`);\n      if (savedWidths) {\n        try {\n          setColumnWidths(JSON.parse(savedWidths));\n        } catch (e) {\n          console.warn('Failed to parse saved column widths:', e);\n        }\n      }\n    }\n  }, [finalTourId]);\n\n  // å„²å­˜æ¬„ä½å¯¬åº¦åˆ° localStorage\n  const saveColumnWidth = useCallback((columnKey: string, width: number) => {\n    const newWidths = { ...columnWidths, [columnKey]: width };\n    setColumnWidths(newWidths);\n    if (finalTourId) {\n      localStorage.setItem(`columnWidths_${finalTourId}`, JSON.stringify(newWidths));\n    }\n  }, [columnWidths, finalTourId]);\n\n  // è™•ç†æ¬„ä½å¯¬åº¦èª¿æ•´\n  const handleColumnResize = useCallback((e: React.MouseEvent, columnKey: string) => {\n    if (!enableColumnResize) return;\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const startX = e.clientX;\n    const column = visibleColumns.find(col => col.key === columnKey);\n    const currentWidth = columnWidths[columnKey] || column?.width || 100;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      const diff = e.clientX - startX;\n      const newWidth = Math.max(50, currentWidth + diff);\n      setColumnWidths(prev => ({ ...prev, [columnKey]: newWidth }));\n    };\n\n    const handleMouseUp = () => {\n      const finalWidth = columnWidths[columnKey];\n      if (finalWidth) {\n        saveColumnWidth(columnKey, finalWidth);\n      }\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n  }, [enableColumnResize, visibleColumns, columnWidths, saveColumnWidth]);\n\n  // è™•ç†è¡Œæ‹–æ›³\n  const handleRowDragStart = useCallback((e: React.DragEvent, rowIndex: number) => {\n    if (!enableRowDrag || rowIndex === 0) return; // ä¸å…è¨±æ‹–æ›³æ¨™é¡Œè¡Œ\n    setDraggedRow(rowIndex - 1); // æ¸› 1 å› ç‚ºç¬¬ 0 è¡Œæ˜¯æ¨™é¡Œ\n    e.dataTransfer.effectAllowed = 'move';\n  }, [enableRowDrag]);\n\n  const handleRowDragOver = useCallback((e: React.DragEvent) => {\n    if (!enableRowDrag) return;\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  }, [enableRowDrag]);\n\n  const handleRowDrop = useCallback((e: React.DragEvent, dropRowIndex: number) => {\n    if (!enableRowDrag || draggedRow === null || dropRowIndex === 0) return;\n\n    e.preventDefault();\n    const dropIndex = dropRowIndex - 1; // æ¸› 1 å› ç‚ºç¬¬ 0 è¡Œæ˜¯æ¨™é¡Œ\n\n    if (draggedRow === dropIndex) {\n      setDraggedRow(null);\n      return;\n    }\n\n    const newData = [...data];\n    const draggedItem = newData[draggedRow];\n    newData.splice(draggedRow, 1);\n    newData.splice(dropIndex, 0, draggedItem);\n\n    if (onDataUpdate) {\n      onDataUpdate(newData);\n    }\n\n    setDraggedRow(null);\n  }, [enableRowDrag, draggedRow, data, onDataUpdate]);\n\n  // å°‡æˆ‘å€‘çš„è³‡æ–™è½‰æ›ç‚º react-datasheet æ ¼å¼\n  const sheetData = useMemo(() => {\n    // å‰µå»ºæ¨™é¡Œè¡Œ\n    const headerRow = visibleColumns.map((col, colIndex) => {\n      const width = columnWidths[col.key] || col.width || 100;\n      return {\n        value: col.label,\n        readOnly: true,\n        className: 'datasheet-header',\n        width: width,\n        columnKey: col.key,\n        colIndex: colIndex\n      };\n    });\n\n    // å‰µå»ºè³‡æ–™è¡Œ\n    const dataRows = data.map((row, rowIndex) => {\n      return visibleColumns.map((col, colIndex) => {\n        const value = row[col.key] || '';\n        const isReadOnly = col.readOnly;\n        const width = columnWidths[col.key] || col.width || 100;\n\n        // å¦‚æœæ˜¯å…¬å¼æ¬„ä½ï¼Œè¨ˆç®—çµæœ\n        let displayValue = value;\n        if (typeof value === 'string' && value.startsWith('=')) {\n          const context = getMemberContext(row, tour_add_ons, tourPrice);\n          displayValue = calculateFormula(value, context);\n        }\n\n        return {\n          value: value,\n          displayValue: displayValue,\n          readOnly: isReadOnly || (col.key === 'assignedRoom' && orderFilter),\n          key: `${rowIndex}-${colIndex}`,\n          rowData: row,\n          colKey: col.key,\n          width: width,\n          columnKey: col.key,\n          rowIndex: rowIndex,\n          className: cn(\n            'datasheet-cell',\n            isReadOnly && 'datasheet-readonly',\n            typeof value === 'string' && value.startsWith('=') && 'datasheet-formula',\n            draggedRow === rowIndex && 'dragging'\n          )\n        };\n      });\n    });\n\n    return [headerRow, ...dataRows];\n  }, [visibleColumns, data, tour_add_ons, tourPrice]);\n\n  // è™•ç†å–®å…ƒæ ¼è®Šæ›´\n  const handleCellsChanged = useCallback((changes: any[]) => {\n    if (!onDataUpdate) return;\n\n    const newData = [...data];\n\n    changes.forEach(({ cell, row, col, value }) => {\n      if (row === 0) return; // è·³éæ¨™é¡Œè¡Œ\n\n      const dataRowIndex = row - 1;\n      const column = visibleColumns[col];\n\n      if (column && newData[dataRowIndex]) {\n        newData[dataRowIndex] = {\n          ...newData[dataRowIndex],\n          [column.key]: value\n        };\n      }\n    });\n\n    onDataUpdate(newData);\n\n    if (onCellsChanged) {\n      onCellsChanged(changes);\n    }\n  }, [data, visibleColumns, onDataUpdate, onCellsChanged]);\n\n  // è‡ªè¨‚å€¼æ¸²æŸ“å™¨\n  const valueRenderer = useCallback((cell: any, row: number, col: number) => {\n    // å¦‚æœæ˜¯æ¨™é¡Œè¡Œï¼Œé¡¯ç¤ºå¸¶æœ‰ hover æ§åˆ¶çš„æ¨™é¡Œ\n    if (row === 0) {\n      const column = visibleColumns[col];\n      if (!column) return null;\n\n      // æ ¸å¿ƒæ¬„ä½ä¸å…è¨±åˆªé™¤\n      const isCoreField = ['index', 'name', 'idNumber'].includes(column.key);\n      // è‡ªå®šç¾©æ¬„ä½å¯ä»¥åˆªé™¤\n      const isCustomField = !['index', 'name', 'nameEn', 'birthday', 'age', 'gender', 'idNumber', 'passport_number', 'passportExpiry', 'reservationCode', 'assignedRoom'].includes(column.key);\n      // å¤§éƒ¨åˆ†æ¬„ä½éƒ½å¯ä»¥éš±è—ï¼ˆé™¤äº†æ ¸å¿ƒæ¬„ä½ï¼‰\n      const canHide = !isCoreField;\n\n      return (\n        <div\n          className=\"relative w-full h-full flex items-center justify-center group\"\n          onMouseEnter={() => setHoveredColumn(col)}\n          onMouseLeave={() => setHoveredColumn(null)}\n        >\n          <span className=\"text-xs font-medium text-morandi-secondary\">{cell.value}</span>\n\n          {/* åˆ—å¯¬èª¿æ•´æ§åˆ¶ - é¡¯ç¤ºåœ¨æ‰€æœ‰æ¬„ä½ */}\n          {enableColumnResize && hoveredColumn === col && (\n            <div\n              onMouseDown={(e) => handleColumnResize(e, column.key)}\n              className=\"absolute right-0 top-0 bottom-0 w-2 cursor-col-resize bg-morandi-gold opacity-70 hover:opacity-100 z-20 border-r border-morandi-gold\"\n              title=\"æ‹–æ›³èª¿æ•´æ¬„ä½å¯¬åº¦\"\n            />\n          )}\n\n          {/* æ¬„ä½æ“ä½œæŒ‰éˆ• */}\n          {hoveredColumn === col && (canHide || isCustomField) && (\n            <div className=\"absolute right-4 top-1/2 transform -translate-y-1/2 flex gap-1 bg-white shadow-sm rounded px-1 z-10 border border-gray-200\">\n              {canHide && (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    if (onColumnHide && column) {\n                      onColumnHide(column.key);\n                    }\n                  }}\n                  className=\"p-1 hover:bg-gray-100 rounded\"\n                  title=\"éš±è—æ¬„ä½\"\n                >\n                  <EyeOff size={12} className=\"text-gray-500\" />\n                </button>\n              )}\n              {isCustomField && (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    if (onColumnDelete && column) {\n                      onColumnDelete(column.key);\n                    }\n                  }}\n                  className=\"p-1 hover:bg-red-100 rounded\"\n                  title=\"åˆªé™¤æ¬„ä½\"\n                >\n                  <X size={12} className=\"text-red-500\" />\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    // å¦‚æœæœ‰éŒ¯èª¤ï¼Œé¡¯ç¤ºéŒ¯èª¤\n    if (cell.displayValue === '#ERROR') {\n      return <span className=\"text-red-500 text-xs\">éŒ¯èª¤</span>;\n    }\n\n    // ç‰¹æ®Šæ¬„ä½è™•ç†ï¼šåˆ†æˆ¿æ¬„ä½\n    if (col < visibleColumns.length) {\n      const column = visibleColumns[col];\n      if (column.key === 'assignedRoom' && orderFilter && cell.rowData?.id) {\n        // è¨‚å–®è©³ç´°é é¢ - é¡¯ç¤ºæ“ä½œä¸‹æ‹‰é¸å–®\n        const member = cell.rowData;\n        return (\n          <select\n            value={\n              member.isChildNoBed\n                ? (member.assignedRoom ? `no-bed-${member.assignedRoom}` : 'no-bed')\n                : (member.assignedRoom || '')\n            }\n            onChange={(e) => {\n              if (onRoomAssign && member.id) {\n                onRoomAssign(member.id, e.target.value);\n              }\n            }}\n            className=\"w-full h-8 px-2 border border-gray-300 rounded text-xs bg-white focus:outline-none focus:ring-2 focus:ring-morandi-gold\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <option value=\"\">æœªåˆ†é…</option>\n            <option value=\"no-bed\">ä¸ä½”åºŠ</option>\n\n            {/* ä¸€èˆ¬æˆ¿é–“é¸é … */}\n            {roomOptions.map(roomOption => {\n              const usage = getRoomUsage ? getRoomUsage(roomOption.value) : { bedCount: 0, noBedCount: 0, totalCount: 0, capacity: roomOption.capacity };\n              const isFull = isRoomFull ? isRoomFull(roomOption.value, member.id) : false;\n              const isCurrentRoom = member.assignedRoom === roomOption.value && !member.isChildNoBed;\n\n              if (isFull && !isCurrentRoom) {\n                return null;\n              }\n\n              return (\n                <option key={roomOption.value} value={roomOption.value}>\n                  {roomOption.value} ({usage.bedCount}/{usage.capacity}åºŠ{usage.noBedCount > 0 ? ` +${usage.noBedCount}ä¸ä½”åºŠ` : ''})\n                </option>\n              );\n            }).filter(Boolean)}\n\n            {/* ä¸ä½”åºŠ + æˆ¿é–“é¸é … */}\n            {member.isChildNoBed && roomOptions.map(roomOption => (\n              <option key={`no-bed-${roomOption.value}`} value={`no-bed-${roomOption.value}`}>\n                ä¸ä½”åºŠ - {roomOption.value}\n              </option>\n            ))}\n          </select>\n        );\n      }\n    }\n\n    // å¦‚æœæ˜¯å…¬å¼ï¼Œé¡¯ç¤ºè¨ˆç®—çµæœ\n    if (cell.displayValue !== cell.value) {\n      return <span className=\"text-morandi-primary text-xs\">{cell.displayValue}</span>;\n    }\n\n    // ä¸€èˆ¬é¡¯ç¤º\n    return <span className=\"text-morandi-primary text-xs\">{cell.value}</span>;\n  }, [visibleColumns, hoveredColumn, onColumnHide, onColumnDelete]);\n\n  // å¢å¼·éµç›¤å°èˆª\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    // Ctrl+C è¤‡è£½\n    if (e.ctrlKey && e.key === 'c') {\n      console.log('Copy triggered');\n      // react-datasheet å…§å»ºæ”¯æŒ\n    }\n    // Ctrl+V è²¼ä¸Š\n    else if (e.ctrlKey && e.key === 'v') {\n      console.log('Paste triggered');\n      // react-datasheet å…§å»ºæ”¯æŒ\n    }\n    // Delete éµæ¸…é™¤å…§å®¹\n    else if (e.key === 'Delete') {\n      console.log('Delete triggered');\n      // å¯ä»¥åœ¨æ­¤æ·»åŠ è‡ªå®šç¾©æ¸…é™¤é‚è¼¯\n    }\n  }, []);\n\n  // è™•ç†é¸æ“‡ç¯„åœè®Šæ›´\n  const handleSelect = useCallback((start: {i: number, j: number}, end?: {i: number, j: number}) => {\n    if (!start) return;\n\n    // å¦‚æœæ²’æœ‰ endï¼Œå‰‡è¨­ç‚ºèˆ‡ start ç›¸åŒï¼ˆå–®å€‹å„²å­˜æ ¼é¸æ“‡ï¼‰\n    const endCell = end || start;\n\n    setSelectedRange({ start, end: endCell });\n\n    if (start.i !== endCell.i || start.j !== endCell.j) {\n      console.log('Multi-cell selection:', start, 'to', endCell);\n    }\n  }, []);\n\n  return (\n    <div className={cn(\"excel-datasheet-wrapper\", className)}>\n      <style jsx>{`\n        /* ç¢ºä¿çµ„ä»¶æœ¬èº«æ”¯æ´æ©«å‘æ’åˆ— */\n        .excel-datasheet-wrapper {\n          width: 100%;\n          overflow-x: auto;\n        }\n        /* é™åˆ¶æ¨£å¼åªå½±éŸ¿ç•¶å‰çµ„ä»¶ */\n        :global(.excel-datasheet-wrapper .data-grid-container) {\n          font-family: inherit;\n          font-size: 14px;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid) {\n          border: 1px solid #e5e7eb;\n          border-radius: 8px;\n          overflow: hidden;\n          width: 100%;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid table) {\n          width: 100%;\n          border-collapse: collapse;\n          table-layout: auto;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell) {\n          border: 1px solid #e5e7eb;\n          padding: 8px;\n          min-height: 32px;\n          background: white;\n          text-align: left;\n          vertical-align: middle;\n          white-space: nowrap;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid td) {\n          padding: 4px 8px;\n          border: 1px solid #e5e7eb;\n          min-width: 80px;\n          max-width: 200px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid th) {\n          padding: 8px;\n          border: 1px solid #e5e7eb;\n          background: #f3f4f6;\n          font-weight: 600;\n          color: #374151;\n          text-align: center;\n          min-width: 80px;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.selected) {\n          border: 2px solid #d97706;\n          background: #fef3c7;\n          outline: none;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.editing) {\n          border: 2px solid #d97706;\n          background: white;\n          padding: 0;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.editing input) {\n          width: 100%;\n          height: 32px;\n          padding: 4px 8px;\n          border: none;\n          outline: none;\n          font-size: 14px !important;\n          background: transparent;\n          font-family: inherit;\n          line-height: 1.4;\n        }\n\n        :global(.excel-datasheet-wrapper .datasheet-header) {\n          background: #f3f4f6;\n          font-weight: 600;\n          color: #374151;\n          text-align: center;\n        }\n\n        :global(.excel-datasheet-wrapper .datasheet-readonly) {\n          background: #fafafa;\n          color: #6b7280;\n        }\n\n        :global(.excel-datasheet-wrapper .datasheet-formula) {\n          background: #ecfdf5;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell:hover) {\n          background: #f9fafb;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.read-only:hover) {\n          background: #f3f4f6;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.selected) {\n          background: rgba(217, 119, 6, 0.1);\n          border: 1px solid #d97706;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid:focus-within .cell.selected) {\n          outline: 2px solid #d97706;\n          outline-offset: -2px;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.copying) {\n          border: 2px dashed #059669;\n          background: rgba(5, 150, 105, 0.1);\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid .cell.selected::after) {\n          content: '';\n          position: absolute;\n          bottom: -2px;\n          right: -2px;\n          width: 6px;\n          height: 6px;\n          background: #d97706;\n          cursor: crosshair;\n          border: 1px solid white;\n        }\n\n        /* åˆ—å¯¬èª¿æ•´æ¨£å¼ */\n        :global(.excel-datasheet-wrapper .resize-handle) {\n          position: absolute;\n          right: 0;\n          top: 0;\n          bottom: 0;\n          width: 4px;\n          cursor: col-resize;\n          background: transparent;\n          z-index: 10;\n        }\n\n        :global(.excel-datasheet-wrapper .resize-handle:hover) {\n          background: #d97706;\n        }\n\n        /* è¡Œæ‹–æ›³æ¨£å¼ */\n        :global(.excel-datasheet-wrapper .data-grid tr.draggable) {\n          cursor: move;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid tr.draggable:hover) {\n          background: rgba(217, 119, 6, 0.05);\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid tr.dragging) {\n          opacity: 0.5;\n          background: rgba(217, 119, 6, 0.1);\n          border-left: 3px solid #d97706;\n        }\n\n        /* å„ªåŒ–è¡¨æ ¼å¸ƒå±€ */\n        :global(.excel-datasheet-wrapper .data-grid table) {\n          table-layout: fixed;\n          border-collapse: separate;\n          border-spacing: 0;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid td) {\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          border-right: 1px solid #e5e7eb;\n          border-bottom: 1px solid #e5e7eb;\n        }\n\n        :global(.excel-datasheet-wrapper .data-grid th) {\n          position: relative;\n          border-right: 1px solid #e5e7eb;\n          border-bottom: 1px solid #e5e7eb;\n          background: #f9fafb;\n          user-select: none;\n        }\n      `}</style>\n\n      <div\n        onKeyDown={(e) => {\n          handleKeyDown(e);\n          // é˜»æ­¢æ–¹å‘éµæ»¾å‹•é é¢\n          if (['ArrowDown', 'ArrowUp', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {\n            e.preventDefault();\n            e.stopPropagation();\n          }\n        }}\n        tabIndex={0}\n      >\n        {/* @ts-ignore - ReactDataSheet å‹åˆ¥å®šç¾©ä¸å®Œæ•´ */}\n        <ReactDataSheet\n          data={sheetData}\n          onCellsChanged={handleCellsChanged}\n          valueRenderer={valueRenderer}\n          dataRenderer={(cell: any) => cell.value}\n          onContextMenu={(e: any, cell: any, i: any, j: any) => e.preventDefault()}\n          // å¢å¼·å¤šå„²å­˜æ ¼é¸æ“‡\n          onSelect={handleSelect}\n          // è™•ç†è¤‡è£½è²¼ä¸Š\n          parsePaste={(str: any) => {\n            return str.split(/\\r\\n|\\n|\\r/).map((row: any) => row.split('\\t'));\n          }}\n          // å•Ÿç”¨ Excel å¼åŠŸèƒ½\n          tabBehaviour={'default'}\n          // è‡ªå®šç¾©éµç›¤å°èˆª\n          onKeyDown={(e: any) => {\n            // é˜»æ­¢æ–¹å‘éµæ»¾å‹•é é¢\n            if (['ArrowDown', 'ArrowUp', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {\n              e.preventDefault();\n              e.stopPropagation();\n            }\n          }}\n          rowRenderer={(props: any) => {\n            const rowIndex = props['data-row'];\n            const isDraggable = enableRowDrag && rowIndex > 0; // ä¸å…è¨±æ‹–æ›³æ¨™é¡Œè¡Œ\n            const isDragging = draggedRow === rowIndex - 1;\n\n            return (\n              <tr\n                {...props}\n                draggable={isDraggable}\n                onDragStart={(e) => handleRowDragStart(e, rowIndex)}\n                onDragOver={handleRowDragOver}\n                onDrop={(e) => handleRowDrop(e, rowIndex)}\n                className={cn(\n                  props.className,\n                  isDragging && 'opacity-50 bg-morandi-gold/10',\n                  isDraggable && 'hover:bg-morandi-gold/5 cursor-move'\n                )}\n                style={{\n                  ...props.style,\n                  borderLeft: isDragging ? '3px solid #d97706' : undefined\n                }}\n              />\n            );\n          }}\n          cellRenderer={(props: any) => {\n            // éæ¿¾æ‰é DOM å±¬æ€§\n            const {\n              editing,\n              selected,\n              updated,\n              width,\n              columnKey,\n              rowIndex,\n              attributesRenderer,\n              valueRenderer,\n              dataRenderer,\n              ...tdProps\n            } = props;\n            const cellWidth = width || 100;\n\n            return (\n              <td\n                {...tdProps}\n                style={{\n                  ...props.style,\n                  padding: 0,\n                  width: `${cellWidth}px`,\n                  minWidth: `${cellWidth}px`,\n                  maxWidth: `${cellWidth}px`\n                }}\n              />\n            );\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\n// å°å‡º react-datasheet ç›¸é—œé¡å‹\nexport type { ReactDataSheet };\nexport default ReactDataSheet;","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/sync-indicator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Cloud' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CloudOff' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Loader2' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipContent' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipProvider' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipTrigger' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\n/**\n * ğŸ”„ åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨çµ„ä»¶\n *\n * é¡¯ç¤ºç›®å‰çš„åŒæ­¥ç‹€æ…‹å’Œå¾…åŒæ­¥æ•¸é‡\n * å¯é»æ“Šæ‰‹å‹•è§¸ç™¼åŒæ­¥\n */\n\n// import { useAutoSync } from '@/lib/offline/auto-sync-provider'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport {\n  Cloud,\n  CloudOff,\n  Loader2,\n  RefreshCw,\n  CheckCircle,\n  AlertCircle\n} from 'lucide-react'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\n\nexport function SyncIndicator() {\n  // TODO: å¯¦ä½œè‡ªå‹•åŒæ­¥åŠŸèƒ½\n  return null;\n\n  /* const { syncStatus, isOnline, triggerSync } = useAutoSync()\n\n  const handleSync = async () => {\n    try {\n      await triggerSync()\n    } catch (error) {\n      console.error('åŒæ­¥å¤±æ•—:', error)\n    }\n  }\n\n  // è¨ˆç®—åŒæ­¥ç‹€æ…‹\n  const pendingCount = syncStatus?.pendingCount || 0\n  const isSyncing = syncStatus?.isSyncing || false\n  const hasErrors = (syncStatus?.errors?.length || 0) > 0\n\n  // é¡¯ç¤ºåœ–ç¤º\n  const renderIcon = () => {\n    if (!isOnline) {\n      return <CloudOff className=\"h-4 w-4 text-muted-foreground\" />\n    }\n    if (isSyncing) {\n      return <Loader2 className=\"h-4 w-4 animate-spin text-blue-500\" />\n    }\n    if (hasErrors) {\n      return <AlertCircle className=\"h-4 w-4 text-yellow-500\" />\n    }\n    if (pendingCount === 0) {\n      return <CheckCircle className=\"h-4 w-4 text-green-500\" />\n    }\n    return <Cloud className=\"h-4 w-4 text-blue-500\" />\n  }\n\n  // é¡¯ç¤ºæç¤ºæ–‡å­—\n  const getTooltipText = () => {\n    if (!isOnline) return 'é›¢ç·šæ¨¡å¼'\n    if (isSyncing) return 'åŒæ­¥ä¸­...'\n    if (hasErrors) return `åŒæ­¥å¤±æ•—: ${syncStatus?.errors?.length || 0} å€‹éŒ¯èª¤`\n    if (pendingCount === 0) return 'æ‰€æœ‰è³‡æ–™å·²åŒæ­¥'\n    return `å¾…åŒæ­¥: ${pendingCount} ç­†`\n  }\n\n  return (\n    <TooltipProvider>\n      <div className=\"flex items-center gap-2\">\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleSync}\n              disabled={isSyncing || !isOnline}\n              className=\"gap-2\"\n            >\n              {renderIcon()}\n              {pendingCount > 0 && (\n                <Badge variant=\"secondary\" className=\"h-5 px-1.5 text-xs\">\n                  {pendingCount}\n                </Badge>\n              )}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent>\n            <p>{getTooltipText()}</p>\n          </TooltipContent>\n        </Tooltip>\n      </div>\n    </TooltipProvider>\n  ) */\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/sync-status-badge.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'updateStatus'. Either include it or remove the dependency array.","line":44,"column":6,"nodeType":"ArrayExpression","endLine":44,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [tableName, updateStatus]","fix":{"range":[1226,1237],"text":"[tableName, updateStatus]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { checkPendingCount, isOnline } from '@/lib/sync/sync-status-service';\nimport { Cloud, CloudOff, AlertCircle } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport type { TableName } from '@/lib/db';\n\ninterface SyncStatusBadgeProps {\n  tableName: TableName;\n  label?: string; // ä¾‹å¦‚ï¼šã€Œæ—…éŠåœ˜ã€ã€Œè¨‚å–®ã€\n}\n\n/**\n * é é¢ç´šåˆ¥çš„åŒæ­¥ç‹€æ…‹å¾½ç« \n * é¡¯ç¤ºç•¶å‰é é¢ç›¸é—œè¡¨çš„åŒæ­¥ç‹€æ…‹\n */\nexport function SyncStatusBadge({ tableName, label }: SyncStatusBadgeProps) {\n  const [pendingCount, setPendingCount] = useState(0);\n  const [online, setOnline] = useState(true);\n  const [mounted, setMounted] = useState(false);\n\n  const updateStatus = async () => {\n    const count = await checkPendingCount(tableName);\n    setPendingCount(count);\n    setOnline(isOnline());\n  };\n\n  useEffect(() => {\n    setMounted(true);\n    updateStatus();\n\n    // ç›£è½ç¶²è·¯ç‹€æ…‹è®ŠåŒ–\n    const handleOnline = () => updateStatus();\n    const handleOffline = () => updateStatus();\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, [tableName]);\n\n  // SSR æœŸé–“ä¸æ¸²æŸ“\n  if (!mounted) {\n    return null;\n  }\n\n  // æ±ºå®šç‹€æ…‹\n  const getStatus = () => {\n    if (!online) {\n      return {\n        color: 'text-morandi-red',\n        bgColor: 'bg-morandi-red/10',\n        icon: CloudOff,\n        text: 'é›¢ç·šæ¨¡å¼'\n      };\n    }\n\n    if (pendingCount > 0) {\n      return {\n        color: 'text-morandi-gold',\n        bgColor: 'bg-morandi-gold/10',\n        icon: AlertCircle,\n        text: `${pendingCount} ç­†å¾…åŒæ­¥`\n      };\n    }\n\n    return {\n      color: 'text-morandi-green',\n      bgColor: 'bg-morandi-green/10',\n      icon: Cloud,\n      text: 'å·²åŒæ­¥'\n    };\n  };\n\n  const status = getStatus();\n  const Icon = status.icon;\n\n  return (\n    <div className={cn(\n      'inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm',\n      status.bgColor\n    )}>\n      <Icon size={16} className={status.color} />\n      <span className={cn('font-medium', status.color)}>\n        {label && `${label}ï¼š`}{status.text}\n      </span>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/sync/sync-status-indicator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localDB' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11694,11697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11694,11697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { backgroundSyncService } from '@/lib/sync/background-sync-service';\nimport { localDB } from '@/lib/db';\nimport { TABLES } from '@/lib/db/schemas';\nimport {\n  Wifi, WifiOff, Cloud, CloudOff,\n  RefreshCw, AlertCircle, Clock,\n  ChevronDown, ChevronUp, X\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { formatDistanceToNow } from 'date-fns';\nimport { zhTW } from 'date-fns/locale';\n\n/**\n * æª¢æŸ¥æ‰€æœ‰è¡¨æ ¼çš„å¾…åŒæ­¥æ•¸é‡\n */\nasync function checkPendingCount(): Promise<number> {\n  let totalCount = 0;\n\n  for (const tableName of Object.values(TABLES)) {\n    try {\n      const count = await backgroundSyncService.getPendingCount(tableName);\n      totalCount += count;\n    } catch (error) {\n      console.warn(`ç„¡æ³•å–å¾— ${tableName} çš„å¾…åŒæ­¥æ•¸é‡:`, error);\n    }\n  }\n\n  return totalCount;\n}\n\n/**\n * æª¢æŸ¥ç¶²è·¯é€£ç·šç‹€æ…‹\n */\nfunction checkOnline(): boolean {\n  return typeof navigator !== 'undefined' ? navigator.onLine : true;\n}\n\n// ===== ä¸»è¦åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨ï¼ˆFastIn æ¶æ§‹ç‰ˆæœ¬ï¼‰=====\nexport function SyncStatusIndicator() {\n  const [isOnline, setIsOnline] = useState(checkOnline());\n  const [hasPendingChanges, setHasPendingChanges] = useState(false);\n  const [pendingCount, setPendingCount] = useState(0);\n  const [lastSyncTime, setLastSyncTime] = useState<Date | null>(null);\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const [showNotification, setShowNotification] = useState(false);\n  const [isMounted, setIsMounted] = useState(false);\n\n  // ç›£è½ç¶²è·¯ç‹€æ…‹\n  useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, []);\n\n  // å®šæœŸæª¢æŸ¥å¾…åŒæ­¥æ•¸é‡ï¼ˆæ¯ 15 ç§’ï¼‰\n  useEffect(() => {\n    const checkSync = async () => {\n      const count = await checkPendingCount();\n      setPendingCount(count);\n      setHasPendingChanges(count > 0);\n    };\n\n    // ç«‹å³åŸ·è¡Œä¸€æ¬¡\n    checkSync();\n\n    // æ¯ 15 ç§’æª¢æŸ¥ä¸€æ¬¡\n    const interval = setInterval(checkSync, 15000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  // ç›£è½ç¶²è·¯ç‹€æ…‹è®ŠåŒ–ï¼Œé¡¯ç¤ºé€šçŸ¥\n  useEffect(() => {\n    const handleOnline = () => {\n      setIsOnline(true);\n      setShowNotification(true);\n      setTimeout(() => setShowNotification(false), 3000);\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      setShowNotification(true);\n      setTimeout(() => setShowNotification(false), 3000);\n    };\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  const handleManualSync = async () => {\n    if (!isOnline || isSyncing) return;\n\n    setIsSyncing(true);\n    try {\n      await backgroundSyncService.syncAllTables();\n      setShowNotification(true);\n      setLastSyncTime(new Date());\n      setTimeout(() => setShowNotification(false), 3000);\n    } catch (error) {\n      console.error('æ‰‹å‹•åŒæ­¥å¤±æ•—:', error);\n    } finally {\n      setIsSyncing(false);\n    }\n  };\n\n  const getStatusColor = () => {\n    if (!isOnline) return 'text-red-500';\n    if (isSyncing) return 'text-yellow-500';\n    if (hasPendingChanges) return 'text-orange-500';\n    return 'text-green-500';\n  };\n\n  const getStatusIcon = () => {\n    if (!isMounted) return <Cloud className=\"w-4 h-4\" />; // é è¨­é¡¯ç¤º Cloud é¿å… hydration éŒ¯èª¤\n    if (!isOnline) return <CloudOff className=\"w-4 h-4\" />;\n    if (isSyncing) return <RefreshCw className=\"w-4 h-4 animate-spin\" />;\n    if (hasPendingChanges) return <Cloud className=\"w-4 h-4\" />;\n    return <Cloud className=\"w-4 h-4\" />; // å·²åŒæ­¥ä¹Ÿé¡¯ç¤º Cloud\n  };\n\n  const getStatusText = () => {\n    if (!isOnline) return 'é›¢ç·šæ¨¡å¼';\n    if (isSyncing) return 'åŒæ­¥ä¸­...';\n    if (hasPendingChanges) return `${pendingCount} å€‹å¾…åŒæ­¥`;\n    return 'å·²åŒæ­¥';\n  };\n\n  const formatLastSyncTime = () => {\n    if (!lastSyncTime) return 'å°šæœªåŒæ­¥';\n\n    try {\n      return formatDistanceToNow(new Date(lastSyncTime), {\n        addSuffix: true,\n        locale: zhTW\n      });\n    } catch {\n      return 'å°šæœªåŒæ­¥';\n    }\n  };\n\n  return (\n    <>\n      <div className=\"fixed bottom-4 right-4 z-50\">\n        <div className={cn(\n          \"bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300\",\n          isExpanded ? \"w-80\" : \"w-auto\"\n        )}>\n          <div\n            className=\"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg\"\n            onClick={() => setIsExpanded(!isExpanded)}\n          >\n            <div className=\"flex items-center gap-3\">\n              <div className={cn(\"transition-colors\", getStatusColor())}>\n                {getStatusIcon()}\n              </div>\n              <div className=\"text-sm\">\n                <div className={cn(\"font-medium\", getStatusColor())}>\n                  {getStatusText()}\n                </div>\n                {!isExpanded && (\n                  <div className=\"text-xs text-gray-500\">\n                    {formatLastSyncTime()}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              {isOnline && !isSyncing && hasPendingChanges && (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleManualSync();\n                  }}\n                  className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-600 rounded\"\n                  title=\"ç«‹å³åŒæ­¥\"\n                >\n                  <RefreshCw className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                </button>\n              )}\n              {isExpanded ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronUp className=\"w-4 h-4\" />}\n            </div>\n          </div>\n\n          {isExpanded && (\n            <div className=\"border-t border-gray-200 dark:border-gray-700 p-3 space-y-3\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-600 dark:text-gray-400\">ç¶²è·¯é€£ç·š</span>\n                <div className=\"flex items-center gap-2\">\n                  {isOnline ? (\n                    <>\n                      <Wifi className=\"w-4 h-4 text-green-500\" />\n                      <span className=\"text-green-500\">å·²é€£ç·š</span>\n                    </>\n                  ) : (\n                    <>\n                      <WifiOff className=\"w-4 h-4 text-red-500\" />\n                      <span className=\"text-red-500\">é›¢ç·š</span>\n                    </>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-gray-600 dark:text-gray-400\">æœ€å¾ŒåŒæ­¥</span>\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"w-4 h-4 text-gray-400\" />\n                  <span className=\"text-gray-700 dark:text-gray-300\">\n                    {formatLastSyncTime()}\n                  </span>\n                </div>\n              </div>\n\n              {hasPendingChanges && (\n                <div className=\"bg-orange-50 dark:bg-orange-900/20 rounded p-2\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <AlertCircle className=\"w-4 h-4 text-orange-500\" />\n                    <span className=\"text-orange-700 dark:text-orange-400\">\n                      {pendingCount} å€‹è®Šæ›´å¾…åŒæ­¥\n                    </span>\n                  </div>\n                  <PendingChangesList />\n                </div>\n              )}\n\n              {isOnline && (\n                <button\n                  onClick={handleManualSync}\n                  disabled={isSyncing || !hasPendingChanges}\n                  className={cn(\n                    \"w-full py-2 px-3 rounded text-sm font-medium transition-colors\",\n                    isSyncing || !hasPendingChanges\n                      ? \"bg-gray-100 text-gray-400 cursor-not-allowed\"\n                      : \"bg-blue-500 text-white hover:bg-blue-600\"\n                  )}\n                >\n                  {isSyncing ? (\n                    <span className=\"flex items-center justify-center gap-2\">\n                      <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                      åŒæ­¥ä¸­...\n                    </span>\n                  ) : hasPendingChanges ? (\n                    'ç«‹å³åŒæ­¥'\n                  ) : (\n                    'å·²æ˜¯æœ€æ–°'\n                  )}\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {showNotification && (\n        <SyncNotification\n          isOnline={isOnline}\n          onClose={() => setShowNotification(false)}\n        />\n      )}\n    </>\n  );\n}\n\n/**\n * é¡¯ç¤ºå¾…åŒæ­¥é …ç›®åˆ—è¡¨\n */\nfunction PendingChangesList() {\n  const [pendingByTable, setPendingByTable] = useState<Record<string, number>>({});\n\n  useEffect(() => {\n    const loadPendingCounts = async () => {\n      const counts: Record<string, number> = {};\n\n      for (const tableName of Object.values(TABLES)) {\n        try {\n          const count = await backgroundSyncService.getPendingCount(tableName);\n          if (count > 0) {\n            counts[tableName] = count;\n          }\n        } catch (error) {\n          console.warn(`ç„¡æ³•å–å¾— ${tableName} çš„å¾…åŒæ­¥æ•¸é‡:`, error);\n        }\n      }\n\n      setPendingByTable(counts);\n    };\n\n    loadPendingCounts();\n  }, []);\n\n  if (Object.keys(pendingByTable).length === 0) return null;\n\n  return (\n    <div className=\"mt-2 space-y-1\">\n      {Object.entries(pendingByTable).map(([table, count]) => (\n        <div key={table} className=\"text-xs text-gray-600 dark:text-gray-400\">\n          <span className=\"capitalize\">{table}</span>: {count} ç­†å¾…åŒæ­¥\n        </div>\n      ))}\n    </div>\n  );\n}\n\nfunction SyncNotification({\n  isOnline,\n  onClose\n}: {\n  isOnline: boolean;\n  onClose: () => void;\n}) {\n  return (\n    <div className={cn(\n      \"fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg border animate-slide-in-right\",\n      isOnline\n        ? \"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800\"\n        : \"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800\"\n    )}>\n      <div className=\"flex items-center gap-3\">\n        {isOnline ? (\n          <>\n            <Wifi className=\"w-5 h-5 text-green-500\" />\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium text-green-800 dark:text-green-200\">\n                å·²æ¢å¾©é€£ç·š\n              </p>\n              <p className=\"text-xs text-green-600 dark:text-green-400\">\n                ç³»çµ±å°‡è‡ªå‹•åŒæ­¥æ‚¨çš„è³‡æ–™\n              </p>\n            </div>\n          </>\n        ) : (\n          <>\n            <WifiOff className=\"w-5 h-5 text-red-500\" />\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-medium text-red-800 dark:text-red-200\">\n                é›¢ç·šæ¨¡å¼\n              </p>\n              <p className=\"text-xs text-red-600 dark:text-red-400\">\n                æ‚¨çš„è®Šæ›´å°‡åœ¨æ¢å¾©é€£ç·šå¾ŒåŒæ­¥\n              </p>\n            </div>\n          </>\n        )}\n        <button\n          onClick={onClose}\n          className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\n        >\n          <X className=\"w-4 h-4 text-gray-500\" />\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport function ConflictResolutionDialog({\n  conflicts,\n  onResolve\n}: {\n  conflicts: any[];\n  onResolve: (conflictId: string, resolution: 'local' | 'remote') => void;\n}) {\n  if (conflicts.length === 0) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden\">\n        <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n          <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n            <AlertCircle className=\"w-5 h-5 text-yellow-500\" />\n            åŒæ­¥è¡çª\n          </h2>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n            åµæ¸¬åˆ° {conflicts.length} å€‹è¡çªï¼Œè«‹é¸æ“‡ä¿ç•™çš„ç‰ˆæœ¬\n          </p>\n        </div>\n\n        <div className=\"p-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n          {conflicts.map((conflict) => (\n            <div key={conflict.id} className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\">\n              <div className=\"mb-3\">\n                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                  {conflict.table} - {conflict.id}\n                </span>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-xs font-medium text-blue-600\">æœ¬åœ°ç‰ˆæœ¬</span>\n                    <button\n                      onClick={() => onResolve(conflict.id, 'local')}\n                      className=\"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600\"\n                    >\n                      ä½¿ç”¨æ­¤ç‰ˆæœ¬\n                    </button>\n                  </div>\n                  <pre className=\"text-xs bg-gray-50 dark:bg-gray-900 p-2 rounded overflow-auto max-h-48\">\n                    {JSON.stringify(conflict.localData, null, 2)}\n                  </pre>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-xs font-medium text-green-600\">é ç«¯ç‰ˆæœ¬</span>\n                    <button\n                      onClick={() => onResolve(conflict.id, 'remote')}\n                      className=\"px-3 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600\"\n                    >\n                      ä½¿ç”¨æ­¤ç‰ˆæœ¬\n                    </button>\n                  </div>\n                  <pre className=\"text-xs bg-gray-50 dark:bg-gray-900 p-2 rounded overflow-auto max-h-48\">\n                    {JSON.stringify(conflict.remoteData, null, 2)}\n                  </pre>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/component-library-toolbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[243,246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[243,246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { FileText, Image as ImageIcon, Users, Calendar, DollarSign, Plane, AlignLeft } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\n\ninterface ComponentLibraryToolbarProps {\n  onInsert: (componentData: any) => void;\n}\n\n// å®šç¾©å¿«é€Ÿçµ„ä»¶ï¼ˆç°¡åŒ–ç‰ˆï¼‰\nconst quickComponents = [\n  {\n    id: 'logo',\n    name: 'Logo',\n    icon: ImageIcon,\n    template: [['ã€Logo å€ã€‘', '', ''], ['', '', ''], ['', '', '']]\n  },\n  {\n    id: 'title',\n    name: 'æ¨™é¡Œ',\n    icon: FileText,\n    template: [['', 'åœ˜é«”æ—…éŠå ±åƒ¹å–®', '', '', '']]\n  },\n  {\n    id: 'customer-info',\n    name: 'å®¢æˆ¶è³‡è¨Š',\n    icon: Users,\n    template: [\n      ['å®¢æˆ¶åç¨±', '{customer_name}', '', 'å ±åƒ¹æ—¥æœŸ', '{quote_date}'],\n      ['è¯çµ¡äºº', '{contact_person}', '', 'æ‰¿è¾¦æ¥­å‹™', '{sales_person}'],\n      ['è¯çµ¡é›»è©±', '{phone}', '', 'é è¨ˆæ—¥æœŸ', '{departure_date}']\n    ]\n  },\n  {\n    id: 'itinerary',\n    name: 'è¡Œç¨‹è¡¨',\n    icon: Calendar,\n    template: [\n      ['å¤©æ•¸', 'è¡Œç¨‹å…§å®¹', 'æ—©é¤', 'åˆé¤', 'æ™šé¤', 'ä½å®¿'],\n      ['ç¬¬1å¤©', '', 'é£¯åº—', 'æ©Ÿä¸Š', 'ç•¶åœ°é¤å»³', ''],\n      ['ç¬¬2å¤©', '', 'é£¯åº—', 'ç•¶åœ°é¤å»³', 'ç•¶åœ°é¤å»³', '']\n    ]\n  },\n  {\n    id: 'price',\n    name: 'åƒ¹æ ¼è¡¨',\n    icon: DollarSign,\n    template: [\n      ['é …ç›®', '', '', 'å–®ä½é‡‘é¡'],\n      ['å¤§äººè²»ç”¨', '', '', '$'],\n      ['å°å­©ä¸ä½”åºŠ', '(æ»¿12æ­²ä»¥ä¸‹)', '', '$']\n    ]\n  },\n  {\n    id: 'flight',\n    name: 'èˆªç­è³‡è¨Š',\n    icon: Plane,\n    template: [\n      ['èˆªç©ºå…¬å¸', 'èˆªç­ä»£è™Ÿ', 'å‡ºç™¼æ©Ÿå ´', 'æŠµé”æ©Ÿå ´', 'èˆªè¡Œæ™‚é–“']\n    ]\n  },\n  {\n    id: 'notes',\n    name: 'å‚™è¨»',\n    icon: AlignLeft,\n    template: [\n      ['å‚™è¨»'],\n      ['1. '],\n      ['2. ']\n    ]\n  }\n];\n\nexport function ComponentLibraryToolbar({ onInsert }: ComponentLibraryToolbarProps) {\n  const handleInsert = (component: typeof quickComponents[0]) => {\n    // è¤‡è£½åˆ°å‰ªè²¼ç°¿\n    const templateText = component.template\n      .map(row => row.join('\\t'))\n      .join('\\n');\n\n    navigator.clipboard.writeText(templateText);\n\n    // é€šçŸ¥æ’å…¥\n    onInsert(component.template);\n\n    // æç¤ºç”¨æˆ¶\n    alert(`å·²è¤‡è£½ã€Œ${component.name}ã€æ¨¡æ¿ï¼\\nè«‹åœ¨å·¦å´ Excel ç·¨è¼¯å™¨ä¸­æŒ‰ Ctrl+V (Mac: Cmd+V) è²¼ä¸Šã€‚`);\n  };\n\n  return (\n    <div className=\"flex items-center gap-2 px-4 py-2 overflow-x-auto\">\n      <span className=\"text-sm font-medium text-morandi-secondary whitespace-nowrap mr-2\">\n        å¿«é€Ÿæ’å…¥ï¼š\n      </span>\n      {quickComponents.map((component) => {\n        const Icon = component.icon;\n        return (\n          <Button\n            key={component.id}\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => handleInsert(component)}\n            className=\"whitespace-nowrap\"\n          >\n            <Icon size={14} className=\"mr-1.5\" />\n            {component.name}\n          </Button>\n        );\n      })}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/component-library.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { FileText, Image as ImageIcon, Table, AlignLeft, Calendar, Users, DollarSign, Plane } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\n\nimport { cn } from '@/lib/utils';\n\ninterface Component {\n  id: string;\n  name: string;\n  icon: React.ElementType;\n  description: string;\n  template: string[][];  // Excel è³‡æ–™æ ¼å¼\n}\n\ninterface ComponentCategory {\n  name: string;\n  icon: React.ElementType;\n  components: Component[];\n}\n\n// å®šç¾©çµ„ä»¶åº«\nconst componentCategories: ComponentCategory[] = [\n  {\n    name: 'æ¨™é¡Œèˆ‡Logo',\n    icon: ImageIcon,\n    components: [\n      {\n        id: 'logo',\n        name: 'Logo å€å¡Š',\n        icon: ImageIcon,\n        description: 'å…¬å¸ Logo åœ–ç‰‡å€',\n        template: [\n          ['ã€Logo å€ã€‘', '', ''],\n          ['', '', ''],\n          ['', '', '']\n        ]\n      },\n      {\n        id: 'title',\n        name: 'ä¸»æ¨™é¡Œ',\n        icon: FileText,\n        description: 'å ±åƒ¹å–®æ¨™é¡Œ',\n        template: [\n          ['', 'åœ˜é«”æ—…éŠå ±åƒ¹å–®', '', '', '']\n        ]\n      }\n    ]\n  },\n  {\n    name: 'åŸºæœ¬è³‡è¨Š',\n    icon: AlignLeft,\n    components: [\n      {\n        id: 'customer-info',\n        name: 'å®¢æˆ¶è³‡è¨Šè¡¨',\n        icon: Users,\n        description: 'å®¢æˆ¶è¯çµ¡è³‡è¨Šè¡¨æ ¼',\n        template: [\n          ['å®¢æˆ¶åç¨±', '{customer_name}', '', 'å ±åƒ¹æ—¥æœŸ', '{quote_date}'],\n          ['è¯çµ¡äºº', '{contact_person}', '', 'æ‰¿è¾¦æ¥­å‹™', '{sales_person}'],\n          ['è¯çµ¡é›»è©±', '{phone}', '', 'é è¨ˆæ—¥æœŸ', '{departure_date}'],\n          ['åœ°å€', '{address}', '', '', '']\n        ]\n      },\n      {\n        id: 'tour-info',\n        name: 'æ—…éŠè³‡è¨Š',\n        icon: Plane,\n        description: 'è¡Œç¨‹åŸºæœ¬è³‡è¨Š',\n        template: [\n          ['æ—…éŠåç¨±', '{tour_name}'],\n          ['å‡ºç™¼æ—¥æœŸ', '{departure_date}'],\n          ['è¿”å›æ—¥æœŸ', '{return_date}'],\n          ['é è¨ˆäººæ•¸', '{participants}', 'äºº']\n        ]\n      }\n    ]\n  },\n  {\n    name: 'è¡Œç¨‹èˆ‡è²»ç”¨',\n    icon: Table,\n    components: [\n      {\n        id: 'itinerary-table',\n        name: 'è¡Œç¨‹è¡¨',\n        icon: Calendar,\n        description: 'æ¯æ—¥è¡Œç¨‹è©³ç´°è¡¨æ ¼',\n        template: [\n          ['å¤©æ•¸', 'è¡Œç¨‹å…§å®¹', 'æ—©é¤', 'åˆé¤', 'æ™šé¤', 'ä½å®¿'],\n          ['ç¬¬1å¤©', '', 'é£¯åº—', 'æ©Ÿä¸Š', 'ç•¶åœ°é¤å»³', ''],\n          ['ç¬¬2å¤©', '', 'é£¯åº—', 'ç•¶åœ°é¤å»³', 'ç•¶åœ°é¤å»³', ''],\n          ['ç¬¬3å¤©', '', 'é£¯åº—', 'ç•¶åœ°é¤å»³', 'ç•¶åœ°é¤å»³', '']\n        ]\n      },\n      {\n        id: 'price-table',\n        name: 'åƒ¹æ ¼è¡¨',\n        icon: DollarSign,\n        description: 'è²»ç”¨æ˜ç´°è¡¨',\n        template: [\n          ['é …ç›®', '', '', 'å–®ä½é‡‘é¡'],\n          ['å¤§äººè²»ç”¨', '', '', '$'],\n          ['å°å­©ä¸ä½”åºŠ', '(æ»¿12æ­²ä»¥ä¸‹)', '', '$'],\n          ['å¬°å…’', '', '', '$']\n        ]\n      },\n      {\n        id: 'flight-info',\n        name: 'èˆªç­è³‡è¨Š',\n        icon: Plane,\n        description: 'èˆªç­æ™‚åˆ»è¡¨',\n        template: [\n          ['èˆªç©ºå…¬å¸', 'èˆªç­ä»£è™Ÿ', 'å‡ºç™¼æ©Ÿå ´', 'æŠµé”æ©Ÿå ´', 'èˆªè¡Œæ™‚é–“'],\n          ['', '', '', '', '']\n        ]\n      }\n    ]\n  },\n  {\n    name: 'èªªæ˜èˆ‡å‚™è¨»',\n    icon: AlignLeft,\n    components: [\n      {\n        id: 'notes',\n        name: 'å‚™è¨»å€',\n        icon: FileText,\n        description: 'æ³¨æ„äº‹é …èˆ‡å‚™è¨»',\n        template: [\n          ['å‚™è¨»'],\n          ['1. '],\n          ['2. '],\n          ['3. ']\n        ]\n      },\n      {\n        id: 'inclusions',\n        name: 'è²»ç”¨åŒ…å«',\n        icon: DollarSign,\n        description: 'è²»ç”¨åŒ…å«é …ç›®',\n        template: [\n          ['è²»ç”¨åŒ…å«'],\n          ['â€¢ ä¾†å›æ©Ÿç¥¨ï¼ˆå«ç¨…é‡‘ï¼‰'],\n          ['â€¢ è¡Œç¨‹è¡¨æ‰€åˆ—ä¹‹ä½å®¿è²»ç”¨'],\n          ['â€¢ è¡Œç¨‹è¡¨æ‰€åˆ—ä¹‹é¤é£Ÿè²»ç”¨'],\n          ['â€¢ æ—…éŠæœŸé–“åƒåŠ æ´»å‹•è²»ç”¨']\n        ]\n      },\n      {\n        id: 'exclusions',\n        name: 'è²»ç”¨ä¸å«',\n        icon: DollarSign,\n        description: 'è²»ç”¨ä¸åŒ…å«é …ç›®',\n        template: [\n          ['è²»ç”¨ä¸å«'],\n          ['â€¢ æ–°è¾¦è­·ç…§è²»ç”¨'],\n          ['â€¢ å°éŠã€å¸æ©Ÿå°è²»'],\n          ['â€¢ å€‹äººæ¶ˆè²»'],\n          ['â€¢ æ—…éŠå¹³å®‰ä¿éšªï¼ˆå»ºè­°è‡ªè¡ŒæŠ•ä¿ï¼‰']\n        ]\n      }\n    ]\n  }\n];\n\ninterface ComponentLibraryProps {\n  onInsert: (componentData: string[][]) => void;\n}\n\nexport function ComponentLibrary({ onInsert }: ComponentLibraryProps) {\n  const handleComponentClick = (component: Component) => {\n    onInsert(component.template);\n\n    // åŒæ™‚è¤‡è£½åˆ°å‰ªè²¼ç°¿\n    const templateText = component.template\n      .map(row => row.join('\\t'))\n      .join('\\n');\n    navigator.clipboard.writeText(templateText);\n  };\n\n  // æ‰å¹³åŒ–æ‰€æœ‰çµ„ä»¶\n  const allComponents = componentCategories.flatMap(category => category.components);\n\n  return (\n    <div className=\"px-6 py-3\">\n      <div className=\"flex items-center gap-2 overflow-x-auto\">\n        <span className=\"text-sm font-medium text-morandi-secondary whitespace-nowrap mr-2\">\n          å¿«é€Ÿæ’å…¥ï¼š\n        </span>\n        {allComponents.map((component) => {\n          const Icon = component.icon;\n          return (\n            <Button\n              key={component.id}\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleComponentClick(component)}\n              className=\"whitespace-nowrap\"\n              title={component.description}\n            >\n              <Icon size={14} className=\"mr-1.5\" />\n              {component.name}\n            </Button>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/field-mapping-editor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1063,1066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1063,1066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateAllFields' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":58,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1773,1776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1773,1776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":65,"column":31,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":65,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\n\nimport { Plus, Trash2 } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n\nimport { getAvailableFields, getSourceLabel, validateField } from '@/lib/template-helpers';\n\nimport { TemplateField, DataSource } from '@/types/template';\n\ninterface FieldMappingEditorProps {\n  fields: TemplateField[];\n  onChange: (fields: TemplateField[]) => void;\n}\n\nexport function FieldMappingEditor({ fields, onChange }: FieldMappingEditorProps) {\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  const addField = () => {\n    const newField: TemplateField = {\n      id: crypto.randomUUID(),\n      field_key: '',\n      display_name: '',\n      field_type: 'text',\n      is_required: false,\n      data_source: 'manual',\n    };\n\n    onChange([...fields, newField]);\n  };\n\n  const updateField = (index: number, key: keyof TemplateField, value: any) => {\n    const newFields = [...fields];\n    newFields[index] = { ...newFields[index], [key]: value };\n\n    // å¦‚æœåˆ‡æ›è³‡æ–™ä¾†æºï¼Œæ¸…ç©º source_field\n    if (key === 'data_source') {\n      newFields[index].source_field = undefined;\n    }\n\n    onChange(newFields);\n\n    // æ¸…é™¤è©²æ¬„ä½çš„éŒ¯èª¤\n    const newErrors = { ...errors };\n    delete newErrors[newFields[index].id];\n    setErrors(newErrors);\n  };\n\n  const removeField = (index: number) => {\n    const newFields = fields.filter((_, i) => i !== index);\n    onChange(newFields);\n  };\n\n  const validateAllFields = () => {\n    const newErrors: Record<string, string> = {};\n    let hasError = false;\n\n    fields.forEach((field) => {\n      const validation = validateField(field as any);\n      if (!validation.valid) {\n        newErrors[field.id] = validation.error!;\n        hasError = true;\n      }\n    });\n\n    setErrors(newErrors);\n    return !hasError;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-bold text-morandi-primary\">æ¬„ä½é—œè¯è¨­å®š</h3>\n          <p className=\"text-sm text-morandi-secondary mt-1\">\n            å®šç¾©æ¨¡æ¿ä¸­éœ€è¦çš„è³‡æ–™æ¬„ä½åŠå…¶ä¾†æº\n          </p>\n        </div>\n        <Button size=\"sm\" onClick={addField}>\n          <Plus size={16} className=\"mr-2\" />\n          æ–°å¢æ¬„ä½\n        </Button>\n      </div>\n\n      {/* æ¬„ä½åˆ—è¡¨ */}\n      {fields.length === 0 ? (\n        <div className=\"bg-morandi-container/5 rounded-lg p-8 text-center\">\n          <p className=\"text-sm text-morandi-secondary mb-4\">\n            å°šæœªæ–°å¢ä»»ä½•æ¬„ä½\n          </p>\n          <Button size=\"sm\" onClick={addField} variant=\"outline\">\n            <Plus size={16} className=\"mr-2\" />\n            æ–°å¢ç¬¬ä¸€å€‹æ¬„ä½\n          </Button>\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {fields.map((field, index) => (\n            <div\n              key={field.id}\n              className=\"bg-card rounded-lg p-4 border border-morandi-container/20\"\n            >\n              <div className=\"grid grid-cols-12 gap-4 items-start\">\n                {/* 1. Excel ä¸­çš„è®Šæ•¸åç¨± */}\n                <div className=\"col-span-3\">\n                  <label className=\"text-xs text-morandi-secondary mb-1 block\">\n                    è®Šæ•¸åç¨±ï¼ˆExcelä¸­ï¼‰\n                    <span className=\"text-morandi-red ml-1\">*</span>\n                  </label>\n                  <Input\n                    value={field.field_key}\n                    onChange={(e) => updateField(index, 'field_key', e.target.value)}\n                    placeholder=\"ä¾‹å¦‚ï¼štour_name\"\n                    className=\"font-mono text-sm\"\n                  />\n                </div>\n\n                {/* 2. é¡¯ç¤ºåç¨± */}\n                <div className=\"col-span-3\">\n                  <label className=\"text-xs text-morandi-secondary mb-1 block\">\n                    é¡¯ç¤ºåç¨±\n                    <span className=\"text-morandi-red ml-1\">*</span>\n                  </label>\n                  <Input\n                    value={field.display_name}\n                    onChange={(e) => updateField(index, 'display_name', e.target.value)}\n                    placeholder=\"ä¾‹å¦‚ï¼šæ—…éŠåœ˜åç¨±\"\n                  />\n                </div>\n\n                {/* 3. è³‡æ–™ä¾†æºï¼ˆé—œè¯æ€§ï¼‰*/}\n                <div className=\"col-span-2\">\n                  <label className=\"text-xs text-morandi-secondary mb-1 block\">\n                    è³‡æ–™ä¾†æº\n                    <span className=\"text-morandi-red ml-1\">*</span>\n                  </label>\n                  <Select\n                    value={field.data_source}\n                    onValueChange={(v) => updateField(index, 'data_source', v as DataSource)}\n                  >\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"tour\">æ—…éŠåœ˜</SelectItem>\n                      <SelectItem value=\"order\">è¨‚å–®</SelectItem>\n                      <SelectItem value=\"customer\">å®¢æˆ¶</SelectItem>\n                      <SelectItem value=\"employee\">å“¡å·¥</SelectItem>\n                      <SelectItem value=\"manual\">æ‰‹å‹•è¼¸å…¥</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* 4. å°æ‡‰æ¬„ä½ */}\n                <div className=\"col-span-3\">\n                  <label className=\"text-xs text-morandi-secondary mb-1 block\">\n                    å°æ‡‰æ¬„ä½\n                    {field.data_source !== 'manual' && (\n                      <span className=\"text-morandi-red ml-1\">*</span>\n                    )}\n                  </label>\n                  <Select\n                    value={field.source_field || ''}\n                    onValueChange={(v) => updateField(index, 'source_field', v)}\n                    disabled={field.data_source === 'manual'}\n                  >\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"é¸æ“‡æ¬„ä½\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {getAvailableFields(field.data_source).map((f) => (\n                        <SelectItem key={f.key} value={f.key}>\n                          {f.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* 5. åˆªé™¤æŒ‰éˆ• */}\n                <div className=\"col-span-1 flex items-end\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => removeField(index)}\n                    className=\"text-morandi-red h-10 w-10 p-0\"\n                  >\n                    <Trash2 size={16} />\n                  </Button>\n                </div>\n              </div>\n\n              {/* éŒ¯èª¤è¨Šæ¯ */}\n              {errors[field.id] && (\n                <div className=\"mt-2 text-xs text-morandi-red\">\n                  {errors[field.id]}\n                </div>\n              )}\n\n              {/* é è¦½ */}\n              <div className=\"mt-3 p-2 bg-morandi-container/5 rounded text-xs\">\n                <span className=\"text-morandi-muted\">Excel ä¸­ï¼š</span>\n                <code className=\"ml-2 text-morandi-gold\">\n                  {field.field_key ? `{${field.field_key}}` : '{è®Šæ•¸åç¨±}'}\n                </code>\n                <span className=\"mx-2 text-morandi-muted\">â†’</span>\n                <span className=\"text-morandi-secondary\">\n                  {field.data_source !== 'manual'\n                    ? `è‡ªå‹•å¾ã€Œ${getSourceLabel(field.data_source)}ã€å–å¾—ã€Œ${\n                        field.source_field || '?'\n                      }ã€`\n                    : 'ä½¿ç”¨æ™‚æ‰‹å‹•è¼¸å…¥'}\n                </span>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/repeatable-section-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/repeatable-section-manager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/template-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileBarChart' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4727,4730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4727,4730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\n\nimport { MoreVertical, FileText, FileSpreadsheet, FileBarChart, File } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useTemplateStore } from '@/stores/template-store';\n\nimport { cn } from '@/lib/utils';\n\nimport { Template } from '@/types/template';\n\nimport { UseTemplateDialog } from './use-template-dialog';\n\ninterface TemplateCardProps {\n  template: Template;\n  onEdit: (template: Template) => void;\n}\n\n// æ¨¡æ¿é¡å‹æ¨™ç±¤\nfunction TemplateTypeBadge({ type }: { type: Template['type'] }) {\n  const configs = {\n    quote: { label: 'å ±åƒ¹å–®', icon: FileText, color: 'text-morandi-gold bg-morandi-gold/10' },\n    itinerary: { label: 'è¡Œç¨‹è¡¨', icon: FileSpreadsheet, color: 'text-morandi-green bg-morandi-green/10' },\n    invoice: { label: 'ç™¼ç¥¨', icon: FileText, color: 'text-morandi-blue bg-morandi-blue/10' },\n    receipt: { label: 'æ”¶æ“š', icon: FileText, color: 'text-morandi-purple bg-morandi-purple/10' },\n    other: { label: 'å…¶ä»–', icon: File, color: 'text-morandi-secondary bg-morandi-secondary/10' },\n  };\n\n  const config = configs[type];\n  const Icon = config.icon;\n\n  return (\n    <div className={cn('inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium', config.color)}>\n      <Icon size={14} />\n      {config.label}\n    </div>\n  );\n}\n\nexport function TemplateCard({ template, onEdit }: TemplateCardProps) {\n  const { deleteTemplate, duplicateTemplate } = useTemplateStore();\n  const [useDialogOpen, setUseDialogOpen] = useState(false);\n\n  const handleDelete = () => {\n    if (confirm(`ç¢ºå®šè¦åˆªé™¤æ¨¡æ¿ã€Œ${template.name}ã€å—ï¼Ÿ`)) {\n      deleteTemplate(template.id, 'current-user-id'); // TODO: ä½¿ç”¨å¯¦éš›çš„ç”¨æˆ¶ ID\n    }\n  };\n\n  const handleDuplicate = async () => {\n    const newName = prompt('è«‹è¼¸å…¥æ–°æ¨¡æ¿åç¨±', `${template.name} (å‰¯æœ¬)`);\n    if (newName) {\n      await duplicateTemplate(template.id, newName);\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });\n  };\n\n  return (\n    <>\n      <div className=\"bg-card rounded-xl p-6 border border-morandi-container/20 hover:border-morandi-gold/40 transition-all group\">\n        {/* æ¨¡æ¿é¡å‹æ¨™ç±¤ */}\n        <div className=\"flex items-start justify-between mb-4\">\n          <TemplateTypeBadge type={template.type} />\n\n          {/* æ›´å¤šé¸å–® */}\n          <DropdownMenu>\n            <DropdownMenuTrigger className=\"h-8 w-8 p-0 hover:bg-morandi-container rounded-md\">\n              <MoreVertical size={16} />\n            </DropdownMenuTrigger>\n            <DropdownMenuContent>\n              <DropdownMenuItem onClick={() => onEdit(template)}>ç·¨è¼¯æ¨¡æ¿</DropdownMenuItem>\n              <DropdownMenuItem onClick={handleDuplicate}>è¤‡è£½æ¨¡æ¿</DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={handleDelete} className=\"text-morandi-red\">\n                åˆªé™¤\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n\n        {/* æ¨¡æ¿è³‡è¨Š */}\n        <h3 className=\"text-lg font-bold text-morandi-primary mb-2 line-clamp-1\">{template.name}</h3>\n        <p className=\"text-sm text-morandi-secondary mb-4 line-clamp-2 min-h-[40px]\">\n          {template.description || 'ç„¡èªªæ˜'}\n        </p>\n\n        {/* é—œè¯æ¬„ä½æ‘˜è¦ */}\n        <div className=\"bg-morandi-container/5 rounded-lg p-3 mb-4\">\n          <div className=\"text-xs text-morandi-muted mb-2\">éœ€è¦çš„è³‡æ–™ï¼š</div>\n          <div className=\"flex flex-wrap gap-1\">\n            {template.field_mappings && template.field_mappings.length > 0 ? (\n              <>\n                {template.field_mappings.slice(0, 5).map((field) => (\n                  <span\n                    key={field.id}\n                    className=\"text-xs px-2 py-1 bg-morandi-gold/10 text-morandi-gold rounded\"\n                  >\n                    {field.display_name}\n                  </span>\n                ))}\n                {template.field_mappings.length > 5 && (\n                  <span className=\"text-xs text-morandi-muted px-2 py-1\">\n                    +{template.field_mappings.length - 5} æ›´å¤š\n                  </span>\n                )}\n              </>\n            ) : (\n              <span className=\"text-xs text-morandi-muted\">å°šæœªè¨­å®šæ¬„ä½</span>\n            )}\n          </div>\n        </div>\n\n        {/* çµ±è¨ˆè³‡è¨Š */}\n        <div className=\"flex items-center justify-between text-xs text-morandi-muted mb-4\">\n          <span>å·²ä½¿ç”¨ {template.usage_count || 0} æ¬¡</span>\n          <span>{formatDate((template.metadata as any).updated_at)}</span>\n        </div>\n\n        {/* å¿«é€Ÿå‹•ä½œ */}\n        <div className=\"flex gap-2 pt-4 border-t border-morandi-container/10\">\n          <Button size=\"sm\" variant=\"outline\" className=\"flex-1\" onClick={() => onEdit(template)}>\n            ç·¨è¼¯\n          </Button>\n          <Button\n            size=\"sm\"\n            className=\"flex-1 bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n            onClick={() => setUseDialogOpen(true)}\n          >\n            ä½¿ç”¨æ¨¡æ¿\n          </Button>\n        </div>\n      </div>\n\n      {/* ä½¿ç”¨æ¨¡æ¿å°è©±æ¡† */}\n      <UseTemplateDialog\n        template={template}\n        open={useDialogOpen}\n        onOpenChange={setUseDialogOpen}\n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/template-editor-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2965,2968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2965,2968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4791,4794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4791,4794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\n\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useTemplateStore } from '@/stores/template-store';\n\nimport { Template, TemplateType, TemplateField } from '@/types/template';\n\nimport { FieldMappingEditor } from './field-mapping-editor';\n\ninterface TemplateEditorDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  template: Template | null; // null = æ–°å¢æ¨¡å¼\n}\n\n// é è¨­ç¯„æœ¬\nconst TEMPLATE_PRESETS = {\n  blank: {\n    name: 'ç©ºç™½æ¨¡æ¿',\n    fields: [],\n    excel: Array.from({ length: 60 }, () => Array.from({ length: 12 }, () => ''))\n  },\n  confirmation: {\n    name: 'è¡Œç¨‹ç¢ºèªå–®',\n    fields: [\n      { id: '1', field_key: 'customer_name', display_name: 'å®¢æˆ¶åç¨±', field_type: 'text', data_source: 'manual', is_required: true },\n      { id: '2', field_key: 'contact_person', display_name: 'è¯çµ¡äºº', field_type: 'text', data_source: 'manual', is_required: true },\n      { id: '3', field_key: 'phone', display_name: 'è¯çµ¡é›»è©±', field_type: 'text', data_source: 'manual', is_required: true },\n      { id: '4', field_key: 'departure_date', display_name: 'å‡ºç™¼æ—¥æœŸ', field_type: 'date', data_source: 'manual', is_required: true },\n      { id: '5', field_key: 'destination', display_name: 'ç›®çš„åœ°', field_type: 'text', data_source: 'manual', is_required: true },\n    ],\n    excel: [\n      ['#æ¨™é¡Œ'],\n      ['', '', 'æ—…éŠè¡Œç¨‹ç¢ºèªå–®'],\n      [''],\n      ['#å®¢æˆ¶è³‡è¨Š'],\n      ['å®¢æˆ¶åç¨±ï¼š', '{customer_name}', '', 'è¯çµ¡äººï¼š', '{contact_person}'],\n      ['è¯çµ¡é›»è©±ï¼š', '{phone}', '', 'å‡ºç™¼æ—¥æœŸï¼š', '{departure_date}'],\n      ['ç›®çš„åœ°ï¼š', '{destination}'],\n      [''],\n      ['#è¡¨æ ¼'],\n      ['å¤©æ•¸', 'æ—¥æœŸ', 'è¡Œç¨‹å…§å®¹', 'é¤é£Ÿ', 'ä½å®¿'],\n      ['ç¬¬1å¤©', '{day1_date}', '{day1_itinerary}', '{day1_meals}', '{day1_hotel}'],\n      ['ç¬¬2å¤©', '{day2_date}', '{day2_itinerary}', '{day2_meals}', '{day2_hotel}'],\n      ['ç¬¬3å¤©', '{day3_date}', '{day3_itinerary}', '{day3_meals}', '{day3_hotel}'],\n      [''],\n      ['#å‚™è¨»'],\n      ['1. æœ¬ç¢ºèªå–®åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è¡Œç¨‹ä»¥å‡ºåœ˜é€šçŸ¥ç‚ºæº–'],\n      ['2. å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹éš¨æ™‚èˆ‡æˆ‘å€‘è¯ç¹«'],\n      [''],\n      ...Array.from({ length: 40 }, () => Array.from({ length: 12 }, () => ''))\n    ]\n  }\n};\n\nexport function TemplateEditorDialog({ open, onOpenChange, template }: TemplateEditorDialogProps) {\n  const { addTemplate, updateTemplate } = useTemplateStore();\n  const isEdit = !!template;\n\n  const [selectedPreset, setSelectedPreset] = useState<'blank' | 'confirmation'>('blank');\n  const [formData, setFormData] = useState({\n    name: '',\n    type: 'quote' as TemplateType,\n    description: '',\n  });\n\n  const [fields, setFields] = useState<TemplateField[]>([]);\n  const [excelData, setExcelData] = useState<any>(null);\n\n  // è¼‰å…¥ç·¨è¼¯çš„æ¨¡æ¿è³‡æ–™\n  useEffect(() => {\n    if (template) {\n      setFormData({\n        name: template.name,\n        type: template.type,\n        description: template.description || '',\n      });\n      setFields(template.field_mappings || []);\n      setExcelData(template.excel_structure);\n    } else {\n      // é‡ç½®è¡¨å–®\n      setFormData({ name: '', type: 'quote', description: '' });\n      setSelectedPreset('blank');\n      setFields([]);\n      setExcelData(null);\n    }\n  }, [template, open]);\n\n  // ç•¶é¸æ“‡ç¯„æœ¬æ™‚ï¼Œè¼‰å…¥ç¯„æœ¬è³‡æ–™\n  const handlePresetChange = (preset: 'blank' | 'confirmation') => {\n    setSelectedPreset(preset);\n    const presetData = TEMPLATE_PRESETS[preset];\n    setFields(presetData.fields as TemplateField[]);\n    setExcelData(presetData.excel);\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.name.trim()) {\n      alert('è«‹è¼¸å…¥æ¨¡æ¿åç¨±');\n      return;\n    }\n\n    try {\n      if (isEdit) {\n        // æ›´æ–°æ¨¡æ¿\n        await updateTemplate(template.id, {\n          name: formData.name,\n          type: formData.type,\n          description: formData.description,\n          field_mappings: fields,\n          excel_structure: excelData,\n        });\n      } else {\n        // æ–°å¢æ¨¡æ¿\n        await addTemplate({\n          name: formData.name,\n          type: formData.type,\n          description: formData.description,\n          paper_settings: {\n            size: 'A4',\n            orientation: 'portrait',\n            margins: { top: 2.0, bottom: 2.0, left: 2.0, right: 2.0 },\n            show_grid: true,\n            show_ruler: true,\n          },\n          cells: {},\n          dynamic_blocks: [],\n          field_mappings: fields,\n          excel_structure: excelData || { data: [['']], settings: {} },\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n        } as any);\n      }\n\n      onOpenChange(false);\n    } catch (error) {\n      console.error('å„²å­˜æ¨¡æ¿å¤±æ•—:', error);\n      alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>{isEdit ? 'ç·¨è¼¯æ¨¡æ¿' : 'æ–°å¢æ¨¡æ¿'}</DialogTitle>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"basic\" className=\"flex-1 flex flex-col overflow-hidden\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"basic\">åŸºæœ¬è³‡è¨Š</TabsTrigger>\n            <TabsTrigger value=\"fields\">æ¬„ä½è¨­å®š</TabsTrigger>\n            <TabsTrigger value=\"design\">æ¨¡æ¿è¨­è¨ˆ</TabsTrigger>\n          </TabsList>\n\n          <div className=\"flex-1 overflow-y-auto mt-4\">\n            {/* åŸºæœ¬è³‡è¨Š */}\n            <TabsContent value=\"basic\" className=\"space-y-4 mt-0\">\n              {/* ç¯„æœ¬é¸æ“‡ï¼ˆåƒ…æ–°å¢æ¨¡å¼ï¼‰ */}\n              {!isEdit && (\n                <div>\n                  <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                    é¸æ“‡ç¯„æœ¬\n                  </label>\n                  <Select value={selectedPreset} onValueChange={handlePresetChange}>\n                    <SelectTrigger>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"blank\">ğŸ“„ ç©ºç™½æ¨¡æ¿</SelectItem>\n                      <SelectItem value=\"confirmation\">âœˆï¸ è¡Œç¨‹ç¢ºèªå–®</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-xs text-morandi-muted mt-1\">\n                    é¸æ“‡ç¯„æœ¬å¾Œå¯ä»¥ç›´æ¥ç·¨è¼¯ï¼Œæˆ–å¾ç©ºç™½é–‹å§‹è‡ªè¡Œè¨­è¨ˆ\n                  </p>\n                </div>\n              )}\n\n              <div>\n                <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                  æ¨¡æ¿åç¨± <span className=\"text-morandi-red\">*</span>\n                </label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"ä¾‹å¦‚ï¼š2025 æ¸…é‚è¡Œç¨‹å ±åƒ¹å–®\"\n                />\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                  æ¨¡æ¿é¡å‹ <span className=\"text-morandi-red\">*</span>\n                </label>\n                <Select\n                  value={formData.type}\n                  onValueChange={(value) => setFormData({ ...formData, type: value as TemplateType })}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"quote\">å ±åƒ¹å–®</SelectItem>\n                    <SelectItem value=\"itinerary\">è¡Œç¨‹è¡¨</SelectItem>\n                    <SelectItem value=\"invoice\">ç™¼ç¥¨</SelectItem>\n                    <SelectItem value=\"receipt\">æ”¶æ“š</SelectItem>\n                    <SelectItem value=\"other\">å…¶ä»–</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                  èªªæ˜\n                </label>\n                <Textarea\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  placeholder=\"ç°¡å–®æè¿°é€™å€‹æ¨¡æ¿çš„ç”¨é€”...\"\n                  rows={3}\n                />\n              </div>\n            </TabsContent>\n\n            {/* æ¬„ä½è¨­å®š */}\n            <TabsContent value=\"fields\" className=\"mt-0\">\n              <FieldMappingEditor fields={fields} onChange={setFields} />\n            </TabsContent>\n\n            {/* æ¨¡æ¿è¨­è¨ˆ */}\n            <TabsContent value=\"design\" className=\"mt-0\">\n              <div className=\"bg-morandi-container/5 rounded-lg p-8 text-center\">\n                <div className=\"text-4xl mb-4\">ğŸ“Š</div>\n                <h3 className=\"text-lg font-bold text-morandi-primary mb-2\">Excel ç·¨è¼¯å™¨</h3>\n                <p className=\"text-sm text-morandi-secondary mb-4\">\n                  å³å°‡æ•´åˆ Handsontable ç·¨è¼¯å™¨\n                </p>\n                <p className=\"text-xs text-morandi-muted\">\n                  ç›®å‰å¯ä»¥å…ˆè¨­å®šåŸºæœ¬è³‡è¨Šå’Œæ¬„ä½ï¼Œç¨å¾Œå†è¨­è¨ˆ Excel æ¨£å¼\n                </p>\n              </div>\n            </TabsContent>\n          </div>\n        </Tabs>\n\n        {/* åº•éƒ¨æŒ‰éˆ• */}\n        <div className=\"flex justify-end gap-3 pt-4 border-t border-morandi-container/20\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n            å–æ¶ˆ\n          </Button>\n          <Button onClick={handleSubmit} className=\"bg-morandi-gold hover:bg-morandi-gold-hover\">\n            {isEdit ? 'å„²å­˜è®Šæ›´' : 'å»ºç«‹æ¨¡æ¿'}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/template-excel-editor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Handsontable' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[541,544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[541,544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'field_mappings' is defined but never used. Allowed unused args must match /^_/u.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[943,946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[943,946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1534,1537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1534,1537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1544,1547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1544,1547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1554,1557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1554,1557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1565,1568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1565,1568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1577,1580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1577,1580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isRowInRepeatableSection'. Either include it or remove the dependency array.","line":128,"column":6,"nodeType":"ArrayExpression","endLine":128,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [repeatable_sections, highlightedSection, isRowInRepeatableSection]","fix":{"range":[4265,4306],"text":"[repeatable_sections, highlightedSection, isRowInRepeatableSection]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6094,6097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6094,6097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6103,6106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6103,6106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6113,6116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6113,6116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6123,6126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6123,6126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6134,6137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6134,6137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6146,6149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6146,6149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cellProperties' is defined but never used. Allowed unused args must match /^_/u.","line":181,"column":101,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":115},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6167,6170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6167,6170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newSize' is defined but never used. Allowed unused args must match /^_/u.","line":206,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'column' is defined but never used. Allowed unused args must match /^_/u.","line":206,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newSize' is defined but never used. Allowed unused args must match /^_/u.","line":221,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":221,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'row' is defined but never used. Allowed unused args must match /^_/u.","line":221,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":221,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useRef, useEffect } from 'react';\n\nimport { HotTable } from '@handsontable/react';\nimport { registerLanguageDictionary, zhTW } from 'handsontable/i18n';\nimport { registerAllModules } from 'handsontable/registry';\nimport Handsontable from 'handsontable';\n\nimport 'handsontable/dist/handsontable.full.css';\nimport { TemplateField, RepeatableSection } from '@/types/template';\n\n// è¨»å†Šæ‰€æœ‰æ¨¡çµ„å’Œä¸­æ–‡èªè¨€åŒ…\nregisterAllModules();\nregisterLanguageDictionary(zhTW);\n\ninterface TemplateExcelEditorProps {\n  data: any;\n  onChange: (data: any) => void;\n  onColumnWidthChange?: (widths: number[]) => void;\n  field_mappings?: TemplateField[];\n  repeatable_sections?: RepeatableSection[];\n  highlightedSection?: RepeatableSection | null;\n}\n\nexport function TemplateExcelEditor({\n  data,\n  onChange,\n  onColumnWidthChange,\n  field_mappings,\n  repeatable_sections = [],\n  highlightedSection\n}: TemplateExcelEditorProps) {\n  const hotRef = useRef<any>(null);\n\n  // åˆå§‹åŒ–ç©ºç™½è³‡æ–™ï¼ˆ60 åˆ— Ã— 20 æ¬„ï¼Œçµ¦äºˆè¶³å¤ çš„æ¬„ä½è®“ä½¿ç”¨è€…èª¿æ•´ï¼‰\n  const initialData = (data && Array.isArray(data) && data.length > 0)\n    ? data\n    : Array.from({ length: 60 }, () => Array.from({ length: 20 }, () => ''));\n\n  // æª¢æŸ¥æŸä¸€åˆ—æ˜¯å¦åœ¨å¯é‡è¤‡å€å¡Šå…§\n  const isRowInRepeatableSection = (row: number) => {\n    return repeatable_sections.find(\n      section => row >= section.range.start_row && row <= section.range.end_row\n    );\n  };\n\n  // å„²å­˜æ ¼æ¨£å¼è‡ªå®šç¾© + A4 é‚Šæ¡†ç¹ªè£½\n  useEffect(() => {\n    const hot = hotRef.current?.hotInstance;\n    if (!hot) return;\n\n    // æ·»åŠ æ¨£å¼ï¼Œè®“è®Šæ•¸æ¬„ä½æœ‰ç‰¹æ®Šé¡è‰²\n    hot.addHook('afterRenderer', (TD: any, row: any, col: any, prop: any, value: any) => {\n      // è®Šæ•¸é«˜äº®\n      if (typeof value === 'string' && value.match(/\\{.+?\\}/)) {\n        TD.style.background = '#fff3cd';\n        TD.style.color = '#856404';\n        TD.style.fontWeight = 'bold';\n      }\n\n      // å¯é‡è¤‡å€å¡Šæ¨£å¼\n      const section = isRowInRepeatableSection(row);\n      if (section) {\n        // å¦‚æœæ˜¯é«˜äº®çš„å€å¡Šï¼Œä½¿ç”¨æ›´æ˜é¡¯çš„é¡è‰²\n        if (highlightedSection && section.id === highlightedSection.id) {\n          TD.style.backgroundColor = '#fef3c7'; // é‡‘è‰²èƒŒæ™¯\n          TD.style.borderLeft = col === 0 ? '3px solid #f59e0b' : TD.style.borderLeft;\n          TD.style.borderRight = '1px solid #f59e0b';\n          TD.style.borderTop = row === section.range.start_row ? '3px solid #f59e0b' : '1px solid #f59e0b';\n          TD.style.borderBottom = row === section.range.end_row ? '3px solid #f59e0b' : '1px solid #f59e0b';\n        } else {\n          // æ™®é€šå¯é‡è¤‡å€å¡Šæ¨£å¼\n          TD.style.backgroundColor = '#fefce8'; // æ·¡é»ƒè‰²èƒŒæ™¯\n          TD.style.borderLeft = col === 0 ? '2px solid #eab308' : TD.style.borderLeft;\n          TD.style.borderTop = row === section.range.start_row ? '2px solid #eab308' : TD.style.borderTop;\n          TD.style.borderBottom = row === section.range.end_row ? '2px solid #eab308' : TD.style.borderBottom;\n        }\n      }\n    });\n\n    // ç¹ªè£½ A4 åˆ—å°ç¯„åœèƒŒæ™¯ï¼ˆç™½è‰²èƒŒæ™¯ + ç´…è‰²é‚Šæ¡†ï¼‰\n    const drawA4Background = () => {\n      const container = hot.rootElement;\n      if (!container) return;\n\n      // ç§»é™¤èˆŠçš„èƒŒæ™¯\n      const oldBg = container.querySelector('.a4-print-area');\n      if (oldBg) oldBg.remove();\n\n      // æ‰¾åˆ°ç¬¬ä¸€å€‹å„²å­˜æ ¼ (A1) çš„ä½ç½®\n      const firstCell = hot.getCell(0, 0);\n      if (!firstCell) return;\n\n      const rect = firstCell.getBoundingClientRect();\n      const containerRect = container.getBoundingClientRect();\n\n      // è¨ˆç®—ç›¸å°æ–¼å®¹å™¨çš„åç§»\n      const offsetTop = rect.top - containerRect.top;\n      const offsetLeft = rect.left - containerRect.left;\n\n      // å‰µå»º A4 èƒŒæ™¯å€åŸŸ\n      const bg = document.createElement('div');\n      bg.className = 'a4-print-area';\n      bg.style.position = 'absolute';\n      bg.style.top = `${offsetTop}px`;\n      bg.style.left = `${offsetLeft}px`;\n      bg.style.width = '21cm';\n      bg.style.height = '29.7cm';\n      bg.style.backgroundColor = 'white';\n      bg.style.border = '3px solid #ef4444';\n      bg.style.pointerEvents = 'none';\n      bg.style.zIndex = '-1'; // æ”¾åœ¨è¡¨æ ¼å¾Œé¢\n      bg.style.boxSizing = 'border-box';\n\n      container.style.position = 'relative';\n      container.appendChild(bg);\n    };\n\n    // åˆå§‹ç¹ªè£½å’Œçª—å£å¤§å°æ”¹è®Šæ™‚é‡æ–°ç¹ªè£½\n    drawA4Background();\n    hot.addHook('afterRender', drawA4Background);\n    window.addEventListener('resize', drawA4Background);\n\n    return () => {\n      window.removeEventListener('resize', drawA4Background);\n    };\n  }, [repeatable_sections, highlightedSection]);\n\n  return (\n    <div className=\"h-full flex flex-col bg-background\">\n      {/* ä¸»æ¨™é¡Œå¡ç‰‡ */}\n      <div className=\"mb-4\">\n        <div className=\"bg-card rounded-lg border border-morandi-container/20 px-6 py-4\">\n          <div>\n            <h2 className=\"text-base font-bold text-morandi-primary\">Excel ç·¨è¼¯å™¨</h2>\n            <p className=\"text-xs text-morandi-secondary mt-1\">60 åˆ— Ã— 12 æ¬„ Â· å¯èª¿æ•´æ¬„å¯¬èˆ‡åˆ—é«˜</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Handsontable ç·¨è¼¯å™¨ - å…¨é æ¨¡å¼ï¼ˆç°è‰²å€åŸŸ = å·¥ä½œå€ï¼Œç´…æ¡† = A4 åˆ—å°ç¯„åœï¼‰ */}\n      <div className=\"flex-1 overflow-auto bg-gray-800 rounded-lg border border-morandi-container/20 p-8\">\n        <div className=\"flex items-start justify-center\">\n          <div className=\"inline-block\">\n            <HotTable\n            ref={hotRef}\n            data={initialData}\n            colHeaders={true}\n            rowHeaders={true}\n            width=\"auto\"\n            height=\"29.7cm\"\n            minRows={60}\n            minCols={20}\n            licenseKey=\"non-commercial-and-evaluation\"\n            language=\"zh-TW\"\n            stretchH=\"none\"\n\n          // åŠŸèƒ½è¨­å®š\n          contextMenu={true}           // å³éµé¸å–®\n          manualRowMove={true}         // æ‹–å‹•èª¿æ•´åˆ—é †åº\n          manualColumnMove={true}      // æ‹–å‹•èª¿æ•´æ¬„é †åº\n          manualRowResize={true}       // èª¿æ•´åˆ—é«˜\n          manualColumnResize={true}    // èª¿æ•´æ¬„å¯¬\n\n          // ç·¨è¼¯åŠŸèƒ½\n          copyPaste={true}             // è¤‡è£½è²¼ä¸Š\n          undo={true}                  // å¾©åŸ/é‡åš\n          search={true}                // æœå°‹\n\n          // åˆä½µå„²å­˜æ ¼\n          mergeCells={true}\n\n          // å„²å­˜æ ¼æ¨£å¼\n          cell={[\n            // ç¬¬ä¸€åˆ—ä½œç‚ºæ¨™é¡Œåˆ—ï¼ŒåŠ ç²—ç½®ä¸­\n            ...Array(12).fill(null).map((_, col) => ({\n              row: 0,\n              col,\n              className: 'htCenter htMiddle',\n              renderer: function(instance: any, td: any, row: any, col: any, prop: any, value: any, cellProperties: any) {\n                td.style.fontWeight = 'bold';\n                td.style.textAlign = 'center';\n                td.style.backgroundColor = '#f8f9fa';\n                td.innerHTML = value || '';\n                return td;\n              }\n            }))\n          ]}\n\n          // æ¬„ä½è¨­å®šï¼ˆé è¨­å¯¬åº¦ï¼‰\n          colWidths={[80, 100, 150, 120, 100, 100, 100, 100, 100, 100, 100, 100]}\n\n          // è®Šæ›´è™•ç†\n          afterChange={(changes) => {\n            if (changes) {\n              const hot = hotRef.current?.hotInstance;\n              if (hot) {\n                const currentData = hot.getData();\n                onChange(currentData);\n              }\n            }\n          }}\n\n          // æ¬„å¯¬èª¿æ•´è™•ç†\n          afterColumnResize={(newSize, column) => {\n            const hot = hotRef.current?.hotInstance;\n            if (hot && onColumnWidthChange) {\n              // ç²å–æ‰€æœ‰æ¬„ä½çš„å¯¬åº¦\n              const widths: number[] = [];\n              for (let i = 0; i < 12; i++) {\n                const width = hot.getColWidth(i);\n                widths.push(width || 100);\n              }\n              onColumnWidthChange(widths);\n              hot.render();\n            }\n          }}\n\n          // åˆ—é«˜èª¿æ•´è™•ç†\n          afterRowResize={(newSize, row) => {\n            const hot = hotRef.current?.hotInstance;\n            if (hot) {\n              hot.render();\n            }\n          }}\n\n          // æ ¼å¼åŒ–è¨­å®š\n          className=\"template-excel-editor\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* è‡ªå®šç¾©æ¨£å¼ */}\n      <style jsx global>{`\n        .template-excel-editor .handsontable td {\n          border-color: #e0e0e0;\n        }\n\n        .template-excel-editor .handsontable th {\n          background-color: #f8f9fa;\n          color: #495057;\n          font-weight: 500;\n        }\n\n        .template-excel-editor .htCore {\n          font-family: 'Arial', 'Microsoft JhengHei', sans-serif;\n        }\n      `}</style>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/template-pdf-preview.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[129,132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[129,132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fieldMappings' is defined but never used. Allowed unused args must match /^_/u.","line":16,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'repeatableSections' is assigned a value but never used. Allowed unused args must match /^_/u.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'highlightedSection' is defined but never used. Allowed unused args must match /^_/u.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1354,1357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1354,1357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2031,2034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2031,2034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2798,2801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2798,2801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4925,4928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4925,4928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4983,4986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4983,4986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5450,5453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5450,5453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { TemplateField, RepeatableSection } from '@/types/template';\n\ninterface TemplatePDFPreviewProps {\n  data: any;\n  columnWidths?: number[];\n  fieldMappings?: TemplateField[];\n  repeatableSections?: RepeatableSection[];\n  highlightedSection?: RepeatableSection | null;\n}\n\nexport function TemplatePDFPreview({\n  data,\n  columnWidths = [80, 100, 150, 120, 100, 100, 100, 100, 100, 100, 100, 100],\n  fieldMappings,\n  repeatableSections = [],\n  highlightedSection\n}: TemplatePDFPreviewProps) {\n  // å¦‚æœæ²’æœ‰è³‡æ–™ï¼Œé¡¯ç¤ºç©ºç™½ A4\n  if (!data || !Array.isArray(data) || data.length === 0) {\n    return (\n      <div className=\"h-full flex flex-col bg-background\">\n        <div className=\"mb-4\">\n          <div className=\"bg-card rounded-lg border border-morandi-container/20 px-6 py-4\">\n            <div>\n              <h2 className=\"text-base font-bold text-morandi-primary\">å³æ™‚é è¦½</h2>\n              <p className=\"text-xs text-morandi-secondary mt-1\">A4 å°ºå¯¸ (21cm Ã— 29.7cm) Â· 3mm å‡ºè¡€</p>\n            </div>\n          </div>\n        </div>\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center text-morandi-secondary\">\n            <div className=\"text-4xl mb-4\">ğŸ“„</div>\n            <p>é–‹å§‹åœ¨å·¦å´ç·¨è¼¯ï¼Œé€™è£¡æœƒå³æ™‚é è¦½</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // åµæ¸¬å€å¡Šé¡å‹æ¨™è¨˜\n  const detectBlockType = (row: any[]) => {\n    const firstCell = String(row[0] || '').trim();\n\n    if (firstCell.startsWith('#æ¨™é¡Œ')) return 'title';\n    if (firstCell.startsWith('#å®¢æˆ¶è³‡è¨Š') || firstCell.startsWith('#å®¢æˆ¶')) return 'customer-info';\n    if (firstCell.startsWith('#è¡¨æ ¼') || firstCell.startsWith('#åƒ¹æ ¼è¡¨')) return 'table';\n    if (firstCell.startsWith('#å‚™è¨»') || firstCell.startsWith('#èªªæ˜')) return 'notes';\n    if (firstCell.startsWith('#ç¸½è¨ˆ') || firstCell.startsWith('#åˆè¨ˆ')) return 'total';\n    if (firstCell.startsWith('#è¡Œç¨‹')) return 'itinerary';\n    if (firstCell.startsWith('#Logo') || firstCell.startsWith('#logo')) return 'logo';\n\n    return null;\n  };\n\n  // æ™ºèƒ½åˆ¤æ–·å„²å­˜æ ¼é¡å‹\n  const getCellStyle = (cell: any, rowIndex: number, colIndex: number, blockType: string | null) => {\n    const cellStr = String(cell || '');\n\n    // æ¨™ç±¤åˆ¤æ–·ï¼ˆå†’è™Ÿå‰çš„å…§å®¹ï¼‰\n    const isLabel = cellStr.includes('ï¼š') || cellStr.includes(':');\n\n    // åƒ¹æ ¼åˆ¤æ–·\n    const isPrice = cellStr.includes('$') || cellStr.includes('NT') ||\n      /^\\d+,?\\d*$/.test(cellStr.trim());\n\n    // å‹•æ…‹è®Šæ•¸\n    const isDynamic = typeof cell === 'string' && cell.match(/\\{.+?\\}/);\n\n    // æ˜¯å¦ç‚ºè¡¨é ­ï¼ˆè¡¨æ ¼å€å¡Šçš„ç¬¬ä¸€åˆ—ï¼‰\n    const isTableHeader = blockType === 'table';\n\n    return { isLabel, isPrice, isDynamic, isTableHeader };\n  };\n\n  // å°‡ Excel è³‡æ–™è½‰æ›æˆç¾åŒ–çš„è«è˜­è¿ªé¢¨æ ¼é è¦½\n  const renderContent = () => {\n    let currentBlockType: string | null = null;\n    let isFirstRowOfBlock = false;\n\n    return (\n      <div className=\"space-y-4\">\n        {data.map((row: any[], rowIndex: number) => {\n          // æª¢æŸ¥é€™ä¸€åˆ—æ˜¯å¦å…¨éƒ¨ç‚ºç©º\n          const isEmpty = row.every(cell => !cell || cell === '');\n          if (isEmpty) return null;\n\n          // æª¢æ¸¬æ˜¯å¦ç‚ºæ–°å€å¡Šæ¨™è¨˜\n          const detectedBlockType = detectBlockType(row);\n          if (detectedBlockType) {\n            currentBlockType = detectedBlockType;\n            isFirstRowOfBlock = true;\n            return null; // ä¸é¡¯ç¤ºæ¨™è¨˜åˆ—ï¼Œåªè¨˜éŒ„å€å¡Šé¡å‹\n          }\n\n          // å€å¡Šæ¨£å¼é…ç½®\n          const blockStyles = {\n            title: {\n              container: 'bg-gradient-to-r from-morandi-primary to-morandi-primary/80 text-white py-6 px-8 rounded-lg shadow-md mb-6',\n              text: 'text-center text-2xl font-bold tracking-wide',\n            },\n            'customer-info': {\n              container: 'bg-morandi-container/20 rounded-lg p-6 border-l-4 border-morandi-gold',\n              text: 'text-sm',\n            },\n            table: {\n              container: isFirstRowOfBlock\n                ? 'bg-morandi-primary/90 text-white font-semibold rounded-t-lg'\n                : 'bg-white border-b border-morandi-container/20 hover:bg-morandi-container/10 transition-colors',\n              text: 'text-sm',\n            },\n            notes: {\n              container: 'bg-morandi-container/10 rounded-lg p-4 border border-morandi-container/30',\n              text: 'text-xs text-morandi-secondary leading-relaxed',\n            },\n            total: {\n              container: 'bg-morandi-gold/20 rounded-lg p-4 border-2 border-morandi-gold',\n              text: 'text-base font-bold text-morandi-gold',\n            },\n            logo: {\n              container: 'flex items-center justify-center py-8 border-2 border-dashed border-morandi-container/30 rounded-lg bg-morandi-container/5',\n              text: 'text-morandi-muted',\n            },\n          };\n\n          const currentStyle = currentBlockType && blockStyles[currentBlockType as keyof typeof blockStyles];\n\n          const content = (\n            <div key={rowIndex} className=\"relative\">\n              {/* å…§å®¹åˆ— - æ ¹æ“šå€å¡Šé¡å‹ç¾åŒ– */}\n              <div className={`flex items-center ${(currentStyle as any)?.container || ''}`}>\n                {row.map((cell: any, colIndex: number) => {\n                  // è·³éç©ºç™½å„²å­˜æ ¼ï¼ˆä¸æ¸²æŸ“ï¼‰\n                  if (!cell || cell === '') return null;\n\n                  const { isLabel, isPrice, isDynamic } = getCellStyle(cell, rowIndex, colIndex, currentBlockType);\n                  const width = columnWidths[colIndex] || 100;\n\n                  return (\n                    <div\n                      key={colIndex}\n                      className={`px-3 py-2 transition-all ${(currentStyle as any)?.text || ''}\n                        ${isLabel ? 'text-morandi-secondary font-medium' : ''}\n                        ${isPrice ? 'text-morandi-gold font-semibold' : ''}\n                        ${isDynamic ? 'bg-morandi-gold/10 text-morandi-gold font-medium rounded-md px-3 border border-morandi-gold/30' : ''}\n                        ${currentBlockType === 'title' ? 'w-full' : ''}\n                      `}\n                      style={{\n                        width: currentBlockType === 'title' ? '100%' : `${width}px`,\n                        minWidth: currentBlockType === 'title' ? '100%' : `${width}px`,\n                        maxWidth: currentBlockType === 'title' ? '100%' : `${width}px`,\n                        lineHeight: '1.8',\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: currentBlockType === 'notes' ? 'normal' : 'nowrap',\n                      }}\n                    >\n                      {cell}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          );\n\n          isFirstRowOfBlock = false;\n          return content;\n        })}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-background\">\n      {/* ä¸»æ¨™é¡Œå¡ç‰‡ */}\n      <div className=\"mb-4\">\n        <div className=\"bg-card rounded-lg border border-morandi-container/20 px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-base font-bold text-morandi-primary\">å³æ™‚é è¦½</h2>\n              <p className=\"text-xs text-morandi-secondary mt-1\">A4 å°ºå¯¸ (21cm Ã— 29.7cm) Â· 3mm å‡ºè¡€</p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* é è¦½å…§å®¹å€ */}\n      <div className=\"flex-1 overflow-auto bg-gray-800 rounded-lg border border-morandi-container/20 p-8\">\n        <div className=\"flex items-start justify-center\">\n          {/* å‡ºè¡€å€åŸŸï¼ˆå¤–æ¡†ï¼‰ */}\n          <div\n            className=\"relative bg-gray-100 shadow-2xl\"\n            style={{\n              width: 'calc(21cm + 6mm)',  // A4 + å·¦å³å„ 3mm\n              minHeight: 'calc(29.7cm + 6mm)',  // A4 + ä¸Šä¸‹å„ 3mm\n              padding: '3mm'\n            }}\n          >\n        {/* å‡ºè¡€æç¤ºç·š */}\n        <div className=\"absolute inset-[3mm] border-2 border-dashed border-red-400 pointer-events-none z-10\">\n          <div className=\"absolute -top-5 left-0 text-xs text-red-500 font-medium\">å®‰å…¨ç·š</div>\n        </div>\n        <div className=\"absolute top-0 left-0 right-0 bottom-0 border-2 border-dashed border-blue-400 pointer-events-none z-10\">\n          <div className=\"absolute -top-5 right-0 text-xs text-blue-500 font-medium\">å‡ºè¡€ç·š</div>\n        </div>\n\n        {/* A4 å¯¦éš›å…§å®¹å€ */}\n        <div\n          className=\"bg-white relative\"\n          style={{\n            width: '21cm',\n            minHeight: '29.7cm',\n            padding: '0',\n            fontSize: '12px',\n            lineHeight: '1.5'\n          }}\n        >\n          {renderContent()}\n        </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/templates/use-template-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemberStore' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1212,1215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1212,1215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1285,1288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1285,1288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1702,1705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1702,1705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\n\nimport { ChevronLeft, ChevronRight, Download } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useTourStore, useOrderStore, useMemberStore } from '@/stores';\n// TODO: usePaymentStore deprecated\nimport { useTemplateStore } from '@/stores/template-store';\nimport type { Tour, Order } from '@/stores/types';\n\nimport { Template } from '@/types/template';\n\n\ninterface UseTemplateDialogProps {\n  template: Template;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\ntype Step = 'select-data' | 'fill-manual' | 'preview';\n\nexport function UseTemplateDialog({ template, open, onOpenChange }: UseTemplateDialogProps) {\n  const { items: tours } = useTourStore();\n  const { items: orders } = useOrderStore();\n  const { addDocument } = useTemplateStore();\n\n  const [step, setStep] = useState<Step>('select-data');\n  const [selectedData, setSelectedData] = useState<Record<string, any>>({});\n  const [manualData, setManualData] = useState<Record<string, any>>({});\n\n  // éœ€è¦å¾è³‡æ–™ä¾†æºé¸æ“‡çš„æ¬„ä½\n  const autoFields = useMemo(\n    () => template.field_mappings?.filter((f) => f.data_source !== 'manual') || [],\n    [template]\n  );\n\n  // éœ€è¦æ‰‹å‹•è¼¸å…¥çš„æ¬„ä½\n  const manualFields = useMemo(\n    () => template.field_mappings?.filter((f) => f.data_source === 'manual') || [],\n    [template]\n  );\n\n  // é¸æ“‡è³‡æ–™ä¾†æºé …ç›®æ™‚ï¼Œè‡ªå‹•å¡«å……ç›¸é—œæ¬„ä½\n  const handleSelectSource = (source: string, sourceId: string, sourceData: any) => {\n    const newData = { ...selectedData };\n\n    // æ‰¾å‡ºä½¿ç”¨é€™å€‹è³‡æ–™ä¾†æºçš„æ‰€æœ‰æ¬„ä½\n    const fieldsFromSource = autoFields.filter((f) => f.data_source === source);\n\n    fieldsFromSource.forEach((field) => {\n      if (field.source_field) {\n        newData[field.field_key] = sourceData[field.source_field];\n      }\n    });\n\n    setSelectedData(newData);\n  };\n\n  const handleGeneratePDF = async () => {\n    try {\n      // åˆä½µæ‰€æœ‰è³‡æ–™\n      const allData = { ...selectedData, ...manualData };\n\n      // å„²å­˜ç”Ÿæˆè¨˜éŒ„\n      await addDocument({\n        template_id: template.id,\n        template_name: template.name,\n        data_used: allData,\n        file_type: 'pdf',\n        created_by: 'current-user-id', // TODO: ä½¿ç”¨å¯¦éš›çš„ç”¨æˆ¶ ID\n      });\n\n      // TODO: å¯¦éš›çš„ PDF ç”Ÿæˆé‚è¼¯\n      alert('PDF ç”ŸæˆåŠŸèƒ½å³å°‡æ•´åˆ');\n\n      onOpenChange(false);\n    } catch (error) {\n      console.error('ç”Ÿæˆæ–‡ä»¶å¤±æ•—:', error);\n      alert('ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  const canGoNext = () => {\n    if (step === 'select-data') {\n      // æª¢æŸ¥æ‰€æœ‰å¿…å¡«çš„è‡ªå‹•æ¬„ä½æ˜¯å¦éƒ½å·²å¡«å¯«\n      return autoFields.every((field) => {\n        if (!field.is_required) return true;\n        return selectedData[field.field_key] !== undefined;\n      });\n    }\n    if (step === 'fill-manual') {\n      // æª¢æŸ¥æ‰€æœ‰å¿…å¡«çš„æ‰‹å‹•æ¬„ä½æ˜¯å¦éƒ½å·²å¡«å¯«\n      return manualFields.every((field) => {\n        if (!field.is_required) return true;\n        return manualData[field.field_key]?.toString().trim();\n      });\n    }\n    return true;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>ä½¿ç”¨æ¨¡æ¿ï¼š{template.name}</DialogTitle>\n        </DialogHeader>\n\n        {/* æ­¥é©ŸæŒ‡ç¤ºå™¨ */}\n        <div className=\"flex items-center justify-center gap-2 py-4\">\n          <div className={`px-4 py-2 rounded-full text-sm ${step === 'select-data' ? 'bg-morandi-gold text-white' : 'bg-morandi-container/20 text-morandi-muted'}`}>\n            1. é¸æ“‡è³‡æ–™\n          </div>\n          <ChevronRight size={16} className=\"text-morandi-muted\" />\n          <div className={`px-4 py-2 rounded-full text-sm ${step === 'fill-manual' ? 'bg-morandi-gold text-white' : 'bg-morandi-container/20 text-morandi-muted'}`}>\n            2. å¡«å¯«è³‡æ–™\n          </div>\n          <ChevronRight size={16} className=\"text-morandi-muted\" />\n          <div className={`px-4 py-2 rounded-full text-sm ${step === 'preview' ? 'bg-morandi-gold text-white' : 'bg-morandi-container/20 text-morandi-muted'}`}>\n            3. é è¦½ä¸‹è¼‰\n          </div>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto\">\n          {/* æ­¥é©Ÿ 1: é¸æ“‡è³‡æ–™ä¾†æº */}\n          {step === 'select-data' && (\n            <div className=\"space-y-4\">\n              {autoFields.length === 0 ? (\n                <div className=\"bg-morandi-container/5 rounded-lg p-8 text-center\">\n                  <p className=\"text-sm text-morandi-secondary\">\n                    æ­¤æ¨¡æ¿ä¸éœ€è¦é¸æ“‡è³‡æ–™ä¾†æº\n                  </p>\n                </div>\n              ) : (\n                <>\n                  <p className=\"text-sm text-morandi-secondary\">\n                    é€™å€‹æ¨¡æ¿éœ€è¦ä»¥ä¸‹è³‡æ–™ï¼Œè«‹é¸æ“‡ï¼š\n                  </p>\n\n                  {/* æ—…éŠåœ˜é¸æ“‡ */}\n                  {autoFields.some((f) => f.data_source === 'tour') && (\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                        é¸æ“‡æ—…éŠåœ˜\n                        {autoFields.some((f) => f.data_source === 'tour' && f.is_required) && (\n                          <span className=\"text-morandi-red ml-1\">*</span>\n                        )}\n                      </label>\n                      <Select\n                        onValueChange={(tour_id) => {\n                          const tour = tours.find((t: Tour) => t.id === tour_id);\n                          if (tour) handleSelectSource('tour', tour_id, tour);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"è«‹é¸æ“‡æ—…éŠåœ˜\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {tours.map((tour: Tour) => (\n                            <SelectItem key={tour.id} value={tour.id}>\n                              {tour.code} - {tour.name} ({tour.departure_date})\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n\n                  {/* è¨‚å–®é¸æ“‡ */}\n                  {autoFields.some((f) => f.data_source === 'order') && (\n                    <div>\n                      <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                        é¸æ“‡è¨‚å–®\n                        {autoFields.some((f) => f.data_source === 'order' && f.is_required) && (\n                          <span className=\"text-morandi-red ml-1\">*</span>\n                        )}\n                      </label>\n                      <Select\n                        onValueChange={(order_id) => {\n                          const order = orders.find((o: Order) => o.id === order_id);\n                          if (order) handleSelectSource('order', order_id, order);\n                        }}\n                      >\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"è«‹é¸æ“‡è¨‚å–®\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {orders.map((order: Order) => (\n                            <SelectItem key={order.id} value={order.id}>\n                              {order.order_number} - {order.contact_person}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n          )}\n\n          {/* æ­¥é©Ÿ 2: å¡«å¯«æ‰‹å‹•è³‡æ–™ */}\n          {step === 'fill-manual' && (\n            <div className=\"space-y-4\">\n              {manualFields.length === 0 ? (\n                <div className=\"bg-morandi-container/5 rounded-lg p-8 text-center\">\n                  <p className=\"text-sm text-morandi-secondary\">\n                    æ­¤æ¨¡æ¿ä¸éœ€è¦æ‰‹å‹•è¼¸å…¥è³‡æ–™\n                  </p>\n                </div>\n              ) : (\n                <>\n                  <p className=\"text-sm text-morandi-secondary\">\n                    è«‹å¡«å¯«ä»¥ä¸‹è³‡æ–™ï¼š\n                  </p>\n\n                  {manualFields.map((field) => (\n                    <div key={field.id}>\n                      <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                        {field.display_name}\n                        {field.is_required && <span className=\"text-morandi-red ml-1\">*</span>}\n                      </label>\n                      <Input\n                        type={field.field_type === 'number' ? 'number' : field.field_type === 'date' ? 'date' : 'text'}\n                        value={manualData[field.field_key] || field.default_value || ''}\n                        onChange={(e) =>\n                          setManualData((prev) => ({\n                            ...prev,\n                            [field.field_key]: e.target.value,\n                          }))\n                        }\n                        placeholder={field.default_value}\n                      />\n                      {field.description && (\n                        <p className=\"text-xs text-morandi-muted mt-1\">{field.description}</p>\n                      )}\n                    </div>\n                  ))}\n                </>\n              )}\n            </div>\n          )}\n\n          {/* æ­¥é©Ÿ 3: é è¦½ */}\n          {step === 'preview' && (\n            <div className=\"space-y-4\">\n              <div className=\"bg-morandi-container/5 rounded-lg p-8\">\n                <div className=\"text-center mb-6\">\n                  <div className=\"text-4xl mb-4\">ğŸ“„</div>\n                  <h3 className=\"text-lg font-bold text-morandi-primary mb-2\">æ–‡ä»¶é è¦½</h3>\n                  <p className=\"text-sm text-morandi-secondary\">\n                    å³å°‡æ•´åˆ PDF é è¦½åŠŸèƒ½\n                  </p>\n                </div>\n\n                {/* é¡¯ç¤ºå°‡è¦ä½¿ç”¨çš„è³‡æ–™ */}\n                <div className=\"bg-card rounded-lg p-4 border border-morandi-container/20\">\n                  <h4 className=\"text-sm font-bold text-morandi-primary mb-3\">ä½¿ç”¨çš„è³‡æ–™ï¼š</h4>\n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    {Object.entries({ ...selectedData, ...manualData }).map(([key, value]) => {\n                      const field = template.field_mappings?.find((f) => f.field_key === key);\n                      return (\n                        <div key={key} className=\"flex items-start gap-2\">\n                          <span className=\"text-morandi-muted min-w-[120px]\">\n                            {field?.display_name || key}:\n                          </span>\n                          <span className=\"text-morandi-primary font-medium\">{String(value)}</span>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* åº•éƒ¨æŒ‰éˆ• */}\n        <div className=\"flex justify-between pt-4 border-t border-morandi-container/20\">\n          <div>\n            {step !== 'select-data' && (\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  if (step === 'fill-manual') setStep('select-data');\n                  if (step === 'preview') setStep('fill-manual');\n                }}\n              >\n                <ChevronLeft size={16} className=\"mr-2\" />\n                ä¸Šä¸€æ­¥\n              </Button>\n            )}\n          </div>\n\n          <div className=\"flex gap-3\">\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n              å–æ¶ˆ\n            </Button>\n\n            {step !== 'preview' ? (\n              <Button\n                onClick={() => {\n                  if (step === 'select-data') setStep('fill-manual');\n                  if (step === 'fill-manual') setStep('preview');\n                }}\n                disabled={!canGoNext()}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n              >\n                ä¸‹ä¸€æ­¥\n                <ChevronRight size={16} className=\"ml-2\" />\n              </Button>\n            ) : (\n              <Button\n                onClick={handleGeneratePDF}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n              >\n                <Download size={16} className=\"mr-2\" />\n                ä¸‹è¼‰ PDF\n              </Button>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/todos/quick-actions/quick-disbursement.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":377,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12374,12377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12374,12377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useMemo } from 'react';\n\nimport { FileText, Search, Plus, Trash2 } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useSupplierStore, useTourStore, useOrderStore } from '@/stores';\nimport type { Tour, Order } from '@/stores/types';\n\nimport { cn } from '@/lib/utils';\nimport { generateUUID } from '@/lib/utils/uuid';\n\ninterface QuickDisbursementProps {\n  onSubmit?: (data: DisbursementData) => void;\n}\n\ninterface DisbursementItem {\n  id: string;\n  category: 'ä½å®¿' | 'äº¤é€š' | 'é¤é£Ÿ' | 'é–€ç¥¨' | 'å°éŠ' | 'å…¶ä»–';\n  supplier_id: string;\n  supplierName: string;\n  description: string;\n  unit_price: number;\n  quantity: number;\n}\n\ninterface DisbursementData {\n  tour_id: string;\n  order_id?: string;\n  request_date: string;\n  items: DisbursementItem[];\n  total_amount: number;\n  note?: string;\n  isSpecialBilling?: boolean;\n}\n\nconst categoryOptions = [\n  { value: 'ä½å®¿', label: 'ğŸ¨ ä½å®¿' },\n  { value: 'äº¤é€š', label: 'ğŸšŒ äº¤é€š' },\n  { value: 'é¤é£Ÿ', label: 'ğŸ½ï¸ é¤é£Ÿ' },\n  { value: 'é–€ç¥¨', label: 'ğŸ« é–€ç¥¨' },\n  { value: 'å°éŠ', label: 'ğŸ‘¥ å°éŠ' },\n  { value: 'å…¶ä»–', label: 'ğŸ“¦ å…¶ä»–' }\n];\n\nexport function QuickDisbursement({ onSubmit }: QuickDisbursementProps) {\n  const { items: tours } = useTourStore();\n  const { items: orders } = useOrderStore();\n  const { items: suppliers } = useSupplierStore();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedTourId, setSelectedTourId] = useState('');\n  const [selectedOrderId, setSelectedOrderId] = useState<string | undefined>(undefined);\n  const [isSpecialBilling, setIsSpecialBilling] = useState(false);\n  const [requestDate, setRequestDate] = useState('');\n  const [note, setNote] = useState('');\n\n  // è«‹æ¬¾é …ç›®åˆ—è¡¨\n  const [items, setItems] = useState<DisbursementItem[]>([]);\n\n  // æ–°å¢é …ç›®è¡¨å–®\n  const [newItem, setNewItem] = useState<{\n    category: 'ä½å®¿' | 'äº¤é€š' | 'é¤é£Ÿ' | 'é–€ç¥¨' | 'å°éŠ' | 'å…¶ä»–';\n    supplier_id: string;\n    description: string;\n    unit_price: number;\n    quantity: number;\n  }>({\n    category: 'ä½å®¿',\n    supplier_id: '',\n    description: '',\n    unit_price: 0,\n    quantity: 1\n  });\n\n  // æ¨¡ç³Šæœå°‹åœ˜é«”\n  const filteredTours = useMemo(() => {\n    if (!searchTerm.trim()) return tours;\n\n    const term = searchTerm.toLowerCase();\n    return tours.filter((tour: Tour) => {\n      const code = tour.code?.toLowerCase() || '';\n      const name = tour.name?.toLowerCase() || '';\n      const location = tour.location?.toLowerCase() || '';\n\n      return code.includes(term) ||\n             name.includes(term) ||\n             location.includes(term);\n    });\n  }, [tours, searchTerm]);\n\n  // è©²åœ˜é«”çš„è¨‚å–®åˆ—è¡¨\n  const tourOrders = useMemo(() => {\n    if (!selectedTourId) return [];\n\n    return orders\n      .filter((order: Order) => order.tour_id === selectedTourId)\n      .map((order: Order) => ({\n        id: order.id,\n        label: `${order.order_number || 'N/A'} - ${order.contact_person} - ${order.sales_person || 'æœªæŒ‡æ´¾'}`\n      }));\n  }, [selectedTourId, orders]);\n\n  const selectedTour = tours.find((t: Tour) => t.id === selectedTourId);\n\n  // ç”Ÿæˆæ¥ä¸‹ä¾†8é€±çš„é€±å››æ—¥æœŸ\n  const upcomingThursdays = useMemo(() => {\n    const thursdays = [];\n    const today = new Date();\n    const currentDay = today.getDay();\n\n    let daysUntilThursday = (4 - currentDay + 7) % 7;\n    if (daysUntilThursday === 0 && today.getHours() >= 12) {\n      daysUntilThursday = 7;\n    }\n\n    for (let i = 0; i < 8; i++) {\n      const thursdayDate = new Date(today);\n      thursdayDate.setDate(today.getDate() + daysUntilThursday + (i * 7));\n\n      thursdays.push({\n        value: thursdayDate.toISOString().split('T')[0],\n        label: `${thursdayDate.toLocaleDateString('zh-TW')} (${thursdayDate.toLocaleDateString('zh-TW', { weekday: 'short' })})`\n      });\n    }\n\n    return thursdays;\n  }, []);\n\n  // æ–°å¢é …ç›®åˆ°åˆ—è¡¨\n  const addItemToList = () => {\n    if (!newItem.supplier_id || !newItem.description) {\n      alert('è«‹é¸æ“‡ä¾›æ‡‰å•†ä¸¦å¡«å¯«é …ç›®æè¿°');\n      return;\n    }\n\n    const selectedSupplier = suppliers.find(s => s.id === newItem.supplier_id);\n    if (!selectedSupplier) return;\n\n    const itemId = generateUUID();\n    setItems(prev => [...prev, {\n      id: itemId,\n      ...newItem,\n      supplierName: selectedSupplier.name\n    }]);\n\n    // é‡ç½®è¡¨å–®\n    setNewItem({\n      category: 'ä½å®¿',\n      supplier_id: '',\n      description: '',\n      unit_price: 0,\n      quantity: 1\n    });\n  };\n\n  // ç§»é™¤é …ç›®\n  const removeItem = (itemId: string) => {\n    setItems(prev => prev.filter(item => item.id !== itemId));\n  };\n\n  // è¨ˆç®—ç¸½é‡‘é¡\n  const total_amount = useMemo(() =>\n    items.reduce((sum, item) => sum + (item.unit_price * item.quantity), 0)\n  , [items]);\n\n  const handleSubmit = () => {\n    if (!selectedTourId || items.length === 0 || !requestDate) {\n      alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½ï¼ˆåœ˜é«”ã€è«‹æ¬¾æ—¥æœŸã€è‡³å°‘ä¸€é …è«‹æ¬¾é …ç›®ï¼‰');\n      return;\n    }\n\n    if (onSubmit) {\n      onSubmit({\n        tour_id: selectedTourId,\n        order_id: selectedOrderId,\n        request_date: requestDate,\n        items,\n        total_amount,\n        note,\n        isSpecialBilling\n      });\n    }\n\n    // é‡ç½®è¡¨å–®\n    setSearchTerm('');\n    setSelectedTourId('');\n    setSelectedOrderId(undefined);\n    setRequestDate('');\n    setNote('');\n    setIsSpecialBilling(false);\n    setItems([]);\n  };\n\n  return (\n    <div className=\"space-y-4 max-h-[80vh] overflow-y-auto pr-2\">\n      <div className=\"space-y-4\">\n        {/* åœ˜é«”æœå°‹é¸æ“‡å™¨ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            é¸æ“‡åœ˜é«” <span className=\"text-morandi-red\">*</span>\n          </label>\n\n          <div className=\"relative mb-2\">\n            <Search size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" />\n            <Input\n              placeholder=\"æœå°‹åœ˜è™Ÿã€åœ˜åæˆ–åœ°é»ï¼ˆå¦‚ï¼š0801ã€æ±äº¬ã€TYOï¼‰\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10 border-morandi-container/30\"\n            />\n          </div>\n\n          {searchTerm && (\n            <div className=\"border border-morandi-container/30 rounded-lg max-h-48 overflow-y-auto mb-2\">\n              {filteredTours.length > 0 ? (\n                filteredTours.map((tour) => (\n                  <button\n                    key={tour.id}\n                    onClick={() => {\n                      setSelectedTourId(tour.id);\n                      setSearchTerm('');\n                      setSelectedOrderId(undefined);\n                    }}\n                    className={cn(\n                      'w-full text-left px-4 py-3 hover:bg-morandi-container/10 transition-colors border-b border-morandi-container/20 last:border-0',\n                      selectedTourId === tour.id && 'bg-morandi-gold/10'\n                    )}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <div className=\"text-sm font-medium text-morandi-primary\">\n                          {tour.code || 'N/A'} - {tour.name}\n                        </div>\n                        <div className=\"text-xs text-morandi-secondary mt-1\">\n                          {tour.location} â€¢ {tour.departure_date}\n                        </div>\n                      </div>\n                      {selectedTourId === tour.id && (\n                        <div className=\"text-morandi-gold text-xs font-medium\">å·²é¸</div>\n                      )}\n                    </div>\n                  </button>\n                ))\n              ) : (\n                <div className=\"px-4 py-6 text-center text-sm text-morandi-secondary\">\n                  æ‰¾ä¸åˆ°ç›¸é—œåœ˜é«”\n                </div>\n              )}\n            </div>\n          )}\n\n          {selectedTour && !searchTerm && (\n            <div className=\"bg-morandi-gold/10 border border-morandi-gold/30 rounded-lg p-3\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-sm font-medium text-morandi-primary\">\n                    {selectedTour.code || 'N/A'} - {selectedTour.name}\n                  </div>\n                  <div className=\"text-xs text-morandi-secondary mt-1\">\n                    {selectedTour.location} â€¢ {selectedTour.departure_date}\n                  </div>\n                </div>\n                <button\n                  onClick={() => {\n                    setSelectedTourId('');\n                    setSelectedOrderId(undefined);\n                  }}\n                  className=\"text-xs text-morandi-red hover:underline\"\n                >\n                  æ¸…é™¤\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* è¨‚å–®é¸æ“‡ï¼ˆé¸å¡«ï¼‰ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            é¸æ“‡è¨‚å–®ï¼ˆé¸å¡«ï¼Œåœ˜é«”å±¤ç´šæ”¯å‡ºå¯ä¸é¸ï¼‰\n          </label>\n          <Select\n            value={selectedOrderId}\n            onValueChange={(value) => setSelectedOrderId(value === 'none' ? undefined : value)}\n            disabled={!selectedTourId}\n          >\n            <SelectTrigger className=\"border-morandi-container/30\">\n              <SelectValue placeholder={selectedTourId ? 'é¸æ“‡è¨‚å–®æˆ–ç•™ç©º' : 'è«‹å…ˆé¸æ“‡åœ˜é«”'} />\n            </SelectTrigger>\n            <SelectContent>\n              {tourOrders.length > 0 ? (\n                <>\n                  <SelectItem value=\"none\">ä¸æŒ‡å®šè¨‚å–®ï¼ˆåœ˜é«”æ”¯å‡ºï¼‰</SelectItem>\n                  {tourOrders.map((order) => (\n                    <SelectItem key={order.id} value={order.id}>\n                      {order.label}\n                    </SelectItem>\n                  ))}\n                </>\n              ) : (\n                <div className=\"px-2 py-4 text-center text-sm text-morandi-secondary\">\n                  æ­¤åœ˜é«”å°šç„¡è¨‚å–®\n                </div>\n              )}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* è«‹æ¬¾æ—¥æœŸ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            è«‹æ¬¾æ—¥æœŸ <span className=\"text-morandi-red\">*</span>\n          </label>\n\n          <div className=\"mb-2 flex items-center space-x-2\">\n            <input\n              type=\"checkbox\"\n              id=\"isSpecialBilling\"\n              checked={isSpecialBilling}\n              onChange={(e) => {\n                setIsSpecialBilling(e.target.checked);\n                setRequestDate('');\n              }}\n              className=\"rounded border-border\"\n            />\n            <label htmlFor=\"isSpecialBilling\" className=\"text-sm text-morandi-primary cursor-pointer\">\n              ç‰¹æ®Šå‡ºå¸³ (å¯é¸æ“‡ä»»ä½•æ—¥æœŸ)\n            </label>\n          </div>\n\n          {isSpecialBilling ? (\n            <div>\n              <Input\n                type=\"date\"\n                value={requestDate}\n                onChange={(e) => setRequestDate(e.target.value)}\n                className=\"bg-morandi-gold/10 border-morandi-gold/50\"\n              />\n              <p className=\"text-xs text-morandi-gold mt-1\">âš ï¸ ç‰¹æ®Šå‡ºå¸³ï¼šå¯é¸æ“‡ä»»ä½•æ—¥æœŸ</p>\n            </div>\n          ) : (\n            <div>\n              <Select\n                value={requestDate}\n                onValueChange={(value) => setRequestDate(value)}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"é¸æ“‡è«‹æ¬¾æ—¥æœŸ (é€±å››)\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {upcomingThursdays.map((thursday) => (\n                    <SelectItem key={thursday.value} value={thursday.value}>\n                      {thursday.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <p className=\"text-xs text-morandi-secondary mt-1\">ğŸ’¼ ä¸€èˆ¬è«‹æ¬¾å›ºå®šæ¯é€±å››</p>\n            </div>\n          )}\n        </div>\n\n        {/* æ–°å¢é …ç›®å€å¡Š */}\n        <div className=\"border border-morandi-container/30 rounded-lg p-4 bg-morandi-container/5\">\n          <h6 className=\"font-medium text-morandi-primary mb-3\">æ–°å¢è«‹æ¬¾é …ç›®</h6>\n\n          <div className=\"space-y-3\">\n            <div className=\"grid grid-cols-2 gap-3\">\n              <div>\n                <label className=\"text-xs font-medium text-morandi-secondary mb-1 block\">é¡åˆ¥</label>\n                <Select\n                  value={newItem.category}\n                  onValueChange={(value: any) => setNewItem(prev => ({ ...prev, category: value }))}\n                >\n                  <SelectTrigger className=\"border-morandi-container/30\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {categoryOptions.map((option) => (\n                      <SelectItem key={option.value} value={option.value}>\n                        {option.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"text-xs font-medium text-morandi-secondary mb-1 block\">ä¾›æ‡‰å•†</label>\n                <Select\n                  value={newItem.supplier_id}\n                  onValueChange={(value) => setNewItem(prev => ({ ...prev, supplier_id: value }))}\n                >\n                  <SelectTrigger className=\"border-morandi-container/30\">\n                    <SelectValue placeholder=\"é¸æ“‡ä¾›æ‡‰å•†\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {suppliers.map((supplier) => (\n                      <SelectItem key={supplier.id} value={supplier.id}>\n                        {supplier.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-xs font-medium text-morandi-secondary mb-1 block\">é …ç›®æè¿°</label>\n              <Input\n                value={newItem.description}\n                onChange={(e) => setNewItem(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"è¼¸å…¥é …ç›®æè¿°\"\n                className=\"border-morandi-container/30\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-3 gap-3\">\n              <div>\n                <label className=\"text-xs font-medium text-morandi-secondary mb-1 block\">å–®åƒ¹</label>\n                <Input\n                  type=\"number\"\n                  value={newItem.unit_price || ''}\n                  onChange={(e) => setNewItem(prev => ({ ...prev, unit_price: Number(e.target.value) }))}\n                  placeholder=\"0\"\n                  className=\"border-morandi-container/30\"\n                />\n              </div>\n\n              <div>\n                <label className=\"text-xs font-medium text-morandi-secondary mb-1 block\">æ•¸é‡</label>\n                <Input\n                  type=\"number\"\n                  value={newItem.quantity || ''}\n                  onChange={(e) => setNewItem(prev => ({ ...prev, quantity: Number(e.target.value) }))}\n                  placeholder=\"1\"\n                  className=\"border-morandi-container/30\"\n                />\n              </div>\n\n              <div>\n                <label className=\"text-xs font-medium text-morandi-secondary mb-1 block\">å°è¨ˆ</label>\n                <Input\n                  value={`NT$ ${(newItem.unit_price * newItem.quantity).toLocaleString()}`}\n                  disabled\n                  className=\"bg-morandi-container/30\"\n                />\n              </div>\n            </div>\n\n            <Button\n              onClick={addItemToList}\n              disabled={!newItem.supplier_id || !newItem.description}\n              className=\"w-full bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              size=\"sm\"\n            >\n              <Plus size={16} className=\"mr-2\" />\n              æ–°å¢é …ç›®\n            </Button>\n          </div>\n        </div>\n\n        {/* é …ç›®åˆ—è¡¨ */}\n        {items.length > 0 && (\n          <div className=\"border border-morandi-container/30 rounded-lg p-4\">\n            <h6 className=\"font-medium text-morandi-primary mb-3\">è«‹æ¬¾é …ç›®åˆ—è¡¨ ({items.length})</h6>\n            <div className=\"space-y-2\">\n              {items.map((item) => (\n                <div key={item.id} className=\"flex items-center justify-between p-3 bg-morandi-container/10 rounded\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-xs bg-morandi-gold/20 text-morandi-gold px-2 py-0.5 rounded\">\n                        {categoryOptions.find(c => c.value === item.category)?.label}\n                      </span>\n                      <span className=\"text-sm font-medium text-morandi-primary\">{item.supplierName}</span>\n                    </div>\n                    <div className=\"text-xs text-morandi-secondary\">{item.description}</div>\n                    <div className=\"text-xs text-morandi-secondary mt-1\">\n                      NT$ {item.unit_price.toLocaleString()} Ã— {item.quantity} =\n                      <span className=\"font-semibold text-morandi-gold ml-1\">\n                        NT$ {(item.unit_price * item.quantity).toLocaleString()}\n                      </span>\n                    </div>\n                  </div>\n                  <button\n                    onClick={() => removeItem(item.id)}\n                    className=\"ml-4 text-morandi-red hover:bg-morandi-red/10 p-2 rounded\"\n                  >\n                    <Trash2 size={16} />\n                  </button>\n                </div>\n              ))}\n            </div>\n\n            <div className=\"mt-3 pt-3 border-t border-morandi-container/30 flex justify-between items-center\">\n              <span className=\"text-sm font-semibold text-morandi-primary\">ç¸½é‡‘é¡:</span>\n              <span className=\"text-lg font-bold text-morandi-gold\">NT$ {total_amount.toLocaleString()}</span>\n            </div>\n          </div>\n        )}\n\n        {/* å‚™è¨» */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            å‚™è¨»\n          </label>\n          <Textarea\n            placeholder=\"è«‹æ¬¾ç›¸é—œèªªæ˜...\"\n            rows={2}\n            value={note}\n            onChange={(e) => setNote(e.target.value)}\n            className=\"border-morandi-container/30\"\n          />\n        </div>\n\n        {/* æäº¤æŒ‰éˆ• */}\n        <Button\n          onClick={handleSubmit}\n          disabled={!selectedTourId || items.length === 0 || !requestDate}\n          className=\"w-full bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n        >\n          <FileText size={16} className=\"mr-2\" />\n          å»ºç«‹è«‹æ¬¾å–® ({items.length} é …ï¼ŒNT$ {total_amount.toLocaleString()})\n        </Button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/todos/quick-actions/quick-group.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1170,1173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1170,1173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1767,1770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1767,1770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\n\nimport { Users } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { SmartDateInput } from '@/components/ui/smart-date-input';\nimport { useTourStore, useOrderStore } from '@/stores';\n\ninterface QuickGroupProps {\n  onSubmit?: () => void;\n}\n\nexport function QuickGroup({ onSubmit }: QuickGroupProps) {\n  const tourStore = useTourStore();\n  const orderStore = useOrderStore();\n  const [submitting, setSubmitting] = useState(false);\n\n  const [newTour, setNewTour] = useState({\n    name: '',\n    location: 'Tokyo',\n    departure_date: '',\n    return_date: '',\n    price: 0,\n    max_participants: 20,\n    description: '',\n    isSpecial: false\n  });\n\n  const [newOrder, setNewOrder] = useState({\n    contact_person: '',\n    sales_person: '',\n    assistant: '',\n    member_count: 1,\n    total_amount: 0\n  });\n\n  const handleSubmit = async () => {\n    if (!newTour.name.trim() || !newTour.departure_date || !newTour.return_date) {\n      alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½ï¼ˆåœ˜åã€å‡ºç™¼æ—¥æœŸã€è¿”å›æ—¥æœŸï¼‰');\n      return;\n    }\n\n    setSubmitting(true);\n    try {\n      const tourData: any = {\n        name: newTour.name,\n        location: newTour.location,\n        departure_date: newTour.departure_date,\n        return_date: newTour.return_date,\n        price: newTour.price,\n        max_participants: newTour.max_participants,\n        description: newTour.description,\n        status: 'draft' as const,\n        contract_status: 'pending' as const,\n        total_revenue: 0,\n        total_cost: 0,\n        profit: 0\n      };\n\n      const createdTour = await tourStore.create(tourData);\n\n      // å¦‚æœæœ‰å¡«å¯«è¯çµ¡äººï¼ŒåŒæ™‚å»ºç«‹è¨‚å–®\n      if (newOrder.contact_person.trim()) {\n        const orderData: any = {\n          tour_id: createdTour.id,\n          code: createdTour.code,\n          tour_name: createdTour.name,\n          contact_person: newOrder.contact_person,\n          sales_person: newOrder.sales_person || 'æœªæŒ‡æ´¾',\n          assistant: newOrder.assistant || 'æœªæŒ‡æ´¾',\n          member_count: newOrder.member_count,\n          total_amount: newOrder.total_amount,\n          paid_amount: 0,\n          remaining_amount: newOrder.total_amount,\n          payment_status: 'unpaid' as const\n        };\n\n        await orderStore.create(orderData);\n      }\n\n      // é‡ç½®è¡¨å–®\n      setNewTour({\n        name: '',\n        location: 'Tokyo',\n        departure_date: '',\n        return_date: '',\n        price: 0,\n        max_participants: 20,\n        description: '',\n        isSpecial: false\n      });\n      setNewOrder({\n        contact_person: '',\n        sales_person: '',\n        assistant: '',\n        member_count: 1,\n        total_amount: 0\n      });\n\n      alert(newOrder.contact_person ? 'æˆåŠŸå»ºç«‹æ—…éŠåœ˜å’Œè¨‚å–®ï¼' : 'æˆåŠŸå»ºç«‹æ—…éŠåœ˜ï¼');\n      onSubmit?.();\n    } catch (error) {\n      console.error('å»ºç«‹å¤±æ•—:', error);\n      alert('å»ºç«‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* æ—…éŠåœ˜è³‡è¨Š */}\n      <div className=\"space-y-4\">\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            æ—…éŠåœ˜åç¨± <span className=\"text-morandi-red\">*</span>\n          </label>\n          <Input\n            value={newTour.name}\n            onChange={(e) => setNewTour(prev => ({ ...prev, name: e.target.value }))}\n            placeholder=\"ä¾‹å¦‚ï¼šæ±äº¬äº”æ—¥éŠ\"\n            className=\"border-morandi-container/30\"\n          />\n        </div>\n\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            ç›®çš„åœ° <span className=\"text-morandi-red\">*</span>\n          </label>\n          <select\n            value={newTour.location}\n            onChange={(e) => setNewTour(prev => ({ ...prev, location: e.target.value }))}\n            className=\"w-full p-2 border border-morandi-container/30 rounded-md bg-background text-sm\"\n          >\n            <option value=\"Tokyo\">Tokyo æ±äº¬</option>\n            <option value=\"Okinawa\">Okinawa æ²–ç¹©</option>\n            <option value=\"Osaka\">Osaka å¤§é˜ª</option>\n            <option value=\"Kyoto\">Kyoto äº¬éƒ½</option>\n            <option value=\"Hokkaido\">Hokkaido åŒ—æµ·é“</option>\n            <option value=\"Fukuoka\">Fukuoka ç¦å²¡</option>\n            <option value=\"Other\">å…¶ä»–</option>\n          </select>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n              å‡ºç™¼æ—¥æœŸ <span className=\"text-morandi-red\">*</span>\n            </label>\n            <SmartDateInput\n              value={newTour.departure_date}\n              onChange={(departure_date) => {\n                setNewTour(prev => {\n                  const newReturnDate = prev.return_date && prev.return_date < departure_date\n                    ? departure_date\n                    : prev.return_date;\n                  return { ...prev, departure_date, return_date: newReturnDate };\n                });\n              }}\n              min={new Date().toISOString().split('T')[0]}\n              className=\"border-morandi-container/30\"\n              required\n            />\n          </div>\n          <div>\n            <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n              è¿”å›æ—¥æœŸ <span className=\"text-morandi-red\">*</span>\n            </label>\n            <SmartDateInput\n              value={newTour.return_date}\n              onChange={(return_date) => {\n                setNewTour(prev => ({ ...prev, return_date }));\n              }}\n              min={newTour.departure_date || new Date().toISOString().split('T')[0]}\n              className=\"border-morandi-container/30\"\n              required\n            />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n              åƒ¹æ ¼\n            </label>\n            <Input\n              type=\"number\"\n              value={newTour.price}\n              onChange={(e) => setNewTour(prev => ({ ...prev, price: Number(e.target.value) }))}\n              className=\"border-morandi-container/30\"\n            />\n          </div>\n          <div>\n            <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n              æœ€å¤§äººæ•¸\n            </label>\n            <Input\n              type=\"number\"\n              value={newTour.max_participants}\n              onChange={(e) => setNewTour(prev => ({ ...prev, max_participants: Number(e.target.value) }))}\n              className=\"border-morandi-container/30\"\n            />\n          </div>\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          <input\n            type=\"checkbox\"\n            id=\"isSpecial-quick\"\n            checked={newTour.isSpecial}\n            onChange={(e) => setNewTour(prev => ({ ...prev, isSpecial: e.target.checked }))}\n            className=\"rounded\"\n          />\n          <label htmlFor=\"isSpecial-quick\" className=\"text-sm text-morandi-primary\">ç‰¹æ®Šåœ˜</label>\n        </div>\n      </div>\n\n      {/* è¨‚å–®è³‡è¨Šï¼ˆé¸å¡«ï¼‰ */}\n      <div className=\"border-t border-morandi-container/30 pt-4 space-y-4\">\n        <h4 className=\"text-sm font-semibold text-morandi-primary\">åŒæ™‚æ–°å¢è¨‚å–®ï¼ˆé¸å¡«ï¼‰</h4>\n\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            è¯çµ¡äºº\n          </label>\n          <Input\n            value={newOrder.contact_person}\n            onChange={(e) => setNewOrder(prev => ({ ...prev, contact_person: e.target.value }))}\n            placeholder=\"ç•™ç©ºå‰‡ä¸å»ºç«‹è¨‚å–®\"\n            className=\"border-morandi-container/30\"\n          />\n        </div>\n\n        {newOrder.contact_person && (\n          <>\n            <div>\n              <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                æ¥­å‹™äººå“¡\n              </label>\n              <Input\n                value={newOrder.sales_person}\n                onChange={(e) => setNewOrder(prev => ({ ...prev, sales_person: e.target.value }))}\n                className=\"border-morandi-container/30\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                åŠ©ç†\n              </label>\n              <Input\n                value={newOrder.assistant}\n                onChange={(e) => setNewOrder(prev => ({ ...prev, assistant: e.target.value }))}\n                className=\"border-morandi-container/30\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                  åœ˜å“¡äººæ•¸\n                </label>\n                <Input\n                  type=\"number\"\n                  value={newOrder.member_count}\n                  onChange={(e) => setNewOrder(prev => ({ ...prev, member_count: Number(e.target.value) }))}\n                  min=\"1\"\n                  className=\"border-morandi-container/30\"\n                />\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                  è¨‚å–®é‡‘é¡\n                </label>\n                <Input\n                  type=\"number\"\n                  value={newOrder.total_amount}\n                  onChange={(e) => setNewOrder(prev => ({ ...prev, total_amount: Number(e.target.value) }))}\n                  className=\"border-morandi-container/30\"\n                />\n              </div>\n            </div>\n          </>\n        )}\n\n        <div className=\"bg-morandi-container/10 p-3 rounded-lg\">\n          <p className=\"text-xs text-morandi-secondary\">\n            æç¤ºï¼šå¦‚æœå¡«å¯«äº†è¯çµ¡äººï¼Œå°‡æœƒåŒæ™‚å»ºç«‹ä¸€ç­†è¨‚å–®ã€‚å¦‚æœç•™ç©ºï¼Œå‰‡åªå»ºç«‹æ—…éŠåœ˜ã€‚\n          </p>\n        </div>\n      </div>\n\n      {/* æäº¤æŒ‰éˆ• */}\n      <Button\n        onClick={handleSubmit}\n        disabled={submitting || !newTour.name.trim() || !newTour.departure_date || !newTour.return_date}\n        className=\"w-full bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n      >\n        <Users size={16} className=\"mr-2\" />\n        {submitting ? 'å»ºç«‹ä¸­...' : (newOrder.contact_person ? 'å»ºç«‹æ—…éŠåœ˜ & è¨‚å–®' : 'å»ºç«‹æ—…éŠåœ˜')}\n      </Button>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/todos/quick-actions/quick-receipt.tsx","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":77,"column":17,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":77,"endColumn":35},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":78,"column":15,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":78,"endColumn":31},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":79,"column":22,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":79,"endColumn":45},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":80,"column":21,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":80,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useMemo } from 'react';\n\nimport { Receipt, Search } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useTourStore, useOrderStore } from '@/stores';\nimport type { Tour, Order } from '@/stores/types';\n\nimport { cn } from '@/lib/utils';\n\ninterface QuickReceiptProps {\n  onSubmit?: (data: ReceiptData) => void;\n}\n\ninterface ReceiptData {\n  tour_id: string;\n  order_id: string;\n  amount: number;\n  paymentMethod: string;\n  payment_date: string;\n  note?: string;\n}\n\nexport function QuickReceipt({ onSubmit }: QuickReceiptProps) {\n  const { items: tours } = useTourStore();\n  const { items: orders } = useOrderStore();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedTourId, setSelectedTourId] = useState('');\n  const [formData, setFormData] = useState<Partial<ReceiptData>>({\n    paymentMethod: 'transfer',\n    payment_date: new Date().toISOString().split('T')[0]\n  });\n\n  // æ¨¡ç³Šæœå°‹åœ˜é«”ï¼ˆåœ˜è™Ÿ/åœ˜å/ä»£ç¢¼ï¼‰\n  const filteredTours = useMemo(() => {\n    if (!searchTerm.trim()) return tours || [];\n\n    const term = searchTerm.toLowerCase();\n    return (tours || []).filter((tour: Tour) => {\n      const code = tour.code?.toLowerCase() || '';\n      const name = tour.name?.toLowerCase() || '';\n      const location = tour.location?.toLowerCase() || '';\n\n      return code.includes(term) ||\n             name.includes(term) ||\n             location.includes(term);\n    });\n  }, [tours, searchTerm]);\n\n  // è©²åœ˜é«”çš„è¨‚å–®åˆ—è¡¨ï¼ˆè¨‚å–®ç·¨è™Ÿ-è¯çµ¡äºº-æ¥­å‹™ï¼‰\n  const tourOrders = useMemo(() => {\n    if (!selectedTourId) return [];\n\n    return orders\n      .filter((order: Order) => order.tour_id === selectedTourId)\n      .map((order: Order) => ({\n        id: order.id,\n        label: `${order.order_number || 'N/A'} - ${order.contact_person} - ${order.sales_person || 'æœªæŒ‡æ´¾'}`\n      }));\n  }, [selectedTourId, orders]);\n\n  const selectedTour = (tours || []).find((t: Tour) => t.id === selectedTourId);\n\n  const handleSubmit = () => {\n    if (!formData.order_id || !formData.amount) {\n      alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½ï¼ˆåœ˜é«”ã€è¨‚å–®ã€é‡‘é¡ï¼‰');\n      return;\n    }\n\n    onSubmit?.({\n      tour_id: selectedTourId,\n      order_id: formData.order_id!,\n      amount: formData.amount!,\n      paymentMethod: formData.paymentMethod!,\n      payment_date: formData.payment_date!,\n      note: formData.note\n    });\n\n    // é‡ç½®è¡¨å–®\n    setSearchTerm('');\n    setSelectedTourId('');\n    setFormData({\n      paymentMethod: 'transfer',\n      payment_date: new Date().toISOString().split('T')[0]\n    });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* åœ˜é«”æœå°‹é¸æ“‡å™¨ */}\n      <div>\n        <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n          é¸æ“‡åœ˜é«” <span className=\"text-morandi-red\">*</span>\n        </label>\n\n        {/* æœå°‹è¼¸å…¥æ¡† */}\n        <div className=\"relative mb-2\">\n          <Search size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" />\n          <Input\n            placeholder=\"æœå°‹åœ˜è™Ÿã€åœ˜åæˆ–åœ°é»ï¼ˆå¦‚ï¼š0801ã€æ±äº¬ã€TYOï¼‰\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-10 border-morandi-container/30\"\n          />\n        </div>\n\n        {/* æœå°‹çµæœåˆ—è¡¨ */}\n        {searchTerm && (\n          <div className=\"border border-morandi-container/30 rounded-lg max-h-48 overflow-y-auto\">\n            {filteredTours.length > 0 ? (\n              filteredTours.map((tour: Tour) => (\n                <button\n                    key={tour.id}\n                    onClick={() => {\n                      setSelectedTourId(tour.id);\n                      setSearchTerm('');\n                      setFormData(prev => ({ ...prev, order_id: undefined })); // é‡ç½®è¨‚å–®\n                    }}\n                    className={cn(\n                      'w-full text-left px-4 py-3 hover:bg-morandi-container/10 transition-colors border-b border-morandi-container/20 last:border-0',\n                      selectedTourId === tour.id && 'bg-morandi-gold/10'\n                    )}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <div className=\"text-sm font-medium text-morandi-primary\">\n                          {tour.code || 'N/A'} - {tour.name}\n                        </div>\n                        <div className=\"text-xs text-morandi-secondary mt-1\">\n                          {tour.location} â€¢ {tour.departure_date}\n                        </div>\n                      </div>\n                      {selectedTourId === tour.id && (\n                        <div className=\"text-morandi-gold text-xs font-medium\">å·²é¸</div>\n                      )}\n                    </div>\n                  </button>\n                ))\n              ) : (\n                <div className=\"px-4 py-6 text-center text-sm text-morandi-secondary\">\n                  æ‰¾ä¸åˆ°ç›¸é—œåœ˜é«”\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* å·²é¸åœ˜é«”é¡¯ç¤º */}\n          {selectedTour && !searchTerm && (\n            <div className=\"bg-morandi-gold/10 border border-morandi-gold/30 rounded-lg p-3\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-sm font-medium text-morandi-primary\">\n                    {selectedTour.code || 'N/A'} - {selectedTour.name}\n                  </div>\n                  <div className=\"text-xs text-morandi-secondary mt-1\">\n                    {selectedTour.location} â€¢ {selectedTour.departure_date}\n                  </div>\n                </div>\n                <button\n                  onClick={() => {\n                    setSelectedTourId('');\n                    setFormData(prev => ({ ...prev, order_id: undefined }));\n                  }}\n                  className=\"text-xs text-morandi-red hover:underline\"\n                >\n                  æ¸…é™¤\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* è¨‚å–®é¸æ“‡ï¼ˆå¿…é ˆå…ˆé¸åœ˜é«”ï¼‰ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            é¸æ“‡è¨‚å–® <span className=\"text-morandi-red\">*</span>\n          </label>\n          <Select\n            value={formData.order_id}\n            onValueChange={(value) => setFormData(prev => ({ ...prev, order_id: value }))}\n            disabled={!selectedTourId}\n          >\n            <SelectTrigger className=\"border-morandi-container/30\">\n              <SelectValue placeholder={selectedTourId ? 'è«‹é¸æ“‡è¨‚å–®' : 'è«‹å…ˆé¸æ“‡åœ˜é«”'} />\n            </SelectTrigger>\n            <SelectContent>\n              {tourOrders.length > 0 ? (\n                tourOrders.map((order: { id: string; label: string }) => (\n                  <SelectItem key={order.id} value={order.id}>\n                    {order.label}\n                  </SelectItem>\n                ))\n              ) : (\n                <div className=\"px-2 py-4 text-center text-sm text-morandi-secondary\">\n                  æ­¤åœ˜é«”å°šç„¡è¨‚å–®\n                </div>\n              )}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* æ”¶æ¬¾é‡‘é¡ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            æ”¶æ¬¾é‡‘é¡ <span className=\"text-morandi-red\">*</span>\n          </label>\n          <Input\n            type=\"number\"\n            placeholder=\"è«‹è¼¸å…¥é‡‘é¡\"\n            value={formData.amount || ''}\n            onChange={(e) => setFormData(prev => ({ ...prev, amount: Number(e.target.value) }))}\n            className=\"border-morandi-container/30\"\n          />\n        </div>\n\n        {/* ä»˜æ¬¾æ–¹å¼ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            ä»˜æ¬¾æ–¹å¼ <span className=\"text-morandi-red\">*</span>\n          </label>\n          <Select\n            value={formData.paymentMethod}\n            onValueChange={(value) => setFormData(prev => ({ ...prev, paymentMethod: value }))}\n          >\n            <SelectTrigger className=\"border-morandi-container/30\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"cash\">ç¾é‡‘</SelectItem>\n              <SelectItem value=\"transfer\">è½‰å¸³</SelectItem>\n              <SelectItem value=\"card\">ä¿¡ç”¨å¡</SelectItem>\n              <SelectItem value=\"check\">æ”¯ç¥¨</SelectItem>\n              <SelectItem value=\"other\">å…¶ä»–</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* æ”¶æ¬¾æ—¥æœŸ */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            æ”¶æ¬¾æ—¥æœŸ <span className=\"text-morandi-red\">*</span>\n          </label>\n          <Input\n            type=\"date\"\n            value={formData.payment_date}\n            onChange={(e) => setFormData(prev => ({ ...prev, payment_date: e.target.value }))}\n            className=\"border-morandi-container/30\"\n          />\n        </div>\n\n        {/* å‚™è¨» */}\n        <div>\n          <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n            å‚™è¨»\n          </label>\n          <Textarea\n            placeholder=\"æ”¶æ¬¾ç›¸é—œèªªæ˜...\"\n            rows={2}\n            value={formData.note || ''}\n            onChange={(e) => setFormData(prev => ({ ...prev, note: e.target.value }))}\n            className=\"border-morandi-container/30\"\n          />\n        </div>\n\n      {/* æäº¤æŒ‰éˆ• */}\n      <Button\n        onClick={handleSubmit}\n        disabled={!selectedTourId || !formData.order_id || !formData.amount}\n        className=\"w-full bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n      >\n        <Receipt size={16} className=\"mr-2\" />\n        å»ºç«‹æ”¶æ¬¾å–®\n      </Button>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/todos/todo-card-groups.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/todos/todo-expanded-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'progressPercentage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":125,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'todo' is defined but never used. Allowed unused args must match /^_/u.","line":562,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":562,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { StarRating } from '@/components/ui/star-rating';\nimport { Todo } from '@/stores/types';\nimport { cn } from '@/lib/utils';\nimport { useEnterSubmit, useEnterSubmitWithShift } from '@/hooks/useEnterSubmit';\nimport { useUserStore } from '@/stores/user-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport {\n  Receipt,\n  FileText,\n  Users,\n  DollarSign,\n  UserPlus,\n  Calendar,\n  Clock,\n  MessageSquare,\n  Check,\n  X,\n  CheckCircle,\n  Edit2\n} from 'lucide-react';\nimport { generateUUID } from '@/lib/utils/uuid';\n\ninterface TodoExpandedViewProps {\n  todo: Todo;\n  onUpdate: (updates: Partial<Todo>) => void;\n  onClose: () => void;\n}\n\ntype QuickActionTab = 'receipt' | 'invoice' | 'group' | 'quote' | 'share';\n\nexport function TodoExpandedView({ todo, onUpdate, onClose }: TodoExpandedViewProps) {\n  const [activeTab, setActiveTab] = useState<QuickActionTab>('receipt');\n  const [newSubTask, setNewSubTask] = useState('');\n  const [newNote, setNewNote] = useState('');\n  const [editingNoteIndex, setEditingNoteIndex] = useState<number | null>(null);\n  const [editingNoteContent, setEditingNoteContent] = useState('');\n  const [editingSubTaskId, setEditingSubTaskId] = useState<string | null>(null);\n  const [editingSubTaskContent, setEditingSubTaskContent] = useState('');\n\n  const quickActionTabs = [\n    { key: 'receipt' as const, label: 'æ”¶æ¬¾', icon: Receipt },\n    { key: 'invoice' as const, label: 'è«‹æ¬¾', icon: FileText },\n    { key: 'group' as const, label: 'é–‹åœ˜', icon: Users },\n    { key: 'quote' as const, label: 'å ±åƒ¹', icon: DollarSign },\n    { key: 'share' as const, label: 'å…±äº«', icon: UserPlus },\n  ];\n\n  const addSubTask = () => {\n    if (!newSubTask.trim()) return;\n\n    const newTask = {\n      id: generateUUID(),\n      title: newSubTask,\n      done: false,\n    };\n\n    // å¦‚æœç›®å‰ç‹€æ…‹æ˜¯ã€Œå¾…è¾¦ã€ï¼Œè‡ªå‹•åˆ‡æ›åˆ°ã€Œé€²è¡Œä¸­ã€\n    const updates: Partial<Todo> = {\n      sub_tasks: [...(todo.sub_tasks || []), newTask]\n    };\n\n    if (todo.status === 'pending') {\n      updates.status = 'in_progress';\n    }\n\n    onUpdate(updates);\n    setNewSubTask('');\n  };\n\n  const addNote = () => {\n    if (!newNote.trim()) return;\n\n    const note = {\n      timestamp: new Date().toISOString(),\n      content: newNote\n    };\n\n    // å¦‚æœç›®å‰ç‹€æ…‹æ˜¯ã€Œå¾…è¾¦ã€ï¼Œè‡ªå‹•åˆ‡æ›åˆ°ã€Œé€²è¡Œä¸­ã€\n    const updates: Partial<Todo> = {\n      notes: [...(todo.notes || []), note]\n    };\n\n    if (todo.status === 'pending') {\n      updates.status = 'in_progress';\n    }\n\n    onUpdate(updates);\n    setNewNote('');\n  };\n\n  const { handleKeyDown: handleSubTaskKeyDown, compositionProps: subTaskCompositionProps } = useEnterSubmit(addSubTask);\n  const { handleKeyDown: handleNoteKeyDown, compositionProps: noteCompositionProps } = useEnterSubmitWithShift(addNote);\n\n  const toggleSubTask = (taskId: string) => {\n    const updatedSubTasks = (todo.sub_tasks || []).map(task =>\n      task.id === taskId\n        ? { ...task, done: !task.done, completed_at: !task.done ? new Date().toISOString() : undefined }\n        : task\n    );\n\n    onUpdate({ sub_tasks: updatedSubTasks });\n  };\n\n  const getDeadlineColor = () => {\n    if (!todo.deadline) return 'text-morandi-secondary';\n\n    const deadline = new Date(todo.deadline);\n    const today = new Date();\n    const diffDays = Math.ceil((deadline.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n\n    if (diffDays < 0) return 'text-morandi-red'; // é€¾æœŸ\n    if (diffDays === 0) return 'text-morandi-gold'; // ä»Šå¤©\n    if (diffDays <= 3) return 'text-morandi-gold'; // 3å¤©å…§\n    return 'text-morandi-secondary'; // å……è£•\n  };\n\n  const completedSubTasks = (todo.sub_tasks || []).filter(task => task.done).length;\n  const progressPercentage = (todo.sub_tasks || []).length > 0 ? (completedSubTasks / (todo.sub_tasks || []).length) * 100 : 0;\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-gray-50 rounded-2xl shadow-2xl w-full max-w-[1400px] h-[90vh] flex flex-col relative\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* å³ä¸Šè§’é—œé–‰æŒ‰éˆ• */}\n        <button\n          onClick={onClose}\n          className=\"absolute top-3 right-3 z-10 p-1 hover:bg-morandi-red/10 hover:text-morandi-red transition-colors rounded-lg text-morandi-secondary\"\n        >\n          <X size={14} />\n        </button>\n\n        {/* ä¸»è¦å…§å®¹å€ */}\n        <div className=\"flex flex-1 overflow-hidden pt-4\">\n          {/* å·¦åŠéƒ¨ï¼šè©³æƒ…è³‡æ–™ */}\n          <div className=\"w-1/2 px-6 py-4 border-r border-border flex flex-col\">\n            {/* æ¨™é¡Œèˆ‡æ˜Ÿç´š */}\n            <div className=\"mb-4 bg-card border border-border rounded-xl p-4 shadow-sm\">\n              <div className=\"flex items-center justify-between gap-4\">\n                {/* å·¦é‚Šï¼šæ¨™é¡Œ */}\n                <div className=\"flex-1\">\n                  <Input\n                    value={todo.title}\n                    onChange={(e) => onUpdate({ title: e.target.value })}\n                    className=\"text-lg font-bold border-none shadow-none p-0 h-auto focus-visible:ring-0 bg-transparent\"\n                    placeholder=\"è¼¸å…¥ä»»å‹™æ¨™é¡Œ...\"\n                  />\n                </div>\n\n                {/* å³é‚Šï¼šå„ªå…ˆç´š */}\n                <div className=\"flex items-center gap-2 flex-shrink-0\">\n                  <span className=\"text-xs text-morandi-secondary\">å„ªå…ˆç´š:</span>\n                  <StarRating\n                    value={todo.priority}\n                    onChange={(value) => onUpdate({ priority: value as 1 | 2 | 3 | 4 | 5 })}\n                    size=\"sm\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* åŸºæœ¬è³‡è¨Š */}\n            <div className=\"bg-card border border-border rounded-xl p-4 mb-4 shadow-sm\">\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center gap-3\">\n                  <Calendar size={18} className=\"text-morandi-secondary\" />\n                  <span className=\"text-sm text-morandi-secondary min-w-[60px]\">æœŸé™:</span>\n                  <Input\n                    type=\"date\"\n                    value={todo.deadline || ''}\n                    onChange={(e) => onUpdate({ deadline: e.target.value })}\n                    className={cn('text-sm font-medium h-8 w-auto', getDeadlineColor())}\n                  />\n                  {todo.deadline && (\n                    <button\n                      onClick={() => onUpdate({ deadline: '' })}\n                      className=\"p-1 hover:bg-morandi-red/10 rounded text-morandi-secondary hover:text-morandi-red\"\n                      title=\"æ¸…é™¤æœŸé™\"\n                    >\n                      <X size={14} />\n                    </button>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <Clock size={16} className=\"text-morandi-secondary\" />\n                  <span className=\"text-xs text-morandi-secondary min-w-[50px]\">ç‹€æ…‹:</span>\n                  <div className=\"flex gap-1.5 flex-wrap\">\n                    <button\n                      onClick={() => onUpdate({ status: 'pending' })}\n                      className={cn(\n                        'px-3 py-1.5 text-xs rounded-lg transition-all font-medium',\n                        todo.status === 'pending'\n                          ? 'bg-morandi-muted text-white shadow-sm'\n                          : 'bg-white/60 border border-morandi-container/30 text-morandi-secondary hover:bg-white hover:border-morandi-muted/50'\n                      )}\n                    >\n                      å¾…è¾¦\n                    </button>\n                    <button\n                      onClick={() => onUpdate({ status: 'in_progress' })}\n                      className={cn(\n                        'px-3 py-1.5 text-xs rounded-lg transition-all font-medium',\n                        todo.status === 'in_progress'\n                          ? 'bg-morandi-gold text-white shadow-sm'\n                          : 'bg-white/60 border border-morandi-container/30 text-morandi-secondary hover:bg-white hover:border-morandi-gold/50'\n                      )}\n                    >\n                      é€²è¡Œä¸­\n                    </button>\n                    <button\n                      onClick={() => onUpdate({ status: 'completed' })}\n                      className={cn(\n                        'px-3 py-1.5 text-xs rounded-lg transition-all font-medium',\n                        todo.status === 'completed'\n                          ? 'bg-morandi-green text-white shadow-sm'\n                          : 'bg-white/60 border border-morandi-container/30 text-morandi-secondary hover:bg-white hover:border-morandi-green/50'\n                      )}\n                    >\n                      å®Œæˆ\n                    </button>\n                    <button\n                      onClick={() => onUpdate({ status: 'cancelled' })}\n                      className={cn(\n                        'px-3 py-1.5 text-xs rounded-lg transition-all font-medium',\n                        todo.status === 'cancelled'\n                          ? 'bg-morandi-red text-white shadow-sm'\n                          : 'bg-white/60 border border-morandi-container/30 text-morandi-secondary hover:bg-white hover:border-morandi-red/50'\n                      )}\n                    >\n                      å–æ¶ˆ\n                    </button>\n                  </div>\n                </div>\n              </div>\n\n              {todo.related_items && todo.related_items.length > 0 && (\n                <div className=\"pt-3 mt-3 border-t border-border\">\n                  <span className=\"text-xs font-medium text-morandi-primary flex items-center gap-1.5 mb-2\">\n                    <FileText size={12} className=\"text-morandi-gold\" />\n                    é—œè¯é …ç›®\n                  </span>\n                  <div className=\"flex flex-wrap gap-1.5\">\n                    {todo.related_items.map((item, index) => (\n                      <button\n                        key={index}\n                        onClick={() => {\n                          const basePath = {\n                            'group': '/tours',\n                            'quote': '/quotes',\n                            'order': '/orders',\n                            'invoice': '/finance/treasury/disbursement',\n                            'receipt': '/finance/payments'\n                          }[item.type];\n                          if (basePath) {\n                            window.location.href = `${basePath}?highlight=${item.id}`;\n                          }\n                        }}\n                        className=\"bg-white/60 border border-morandi-gold/30 text-morandi-primary text-xs px-2 py-1 rounded-lg hover:bg-morandi-gold/10 hover:border-morandi-gold/50 transition-all font-medium\"\n                      >\n                        {item.title}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* å­ä»»å‹™æ¸…å–® */}\n            <div className=\"mb-4 bg-card border border-border rounded-xl p-4 shadow-sm\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h4 className=\"text-sm font-semibold text-morandi-primary flex items-center gap-1.5\">\n                  <CheckCircle size={14} className=\"text-morandi-gold\" />\n                  å­ä»»å‹™æ¸…å–®\n                </h4>\n                <span className=\"text-xs text-morandi-primary bg-morandi-gold/10 border border-morandi-gold/30 px-2 py-1 rounded-lg font-medium\">\n                  {completedSubTasks}/{(todo.sub_tasks || []).length}\n                </span>\n              </div>\n\n              <div className=\"space-y-1.5 mb-3\">\n                {(todo.sub_tasks || []).map((task) => (\n                  <div key={task.id} className=\"flex items-center gap-2 p-2 rounded-lg bg-morandi-container/10 hover:bg-morandi-container/20 transition-colors border border-transparent hover:border-morandi-gold/30 group relative\">\n                    {editingSubTaskId === task.id ? (\n                      // ç·¨è¼¯æ¨¡å¼\n                      <>\n                        <button\n                          onClick={() => toggleSubTask(task.id)}\n                          className={cn(\n                            'w-4 h-4 rounded border-2 transition-all flex items-center justify-center shadow-sm flex-shrink-0',\n                            task.done\n                              ? 'bg-morandi-gold border-morandi-gold scale-110'\n                              : 'border-morandi-muted hover:border-morandi-gold bg-white'\n                          )}\n                        >\n                          {task.done && <Check size={12} className=\"text-white\" />}\n                        </button>\n                        <Input\n                          value={editingSubTaskContent}\n                          onChange={(e) => setEditingSubTaskContent(e.target.value)}\n                          className=\"text-xs h-7 flex-1\"\n                          autoFocus\n                        />\n                        <Button\n                          size=\"sm\"\n                          onClick={() => {\n                            const updatedSubTasks = (todo.sub_tasks || []).map(t =>\n                              t.id === task.id ? { ...t, title: editingSubTaskContent } : t\n                            );\n                            onUpdate({ sub_tasks: updatedSubTasks });\n                            setEditingSubTaskId(null);\n                          }}\n                          className=\"bg-morandi-gold hover:bg-morandi-gold/90 h-7 text-xs px-2\"\n                        >\n                          å„²å­˜\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => setEditingSubTaskId(null)}\n                          className=\"h-7 text-xs px-2\"\n                        >\n                          å–æ¶ˆ\n                        </Button>\n                      </>\n                    ) : (\n                      // é¡¯ç¤ºæ¨¡å¼\n                      <>\n                        <button\n                          onClick={() => toggleSubTask(task.id)}\n                          className={cn(\n                            'w-4 h-4 rounded border-2 transition-all flex items-center justify-center shadow-sm flex-shrink-0',\n                            task.done\n                              ? 'bg-morandi-gold border-morandi-gold scale-110'\n                              : 'border-morandi-muted hover:border-morandi-gold bg-white'\n                          )}\n                        >\n                          {task.done && <Check size={12} className=\"text-white\" />}\n                        </button>\n                        <span className={cn(\n                          'text-xs flex-1 font-medium',\n                          task.done\n                            ? 'line-through text-morandi-muted'\n                            : 'text-morandi-primary'\n                        )}>\n                          {task.title}\n                        </span>\n                        <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1\">\n                          <button\n                            onClick={() => {\n                              setEditingSubTaskId(task.id);\n                              setEditingSubTaskContent(task.title);\n                            }}\n                            className=\"p-1 hover:bg-morandi-gold/10 rounded text-morandi-secondary hover:text-morandi-gold\"\n                            title=\"ç·¨è¼¯å­ä»»å‹™\"\n                          >\n                            <Edit2 size={12} />\n                          </button>\n                          <button\n                            onClick={() => {\n                              const updatedSubTasks = (todo.sub_tasks || []).filter(t => t.id !== task.id);\n                              onUpdate({ sub_tasks: updatedSubTasks });\n                            }}\n                            className=\"p-1 hover:bg-morandi-red/10 rounded text-morandi-red\"\n                            title=\"åˆªé™¤å­ä»»å‹™\"\n                          >\n                            <X size={12} />\n                          </button>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"æ–°å¢å­ä»»å‹™... (Enter)\"\n                  value={newSubTask}\n                  onChange={(e) => setNewSubTask(e.target.value)}\n                  onKeyDown={handleSubTaskKeyDown}\n                  {...subTaskCompositionProps}\n                  className=\"text-sm border-morandi-container/30 focus-visible:ring-morandi-gold\"\n                />\n                <Button size=\"sm\" onClick={addSubTask} className=\"bg-morandi-gold hover:bg-morandi-gold/90\">\n                  æ–°å¢\n                </Button>\n              </div>\n            </div>\n\n            {/* å‚™è¨»å€ */}\n            <div className=\"bg-card border border-border rounded-xl p-4 shadow-sm flex-1 flex flex-col min-h-0\">\n              <h4 className=\"text-sm font-semibold text-morandi-primary mb-3 flex items-center gap-1.5\">\n                <MessageSquare size={14} className=\"text-morandi-gold\" />\n                å‚™è¨»\n              </h4>\n              <div className=\"space-y-2 mb-3 flex-1 overflow-y-auto\">\n                {todo.notes.map((note, index) => (\n                  <div key={index} className=\"bg-gradient-to-br from-morandi-container/20 to-morandi-container/10 border border-morandi-container/30 rounded-lg p-3 hover:shadow-sm transition-shadow group relative\">\n                    {editingNoteIndex === index ? (\n                      // ç·¨è¼¯æ¨¡å¼\n                      <div>\n                        <span className=\"text-xs text-morandi-muted font-medium\">\n                          {new Date(note.timestamp).toLocaleString()}\n                        </span>\n                        <Textarea\n                          value={editingNoteContent}\n                          onChange={(e) => setEditingNoteContent(e.target.value)}\n                          className=\"text-xs mt-2 resize-none border-morandi-gold/50 focus-visible:ring-morandi-gold\"\n                          rows={3}\n                          autoFocus\n                        />\n                        <div className=\"flex gap-2 mt-2\">\n                          <Button\n                            size=\"sm\"\n                            onClick={() => {\n                              const newNotes = [...todo.notes];\n                              newNotes[index] = { ...note, content: editingNoteContent };\n                              onUpdate({ notes: newNotes });\n                              setEditingNoteIndex(null);\n                            }}\n                            className=\"bg-morandi-gold hover:bg-morandi-gold/90 h-7 text-xs\"\n                          >\n                            å„²å­˜\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"outline\"\n                            onClick={() => setEditingNoteIndex(null)}\n                            className=\"h-7 text-xs\"\n                          >\n                            å–æ¶ˆ\n                          </Button>\n                        </div>\n                      </div>\n                    ) : (\n                      // é¡¯ç¤ºæ¨¡å¼\n                      <>\n                        <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1\">\n                          <button\n                            onClick={() => {\n                              setEditingNoteIndex(index);\n                              setEditingNoteContent(note.content);\n                            }}\n                            className=\"p-1 hover:bg-morandi-gold/10 rounded text-morandi-secondary hover:text-morandi-gold\"\n                            title=\"ç·¨è¼¯å‚™è¨»\"\n                          >\n                            <Edit2 size={12} />\n                          </button>\n                          <button\n                            onClick={() => {\n                              const newNotes = todo.notes.filter((_, i) => i !== index);\n                              onUpdate({ notes: newNotes });\n                            }}\n                            className=\"p-1 hover:bg-morandi-red/10 rounded text-morandi-red\"\n                            title=\"åˆªé™¤å‚™è¨»\"\n                          >\n                            <X size={12} />\n                          </button>\n                        </div>\n                        <span className=\"text-xs text-morandi-muted font-medium\">\n                          {new Date(note.timestamp).toLocaleString()}\n                        </span>\n                        <div className=\"text-xs text-morandi-primary mt-1.5 leading-relaxed whitespace-pre-wrap\">{note.content}</div>\n                      </>\n                    )}\n                  </div>\n                ))}\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Textarea\n                  placeholder=\"æ–°å¢å‚™è¨»... (Enter é€å‡ºï¼ŒShift+Enter æ›è¡Œ)\"\n                  value={newNote}\n                  onChange={(e) => setNewNote(e.target.value)}\n                  onKeyDown={handleNoteKeyDown}\n                  {...noteCompositionProps}\n                  className=\"text-sm resize-none border-morandi-container/40 focus-visible:ring-morandi-gold focus-visible:border-morandi-gold shadow-sm\"\n                  rows={3}\n                />\n                <Button size=\"sm\" onClick={addNote} className=\"bg-morandi-gold hover:bg-morandi-gold/90 shadow-sm\">\n                  æ–°å¢\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* å³åŠéƒ¨ï¼šå¿«é€ŸåŠŸèƒ½ */}\n          <div className=\"w-1/2 px-6 py-4 flex flex-col\">\n            {/* å¿«é€ŸåŠŸèƒ½åˆ†é  */}\n            <div className=\"mb-4 bg-card border border-border rounded-xl p-2 shadow-sm\">\n              <div className=\"flex gap-2\">\n                {quickActionTabs.map((tab) => {\n                  const Icon = tab.icon;\n                  return (\n                    <button\n                      key={tab.key}\n                      onClick={() => setActiveTab(tab.key)}\n                      className={cn(\n                        'flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium transition-all flex-1 rounded-lg',\n                        activeTab === tab.key\n                          ? 'bg-morandi-container/30 text-morandi-primary'\n                          : 'bg-transparent text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/10'\n                      )}\n                    >\n                      <Icon size={16} />\n                      {tab.label}\n                    </button>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* åˆ†é å…§å®¹ */}\n            <div className=\"flex-1 bg-card border border-border rounded-xl p-4 overflow-y-auto shadow-sm\">\n              <QuickActionContent activeTab={activeTab} todo={todo} />\n            </div>\n\n            {/* å¿«é€Ÿæ“ä½œæŒ‰éˆ• */}\n            <div className=\"flex gap-2 mt-4\">\n              <Button\n                onClick={() => {\n                  onUpdate({ status: 'completed', completed: true });\n                  onClose();\n                }}\n                className=\"flex-1 bg-gradient-to-r from-morandi-gold to-yellow-400 hover:from-morandi-gold/90 hover:to-yellow-400/90 text-white shadow-md hover:shadow-lg transition-all\"\n              >\n                <Check size={16} className=\"mr-1\" />\n                æ¨™è¨˜å®Œæˆ\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  const newDeadline = new Date();\n                  newDeadline.setDate(newDeadline.getDate() + 7);\n                  onUpdate({ deadline: newDeadline.toISOString().split('T')[0] });\n                }}\n                className=\"flex-1 border-morandi-container/50 hover:bg-morandi-container/20 hover:border-morandi-gold/50 shadow-sm transition-all\"\n              >\n                <Calendar size={16} className=\"mr-1\" />\n                å»¶æœŸä¸€é€±\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// å¿«é€ŸåŠŸèƒ½å…§å®¹çµ„ä»¶\nfunction QuickActionContent({ activeTab, todo }: { activeTab: QuickActionTab; todo: Todo }) {\n  const { items: employees, fetchAll } = useUserStore();\n  const { user: currentUser } = useAuthStore();\n\n  // ä½¿ç”¨ ref å»ºç«‹ç©©å®šçš„å‡½æ•¸åƒè€ƒ\n  const fetchAllRef = useRef(fetchAll);\n\n  // æ›´æ–° ref ç•¶ fetchAll æ”¹è®Šæ™‚\n  useEffect(() => {\n    fetchAllRef.current = fetchAll;\n  }, [fetchAll]);\n\n  // åªåœ¨å…±äº«åˆ†é æ™‚è¼‰å…¥å“¡å·¥è³‡æ–™\n  useEffect(() => {\n    if (activeTab === 'share' && employees.length === 0) {\n      console.log('ğŸ“¥ è¼‰å…¥å“¡å·¥è³‡æ–™...');\n      fetchAllRef.current();\n    }\n  }, [activeTab, employees.length]);\n\n  // éæ¿¾æ‰è‡ªå·±\n  const otherEmployees = employees.filter(emp => emp.id !== currentUser?.id);\n\n  switch (activeTab) {\n    case 'receipt':\n      return (\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center gap-2 pb-3 border-b border-morandi-container/20\">\n            <div className=\"p-1.5 bg-morandi-gold/10 rounded-lg\">\n              <Receipt size={16} className=\"text-morandi-gold\" />\n            </div>\n            <div>\n              <h5 className=\"text-sm font-semibold text-morandi-primary\">å¿«é€Ÿæ”¶æ¬¾</h5>\n              <p className=\"text-xs text-morandi-secondary\">å»ºç«‹æ–°çš„æ”¶æ¬¾è¨˜éŒ„</p>\n            </div>\n          </div>\n          <div className=\"space-y-2.5\">\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">é¸æ“‡è¨‚å–®</label>\n              <Select>\n                <SelectTrigger className=\"shadow-sm h-9 text-xs\">\n                  <SelectValue placeholder=\"é¸æ“‡è¨‚å–®\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"order1\">æ±äº¬5æ—¥éŠ - ç‹å°æ˜</SelectItem>\n                  <SelectItem value=\"order2\">æ²–ç¹©åº¦å‡ - æå°è¯</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">æ”¶æ¬¾é‡‘é¡</label>\n              <Input placeholder=\"è¼¸å…¥é‡‘é¡\" type=\"number\" className=\"shadow-sm h-9 text-xs\" />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">ä»˜æ¬¾æ–¹å¼</label>\n              <Select>\n                <SelectTrigger className=\"shadow-sm h-9 text-xs\">\n                  <SelectValue placeholder=\"é¸æ“‡ä»˜æ¬¾æ–¹å¼\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"cash\">ç¾é‡‘</SelectItem>\n                  <SelectItem value=\"transfer\">è½‰å¸³</SelectItem>\n                  <SelectItem value=\"card\">ä¿¡ç”¨å¡</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">æ”¶æ¬¾æ—¥æœŸ</label>\n              <Input placeholder=\"é¸æ“‡æ—¥æœŸ\" type=\"date\" className=\"shadow-sm h-9 text-xs\" />\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">å‚™è¨»</label>\n              <Textarea placeholder=\"è£œå……èªªæ˜ï¼ˆé¸å¡«ï¼‰\" rows={2} className=\"shadow-sm text-xs\" />\n            </div>\n            <Button className=\"w-full bg-morandi-gold hover:bg-morandi-gold/90 shadow-md mt-1 h-9 text-xs\">\n              <Receipt size={14} className=\"mr-1.5\" />\n              å»ºç«‹æ”¶æ¬¾å–®\n            </Button>\n          </div>\n        </div>\n      );\n\n    case 'invoice':\n      return (\n        <div className=\"space-y-4\">\n          <h5 className=\"font-medium text-morandi-primary\">å¿«é€Ÿè«‹æ¬¾</h5>\n          <div className=\"space-y-3\">\n            <Select>\n              <SelectTrigger>\n                <SelectValue placeholder=\"é¸æ“‡ä¾›æ‡‰å•†\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"hotel1\">æ¸…é‚å‡æ—¥é…’åº—</SelectItem>\n                <SelectItem value=\"transport1\">æ¸…é‚åŒ…è»Šæœå‹™</SelectItem>\n              </SelectContent>\n            </Select>\n            <Input placeholder=\"è«‹æ¬¾é …ç›®\" />\n            <Input placeholder=\"é‡‘é¡\" type=\"number\" />\n            <Select>\n              <SelectTrigger>\n                <SelectValue placeholder=\"é¡åˆ¥\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"accommodation\">ä½å®¿</SelectItem>\n                <SelectItem value=\"transport\">äº¤é€š</SelectItem>\n                <SelectItem value=\"meals\">é¤é£Ÿ</SelectItem>\n                <SelectItem value=\"tickets\">é–€ç¥¨</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button className=\"w-full\">å»ºç«‹è«‹æ¬¾å–®</Button>\n          </div>\n        </div>\n      );\n\n    case 'group':\n      return (\n        <div className=\"space-y-4\">\n          <h5 className=\"font-medium text-morandi-primary\">å¿«é€Ÿé–‹åœ˜</h5>\n          <div className=\"space-y-3\">\n            <Input placeholder=\"åœ˜å\" />\n            <Input placeholder=\"é è¨ˆäººæ•¸\" type=\"number\" />\n            <Input placeholder=\"å‡ºç™¼æ—¥æœŸ\" type=\"date\" />\n            <Input placeholder=\"è¿”å›æ—¥æœŸ\" type=\"date\" />\n            <Select>\n              <SelectTrigger>\n                <SelectValue placeholder=\"åœ˜é«”ç‹€æ…‹\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"planning\">ç±Œå‚™ä¸­</SelectItem>\n                <SelectItem value=\"confirmed\">ç¢ºèªæˆåœ˜</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button className=\"w-full\">å»ºç«‹æ—…éŠåœ˜</Button>\n          </div>\n        </div>\n      );\n\n    case 'quote':\n      return (\n        <div className=\"space-y-4\">\n          <h5 className=\"font-medium text-morandi-primary\">å¿«é€Ÿå ±åƒ¹</h5>\n          <div className=\"space-y-3\">\n            <Input placeholder=\"å®¢æˆ¶åç¨±\" />\n            <Input placeholder=\"è¯çµ¡äºº\" />\n            <Input placeholder=\"è¯çµ¡é›»è©±\" />\n            <Input placeholder=\"Email\" type=\"email\" />\n            <Input placeholder=\"äººæ•¸\" type=\"number\" />\n            <Textarea placeholder=\"éœ€æ±‚èªªæ˜\" rows={3} />\n            <Input placeholder=\"é ç®—ç¯„åœ\" />\n            <Input placeholder=\"å ±åƒ¹æœ‰æ•ˆæœŸ\" type=\"date\" />\n            <Button className=\"w-full\">å»ºç«‹å ±åƒ¹å–®</Button>\n          </div>\n        </div>\n      );\n\n    case 'share':\n      return (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-2 pb-3 border-b border-morandi-container/20\">\n            <div className=\"p-1.5 bg-morandi-gold/10 rounded-lg\">\n              <UserPlus size={16} className=\"text-morandi-gold\" />\n            </div>\n            <div>\n              <h5 className=\"text-sm font-semibold text-morandi-primary\">å…±äº«å¾…è¾¦</h5>\n              <p className=\"text-xs text-morandi-secondary\">åˆ†äº«é€™å€‹ä»»å‹™çµ¦åœ˜éšŠæˆå“¡</p>\n            </div>\n          </div>\n          <div className=\"space-y-3\">\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">å…±äº«çµ¦</label>\n              <Select>\n                <SelectTrigger className=\"shadow-sm h-9 text-xs\">\n                  <SelectValue placeholder=\"é¸æ“‡æˆå“¡\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {otherEmployees.length > 0 ? (\n                    otherEmployees.map((emp) => (\n                      <SelectItem key={emp.id} value={emp.id}>\n                        {emp.display_name || emp.english_name}\n                      </SelectItem>\n                    ))\n                  ) : (\n                    <SelectItem value=\"none\" disabled>\n                      å°šç„¡å…¶ä»–å“¡å·¥\n                    </SelectItem>\n                  )}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">æ¬Šé™</label>\n              <Select>\n                <SelectTrigger className=\"shadow-sm h-9 text-xs\">\n                  <SelectValue placeholder=\"é¸æ“‡æ¬Šé™\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"view\">åƒ…æª¢è¦–</SelectItem>\n                  <SelectItem value=\"edit\">å¯ç·¨è¼¯</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label className=\"block text-xs font-medium text-morandi-primary mb-1\">è¨Šæ¯ï¼ˆé¸å¡«ï¼‰</label>\n              <Textarea placeholder=\"çµ¦æˆå“¡çš„è¨Šæ¯...\" rows={2} className=\"shadow-sm text-xs\" />\n            </div>\n            <Button className=\"w-full bg-morandi-gold hover:bg-morandi-gold/90 shadow-md h-9 text-xs\">\n              <UserPlus size={14} className=\"mr-1.5\" />\n              å…±äº«å¾…è¾¦\n            </Button>\n          </div>\n        </div>\n      );\n\n    default:\n      return null;\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/room-allocation.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1360,1363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1360,1363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1483,1486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1483,1486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1528,1531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1528,1531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'generateRoomOptions'. Either include it or remove the dependency array.","line":94,"column":6,"nodeType":"ArrayExpression","endLine":94,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [tour.id, paymentRequests, tourMembers, generateRoomOptions]","fix":{"range":[3148,3187],"text":"[tour.id, paymentRequests, tourMembers, generateRoomOptions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Tour, Member } from '@/stores/types';\nimport { useOrderStore, useMemberStore, usePaymentRequestStore } from '@/stores';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { cn } from '@/lib/utils';\nimport { Bed, Users, AlertTriangle, Home } from 'lucide-react';\n\ninterface RoomAllocationProps {\n  tour: Tour;\n}\n\ninterface RoomOption {\n  value: string;\n  label: string;\n  room_type: string;\n  capacity: number;\n  currentCount: number;\n}\n\ninterface MemberWithRoom extends Member {\n  assignedRoom?: string;\n}\n\nexport function RoomAllocation({ tour }: RoomAllocationProps) {\n  const { items: orders } = useOrderStore();\n  const { items: members } = useMemberStore();\n  const { items: paymentRequests } = usePaymentRequestStore();\n  const [roomOptions, setRoomOptions] = useState<RoomOption[]>([]);\n  const [membersWithRooms, setMembersWithRooms] = useState<MemberWithRoom[]>([]);\n\n  // ç²å–å±¬æ–¼é€™å€‹æ—…éŠåœ˜çš„æ‰€æœ‰è¨‚å–®å’Œåœ˜å“¡\n  const tourOrders = orders.filter(order => order.tour_id === tour.id);\n  const tourMembers = members.filter(member =>\n    tourOrders.some(order => order.id === member.order_id)\n  );\n\n  // å¾è«‹æ¬¾å–®è§£ææˆ¿é–“é…é¡ï¼Œç”Ÿæˆæˆ¿é–“é¸é …\n  const generateRoomOptions = (): RoomOption[] => {\n    const tourPaymentRequests = paymentRequests.filter((request: any) => request.tour_id === tour.id);\n    const roomOptions: RoomOption[] = [];\n\n    tourPaymentRequests.forEach((request: any) => {\n      request.items.forEach((item: any) => {\n        if (item.category === 'ä½å®¿' && item.description) {\n          // è§£ææˆ¿å‹å’Œæ•¸é‡ï¼ˆä¾‹å¦‚ï¼šé›™äººæˆ¿ x5, ä¸‰äººæˆ¿ x2ï¼‰\n          const roomMatches = item.description.match(/(\\S+æˆ¿)\\s*[xÃ—]\\s*(\\d+)/g);\n          if (roomMatches) {\n            roomMatches.forEach((match: any) => {\n              const matchResult = match.match(/(\\S+æˆ¿)\\s*[xÃ—]\\s*(\\d+)/);\n              if (matchResult) {\n                const [, room_type, quantity] = matchResult;\n                if (room_type && quantity) {\n                  const capacity = getRoomCapacity(room_type);\n                  const roomCount = parseInt(quantity);\n\n                  // ç”Ÿæˆå…·é«”æˆ¿é–“é¸é …ï¼ˆå¦‚ï¼šé›™äººæˆ¿-1ã€é›™äººæˆ¿-2...ï¼‰\n                  for (let i = 1; i <= roomCount; i++) {\n                    roomOptions.push({\n                      value: `${room_type}-${i}`,\n                      label: `${room_type}-${i}`,\n                      room_type,\n                      capacity,\n                      currentCount: 0\n                    });\n                  }\n                }\n              }\n            });\n          }\n        }\n      });\n    });\n\n    return roomOptions;\n  };\n\n  // æ ¹æ“šæˆ¿å‹åç¨±æ¨ç®—å®¹é‡\n  const getRoomCapacity = (room_type: string): number => {\n    if (room_type.includes('å–®äºº')) return 1;\n    if (room_type.includes('é›™äºº')) return 2;\n    if (room_type.includes('ä¸‰äºº')) return 3;\n    if (room_type.includes('å››äºº')) return 4;\n    return 2; // é è¨­é›™äººæˆ¿\n  };\n\n  // åˆå§‹åŒ–è³‡æ–™\n  useEffect(() => {\n    const rooms = generateRoomOptions();\n    setRoomOptions(rooms);\n    // ä¿ç•™ members ä¸­åŸæœ‰çš„ assignedRoom æ•¸æ“š\n    setMembersWithRooms(tourMembers.map(member => ({ ...member } as MemberWithRoom)));\n  }, [tour.id, paymentRequests, tourMembers]);\n\n  // åˆ†é…æˆ¿é–“\n  const assignMemberToRoom = (member_id: string, roomValue: string) => {\n    setMembersWithRooms(prev =>\n      prev.map(member =>\n        member.id === member_id\n          ? { ...member, assignedRoom: roomValue || undefined }\n          : member\n      )\n    );\n\n    // æ›´æ–°æˆ¿é–“ä½¿ç”¨æƒ…æ³\n    updateRoomCounts();\n  };\n\n  // æ›´æ–°æˆ¿é–“ä½¿ç”¨äººæ•¸\n  const updateRoomCounts = () => {\n    setRoomOptions(prev =>\n      prev.map(room => ({\n        ...room,\n        currentCount: membersWithRooms.filter(member => member.assignedRoom === room.value).length\n      }))\n    );\n  };\n\n  // çµ±è¨ˆè³‡æ–™\n  const totalRooms = roomOptions.length;\n  const assignedCount = membersWithRooms.filter(member => member.assignedRoom).length;\n  const unassignedCount = membersWithRooms.length - assignedCount;\n  const totalCapacity = roomOptions.reduce((sum, room) => sum + room.capacity, 0);\n\n  // æª¢æŸ¥æˆ¿é–“æ˜¯å¦å·²æ»¿\n  const isRoomFull = (roomValue: string) => {\n    const room = roomOptions.find(r => r.value === roomValue);\n    if (!room) return false;\n    const currentOccupancy = membersWithRooms.filter(m => m.assignedRoom === roomValue).length;\n    return currentOccupancy >= room.capacity;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* æˆ¿é–“é…é¡ç¸½è¦½ */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <div className=\"bg-card border border-border p-4 rounded-lg text-center\">\n          <Home size={24} className=\"mx-auto mb-2 text-morandi-gold\" />\n          <div className=\"text-xl font-bold text-morandi-primary\">{totalRooms}</div>\n          <div className=\"text-sm text-morandi-secondary\">ç¸½æˆ¿é–“æ•¸</div>\n        </div>\n\n        <div className=\"bg-card border border-border p-4 rounded-lg text-center\">\n          <Bed size={24} className=\"mx-auto mb-2 text-morandi-primary\" />\n          <div className=\"text-xl font-bold text-morandi-primary\">{totalCapacity}</div>\n          <div className=\"text-sm text-morandi-secondary\">ç¸½åºŠä½æ•¸</div>\n        </div>\n\n        <div className=\"bg-card border border-border p-4 rounded-lg text-center\">\n          <Users size={24} className=\"mx-auto mb-2 text-morandi-green\" />\n          <div className=\"text-xl font-bold text-morandi-primary\">{assignedCount}</div>\n          <div className=\"text-sm text-morandi-secondary\">å·²åˆ†æˆ¿</div>\n        </div>\n\n        <div className=\"bg-card border border-border p-4 rounded-lg text-center\">\n          <AlertTriangle size={24} className=\"mx-auto mb-2 text-morandi-red\" />\n          <div className=\"text-xl font-bold text-morandi-primary\">{unassignedCount}</div>\n          <div className=\"text-sm text-morandi-secondary\">æœªåˆ†æˆ¿</div>\n        </div>\n      </div>\n\n      {/* åœ˜å“¡åˆ†æˆ¿è¡¨æ ¼ */}\n      <div className=\"bg-card border border-border rounded-lg overflow-hidden\">\n        <div className=\"w-full overflow-x-auto\">\n          <table className=\"w-full text-sm border-collapse\">\n            <thead className=\"bg-morandi-container/30\">\n              <tr>\n                <th className=\"w-[40px] py-3 px-4 text-left text-xs font-medium text-morandi-secondary border border-gray-300\">åºè™Ÿ</th>\n                <th className=\"min-w-[80px] py-3 px-4 text-left text-xs font-medium text-morandi-secondary border border-gray-300\">å§“å</th>\n                <th className=\"min-w-[80px] py-3 px-4 text-left text-xs font-medium text-morandi-secondary border border-gray-300\">æ€§åˆ¥</th>\n                <th className=\"min-w-[60px] py-3 px-4 text-left text-xs font-medium text-morandi-secondary border border-gray-300\">å¹´é½¡</th>\n                <th className=\"min-w-[120px] py-3 px-4 text-left text-xs font-medium text-morandi-secondary border border-gray-300\">åˆ†æˆ¿</th>\n                <th className=\"min-w-[80px] py-3 px-4 text-left text-xs font-medium text-morandi-secondary border border-gray-300\">ç‹€æ…‹</th>\n              </tr>\n            </thead>\n            <tbody>\n              {membersWithRooms.map((member, index) => {\n                const assignedRoom = member.assignedRoom;\n                const roomIsFull = assignedRoom && isRoomFull(assignedRoom);\n\n                return (\n                  <tr key={member.id} className=\"hover:bg-morandi-container/10\">\n                    <td className=\"py-3 px-4 text-center border border-gray-300\">\n                      {index + 1}\n                    </td>\n                    <td className=\"py-3 px-4 font-medium text-morandi-primary border border-gray-300\">\n                      {member.name}\n                    </td>\n                    <td className=\"py-3 px-4 text-morandi-secondary border border-gray-300\">\n                      {member.gender === 'M' ? 'ç”·' : member.gender === 'F' ? 'å¥³' : '-'}\n                    </td>\n                    <td className=\"py-3 px-4 text-morandi-secondary border border-gray-300\">\n                      {member.age > 0 ? `${member.age}æ­²` : '-'}\n                    </td>\n                    <td className=\"py-3 px-4 border border-gray-300\">\n                      <Select\n                        value={member.assignedRoom || ''}\n                        onValueChange={(value) => assignMemberToRoom(member.id, value)}\n                      >\n                        <SelectTrigger className=\"w-full h-8\">\n                          <SelectValue placeholder=\"é¸æ“‡æˆ¿é–“\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"\">æœªåˆ†é…</SelectItem>\n                          {roomOptions.map(room => {\n                            const isFull = isRoomFull(room.value);\n                            const isCurrentRoom = member.assignedRoom === room.value;\n\n                            return (\n                              <SelectItem\n                                key={room.value}\n                                value={room.value}\n                                disabled={isFull && !isCurrentRoom}\n                                className={cn(\n                                  isFull && !isCurrentRoom && \"text-gray-400\"\n                                )}\n                              >\n                                {room.label} ({room.currentCount}/{room.capacity})\n                                {isFull && !isCurrentRoom && \" - å·²æ»¿\"}\n                              </SelectItem>\n                            );\n                          })}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"py-3 px-4 border border-gray-300\">\n                      {assignedRoom ? (\n                        <span className={cn(\n                          \"inline-flex items-center px-2 py-1 rounded text-xs font-medium\",\n                          roomIsFull\n                            ? \"bg-morandi-red text-white\"\n                            : \"bg-morandi-green text-white\"\n                        )}>\n                          {roomIsFull ? \"å·²æ»¿æˆ¿\" : \"å·²åˆ†æˆ¿\"}\n                        </span>\n                      ) : (\n                        <span className=\"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-morandi-container text-morandi-secondary\">\n                          æœªåˆ†æˆ¿\n                        </span>\n                      )}\n                    </td>\n                  </tr>\n                );\n              })}\n\n              {membersWithRooms.length === 0 && (\n                <tr>\n                  <td colSpan={6} className=\"py-12 text-center text-morandi-secondary\">\n                    <Users size={32} className=\"mx-auto mb-4 opacity-50\" />\n                    <p>å°šç„¡åœ˜å“¡è³‡æ–™</p>\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* æˆ¿é–“ä½¿ç”¨ç‹€æ³ */}\n      {roomOptions.length > 0 && (\n        <div>\n          <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æˆ¿é–“ä½¿ç”¨ç‹€æ³</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\n            {roomOptions.map(room => {\n              const occupants = membersWithRooms.filter(m => m.assignedRoom === room.value);\n              const isFull = occupants.length >= room.capacity;\n\n              return (\n                <div key={room.value} className={cn(\n                  \"bg-card border rounded-lg p-4\",\n                  isFull ? \"border-morandi-red\" : \"border-border\"\n                )}>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <h4 className=\"font-medium text-morandi-primary\">{room.label}</h4>\n                    <span className={cn(\n                      \"text-xs px-2 py-1 rounded\",\n                      isFull\n                        ? \"bg-morandi-red text-white\"\n                        : \"bg-morandi-container text-morandi-secondary\"\n                    )}>\n                      {occupants.length}/{room.capacity}\n                    </span>\n                  </div>\n\n                  <div className=\"space-y-1\">\n                    {occupants.map(member => (\n                      <div key={member.id} className=\"text-sm text-morandi-primary\">\n                        â€¢ {member.name}\n                      </div>\n                    ))}\n\n                    {occupants.length === 0 && (\n                      <div className=\"text-sm text-morandi-secondary\">ç©ºæˆ¿</div>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {roomOptions.length === 0 && (\n        <div className=\"text-center py-12 text-morandi-secondary\">\n          <Bed size={24} className=\"mx-auto mb-4 opacity-50\" />\n          <p>å°šæœªæ‰¾åˆ°ä½å®¿é…é¡</p>\n          <p className=\"text-sm mt-2\">è«‹æª¢æŸ¥è©²æ—…éŠåœ˜æ˜¯å¦æœ‰ä½å®¿ç›¸é—œçš„è«‹æ¬¾å–®</p>\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-add-ons.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1074,1077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1074,1077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1595,1598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1595,1598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5347,5350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5347,5350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { Tour } from '@/stores/types';\nimport { useTourAddOnStore } from '@/stores';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Plus, Trash2, ShoppingCart } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface TourAddOnsProps {\n  tour: Tour;\n  triggerAdd?: boolean;\n  onTriggerAddComplete?: () => void;\n}\n\nexport const TourAddOns = React.memo(function TourAddOns({ tour, triggerAdd, onTriggerAddComplete }: TourAddOnsProps) {\n  const { items: tour_add_ons, create: addTourAddOn, update: updateTourAddOn, delete: deleteTourAddOn } = useTourAddOnStore();\n  const [isAddingNew, setIsAddingNew] = useState(false);\n  const [newAddOn, setNewAddOn] = useState({\n    name: '',\n    price: 0,\n    description: ''\n  });\n\n  // ç›£è½å¤–éƒ¨è§¸ç™¼æ–°å¢\n  React.useEffect(() => {\n    if (triggerAdd) {\n      setIsAddingNew(true);\n      onTriggerAddComplete?.();\n    }\n  }, [triggerAdd, onTriggerAddComplete]);\n\n  // ç²å–æ­¤æ—…éŠåœ˜çš„åŠ è³¼é …ç›®\n  const addOns = tour_add_ons.filter((addOn: any) => addOn.tour_id === tour.id);\n\n  const handleAddNew = () => {\n    if (!newAddOn.name.trim()) return;\n\n    addTourAddOn({\n      tour_id: tour.id,\n      name: newAddOn.name,\n      price: newAddOn.price,\n      description: newAddOn.description,\n      is_active: true,\n    });\n\n    setNewAddOn({ name: '', price: 0, description: '' });\n    setIsAddingNew(false);\n  };\n\n  const handleDelete = (id: string) => {\n    deleteTourAddOn(id);\n  };\n\n  const toggleActive = (id: string) => {\n    const addOn = addOns.find((item: any) => item.id === id);\n    if (addOn) {\n      updateTourAddOn(id, { is_active: !addOn.is_active });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n\n      {/* åŠ è³¼é …ç›®åˆ—è¡¨ */}\n      <div className=\"border border-border rounded-lg overflow-hidden\">\n        {addOns.length === 0 && !isAddingNew ? (\n          <div className=\"text-center py-12 text-morandi-secondary\">\n            <ShoppingCart size={24} className=\"mx-auto mb-4 opacity-50\" />\n            <p>å°šæœªè¨­å®šä»»ä½•åŠ è³¼é …ç›®</p>\n            <p className=\"text-sm mt-1\">é»æ“Šã€Œæ–°å¢åŠ è³¼é …ç›®ã€é–‹å§‹å»ºç«‹</p>\n          </div>\n        ) : (\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full\">\n              <thead className=\"bg-morandi-container/30\">\n                <tr>\n                  <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">é …ç›®åç¨±</th>\n                  <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">åƒ¹æ ¼</th>\n                  <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">èªªæ˜</th>\n                  <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary\">ç‹€æ…‹</th>\n                  <th className=\"text-center py-3 px-4 text-sm font-medium text-morandi-secondary\">æ“ä½œ</th>\n                </tr>\n              </thead>\n              <tbody>\n                {/* æ–°å¢è¡¨å–®è¡Œ */}\n                {isAddingNew && (\n                  <tr className=\"border-b border-border bg-morandi-gold/10\">\n                    <td className=\"py-3 px-4\">\n                      <Input\n                        value={newAddOn.name}\n                        onChange={(e) => setNewAddOn({...newAddOn, name: e.target.value})}\n                        placeholder=\"é …ç›®åç¨±\"\n                        className=\"h-8\"\n                        autoFocus\n                      />\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <Input\n                        type=\"number\"\n                        value={newAddOn.price}\n                        onChange={(e) => setNewAddOn({...newAddOn, price: Number(e.target.value)})}\n                        placeholder=\"åƒ¹æ ¼\"\n                        className=\"h-8\"\n                      />\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <Input\n                        value={newAddOn.description}\n                        onChange={(e) => setNewAddOn({...newAddOn, description: e.target.value})}\n                        placeholder=\"èªªæ˜ï¼ˆé¸å¡«ï¼‰\"\n                        className=\"h-8\"\n                      />\n                    </td>\n                    <td className=\"py-3 px-4 text-center\">\n                      <span className=\"text-morandi-green text-sm\">å•Ÿç”¨</span>\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <div className=\"flex justify-center space-x-2\">\n                        <Button\n                          onClick={handleAddNew}\n                          size=\"sm\"\n                          className=\"bg-morandi-green hover:bg-morandi-green-hover text-white\"\n                        >\n                          ç¢ºå®š\n                        </Button>\n                        <Button\n                          onClick={() => {\n                            setIsAddingNew(false);\n                            setNewAddOn({ name: '', price: 0, description: '' });\n                          }}\n                          size=\"sm\"\n                          variant=\"ghost\"\n                        >\n                          å–æ¶ˆ\n                        </Button>\n                      </div>\n                    </td>\n                  </tr>\n                )}\n\n                {/* ç¾æœ‰é …ç›®åˆ—è¡¨ */}\n                {addOns.map((addOn: any) => (\n                  <tr key={addOn.id} className=\"border-b border-border\">\n                    <td className=\"py-3 px-4 font-medium text-morandi-primary\">\n                      {addOn.name}\n                    </td>\n                    <td className=\"py-3 px-4 text-morandi-primary\">\n                      NT$ {addOn.price.toLocaleString()}\n                    </td>\n                    <td className=\"py-3 px-4 text-morandi-secondary text-sm\">\n                      {addOn.description || 'ç„¡'}\n                    </td>\n                    <td className=\"py-3 px-4 text-center\">\n                      <button\n                        onClick={() => toggleActive(addOn.id)}\n                        className={cn(\n                          'px-2 py-1 rounded text-xs font-medium cursor-pointer',\n                          addOn.is_active\n                            ? 'bg-morandi-green text-white'\n                            : 'bg-morandi-container text-morandi-secondary'\n                        )}\n                      >\n                        {addOn.is_active ? 'å•Ÿç”¨' : 'åœç”¨'}\n                      </button>\n                    </td>\n                    <td className=\"py-3 px-4\">\n                      <div className=\"flex justify-center\">\n                        <Button\n                          onClick={() => handleDelete(addOn.id)}\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          className=\"text-morandi-red hover:text-morandi-red hover:bg-morandi-red/10\"\n                        >\n                          <Trash2 size={14} />\n                        </Button>\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </div>\n\n      {/* ä½¿ç”¨èªªæ˜ */}\n      <div className=\"bg-morandi-container/20 p-4 rounded-lg\">\n        <h4 className=\"text-sm font-medium text-morandi-primary mb-2\">ä½¿ç”¨èªªæ˜</h4>\n        <ul className=\"text-xs text-morandi-secondary space-y-1\">\n          <li>â€¢ åŠ è³¼é …ç›®å¯ä¾›åœ˜å“¡åœ¨è¨‚å–®ä¸­é¸æ“‡è³¼è²·</li>\n          <li>â€¢ åœç”¨çš„é …ç›®ä¸æœƒé¡¯ç¤ºçµ¦åœ˜å“¡é¸æ“‡ï¼Œä½†å·²è³¼è²·çš„ä»ç„¶æœ‰æ•ˆ</li>\n          <li>â€¢ åƒ¹æ ¼ä¿®æ”¹ä¸æœƒå½±éŸ¿å·²å»ºç«‹çš„è¨‚å–®</li>\n          <li>â€¢ å»ºè­°åœ¨åœ˜çµ„ç¢ºå®šå‰å®Œæˆæ‰€æœ‰åŠ è³¼é …ç›®è¨­å®š</li>\n        </ul>\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-costs.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[779,782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[779,782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[861,864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[861,864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tourCosts' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":32,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2186,2189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2186,2189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5372,5375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5372,5375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":202,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7258,7261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7258,7261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7350,7353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7350,7353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8780,8783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8780,8783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Tour } from '@/stores/types';\nimport { useOrderStore } from '@/stores';\n// TODO: usePaymentStore deprecated\nimport { Receipt, Calendar, FileText, Plus, Truck, Hotel, Utensils, MapPin } from 'lucide-react';\n\ninterface TourCostsProps {\n  tour: Tour;\n  orderFilter?: string; // é¸å¡«ï¼šåªé¡¯ç¤ºç‰¹å®šè¨‚å–®ç›¸é—œçš„æˆæœ¬\n}\n\nexport const TourCosts = React.memo(function TourCosts({ tour, orderFilter }: TourCostsProps) {\n  const { items: orders } = useOrderStore();\n  const payments: any[] = []; // TODO: usePaymentStore deprecated\n  const addPayment = async (data: any) => { console.warn(\"addPayment not implemented\"); };\n// TODO: usePaymentStore deprecated -   const { items: payments, create: addPayment } = usePaymentStore();\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [newCost, setNewCost] = useState({\n    amount: 0,\n    description: '',\n    category: 'transport',\n    status: 'å¾…ç¢ºèª' as const,\n    vendor: ''\n  });\n\n  const tourCosts = payments.filter(payment => {\n    if (payment.type !== 'è«‹æ¬¾') return false;\n\n    if (orderFilter) {\n      return payment.order_id === orderFilter;\n    }\n\n    return payment.tour_id === tour.id;\n  });\n\n  const handleAddCost = () => {\n    if (!newCost.amount || !newCost.description) return;\n\n    addPayment({\n      type: 'è«‹æ¬¾',\n      tour_id: tour.id,\n      ...newCost\n    });\n\n    setNewCost({\n      amount: 0,\n      description: '',\n      category: 'transport',\n      status: 'å¾…ç¢ºèª',\n      vendor: ''\n    });\n    setIsAddDialogOpen(false);\n  };\n\n  // ç²å–å±¬æ–¼é€™å€‹æ—…éŠåœ˜çš„æ‰€æœ‰è¨‚å–®\n  const tourOrders = orders.filter(order => order.tour_id === tour.id);\n\n  // ç²å–æ‰€æœ‰ç›¸é—œçš„æˆæœ¬æ”¯å‡ºè¨˜éŒ„\n  const costPayments = payments.filter(payment =>\n    payment.type === 'è«‹æ¬¾' &&\n    (payment.tour_id === tour.id ||\n     tourOrders.some(order => order.id === payment.order_id))\n  );\n\n  const getCategoryIcon = (category: string) => {\n    const icons: Record<string, any> = {\n      'transport': Truck,\n      'accommodation': Hotel,\n      'food': Utensils,\n      'attraction': MapPin,\n      'äº¤é€š': Truck,\n      'ä½å®¿': Hotel,\n      'é¤é£Ÿ': Utensils,\n      'æ™¯é»': MapPin\n    };\n    return icons[category] || Receipt;\n  };\n\n  const getCategoryDisplayName = (category: string) => {\n    const names: Record<string, string> = {\n      'transport': 'äº¤é€š',\n      'accommodation': 'ä½å®¿',\n      'food': 'é¤é£Ÿ',\n      'attraction': 'æ™¯é»',\n      'other': 'å…¶ä»–'\n    };\n    return names[category] || category;\n  };\n\n  const getStatusBadge = (status: string) => {\n    const badges: Record<string, string> = {\n      'å·²ç¢ºèª': 'bg-morandi-green text-white',\n      'å¾…ç¢ºèª': 'bg-morandi-gold text-white',\n      'å·²ä»˜æ¬¾': 'bg-morandi-container text-morandi-secondary'\n    };\n    return badges[status] || 'bg-morandi-container text-morandi-secondary';\n  };\n\n  const getReceiptBadge = (receipt: string) => {\n    return receipt === 'å·²ä¸Šå‚³'\n      ? 'bg-morandi-green text-white'\n      : 'bg-morandi-red text-white';\n  };\n\n  const totalCosts = costPayments.reduce((sum, cost) => sum + cost.amount, 0);\n  const confirmedCosts = costPayments.filter(cost => cost.status === 'å·²ç¢ºèª').reduce((sum, cost) => sum + cost.amount, 0);\n  const pendingCosts = costPayments.filter(cost => cost.status === 'å¾…ç¢ºèª').reduce((sum, cost) => sum + cost.amount, 0);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* æˆæœ¬çµ±è¨ˆ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æˆæœ¬æ¦‚æ³</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              NT$ {totalCosts.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">ç¸½æˆæœ¬</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-green\">\n              NT$ {confirmedCosts.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å·²ç¢ºèª</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-gold\">\n              NT$ {pendingCosts.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å¾…ç¢ºèª</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-red\">\n              NT$ {Math.max(0, tour.total_revenue - totalCosts).toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">é ä¼°åˆ©æ½¤</div>\n          </div>\n        </div>\n      </ContentContainer>\n\n      {/* åˆ†é¡çµ±è¨ˆ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æˆæœ¬åˆ†é¡</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4\">\n          {['transport', 'accommodation', 'food', 'attraction', 'other'].map((category) => {\n            const categoryTotal = costPayments\n              .filter(cost => (cost as any).category === category)\n              .reduce((sum, cost) => sum + cost.amount, 0);\n            const Icon = getCategoryIcon(category);\n            const displayName = getCategoryDisplayName(category);\n\n            return (\n              <div key={category} className=\"bg-card border border-border p-4 rounded-lg\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <Icon size={20} className=\"text-morandi-gold\" />\n                  <div className=\"text-lg font-bold text-morandi-primary\">\n                    NT$ {categoryTotal.toLocaleString()}\n                  </div>\n                </div>\n                <div className=\"text-sm text-morandi-secondary\">{displayName}</div>\n              </div>\n            );\n          })}\n        </div>\n      </ContentContainer>\n\n      {/* æ–°å¢æ”¯å‡ºæŒ‰éˆ• - å³ä¸Šè§’ */}\n      <div className=\"flex justify-end mb-6\">\n        <Button\n          onClick={() => setIsAddDialogOpen(true)}\n          className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n        >\n          <Plus size={16} className=\"mr-2\" />\n          æ–°å¢æ”¯å‡º\n        </Button>\n      </div>\n\n      {/* æˆæœ¬åˆ—è¡¨ */}\n      <ContentContainer>\n        <div className=\"space-y-4\">\n          {/* è¡¨æ ¼æ¨™é ­ */}\n          <div className=\"grid grid-cols-12 gap-4 p-4 bg-morandi-container rounded-lg text-sm font-medium text-morandi-secondary\">\n            <div className=\"col-span-2\">æ—¥æœŸ</div>\n            <div className=\"col-span-2\">é‡‘é¡</div>\n            <div className=\"col-span-2\">é¡åˆ¥</div>\n            <div className=\"col-span-2\">èªªæ˜</div>\n            <div className=\"col-span-2\">ä¾›æ‡‰å•†</div>\n            <div className=\"col-span-1\">æ”¶æ“š</div>\n            <div className=\"col-span-1\">ç‹€æ…‹</div>\n          </div>\n\n          {/* æˆæœ¬é …ç›® */}\n          <div className=\"space-y-2\">\n            {costPayments.map((cost) => {\n              const Icon = getCategoryIcon((cost as any).category || '');\n              const displayCategory = getCategoryDisplayName((cost as any).category || '');\n              const relatedOrder = tourOrders.find(order => order.id === cost.order_id);\n\n              return (\n                <div key={cost.id} className=\"grid grid-cols-12 gap-4 p-4 bg-card border border-border rounded-lg\">\n                  <div className=\"col-span-2\">\n                    <div className=\"flex items-center text-sm text-morandi-primary\">\n                      <Calendar size={14} className=\"mr-1\" />\n                      {new Date(cost.created_at).toLocaleDateString()}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <div className=\"font-medium text-morandi-red\">\n                      NT$ {cost.amount.toLocaleString()}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <div className=\"flex items-center text-sm text-morandi-primary\">\n                      <Icon size={14} className=\"mr-1\" />\n                      {displayCategory}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <div className=\"text-sm text-morandi-primary\">\n                      {cost.description}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-2\">\n                    <div className=\"text-sm text-morandi-primary\">\n                      {(cost as any).vendor || relatedOrder?.order_number || '-'}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-1\">\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getReceiptBadge('å¾…ä¸Šå‚³')}`}>\n                      å¾…ä¸Šå‚³\n                    </span>\n                  </div>\n\n                  <div className=\"col-span-1\">\n                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadge(cost.status)}`}>\n                      {cost.status}\n                    </span>\n                  </div>\n                </div>\n              );\n            })}\n\n            {costPayments.length === 0 && (\n              <div className=\"text-center py-12 text-morandi-secondary\">\n                <Receipt size={24} className=\"mx-auto mb-4 opacity-50\" />\n                <p>å°šç„¡æˆæœ¬æ”¯å‡ºè¨˜éŒ„</p>\n                <p className=\"text-sm mt-1\">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢æ”¯å‡ºã€æŒ‰éˆ•é–‹å§‹è¨˜éŒ„æˆæœ¬</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </ContentContainer>\n\n      {/* æ–°å¢æˆæœ¬å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢æˆæœ¬æ”¯å‡º</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ”¯å‡ºé‡‘é¡</label>\n              <Input\n                type=\"number\"\n                value={newCost.amount}\n                onChange={(e) => setNewCost(prev => ({ ...prev, amount: Number(e.target.value) }))}\n                placeholder=\"0\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ”¯å‡ºèªªæ˜</label>\n              <Input\n                value={newCost.description}\n                onChange={(e) => setNewCost(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"ä¾‹ï¼šæ©Ÿç¥¨è²»ç”¨\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">é¡åˆ¥</label>\n              <select\n                value={newCost.category}\n                onChange={(e) => setNewCost(prev => ({ ...prev, category: e.target.value }))}\n                className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n              >\n                <option value=\"transport\">äº¤é€š</option>\n                <option value=\"accommodation\">ä½å®¿</option>\n                <option value=\"food\">é¤é£Ÿ</option>\n                <option value=\"attraction\">æ™¯é»</option>\n                <option value=\"other\">å…¶ä»–</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">ä¾›æ‡‰å•†</label>\n              <Input\n                value={newCost.vendor}\n                onChange={(e) => setNewCost(prev => ({ ...prev, vendor: e.target.value }))}\n                placeholder=\"ä¾›æ‡‰å•†åç¨±\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsAddDialogOpen(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleAddCost}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-documents.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tour' is defined but never used. Allowed unused args must match /^_/u.","line":16,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2590,2593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2590,2593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { ContentContainer } from '@/components/layout/content-container';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Tour } from '@/stores/types';\nimport { FileText, Upload, Download, Eye, CheckCircle, AlertCircle, Clock, Plus } from 'lucide-react';\n\ninterface TourDocumentsProps {\n  tour: Tour;\n  orderFilter?: string; // é¸å¡«ï¼šåªé¡¯ç¤ºç‰¹å®šè¨‚å–®çš„æ–‡ä»¶\n}\n\nexport function TourDocuments({ tour, orderFilter }: TourDocumentsProps) {\n  const [isUploadDialogOpen, setIsUploadDialogOpen] = useState(false);\n  const [newDocument, setNewDocument] = useState({\n    name: '',\n    type: 'contract',\n    description: ''\n  });\n\n  // æ¨¡æ“¬æ–‡ä»¶è³‡æ–™ï¼ˆå¯¦éš›ä½¿ç”¨æ™‚æœƒå¾ store å–å¾—ï¼‰\n  const allMockDocuments = [\n    {\n      id: '1',\n      name: 'æ—…éŠåˆç´„æ›¸',\n      type: 'åˆç´„',\n      status: 'å·²ç°½ç½²',\n      uploadDate: '2024-11-01',\n      size: '2.5 MB',\n      format: 'PDF',\n      description: 'å®¢æˆ¶å·²ç°½ç½²å®Œæˆ',\n      signedBy: 'ç‹å°æ˜'\n    },\n    {\n      id: '2',\n      name: 'è¡Œç¨‹è¡¨',\n      type: 'è¡Œç¨‹',\n      status: 'å·²ç¢ºèª',\n      uploadDate: '2024-11-05',\n      size: '1.2 MB',\n      format: 'PDF',\n      description: 'è©³ç´°è¡Œç¨‹å®‰æ’',\n      signedBy: ''\n    },\n    {\n      id: '3',\n      name: 'ä¿éšªå–®',\n      type: 'ä¿éšª',\n      status: 'å¾…ç¢ºèª',\n      uploadDate: '2024-11-10',\n      size: '800 KB',\n      format: 'PDF',\n      description: 'æ—…éŠä¿éšªè­‰æ˜',\n      signedBy: ''\n    },\n    {\n      id: '4',\n      name: 'æ©Ÿç¥¨ç¢ºèªæ›¸',\n      type: 'ç¥¨å‹™',\n      status: 'å·²ç¢ºèª',\n      uploadDate: '2024-11-08',\n      size: '1.5 MB',\n      format: 'PDF',\n      description: 'èˆªç­è³‡è¨Šç¢ºèª',\n      signedBy: ''\n    },\n    {\n      id: '5',\n      name: 'é£¯åº—ç¢ºèªæ›¸',\n      type: 'ä½å®¿',\n      status: 'å·²ç¢ºèª',\n      uploadDate: '2024-11-09',\n      size: '900 KB',\n      format: 'PDF',\n      description: 'ä½å®¿é è¨‚ç¢ºèª',\n      signedBy: ''\n    }\n  ];\n\n  // æ ¹æ“š orderFilter éæ¿¾æ–‡ä»¶ï¼ˆå¯¦éš›ä½¿ç”¨æ™‚æœƒå¾ store æ ¹æ“š order_id éæ¿¾ï¼‰\n  const mockDocuments = orderFilter\n    ? allMockDocuments.filter(doc => {\n        // æ¨¡æ“¬ï¼šç•¶æœ‰ orderFilter æ™‚ï¼Œåªé¡¯ç¤ºéƒ¨åˆ†æ–‡ä»¶\n        // å¯¦éš›ä½¿ç”¨æ™‚æœƒæ ¹æ“š doc.order_id === orderFilter éæ¿¾\n        return doc.type === 'åˆç´„' || doc.type === 'è¡Œç¨‹è¡¨';\n      })\n    : allMockDocuments;\n\n  const handleUploadDocument = () => {\n    if (!newDocument.name) return;\n\n    // é€™è£¡æ‡‰è©²å¯¦ä½œæ–‡ä»¶ä¸Šå‚³é‚è¼¯\n    console.log('Uploading document:', newDocument);\n\n    setNewDocument({\n      name: '',\n      type: 'contract',\n      description: ''\n    });\n    setIsUploadDialogOpen(false);\n  };\n\n  const getStatusIcon = (status: string) => {\n    const icons: Record<string, any> = {\n      'å·²ç°½ç½²': CheckCircle,\n      'å·²ç¢ºèª': CheckCircle,\n      'å¾…ç¢ºèª': Clock,\n      'å¾…ç°½ç½²': AlertCircle\n    };\n    return icons[status] || Clock;\n  };\n\n  const getStatusBadge = (status: string) => {\n    const badges: Record<string, string> = {\n      'å·²ç°½ç½²': 'bg-morandi-green text-white',\n      'å·²ç¢ºèª': 'bg-morandi-green text-white',\n      'å¾…ç¢ºèª': 'bg-morandi-gold text-white',\n      'å¾…ç°½ç½²': 'bg-morandi-red text-white'\n    };\n    return badges[status] || 'bg-morandi-container text-morandi-secondary';\n  };\n\n  const getTypeColor = (type: string) => {\n    const colors: Record<string, string> = {\n      'åˆç´„': 'text-red-600',\n      'è¡Œç¨‹': 'text-blue-600',\n      'ä¿éšª': 'text-green-600',\n      'ç¥¨å‹™': 'text-purple-600',\n      'ä½å®¿': 'text-orange-600'\n    };\n    return colors[type] || 'text-gray-600';\n  };\n\n  const documentsByType = mockDocuments.reduce((acc, doc) => {\n    if (!acc[doc.type]) acc[doc.type] = [];\n    acc[doc.type].push(doc);\n    return acc;\n  }, {} as Record<string, typeof mockDocuments>);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* æ–‡ä»¶çµ±è¨ˆ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æ–‡ä»¶ç‹€æ…‹æ¦‚è¦½</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              {mockDocuments.length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">ç¸½æ–‡ä»¶æ•¸</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-green\">\n              {mockDocuments.filter(doc => doc.status.includes('å·²')).length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å·²ç¢ºèª</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-gold\">\n              {mockDocuments.filter(doc => doc.status.includes('å¾…')).length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å¾…è™•ç†</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              {mockDocuments.filter(doc => doc.signedBy).length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å·²ç°½ç½²</div>\n          </div>\n        </div>\n      </ContentContainer>\n\n      {/* æ–‡ä»¶æ“ä½œæŒ‰éˆ• - å³ä¸Šè§’ */}\n      <div className=\"flex justify-end gap-2 mb-6\">\n        <Button variant=\"outline\">\n          <Download size={16} className=\"mr-2\" />\n          æ‰¹é‡ä¸‹è¼‰\n        </Button>\n        <Button\n          onClick={() => setIsUploadDialogOpen(true)}\n          className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n        >\n          <Plus size={16} className=\"mr-2\" />\n          ä¸Šå‚³æ–‡ä»¶\n        </Button>\n      </div>\n\n      {/* æ–‡ä»¶åˆ†é¡å±•ç¤º */}\n      <div className=\"space-y-6\">\n        {Object.entries(documentsByType).map(([type, documents]) => (\n          <ContentContainer key={type}>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h4 className=\"text-lg font-medium text-morandi-primary flex items-center\">\n                <FileText size={20} className={`mr-2 ${getTypeColor(type)}`} />\n                {type}æ–‡ä»¶\n                <span className=\"ml-2 text-sm text-morandi-secondary\">\n                  ({documents.length} å€‹æ–‡ä»¶)\n                </span>\n              </h4>\n            </div>\n\n            <div className=\"space-y-2\">\n              {documents.map((doc) => {\n                const StatusIcon = getStatusIcon(doc.status);\n                return (\n                  <div key={doc.id} className=\"grid grid-cols-12 gap-4 p-4 bg-card border border-border rounded-lg hover:shadow-md transition-shadow\">\n                    <div className=\"col-span-3\">\n                      <div className=\"flex items-center\">\n                        <StatusIcon\n                          size={16}\n                          className={\n                            doc.status.includes('å·²') ? 'text-morandi-green' :\n                            doc.status.includes('å¾…') ? 'text-morandi-gold' :\n                            'text-morandi-red'\n                          }\n                        />\n                        <div className=\"ml-2\">\n                          <div className=\"font-medium text-morandi-primary\">{doc.name}</div>\n                          <div className=\"text-xs text-morandi-secondary\">\n                            {doc.format} â€¢ {doc.size}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"col-span-3\">\n                      <div className=\"text-sm text-morandi-primary\">{doc.description}</div>\n                      {doc.signedBy && (\n                        <div className=\"text-xs text-morandi-secondary\">\n                          ç°½ç½²äººï¼š{doc.signedBy}\n                        </div>\n                      )}\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <div className=\"text-sm text-morandi-primary\">{doc.uploadDate}</div>\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadge(doc.status)}`}>\n                        {doc.status}\n                      </span>\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <div className=\"flex gap-1\">\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Eye size={12} className=\"mr-1\" />\n                          é è¦½\n                        </Button>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Download size={12} className=\"mr-1\" />\n                          ä¸‹è¼‰\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </ContentContainer>\n        ))}\n      </div>\n\n      {/* ä¸Šå‚³æ–‡ä»¶å°è©±æ¡† */}\n      <Dialog open={isUploadDialogOpen} onOpenChange={setIsUploadDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>ä¸Šå‚³æ–‡ä»¶</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ–‡ä»¶åç¨±</label>\n              <Input\n                value={newDocument.name}\n                onChange={(e) => setNewDocument(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"è¼¸å…¥æ–‡ä»¶åç¨±\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ–‡ä»¶é¡å‹</label>\n              <select\n                value={newDocument.type}\n                onChange={(e) => setNewDocument(prev => ({ ...prev, type: e.target.value }))}\n                className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n              >\n                <option value=\"contract\">åˆç´„</option>\n                <option value=\"itinerary\">è¡Œç¨‹</option>\n                <option value=\"insurance\">ä¿éšª</option>\n                <option value=\"ticket\">ç¥¨å‹™</option>\n                <option value=\"accommodation\">ä½å®¿</option>\n                <option value=\"other\">å…¶ä»–</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">èªªæ˜</label>\n              <Input\n                value={newDocument.description}\n                onChange={(e) => setNewDocument(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"æ–‡ä»¶èªªæ˜\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">é¸æ“‡æª”æ¡ˆ</label>\n              <div className=\"border-2 border-dashed border-morandi-container rounded-lg p-6 text-center\">\n                <Upload size={32} className=\"mx-auto mb-2 text-morandi-secondary\" />\n                <p className=\"text-sm text-morandi-secondary mb-2\">\n                  æ‹–æ‹½æª”æ¡ˆåˆ°æ­¤è™•æˆ–é»æ“Šé¸æ“‡\n                </p>\n                <Button variant=\"outline\" size=\"sm\">\n                  é¸æ“‡æª”æ¡ˆ\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsUploadDialogOpen(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleUploadDocument}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                ä¸Šå‚³\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-members.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateIdNumber' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validatePassportNumber' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2432,2435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2432,2435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3956,3959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3956,3959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4665,4668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4665,4668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4709,4712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4709,4712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4761,4764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4761,4764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4813,4816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4813,4816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4886,4889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4886,4889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5517,5520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5517,5520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5561,5564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5561,5564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5613,5616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5613,5616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":173,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5665,5668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5665,5668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5734,5737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5734,5737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addMemberToOrder' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":180,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":220,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":220,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'relatedOrder' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":355,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":355,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useRef, useEffect, useMemo } from 'react';\nimport { Tour } from '@/stores/types';\nimport { useOrderStore, useMemberStore } from '@/stores';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  getGenderFromIdNumber,\n  calculateAge,\n  validateIdNumber,\n  validatePassportNumber\n} from '@/lib/utils';\nimport { Plus, Trash2, GripVertical, Users } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface TourMembersProps {\n  tour: Tour;\n  orderFilter?: string; // é¸å¡«ï¼šåªé¡¯ç¤ºç‰¹å®šè¨‚å–®çš„åœ˜å“¡\n}\n\ninterface EditingMember {\n  id?: string;\n  order_id: string;\n  name: string;\n  nameEn: string;\n  birthday: string;\n  passportNumber: string;\n  passportExpiry: string;\n  idNumber: string;\n  gender: string;\n  age: number;\n  isNew?: boolean;\n  order_number?: string;\n  contact_person?: string;\n  assignedRoom?: string;\n}\n\ninterface EditingCell {\n  rowIndex: number;\n  field: keyof EditingMember;\n}\n\nexport const TourMembers = React.memo(function TourMembers({ tour, orderFilter }: TourMembersProps) {\n  const { items: orders } = useOrderStore();\n  const { items: members, create: addMember, update: updateMember, delete: deleteMember } = useMemberStore();\n  const [tableMembers, setTableMembers] = useState<EditingMember[]>([]);\n  const [editingCell, setEditingCell] = useState<EditingCell | null>(null);\n  const [draggedRow, setDraggedRow] = useState<number | null>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // ç²å–å±¬æ–¼é€™å€‹æ—…éŠåœ˜çš„æ‰€æœ‰è¨‚å–®ï¼ˆå¦‚æœæœ‰ orderFilterï¼Œå‰‡åªå–è©²è¨‚å–®ï¼‰\n  const tourOrders = useMemo(() => {\n    return orders.filter(order => {\n      if (orderFilter) {\n        return order.id === orderFilter;\n      }\n      return order.tour_id === tour.id;\n    });\n  }, [orders, tour.id, orderFilter]);\n\n  // ç²å–æ‰€æœ‰åœ˜å“¡ï¼ŒåŒ…å«è¨‚å–®ä¿¡æ¯\n  useEffect(() => {\n    const allTourMembers = members.filter(member =>\n      tourOrders.some(order => order.id === member.order_id)\n    ).map(member => {\n      const relatedOrder = tourOrders.find(order => order.id === member.order_id);\n      return {\n        ...member,\n        nameEn: member.name_en || '',\n        passportNumber: member.passport_number || '',\n        passportExpiry: member.passport_expiry || '',\n        idNumber: member.id_number || '',\n        order_number: relatedOrder?.order_number || '',\n        contact_person: relatedOrder?.contact_person || '',\n        assignedRoom: member.assigned_room\n      } as any;\n    });\n\n    setTableMembers(allTourMembers);\n  }, [members, tourOrders]);\n\n  const totalMembers = tableMembers.length;\n  const completedMembers = tableMembers.filter(member =>\n    member.name && member.idNumber\n  ).length;\n\n  // é»æ“Šå–®å…ƒæ ¼é–‹å§‹ç·¨è¼¯\n  const startCellEdit = (rowIndex: number, field: keyof EditingMember) => {\n    if (field === 'age' || field === 'order_number' || field === 'contact_person' || field === 'assignedRoom') return;\n\n    setEditingCell({ rowIndex, field });\n    setTimeout(() => {\n      inputRef.current?.focus();\n      inputRef.current?.select();\n    }, 0);\n  };\n\n  // æ›´æ–°å–®å…ƒæ ¼å€¼\n  const updateCellValue = (value: string) => {\n    if (!editingCell) return;\n\n    const { rowIndex, field } = editingCell;\n    const updatedMembers = [...tableMembers];\n    const member = { ...updatedMembers[rowIndex] };\n\n    if (field === 'idNumber') {\n      member.idNumber = value.toUpperCase();\n      // åªæœ‰ç•¶æ€§åˆ¥æ¬„ä½ç‚ºç©ºæ™‚æ‰è‡ªå‹•å¡«å…¥\n      if (!member.gender) {\n        member.gender = getGenderFromIdNumber(value);\n      }\n    } else if (field === 'birthday') {\n      member.birthday = value;\n      member.age = calculateAge(value, tour.departure_date, tour.return_date);\n    } else if (field === 'gender') {\n      // æ‰‹å‹•è¼¸å…¥æ€§åˆ¥ï¼Œè½‰æ›æˆ M/F æ ¼å¼\n      if (value === 'ç”·' || value.toLowerCase() === 'm' || value === '1') {\n        member.gender = 'M';\n      } else if (value === 'å¥³' || value.toLowerCase() === 'f' || value === '2') {\n        member.gender = 'F';\n      } else {\n        member.gender = '';\n      }\n    } else {\n      (member as any)[field] = value;\n    }\n\n    updatedMembers[rowIndex] = member;\n    setTableMembers(updatedMembers);\n\n    // è‡ªå‹•å„²å­˜\n    autoSaveMember(member, rowIndex);\n  };\n\n  // è‡ªå‹•å„²å­˜æˆå“¡\n  const autoSaveMember = async (member: EditingMember, index: number) => {\n    if (member.isNew && member.name.trim()) {\n      const { isNew, order_number, contact_person, assignedRoom, ...memberData } = member;\n      const convertedData = {\n        ...memberData,\n        name_en: memberData.nameEn,\n        passport_number: memberData.passportNumber,\n        passport_expiry: memberData.passportExpiry,\n        id_number: memberData.idNumber,\n        assigned_room: assignedRoom\n      };\n      // ç§»é™¤èˆŠæ¬„ä½\n      delete (convertedData as any).nameEn;\n      delete (convertedData as any).passportNumber;\n      delete (convertedData as any).passportExpiry;\n      delete (convertedData as any).idNumber;\n\n      const newMember = await addMember(convertedData as any);\n\n      const updatedMembers = [...tableMembers];\n      updatedMembers[index] = { ...member, id: newMember.id, isNew: false };\n      setTableMembers(updatedMembers);\n    } else if (member.id && !member.isNew) {\n      const { isNew, order_number, contact_person, assignedRoom, ...memberData } = member;\n      const convertedData = {\n        ...memberData,\n        name_en: memberData.nameEn,\n        passport_number: memberData.passportNumber,\n        passport_expiry: memberData.passportExpiry,\n        id_number: memberData.idNumber,\n        assigned_room: assignedRoom\n      };\n      // ç§»é™¤èˆŠæ¬„ä½\n      delete (convertedData as any).nameEn;\n      delete (convertedData as any).passportNumber;\n      delete (convertedData as any).passportExpiry;\n      delete (convertedData as any).idNumber;\n\n      await updateMember(member.id, convertedData as any);\n    }\n  };\n\n  // æ–°å¢æˆå“¡åˆ°æŒ‡å®šè¨‚å–®\n  const addMemberToOrder = (order_id: string) => {\n    const relatedOrder = tourOrders.find(order => order.id === order_id);\n    if (!relatedOrder) return;\n\n    const newMember: EditingMember = {\n      order_id,\n      name: '',\n      nameEn: '',\n      birthday: '',\n      passportNumber: '',\n      passportExpiry: '',\n      idNumber: '',\n      gender: '',\n      age: 0,\n      isNew: true,\n      order_number: relatedOrder.order_number,\n      contact_person: relatedOrder.contact_person\n    };\n    setTableMembers([...tableMembers, newMember]);\n  };\n\n  // åˆªé™¤æˆå“¡\n  const deleteRow = (index: number) => {\n    const member = tableMembers[index];\n    if (member.id && !member.isNew) {\n      deleteMember(member.id);\n    }\n    const updatedMembers = tableMembers.filter((_, i) => i !== index);\n    setTableMembers(updatedMembers);\n  };\n\n  // æ‹–æ‹½è™•ç† - é‡æ–°å¯¦ç¾æ›´å¯é çš„æ‹–æ‹½åŠŸèƒ½\n  const handleDragStart = (e: React.DragEvent, index: number) => {\n    console.log('=== DRAG START ===', index);\n    console.log('Member being dragged:', tableMembers[index]?.name);\n    setDraggedRow(index);\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/plain', index.toString());\n  };\n\n  const handleDragOver = (e: React.DragEvent, index: number) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'move';\n  };\n\n  const handleDrop = (e: React.DragEvent, dropIndex: number) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    console.log('=== DROP EVENT ===');\n    console.log('Drop at index:', dropIndex);\n    console.log('Dragged from index:', draggedRow);\n\n    if (draggedRow === null) {\n      console.log('No dragged row, aborting');\n      return;\n    }\n\n    if (draggedRow === dropIndex) {\n      console.log('Same position, aborting');\n      setDraggedRow(null);\n      return;\n    }\n\n    console.log('Before reorder:', tableMembers.map((m, i) => `${i}: ${m.name}`));\n\n    // åŸ·è¡Œé‡æ’åº\n    const newMembers = [...tableMembers];\n    const draggedMember = newMembers[draggedRow];\n\n    // ç§»é™¤åŸä½ç½®çš„æˆå“¡\n    newMembers.splice(draggedRow, 1);\n    // æ’å…¥åˆ°æ–°ä½ç½®\n    newMembers.splice(dropIndex, 0, draggedMember);\n\n    console.log('After reorder:', newMembers.map((m, i) => `${i}: ${m.name}`));\n\n    setTableMembers(newMembers);\n    setDraggedRow(null);\n  };\n\n  const handleDragEnd = () => {\n    console.log('=== DRAG END ===');\n    setDraggedRow(null);\n  };\n\n  const renderCell = (member: EditingMember, rowIndex: number, field: keyof EditingMember) => {\n    const isEditing = editingCell?.rowIndex === rowIndex && editingCell?.field === field;\n    const isAutoField = field === 'age' || field === 'order_number' || field === 'contact_person' || field === 'assignedRoom';\n    let value = member[field] as string;\n\n    // æ ¼å¼åŒ–é¡¯ç¤ºå€¼\n    if (field === 'gender') {\n      value = member.gender === 'M' ? 'ç”·' : member.gender === 'F' ? 'å¥³' : '';\n    } else if (field === 'age') {\n      value = member.age > 0 ? `${member.age}æ­²` : '';\n    } else if (field === 'assignedRoom') {\n      value = member.assignedRoom || 'æœªåˆ†æˆ¿';\n    }\n\n    if (isEditing) {\n      return (\n        <input\n          ref={inputRef}\n          value={field === 'age' ? '' :\n            field === 'gender' ? (member.gender === 'M' ? 'ç”·' : member.gender === 'F' ? 'å¥³' : '') :\n            member[field] as string}\n          onChange={(e) => updateCellValue(e.target.value)}\n          onBlur={() => setEditingCell(null)}\n          onKeyDown={(e) => {\n            if (e.key === 'Enter' || e.key === 'Tab') {\n              e.preventDefault();\n              setEditingCell(null);\n            }\n            if (e.key === 'Escape') {\n              setEditingCell(null);\n            }\n          }}\n          type={field === 'birthday' || field === 'passportExpiry' ? 'date' : 'text'}\n          className=\"h-8 w-full border-none outline-none bg-transparent p-0 px-2 focus:ring-0 focus:border-none\"\n        />\n      );\n    }\n\n    return (\n      <div\n        className={cn(\n          \"h-8 px-2 py-1 flex items-center\",\n          isAutoField ? \"cursor-not-allowed text-gray-500\" : \"cursor-text\",\n          member[field] && !isAutoField && \"font-medium\"\n        )}\n        onClick={() => !isAutoField && startCellEdit(rowIndex, field)}\n      >\n        {value || ''}\n      </div>\n    );\n  };\n\n  if (tourOrders.length === 0) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center py-12\">\n          <p className=\"text-morandi-secondary\">æ­¤æ—…éŠåœ˜å°šç„¡è¨‚å–®</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n\n      {/* çµ±ä¸€åœ˜å“¡è¡¨æ ¼ */}\n      <div className=\"overflow-hidden bg-card\">\n        <div className=\"w-full overflow-x-auto\">\n          <table className=\"w-full text-sm border-collapse min-w-[1200px] bg-white rounded-lg overflow-hidden shadow-sm\">\n            <thead className=\"bg-morandi-container/10 sticky top-0 border-b-2 border-morandi-gold/20\">\n              <tr>\n                <th className=\"w-[30px] py-2 px-1 text-xs font-medium text-morandi-secondary border border-gray-300\"></th>\n                <th className=\"w-[40px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">åºè™Ÿ</th>\n                <th className=\"min-w-[80px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">å§“å</th>\n                <th className=\"min-w-[100px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">è‹±æ–‡å§“å</th>\n                <th className=\"min-w-[100px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">ç”Ÿæ—¥</th>\n                <th className=\"min-w-[60px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">å¹´é½¡</th>\n                <th className=\"min-w-[50px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">æ€§åˆ¥</th>\n                <th className=\"min-w-[120px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">èº«åˆ†è­‰å­—è™Ÿ</th>\n                <th className=\"min-w-[100px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">è­·ç…§è™Ÿç¢¼</th>\n                <th className=\"min-w-[100px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">è­·ç…§æ•ˆæœŸ</th>\n                <th className=\"min-w-[100px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">æ‰€å±¬è¨‚å–®</th>\n                <th className=\"min-w-[80px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">è¯çµ¡äºº</th>\n                <th className=\"min-w-[100px] py-2 px-2 text-xs font-medium text-morandi-secondary border border-gray-300\">åˆ†æˆ¿</th>\n                <th className=\"w-[40px] py-2 px-1 text-xs font-medium text-morandi-secondary border border-gray-300\">æ“ä½œ</th>\n              </tr>\n            </thead>\n            <tbody>\n              {tableMembers.map((member, index) => {\n                const relatedOrder = tourOrders.find(order => order.id === member.order_id);\n                const orderIndex = tourOrders.findIndex(order => order.id === member.order_id);\n                const bgColor = orderIndex % 2 === 0 ? 'bg-white' : 'bg-blue-50/30';\n\n                return (\n                  <tr\n                    key={member.id || `row-${index}`}\n                    className={cn(\n                      bgColor,\n                      draggedRow === index && \"opacity-50\"\n                    )}\n                    draggable={true}\n                    onDragStart={(e) => handleDragStart(e, index)}\n                    onDragOver={(e) => handleDragOver(e, index)}\n                    onDrop={(e) => handleDrop(e, index)}\n                    onDragEnd={handleDragEnd}\n                  >\n                    {/* æ‹–æ‹½æŠŠæ‰‹ */}\n                    <td className=\"border border-gray-300 text-center py-1\">\n                      <GripVertical\n                        size={14}\n                        className=\"text-gray-400 cursor-grab active:cursor-grabbing mx-auto\"\n                      />\n                    </td>\n\n                    {/* çµ±ä¸€åºè™Ÿ */}\n                    <td className=\"border border-gray-300 text-center py-1\">\n                      <span className=\"text-morandi-secondary font-medium\">{index + 1}</span>\n                    </td>\n\n                    {/* å¯ç·¨è¼¯æ¬„ä½ */}\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'name')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'nameEn')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'birthday')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'age')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'gender')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'idNumber')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'passportNumber')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'passportExpiry')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'order_number')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'contact_person')}</td>\n                    <td className=\"border border-gray-300\">{renderCell(member, index, 'assignedRoom')}</td>\n\n                    {/* åˆªé™¤æŒ‰éˆ• */}\n                    <td className=\"border border-gray-300 text-center py-1\">\n                      <Button\n                        onClick={() => deleteRow(index)}\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        className=\"h-6 w-6 p-0 hover:bg-red-100\"\n                      >\n                        <Trash2 size={12} className=\"text-red-500\" />\n                      </Button>\n                    </td>\n                  </tr>\n                );\n              })}\n\n              {tableMembers.length === 0 && (\n                <tr>\n                  <td colSpan={14} className=\"py-12 text-center text-morandi-secondary\">\n                    <Users size={24} className=\"mx-auto mb-4 opacity-50\" />\n                    <p>å°šç„¡åœ˜å“¡è³‡æ–™</p>\n                    <p className=\"text-sm mt-1\">é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ–°å¢åœ˜å“¡åˆ°æŒ‡å®šè¨‚å–®</p>\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n\n        <div className=\"text-xs text-morandi-secondary px-2 py-1 space-y-1\">\n          <p>â€¢ é»æ“Šä»»æ„å–®å…ƒæ ¼å³å¯ç·¨è¼¯ï¼Œè‡ªå‹•å„²å­˜</p>\n          <p>â€¢ å¹´é½¡å’Œæ€§åˆ¥ç‚ºè‡ªå‹•è¨ˆç®—æ¬„ä½</p>\n          <p>â€¢ å¯æ‹–æ‹½è¡Œé¦–åœ–ç¤ºèª¿æ•´é †åº</p>\n          <p>â€¢ ä¸åŒè¨‚å–®ç”¨åº•è‰²å€åˆ†ï¼Œæ–¹ä¾¿è­˜åˆ¥</p>\n        </div>\n      </div>\n\n      {/* çµ±è¨ˆå€åŸŸ */}\n      <div className=\"bg-morandi-container/20 p-4\">\n        <div className={cn(\n          \"grid gap-4\",\n          orderFilter ? \"grid-cols-1 sm:grid-cols-3\" : \"grid-cols-1 sm:grid-cols-4\"\n        )}>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">{totalMembers}</div>\n            <div className=\"text-sm text-morandi-secondary\">{orderFilter ? 'è¨‚å–®æˆå“¡æ•¸' : 'ç¸½æˆå“¡æ•¸'}</div>\n          </div>\n          {!orderFilter && (\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-morandi-primary\">{tourOrders.length}</div>\n              <div className=\"text-sm text-morandi-secondary\">è¨‚å–®æ•¸</div>\n            </div>\n          )}\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">{completedMembers}</div>\n            <div className=\"text-sm text-morandi-secondary\">å·²å®Œæˆè³‡æ–™</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              {totalMembers > 0 ? Math.round((completedMembers / totalMembers) * 100) : 0}%\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å®Œæˆç‡</div>\n          </div>\n        </div>\n\n        {/* æŒ‰è¨‚å–®åˆ†çµ„çš„çµ±è¨ˆ - åªåœ¨æ•´åœ˜è¦–åœ–é¡¯ç¤º */}\n        {!orderFilter && tourOrders.length > 1 && (\n          <div className=\"mt-6\">\n            <h4 className=\"text-md font-medium text-morandi-primary mb-3\">å„è¨‚å–®æˆå“¡æ•¸</h4>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\n              {tourOrders.map(order => {\n                const orderMemberCount = tableMembers.filter(member => member.order_id === order.id).length;\n                return (\n                  <div key={order.id} className=\"bg-card border border-border p-3 rounded-lg\">\n                    <div className=\"flex justify-between items-center\">\n                      <div>\n                        <div className=\"font-medium text-morandi-primary text-sm\">{order.order_number}</div>\n                        <div className=\"text-xs text-morandi-secondary\">{order.contact_person}</div>\n                      </div>\n                      <div className=\"text-lg font-bold text-morandi-primary\">{orderMemberCount}</div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-operations.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculateFormula' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMemberContext' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1260,1263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1260,1263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsFormulaModeActive' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setFormulaInputRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":63,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRoomCapacityFromOptions' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":78,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleFieldClick' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":151,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":210,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7132,7135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7132,7135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7255,7258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7255,7258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7300,7303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7300,7303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7557,7560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7557,7560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":286,"column":28,"nodeType":"Identifier","endLine":286,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9779,9782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9779,9782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":298,"column":28,"nodeType":"Identifier","endLine":298,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":303,"column":28,"nodeType":"Identifier","endLine":303,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":308,"column":30,"nodeType":"Identifier","endLine":308,"endColumn":41},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'updateMember'. Either exclude it or remove the dependency array.","line":336,"column":6,"nodeType":"ArrayExpression","endLine":336,"endColumn":34,"suggestions":[{"desc":"Update the dependencies array to be: [tableMembers]","fix":{"range":[11128,11156],"text":"[tableMembers]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":383,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12930,12933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12930,12933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { Tour } from '@/stores/types';\nimport { useOrderStore, useMemberStore, useTourAddOnStore, usePaymentRequestStore } from '@/stores';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Users, Eye } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { calculateFormula, getMemberContext, getFieldCoordinate } from '@/lib/formula-calculator';\nimport { ReactDataSheetWrapper, DataSheetColumn } from '@/components/shared/react-datasheet-wrapper';\n\ninterface TourOperationsProps {\n  tour: Tour;\n  orderFilter?: string; // é¸å¡«ï¼šåªé¡¯ç¤ºç‰¹å®šè¨‚å–®çš„åœ˜å“¡\n  extraFields?: {\n    addOns: boolean;\n    refunds: boolean;\n    customFields: Array<{ id: string; name: string; }>;\n  };\n}\n\ninterface EditingMember {\n  id?: string;\n  order_id: string;\n  name: string;\n  nameEn: string;\n  birthday: string;\n  passportNumber: string;\n  passportExpiry: string;\n  idNumber: string;\n  gender: string;\n  age: number;\n  isNew?: boolean;\n  order_number?: string;\n  contact_person?: string;\n  assignedRoom?: string;\n  isChildNoBed?: boolean;\n  reservationCode?: string;\n  addOns?: string[];\n  refunds?: string[];\n  customFields?: Record<string, any>;\n}\n\ninterface RoomOption {\n  value: string;\n  label: string;\n  room_type: string;\n  capacity: number;\n  currentCount: number;\n}\n\nexport const TourOperations = React.memo(function TourOperations({ tour, orderFilter, extraFields }: TourOperationsProps) {\n  const { items: orders } = useOrderStore();\n  const { items: members, update: updateMember } = useMemberStore();\n  const { items: tourAddOns } = useTourAddOnStore();\n  const { items: paymentRequests } = usePaymentRequestStore();\n  const [tableMembers, setTableMembers] = useState<EditingMember[]>([]);\n  const [roomOptions, setRoomOptions] = useState<RoomOption[]>([]);\n\n  // Excel å¼å…¬å¼ç·¨è¼¯ç‹€æ…‹\n  const [isFormulaModeActive, setIsFormulaModeActive] = useState(false);\n  const [formulaInputRef, setFormulaInputRef] = useState<HTMLInputElement | null>(null);\n\n  // æ¬„ä½ç®¡ç†ç‹€æ…‹\n  const [hiddenColumns, setHiddenColumns] = useState<string[]>([]);\n\n  // æ ¹æ“šæˆ¿å‹åç¨±æ¨ç®—å®¹é‡\n  const getRoomCapacity = (room_type: string): number => {\n    if (room_type.includes('å–®äºº')) return 1;\n    if (room_type.includes('é›™äºº')) return 2;\n    if (room_type.includes('ä¸‰äºº')) return 3;\n    if (room_type.includes('å››äºº')) return 4;\n    return 2; // é è¨­é›™äººæˆ¿\n  };\n\n  // å‹•æ…‹ç²å–æˆ¿é–“å®¹é‡\n  const getRoomCapacityFromOptions = (roomValue: string): number => {\n    const room = roomOptions.find(option => option.value === roomValue);\n    return room ? room.capacity : 0;\n  };\n\n  // ç²å–æ‰€æœ‰å¯ç”¨æˆ¿é–“çš„æ˜ å°„\n  const roomCapacity = roomOptions.reduce((acc, option) => {\n    acc[option.value] = option.capacity;\n    return acc;\n  }, {} as Record<string, number>);\n\n  // åˆ†é…æˆ¿é–“\n  const assignMemberToRoom = (member_id: string, roomValue: string) => {\n    if (roomValue === 'no-bed') {\n      // é¸æ“‡ã€Œä¸ä½”åºŠã€ï¼Œæ›´æ–°ç‹€æ…‹ä½†ä¸åˆ†é…æˆ¿é–“\n      setTableMembers(prev =>\n        prev.map(member =>\n          member.id === member_id\n            ? { ...member, isChildNoBed: true, assignedRoom: undefined }\n            : member\n        )\n      );\n      updateMember(member_id, { is_child_no_bed: true, assigned_room: undefined });\n    } else if (roomValue.startsWith('no-bed-')) {\n      // ä¸ä½”åºŠä½†é¸æ“‡ç‰¹å®šæˆ¿é–“\n      const actualRoom = roomValue.replace('no-bed-', '');\n      setTableMembers(prev =>\n        prev.map(member =>\n          member.id === member_id\n            ? { ...member, isChildNoBed: true, assignedRoom: actualRoom }\n            : member\n        )\n      );\n      updateMember(member_id, { is_child_no_bed: true, assigned_room: actualRoom });\n    } else {\n      // ä¸€èˆ¬åˆ†æˆ¿ï¼Œæª¢æŸ¥å®¹é‡\n      if (roomValue && isRoomFull(roomValue, member_id)) {\n        alert('è©²æˆ¿é–“å·²æ»¿ï¼Œç„¡æ³•åˆ†é…ï¼');\n        return;\n      }\n\n      setTableMembers(prev =>\n        prev.map(member =>\n          member.id === member_id\n            ? { ...member, assignedRoom: roomValue || undefined, isChildNoBed: false }\n            : member\n        )\n      );\n      updateMember(member_id, { assigned_room: roomValue || undefined, is_child_no_bed: false });\n    }\n  };\n\n  // æª¢æŸ¥æˆ¿é–“æ˜¯å¦å·²æ»¿ï¼ˆä¸ä½”åºŠçš„äººä¸è¨ˆå…¥å®¹é‡ï¼‰\n  const isRoomFull = (roomValue: string, excludeMemberId?: string) => {\n    const capacity = roomCapacity[roomValue] || 0;\n    const currentOccupants = tableMembers.filter(member =>\n      member.assignedRoom === roomValue &&\n      member.id !== excludeMemberId &&\n      !member.isChildNoBed  // ä¸ä½”åºŠçš„äººä¸è¨ˆå…¥å®¹é‡\n    );\n    return currentOccupants.length >= capacity;\n  };\n\n  // ç²å–æˆ¿é–“ä½¿ç”¨æƒ…æ³ï¼ˆåˆ†åˆ¥çµ±è¨ˆä½”åºŠå’Œä¸ä½”åºŠï¼‰\n  const getRoomUsage = (roomValue: string) => {\n    const capacity = roomCapacity[roomValue] || 0;\n    const occupants = tableMembers.filter(member => member.assignedRoom === roomValue);\n    const bedCount = occupants.filter(member => !member.isChildNoBed).length; // ä½”åºŠäººæ•¸\n    const noBedCount = occupants.filter(member => member.isChildNoBed).length; // ä¸ä½”åºŠäººæ•¸\n    return { bedCount, noBedCount, totalCount: occupants.length, capacity };\n  };\n\n  // è™•ç†æ¬„ä½é»æ“Šä»¥æ’å…¥å…¬å¼å¼•ç”¨\n  const handleFieldClick = (fieldName: string) => {\n    if (isFormulaModeActive && formulaInputRef) {\n      const customFields = extraFields?.customFields || [];\n      const coordinate = getFieldCoordinate(fieldName, customFields);\n      if (coordinate) {\n        const currentValue = formulaInputRef.value;\n        const cursorPosition = formulaInputRef.selectionStart || currentValue.length;\n        const newValue = currentValue.slice(0, cursorPosition) + coordinate + currentValue.slice(cursorPosition);\n\n        // æ›´æ–°è¼¸å…¥æ¡†å€¼\n        formulaInputRef.value = newValue;\n\n        // è§¸ç™¼ change äº‹ä»¶\n        const event = new Event('input', { bubbles: true });\n        formulaInputRef.dispatchEvent(event);\n\n        // è¨­ç½®æ¸¸æ¨™ä½ç½®\n        setTimeout(() => {\n          formulaInputRef.focus();\n          formulaInputRef.setSelectionRange(cursorPosition + coordinate.length, cursorPosition + coordinate.length);\n        }, 0);\n      }\n    }\n  };\n\n  // ç²å–å±¬æ–¼é€™å€‹æ—…éŠåœ˜çš„æ‰€æœ‰è¨‚å–®ï¼ˆå¦‚æœæœ‰ orderFilterï¼Œå‰‡åªå–è©²è¨‚å–®ï¼‰\n  const tourOrders = orders.filter(order => {\n    if (orderFilter) {\n      return order.id === orderFilter;\n    }\n    return order.tour_id === tour.id;\n  });\n\n  // åˆå§‹åŒ–åœ˜å“¡\n  useEffect(() => {\n    const tourOrdersFiltered = orders.filter(order => order.tour_id === tour.id);\n    const allTourMembers = members.filter(member =>\n      tourOrdersFiltered.some(order => order.id === member.order_id)\n    ).map(member => {\n      const relatedOrder = tourOrdersFiltered.find(order => order.id === member.order_id);\n      return {\n        ...member,\n        nameEn: member.name_en,\n        passportNumber: member.passport_number,\n        passportExpiry: member.passport_expiry,\n        idNumber: member.id_number,\n        order_number: relatedOrder?.order_number || '',\n        contact_person: relatedOrder?.contact_person || '',\n        // ä¿ç•™ç¾æœ‰çš„åˆ†æˆ¿æ•¸æ“šï¼Œä¸è¦è¦†è“‹\n        assignedRoom: member.assigned_room,\n        isChildNoBed: member.is_child_no_bed\n      } as EditingMember;\n    });\n\n    setTableMembers(allTourMembers);\n  }, [members, orders, tour.id]);\n\n  // å–®ç¨è™•ç†æˆ¿é–“é¸é …\n  useEffect(() => {\n    const tourPaymentRequests = paymentRequests.filter((request: any) => request.tour_id === tour.id);\n    const roomOptions: RoomOption[] = [];\n\n    tourPaymentRequests.forEach((request: any) => {\n      request.items.forEach((item: any) => {\n        if (item.category === 'ä½å®¿' && item.description) {\n          // è§£ææˆ¿å‹å’Œæ•¸é‡ï¼ˆä¾‹å¦‚ï¼šé›™äººæˆ¿ x5, ä¸‰äººæˆ¿ x2ï¼‰\n          const roomMatches = item.description.match(/(\\S+æˆ¿)\\s*[xÃ—]\\s*(\\d+)/g);\n          if (roomMatches) {\n            roomMatches.forEach((match: any) => {\n              const [, room_type, quantity] = match.match(/(\\S+æˆ¿)\\s*[xÃ—]\\s*(\\d+)/) || [];\n              if (room_type && quantity) {\n                const capacity = getRoomCapacity(room_type);\n                const roomCount = parseInt(quantity);\n\n                // ç”Ÿæˆå…·é«”æˆ¿é–“é¸é …ï¼ˆå¦‚ï¼šé›™äººæˆ¿-1ã€é›™äººæˆ¿-2...ï¼‰\n                for (let i = 1; i <= roomCount; i++) {\n                  roomOptions.push({\n                    value: `${room_type}-${i}`,\n                    label: `${room_type}-${i}`,\n                    room_type,\n                    capacity,\n                    currentCount: 0\n                  });\n                }\n              }\n            });\n          }\n        }\n      });\n    });\n\n    setRoomOptions(roomOptions);\n  }, [paymentRequests, tour.id]);\n\n  const totalMembers = tableMembers.length;\n  const completedMembers = tableMembers.filter(member =>\n    member.name && member.idNumber\n  ).length;\n\n\n  if (tourOrders.length === 0) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"text-center py-12\">\n          <p className=\"text-morandi-secondary\">æ­¤æ—…éŠåœ˜å°šç„¡è¨‚å–®</p>\n        </div>\n      </div>\n    );\n  }\n\n  // é…ç½® DataSheet æ¬„ä½\n  const dataSheetColumns: DataSheetColumn[] = [\n    { key: 'index', label: 'åºè™Ÿ', width: 40, readOnly: true },\n    { key: 'name', label: 'å§“å', width: 80 },\n    { key: 'nameEn', label: 'è‹±æ–‡å§“å', width: 100 },\n    { key: 'birthday', label: 'ç”Ÿæ—¥', width: 100 },\n    { key: 'age', label: 'å¹´é½¡', width: 60, readOnly: true },\n    { key: 'gender', label: 'æ€§åˆ¥', width: 50, readOnly: true },\n    { key: 'idNumber', label: 'èº«åˆ†è­‰å­—è™Ÿ', width: 120 },\n    { key: 'passportNumber', label: 'è­·ç…§è™Ÿç¢¼', width: 100 },\n    { key: 'passportExpiry', label: 'è­·ç…§æ•ˆæœŸ', width: 100 },\n    { key: 'reservationCode', label: 'è¨‚ä½ä»£è™Ÿ', width: 100 },\n    { key: 'assignedRoom', label: 'åˆ†æˆ¿', width: 120 },\n\n    // å‹•æ…‹æ¬„ä½\n    ...(extraFields?.addOns ? [{ key: 'addOns', label: 'åŠ è³¼é …ç›®', width: 100, readOnly: true }] : []),\n    ...(extraFields?.refunds ? [{ key: 'refunds', label: 'é€€è²»é …ç›®', width: 100 }] : []),\n    ...(extraFields?.customFields?.map(field => ({\n      key: field.id,\n      label: field.name,\n      width: 100\n    })) || [])\n  ];\n\n  // è™•ç†è³‡æ–™æ›´æ–°\n  const handleDataUpdate = useCallback((newData: any[]) => {\n    setTableMembers(newData);\n\n    // æ›´æ–°åˆ° store\n    newData.forEach(member => {\n      if (member.id) {\n        updateMember(member.id, member);\n      }\n    });\n  }, [updateMember]);\n\n  // è™•ç†æ¬„ä½éš±è—\n  const handleColumnHide = useCallback((columnKey: string) => {\n    setHiddenColumns(prev => [...prev, columnKey]);\n  }, []);\n\n  // è™•ç†æ¬„ä½é¡¯ç¤º\n  const handleColumnShow = useCallback((columnKey: string) => {\n    setHiddenColumns(prev => prev.filter(key => key !== columnKey));\n  }, []);\n\n  // è™•ç†æ¬„ä½åˆªé™¤\n  const handleColumnDelete = useCallback((columnKey: string) => {\n    // ç¢ºèªåˆªé™¤\n    if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ¬„ä½å—ï¼Ÿé€™å°‡æœƒåˆªé™¤æ‰€æœ‰åœ˜å“¡åœ¨æ­¤æ¬„ä½çš„è³‡æ–™ã€‚')) {\n      // å¾æ‰€æœ‰åœ˜å“¡ä¸­ç§»é™¤æ­¤æ¬„ä½çš„è³‡æ–™\n      const updatedMembers = tableMembers.map(member => {\n        if (member.customFields) {\n          const { [columnKey]: deleted, ...remainingFields } = member.customFields;\n          return {\n            ...member,\n            customFields: remainingFields\n          };\n        }\n        return member;\n      });\n\n      setTableMembers(updatedMembers);\n\n      // æ›´æ–°åˆ° store\n      updatedMembers.forEach(member => {\n        if (member.id) {\n          // customFields ä¸æ˜¯ Member å‹åˆ¥çš„æ¬„ä½ï¼Œç§»é™¤æ­¤æ›´æ–°\n          // updateMember(member.id, { customFields: member.customFields });\n        }\n      });\n\n      // å¾éš±è—åˆ—è¡¨ä¸­ç§»é™¤ï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n      setHiddenColumns(prev => prev.filter(key => key !== columnKey));\n    }\n  }, [tableMembers, updateMember]);\n\n  return (\n    <div>\n      {/* éš±è—æ¬„ä½æ§åˆ¶ */}\n      {hiddenColumns.length > 0 && (\n        <div className=\"mb-4 p-3 bg-gray-50 rounded-lg\">\n          <div className=\"text-sm text-gray-600 mb-2\">éš±è—çš„æ¬„ä½ï¼š</div>\n          <div className=\"flex flex-wrap gap-2\">\n            {hiddenColumns.map(columnKey => {\n              // å…ˆæ‰¾è‡ªå®šç¾©æ¬„ä½\n              let columnName = extraFields?.customFields?.find(f => f.id === columnKey)?.name;\n\n              // å¦‚æœä¸æ˜¯è‡ªå®šç¾©æ¬„ä½ï¼Œæ‰¾ç³»çµ±æ¬„ä½\n              if (!columnName) {\n                const systemColumn = dataSheetColumns.find(col => col.key === columnKey);\n                columnName = systemColumn?.label;\n              }\n\n              return columnName ? (\n                <button\n                  key={columnKey}\n                  onClick={() => handleColumnShow(columnKey)}\n                  className=\"inline-flex items-center gap-1 px-2 py-1 bg-white border border-gray-300 rounded text-xs\"\n                >\n                  <Eye size={12} />\n                  {columnName}\n                </button>\n              ) : null;\n            })}\n          </div>\n        </div>\n      )}\n\n      {/* ä½¿ç”¨ ReactDataSheet æ›¿ä»£åŸä¾†çš„è¡¨æ ¼ */}\n      <div className=\"overflow-hidden bg-white rounded-lg shadow-sm\">\n        <ReactDataSheetWrapper\n          columns={dataSheetColumns}\n          data={tableMembers.map((member, index) => ({\n            ...member,\n            index: index + 1,\n            age: member.age > 0 ? `${member.age}æ­²` : '',\n            gender: member.gender === 'M' ? 'ç”·' : member.gender === 'F' ? 'å¥³' : '',\n            assignedRoom: member.isChildNoBed\n              ? `ä¸ä½”åºŠ${member.assignedRoom ? ` - ${member.assignedRoom}` : ''}`\n              : (member.assignedRoom || 'æœªåˆ†é…')\n          }))}\n          tour_add_ons={tourAddOns.filter((a: any) => a.tour_id === tour.id)}\n          onDataUpdate={handleDataUpdate}\n          onColumnHide={handleColumnHide}\n          onColumnDelete={handleColumnDelete}\n          hiddenColumns={hiddenColumns}\n          orderFilter={orderFilter}\n          roomOptions={roomOptions}\n          onRoomAssign={assignMemberToRoom}\n          getRoomUsage={getRoomUsage}\n          isRoomFull={isRoomFull}\n          tour_id={tour.id}\n          className=\"min-h-[400px]\"\n        />\n      </div>\n\n      {/* åœ˜å‹™çµ±è¨ˆ */}\n      <div className=\"bg-morandi-container/20 p-4\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">{totalMembers}</div>\n            <div className=\"text-sm text-morandi-secondary\">ç¸½æˆå“¡æ•¸</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">{completedMembers}</div>\n            <div className=\"text-sm text-morandi-secondary\">å·²å®Œæˆè³‡æ–™</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              {totalMembers > 0 ? Math.round((completedMembers / totalMembers) * 100) : 0}%\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å®Œæˆç‡</div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-orders.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-overview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-payments.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tabs' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsList' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsTrigger' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[926,929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[926,929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":24,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1008,1011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1008,1011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8268,8271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8268,8271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8369,8372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8369,8372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12118,12121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12118,12121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { Tour } from '@/stores/types';\nimport { useOrderStore } from '@/stores';\n// TODO: usePaymentStore deprecated\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';\nimport { DollarSign, Calendar, TrendingUp, TrendingDown, CreditCard, Plus } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface TourPaymentsProps {\n  tour: Tour;\n  orderFilter?: string; // é¸å¡«ï¼šåªé¡¯ç¤ºç‰¹å®šè¨‚å–®çš„æ”¶æ¬¾è¨˜éŒ„\n  triggerAdd?: boolean;\n  onTriggerAddComplete?: () => void;\n}\n\nexport const TourPayments = React.memo(function TourPayments({ tour, orderFilter, triggerAdd, onTriggerAddComplete }: TourPaymentsProps) {\n  const { items: orders } = useOrderStore();\n  const payments: any[] = []; // TODO: usePaymentStore deprecated\n  const addPayment = async (data: any) => { console.warn(\"addPayment not implemented\"); };\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n\n  // ç›£è½å¤–éƒ¨è§¸ç™¼æ–°å¢\n  React.useEffect(() => {\n    if (triggerAdd) {\n      setIsAddDialogOpen(true);\n      onTriggerAddComplete?.();\n    }\n  }, [triggerAdd, onTriggerAddComplete]);\n  const [selectedOrderId, setSelectedOrderId] = useState<string>('');\n  const [newPayment, setNewPayment] = useState({\n    amount: 0,\n    description: '',\n    method: 'bank_transfer',\n    status: 'å·²ç¢ºèª' as const\n  });\n\n  // ç²å–å±¬æ–¼é€™å€‹æ—…éŠåœ˜çš„æ‰€æœ‰è¨‚å–®ï¼ˆå¦‚æœæœ‰ orderFilterï¼Œå‰‡åªå–è©²è¨‚å–®ï¼‰\n  const tourOrders = orders.filter(order => {\n    if (orderFilter) {\n      return order.id === orderFilter;\n    }\n    return order.tour_id === tour.id;\n  });\n\n  // ç²å–æ‰€æœ‰ç›¸é—œçš„æ”¶æ¬¾è¨˜éŒ„ï¼ˆæ ¹æ“š orderFilter éæ¿¾ï¼‰\n  const tourPayments = payments.filter(payment => {\n    if (payment.type !== 'æ”¶æ¬¾') return false;\n\n    if (orderFilter) {\n      return payment.order_id === orderFilter;\n    }\n\n    return payment.tour_id === tour.id ||\n           tourOrders.some(order => order.id === payment.order_id);\n  });\n\n  const handleAddPayment = () => {\n    if (!newPayment.amount || !newPayment.description) return;\n\n    addPayment({\n      type: 'æ”¶æ¬¾',\n      tour_id: tour.id,\n      order_id: selectedOrderId || undefined,\n      ...newPayment\n    });\n\n    setNewPayment({\n      amount: 0,\n      description: '',\n      method: 'bank_transfer',\n      status: 'å·²ç¢ºèª'\n    });\n    setSelectedOrderId('');\n    setIsAddDialogOpen(false);\n  };\n\n  // çµ±è¨ˆæ•¸æ“šè¨ˆç®—\n  const confirmedPayments = tourPayments.filter(p => p.status === 'å·²ç¢ºèª');\n  const pendingPayments = tourPayments.filter(p => p.status === 'å¾…ç¢ºèª');\n  const totalConfirmed = confirmedPayments.reduce((sum, p) => sum + p.amount, 0);\n  const totalPending = pendingPayments.reduce((sum, p) => sum + p.amount, 0);\n  const totalPayments = totalConfirmed + totalPending;\n\n  // è¨ˆç®—æ‡‰æ”¶é‡‘é¡ (åŸºæ–¼è¨‚å–®)\n  const totalOrderAmount = tourOrders.reduce((sum, order) => sum + order.total_amount, 0);\n  const remaining_amount = Math.max(0, totalOrderAmount - totalConfirmed);\n\n  const getStatusBadge = (status: string) => {\n    const badges: Record<string, string> = {\n      'å·²ç¢ºèª': 'bg-morandi-green text-white',\n      'å¾…ç¢ºèª': 'bg-morandi-gold text-white',\n      'å·²å®Œæˆ': 'bg-morandi-container text-morandi-primary'\n    };\n    return badges[status] || 'bg-morandi-container text-morandi-secondary';\n  };\n\n  const getMethodBadge = (method: string) => {\n    const badges: Record<string, string> = {\n      'bank_transfer': 'bg-blue-100 text-blue-800',\n      'credit_card': 'bg-purple-100 text-purple-800',\n      'cash': 'bg-green-100 text-green-800',\n      'check': 'bg-yellow-100 text-yellow-800'\n    };\n    return badges[method] || 'bg-gray-100 text-gray-800';\n  };\n\n  const getMethodDisplayName = (method: string) => {\n    const names: Record<string, string> = {\n      'bank_transfer': 'éŠ€è¡Œè½‰å¸³',\n      'credit_card': 'ä¿¡ç”¨å¡',\n      'cash': 'ç¾é‡‘',\n      'check': 'æ”¯ç¥¨'\n    };\n    return names[method] || method;\n  };\n\n  const getPaymentTypeIcon = (type: string) => {\n    if (type === 'æ”¶æ¬¾') return <TrendingUp size={16} className=\"text-morandi-green\" />;\n    if (type === 'è«‹æ¬¾') return <TrendingDown size={16} className=\"text-morandi-red\" />;\n    return <CreditCard size={16} className=\"text-morandi-gold\" />;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* æ”¶æ¬¾çµ±è¨ˆ */}\n      <div className=\"bg-morandi-container/20 rounded-lg p-6\">\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æ”¶æ¬¾æ¦‚æ³</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-green\">\n              NT$ {totalConfirmed.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å·²æ”¶æ¬¾</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-gold\">\n              NT$ {totalPending.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å¾…ç¢ºèª</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              NT$ {totalPayments.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">ç¸½æ”¶æ¬¾</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-morandi-red\">\n              NT$ {remaining_amount.toLocaleString()}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å¾…æ”¶æ¬¾</div>\n          </div>\n        </div>\n      </div>\n\n\n      {/* æ”¶æ¬¾ç´€éŒ„è¡¨æ ¼ */}\n      <div className=\"border border-border rounded-lg overflow-hidden bg-card\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-morandi-container/30\">\n              <tr>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">æ—¥æœŸ</th>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">é¡å‹</th>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">é‡‘é¡</th>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">èªªæ˜</th>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">ä»˜æ¬¾æ–¹å¼</th>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">è¨‚å–®</th>\n                <th className=\"text-left py-3 px-4 text-sm font-medium text-morandi-secondary\">ç‹€æ…‹</th>\n              </tr>\n            </thead>\n            <tbody>\n              {tourPayments.length > 0 ? (\n                tourPayments.map((payment) => {\n                  const relatedOrder = tourOrders.find(order => order.id === payment.order_id);\n\n                  return (\n                    <tr key={payment.id} className=\"border-b border-border/30\">\n                      <td className=\"py-3 px-4 text-morandi-primary\">\n                        {new Date(payment.created_at).toLocaleDateString()}\n                      </td>\n                      <td className=\"py-3 px-4\">\n                        <div className=\"flex items-center space-x-2\">\n                          {getPaymentTypeIcon(payment.type)}\n                          <span className=\"text-morandi-primary\">{payment.type}</span>\n                        </div>\n                      </td>\n                      <td className=\"py-3 px-4\">\n                        <span className={cn(\n                          \"font-medium\",\n                          payment.type === 'æ”¶æ¬¾' ? 'text-morandi-green' : 'text-morandi-red'\n                        )}>\n                          {payment.type === 'æ”¶æ¬¾' ? '+' : '-'} NT$ {payment.amount.toLocaleString()}\n                        </span>\n                      </td>\n                      <td className=\"py-3 px-4 text-morandi-primary\">\n                        {payment.description}\n                      </td>\n                      <td className=\"py-3 px-4\">\n                        <span className={cn(\n                          'inline-flex items-center px-2 py-1 rounded text-xs font-medium',\n                          getMethodBadge((payment as any).method)\n                        )}>\n                          {getMethodDisplayName((payment as any).method)}\n                        </span>\n                      </td>\n                      <td className=\"py-3 px-4 text-morandi-primary\">\n                        {relatedOrder ? relatedOrder.order_number : '-'}\n                      </td>\n                      <td className=\"py-3 px-4\">\n                        <span className={cn(\n                          'inline-flex items-center px-2 py-1 rounded text-xs font-medium',\n                          getStatusBadge(payment.status)\n                        )}>\n                          {payment.status}\n                        </span>\n                      </td>\n                    </tr>\n                  );\n                })\n              ) : (\n                <tr>\n                  <td colSpan={7} className=\"py-12 text-center text-morandi-secondary\">\n                    <DollarSign size={24} className=\"mx-auto mb-4 opacity-50\" />\n                    <p>å°šç„¡æ”¶æ¬¾ç´€éŒ„</p>\n                    <p className=\"text-sm mt-1\">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢æ”¶æ¬¾ã€æŒ‰éˆ•é–‹å§‹è¨˜éŒ„æ”¶æ¬¾</p>\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* æ–°å¢æ”¶æ¬¾å°è©±æ¡† */}\n      <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>æ–°å¢æ”¶æ¬¾ç´€éŒ„</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">é—œè¯è¨‚å–® (é¸å¡«)</label>\n              <select\n                value={selectedOrderId}\n                onChange={(e) => setSelectedOrderId(e.target.value)}\n                className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n              >\n                <option value=\"\">- ä¸é—œè¯ç‰¹å®šè¨‚å–® -</option>\n                {tourOrders.map(order => (\n                  <option key={order.id} value={order.id}>\n                    {order.order_number} - {order.contact_person}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ”¶æ¬¾é‡‘é¡</label>\n              <Input\n                type=\"number\"\n                value={newPayment.amount || ''}\n                onChange={(e) => setNewPayment(prev => ({ ...prev, amount: Number(e.target.value) }))}\n                placeholder=\"0\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ”¶æ¬¾èªªæ˜</label>\n              <Input\n                value={newPayment.description}\n                onChange={(e) => setNewPayment(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"ä¾‹ï¼šç‹å°æ˜è¨‚é‡‘\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">ä»˜æ¬¾æ–¹å¼</label>\n              <select\n                value={newPayment.method}\n                onChange={(e) => setNewPayment(prev => ({ ...prev, method: e.target.value }))}\n                className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n              >\n                <option value=\"bank_transfer\">éŠ€è¡Œè½‰å¸³</option>\n                <option value=\"credit_card\">ä¿¡ç”¨å¡</option>\n                <option value=\"cash\">ç¾é‡‘</option>\n                <option value=\"check\">æ”¯ç¥¨</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">ç¢ºèªç‹€æ…‹</label>\n              <select\n                value={newPayment.status}\n                onChange={(e) => setNewPayment(prev => ({ ...prev, status: e.target.value as any }))}\n                className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n              >\n                <option value=\"å·²ç¢ºèª\">å·²ç¢ºèª</option>\n                <option value=\"å¾…ç¢ºèª\">å¾…ç¢ºèª</option>\n              </select>\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsAddDialogOpen(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleAddPayment}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                æ–°å¢\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-refunds.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-tabs-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/tours/tour-task-assignment.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTemplatesByCategory' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateTodo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3186,3189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3186,3189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5988,5991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5988,5991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":235,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7034,7037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7034,7037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { StarRating } from '@/components/ui/star-rating';\nimport { EnhancedTable } from '@/components/ui/enhanced-table';\nimport { Tour, Todo } from '@/stores/types';\nimport { useTodoStore } from '@/stores';\nimport { taskTemplates, getTemplatesByCategory, calculateDeadlineFromDeparture } from '@/lib/task-templates';\nimport { cn } from '@/lib/utils';\nimport { Plus, Eye, Calendar, User, CheckCircle, Clock } from 'lucide-react';\n\ninterface TourTaskAssignmentProps {\n  tour: Tour;\n}\n\nconst employees = [\n  { id: '1', name: 'å¼µç¶“ç†', role: 'ä¸»ç®¡' },\n  { id: '2', name: 'æåŠ©ç†', role: 'OP' },\n  { id: '3', name: 'ç‹è²¡å‹™', role: 'è²¡å‹™' },\n  { id: '4', name: 'é™³æ¥­å‹™', role: 'æ¥­å‹™' },\n];\n\nexport function TourTaskAssignment({ tour }: TourTaskAssignmentProps) {\n  const { items: todos, create: addTodo, update: updateTodo } = useTodoStore();\n  const [selectedTemplate, setSelectedTemplate] = useState('');\n  const [taskForm, setTaskForm] = useState({\n    title: '',\n    assignee: '',\n    deadline: '',\n    priority: 3 as 1 | 2 | 3 | 4 | 5,\n    sub_tasks: [''] as string[]\n  });\n\n  // ç²å–èˆ‡æ­¤æ—…éŠåœ˜ç›¸é—œçš„ä»»å‹™\n  const tourTasks = todos.filter(todo =>\n    todo.related_items.some(item => item.type === 'group' && item.id === tour.id)\n  );\n\n  useEffect(() => {\n    // æ ¹æ“šå‡ºç™¼æ—¥æœŸè¨­å®šé è¨­æœŸé™\n    if (tour.departure_date) {\n      const defaultDeadline = calculateDeadlineFromDeparture(tour.departure_date, -7);\n      setTaskForm(prev => ({ ...prev, deadline: defaultDeadline }));\n    }\n  }, [tour.departure_date]);\n\n  const handleTemplateChange = (templateId: string) => {\n    setSelectedTemplate(templateId);\n\n    if (templateId && taskTemplates[templateId]) {\n      const template = taskTemplates[templateId];\n      const deadline = calculateDeadlineFromDeparture(tour.departure_date, template.defaultDeadlineDays);\n\n      setTaskForm({\n        title: template.title,\n        assignee: '',\n        deadline,\n        priority: template.defaultPriority,\n        sub_tasks: [...template.sub_tasks, ''] // åŠ ä¸€å€‹ç©ºæ¬„ä½ä¾›è‡ªè¨‚\n      });\n    }\n  };\n\n  const handleSubTaskChange = (index: number, value: string) => {\n    const newSubTasks = [...taskForm.sub_tasks];\n    newSubTasks[index] = value;\n    setTaskForm(prev => ({ ...prev, sub_tasks: newSubTasks }));\n  };\n\n  const addSubTask = () => {\n    setTaskForm(prev => ({\n      ...prev,\n      sub_tasks: [...prev.sub_tasks, '']\n    }));\n  };\n\n  const removeSubTask = (index: number) => {\n    if (taskForm.sub_tasks.length > 1) {\n      const newSubTasks = taskForm.sub_tasks.filter((_, i) => i !== index);\n      setTaskForm(prev => ({ ...prev, sub_tasks: newSubTasks }));\n    }\n  };\n\n  const handleCreateTask = () => {\n    if (!taskForm.title.trim() || !taskForm.assignee) return;\n\n    const sub_tasks = taskForm.sub_tasks\n      .filter((task: string) => task.trim())\n      .map((task: string, index: number) => ({\n        id: `${Date.now()}-${index}`,\n        title: task.trim(),\n        done: false\n      }));\n\n    const newTodo: any = {\n      title: taskForm.title,\n      priority: taskForm.priority,\n      deadline: taskForm.deadline,\n      status: 'pending' as const,\n      creator: '1', // ç•¶å‰ç”¨æˆ¶\n      assignee: taskForm.assignee,\n      visibility: ['1', taskForm.assignee],\n      related_items: [\n        {\n          type: 'group' as const,\n          id: tour.id,\n          title: tour.name\n        }\n      ],\n      sub_tasks,\n      notes: [\n        {\n          timestamp: new Date().toISOString(),\n          content: `å¾æ—…éŠåœ˜ã€Œ${tour.name}ã€æŒ‡æ´¾çš„ä»»å‹™`\n        }\n      ]\n    };\n\n    addTodo(newTodo);\n\n    // é‡ç½®è¡¨å–®\n    setTaskForm({\n      title: '',\n      assignee: '',\n      deadline: calculateDeadlineFromDeparture(tour.departure_date, -7),\n      priority: 3,\n      sub_tasks: ['']\n    });\n    setSelectedTemplate('');\n  };\n\n  const getStatusLabel = (status: Todo['status']) => {\n    const statusMap = {\n      pending: 'å¾…è¾¦',\n      in_progress: 'é€²è¡Œä¸­',\n      completed: 'å®Œæˆ',\n      cancelled: 'å–æ¶ˆ'\n    };\n    return statusMap[status];\n  };\n\n  const getStatusColor = (status: Todo['status']) => {\n    const colorMap = {\n      pending: 'text-morandi-muted',\n      in_progress: 'text-blue-600',\n      completed: 'text-green-600',\n      cancelled: 'text-morandi-red'\n    };\n    return colorMap[status];\n  };\n\n  const getEmployeeName = (employee_id: string) => {\n    return employees.find(emp => emp.id === employee_id)?.name || 'æœªæŒ‡æ´¾';\n  };\n\n  const getProgressInfo = (todo: Todo) => {\n    const completed = todo.sub_tasks.filter(task => task.done).length;\n    const total = todo.sub_tasks.length;\n    return { completed, total, percentage: total > 0 ? (completed / total) * 100 : 0 };\n  };\n\n  // ä»»å‹™åˆ—è¡¨è¡¨æ ¼æ¬„ä½\n  const taskColumns = [\n    {\n      key: 'title',\n      label: 'ä»»å‹™æ¨™é¡Œ',\n      sortable: true,\n      render: (value: string, todo: Todo) => (\n        <div className=\"flex items-center gap-2\">\n          <StarRating value={todo.priority} readonly size=\"sm\" />\n          <span className=\"font-medium text-morandi-primary\">{value}</span>\n        </div>\n      )\n    },\n    {\n      key: 'assignee',\n      label: 'è² è²¬äºº',\n      render: (value: string) => (\n        <div className=\"flex items-center gap-2\">\n          <User size={14} className=\"text-morandi-secondary\" />\n          <span className=\"text-morandi-primary\">{getEmployeeName(value)}</span>\n        </div>\n      )\n    },\n    {\n      key: 'deadline',\n      label: 'æœŸé™',\n      sortable: true,\n      render: (value: string) => (\n        <div className=\"flex items-center gap-2\">\n          <Calendar size={14} className=\"text-morandi-secondary\" />\n          <span className=\"text-sm text-morandi-primary\">\n            {value ? new Date(value).toLocaleDateString() : 'æœªè¨­å®š'}\n          </span>\n        </div>\n      )\n    },\n    {\n      key: 'progress',\n      label: 'é€²åº¦',\n      render: (value: any, todo: Todo) => {\n        const { completed, total, percentage } = getProgressInfo(todo);\n        return (\n          <div className=\"flex items-center gap-2\">\n            <div className=\"w-16 bg-morandi-container/30 rounded-full h-2\">\n              <div\n                className=\"bg-morandi-gold h-2 rounded-full transition-all duration-300\"\n                style={{ width: `${percentage}%` }}\n              />\n            </div>\n            <span className=\"text-sm text-morandi-secondary\">\n              {completed}/{total}\n            </span>\n          </div>\n        );\n      }\n    },\n    {\n      key: 'status',\n      label: 'ç‹€æ…‹',\n      render: (value: Todo['status']) => (\n        <span className={cn('inline-flex items-center gap-1 text-sm font-medium', getStatusColor(value))}>\n          {value === 'completed' && <CheckCircle size={14} />}\n          {value === 'in_progress' && <Clock size={14} />}\n          {getStatusLabel(value)}\n        </span>\n      )\n    },\n    {\n      key: 'actions',\n      label: 'æ“ä½œ',\n      render: (value: any, todo: Todo) => (\n        <Button\n          size=\"sm\"\n          variant=\"outline\"\n          onClick={() => {\n            // é€™è£¡å¯ä»¥å¯¦ç¾è·³è½‰åˆ°å¾…è¾¦äº‹é …è©³ç´°é é¢\n            window.location.href = `/todos?expand=${todo.id}`;\n          }}\n        >\n          <Eye size={14} className=\"mr-1\" />\n          æŸ¥çœ‹\n        </Button>\n      )\n    }\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* å¿«é€ŸæŒ‡æ´¾å€ */}\n      <div className=\"border border-border rounded-lg p-6 bg-morandi-container/10\">\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">å¿«é€ŸæŒ‡æ´¾ä»»å‹™</h3>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          {/* å·¦å´ï¼šåŸºæœ¬è³‡è¨Š */}\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-morandi-primary mb-2\">é¸æ“‡ä»»å‹™æ¨¡æ¿</label>\n              <Select value={selectedTemplate} onValueChange={handleTemplateChange}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"é¸æ“‡é è¨­æ¨¡æ¿æˆ–è‡ªè¨‚ä»»å‹™\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"\">è‡ªè¨‚ä»»å‹™</SelectItem>\n                  <SelectItem value=\"pre-tour\">è¡Œå‰æº–å‚™</SelectItem>\n                  <SelectItem value=\"documents\">æ–‡ä»¶æº–å‚™</SelectItem>\n                  <SelectItem value=\"booking\">è¨‚æˆ¿è¨‚è»Š</SelectItem>\n                  <SelectItem value=\"collection\">æ”¶æ¬¾ä½œæ¥­</SelectItem>\n                  <SelectItem value=\"cost-control\">æˆæœ¬æ§åˆ¶</SelectItem>\n                  <SelectItem value=\"quality-check\">å“è³ªæª¢æŸ¥</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-morandi-primary mb-2\">ä»»å‹™æ¨™é¡Œ</label>\n              <Input\n                value={taskForm.title}\n                onChange={(e) => setTaskForm(prev => ({ ...prev, title: e.target.value }))}\n                placeholder={`ä¾‹ï¼šæº–å‚™${tour.name}ç›¸é—œè³‡æ–™`}\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-morandi-primary mb-2\">æŒ‡æ´¾çµ¦</label>\n              <Select value={taskForm.assignee} onValueChange={(value) => setTaskForm(prev => ({ ...prev, assignee: value }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"é¸æ“‡è² è²¬äºº\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {employees.map((emp) => (\n                    <SelectItem key={emp.id} value={emp.id}>\n                      {emp.name} ({emp.role})\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-2\">æœŸé™</label>\n                <Input\n                  type=\"date\"\n                  value={taskForm.deadline}\n                  onChange={(e) => setTaskForm(prev => ({ ...prev, deadline: e.target.value }))}\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-morandi-primary mb-2\">ç·Šæ€¥åº¦</label>\n                <StarRating\n                  value={taskForm.priority}\n                  onChange={(value) => setTaskForm(prev => ({ ...prev, priority: value as 1 | 2 | 3 | 4 | 5 }))}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* å³å´ï¼šå­ä»»å‹™æ¸…å–® */}\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <label className=\"block text-sm font-medium text-morandi-primary\">å­ä»»å‹™æ¸…å–®</label>\n              <Button size=\"sm\" variant=\"outline\" onClick={addSubTask}>\n                <Plus size={14} className=\"mr-1\" />\n                æ–°å¢\n              </Button>\n            </div>\n            <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n              {taskForm.sub_tasks.map((subTask, index) => (\n                <div key={index} className=\"flex gap-2\">\n                  <Input\n                    value={subTask}\n                    onChange={(e) => handleSubTaskChange(index, e.target.value)}\n                    placeholder={`å­ä»»å‹™ ${index + 1}`}\n                    className=\"text-sm\"\n                  />\n                  {taskForm.sub_tasks.length > 1 && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => removeSubTask(index)}\n                      className=\"px-2\"\n                    >\n                      Ã—\n                    </Button>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end mt-6\">\n          <Button\n            onClick={handleCreateTask}\n            disabled={!taskForm.title.trim() || !taskForm.assignee}\n            className=\"px-6\"\n          >\n            å»ºç«‹ä¸¦æŒ‡æ´¾ä»»å‹™\n          </Button>\n        </div>\n      </div>\n\n      {/* å·²æŒ‡æ´¾ä»»å‹™åˆ—è¡¨ */}\n      <div className=\"border border-border rounded-lg p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold text-morandi-primary\">\n            æ­¤åœ˜å·²æŒ‡æ´¾çš„ä»»å‹™ ({tourTasks.length})\n          </h3>\n          <div className=\"text-sm text-morandi-secondary\">\n            å‡ºç™¼æ—¥æœŸï¼š{new Date(tour.departure_date).toLocaleDateString()}\n          </div>\n        </div>\n\n        {tourTasks.length > 0 ? (\n          <EnhancedTable\n            columns={taskColumns}\n            data={tourTasks}\n            initialPageSize={10}\n            showFilters={false}\n          />\n        ) : (\n          <div className=\"text-center py-8 text-morandi-muted\">\n            <Clock size={48} className=\"mx-auto mb-4 opacity-50\" />\n            <p>å°šæœªæŒ‡æ´¾ä»»ä½•ä»»å‹™</p>\n            <p className=\"text-sm\">ä½¿ç”¨ä¸Šæ–¹è¡¨å–®é–‹å§‹æŒ‡æ´¾ä»»å‹™çµ¦åœ˜éšŠæˆå“¡</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/bento-grid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/calendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'props' is defined but never used. Allowed unused args must match /^_/u.","line":57,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2426,2429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2426,2429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2556,2559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2556,2559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport * as React from 'react'\nimport { ChevronLeft, ChevronRight } from 'lucide-react'\nimport { DayPicker } from 'react-day-picker'\n\nimport { cn } from '@/lib/utils'\nimport { buttonVariants } from '@/components/ui/button'\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn('p-3', className)}\n      classNames={{\n        months: 'flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0',\n        month: 'space-y-4',\n        caption: 'flex justify-center pt-1 relative items-center',\n        caption_label: 'text-sm font-medium',\n        nav: 'space-x-1 flex items-center',\n        nav_button: cn(\n          buttonVariants({ variant: 'outline' }),\n          'h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100'\n        ),\n        nav_button_previous: 'absolute left-1',\n        nav_button_next: 'absolute right-1',\n        table: 'w-full border-collapse space-y-1',\n        head_row: 'flex',\n        head_cell:\n          'text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]',\n        row: 'flex w-full mt-2',\n        cell: 'h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20',\n        day: cn(\n          buttonVariants({ variant: 'ghost' }),\n          'h-9 w-9 p-0 font-normal aria-selected:opacity-100'\n        ),\n        day_range_end: 'day-range-end',\n        day_selected:\n          'bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground',\n        day_today: 'bg-accent text-accent-foreground',\n        day_outside:\n          'day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30',\n        day_disabled: 'text-muted-foreground opacity-50',\n        day_range_middle:\n          'aria-selected:bg-accent aria-selected:text-accent-foreground',\n        day_hidden: 'invisible',\n        ...classNames,\n      }}\n      components={{\n        Chevron: ({ orientation, ...props }: any) =>\n          orientation === 'left' ? <ChevronLeft className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />,\n      } as any}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = 'Calendar'\n\nexport { Calendar }\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/checkbox.tsx","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":15,"column":40,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":15,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[624,627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[624,627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root> & { indeterminate?: boolean }\n>(({ className, indeterminate, ...props }, ref) => {\n  const checkboxRef = React.useRef<HTMLButtonElement>(null);\n\n  React.useImperativeHandle(ref, () => checkboxRef.current!);\n\n  React.useEffect(() => {\n    if (checkboxRef.current) {\n      (checkboxRef.current as any).indeterminate = indeterminate ?? false;\n    }\n  }, [indeterminate]);\n\n  return (\n    <CheckboxPrimitive.Root\n      ref={checkboxRef}\n      className={cn(\n        \"peer h-4 w-4 shrink-0 rounded-sm border border-morandi-container ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-morandi-gold focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-morandi-gold data-[state=checked]:text-white\",\n        className\n      )}\n      {...props}\n    >\n      <CheckboxPrimitive.Indicator\n        className={cn(\"flex items-center justify-center text-current\")}\n      >\n        <Check className=\"h-4 w-4\" />\n      </CheckboxPrimitive.Indicator>\n    </CheckboxPrimitive.Root>\n  );\n})\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/color-picker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/combobox.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[325,328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[325,328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1669,1672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1669,1672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":376,"column":40,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":376,"endColumn":52},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10221,10224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10221,10224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":386,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10276,10279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10276,10279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":387,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10338,10341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10338,10341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":388,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":388,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10404,10407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10404,10407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":389,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10462,10465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10462,10465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":390,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10526,10529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10526,10529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport * as React from \"react\";\nimport { ChevronDown, X, Search } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\n\n/**\n * é€šç”¨çš„ Combobox é¸é …é¡å‹\n * @template T - å¯é¸çš„é¡å¤–è³‡æ–™é¡å‹\n */\nexport interface ComboboxOption<T = any> {\n  /** é¸é …çš„å”¯ä¸€è­˜åˆ¥å€¼ */\n  value: string;\n  /** é¡¯ç¤ºçš„æ¨™ç±¤æ–‡å­— */\n  label: string;\n  /** å¯é¸çš„é¡å¤–è³‡æ–™ï¼Œç”¨æ–¼å‚³éæ›´å¤šè³‡è¨Š */\n  data?: T;\n  /** æ˜¯å¦ç¦ç”¨æ­¤é¸é … */\n  disabled?: boolean;\n}\n\n/**\n * Combobox çµ„ä»¶çš„å±¬æ€§\n * @template T - é¸é …é¡å¤–è³‡æ–™çš„é¡å‹\n */\nexport interface ComboboxProps<T = any> {\n  /** ç•¶å‰é¸ä¸­çš„å€¼ */\n  value: string;\n  /** å€¼æ”¹è®Šæ™‚çš„å›èª¿å‡½æ•¸ */\n  onChange: (value: string) => void;\n  /** é¸é …è¢«é¸ä¸­æ™‚çš„å›èª¿å‡½æ•¸ï¼Œå¯ç²å–å®Œæ•´çš„é¸é …ç‰©ä»¶ */\n  onSelect?: (option: ComboboxOption<T>) => void;\n  /** å¯é¸é …åˆ—è¡¨ */\n  options: ComboboxOption<T>[];\n  /** è¼¸å…¥æ¡†ä½”ä½ç¬¦ */\n  placeholder?: string;\n  /** è‡ªå®šç¾©æ¨£å¼é¡å */\n  className?: string;\n  /** ç„¡æœå°‹çµæœæ™‚é¡¯ç¤ºçš„è¨Šæ¯ */\n  emptyMessage?: string;\n  /** æ˜¯å¦é¡¯ç¤ºæœå°‹åœ–ç¤º */\n  showSearchIcon?: boolean;\n  /** æ˜¯å¦é¡¯ç¤ºæ¸…é™¤æŒ‰éˆ• */\n  showClearButton?: boolean;\n  /** æ˜¯å¦ç¦ç”¨æ•´å€‹çµ„ä»¶ */\n  disabled?: boolean;\n  /** è‡ªå®šç¾©é¸é …æ¸²æŸ“å‡½æ•¸ */\n  renderOption?: (option: ComboboxOption<T>) => React.ReactNode;\n  /** ä¸‹æ‹‰é¸å–®æœ€å¤§é«˜åº¦ */\n  maxHeight?: string;\n}\n\n/**\n * å¯æœå°‹çš„ä¸‹æ‹‰é¸å–®çµ„ä»¶ï¼ˆCombobox/Autocompleteï¼‰\n *\n * åŠŸèƒ½ç‰¹é»ï¼š\n * - æ”¯æ´è¼¸å…¥æœå°‹/ç¯©é¸é¸é …\n * - éµç›¤å°èˆªï¼ˆä¸Šä¸‹æ–¹å‘éµã€Enterã€Escapeï¼‰\n * - æ¸…é™¤æŒ‰éˆ•\n * - ç„¡çµæœæç¤º\n * - éˆæ´»çš„è³‡æ–™é¡å‹æ”¯æ´\n * - è«è˜­è¿ªé…è‰²é¢¨æ ¼\n *\n * @example\n * ```tsx\n * const options = [\n *   { value: '1', label: 'å°åŒ—' },\n *   { value: '2', label: 'å°ä¸­' },\n *   { value: '3', label: 'é«˜é›„' }\n * ];\n *\n * <Combobox\n *   value={selectedCity}\n *   onChange={setSelectedCity}\n *   options={options}\n *   placeholder=\"é¸æ“‡åŸå¸‚\"\n *   showClearButton\n * />\n * ```\n */\nexport function Combobox<T = any>({\n  value,\n  onChange,\n  onSelect,\n  options,\n  placeholder = \"è¼¸å…¥æˆ–é¸æ“‡é …ç›®\",\n  className,\n  emptyMessage = \"ç„¡ç¬¦åˆçš„é¸é …\",\n  showSearchIcon = true,\n  showClearButton = true,\n  disabled = false,\n  renderOption,\n  maxHeight = \"16rem\"\n}: ComboboxProps<T>) {\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [searchValue, setSearchValue] = React.useState(\"\");\n  const [highlightedIndex, setHighlightedIndex] = React.useState(-1);\n  const inputRef = React.useRef<HTMLInputElement>(null);\n  const dropdownRef = React.useRef<HTMLDivElement>(null);\n  const optionRefs = React.useRef<(HTMLButtonElement | null)[]>([]);\n\n  // ç•¶ value æ”¹è®Šæ™‚ï¼Œæ›´æ–°æœå°‹å€¼ç‚ºå°æ‡‰çš„ label\n  React.useEffect(() => {\n    const selectedOption = options.find(opt => opt.value === value);\n    setSearchValue(selectedOption?.label || \"\");\n  }, [value, options]);\n\n  // ç¯©é¸é¸é …\n  const filteredOptions = React.useMemo(() => {\n    return options.filter(option =>\n      option.label?.toLowerCase().includes(searchValue.toLowerCase())\n    );\n  }, [options, searchValue]);\n\n  // è™•ç†è¼¸å…¥è®ŠåŒ–\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    setSearchValue(newValue);\n\n    // åªæœ‰åœ¨çœŸæ­£è¼¸å…¥å…§å®¹æ™‚æ‰æ‰“é–‹ä¸‹æ‹‰é¸å–®\n    if (!isOpen) {\n      setIsOpen(true);\n    }\n\n    setHighlightedIndex(-1);\n\n    // å¦‚æœè¼¸å…¥ç‚ºç©ºï¼Œæ¸…é™¤é¸æ“‡\n    if (!newValue) {\n      onChange(\"\");\n    }\n  };\n\n  // è™•ç†è¼¸å…¥æ¡†é»æ“Šï¼ˆæ‰“é–‹ä¸‹æ‹‰é¸å–®ï¼‰\n  const handleInputClick = () => {\n    if (!disabled && !isOpen) {\n      setIsOpen(true);\n    }\n  };\n\n  // è™•ç†é¸é …é¸æ“‡\n  const handleOptionSelect = (option: ComboboxOption<T>) => {\n    if (option.disabled) return;\n\n    setSearchValue(option.label);\n    onChange(option.value);\n    onSelect?.(option);\n    setIsOpen(false);\n    setHighlightedIndex(-1);\n  };\n\n  // æ¸…é™¤é¸æ“‡\n  const handleClear = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setSearchValue(\"\");\n    onChange(\"\");\n    setIsOpen(false);\n    inputRef.current?.focus();\n  };\n\n  // åˆ‡æ›ä¸‹æ‹‰é¸å–®\n  const handleToggleDropdown = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (!disabled) {\n      setIsOpen(!isOpen);\n      if (!isOpen) {\n        inputRef.current?.focus();\n      }\n    }\n  };\n\n  // éµç›¤å°èˆª\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (!isOpen) {\n      if (e.key === 'ArrowDown' || e.key === 'Enter') {\n        setIsOpen(true);\n        setHighlightedIndex(0);\n        e.preventDefault();\n      }\n      return;\n    }\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setHighlightedIndex(prev =>\n          prev < filteredOptions.length - 1 ? prev + 1 : prev\n        );\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setHighlightedIndex(prev => prev > 0 ? prev - 1 : 0);\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (highlightedIndex >= 0 && highlightedIndex < filteredOptions.length) {\n          handleOptionSelect(filteredOptions[highlightedIndex]);\n        }\n        break;\n      case 'Escape':\n        e.preventDefault();\n        setIsOpen(false);\n        setHighlightedIndex(-1);\n        inputRef.current?.blur();\n        break;\n      case 'Tab':\n        setIsOpen(false);\n        break;\n    }\n  };\n\n  // æ»¾å‹•åˆ°é«˜äº®çš„é¸é …\n  React.useEffect(() => {\n    if (highlightedIndex >= 0 && optionRefs.current[highlightedIndex]) {\n      optionRefs.current[highlightedIndex]?.scrollIntoView({\n        block: 'nearest',\n        behavior: 'smooth'\n      });\n    }\n  }, [highlightedIndex]);\n\n  // é»æ“Šå¤–éƒ¨é—œé–‰ä¸‹æ‹‰é¸å–®\n  React.useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        dropdownRef.current &&\n        !dropdownRef.current.contains(event.target as Node) &&\n        inputRef.current &&\n        !inputRef.current.contains(event.target as Node)\n      ) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // é è¨­é¸é …æ¸²æŸ“\n  const defaultRenderOption = (option: ComboboxOption<T>) => (\n    <span className=\"text-morandi-primary\">{option.label}</span>\n  );\n\n  return (\n    <div className={cn(\"relative\", className)}>\n      {/* è¼¸å…¥æ¡† */}\n      <div className=\"relative\">\n        {showSearchIcon && (\n          <Search\n            size={16}\n            className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-morandi-secondary pointer-events-none\"\n          />\n        )}\n        <Input\n          ref={inputRef}\n          type=\"text\"\n          value={searchValue}\n          onChange={handleInputChange}\n          onKeyDown={handleKeyDown}\n          onClick={handleInputClick}\n          placeholder={placeholder}\n          disabled={disabled}\n          className={cn(\n            \"pr-8\",\n            showSearchIcon && \"pl-9\"\n          )}\n        />\n        <div className=\"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1\">\n          {showClearButton && searchValue && !disabled && (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClear}\n              className=\"h-6 w-6 p-0 hover:bg-morandi-container/50\"\n            >\n              <X size={14} className=\"text-morandi-secondary\" />\n            </Button>\n          )}\n          <button\n            type=\"button\"\n            onClick={handleToggleDropdown}\n            className=\"h-6 w-6 flex items-center justify-center hover:bg-morandi-container/50 rounded transition-colors\"\n            disabled={disabled}\n          >\n            <ChevronDown\n              size={16}\n              className={cn(\n                \"text-morandi-secondary transition-transform\",\n                isOpen && \"transform rotate-180\"\n              )}\n            />\n          </button>\n        </div>\n      </div>\n\n      {/* ä¸‹æ‹‰é¸å–® */}\n      {isOpen && !disabled && (\n        <div\n          ref={dropdownRef}\n          className=\"absolute top-full left-0 right-0 z-[100] mt-1 bg-card border border-border rounded-lg shadow-lg overflow-hidden\"\n          style={{ maxHeight }}\n        >\n          <div className=\"overflow-y-auto\" style={{ maxHeight }}>\n            {filteredOptions.length > 0 ? (\n              filteredOptions.map((option, index) => (\n                <button\n                  key={option.value}\n                  ref={el => { optionRefs.current[index] = el; }}\n                  onClick={() => handleOptionSelect(option)}\n                  disabled={option.disabled}\n                  className={cn(\n                    \"w-full px-3 py-2 text-left text-sm transition-colors\",\n                    \"hover:bg-morandi-container/30 focus:bg-morandi-container/30 focus:outline-none\",\n                    highlightedIndex === index && \"bg-morandi-container/50\",\n                    option.value === value && \"bg-morandi-gold/10 font-medium\",\n                    option.disabled && \"opacity-50 cursor-not-allowed\"\n                  )}\n                >\n                  {renderOption ? renderOption(option) : defaultRenderOption(option)}\n                </button>\n              ))\n            ) : (\n              <div className=\"px-3 py-6 text-center text-sm text-morandi-secondary\">\n                {emptyMessage}\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ä¿ç•™èˆŠç‰ˆç›¸å®¹æ€§çš„é¡å‹å®šç¾©\nexport interface LegacyComboboxOption {\n  id: string;\n  name: string;\n  price_per_person?: number;\n  pricePerGroup?: number;\n  isGroupCost?: boolean;\n}\n\nexport interface LegacyComboboxProps {\n  value: string;\n  onChange: (value: string) => void;\n  onSelect?: (option: LegacyComboboxOption) => void;\n  options: LegacyComboboxOption[];\n  placeholder?: string;\n  className?: string;\n}\n\n/**\n * èˆŠç‰ˆ Comboboxï¼ˆç”¨æ–¼å‘å¾Œç›¸å®¹ï¼‰\n * @deprecated è«‹ä½¿ç”¨æ–°ç‰ˆ Combobox çµ„ä»¶\n */\nexport function LegacyCombobox({\n  value,\n  onChange,\n  onSelect,\n  options,\n  placeholder = \"è¼¸å…¥æˆ–é¸æ“‡é …ç›®\",\n  className\n}: LegacyComboboxProps) {\n  const transformedOptions: ComboboxOption<LegacyComboboxOption>[] = options.map(opt => ({\n    value: opt.id,\n    label: opt.name,\n    data: opt\n  }));\n\n  return (\n    <Combobox\n      value={value}\n      onChange={onChange}\n      onSelect={(option) => onSelect?.(option.data!)}\n      options={transformedOptions}\n      placeholder={placeholder}\n      className={className}\n      renderOption={(option) => (\n        <div className=\"flex justify-between items-center\">\n          <span className=\"text-morandi-primary\">{option.label}</span>\n          {option.data && (\n            <span className=\"text-xs text-morandi-secondary\">\n              {(option.data as any).pricePerGroup ? (\n                (option.data as any).isGroupCost\n                  ? `åœ˜é«” NT$${(option.data as any).pricePerGroup}`\n                  : `å€‹äºº NT$${(option.data as any).price_per_person}`\n              ) : (option.data as any).price_per_person ? (\n                `NT$${(option.data as any).price_per_person}`\n              ) : ''}\n            </span>\n          )}\n        </div>\n      )}\n    />\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/comet-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'motion' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'translateDepth' is assigned a value but never used. Allowed unused args must match /^_/u.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { cn } from \"@/lib/utils\";\nimport { motion } from \"framer-motion\";\nimport React, { useState, useRef, useEffect } from \"react\";\n\ninterface CometCardProps {\n  rotateDepth?: number;\n  translateDepth?: number;\n  className?: string;\n  children: React.ReactNode;\n}\n\nexport function CometCard({\n  rotateDepth = 17.5,\n  translateDepth = 20,\n  className,\n  children,\n}: CometCardProps) {\n  const [rotation, setRotation] = useState({ x: 0, y: 0 });\n  const ref = useRef<HTMLDivElement>(null);\n\n  const handleMouseMove = (event: React.MouseEvent) => {\n    if (!ref.current) return;\n\n    const rect = ref.current.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    const mouseX = event.clientX - centerX;\n    const mouseY = event.clientY - centerY;\n\n    const rotateX = (mouseY / rect.height) * rotateDepth;\n    const rotateY = -(mouseX / rect.width) * rotateDepth;\n\n    setRotation({ x: rotateX, y: rotateY });\n  };\n\n  const handleMouseLeave = () => {\n    setRotation({ x: 0, y: 0 });\n  };\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={handleMouseMove}\n      onMouseLeave={handleMouseLeave}\n      className={cn(\n        \"relative transform-style-3d transition-transform duration-100 ease-out\",\n        className\n      )}\n      style={{\n        transform: `perspective(1000px) rotateX(${rotation.x}deg) rotateY(${rotation.y}deg)`,\n        transformStyle: \"preserve-3d\",\n      }}\n    >\n      {children}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/date-input.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'placeholder' is assigned a value but never used. Allowed unused args must match /^_/u.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useRef, useEffect, KeyboardEvent } from 'react'\nimport { cn } from '@/lib/utils'\n\ninterface DateInputProps {\n  value: string // ISO 8601 æ ¼å¼ (YYYY-MM-DD)\n  onChange: (value: string) => void\n  placeholder?: string\n  disabled?: boolean\n  className?: string\n  min?: string\n  max?: string\n}\n\nexport function DateInput({\n  value,\n  onChange,\n  placeholder = 'YYYY/MM/DD',\n  disabled = false,\n  className,\n  min,\n  max,\n}: DateInputProps) {\n  // å°‡ ISO æ ¼å¼è½‰æ›ç‚ºé¡¯ç¤ºæ ¼å¼\n  const formatToDisplay = (isoDate: string): { year: string; month: string; day: string } => {\n    if (!isoDate || isoDate.length < 10) {\n      return { year: '', month: '', day: '' }\n    }\n    const [year, month, day] = isoDate.split('-')\n    return { year, month, day }\n  }\n\n  const initial = formatToDisplay(value)\n  const [year, setYear] = useState(initial.year)\n  const [month, setMonth] = useState(initial.month)\n  const [day, setDay] = useState(initial.day)\n\n  const yearRef = useRef<HTMLInputElement>(null)\n  const monthRef = useRef<HTMLInputElement>(null)\n  const dayRef = useRef<HTMLInputElement>(null)\n\n  // åŒæ­¥å¤–éƒ¨ value çš„è®ŠåŒ–\n  useEffect(() => {\n    const formatted = formatToDisplay(value)\n    setYear(formatted.year)\n    setMonth(formatted.month)\n    setDay(formatted.day)\n  }, [value])\n\n  // çµ„åˆæ—¥æœŸä¸¦å›å‚³ ISO æ ¼å¼\n  const emitDate = (y: string, m: string, d: string) => {\n    if (y.length === 4 && m.length === 2 && d.length === 2) {\n      const isoDate = `${y}-${m}-${d}`\n\n      // é©—è­‰æ—¥æœŸæœ‰æ•ˆæ€§\n      const date = new Date(isoDate)\n      if (isNaN(date.getTime())) return\n\n      // æª¢æŸ¥ min/max é™åˆ¶\n      if (min && isoDate < min) return\n      if (max && isoDate > max) return\n\n      onChange(isoDate)\n    }\n  }\n\n  const handleYearChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const val = e.target.value.replace(/\\D/g, '').slice(0, 4)\n    setYear(val)\n    if (val.length === 4) {\n      monthRef.current?.focus()\n      monthRef.current?.select()\n    }\n    emitDate(val, month, day)\n  }\n\n  const handleMonthChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    let val = e.target.value.replace(/\\D/g, '')\n\n    // é¿å…é è¨­é›¶çš„å•é¡Œï¼šå¦‚æœè¼¸å…¥çš„ç¬¬ä¸€å€‹æ•¸å­— > 1ï¼Œè‡ªå‹•è£œé›¶\n    if (val.length === 1 && parseInt(val) > 1) {\n      val = '0' + val\n    }\n\n    // é™åˆ¶æœ€å¤š 2 ä½æ•¸\n    val = val.slice(0, 2)\n\n    // é™åˆ¶ç¯„åœ 01-12\n    if (val.length === 2) {\n      const num = parseInt(val)\n      if (num < 1) val = '01'\n      if (num > 12) val = '12'\n    }\n\n    setMonth(val)\n\n    if (val.length === 2) {\n      dayRef.current?.focus()\n      dayRef.current?.select()\n    }\n\n    emitDate(year, val, day)\n  }\n\n  const handleDayChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    let val = e.target.value.replace(/\\D/g, '')\n\n    // é¿å…é è¨­é›¶çš„å•é¡Œï¼šå¦‚æœè¼¸å…¥çš„ç¬¬ä¸€å€‹æ•¸å­— > 3ï¼Œè‡ªå‹•è£œé›¶\n    if (val.length === 1 && parseInt(val) > 3) {\n      val = '0' + val\n    }\n\n    // é™åˆ¶æœ€å¤š 2 ä½æ•¸\n    val = val.slice(0, 2)\n\n    // é™åˆ¶ç¯„åœ 01-31\n    if (val.length === 2) {\n      const num = parseInt(val)\n      if (num < 1) val = '01'\n      if (num > 31) val = '31'\n    }\n\n    setDay(val)\n    emitDate(year, month, val)\n  }\n\n  const handleYearKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Backspace' && year.length === 0 && e.currentTarget.selectionStart === 0) {\n      // åœ¨å¹´ä»½æ¬„ä½é–‹é ­æŒ‰ Backspaceï¼Œä¸åšä»»ä½•äº‹\n      return\n    }\n  }\n\n  const handleMonthKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Backspace' && month.length === 0 && e.currentTarget.selectionStart === 0) {\n      yearRef.current?.focus()\n      const len = year.length\n      yearRef.current?.setSelectionRange(len, len)\n    }\n  }\n\n  const handleDayKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Backspace' && day.length === 0 && e.currentTarget.selectionStart === 0) {\n      monthRef.current?.focus()\n      const len = month.length\n      monthRef.current?.setSelectionRange(len, len)\n    }\n  }\n\n  return (\n    <div\n      className={cn(\n        'flex items-center h-10 w-full rounded-md border border-input bg-background px-3 text-sm',\n        'focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2',\n        disabled && 'cursor-not-allowed opacity-50',\n        className\n      )}\n    >\n      <input\n        ref={yearRef}\n        type=\"text\"\n        inputMode=\"numeric\"\n        value={year}\n        onChange={handleYearChange}\n        onKeyDown={handleYearKeyDown}\n        placeholder=\"YYYY\"\n        disabled={disabled}\n        className=\"w-12 bg-transparent outline-none text-center\"\n        maxLength={4}\n      />\n      <span className=\"text-muted-foreground mx-1\">/</span>\n      <input\n        ref={monthRef}\n        type=\"text\"\n        inputMode=\"numeric\"\n        value={month}\n        onChange={handleMonthChange}\n        onKeyDown={handleMonthKeyDown}\n        placeholder=\"MM\"\n        disabled={disabled}\n        className=\"w-8 bg-transparent outline-none text-center\"\n        maxLength={2}\n      />\n      <span className=\"text-muted-foreground mx-1\">/</span>\n      <input\n        ref={dayRef}\n        type=\"text\"\n        inputMode=\"numeric\"\n        value={day}\n        onChange={handleDayChange}\n        onKeyDown={handleDayKeyDown}\n        placeholder=\"DD\"\n        disabled={disabled}\n        className=\"w-8 bg-transparent outline-none text-center\"\n        maxLength={2}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/date-picker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/dropdown-menu.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[852,855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[852,855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1418,1421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1418,1421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ref' is defined but never used. Allowed unused args must match /^_/u.","line":90,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":81}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n    children: React.ReactNode\n  }\n>(({ className, open, onOpenChange, children, ...props }, ref) => {\n  const [isOpen, setIsOpen] = React.useState(open || false)\n\n  React.useEffect(() => {\n    if (open !== undefined) {\n      setIsOpen(open)\n    }\n  }, [open])\n\n  const handleOpenChange = (newOpen: boolean) => {\n    setIsOpen(newOpen)\n    onOpenChange?.(newOpen)\n  }\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\"relative\", className)}\n      {...props}\n    >\n      {React.Children.map(children, child =>\n        React.isValidElement(child)\n          ? React.cloneElement(child as React.ReactElement<any>, {\n              isOpen,\n              onOpenChange: handleOpenChange\n            })\n          : child\n      )}\n    </div>\n  )\n})\nDropdownMenu.displayName = \"DropdownMenu\"\n\nconst DropdownMenuTrigger = React.forwardRef<\n  HTMLButtonElement,\n  React.ButtonHTMLAttributes<HTMLButtonElement> & {\n    isOpen?: boolean\n    onOpenChange?: (open: boolean) => void\n    asChild?: boolean\n  }\n>(({ className, children, isOpen, onOpenChange, asChild, ...props }, ref) => {\n  if (asChild && React.isValidElement(children)) {\n    const child = children as React.ReactElement<any>\n    return React.cloneElement(child, {\n      onClick: (e: React.MouseEvent) => {\n        onOpenChange?.(!isOpen)\n        child.props.onClick?.(e)\n      },\n      ...props\n    })\n  }\n\n  return (\n    <button\n      ref={ref}\n      className={cn(\n        \"flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors\",\n        \"focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\",\n        \"disabled:pointer-events-none disabled:opacity-50\",\n        className\n      )}\n      onClick={() => onOpenChange?.(!isOpen)}\n      {...props}\n    >\n      {children}\n    </button>\n  )\n})\nDropdownMenuTrigger.displayName = \"DropdownMenuTrigger\"\n\nconst DropdownMenuContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    isOpen?: boolean\n    onOpenChange?: (open: boolean) => void\n    align?: 'start' | 'center' | 'end'\n  }\n>(({ className, children, isOpen, onOpenChange, align = 'start', ...props }, ref) => {\n  const contentRef = React.useRef<HTMLDivElement>(null)\n\n  React.useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (contentRef.current && !contentRef.current.contains(event.target as Node)) {\n        onOpenChange?.(false)\n      }\n    }\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isOpen, onOpenChange])\n\n  if (!isOpen) return null\n\n  return (\n    <div\n      ref={contentRef}\n      className={cn(\n        \"absolute top-full z-50 min-w-[8rem] overflow-hidden rounded-md border border-border bg-white p-1 shadow-md\",\n        \"animate-in fade-in-0 zoom-in-95 data-[side=bottom]:slide-in-from-top-2\",\n        align === 'start' && 'left-0',\n        align === 'center' && 'left-1/2 -translate-x-1/2',\n        align === 'end' && 'right-0',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n})\nDropdownMenuContent.displayName = \"DropdownMenuContent\"\n\nconst DropdownMenuItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none\",\n      \"hover:bg-morandi-container hover:text-morandi-primary\",\n      \"focus:bg-morandi-container focus:text-morandi-primary\",\n      \"data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = \"DropdownMenuItem\"\n\nconst DropdownMenuSeparator = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = \"DropdownMenuSeparator\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/enhanced-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExpandDown' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[746,749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[746,749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[756,759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[756,759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[981,984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[981,984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1017,1020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1017,1020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1167,1170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1167,1170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1266,1269],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1266,1269],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1577,1580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1577,1580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1636,1639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1636,1639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2044,2047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2044,2047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2092,2095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2092,2095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'bordered' is assigned a value but never used. Allowed unused args must match /^_/u.","line":97,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5333,5336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5333,5336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5590,5593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5590,5593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5781,5784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5781,5784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5976,5979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5976,5979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleExpansion' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":231,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":231,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6989,6992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6989,6992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused args must match /^_/u.","line":406,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":406,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport {\n  ChevronUp,\n  ChevronDown,\n  ChevronsUpDown,\n  Filter,\n  ChevronRight,\n  ChevronDown as ExpandDown,\n  Loader2\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\nexport interface TableColumn {\n  key: string;\n  label: string | React.ReactNode;\n  sortable?: boolean;\n  filterable?: boolean;\n  filterType?: 'text' | 'number' | 'date' | 'select';\n  filterOptions?: Array<{ value: string; label: string }>;\n  render?: (value: any, row: any) => React.ReactNode;\n  width?: string;\n  align?: 'left' | 'center' | 'right';\n  className?: string;\n}\n\nexport interface SelectionConfig {\n  selected: string[];\n  onChange: (selected: string[]) => void;\n  disabled?: (row: any) => boolean;\n  getRowId?: (row: any, index: number) => string;\n}\n\nexport interface ExpandableConfig {\n  expanded: string[];\n  onExpand: (id: string) => void;\n  renderExpanded: (row: any) => React.ReactNode;\n  expandIcon?: (expanded: boolean) => React.ReactNode;\n  getRowId?: (row: any, index: number) => string;\n}\n\nexport interface EnhancedTableProps {\n  columns: TableColumn[];\n  data: any[];\n  loading?: boolean;\n  error?: string | null;\n\n  // åŸæœ‰åŠŸèƒ½\n  onSort?: (column: string, direction: 'asc' | 'desc') => void;\n  onFilter?: (filters: Record<string, string>) => void;\n  onRowClick?: (row: any, rowIndex: number) => void;\n  onRowDoubleClick?: (row: any, rowIndex: number) => void;\n  className?: string;\n  showFilters?: boolean;\n  searchableFields?: string[];\n  initialPageSize?: number;\n  searchTerm?: string;\n  emptyState?: React.ReactNode;\n  defaultSort?: { key: string; direction: 'asc' | 'desc' };\n  searchable?: boolean;\n  searchPlaceholder?: string;\n\n  // DataTable åŠŸèƒ½\n  selection?: SelectionConfig;\n  expandable?: ExpandableConfig;\n  actions?: (row: any) => React.ReactNode;\n  rowClassName?: (row: any) => string;\n  bordered?: boolean;\n  striped?: boolean;\n  hoverable?: boolean;\n}\n\nexport function EnhancedTable({\n  columns,\n  data,\n  loading = false,\n  error = null,\n  onSort,\n  onFilter,\n  onRowClick,\n  onRowDoubleClick,\n  className,\n  showFilters: defaultShowFilters = false,\n  searchableFields = [],\n  initialPageSize = 10,\n  searchTerm: externalSearchTerm = '',\n  emptyState,\n  selection,\n  expandable,\n  actions,\n  rowClassName,\n  bordered = true,\n  striped = false,\n  hoverable = true\n}: EnhancedTableProps) {\n  const [sortColumn, setSortColumn] = useState<string | null>(null);\n  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('asc');\n  const [filters, setFilters] = useState<Record<string, string>>({});\n  const [showFilters, setShowFilters] = useState(defaultShowFilters);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [pageSize, setPageSize] = useState(initialPageSize);\n\n  // æœå°‹å’Œéæ¿¾é‚è¼¯\n  const processedData = React.useMemo(() => {\n    let filtered = [...data];\n\n    // å…¨æ–‡æœå°‹\n    if (externalSearchTerm && searchableFields.length > 0) {\n      filtered = filtered.filter(row =>\n        searchableFields.some(field => {\n          const value = row[field];\n          return value && value.toString().toLowerCase().includes(externalSearchTerm.toLowerCase());\n        })\n      );\n    }\n\n    // ç¯©é¸å™¨\n    Object.keys(filters).forEach(key => {\n      if (filters[key]) {\n        filtered = filtered.filter(row => {\n          const value = row[key];\n          return value && value.toString().toLowerCase().includes(filters[key].toLowerCase());\n        });\n      }\n    });\n\n    // æ’åº\n    if (sortColumn) {\n      filtered.sort((a, b) => {\n        const aValue = a[sortColumn];\n        const bValue = b[sortColumn];\n\n        if (aValue === bValue) return 0;\n\n        const result = aValue < bValue ? -1 : 1;\n        return sortDirection === 'asc' ? result : -result;\n      });\n    }\n\n    return filtered;\n  }, [data, externalSearchTerm, searchableFields, filters, sortColumn, sortDirection]);\n\n  // åˆ†é é‚è¼¯\n  const totalPages = Math.ceil(processedData.length / pageSize);\n  const startIndex = (currentPage - 1) * pageSize;\n  const paginatedData = processedData.slice(startIndex, startIndex + pageSize);\n\n  // é‡ç½®é é¢ç•¶è³‡æ–™è®ŠåŒ–æ™‚\n  React.useEffect(() => {\n    setCurrentPage(1);\n  }, [processedData.length]);\n\n  const handleSort = (columnKey: string) => {\n    const newDirection = sortColumn === columnKey && sortDirection === 'asc' ? 'desc' : 'asc';\n    setSortColumn(columnKey);\n    setSortDirection(newDirection);\n    onSort?.(columnKey, newDirection);\n  };\n\n  const getSortIcon = (columnKey: string) => {\n    if (sortColumn !== columnKey) {\n      return <ChevronsUpDown size={14} className=\"text-morandi-secondary opacity-50\" />;\n    }\n    return sortDirection === 'asc' ?\n      <ChevronUp size={14} className=\"text-morandi-gold transition-colors\" /> :\n      <ChevronDown size={14} className=\"text-morandi-gold transition-colors\" />;\n  };\n\n  const updateFilter = (key: string, value: string) => {\n    const newFilters = { ...filters, [key]: value === '__all__' ? '' : value };\n    setFilters(newFilters);\n    onFilter?.(newFilters);\n  };\n\n  // Helper functions for selection and expandable\n  const getRowId = (row: any, index: number): string => {\n    if (selection?.getRowId) return selection.getRowId(row, index);\n    if (expandable?.getRowId) return expandable.getRowId(row, index);\n    return row.id || row._id || index.toString();\n  };\n\n  const isRowSelected = (row: any, index: number): boolean => {\n    if (!selection) return false;\n    const rowId = getRowId(row, index);\n    return selection.selected.includes(rowId);\n  };\n\n  const isRowExpanded = (row: any, index: number): boolean => {\n    if (!expandable) return false;\n    const rowId = getRowId(row, index);\n    return expandable.expanded.includes(rowId);\n  };\n\n  const toggleSelection = (row: any, index: number) => {\n    if (!selection) return;\n    const rowId = getRowId(row, index);\n    const isSelected = selection.selected.includes(rowId);\n\n    if (isSelected) {\n      selection.onChange(selection.selected.filter(id => id !== rowId));\n    } else {\n      selection.onChange([...selection.selected, rowId]);\n    }\n  };\n\n  const toggleSelectAll = () => {\n    if (!selection) return;\n    const allRowIds = paginatedData.map((row, index) => getRowId(row, startIndex + index));\n    const allSelected = allRowIds.every(id => selection.selected.includes(id));\n\n    if (allSelected) {\n      // Deselect all visible rows\n      selection.onChange(selection.selected.filter(id => !allRowIds.includes(id)));\n    } else {\n      // Select all visible rows\n      const newSelected = [...selection.selected];\n      allRowIds.forEach(id => {\n        if (!newSelected.includes(id)) {\n          newSelected.push(id);\n        }\n      });\n      selection.onChange(newSelected);\n    }\n  };\n\n  const toggleExpansion = (row: any, index: number) => {\n    if (!expandable) return;\n    const rowId = getRowId(row, index);\n    expandable.onExpand(rowId);\n  };\n\n  // Calculate if all visible rows are selected\n  const allVisibleSelected = selection ? paginatedData.length > 0 &&\n    paginatedData.every((row, index) => isRowSelected(row, startIndex + index)) : false;\n  const someVisibleSelected = selection ? paginatedData.some((row, index) => isRowSelected(row, startIndex + index)) : false;\n\n\n  // Loading and error states\n  if (loading) {\n    return (\n      <div className={cn(\"border border-border rounded-lg overflow-hidden bg-card\", className)}>\n        <div className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-morandi-primary\" />\n          <span className=\"ml-2 text-morandi-secondary\">è¼‰å…¥ä¸­...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className={cn(\"border border-border rounded-lg overflow-hidden bg-card\", className)}>\n        <div className=\"flex items-center justify-center py-8 text-red-500\">\n          <span>éŒ¯èª¤: {error}</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={cn(\"border border-border rounded-lg overflow-hidden bg-card shadow-sm flex flex-col h-full\", className)}>\n      <div className=\"overflow-auto flex-1\">\n        <table className=\"w-full\">\n          <thead className=\"sticky top-0 z-10 bg-white border-b-2 border-morandi-gold/20\">\n            {/* ä¸»æ¨™é¡Œè¡Œ */}\n            <tr className=\"relative bg-gradient-to-r from-morandi-container/40 via-morandi-gold/10 to-morandi-container/40\">\n              {/* Selection checkbox column */}\n              {selection && (\n                <th className=\"w-12 py-1.5 sm:py-2 px-3 sm:px-4\">\n                  <Checkbox\n                    checked={allVisibleSelected}\n                    indeterminate={someVisibleSelected && !allVisibleSelected}\n                    onCheckedChange={toggleSelectAll}\n                  />\n                </th>\n              )}\n\n              {columns.map((column, index) => (\n                <th key={column.key} className={cn(\n                  \"text-left py-1.5 sm:py-2 relative\",\n                  index === columns.length - 1 ? \"pl-4 pr-1\" : \"px-3 sm:px-4\"\n                )}>\n                  <div className=\"absolute right-0 top-1/2 -translate-y-1/2 h-5 w-px bg-morandi-gold/30\"></div>\n                  <div className=\"flex items-center gap-1.5 sm:gap-2\">\n                    {column.sortable ? (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-auto p-0 hover:bg-transparent text-[10px] sm:text-xs font-medium text-morandi-secondary hover:text-morandi-primary transition-colors [&_svg]:!size-[14px]\"\n                        onClick={() => handleSort(column.key)}\n                      >\n                        {column.label}\n                        {getSortIcon(column.key)}\n                      </Button>\n                    ) : (\n                      <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">{column.label}</span>\n                    )}\n                    {index === columns.length - 1 && columns.some(col => col.filterable) && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-6 w-6 p-0\"\n                        onClick={() => setShowFilters(!showFilters)}\n                      >\n                        <Filter size={12} className={cn(\n                          \"transition-colors\",\n                          showFilters ? \"text-morandi-primary\" : \"text-morandi-muted\"\n                        )} />\n                      </Button>\n                    )}\n                  </div>\n                </th>\n              ))}\n\n              {/* Actions column */}\n              {actions && (\n                <th className=\"text-left py-1.5 sm:py-2 px-3 sm:px-4\">\n                  <span className=\"text-[10px] sm:text-xs font-medium text-morandi-secondary\">æ“ä½œ</span>\n                </th>\n              )}\n            </tr>\n\n            {/* ç¯©é¸è¡Œ */}\n            {showFilters && (\n              <tr className=\"bg-background border-t border-border/50\">\n                {/* Selection checkbox column - empty */}\n                {selection && <td className=\"py-2 px-4\"></td>}\n\n                {columns.map((column) => (\n                  <td key={column.key} className=\"py-2 px-4\">\n                    {column.filterable ? (\n                      column.filterType === 'select' ? (\n                        <Select\n                          value={filters[column.key] || '__all__'}\n                          onValueChange={(value) => updateFilter(column.key, value)}\n                        >\n                          <SelectTrigger className=\"h-8 text-xs\">\n                            <SelectValue placeholder={`é¸æ“‡${column.label}...`} />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"__all__\">å…¨éƒ¨{column.label}</SelectItem>\n                            {column.filterOptions?.map((option) => (\n                              <SelectItem key={option.value} value={option.value}>\n                                {option.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      ) : (\n                        <Input\n                          type={column.filterType || 'text'}\n                          placeholder={`æœå°‹${column.label}...`}\n                          value={filters[column.key] || ''}\n                          onChange={(e) => updateFilter(column.key, e.target.value)}\n                          className=\"h-8 text-xs\"\n                        />\n                      )\n                    ) : null}\n                  </td>\n                ))}\n\n                {/* Actions column - empty */}\n                {actions && <td className=\"py-2 px-4\"></td>}\n\n                {/* Expandable icon column - empty */}\n                {expandable && <td className=\"py-2 px-4\"></td>}\n              </tr>\n            )}\n          </thead>\n          <tbody>\n            {paginatedData.length === 0 ? (\n              <tr>\n                <td colSpan={\n                  columns.length +\n                  (selection ? 1 : 0) +\n                  (expandable ? 1 : 0) +\n                  (actions ? 1 : 0)\n                } className=\"py-8 px-6\">\n                  {emptyState}\n                </td>\n              </tr>\n            ) : (\n              paginatedData.map((row, index) => {\n                const actualRowIndex = startIndex + index;\n                const rowId = getRowId(row, actualRowIndex);\n                const isSelected = isRowSelected(row, actualRowIndex);\n                const isExpanded = isRowExpanded(row, actualRowIndex);\n                const isDisabled = selection?.disabled?.(row) ?? false;\n\n                return (\n                  <React.Fragment key={rowId}>\n                    <tr\n                      className={cn(\n                        \"relative group border-b border-border/50 last:border-b-0\",\n                        isSelected && \"bg-morandi-gold/10\",\n                        (onRowClick || onRowDoubleClick) && !selection && !expandable && \"cursor-pointer\",\n                        hoverable && \"hover:bg-morandi-container/20 transition-all duration-150\",\n                        striped && index % 2 === 0 && \"bg-morandi-container/5\",\n                        rowClassName?.(row)\n                      )}\n                      onClick={(e) => {\n                        // Don't trigger row click if clicking on selection checkbox or expand button\n                        if (selection || expandable) return;\n                        onRowClick?.(row, actualRowIndex);\n                      }}\n                      onDoubleClick={() => onRowDoubleClick?.(row, actualRowIndex)}\n                    >\n                      {/* Selection checkbox */}\n                      {selection && (\n                        <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                          <Checkbox\n                            checked={isSelected}\n                            disabled={isDisabled}\n                            onCheckedChange={() => toggleSelection(row, actualRowIndex)}\n                            onClick={(e) => e.stopPropagation()}\n                          />\n                        </td>\n                      )}\n\n                      {/* Data columns */}\n                      {columns.map((column, colIndex) => (\n                        <td\n                          key={column.key}\n                          className={cn(\n                            \"py-1.5 sm:py-2\",\n                            colIndex === columns.length - 1 ? \"pl-4 pr-1\" : \"px-3 sm:px-4\",\n                            column.align === 'center' && \"text-center\",\n                            column.align === 'right' && \"text-right\",\n                            column.className\n                          )}\n                          style={{ width: column.width }}\n                        >\n                          {column.render ? column.render(row[column.key], row) : (\n                            <div className=\"text-[10px] sm:text-xs text-morandi-primary\">\n                              {row[column.key]}\n                            </div>\n                          )}\n                        </td>\n                      ))}\n\n                      {/* Actions column */}\n                      {actions && (\n                        <td className=\"py-1.5 sm:py-2 px-3 sm:px-4\">\n                          <div onClick={(e) => e.stopPropagation()}>\n                            {actions(row)}\n                          </div>\n                        </td>\n                      )}\n                    </tr>\n\n                    {/* Expanded content row */}\n                    {expandable && isExpanded && (\n                      <tr>\n                        <td colSpan={\n                          columns.length +\n                          (selection ? 1 : 0) +\n                          (expandable ? 1 : 0) +\n                          (actions ? 1 : 0)\n                        } className=\"py-0 px-0\">\n                          <div className=\"bg-morandi-container/20 p-4 border-t border-border/50\">\n                            {expandable.renderExpanded(row)}\n                          </div>\n                        </td>\n                      </tr>\n                    )}\n                  </React.Fragment>\n                );\n              })\n            )}\n          </tbody>\n        </table>\n      </div>\n\n      {/* åˆ†é æ§åˆ¶ - æ°¸é é¡¯ç¤º */}\n      {processedData.length > 0 && (\n        <div className=\"p-2 sm:p-3 flex flex-col sm:flex-row items-center justify-between gap-2 sm:gap-3 border-t border-border bg-morandi-container/5\">\n          {/* å·¦å´ï¼šè³‡æ–™çµ±è¨ˆ */}\n          <div className=\"text-[10px] sm:text-xs text-morandi-secondary\">\n            é¡¯ç¤ºç¬¬ <span className=\"font-medium text-morandi-primary\">{startIndex + 1}</span> åˆ° <span className=\"font-medium text-morandi-primary\">{Math.min(startIndex + pageSize, processedData.length)}</span> ç­†ï¼Œ\n            å…± <span className=\"font-medium text-morandi-primary\">{processedData.length}</span> ç­†è³‡æ–™\n          </div>\n\n          {/* å³å´ï¼šåˆ†é æ§åˆ¶ */}\n          <div className=\"flex items-center gap-1.5 sm:gap-2\">\n            {/* æ¯é é¡¯ç¤ºç­†æ•¸ */}\n            <div className=\"flex items-center gap-1.5 sm:gap-2\">\n              <span className=\"text-[10px] sm:text-xs text-morandi-secondary\">æ¯é </span>\n              <Select value={pageSize.toString()} onValueChange={(value) => setPageSize(Number(value))}>\n                <SelectTrigger className=\"w-14 sm:w-16 h-7 sm:h-8 text-[10px] sm:text-xs\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"10\">10</SelectItem>\n                  <SelectItem value=\"15\">15</SelectItem>\n                  <SelectItem value=\"20\">20</SelectItem>\n                  <SelectItem value=\"50\">50</SelectItem>\n                  <SelectItem value=\"100\">100</SelectItem>\n                </SelectContent>\n              </Select>\n              <span className=\"text-[10px] sm:text-xs text-morandi-secondary\">ç­†</span>\n            </div>\n\n            {/* åˆ†é æŒ‰éˆ• - åªåœ¨æœ‰å¤šé æ™‚é¡¯ç¤º */}\n            {totalPages > 1 && (\n              <>\n                <div className=\"w-px h-5 sm:h-6 bg-border mx-0.5 sm:mx-1\"></div>\n\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}\n                  disabled={currentPage === 1}\n                  className=\"h-7 sm:h-8 px-2 sm:px-3 text-[10px] sm:text-xs\"\n                >\n                  ä¸Šä¸€é \n                </Button>\n\n                <div className=\"flex items-center gap-0.5 sm:gap-1\">\n                  {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                    let pageNum;\n                    if (totalPages <= 5) {\n                      pageNum = i + 1;\n                    } else if (currentPage <= 3) {\n                      pageNum = i + 1;\n                    } else if (currentPage >= totalPages - 2) {\n                      pageNum = totalPages - 4 + i;\n                    } else {\n                      pageNum = currentPage - 2 + i;\n                    }\n\n                    return (\n                      <Button\n                        key={pageNum}\n                        variant={currentPage === pageNum ? \"default\" : \"outline\"}\n                        size=\"sm\"\n                        onClick={() => setCurrentPage(pageNum)}\n                        className=\"w-7 h-7 sm:w-8 sm:h-8 p-0 text-[10px] sm:text-xs\"\n                      >\n                        {pageNum}\n                      </Button>\n                    );\n                  })}\n                </div>\n\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}\n                  disabled={currentPage === totalPages}\n                  className=\"h-7 sm:h-8 px-2 sm:px-3 text-[10px] sm:text-xs\"\n                >\n                  ä¸‹ä¸€é \n                </Button>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ä¾¿åˆ©çš„ Hook ç”¨æ–¼è™•ç†æ’åºå’Œç¯©é¸é‚è¼¯\nexport function useEnhancedTable<T>(\n  originalData: T[],\n  sortFunction?: (data: T[], column: string, direction: 'asc' | 'desc') => T[],\n  filterFunction?: (data: T[], filters: Record<string, string>) => T[]\n) {\n  const [sortedData, setSortedData] = useState(originalData);\n  const [filteredData, setFilteredData] = useState(originalData);\n\n  const handleSort = (column: string, direction: 'asc' | 'desc') => {\n    if (sortFunction) {\n      const sorted = sortFunction(filteredData, column, direction);\n      setSortedData(sorted);\n    }\n  };\n\n  const handleFilter = (filters: Record<string, string>) => {\n    if (filterFunction) {\n      const filtered = filterFunction(originalData, filters);\n      setFilteredData(filtered);\n      setSortedData(filtered);\n    }\n  };\n\n  return {\n    data: sortedData,\n    handleSort,\n    handleFilter\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/floating-dock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/focus-cards.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[209,212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[209,212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-redeclare","severity":1,"message":"'Card' is already defined.","line":60,"column":6,"nodeType":"Identifier","messageId":"redeclared","endLine":60,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nexport const Card = React.memo(\n  ({\n    card,\n    index,\n    hovered,\n    setHovered,\n    viewMode,\n  }: {\n    card: any;\n    index: number;\n    hovered: number | null;\n    setHovered: React.Dispatch<React.SetStateAction<number | null>>;\n    viewMode?: 'desktop' | 'mobile';\n  }) => (\n    <div\n      onMouseEnter={() => setHovered(index)}\n      onMouseLeave={() => setHovered(null)}\n      className={cn(\n        \"relative overflow-hidden transition-all duration-300 ease-out\",\n        viewMode === 'mobile' ? 'h-96 w-80 flex-shrink-0 rounded-2xl' : 'rounded-lg h-60 md:h-96 w-full bg-gray-100 dark:bg-neutral-900',\n        hovered !== null && hovered !== index && viewMode !== 'mobile' && \"blur-sm scale-[0.98]\"\n      )}\n    >\n      <img\n        src={card.src}\n        alt={card.title}\n        className=\"object-cover absolute inset-0 w-full h-full\"\n      />\n      {/* æ‰‹æ©Ÿç‰ˆï¼šæ¨™é¡Œç›´æ¥é¡¯ç¤º */}\n      {viewMode === 'mobile' ? (\n        <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent py-6 px-6\">\n          <div className=\"text-xl font-bold text-white\">\n            {card.title}\n          </div>\n        </div>\n      ) : (\n        // æ¡Œé¢ç‰ˆï¼šhover é¡¯ç¤º\n        <div\n          className={cn(\n            \"absolute inset-0 bg-black/50 flex items-end py-8 px-4 transition-opacity duration-300\",\n            hovered === index ? \"opacity-100\" : \"opacity-0\"\n          )}\n        >\n          <div className=\"text-xl md:text-2xl font-medium bg-clip-text text-transparent bg-gradient-to-b from-neutral-50 to-neutral-200\">\n            {card.title}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n);\n\nCard.displayName = \"Card\";\n\ntype Card = {\n  title: string;\n  src: string;\n};\n\nexport function FocusCards({ cards, viewMode }: { cards: Card[]; viewMode?: 'desktop' | 'mobile' }) {\n  const [hovered, setHovered] = useState<number | null>(null);\n\n  return (\n    <div className={viewMode === 'mobile' ? 'overflow-x-auto -mx-4 px-4' : 'grid grid-cols-1 md:grid-cols-3 gap-10 max-w-5xl mx-auto md:px-8 w-full'}>\n      <div className={viewMode === 'mobile' ? 'flex gap-4 pb-4' : 'contents'}>\n        {cards.map((card, index) => (\n          <Card\n            key={card.title}\n            card={card}\n            index={index}\n            hovered={hovered}\n            setHovered={setHovered}\n            viewMode={viewMode}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/glowing-stars.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/hero-parallax.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/location-select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/smart-date-input.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'placeholder' is assigned a value but never used. Allowed unused args must match /^_/u.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useRef, useEffect, useState } from 'react';\nimport { Input } from './input';\nimport { cn } from '@/lib/utils';\nimport { Calendar as CalendarIcon } from 'lucide-react';\nimport { DayPicker } from 'react-day-picker';\nimport { format, parse, isValid } from 'date-fns';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport 'react-day-picker/style.css';\n\ninterface SmartDateInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  min?: string;\n  className?: string;\n  placeholder?: string;\n  required?: boolean;\n  initialMonth?: string; // åˆå§‹é¡¯ç¤ºçš„æœˆä»½ï¼ˆYYYY-MM-DD æ ¼å¼ï¼‰\n}\n\nexport function SmartDateInput({\n  value,\n  onChange,\n  min,\n  className,\n  placeholder = 'YYYY-MM-DD',\n  required = false,\n  initialMonth\n}: SmartDateInputProps) {\n  const yearRef = useRef<HTMLInputElement>(null);\n  const monthRef = useRef<HTMLInputElement>(null);\n  const dayRef = useRef<HTMLInputElement>(null);\n  const [isCalendarOpen, setIsCalendarOpen] = useState(false);\n\n  // åˆ†è§£æ—¥æœŸå­—ä¸²\n  const parts = value ? value.split('-') : [];\n  const year = parts[0] || '';\n  const month = parts[1] || '';\n  const day = parts[2] || '';\n\n  // å°‡å­—ä¸²è½‰æ›ç‚º Date ç‰©ä»¶ç”¨æ–¼æ—¥æ›†\n  const dateValue = value ? parse(value, 'yyyy-MM-dd', new Date()) : undefined;\n  const minDate = min ? parse(min, 'yyyy-MM-dd', new Date()) : undefined;\n  const initialMonthDate = initialMonth ? parse(initialMonth, 'yyyy-MM-dd', new Date()) : undefined;\n\n  // å¾æ—¥æ›†é¸æ“‡æ—¥æœŸ\n  const handleCalendarSelect = (date: Date | undefined) => {\n    if (date) {\n      const formatted = format(date, 'yyyy-MM-dd');\n      onChange(formatted);\n      setIsCalendarOpen(false);\n    }\n  };\n\n  const handleYearChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const val = e.target.value.replace(/\\D/g, ''); // åªå…è¨±æ•¸å­—\n\n    // ç›´æ¥æ›´æ–°ï¼Œä¸è£œ0\n    onChange(val ? `${val}${month ? '-' + month : ''}${day ? '-' + day : ''}` : '');\n\n    // ç•¶è¼¸å…¥4ä½æ•¸æ™‚ï¼Œè‡ªå‹•è·³åˆ°æœˆä»½\n    if (val.length === 4) {\n      setTimeout(() => monthRef.current?.focus(), 0);\n    }\n  };\n\n  const handleMonthChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    let val = e.target.value.replace(/\\D/g, '');\n\n    // åªæœ‰ç•¶è¼¸å…¥å€¼å¤§æ–¼12æ™‚æ‰èª¿æ•´ç‚º12ï¼Œå…è¨± '0' é–‹é ­çš„è¼¸å…¥\n    if (val.length === 2 && parseInt(val) > 12) {\n      val = '12';\n    }\n\n    // å®Œæ•´è¼¸å…¥ \"00\" æ™‚æ¸…ç©ºï¼ˆä½†å…è¨±è¼¸å…¥éç¨‹ä¸­çš„ \"0\"ï¼‰\n    if (val === '00') {\n      val = '';\n    }\n\n    // ç›´æ¥æ›´æ–°ï¼Œä¸è£œ0\n    onChange(`${year}${val ? '-' + val : ''}${day ? '-' + day : ''}`);\n\n    // ç•¶è¼¸å…¥2ä½æ•¸æ™‚ï¼Œè‡ªå‹•è·³åˆ°æ—¥æœŸ\n    if (val.length === 2 && parseInt(val) > 0 && parseInt(val) <= 12) {\n      setTimeout(() => dayRef.current?.focus(), 0);\n    }\n  };\n\n  const handleDayChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    let val = e.target.value.replace(/\\D/g, '');\n\n    // åªæœ‰ç•¶è¼¸å…¥å€¼å¤§æ–¼31æ™‚æ‰èª¿æ•´ç‚º31ï¼Œå…è¨± '0' é–‹é ­çš„è¼¸å…¥\n    if (val.length === 2 && parseInt(val) > 31) {\n      val = '31';\n    }\n\n    // å®Œæ•´è¼¸å…¥ \"00\" æ™‚æ¸…ç©ºï¼ˆä½†å…è¨±è¼¸å…¥éç¨‹ä¸­çš„ \"0\"ï¼‰\n    if (val === '00') {\n      val = '';\n    }\n\n    // ç›´æ¥æ›´æ–°ï¼Œä¸è£œ0\n    onChange(`${year}${month ? '-' + month : ''}${val ? '-' + val : ''}`);\n  };\n\n  const handleKeyDown = (\n    e: React.KeyboardEvent<HTMLInputElement>,\n    type: 'year' | 'month' | 'day'\n  ) => {\n    // æŒ‰ä¸‹ Backspace æ™‚ï¼Œå¦‚æœç•¶å‰æ¬„ä½æ˜¯ç©ºçš„ï¼Œè·³åˆ°å‰ä¸€å€‹æ¬„ä½\n    if (e.key === 'Backspace') {\n      const input = e.currentTarget;\n      if (input.value.length === 0 || input.selectionStart === 0) {\n        if (type === 'day') monthRef.current?.focus();\n        if (type === 'month') yearRef.current?.focus();\n      }\n    }\n\n    // æŒ‰ä¸‹ / æˆ– - æ™‚ï¼Œè·³åˆ°ä¸‹ä¸€å€‹æ¬„ä½\n    if (e.key === '/' || e.key === '-') {\n      e.preventDefault();\n      if (type === 'year') monthRef.current?.focus();\n      if (type === 'month') dayRef.current?.focus();\n    }\n  };\n\n  return (\n    <div className={cn(\"flex items-center gap-1\", className)}>\n      <div className=\"flex items-center gap-1 px-3 h-10 border rounded-md bg-background flex-1\">\n        <input\n          ref={yearRef}\n          type=\"text\"\n          inputMode=\"numeric\"\n          value={year}\n          onChange={handleYearChange}\n          onKeyDown={(e) => handleKeyDown(e, 'year')}\n          placeholder=\"YYYY\"\n          className=\"w-14 bg-transparent outline-none text-center\"\n          maxLength={4}\n          required={required}\n        />\n        <span className=\"text-morandi-secondary\">/</span>\n        <input\n          ref={monthRef}\n          type=\"text\"\n          inputMode=\"numeric\"\n          value={month}\n          onChange={handleMonthChange}\n          onKeyDown={(e) => handleKeyDown(e, 'month')}\n          placeholder=\"MM\"\n          className=\"w-10 bg-transparent outline-none text-center\"\n          maxLength={2}\n          required={required}\n        />\n        <span className=\"text-morandi-secondary\">/</span>\n        <input\n          ref={dayRef}\n          type=\"text\"\n          inputMode=\"numeric\"\n          value={day}\n          onChange={handleDayChange}\n          onKeyDown={(e) => handleKeyDown(e, 'day')}\n          placeholder=\"DD\"\n          className=\"w-10 bg-transparent outline-none text-center\"\n          maxLength={2}\n          required={required}\n        />\n      </div>\n\n      <Popover open={isCalendarOpen} onOpenChange={setIsCalendarOpen}>\n        <PopoverTrigger asChild>\n          <button\n            type=\"button\"\n            className=\"h-10 w-10 flex items-center justify-center border rounded-md bg-background hover:bg-morandi-bg-subtle transition-colors\"\n            title=\"é¸æ“‡æ—¥æœŸ\"\n          >\n            <CalendarIcon className=\"h-4 w-4 text-morandi-primary\" />\n          </button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n          <DayPicker\n            mode=\"single\"\n            selected={dateValue && isValid(dateValue) ? dateValue : undefined}\n            onSelect={handleCalendarSelect}\n            disabled={minDate ? { before: minDate } : undefined}\n            defaultMonth={initialMonthDate && isValid(initialMonthDate) ? initialMonthDate : undefined}\n            className=\"p-3\"\n            classNames={{\n              months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n              month: \"space-y-4\",\n              caption: \"flex justify-center pt-1 relative items-center\",\n              caption_label: \"text-sm font-medium\",\n              nav: \"space-x-1 flex items-center\",\n              nav_button: \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\",\n              nav_button_previous: \"absolute left-1\",\n              nav_button_next: \"absolute right-1\",\n              table: \"w-full border-collapse space-y-1\",\n              head_row: \"flex\",\n              head_cell: \"text-morandi-secondary rounded-md w-9 font-normal text-[0.8rem]\",\n              row: \"flex w-full mt-2\",\n              cell: \"text-center text-sm p-0 relative [&:has([aria-selected])]:bg-morandi-bg-subtle first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n              day: \"h-9 w-9 p-0 font-normal aria-selected:opacity-100 hover:bg-morandi-bg-subtle rounded-md transition-colors\",\n              day_selected: \"bg-morandi-primary text-white hover:bg-morandi-primary hover:text-white focus:bg-morandi-primary focus:text-white\",\n              day_today: \"bg-morandi-bg-subtle text-morandi-primary\",\n              day_outside: \"text-morandi-secondary opacity-50\",\n              day_disabled: \"text-morandi-secondary opacity-50\",\n              day_range_middle: \"aria-selected:bg-morandi-bg-subtle aria-selected:text-morandi-primary\",\n              day_hidden: \"invisible\",\n            }}\n          />\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/star-rating.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/status-badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/thursday-date-picker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'dayNames' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport * as React from 'react'\nimport { format } from 'date-fns'\nimport { zhTW } from 'date-fns/locale'\nimport { Calendar as CalendarIcon, AlertCircle } from 'lucide-react'\n\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'\n\ninterface ThursdayDatePickerProps {\n  value: string // YYYY-MM-DD\n  onChange: (value: string) => void\n  disabled?: boolean\n  className?: string\n  allowAnyDay?: boolean // ç‰¹æ®Šè«‹æ¬¾å…è¨±ä»»ä½•æ—¥æœŸ\n}\n\nconst dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']\n\nexport function ThursdayDatePicker({\n  value,\n  onChange,\n  disabled = false,\n  className,\n  allowAnyDay = false,\n}: ThursdayDatePickerProps) {\n  const [date, setDate] = React.useState<Date | undefined>(\n    value ? new Date(value) : undefined\n  )\n  const [showWarning, setShowWarning] = React.useState(false)\n\n  // åŒæ­¥å¤–éƒ¨ value åˆ°å…§éƒ¨ state\n  React.useEffect(() => {\n    if (value) {\n      setDate(new Date(value))\n    } else {\n      setDate(undefined)\n    }\n  }, [value])\n\n  const handleSelect = (selectedDate: Date | undefined) => {\n    if (!selectedDate) {\n      setDate(undefined)\n      onChange('')\n      setShowWarning(false)\n      return\n    }\n\n    const dayOfWeek = selectedDate.getDay()\n    const isThursday = dayOfWeek === 4\n\n    // å¦‚æœä¸æ˜¯ç‰¹æ®Šè«‹æ¬¾ä¸”ä¸æ˜¯é€±å››ï¼Œé¡¯ç¤ºè­¦å‘Š\n    if (!allowAnyDay && !isThursday) {\n      setShowWarning(true)\n      setTimeout(() => setShowWarning(false), 3000) // 3ç§’å¾Œè‡ªå‹•éš±è—\n      return\n    }\n\n    setDate(selectedDate)\n    const formattedDate = format(selectedDate, 'yyyy-MM-dd')\n    onChange(formattedDate)\n    setShowWarning(false)\n  }\n\n  return (\n    <div>\n      <Popover>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            disabled={disabled}\n            className={cn(\n              'w-full justify-start text-left font-normal',\n              !date && 'text-muted-foreground',\n              allowAnyDay && 'bg-morandi-gold/10 border-morandi-gold/50',\n              className\n            )}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n            {date ? format(date, 'yyyy/MM/dd') : <span>é¸æ“‡æ—¥æœŸ</span>}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n          <Calendar\n            mode=\"single\"\n            selected={date}\n            onSelect={handleSelect}\n            locale={zhTW}\n            initialFocus\n          />\n        </PopoverContent>\n      </Popover>\n      {showWarning && (\n        <div className=\"mt-2 flex items-center gap-2 text-sm text-morandi-red\">\n          <AlertCircle size={16} />\n          <span>è«‹é¸æ“‡é€±å››ä½œç‚ºè«‹æ¬¾æ—¥æœŸ</span>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/tooltip.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1065,1068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1065,1068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport * as React from 'react';\n\nimport { cn } from '@/lib/utils';\n\ninterface TooltipContextValue {\n  open: boolean;\n  setOpen: (open: boolean) => void;\n}\n\nconst TooltipContext = React.createContext<TooltipContextValue>({\n  open: false,\n  setOpen: () => {},\n});\n\nexport function TooltipProvider({ children }: { children: React.ReactNode }) {\n  return <>{children}</>;\n}\n\nexport function Tooltip({ children }: { children: React.ReactNode }) {\n  const [open, setOpen] = React.useState(false);\n\n  return (\n    <TooltipContext.Provider value={{ open, setOpen }}>\n      <div className=\"relative inline-block\">{children}</div>\n    </TooltipContext.Provider>\n  );\n}\n\nexport function TooltipTrigger({\n  children,\n  asChild = false\n}: {\n  children: React.ReactNode;\n  asChild?: boolean;\n}) {\n  const { setOpen } = React.useContext(TooltipContext);\n\n  const handleMouseEnter = () => setOpen(true);\n  const handleMouseLeave = () => setOpen(false);\n\n  if (asChild && React.isValidElement(children)) {\n    return React.cloneElement(children as React.ReactElement<any>, {\n      onMouseEnter: handleMouseEnter,\n      onMouseLeave: handleMouseLeave,\n    });\n  }\n\n  return (\n    <div onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave}>\n      {children}\n    </div>\n  );\n}\n\nexport function TooltipContent({\n  children,\n  className,\n  ...props\n}: {\n  children: React.ReactNode;\n  className?: string;\n}) {\n  const { open } = React.useContext(TooltipContext);\n\n  if (!open) return null;\n\n  return (\n    <div\n      className={cn(\n        'absolute z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95',\n        'bottom-full left-1/2 -translate-x-1/2 mb-2',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/tracing-beam.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useVelocity' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport {\n  motion,\n  useTransform,\n  useScroll,\n  useVelocity,\n  useSpring,\n} from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\n\nexport const TracingBeam = ({\n  children,\n  className,\n}: {\n  children: React.ReactNode;\n  className?: string;\n}) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const { scrollYProgress } = useScroll({\n    target: ref,\n    offset: [\"start start\", \"end start\"],\n  });\n\n  const contentRef = useRef<HTMLDivElement>(null);\n  const [svgHeight, setSvgHeight] = useState(0);\n\n  useEffect(() => {\n    if (contentRef.current) {\n      setSvgHeight(contentRef.current.offsetHeight);\n    }\n  }, []);\n\n  const y1 = useSpring(\n    useTransform(scrollYProgress, [0, 0.8], [50, svgHeight]),\n    {\n      stiffness: 500,\n      damping: 90,\n    },\n  );\n  const y2 = useSpring(\n    useTransform(scrollYProgress, [0, 1], [50, svgHeight - 200]),\n    {\n      stiffness: 500,\n      damping: 90,\n    },\n  );\n\n  return (\n    <motion.div\n      ref={ref}\n      className={cn(\"relative mx-auto h-full w-full max-w-4xl\", className)}\n    >\n      <div className=\"absolute top-3 -left-4 md:-left-20\">\n        <motion.div\n          transition={{\n            duration: 0.2,\n            delay: 0.5,\n          }}\n          animate={{\n            boxShadow:\n              scrollYProgress.get() > 0\n                ? \"none\"\n                : \"rgba(0, 0, 0, 0.24) 0px 3px 8px\",\n          }}\n          className=\"border-netural-200 ml-[27px] flex h-4 w-4 items-center justify-center rounded-full border shadow-sm\"\n        >\n          <motion.div\n            transition={{\n              duration: 0.2,\n              delay: 0.5,\n            }}\n            animate={{\n              backgroundColor: scrollYProgress.get() > 0 ? \"white\" : \"#10b981\",\n              borderColor: scrollYProgress.get() > 0 ? \"white\" : \"#059669\",\n            }}\n            className=\"h-2 w-2 rounded-full border border-neutral-300 bg-white\"\n          />\n        </motion.div>\n        <svg\n          viewBox={`0 0 20 ${svgHeight}`}\n          width=\"20\"\n          height={svgHeight} // Set the SVG height\n          className=\"ml-4 block\"\n          aria-hidden=\"true\"\n        >\n          <motion.path\n            d={`M 1 0V -36 l 18 24 V ${svgHeight * 0.8} l -18 24V ${svgHeight}`}\n            fill=\"none\"\n            stroke=\"#9091A0\"\n            strokeOpacity=\"0.16\"\n            transition={{\n              duration: 10,\n            }}\n          ></motion.path>\n          <motion.path\n            d={`M 1 0V -36 l 18 24 V ${svgHeight * 0.8} l -18 24V ${svgHeight}`}\n            fill=\"none\"\n            stroke=\"url(#gradient)\"\n            strokeWidth=\"1.25\"\n            className=\"motion-reduce:hidden\"\n            transition={{\n              duration: 10,\n            }}\n          ></motion.path>\n          <defs>\n            <motion.linearGradient\n              id=\"gradient\"\n              gradientUnits=\"userSpaceOnUse\"\n              x1=\"0\"\n              x2=\"0\"\n              y1={y1} // set y1 for gradient\n              y2={y2} // set y2 for gradient\n            >\n              <stop stopColor=\"#18CCFC\" stopOpacity=\"0\"></stop>\n              <stop stopColor=\"#18CCFC\"></stop>\n              <stop offset=\"0.325\" stopColor=\"#6344F5\"></stop>\n              <stop offset=\"1\" stopColor=\"#AE48FF\" stopOpacity=\"0\"></stop>\n            </motion.linearGradient>\n          </defs>\n        </svg>\n      </div>\n      <div ref={contentRef}>{children}</div>\n    </motion.div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/ui/world-map.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/calculator-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calculator' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef } from 'react';\nimport { Calculator } from 'lucide-react';\n// import { useCalculator } from './calculator/useCalculator';\n// import { useCalculatorKeyboard } from './calculator/useCalculatorKeyboard';\n// import { CalculatorDisplay } from './calculator/CalculatorDisplay';\n// import { CalculatorButtons } from './calculator/CalculatorButtons';\n\n/**\n * è¨ˆç®—æ©Ÿä¸»å…ƒä»¶\n * - æ”¯æ´éµç›¤è¼¸å…¥ï¼ˆ0-9, +, -, *, /, Enter, Esc, Backspaceï¼‰\n * - æ”¯æ´è²¼ä¸ŠåŠŸèƒ½ï¼ˆè‡ªå‹•ç§»é™¤æ–‡å­—ã€è½‰æ›å…¨å½¢åŠå½¢ï¼‰\n * - é¡¯ç¤ºå®Œæ•´è¨ˆç®—å¼èˆ‡å³æ™‚çµæœ\n * - é›™æ“Š Backspaceï¼ˆåœ¨ 0 ç‹€æ…‹ä¸‹ï¼‰å¿«é€Ÿæ¸…é™¤è¨˜éŒ„\n */\nexport function CalculatorWidget() {\n  // TODO: å¯¦ä½œè¨ˆç®—æ©ŸåŠŸèƒ½\n  // éœ€è¦å¯¦ä½œ calculator å­æ¨¡çµ„æ‰èƒ½å•Ÿç”¨æ­¤åŠŸèƒ½\n  return <div className=\"p-4 text-morandi-secondary\">è¨ˆç®—æ©ŸåŠŸèƒ½é–‹ç™¼ä¸­...</div>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/calculator/calculator-buttons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/calculator/calculator-display.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/calculator/calculatorUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/calculator/useCalculator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/calculator/useCalculatorKeyboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/currency-widget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DollarSign' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Input } from '@/components/ui/input';\nimport { DollarSign } from 'lucide-react';\n// import { useCurrency } from './currency/useCurrency';\n// import { currencies } from './currency/currencyData';\n// import { getCurrencyInfo, getCurrentRate, convertAmount } from './currency/currencyUtils';\n// import { CurrencySelector } from './currency/CurrencySelector';\n// import { ExchangeRateDisplay } from './currency/ExchangeRateDisplay';\n\n/**\n * åŒ¯ç‡è½‰æ›å°å·¥å…·\n * - æ”¯æ´å¤šç¨®è²¨å¹£è½‰æ›\n * - å¯è‡ªè¨‚åŒ¯ç‡\n * - å³æ™‚é¡¯ç¤ºè½‰æ›çµæœ\n */\nexport function CurrencyWidget() {\n  // TODO: å¯¦ä½œè²¨å¹£è½‰æ›åŠŸèƒ½\n  // éœ€è¦å¯¦ä½œ currency å­æ¨¡çµ„æ‰èƒ½å•Ÿç”¨æ­¤åŠŸèƒ½\n  return <div className=\"p-4 text-morandi-secondary\">è²¨å¹£è½‰æ›åŠŸèƒ½é–‹ç™¼ä¸­...</div>;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/currency/currency-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/currency/currencyData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/currency/currencyUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/currency/exchange-rate-display.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/currency/useCurrency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/widgets/widget-settings-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/AdvanceListCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[285,288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[285,288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentUserId' is defined but never used. Allowed unused args must match /^_/u.","line":21,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Receipt, Check, Trash2 } from 'lucide-react';\nimport { AdvanceList } from '@/stores/workspace-store';\n\ninterface AdvanceListCardProps {\n  advanceList: AdvanceList;\n  userName?: string;\n  onCreatePayment: (itemId: string, item: any) => void;\n  onDelete?: (listId: string) => void;\n  currentUserId: string;\n  userRole?: 'admin' | 'finance' | 'member';\n}\n\nexport function AdvanceListCard({\n  advanceList,\n  userName = 'ä½¿ç”¨è€…',\n  onCreatePayment,\n  onDelete,\n  currentUserId,\n  userRole = 'member'\n}: AdvanceListCardProps) {\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set());\n\n  const pendingItems = advanceList.items.filter(item => item.status === 'pending');\n  const totalAmount = advanceList.items.reduce((sum, item) => sum + item.amount, 0);\n  const canProcess = userRole === 'admin' || userRole === 'finance';\n\n  const toggleSelection = (itemId: string) => {\n    const newSelected = new Set(selectedItems);\n    if (newSelected.has(itemId)) {\n      newSelected.delete(itemId);\n    } else {\n      newSelected.add(itemId);\n    }\n    setSelectedItems(newSelected);\n  };\n\n  const handleBatchPayment = () => {\n    const itemsToProcess = advanceList.items.filter(item => selectedItems.has(item.id));\n    if (itemsToProcess.length > 0) {\n      onCreatePayment('batch', itemsToProcess);\n    }\n  };\n\n  const handleDelete = () => {\n    if (window.confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ä»£å¢Šæ¸…å–®å—ï¼Ÿï¼ˆå·²å»ºç«‹çš„è«‹æ¬¾å–®ä¸æœƒè¢«åˆªé™¤ï¼‰')) {\n      onDelete?.(advanceList.id);\n    }\n  };\n\n  return (\n    <div className=\"card-morandi-elevated my-3\">\n      {/* æ¨™é¡Œ */}\n      <div className=\"flex items-start gap-2 mb-3\">\n        <Receipt className=\"text-morandi-gold shrink-0 mt-1\" size={20} />\n        <div className=\"flex-1\">\n          <div className=\"font-medium text-morandi-primary\">\n            {userName} åˆ†äº«äº†ä»£å¢Šæ¸…å–®\n          </div>\n          <div className=\"text-xs text-morandi-secondary mt-1\">\n            {new Date(advanceList.created_at).toLocaleString('zh-TW')}\n          </div>\n        </div>\n        {onDelete && (\n          <button\n            onClick={handleDelete}\n            className=\"btn-icon-morandi !w-8 !h-8 hover:bg-red-50 hover:text-red-600 transition-colors\"\n            title=\"åˆªé™¤ä»£å¢Šæ¸…å–®\"\n          >\n            <Trash2 size={16} />\n          </button>\n        )}\n      </div>\n\n      {/* ä»£å¢Šé …ç›®å¡ç‰‡ */}\n      <div className=\"bg-gradient-to-br from-morandi-container/5 to-morandi-container/10 rounded-lg p-4 border border-morandi-gold/20\">\n        {/* æ‘˜è¦è³‡è¨Š */}\n        <div className=\"flex items-center justify-between mb-3 pb-3 border-b border-morandi-gold/20\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm text-morandi-secondary\">ğŸ“‹ å¾…è«‹æ¬¾é …ç›®</span>\n            <span className=\"badge-morandi\">{pendingItems.length} ç­†</span>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-xs text-morandi-secondary\">ç¸½è¨ˆ</div>\n            <div className=\"text-lg font-semibold text-morandi-primary\">\n              ${totalAmount.toLocaleString()}\n            </div>\n          </div>\n        </div>\n\n        {/* é …ç›®åˆ—è¡¨ */}\n        <div className=\"space-y-2\">\n          {advanceList.items.map((item, index) => (\n            <div\n              key={item.id}\n              className={`flex items-center gap-3 p-2 rounded transition-colors ${\n                item.status === 'completed'\n                  ? 'bg-morandi-container/20 opacity-60'\n                  : 'hover:bg-morandi-container/10'\n              }`}\n            >\n              {/* åºè™Ÿ */}\n              <div className=\"text-sm font-medium text-morandi-secondary w-6\">\n                {index + 1}\n              </div>\n\n              {/* è¤‡é¸æ¡†ï¼ˆåƒ…æœªè™•ç†é …ç›®ä¸”æœ‰æ¬Šé™æ™‚é¡¯ç¤ºï¼‰ */}\n              {item.status === 'pending' && canProcess && (\n                <input\n                  type=\"checkbox\"\n                  checked={selectedItems.has(item.id)}\n                  onChange={() => toggleSelection(item.id)}\n                  className=\"w-4 h-4 rounded border-morandi-gold/30 text-morandi-gold focus:ring-morandi-gold/20\"\n                />\n              )}\n\n              {/* é …ç›®è³‡è¨Š */}\n              <div className=\"flex-1 grid grid-cols-4 gap-2 items-center\">\n                <div className=\"font-medium text-morandi-primary\">{item.name}</div>\n                <div className=\"text-sm text-morandi-secondary\">{item.description || '-'}</div>\n                <div className=\"text-sm font-medium text-morandi-primary\">\n                  ${item.amount.toLocaleString()}\n                </div>\n                <div className=\"text-sm text-morandi-secondary\">{item.advance_person}</div>\n              </div>\n\n              {/* æ“ä½œæŒ‰éˆ• */}\n              <div className=\"shrink-0 w-24\">\n                {item.status === 'completed' ? (\n                  <div className=\"flex items-center gap-1 text-xs text-morandi-secondary\">\n                    <Check size={14} className=\"text-green-600\" />\n                    <span>å·²è«‹æ¬¾</span>\n                  </div>\n                ) : canProcess ? (\n                  <button\n                    onClick={() => onCreatePayment(item.id, item)}\n                    className=\"btn-morandi-primary !py-1 !px-2 text-xs w-full\"\n                  >\n                    è«‹æ¬¾\n                  </button>\n                ) : (\n                  <div className=\"text-xs text-morandi-secondary text-center\">å¾…è™•ç†</div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* æ‰¹æ¬¡è«‹æ¬¾æŒ‰éˆ• */}\n        {canProcess && selectedItems.size > 0 && (\n          <div className=\"mt-3 pt-3 border-t border-morandi-gold/20 flex items-center justify-between\">\n            <span className=\"text-sm text-morandi-secondary\">\n              å·²é¸æ“‡ {selectedItems.size} ç­†é …ç›®\n            </span>\n            <button\n              onClick={handleBatchPayment}\n              className=\"btn-morandi-primary !py-1.5 !px-4 text-sm\"\n            >\n              æ‰¹æ¬¡è«‹æ¬¾\n            </button>\n          </div>\n        )}\n\n        {/* å·²è™•ç†è³‡è¨Š */}\n        {advanceList.items.some(item => item.status === 'completed') && (\n          <div className=\"mt-3 pt-3 border-t border-morandi-gold/20\">\n            <div className=\"text-xs text-morandi-secondary\">\n              {advanceList.items.filter(item => item.status === 'completed').length} ç­†å·²è™•ç†\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/BulletinBoard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2269,2272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2269,2272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getBorderColor' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":124,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":282,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9367,9370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9367,9370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Pin, Calendar, AlertCircle, Plus, Edit, Trash2, Building2 } from 'lucide-react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useWorkspaceStore } from '@/stores/workspace-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { format } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ninterface Bulletin {\n  id: string;\n  title: string;\n  content: string;\n  type: 'announcement' | 'notice' | 'event';\n  is_pinned: boolean;\n  author?: {\n    display_name: string;\n    english_name: string;\n  };\n  created_at: string;\n  updated_at: string;\n}\n\nexport function BulletinBoard() {\n  const [showAddDialog, setShowAddDialog] = useState(false);\n  const [editingBulletin, setEditingBulletin] = useState<Bulletin | null>(null);\n  const [newBulletin, setNewBulletin] = useState({\n    title: '',\n    content: '',\n    type: 'announcement' as const,\n    is_pinned: false\n  });\n\n  const {\n    bulletins,\n    currentWorkspace,\n    loading,\n    loadBulletins,\n    createBulletin,\n    updateBulletin,\n    deleteBulletin\n  } = useWorkspaceStore();\n\n  const { user } = useAuthStore();\n\n  useEffect(() => {\n    if (currentWorkspace?.id) {\n      loadBulletins(currentWorkspace.id);\n    }\n  }, [currentWorkspace?.id, loadBulletins]);\n\n  const handleSubmit = async () => {\n    if (!user?.id || !currentWorkspace?.id) return;\n\n    try {\n      if (editingBulletin) {\n        await updateBulletin(editingBulletin.id, newBulletin);\n        setEditingBulletin(null);\n      } else {\n        await createBulletin({\n          ...newBulletin,\n          workspace_id: currentWorkspace.id,\n          author_id: user.id,\n          priority: newBulletin.is_pinned ? 10 : 0\n        });\n      }\n\n      setShowAddDialog(false);\n      resetForm();\n    } catch (error) {\n      console.error('æ“ä½œå¤±æ•—:', error);\n    }\n  };\n\n  const handleEdit = (bulletin: Bulletin) => {\n    setNewBulletin({\n      title: bulletin.title,\n      content: bulletin.content,\n      type: bulletin.type as any,\n      is_pinned: bulletin.is_pinned\n    });\n    setEditingBulletin(bulletin);\n    setShowAddDialog(true);\n  };\n\n  const handleDelete = async (bulletinId: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡å…¬å‘Šå—ï¼Ÿ')) {\n      await deleteBulletin(bulletinId);\n    }\n  };\n\n  const resetForm = () => {\n    setNewBulletin({ title: '', content: '', type: 'announcement', is_pinned: false });\n    setEditingBulletin(null);\n  };\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case 'announcement':\n        return <AlertCircle className=\"w-4 h-4 text-morandi-gold\" />;\n      case 'notice':\n        return <AlertCircle className=\"w-4 h-4 text-morandi-red\" />;\n      case 'event':\n        return <Calendar className=\"w-4 h-4 text-morandi-green\" />;\n      default:\n        return <AlertCircle className=\"w-4 h-4 text-morandi-secondary\" />;\n    }\n  };\n\n  const getTypeLabel = (type: string) => {\n    const labels = {\n      'announcement': 'ä¸€èˆ¬å…¬å‘Š',\n      'notice': 'é‡è¦é€šçŸ¥',\n      'event': 'æ´»å‹•è¨Šæ¯'\n    };\n    return labels[type as keyof typeof labels] || type;\n  };\n\n  const getBorderColor = (type: string, is_pinned: boolean) => {\n    if (is_pinned) return 'border-morandi-gold';\n    switch (type) {\n      case 'notice': return 'border-morandi-red/30';\n      case 'event': return 'border-morandi-green/30';\n      default: return 'border-border';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"bg-card border-b border-border px-6 py-4\">\n        <div className=\"animate-pulse space-y-4 px-6 py-4\">\n          {[...Array(3)].map((_, i) => (\n            <div key={i} className=\"morandi-card p-4 h-32\"></div>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* é ‚éƒ¨æ“ä½œåˆ— */}\n      <div className=\"morandi-card p-6\">\n        <div className=\"flex justify-between items-center\">\n          <div>\n            <h2 className=\"text-lg sm:text-xl font-bold text-morandi-primary\">å…¬å‘Šæ¬„</h2>\n            <p className=\"text-xs sm:text-sm text-morandi-secondary mt-1\">\n              {currentWorkspace?.name || 'å·¥ä½œç©ºé–“'} çš„æœ€æ–°æ¶ˆæ¯\n            </p>\n          </div>\n          <Button\n            onClick={() => setShowAddDialog(true)}\n            className=\"bg-morandi-gold hover:bg-morandi-gold/80 text-white border-0\"\n          >\n            <Plus size={16} className=\"mr-2\" />\n            <span className=\"hidden sm:inline\">ç™¼å¸ƒå…¬å‘Š</span>\n            <span className=\"sm:hidden\">ç™¼å¸ƒ</span>\n          </Button>\n        </div>\n      </div>\n\n      {/* å…¬å‘Šåˆ—è¡¨ */}\n      <div className=\"space-y-4\">\n        {bulletins.length === 0 ? (\n          <div className=\"morandi-card p-8 text-center\">\n            <Building2 className=\"w-12 h-12 mx-auto mb-4 text-morandi-secondary opacity-50\" />\n            <p className=\"text-morandi-secondary\">ç›®å‰æ²’æœ‰ä»»ä½•å…¬å‘Š</p>\n            <p className=\"text-sm text-morandi-secondary/70 mt-1\">\n              é»æ“Šä¸Šæ–¹æŒ‰éˆ•ç™¼å¸ƒç¬¬ä¸€å‰‡å…¬å‘Š\n            </p>\n          </div>\n        ) : (\n          bulletins.map(bulletin => (\n            <div\n              key={bulletin.id}\n              className={cn(\n                \"morandi-card p-6 transition-all hover:shadow-md\",\n                bulletin.is_pinned && \"border-morandi-gold bg-morandi-gold/5\"\n              )}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {bulletin.is_pinned && (\n                      <Pin className=\"w-4 h-4 text-morandi-gold fill-morandi-gold\" />\n                    )}\n                    {getTypeIcon(bulletin.type)}\n                    <span className=\"text-xs px-2 py-1 rounded-full bg-morandi-container text-morandi-secondary\">\n                      {getTypeLabel(bulletin.type)}\n                    </span>\n                    <h3 className=\"font-semibold text-morandi-primary text-sm sm:text-base\">\n                      {bulletin.title}\n                    </h3>\n                  </div>\n\n                  <p className=\"text-morandi-secondary whitespace-pre-wrap mb-3 leading-relaxed\">\n                    {bulletin.content}\n                  </p>\n\n                  <div className=\"flex items-center gap-4 text-sm text-morandi-secondary\">\n                    <span>\n                      {bulletin.author?.display_name || 'ç³»çµ±'}\n                    </span>\n                    <span>\n                      {format(new Date(bulletin.created_at), 'yyyy/MM/dd HH:mm')}\n                    </span>\n                    {bulletin.created_at !== bulletin.updated_at && (\n                      <span className=\"text-xs\">(å·²ç·¨è¼¯)</span>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"flex gap-1 ml-4\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"w-8 h-8 hover:bg-morandi-container text-morandi-secondary hover:text-morandi-primary\"\n                    onClick={() => handleEdit(bulletin)}\n                    title=\"ç·¨è¼¯å…¬å‘Š\"\n                  >\n                    <Edit size={14} />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"w-8 h-8 hover:bg-morandi-container text-morandi-secondary hover:text-morandi-red\"\n                    onClick={() => handleDelete(bulletin.id)}\n                    title=\"åˆªé™¤å…¬å‘Š\"\n                  >\n                    <Trash2 size={14} />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      {/* æ–°å¢/ç·¨è¼¯å…¬å‘Šå°è©±æ¡† */}\n      <Dialog open={showAddDialog} onOpenChange={(open) => {\n        setShowAddDialog(open);\n        if (!open) resetForm();\n      }}>\n        <DialogContent className=\"max-w-md morandi-card border-0\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingBulletin ? 'ç·¨è¼¯å…¬å‘Š' : 'ç™¼å¸ƒæ–°å…¬å‘Š'}\n            </DialogTitle>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ¨™é¡Œ</label>\n              <Input\n                value={newBulletin.title}\n                onChange={(e) => setNewBulletin({...newBulletin, title: e.target.value})}\n                className=\"mt-1\"\n                placeholder=\"è«‹è¼¸å…¥å…¬å‘Šæ¨™é¡Œ\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">å…§å®¹</label>\n              <Textarea\n                value={newBulletin.content}\n                onChange={(e) => setNewBulletin({...newBulletin, content: e.target.value})}\n                className=\"mt-1 min-h-[120px]\"\n                placeholder=\"è«‹è¼¸å…¥å…¬å‘Šå…§å®¹\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <label className=\"text-sm font-medium text-morandi-primary\">é¡å‹</label>\n                <select\n                  value={newBulletin.type}\n                  onChange={(e) => setNewBulletin({...newBulletin, type: e.target.value as any})}\n                  className=\"mt-1 px-3 py-2 border border-border rounded-md text-sm\"\n                >\n                  <option value=\"announcement\">ä¸€èˆ¬å…¬å‘Š</option>\n                  <option value=\"notice\">é‡è¦é€šçŸ¥</option>\n                  <option value=\"event\">æ´»å‹•è¨Šæ¯</option>\n                </select>\n              </div>\n\n              <label className=\"flex items-center gap-2 text-sm\">\n                <input\n                  type=\"checkbox\"\n                  checked={newBulletin.is_pinned}\n                  onChange={(e) => setNewBulletin({...newBulletin, is_pinned: e.target.checked})}\n                  className=\"rounded\"\n                />\n                <span>ç½®é ‚å…¬å‘Š</span>\n              </label>\n            </div>\n\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowAddDialog(false)}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleSubmit}\n                className=\"bg-morandi-gold hover:bg-morandi-gold/80 text-morandi-primary border-0\"\n                disabled={!newBulletin.title.trim() || !newBulletin.content.trim()}\n              >\n                {editingBulletin ? 'æ›´æ–°' : 'ç™¼å¸ƒ'}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/CanvasEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/ChannelChat.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MoreHorizontal' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link2' is defined but never used. Allowed unused vars must match /^_/u.","line":31,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ShoppingCart' is defined but never used. Allowed unused vars must match /^_/u.","line":34,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FinanceAlertDialog' is defined but never used. Allowed unused vars must match /^_/u.","line":48,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FinanceAlertCard' is defined but never used. Allowed unused vars must match /^_/u.","line":49,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3141,3144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3141,3144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3218,3221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3218,3221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showChannelForm' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":86,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":86,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'processAdvanceItem' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":115,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateOrderReceiptStatus' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":116,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadChannels'. Either include it or remove the dependency array.","line":138,"column":6,"nodeType":"ArrayExpression","endLine":138,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [currentWorkspace.id, loadChannels]","fix":{"range":[4811,4833],"text":"[currentWorkspace.id, loadChannels]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'channelMessages', 'loadAdvanceLists', 'loadMessages', 'loadSharedOrderLists', and 'messages'. Either include them or remove the dependency array.","line":190,"column":6,"nodeType":"ArrayExpression","endLine":190,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [channelMessages, loadAdvanceLists, loadMessages, loadSharedOrderLists, messages, selectedChannel.id]","fix":{"range":[6264,6285],"text":"[channelMessages, loadAdvanceLists, loadMessages, loadSharedOrderLists, messages, selectedChannel.id]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'currentMessages' conditional could make the dependencies of useEffect Hook (at line 209) change on every render. To fix this, wrap the initialization of 'currentMessages' in its own useMemo() Hook.","line":203,"column":9,"nodeType":"VariableDeclarator","endLine":205,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleCreateChannel' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":265,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":265,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport {\n  Hash,\n  Users,\n  Send,\n  Plus,\n  Settings,\n  Smile,\n  MoreHorizontal,\n  Trash2,\n  Paperclip,\n  X,\n  FileText,\n  Image as ImageIcon,\n  Receipt,\n  DollarSign,\n  CheckSquare,\n  Link2,\n  TrendingUp,\n  Download,\n  ShoppingCart,\n  Wallet,\n  AlertTriangle\n} from 'lucide-react';\nimport { useWorkspaceStore, type Message } from '@/stores/workspace-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { format, isToday, isYesterday } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport { useAutoCreateTourChannels } from '@/hooks/use-auto-create-tour-channels';\nimport { useCleanupOrphanChannels } from '@/hooks/use-cleanup-orphan-channels';\nimport { ChannelSidebar } from './ChannelSidebar';\nimport { ChannelTabs } from './ChannelTabs';\nimport { ShareAdvanceDialog } from './ShareAdvanceDialog';\nimport { AdvanceListCard } from './AdvanceListCard';\nimport { FinanceAlertDialog } from './FinanceAlertDialog';\nimport { FinanceAlertCard } from './FinanceAlertCard';\nimport { ShareOrdersDialog } from './ShareOrdersDialog';\nimport { OrderListCard } from './OrderListCard';\nimport { CreateReceiptDialog } from './CreateReceiptDialog';\nimport { CreatePaymentRequestDialog } from './CreatePaymentRequestDialog';\n\n\nconst downloadFile = (path: string, bucket: string, fileName: string) => {\n  console.log('ğŸ“¦ æœ¬åœ°æ¨¡å¼ï¼šæª”æ¡ˆä¸‹è¼‰åŠŸèƒ½æš«æ™‚åœç”¨', { path, bucket, fileName });\n  alert('æª”æ¡ˆä¸‹è¼‰åŠŸèƒ½ç›®å‰åƒ…æ”¯æ´ç·šä¸Šæ¨¡å¼');\n};\n\nexport function ChannelChat() {\n  // âŒ ç§»é™¤æœ¬åœ° stateï¼Œæ”¹ç”¨ store ç®¡ç†\n  // const [selectedChannel, setSelectedChannel] = useState<any>(null);\n  const [messageText, setMessageText] = useState('');\n  const [showMemberSidebar, setShowMemberSidebar] = useState(false);\n  const [attachedFiles, setAttachedFiles] = useState<File[]>([]);\n  const [isDragging, setIsDragging] = useState(false);\n  const [channelMessages, setChannelMessages] = useState<Record<string, Message[]>>({});\n  const [isLoadingMessages, setIsLoadingMessages] = useState(false);\n  const [isSwitching, setIsSwitching] = useState(false);\n  const [showQuickMenu, setShowQuickMenu] = useState(false);\n  const [showShareQuoteDialog, setShowShareQuoteDialog] = useState(false);\n  const [showShareTourDialog, setShowShareTourDialog] = useState(false);\n  const [showNewPaymentDialog, setShowNewPaymentDialog] = useState(false);\n  const [showNewReceiptDialog, setShowNewReceiptDialog] = useState(false);\n  const [showNewTaskDialog, setShowNewTaskDialog] = useState(false);\n  const [showShareAdvanceDialog, setShowShareAdvanceDialog] = useState(false);\n  const [showShareOrdersDialog, setShowShareOrdersDialog] = useState(false);\n  const [showCreateReceiptDialog, setShowCreateReceiptDialog] = useState(false);\n  const [showCreatePaymentDialog, setShowCreatePaymentDialog] = useState(false);\n  const [selectedOrder, setSelectedOrder] = useState<any>(null);\n  const [selectedAdvanceItem, setSelectedAdvanceItem] = useState<any>(null);\n  const [selectedAdvanceListId, setSelectedAdvanceListId] = useState<string>('');\n  const [uploadingFiles, setUploadingFiles] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [showChannelForm, setShowChannelForm] = useState(false);\n  const [newChannelName, setNewChannelName] = useState('');\n  const [showSettingsDialog, setShowSettingsDialog] = useState(false);\n  const [editChannelName, setEditChannelName] = useState('');\n  const [editChannelDescription, setEditChannelDescription] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const messageInputRef = useRef<HTMLDivElement>(null);\n  const quickMenuRef = useRef<HTMLDivElement>(null);\n\n  const {\n    channels,\n    messages,\n    currentWorkspace,\n    loading,\n    selectedChannel,      // âœ¨ å¾ store å–å¾—\n    selectChannel,        // âœ¨ å¾ store å–å¾—\n    loadChannels,\n    createChannel,\n    updateChannel,\n    deleteChannel,\n    loadMessages,\n    sendMessage,\n    updateMessageReactions,\n    advanceLists,\n    sharedOrderLists,\n    loadAdvanceLists,\n    loadSharedOrderLists,\n    deleteAdvanceList,\n    processAdvanceItem,\n    updateOrderReceiptStatus\n  } = useWorkspaceStore();\n\n  const { user, currentProfile } = useAuthStore();\n\n\n  useAutoCreateTourChannels();\n\n\n  useCleanupOrphanChannels();\n\n  useEffect(() => {\n    console.log('ChannelChat - ç”¨æˆ¶ç‹€æ…‹:', user);\n  }, [user]);\n\n\n  useEffect(() => {\n    if (currentWorkspace?.id) {\n      console.log('è¼‰å…¥é »é“åˆ—è¡¨...');\n      loadChannels(currentWorkspace.id);\n    }\n\n  }, [currentWorkspace?.id]);\n\n  useEffect(() => {\n    if (channels.length > 0 && !selectedChannel) {\n      const defaultChannel = channels.find(c => c.name === 'ä¸€èˆ¬è¨è«–') || channels[0];\n      selectChannel(defaultChannel);  // âœ¨ æ”¹ç”¨ store çš„ selectChannel\n    }\n  }, [channels, selectedChannel, selectChannel]);\n\n\n  useEffect(() => {\n    if (showSettingsDialog && selectedChannel) {\n      setEditChannelName(selectedChannel.name);\n      setEditChannelDescription(selectedChannel.description || '');\n    }\n  }, [showSettingsDialog, selectedChannel]);\n\n\n  useEffect(() => {\n    if (selectedChannel?.id) {\n\n      if (!channelMessages[selectedChannel.id]) {\n        console.log('è¼‰å…¥è¨Šæ¯åˆ—è¡¨...', selectedChannel.id);\n        setIsLoadingMessages(true);\n        Promise.all([\n          loadMessages(selectedChannel.id),\n          loadAdvanceLists(selectedChannel.id),\n          loadSharedOrderLists(selectedChannel.id)\n        ]).then(() => {\n          setIsLoadingMessages(false);\n\n          setChannelMessages(prev => ({\n            ...prev,\n            [selectedChannel.id]: messages\n          }));\n        });\n      } else {\n\n        Promise.all([\n          loadMessages(selectedChannel.id),\n          loadAdvanceLists(selectedChannel.id),\n          loadSharedOrderLists(selectedChannel.id)\n        ]).then(() => {\n\n          setChannelMessages(prev => ({\n            ...prev,\n            [selectedChannel.id]: messages\n          }));\n        });\n      }\n    }\n\n  }, [selectedChannel?.id]);\n\n\n  useEffect(() => {\n    if (selectedChannel?.id && messages.length > 0) {\n      setChannelMessages(prev => ({\n        ...prev,\n        [selectedChannel.id]: messages\n      }));\n    }\n  }, [messages, selectedChannel?.id]);\n\n\n  const currentMessages = selectedChannel?.id \n    ? (channelMessages[selectedChannel.id] || messages) \n    : [];\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [currentMessages]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    console.log('å˜—è©¦ç™¼é€è¨Šæ¯:', { messageText, selectedChannel, user, attachedFiles });\n\n    if (!messageText.trim() && attachedFiles.length === 0) {\n      console.log('è¨Šæ¯å…§å®¹ç‚ºç©ºä¸”ç„¡é™„ä»¶');\n      return;\n    }\n\n    if (!selectedChannel) {\n      console.log('æœªé¸æ“‡é »é“');\n      return;\n    }\n\n    if (!user) {\n      console.log('ç”¨æˆ¶æœªç™»å…¥');\n      alert('è«‹å…ˆç™»å…¥æ‰èƒ½ç™¼é€è¨Šæ¯');\n      return;\n    }\n\n    try {\n      setUploadingFiles(true);\n      setUploadProgress(0);\n\n      await sendMessage({\n        channel_id: selectedChannel.id,\n        author_id: user.id,\n        content: messageText.trim() || 'ï¼ˆå‚³é€äº†é™„ä»¶ï¼‰',\n        author: {\n          id: user.id,\n          display_name: currentProfile?.display_name || user.display_name || 'æœªçŸ¥ç”¨æˆ¶',\n          avatar: undefined\n        },\n        attachments: attachedFiles.length > 0 ? attachedFiles : undefined\n      });\n\n      setMessageText('');\n      setAttachedFiles([]);\n      setUploadProgress(100);\n      console.log('è¨Šæ¯ç™¼é€æˆåŠŸ');\n    } catch (error) {\n      console.error('ç™¼é€è¨Šæ¯å¤±æ•—:', error);\n      alert('ç™¼é€è¨Šæ¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setUploadingFiles(false);\n      setTimeout(() => setUploadProgress(0), 1000);\n    }\n  };\n\n  const handleCreateChannel = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newChannelName.trim() || !currentWorkspace) return;\n\n    try {\n      await createChannel({\n        workspace_id: currentWorkspace.id,\n        name: newChannelName.toLowerCase().replace(/\\s+/g, '-'),\n        type: 'public',\n        created_by: user?.id\n      });\n      setNewChannelName('');\n      setShowChannelForm(false);\n    } catch (error) {\n      console.error('å»ºç«‹é »é“å¤±æ•—:', error);\n    }\n  };\n\n  const handleReaction = async (messageId: string, emoji: string) => {\n    if (!user) return;\n\n    const message = messages.find(m => m.id === messageId);\n    if (!message) return;\n\n    const currentReactions = { ...message.reactions };\n    if (!currentReactions[emoji]) {\n      currentReactions[emoji] = [];\n    }\n\n    const userIndex = currentReactions[emoji].indexOf(user.id);\n    if (userIndex > -1) {\n      currentReactions[emoji].splice(userIndex, 1);\n      if (currentReactions[emoji].length === 0) {\n        delete currentReactions[emoji];\n      }\n    } else {\n      currentReactions[emoji].push(user.id);\n    }\n\n    await updateMessageReactions(messageId, currentReactions);\n  };\n\n  const formatMessageTime = (dateString: string) => {\n    if (!dateString) return '';\n    const date = new Date(dateString);\n    if (isNaN(date.getTime())) return '';\n\n    if (isToday(date)) {\n      return format(date, 'HH:mm');\n    } else if (isYesterday(date)) {\n      return `æ˜¨å¤© ${format(date, 'HH:mm')}`;\n    } else {\n      return format(date, 'MM/dd HH:mm');\n    }\n  };\n\n\n  const MAX_FILE_SIZE = 10 * 1024 * 1024;\n  const ALLOWED_FILE_TYPES = {\n    'image/*': ['.jpg', '.jpeg', '.png', '.gif', '.webp'],\n    'application/pdf': ['.pdf'],\n    'application/msword': ['.doc'],\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],\n    'application/vnd.ms-excel': ['.xls'],\n    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],\n    'text/plain': ['.txt']\n  };\n\n\n  const validateFile = (file: File): { valid: boolean; error?: string } => {\n\n    if (file.size > MAX_FILE_SIZE) {\n      return {\n        valid: false,\n        error: `æª”æ¡ˆ \"${file.name}\" è¶…é 10 MB é™åˆ¶ (${formatFileSize(file.size)})`\n      };\n    }\n\n\n    const isValidType = Object.keys(ALLOWED_FILE_TYPES).some(type => {\n      if (type.endsWith('/*')) {\n        return file.type.startsWith(type.replace('/*', '/'));\n      }\n      return file.type === type;\n    });\n\n    if (!isValidType) {\n      const fileExtension = '.' + file.name.split('.').pop()?.toLowerCase();\n      const isValidExtension = Object.values(ALLOWED_FILE_TYPES)\n        .flat()\n        .includes(fileExtension);\n\n      if (!isValidExtension) {\n        return {\n          valid: false,\n          error: `ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼ \"${file.name}\" (åƒ…æ”¯æ´åœ–ç‰‡ã€PDFã€Wordã€Excelã€æ–‡å­—æª”)`\n        };\n      }\n    }\n\n    return { valid: true };\n  };\n\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    const validFiles: File[] = [];\n    const errors: string[] = [];\n\n    files.forEach(file => {\n      const validation = validateFile(file);\n      if (validation.valid) {\n        validFiles.push(file);\n      } else if (validation.error) {\n        errors.push(validation.error);\n      }\n    });\n\n    if (errors.length > 0) {\n      alert(errors.join('\\n'));\n    }\n\n    if (validFiles.length > 0) {\n      setAttachedFiles(prev => [...prev, ...validFiles]);\n    }\n\n\n    if (e.target) {\n      e.target.value = '';\n    }\n  };\n\n  const handleRemoveFile = (index: number) => {\n    setAttachedFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    const files = Array.from(e.dataTransfer.files);\n    const validFiles: File[] = [];\n    const errors: string[] = [];\n\n    files.forEach(file => {\n      const validation = validateFile(file);\n      if (validation.valid) {\n        validFiles.push(file);\n      } else if (validation.error) {\n        errors.push(validation.error);\n      }\n    });\n\n    if (errors.length > 0) {\n      alert(errors.join('\\n'));\n    }\n\n    if (validFiles.length > 0) {\n      setAttachedFiles(prev => [...prev, ...validFiles]);\n    }\n  };\n\n  const handlePaste = (e: React.ClipboardEvent) => {\n    const items = e.clipboardData.items;\n    const files: File[] = [];\n\n    for (let i = 0; i < items.length; i++) {\n      if (items[i].kind === 'file') {\n        const file = items[i].getAsFile();\n        if (file) files.push(file);\n      }\n    }\n\n    if (files.length > 0) {\n      e.preventDefault();\n      const validFiles: File[] = [];\n      const errors: string[] = [];\n\n      files.forEach(file => {\n        const validation = validateFile(file);\n        if (validation.valid) {\n          validFiles.push(file);\n        } else if (validation.error) {\n          errors.push(validation.error);\n        }\n      });\n\n      if (errors.length > 0) {\n        alert(errors.join('\\n'));\n      }\n\n      if (validFiles.length > 0) {\n        setAttachedFiles(prev => [...prev, ...validFiles]);\n      }\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n  };\n\n\n  const quickMenuActions = [\n    {\n      id: 'share-order',\n      icon: Receipt,\n      label: 'åˆ†äº«å¾…æ”¶æ¬¾',\n      color: 'text-indigo-600',\n      action: () => {\n        setShowShareOrdersDialog(true);\n        setShowQuickMenu(false);\n      }\n    },\n    {\n      id: 'share-quote',\n      icon: Receipt,\n      label: 'åˆ†äº«å ±åƒ¹å–®',\n      color: 'text-blue-600',\n      action: () => {\n        setShowShareQuoteDialog(true);\n        setShowQuickMenu(false);\n      }\n    },\n    {\n      id: 'new-payment',\n      icon: DollarSign,\n      label: 'æ–°å¢è«‹æ¬¾å–®',\n      color: 'text-orange-600',\n      action: () => {\n        setShowNewPaymentDialog(true);\n        setShowQuickMenu(false);\n      }\n    },\n    {\n      id: 'new-receipt',\n      icon: DollarSign,\n      label: 'æ–°å¢æ”¶æ¬¾å–®',\n      color: 'text-emerald-600',\n      action: () => {\n        setShowNewReceiptDialog(true);\n        setShowQuickMenu(false);\n      }\n    },\n    {\n      id: 'share-advance',\n      icon: Wallet,\n      label: 'åˆ†äº«ä»£å¢Šæ¸…å–®',\n      color: 'text-purple-600',\n      action: () => {\n        setShowShareAdvanceDialog(true);\n        setShowQuickMenu(false);\n      }\n    },\n    {\n      id: 'new-task',\n      icon: CheckSquare,\n      label: 'æ–°å¢ä»»å‹™',\n      color: 'text-morandi-gold',\n      action: () => {\n        setShowNewTaskDialog(true);\n        setShowQuickMenu(false);\n      }\n    },\n    {\n      id: 'upload-file',\n      icon: Paperclip,\n      label: 'ä¸Šå‚³æª”æ¡ˆ',\n      color: 'text-morandi-secondary',\n      action: () => {\n        fileInputRef.current?.click();\n        setShowQuickMenu(false);\n      }\n    }\n  ];\n\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (quickMenuRef.current && !quickMenuRef.current.contains(event.target as Node)) {\n        setShowQuickMenu(false);\n      }\n    };\n\n    if (showQuickMenu) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [showQuickMenu]);\n\n  if (loading && channels.length === 0) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-2 border-morandi-gold border-t-transparent rounded-full\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full flex rounded-lg border border-border overflow-hidden bg-white\">\n      {/* é »é“å´é‚Šæ¬„ - ä½¿ç”¨æ–°çš„ ChannelSidebar çµ„ä»¶ */}\n      <ChannelSidebar\n        selectedChannelId={selectedChannel?.id || null}\n        onSelectChannel={(channel) => {\n          if (selectedChannel?.id !== channel.id) {\n            // è¨­å®šåˆ‡æ›ç‹€æ…‹ï¼Œç”¢ç”Ÿæ·¡å‡ºæ•ˆæœ\n            setIsSwitching(true);\n\n            // 150ms å¾Œåˆ‡æ›é »é“\n            setTimeout(() => {\n              selectChannel(channel);  // âœ¨ æ”¹ç”¨ store çš„ selectChannel\n\n              // å† 150ms å¾Œç§»é™¤åˆ‡æ›ç‹€æ…‹ï¼Œç”¢ç”Ÿæ·¡å…¥æ•ˆæœ\n              setTimeout(() => setIsSwitching(false), 150);\n            }, 150);\n          }\n        }}\n      />\n\n      {/* ä¸»è¦èŠå¤©å€åŸŸ - ä½¿ç”¨ ChannelTabs åŒ…è£¹ */}\n      <div className=\"flex-1 flex flex-col min-w-0\">\n        {selectedChannel ? (\n        <ChannelTabs\n          channel={selectedChannel}\n          headerActions={\n            <div className=\"flex items-center gap-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"w-8 h-8\"\n                onClick={() => setShowMemberSidebar(!showMemberSidebar)}\n              >\n                <Users size={16} />\n              </Button>\n            </div>\n          }\n        >\n\n            {/* è¨Šæ¯èˆ‡æˆå“¡å€åŸŸ */}\n            <div className=\"flex-1 flex min-h-0\">\n              {/* è¨Šæ¯å€åŸŸ */}\n              <div className={cn(\n                \"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 transition-opacity duration-150\",\n                isSwitching ? \"opacity-0\" : \"opacity-100\"\n              )}>\n              {isLoadingMessages ? (\n                <div className=\"flex items-center justify-center h-full\">\n                  <div className=\"animate-spin w-6 h-6 border-2 border-morandi-gold border-t-transparent rounded-full\"></div>\n                </div>\n              ) : currentMessages.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full text-center\">\n                  <Hash size={48} className=\"text-morandi-secondary/50 mb-4\" />\n                  <h3 className=\"text-lg font-medium text-morandi-primary mb-2\">\n                    æ­¡è¿ä¾†åˆ° #{selectedChannel.name}\n                  </h3>\n                  <p className=\"text-morandi-secondary\">\n                    é€™è£¡é‚„æ²’æœ‰ä»»ä½•è¨Šæ¯ã€‚é–‹å§‹å°è©±å§ï¼\n                  </p>\n                </div>\n              ) : (\n                currentMessages.map(message => (\n                  <div key={message.id} className=\"flex gap-3 group hover:bg-morandi-container/5 -mx-2 px-3 py-1.5 rounded transition-colors\">\n                    {/* ç”¨æˆ¶é ­åƒ */}\n                    <div className=\"w-9 h-9 bg-gradient-to-br from-morandi-gold/30 to-morandi-gold/10 rounded-md flex items-center justify-center text-sm font-semibold text-morandi-gold shrink-0 mt-0.5\">\n                      {message.author?.display_name?.charAt(0) || '?'}\n                    </div>\n\n                    {/* è¨Šæ¯å…§å®¹ */}\n                    <div className=\"flex-1 min-w-0 relative pt-0.5\">\n                      {/* è¨Šæ¯æ¨™é¡Œ */}\n                      <div className=\"flex items-baseline gap-2 mb-0.5\">\n                        <span className=\"font-semibold text-morandi-primary text-[15px]\">\n                          {message.author?.display_name || 'æœªçŸ¥ç”¨æˆ¶'}\n                        </span>\n                        <span className=\"text-[11px] text-morandi-secondary/80 font-normal\">\n                          {formatMessageTime(message.created_at)}\n                        </span>\n                        {message.edited_at && (\n                          <span className=\"text-[11px] text-morandi-secondary/60\">(å·²ç·¨è¼¯)</span>\n                        )}\n                      </div>\n\n                      {/* è¨Šæ¯æ–‡å­— */}\n                      <div className=\"text-morandi-primary text-[15px] whitespace-pre-wrap leading-[1.46668] break-words\">\n                        {message.content}\n                      </div>\n\n                      {/* é™„ä»¶åˆ—è¡¨ */}\n                      {message.attachments && message.attachments.length > 0 && (\n                        <div className=\"mt-2 space-y-2\">\n                          {message.attachments.map((attachment, index) => {\n                            const isImage = attachment.fileType.startsWith('image/');\n                            return (\n                              <div\n                                key={index}\n                                className=\"inline-flex items-center gap-2 px-3 py-2 bg-morandi-container/10 border border-morandi-container rounded-lg hover:bg-morandi-container/20 transition-colors group/attachment\"\n                              >\n                                {isImage ? (\n                                  <ImageIcon size={16} className=\"text-morandi-gold shrink-0\" />\n                                ) : (\n                                  <FileText size={16} className=\"text-morandi-secondary shrink-0\" />\n                                )}\n                                <div className=\"flex-1 min-w-0\">\n                                  <p className=\"text-sm text-morandi-primary truncate max-w-[200px]\">\n                                    {attachment.fileName}\n                                  </p>\n                                  <p className=\"text-xs text-morandi-secondary\">\n                                    {formatFileSize(attachment.fileSize)}\n                                  </p>\n                                </div>\n                                <button\n                                  onClick={() => downloadFile(attachment.path, 'workspace-files', attachment.fileName)}\n                                  className=\"opacity-0 group-hover/attachment:opacity-100 transition-opacity p-1 hover:bg-morandi-gold/10 rounded\"\n                                  title=\"ä¸‹è¼‰æª”æ¡ˆ\"\n                                >\n                                  <Download size={14} className=\"text-morandi-gold\" />\n                                </button>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      )}\n\n                      {/* åæ‡‰åˆ— */}\n                      {Object.keys(message.reactions).length > 0 && (\n                        <div className=\"flex flex-wrap gap-1 mt-2\">\n                          {Object.entries(message.reactions).map(([emoji, users]) => (\n                            <button\n                              key={emoji}\n                              onClick={() => handleReaction(message.id, emoji)}\n                              className={cn(\n                                \"flex items-center gap-1 px-2 py-1 text-xs rounded-full border transition-colors\",\n                                users.includes(user?.id || '')\n                                  ? \"bg-morandi-gold/20 border-morandi-gold text-morandi-primary\"\n                                  : \"bg-morandi-container/20 border-border text-morandi-secondary hover:bg-morandi-container/30\"\n                              )}\n                            >\n                              <span>{emoji}</span>\n                              <span>{users.length}</span>\n                            </button>\n                          ))}\n                        </div>\n                      )}\n\n                      {/* åæ‡‰æŒ‰éˆ• & åˆªé™¤æŒ‰éˆ• - hover è¨Šæ¯æ™‚é¡¯ç¤º */}\n                      <div className=\"flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <div className=\"flex gap-0.5\">\n                          {['ğŸ‘', 'â¤ï¸', 'ğŸ˜„', 'ğŸ˜®', 'ğŸ‰'].map(emoji => (\n                            <button\n                              key={emoji}\n                              onClick={() => handleReaction(message.id, emoji)}\n                              className=\"w-6 h-6 flex items-center justify-center text-xs hover:bg-morandi-container/30 rounded border border-morandi-container hover:border-morandi-gold/40 transition-all hover:scale-110\"\n                              title={`åŠ ä¸Š ${emoji} åæ‡‰`}\n                            >\n                              {emoji}\n                            </button>\n                          ))}\n                        </div>\n                        {/* åˆªé™¤æŒ‰éˆ• - åªæœ‰ä½œè€…å¯ä»¥åˆªé™¤ */}\n                        {user?.id === message.author_id && (\n                          <button\n                            onClick={async () => {\n                              if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡è¨Šæ¯å—ï¼Ÿ')) {\n                                const { deleteMessage } = useWorkspaceStore.getState();\n                                await deleteMessage(message.id);\n\n                                // åŒæ™‚æ›´æ–° local state ä¸­çš„è¨Šæ¯åˆ—è¡¨\n                                if (selectedChannel?.id) {\n                                  setChannelMessages(prev => ({\n                                    ...prev,\n                                    [selectedChannel.id]: prev[selectedChannel.id]?.filter(m => m.id !== message.id) || []\n                                  }));\n                                }\n                              }\n                            }}\n                            className=\"w-6 h-6 flex items-center justify-center text-xs hover:bg-morandi-red/10 rounded border border-morandi-container hover:border-morandi-red/40 transition-all hover:scale-110\"\n                            title=\"åˆªé™¤è¨Šæ¯\"\n                          >\n                            <Trash2 size={12} className=\"text-morandi-red\" />\n                          </button>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))\n              )}\n\n              {/* ä»£å¢Šæ¸…å–®å¡ç‰‡ */}\n              {advanceLists.map(advanceList => (\n                <AdvanceListCard\n                  key={advanceList.id}\n                  advanceList={advanceList}\n                  userName={advanceList.author?.display_name}\n                  currentUserId={user?.id || ''}\n                  userRole=\"admin\" // TODO: å¾å¯¦éš›æ¬Šé™ç³»çµ±å–å¾—\n                  onCreatePayment={(itemId, item) => {\n                    setSelectedAdvanceItem(item);\n                    setSelectedAdvanceListId(advanceList.id);\n                    setShowCreatePaymentDialog(true);\n                  }}\n                  onDelete={(listId) => {\n                    deleteAdvanceList(listId);\n                  }}\n                />\n              ))}\n\n              {/* è¨‚å–®åˆ—è¡¨å¡ç‰‡ */}\n              {sharedOrderLists.map(orderList => (\n                <OrderListCard\n                  key={orderList.id}\n                  orderList={orderList}\n                  userName={orderList.author?.display_name}\n                  currentUserId={user?.id || ''}\n                  userRole=\"admin\" // TODO: å¾å¯¦éš›æ¬Šé™ç³»çµ±å–å¾—\n                  onCreateReceipt={(orderId, order) => {\n                    setSelectedOrder(order);\n                    setShowCreateReceiptDialog(true);\n                  }}\n                />\n              ))}\n\n              <div ref={messagesEndRef} />\n              </div>\n\n              {/* æˆå“¡å´é‚Šæ¬„ */}\n              {showMemberSidebar && (\n                <div className=\"w-64 border-l border-border bg-morandi-container/5 flex flex-col shrink-0\">\n                  <div className=\"p-4 border-b border-border\">\n                    <h3 className=\"font-medium text-morandi-primary\">æˆå“¡åˆ—è¡¨</h3>\n                  </div>\n                  <div className=\"flex-1 overflow-y-auto p-2\">\n                    <div className=\"text-center text-morandi-secondary text-sm py-4\">\n                      è¼‰å…¥æˆå“¡åˆ—è¡¨ä¸­...\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* è¼¸å…¥å€åŸŸ */}\n            <div\n              className={cn(\n                \"p-4 border-t border-morandi-gold/20 bg-morandi-container/5 shrink-0 transition-colors\",\n                isDragging && \"bg-morandi-gold/10 border-morandi-gold\"\n              )}\n              onDragOver={handleDragOver}\n              onDragLeave={handleDragLeave}\n              onDrop={handleDrop}\n            >\n              {/* æª”æ¡ˆé è¦½å€ */}\n              {attachedFiles.length > 0 && (\n                <div className=\"mb-3 flex flex-wrap gap-2\">\n                  {attachedFiles.map((file, index) => {\n                    const isImage = file.type.startsWith('image/');\n                    return (\n                      <div\n                        key={index}\n                        className=\"relative bg-white border border-morandi-container rounded-lg p-2 pr-8 flex items-center gap-2 max-w-xs\"\n                      >\n                        {isImage ? (\n                          <ImageIcon size={16} className=\"text-morandi-gold shrink-0\" />\n                        ) : (\n                          <FileText size={16} className=\"text-morandi-secondary shrink-0\" />\n                        )}\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm text-morandi-primary truncate\">{file.name}</p>\n                          <p className=\"text-xs text-morandi-secondary\">{formatFileSize(file.size)}</p>\n                        </div>\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveFile(index)}\n                          className=\"absolute right-2 top-1/2 -translate-y-1/2 text-morandi-secondary hover:text-morandi-red transition-colors\"\n                        >\n                          <X size={14} />\n                        </button>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n\n              {/* ä¸Šå‚³é€²åº¦æ¢ */}\n              {uploadingFiles && uploadProgress > 0 && (\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <span className=\"text-xs text-morandi-secondary\">ä¸Šå‚³æª”æ¡ˆä¸­...</span>\n                    <span className=\"text-xs text-morandi-secondary\">{uploadProgress}%</span>\n                  </div>\n                  <div className=\"w-full h-1.5 bg-morandi-container/20 rounded-full overflow-hidden\">\n                    <div\n                      className=\"h-full bg-morandi-gold transition-all duration-300\"\n                      style={{ width: `${uploadProgress}%` }}\n                    />\n                  </div>\n                </div>\n              )}\n\n              <form onSubmit={handleSendMessage} className=\"flex gap-2\">\n                <div className=\"flex items-center gap-1 relative\">\n                  {/* å¿«æ·é¸å–®æŒ‰éˆ• */}\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"w-9 h-9 text-morandi-secondary hover:text-morandi-gold hover:bg-morandi-gold/10\"\n                    onClick={() => setShowQuickMenu(!showQuickMenu)}\n                  >\n                    <Plus size={18} />\n                  </Button>\n\n                  {/* å¿«æ·é¸å–® */}\n                  {showQuickMenu && (\n                    <div\n                      ref={quickMenuRef}\n                      className=\"absolute bottom-full left-0 mb-2 bg-white border border-morandi-gold/20 rounded-lg shadow-xl py-1.5 min-w-[220px] z-50 animate-in fade-in slide-in-from-bottom-2 duration-200\"\n                    >\n                      <div className=\"px-3 py-1.5 border-b border-morandi-container/30\">\n                        <p className=\"text-xs font-semibold text-morandi-secondary uppercase tracking-wider\">å¿«æ·æ“ä½œ</p>\n                      </div>\n                      {quickMenuActions.map((action, index) => {\n                        const Icon = action.icon;\n                        const isLast = index === quickMenuActions.length - 1;\n                        return (\n                          <div key={action.id}>\n                            {isLast && <div className=\"my-1 border-t border-morandi-container/30\" />}\n                            <button\n                              type=\"button\"\n                              onClick={action.action}\n                              className=\"w-full flex items-center gap-3 px-3 py-2 hover:bg-morandi-gold/10 transition-all text-left group\"\n                            >\n                              <div className={cn(\n                                \"w-8 h-8 rounded-md flex items-center justify-center transition-all\",\n                                \"bg-gradient-to-br from-morandi-container/20 to-morandi-container/5\",\n                                \"group-hover:from-morandi-gold/10 group-hover:to-morandi-gold/5\"\n                              )}>\n                                <Icon size={16} className={cn(action.color, \"group-hover:scale-110 transition-transform\")} />\n                              </div>\n                              <span className=\"text-sm text-morandi-primary font-medium\">{action.label}</span>\n                            </button>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )}\n\n                  {/* é™„ä»¶ä¸Šå‚³æŒ‰éˆ• (éš±è—çš„ input) */}\n                  <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    multiple\n                    className=\"hidden\"\n                    onChange={handleFileSelect}\n                    accept=\"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt\"\n                  />\n                </div>\n\n                <div\n                  className=\"flex-1 relative\"\n                  ref={messageInputRef}\n                  onPaste={handlePaste}\n                >\n                  <Input\n                    value={messageText}\n                    onChange={(e) => setMessageText(e.target.value)}\n                    placeholder={`åœ¨ #${selectedChannel.name} ä¸­è¼¸å…¥è¨Šæ¯...`}\n                    className=\"pr-10 bg-white border-morandi-container\"\n                  />\n                  <button\n                    type=\"button\"\n                    className=\"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-morandi-secondary hover:text-morandi-gold transition-colors pointer-events-auto z-10\"\n                  >\n                    <Smile size={16} />\n                  </button>\n                </div>\n\n                <Button\n                  type=\"submit\"\n                  disabled={(!messageText.trim() && attachedFiles.length === 0) || uploadingFiles}\n                  className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {uploadingFiles ? (\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  ) : (\n                    <Send size={16} />\n                  )}\n                </Button>\n              </form>\n\n              {isDragging && (\n                <div className=\"absolute inset-0 flex items-center justify-center bg-morandi-gold/5 border-2 border-dashed border-morandi-gold rounded-lg pointer-events-none\">\n                  <div className=\"text-center\">\n                    <Paperclip size={32} className=\"mx-auto mb-2 text-morandi-gold\" />\n                    <p className=\"text-morandi-gold font-medium\">æ”¾é–‹ä»¥ä¸Šå‚³æª”æ¡ˆ</p>\n                  </div>\n                </div>\n              )}\n            </div>\n        </ChannelTabs>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center\">\n              <Hash size={48} className=\"text-morandi-secondary/50 mx-auto mb-4\" />\n              <p className=\"text-morandi-secondary\">é¸æ“‡ä¸€å€‹é »é“é–‹å§‹å°è©±</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* åˆ†äº«ä»£å¢Šå°è©±æ¡† */}\n      {showShareAdvanceDialog && selectedChannel && user && (\n        <ShareAdvanceDialog\n          channelId={selectedChannel.id}\n          currentUserId={user.id}\n          onClose={() => setShowShareAdvanceDialog(false)}\n          onSuccess={() => {\n            console.log('ä»£å¢Šå·²åˆ†äº«');\n            setShowShareAdvanceDialog(false);\n          }}\n        />\n      )}\n\n      {/* åˆ†äº«è¨‚å–®å°è©±æ¡† */}\n      {showShareOrdersDialog && selectedChannel && (\n        <ShareOrdersDialog\n          channelId={selectedChannel.id}\n          onClose={() => setShowShareOrdersDialog(false)}\n          onSuccess={() => {\n            console.log('è¨‚å–®å·²åˆ†äº«');\n            setShowShareOrdersDialog(false);\n            // é‡æ–°è¼‰å…¥è¨‚å–®åˆ—è¡¨\n            if (selectedChannel?.id) {\n              loadSharedOrderLists(selectedChannel.id);\n            }\n          }}\n        />\n      )}\n\n      {/* å»ºç«‹æ”¶æ¬¾å–®å°è©±æ¡† */}\n      {showCreateReceiptDialog && selectedOrder && (\n        <CreateReceiptDialog\n          order={selectedOrder}\n          onClose={() => {\n            setShowCreateReceiptDialog(false);\n            setSelectedOrder(null);\n          }}\n          onSuccess={(receiptId) => {\n            console.log('æ”¶æ¬¾å–®å·²å»ºç«‹:', receiptId);\n            // TODO: æ›´æ–°è¨‚å–®çš„æ”¶æ¬¾ç‹€æ…‹\n            setShowCreateReceiptDialog(false);\n            setSelectedOrder(null);\n          }}\n        />\n      )}\n\n      {/* å»ºç«‹è«‹æ¬¾å–®å°è©±æ¡†ï¼ˆå¾ä»£å¢Šé …ç›®ï¼‰ */}\n      {showCreatePaymentDialog && selectedAdvanceItem && selectedAdvanceListId && (\n        <CreatePaymentRequestDialog\n          items={selectedAdvanceItem}\n          listId={selectedAdvanceListId}\n          onClose={() => {\n            setShowCreatePaymentDialog(false);\n            setSelectedAdvanceItem(null);\n            setSelectedAdvanceListId('');\n          }}\n          onSuccess={() => {\n            console.log('è«‹æ¬¾å–®å·²å»ºç«‹');\n            setShowCreatePaymentDialog(false);\n            setSelectedAdvanceItem(null);\n            setSelectedAdvanceListId('');\n            // é‡æ–°è¼‰å…¥ä»£å¢Šåˆ—è¡¨\n            if (selectedChannel?.id) {\n              loadAdvanceLists(selectedChannel.id);\n            }\n          }}\n        />\n      )}\n\n      {/* é »é“è¨­å®šå°è©±æ¡† - æš«æ™‚ä¿ç•™ä»¥å¾Œå¯¦ä½œ */}\n      <Dialog open={showSettingsDialog} onOpenChange={setShowSettingsDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>é »é“è¨­å®š</DialogTitle>\n            <DialogDescription>\n              ç®¡ç† #{selectedChannel?.name} çš„è¨­å®š\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">é »é“åç¨±</label>\n              <Input\n                value={editChannelName}\n                onChange={(e) => setEditChannelName(e.target.value)}\n                placeholder=\"é »é“åç¨±\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">é »é“æè¿°</label>\n              <Input\n                value={editChannelDescription}\n                onChange={(e) => setEditChannelDescription(e.target.value)}\n                placeholder=\"é »é“æè¿°ï¼ˆé¸å¡«ï¼‰\"\n              />\n            </div>\n            <div className=\"pt-4 border-t border-border\">\n              <Button\n                variant=\"destructive\"\n                className=\"w-full\"\n                onClick={async () => {\n                  console.log('åˆªé™¤æŒ‰éˆ•è¢«é»æ“Š', { selectedChannel });\n                  if (!selectedChannel) {\n                    console.log('æ²’æœ‰é¸æ“‡é »é“');\n                    return;\n                  }\n\n                  const confirmed = confirm(`ç¢ºå®šè¦åˆªé™¤ #${selectedChannel.name} é »é“å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`);\n                  console.log('ç¢ºèªåˆªé™¤:', confirmed);\n\n                  if (confirmed) {\n                    try {\n                      console.log('é–‹å§‹åˆªé™¤é »é“:', selectedChannel.id);\n                      await deleteChannel(selectedChannel.id);\n                      console.log('é »é“åˆªé™¤æˆåŠŸ');\n                      selectChannel(null);  // âœ¨ æ”¹ç”¨ store çš„ selectChannel\n                      setShowSettingsDialog(false);\n                      alert('é »é“å·²åˆªé™¤');\n                    } catch (error) {\n                      console.error('åˆªé™¤é »é“å¤±æ•—:', error);\n                      alert('åˆªé™¤é »é“å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n                    }\n                  }\n                }}\n              >\n                <Trash2 size={16} className=\"mr-2\" />\n                åˆªé™¤é »é“\n              </Button>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowSettingsDialog(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={async () => {\n              console.log('å„²å­˜è®Šæ›´æŒ‰éˆ•è¢«é»æ“Š');\n              if (!selectedChannel) {\n                console.log('æ²’æœ‰é¸æ“‡é »é“');\n                return;\n              }\n\n              if (!editChannelName.trim()) {\n                alert('é »é“åç¨±ä¸èƒ½ç‚ºç©º');\n                return;\n              }\n\n              try {\n                console.log('é–‹å§‹æ›´æ–°é »é“:', selectedChannel.id, { name: editChannelName, description: editChannelDescription });\n                await updateChannel(selectedChannel.id, {\n                  name: editChannelName.toLowerCase().replace(/\\s+/g, '-'),\n                  description: editChannelDescription.trim() || undefined\n                });\n                setShowSettingsDialog(false);\n                alert('é »é“è¨­å®šå·²æ›´æ–°');\n              } catch (error) {\n                console.error('æ›´æ–°é »é“å¤±æ•—:', error);\n                alert('æ›´æ–°é »é“å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n              }\n            }}>\n              å„²å­˜è®Šæ›´\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* åˆ†äº«å ±åƒ¹å–®å°è©±æ¡† */}\n      <Dialog open={showShareQuoteDialog} onOpenChange={setShowShareQuoteDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>åˆ†äº«å ±åƒ¹å–®</DialogTitle>\n            <DialogDescription>\n              é¸æ“‡è¦åˆ†äº«åˆ°é »é“çš„å ±åƒ¹å–®\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">å ±åƒ¹å–®ç·¨è™Ÿ</label>\n              <Input placeholder=\"è¼¸å…¥å ±åƒ¹å–®ç·¨è™Ÿæœå°‹...\" />\n            </div>\n            <div className=\"border border-morandi-container rounded-lg p-3 space-y-2\">\n              <p className=\"text-sm text-morandi-secondary\">æš«ç„¡å ±åƒ¹å–®è³‡æ–™</p>\n              <p className=\"text-xs text-morandi-secondary\">æç¤ºï¼šå®Œæ•´åŠŸèƒ½å°‡é€£æ¥å ±åƒ¹å–®ç³»çµ±</p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowShareQuoteDialog(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={() => {\n              // TODO: å¯¦ä½œåˆ†äº«å ±åƒ¹å–®å¡ç‰‡\n              console.log('åˆ†äº«å ±åƒ¹å–®å¡ç‰‡');\n              setShowShareQuoteDialog(false);\n            }}>\n              åˆ†äº«åˆ°é »é“\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* åˆ†äº«åœ˜æ³å°è©±æ¡† */}\n      <Dialog open={showShareTourDialog} onOpenChange={setShowShareTourDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>åˆ†äº«åœ˜æ³</DialogTitle>\n            <DialogDescription>\n              é¸æ“‡è¦åˆ†äº«åˆ°é »é“çš„åœ˜æ³è³‡è¨Š\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">åœ˜è™Ÿ</label>\n              <Input placeholder=\"è¼¸å…¥åœ˜è™Ÿæœå°‹...\" />\n            </div>\n            <div className=\"border border-morandi-container rounded-lg p-3 space-y-2\">\n              <p className=\"text-sm text-morandi-secondary\">æš«ç„¡åœ˜æ³è³‡æ–™</p>\n              <p className=\"text-xs text-morandi-secondary\">æç¤ºï¼šå®Œæ•´åŠŸèƒ½å°‡é€£æ¥åœ˜æ³ç®¡ç†ç³»çµ±</p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowShareTourDialog(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={() => {\n              // TODO: å¯¦ä½œåˆ†äº«åœ˜æ³å¡ç‰‡\n              console.log('åˆ†äº«åœ˜æ³å¡ç‰‡');\n              setShowShareTourDialog(false);\n            }}>\n              åˆ†äº«åˆ°é »é“\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* æ–°å¢è«‹æ¬¾å–®å°è©±æ¡† */}\n      <Dialog open={showNewPaymentDialog} onOpenChange={setShowNewPaymentDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>æ–°å¢è«‹æ¬¾å–®</DialogTitle>\n            <DialogDescription>\n              å»ºç«‹æ–°è«‹æ¬¾å–®ä¸¦åˆ†äº«åˆ°é »é“\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">è«‹æ¬¾é …ç›®</label>\n              <Input placeholder=\"è¼¸å…¥è«‹æ¬¾é …ç›®...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">è«‹æ¬¾é‡‘é¡</label>\n              <Input type=\"number\" placeholder=\"è¼¸å…¥è«‹æ¬¾é‡‘é¡...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">è«‹æ¬¾åŸå› </label>\n              <Input placeholder=\"è¼¸å…¥è«‹æ¬¾åŸå› ...\" />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowNewPaymentDialog(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={() => {\n              // TODO: å¯¦ä½œæ–°å¢è«‹æ¬¾å–®\n              console.log('æ–°å¢è«‹æ¬¾å–®');\n              setShowNewPaymentDialog(false);\n            }}>\n              å»ºç«‹ä¸¦åˆ†äº«\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* æ–°å¢æ”¶æ¬¾å–®å°è©±æ¡† */}\n      <Dialog open={showNewReceiptDialog} onOpenChange={setShowNewReceiptDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>æ–°å¢æ”¶æ¬¾å–®</DialogTitle>\n            <DialogDescription>\n              å»ºç«‹æ–°æ”¶æ¬¾å–®ä¸¦åˆ†äº«åˆ°é »é“\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">æ”¶æ¬¾é …ç›®</label>\n              <Input placeholder=\"è¼¸å…¥æ”¶æ¬¾é …ç›®...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">æ”¶æ¬¾é‡‘é¡</label>\n              <Input type=\"number\" placeholder=\"è¼¸å…¥æ”¶æ¬¾é‡‘é¡...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">ä»˜æ¬¾äºº</label>\n              <Input placeholder=\"è¼¸å…¥ä»˜æ¬¾äºº...\" />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowNewReceiptDialog(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={() => {\n              // TODO: å¯¦ä½œæ–°å¢æ”¶æ¬¾å–®\n              console.log('æ–°å¢æ”¶æ¬¾å–®');\n              setShowNewReceiptDialog(false);\n            }}>\n              å»ºç«‹ä¸¦åˆ†äº«\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* æ–°å¢ä»»å‹™å°è©±æ¡† */}\n      <Dialog open={showNewTaskDialog} onOpenChange={setShowNewTaskDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>æ–°å¢ä»»å‹™</DialogTitle>\n            <DialogDescription>\n              å»ºç«‹æ–°ä»»å‹™ä¸¦åˆ†äº«åˆ°é »é“\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">ä»»å‹™æ¨™é¡Œ</label>\n              <Input placeholder=\"è¼¸å…¥ä»»å‹™æ¨™é¡Œ...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">ä»»å‹™æè¿°</label>\n              <Input placeholder=\"è¼¸å…¥ä»»å‹™æè¿°...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">æŒ‡æ´¾çµ¦</label>\n              <Input placeholder=\"è¼¸å…¥æˆå“¡åç¨±...\" />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-morandi-primary\">æˆªæ­¢æ—¥æœŸ</label>\n              <Input type=\"date\" />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowNewTaskDialog(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={() => {\n              // TODO: å¯¦ä½œæ–°å¢ä»»å‹™\n              console.log('æ–°å¢ä»»å‹™');\n              setShowNewTaskDialog(false);\n            }}>\n              å»ºç«‹ä¸¦åˆ†äº«\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/ChannelSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Input' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ChannelGroup' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { Hash, Lock, Star, Search, ChevronDown, ChevronRight, Plus, Settings, Filter } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { cn } from '@/lib/utils';\nimport { Channel, ChannelGroup, useWorkspaceStore } from '@/stores/workspace-store';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\n\ninterface ChannelSidebarProps {\n  selectedChannelId: string | null;\n  onSelectChannel: (channel: Channel) => void;\n}\n\nexport function ChannelSidebar({ selectedChannelId, onSelectChannel }: ChannelSidebarProps) {\n  const {\n    channels,\n    channelGroups,\n    currentWorkspace,\n    searchQuery,\n    channelFilter,\n    setSearchQuery,\n    setChannelFilter,\n    toggleChannelFavorite,\n    createChannelGroup,\n    toggleGroupCollapse,\n  } = useWorkspaceStore();\n\n  const [showNewGroupDialog, setShowNewGroupDialog] = useState(false);\n  const [newGroupName, setNewGroupName] = useState('');\n  const [expandedSections, setExpandedSections] = useState({\n    favorites: true,\n    ungrouped: true\n  });\n\n  // ç¯©é¸é »é“\n  const filteredChannels = useMemo(() => {\n    let filtered = channels;\n\n    // æœå°‹ç¯©é¸\n    if (searchQuery) {\n      filtered = filtered.filter(ch =>\n        ch.name.toLowerCase().includes(searchQuery.toLowerCase())\n      );\n    }\n\n    // ç‹€æ…‹ç¯©é¸\n    if (channelFilter === 'starred') {\n      filtered = filtered.filter(ch => ch.is_favorite);\n    }\n\n    return filtered;\n  }, [channels, searchQuery, channelFilter]);\n\n  // åˆ†é¡é »é“\n  const favoriteChannels = filteredChannels.filter(ch => ch.is_favorite);\n  const ungroupedChannels = filteredChannels.filter(ch => !ch.group_id && !ch.is_favorite);\n  const groupedChannels = channelGroups.map(group => ({\n    group,\n    channels: filteredChannels.filter(ch => ch.group_id === group.id)\n  }));\n\n  const renderChannel = (channel: Channel) => {\n    const isActive = channel.id === selectedChannelId;\n\n    return (\n      <div\n        key={channel.id}\n        className={cn(\n          'group flex items-center gap-2 px-2 py-1.5 text-sm rounded cursor-pointer transition-colors',\n          isActive\n            ? 'bg-morandi-gold/15 text-morandi-primary font-medium'\n            : 'text-morandi-secondary hover:bg-morandi-container/20 hover:text-morandi-primary'\n        )}\n        onClick={() => onSelectChannel(channel)}\n      >\n        {channel.type === 'private' ? (\n          <Lock size={14} className=\"shrink-0\" />\n        ) : (\n          <Hash size={14} className=\"shrink-0\" />\n        )}\n        <span className=\"flex-1 truncate\">{channel.name}</span>\n        <button\n          onClick={(e) => {\n            e.stopPropagation();\n            toggleChannelFavorite(channel.id);\n          }}\n          className={cn(\n            'opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-morandi-gold/20 transition-opacity',\n            channel.is_favorite && 'opacity-100 text-morandi-gold'\n          )}\n        >\n          <Star size={12} fill={channel.is_favorite ? 'currentColor' : 'none'} />\n        </button>\n      </div>\n    );\n  };\n\n  const handleCreateGroup = () => {\n    if (newGroupName.trim() && currentWorkspace) {\n      createChannelGroup({\n        workspace_id: currentWorkspace.id,\n        name: newGroupName.trim(),\n        is_collapsed: false,\n        order: channelGroups.length\n      });\n      setNewGroupName('');\n      setShowNewGroupDialog(false);\n    }\n  };\n\n  return (\n    <div className=\"w-[280px] bg-morandi-container/5 border-r border-morandi-gold/20 flex flex-col shrink-0\">\n      {/* å·¥ä½œç©ºé–“æ¨™é¡Œåˆ— */}\n      <div className=\"h-[52px] px-6 border-b border-morandi-gold/20 bg-gradient-to-r from-morandi-gold/5 to-transparent flex items-center\">\n        <div className=\"flex items-center justify-between w-full\">\n          <h2 className=\"font-semibold text-morandi-primary truncate flex-1\">\n            {currentWorkspace?.icon} {currentWorkspace?.name || 'å·¥ä½œç©ºé–“'}\n          </h2>\n          <div className=\"flex items-center gap-1\">\n            <button className=\"btn-icon-morandi !w-7 !h-7\">\n              <Search size={14} />\n            </button>\n            <DropdownMenu>\n              <DropdownMenuTrigger className=\"btn-icon-morandi !w-7 !h-7\">\n                <Filter size={14} />\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem onClick={() => setChannelFilter('all')} className=\"dropdown-item-morandi\">\n                  å…¨éƒ¨é »é“\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setChannelFilter('starred')} className=\"dropdown-item-morandi\">\n                  å·²åŠ æ˜Ÿè™Ÿ\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setChannelFilter('unread')} className=\"dropdown-item-morandi\">\n                  æœªè®€è¨Šæ¯\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setChannelFilter('muted')} className=\"dropdown-item-morandi\">\n                  å·²éœéŸ³\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n            <button className=\"btn-icon-morandi !w-7 !h-7\">\n              <Settings size={14} />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* æœå°‹æ¡† */}\n      <div className=\"px-4 py-2\">\n        <input\n          type=\"text\"\n          placeholder=\"æœå°‹é »é“...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          className=\"input-morandi h-8 text-sm\"\n        />\n      </div>\n\n      {/* é »é“å€å¡Š */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {/* æˆ‘çš„æœ€æ„› */}\n        {favoriteChannels.length > 0 && (\n          <div className=\"px-2 py-2\">\n            <button\n              className=\"flex items-center gap-1 px-2 py-1 text-xs font-semibold text-morandi-secondary uppercase tracking-wider w-full hover:bg-morandi-container/20 rounded transition-colors\"\n              onClick={() => setExpandedSections(prev => ({ ...prev, favorites: !prev.favorites }))}\n            >\n              {expandedSections.favorites ? <ChevronDown size={12} /> : <ChevronRight size={12} />}\n              <Star size={12} />\n              <span>æˆ‘çš„æœ€æ„›</span>\n            </button>\n            {expandedSections.favorites && (\n              <div className=\"mt-1 space-y-0.5\">\n                {favoriteChannels.map(renderChannel)}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* è‡ªè¨‚ç¾¤çµ„ */}\n        {groupedChannels.map(({ group, channels: groupChannels }) => (\n          <div key={group.id} className=\"px-2 py-2\">\n            <div className=\"flex items-center justify-between group/section\">\n              <button\n                className=\"flex items-center gap-1 px-2 py-1 text-xs font-semibold text-morandi-secondary uppercase tracking-wider flex-1 hover:bg-morandi-container/20 rounded transition-colors\"\n                onClick={() => toggleGroupCollapse(group.id)}\n              >\n                {group.is_collapsed ? <ChevronRight size={12} /> : <ChevronDown size={12} />}\n                <span>{group.name}</span>\n              </button>\n            </div>\n            {!group.is_collapsed && groupChannels.length > 0 && (\n              <div className=\"mt-1 space-y-0.5\">\n                {groupChannels.map(renderChannel)}\n              </div>\n            )}\n          </div>\n        ))}\n\n        {/* æœªåˆ†çµ„é »é“ */}\n        {ungroupedChannels.length > 0 && (\n          <div className=\"px-2 py-2\">\n            <div className=\"flex items-center justify-between group/section\">\n              <button\n                className=\"flex items-center gap-1 px-2 py-1 text-xs font-semibold text-morandi-secondary uppercase tracking-wider flex-1 hover:bg-morandi-container/20 rounded transition-colors\"\n                onClick={() => setExpandedSections(prev => ({ ...prev, ungrouped: !prev.ungrouped }))}\n              >\n                {expandedSections.ungrouped ? <ChevronDown size={12} /> : <ChevronRight size={12} />}\n                <Hash size={12} />\n                <span>é »é“</span>\n              </button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-5 w-5 opacity-0 group-hover/section:opacity-100 transition-opacity\"\n                onClick={() => setShowNewGroupDialog(true)}\n              >\n                <Plus size={12} />\n              </Button>\n            </div>\n            {expandedSections.ungrouped && (\n              <div className=\"mt-1 space-y-0.5\">\n                {ungroupedChannels.map(renderChannel)}\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* æ–°å¢ç¾¤çµ„å°è©±æ¡† */}\n      {showNewGroupDialog && (\n        <div className=\"absolute inset-0 bg-black/20 flex items-center justify-center z-50\">\n          <div className=\"card-morandi-elevated w-80\">\n            <h3 className=\"font-semibold mb-3 text-morandi-primary\">æ–°å¢ç¾¤çµ„</h3>\n            <input\n              type=\"text\"\n              placeholder=\"ç¾¤çµ„åç¨±\"\n              value={newGroupName}\n              onChange={(e) => setNewGroupName(e.target.value)}\n              onKeyDown={(e) => e.key === 'Enter' && handleCreateGroup()}\n              autoFocus\n              className=\"input-morandi\"\n            />\n            <div className=\"flex gap-2 mt-3 justify-end\">\n              <button className=\"btn-morandi-secondary !py-1.5 !px-3 text-sm\" onClick={() => setShowNewGroupDialog(false)}>\n                å–æ¶ˆ\n              </button>\n              <button className=\"btn-morandi-primary !py-1.5 !px-3 text-sm\" onClick={handleCreateGroup}>å»ºç«‹</button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/ChannelTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/CreatePaymentRequestDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'itemsArray' conditional could make the dependencies of useEffect Hook (at line 41) change on every render. To fix this, wrap the initialization of 'itemsArray' in its own useMemo() Hook.","line":25,"column":9,"nodeType":"VariableDeclarator","endLine":25,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2542,2545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2542,2545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { X, Calendar } from 'lucide-react';\nimport { useTourStore, usePaymentRequestStore } from '@/stores';\nimport { useWorkspaceStore, AdvanceItem } from '@/stores/workspace-store';\n\ninterface CreatePaymentRequestDialogProps {\n  items: AdvanceItem | AdvanceItem[]; // å–®é …æˆ–æ‰¹æ¬¡\n  listId: string;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport function CreatePaymentRequestDialog({\n  items,\n  listId,\n  onClose,\n  onSuccess\n}: CreatePaymentRequestDialogProps) {\n  const { items: tours } = useTourStore();\n  const { create: createPaymentRequest } = usePaymentRequestStore();\n  const { processAdvanceItem } = useWorkspaceStore();\n\n  const itemsArray = Array.isArray(items) ? items : [items];\n  const isBatch = Array.isArray(items);\n\n  const [selectedTourId, setSelectedTourId] = useState('');\n  const [category, setCategory] = useState('å…¶ä»–');\n  const [supplier, setSupplier] = useState('');\n  const [requestDate, setRequestDate] = useState('');\n\n  // è¨ˆç®—ç¸½é‡‘é¡\n  const totalAmount = itemsArray.reduce((sum, item) => sum + item.amount, 0);\n\n  // è‡ªå‹•è¨­å®šä¾›æ‡‰å•†ç‚ºç¬¬ä¸€å€‹ä»£å¢Šäºº\n  useEffect(() => {\n    if (itemsArray.length > 0) {\n      setSupplier(`å“¡å·¥ä»£å¢Š-${itemsArray[0].advance_person}`);\n    }\n  }, [itemsArray]);\n\n  // ç²å–ä¸‹å€‹é€±å››\n  useEffect(() => {\n    const getNextThursday = () => {\n      const today = new Date();\n      const dayOfWeek = today.getDay();\n      const daysUntilThursday = (4 - dayOfWeek + 7) % 7;\n      const nextThursday = new Date(today);\n      nextThursday.setDate(today.getDate() + (daysUntilThursday === 0 ? 7 : daysUntilThursday));\n      return nextThursday.toISOString().split('T')[0];\n    };\n    setRequestDate(getNextThursday());\n  }, []);\n\n  const handleCreate = async () => {\n    if (!selectedTourId) {\n      alert('è«‹é¸æ“‡é—œè¯æ—…éŠåœ˜');\n      return;\n    }\n\n    try {\n      // å»ºç«‹è«‹æ¬¾å–®\n      const paymentRequest = await createPaymentRequest({\n        tour_id: selectedTourId,\n        request_date: requestDate,\n        total_amount: totalAmount,\n        items: itemsArray.map((item, index) => ({\n          item_number: `${index + 1}`.padStart(3, '0'),\n          category,\n          supplier,\n          description: `${item.name} - ${item.description}`,\n          unit_price: item.amount,\n          quantity: 1,\n          subtotal: item.amount,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        })),\n        status: 'pending',\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      } as any);\n\n      // æ›´æ–°ä»£å¢Šé …ç›®ç‹€æ…‹\n      for (const item of itemsArray) {\n        await processAdvanceItem(\n          listId,\n          item.id,\n          paymentRequest.id,\n          'current-user' // TODO: å¾ auth store å–å¾—ç•¶å‰ç”¨æˆ¶ ID\n        );\n      }\n\n      onSuccess();\n      onClose();\n    } catch (error) {\n      console.error('å»ºç«‹è«‹æ¬¾å–®å¤±æ•—:', error);\n      alert('å»ºç«‹è«‹æ¬¾å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/20 flex items-center justify-center z-50\" onClick={onClose}>\n      <div className=\"card-morandi-elevated w-[600px]\" onClick={(e) => e.stopPropagation()}>\n        {/* æ¨™é¡Œåˆ— */}\n        <div className=\"flex items-center justify-between pb-3 border-b border-morandi-gold/20\">\n          <h3 className=\"text-lg font-semibold text-morandi-primary\">\n            {isBatch ? `æ‰¹æ¬¡è«‹æ¬¾ (${itemsArray.length} ç­†)` : 'å»ºç«‹è«‹æ¬¾å–®'}\n          </h3>\n          <button onClick={onClose} className=\"btn-icon-morandi !w-8 !h-8\">\n            <X size={16} />\n          </button>\n        </div>\n\n        {/* å…§å®¹ */}\n        <div className=\"space-y-4 my-4\">\n          {/* ä»£å¢Šé …ç›®è³‡è¨Š */}\n          <div className=\"bg-morandi-container/5 rounded-lg p-3 border border-morandi-gold/20\">\n            <div className=\"text-sm font-medium text-morandi-secondary mb-2\">ä»£å¢Šé …ç›®ï¼š</div>\n            <div className=\"space-y-1\">\n              {itemsArray.map((item, index) => (\n                <div key={item.id} className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-morandi-primary\">\n                    {index + 1}. {item.name} - {item.description}\n                  </span>\n                  <span className=\"font-medium text-morandi-primary\">\n                    ${item.amount.toLocaleString()}\n                  </span>\n                </div>\n              ))}\n            </div>\n            <div className=\"flex items-center justify-between mt-2 pt-2 border-t border-morandi-gold/20\">\n              <span className=\"text-sm font-medium text-morandi-secondary\">ç¸½è¨ˆï¼š</span>\n              <span className=\"text-lg font-semibold text-morandi-primary\">\n                ${totalAmount.toLocaleString()}\n              </span>\n            </div>\n          </div>\n\n          {/* é—œè¯æ—…éŠåœ˜ */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              é—œè¯æ—…éŠåœ˜ <span className=\"text-red-500\">*</span>\n            </label>\n            <select\n              value={selectedTourId}\n              onChange={(e) => setSelectedTourId(e.target.value)}\n              className=\"input-morandi\"\n            >\n              <option value=\"\">è«‹é¸æ“‡æ—…éŠåœ˜</option>\n              {tours.map(tour => (\n                <option key={tour.id} value={tour.id}>\n                  {tour.name} ({tour.code})\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* é¡åˆ¥ */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              é¡åˆ¥\n            </label>\n            <input\n              type=\"text\"\n              value={category}\n              onChange={(e) => setCategory(e.target.value)}\n              className=\"input-morandi\"\n            />\n          </div>\n\n          {/* ä¾›æ‡‰å•† */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              ä¾›æ‡‰å•†\n            </label>\n            <input\n              type=\"text\"\n              value={supplier}\n              onChange={(e) => setSupplier(e.target.value)}\n              className=\"input-morandi\"\n            />\n          </div>\n\n          {/* è«‹æ¬¾æ—¥æœŸ */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              è«‹æ¬¾æ—¥æœŸ (é è¨­ä¸‹å€‹é€±å››)\n            </label>\n            <div className=\"relative\">\n              <input\n                type=\"date\"\n                value={requestDate}\n                onChange={(e) => setRequestDate(e.target.value)}\n                className=\"input-morandi pl-10\"\n              />\n              <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" size={16} />\n            </div>\n          </div>\n        </div>\n\n        {/* åº•éƒ¨æ“ä½œæŒ‰éˆ• */}\n        <div className=\"flex gap-2 justify-end pt-3 border-t border-morandi-gold/20\">\n          <button className=\"btn-morandi-secondary !py-2 !px-4\" onClick={onClose}>\n            å–æ¶ˆ\n          </button>\n          <button className=\"btn-morandi-primary !py-2 !px-4\" onClick={handleCreate}>\n            å»ºç«‹è«‹æ¬¾å–®\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/CreateReceiptDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1722,1725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1722,1725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5104,5107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5104,5107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { X, DollarSign, Calendar } from 'lucide-react';\nimport { useReceiptOrderStore } from '@/stores';\n\ninterface CreateReceiptDialogProps {\n  order: {\n    id: string;\n    order_number: string;\n    contact_person: string;\n    total_amount: number;\n    paid_amount: number;\n    gap: number;\n  };\n  onClose: () => void;\n  onSuccess: (receiptId: string) => void;\n}\n\nexport function CreateReceiptDialog({\n  order,\n  onClose,\n  onSuccess\n}: CreateReceiptDialogProps) {\n  const { create: createReceipt } = useReceiptOrderStore();\n\n  const [receiptDate, setReceiptDate] = useState(new Date().toISOString().split('T')[0]);\n  const [paymentMethod, setPaymentMethod] = useState<'ç¾é‡‘' | 'åŒ¯æ¬¾' | 'åˆ·å¡' | 'æ”¯ç¥¨'>('åŒ¯æ¬¾');\n  const [amount, setAmount] = useState(order.gap.toString());\n  const [note, setNote] = useState('');\n\n  const handleCreate = async () => {\n    try {\n      const receiptData = {\n        order_id: order.id,\n        order_number: order.order_number,\n        tour_id: '', // TODO: å¾è¨‚å–®å–å¾— tour_id\n        code: '', // TODO: å¾è¨‚å–®å–å¾— code\n        tour_name: '', // TODO: å¾è¨‚å–®å–å¾— tour_name\n        contact_person: order.contact_person,\n        receipt_date: receiptDate,\n        payment_items: [\n          {\n            payment_method: paymentMethod,\n            amount: parseFloat(amount),\n            transaction_date: receiptDate,\n            note\n          }\n        ],\n        total_amount: parseFloat(amount),\n        status: 'å·²æ”¶æ¬¾' as const,\n        note,\n        created_by: 'current-user', // TODO: å¾ auth store å–å¾—\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      };\n\n      const receipt = await createReceipt(receiptData as any);\n      onSuccess(receipt.id);\n      onClose();\n    } catch (error) {\n      console.error('å»ºç«‹æ”¶æ¬¾å–®å¤±æ•—:', error);\n      alert('å»ºç«‹æ”¶æ¬¾å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/20 flex items-center justify-center z-50\" onClick={onClose}>\n      <div className=\"card-morandi-elevated w-[500px]\" onClick={(e) => e.stopPropagation()}>\n        {/* æ¨™é¡Œåˆ— */}\n        <div className=\"flex items-center justify-between pb-3 border-b border-morandi-gold/20\">\n          <div className=\"flex items-center gap-2\">\n            <DollarSign className=\"text-morandi-gold\" size={20} />\n            <h3 className=\"text-lg font-semibold text-morandi-primary\">å»ºç«‹æ”¶æ¬¾å–®</h3>\n          </div>\n          <button onClick={onClose} className=\"btn-icon-morandi !w-8 !h-8\">\n            <X size={16} />\n          </button>\n        </div>\n\n        {/* å…§å®¹ */}\n        <div className=\"space-y-4 my-4\">\n          {/* è¨‚å–®è³‡è¨Š */}\n          <div className=\"bg-morandi-container/5 rounded-lg p-3 border border-morandi-gold/20\">\n            <div className=\"text-sm font-medium text-morandi-secondary mb-2\">è¨‚å–®è³‡è¨Šï¼š</div>\n            <div className=\"space-y-1\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">è¨‚å–®è™Ÿï¼š</span>\n                <span className=\"font-medium text-morandi-primary\">{order.order_number}</span>\n              </div>\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">å®¢æˆ¶ï¼š</span>\n                <span className=\"text-morandi-primary\">{order.contact_person}</span>\n              </div>\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">ç¸½é¡ï¼š</span>\n                <span className=\"text-morandi-primary\">${order.total_amount.toLocaleString()}</span>\n              </div>\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">å·²æ”¶ï¼š</span>\n                <span className=\"text-morandi-primary\">${order.paid_amount.toLocaleString()}</span>\n              </div>\n              <div className=\"flex items-center justify-between text-sm pt-2 border-t border-morandi-gold/20\">\n                <span className=\"text-morandi-secondary\">å¾…æ”¶é‡‘é¡ï¼š</span>\n                <span className=\"text-lg font-semibold text-red-600\">${order.gap.toLocaleString()}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* æ”¶æ¬¾æ—¥æœŸ */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              æ”¶æ¬¾æ—¥æœŸ\n            </label>\n            <div className=\"relative\">\n              <input\n                type=\"date\"\n                value={receiptDate}\n                onChange={(e) => setReceiptDate(e.target.value)}\n                className=\"input-morandi pl-10\"\n              />\n              <Calendar className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" size={16} />\n            </div>\n          </div>\n\n          {/* æ”¶æ¬¾æ–¹å¼ */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              æ”¶æ¬¾æ–¹å¼\n            </label>\n            <select\n              value={paymentMethod}\n              onChange={(e) => setPaymentMethod(e.target.value as any)}\n              className=\"input-morandi\"\n            >\n              <option value=\"ç¾é‡‘\">ç¾é‡‘</option>\n              <option value=\"åŒ¯æ¬¾\">åŒ¯æ¬¾</option>\n              <option value=\"åˆ·å¡\">åˆ·å¡</option>\n              <option value=\"æ”¯ç¥¨\">æ”¯ç¥¨</option>\n            </select>\n          </div>\n\n          {/* æ”¶æ¬¾é‡‘é¡ */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              æ”¶æ¬¾é‡‘é¡\n            </label>\n            <input\n              type=\"number\"\n              value={amount}\n              onChange={(e) => setAmount(e.target.value)}\n              className=\"input-morandi\"\n              placeholder=\"è¼¸å…¥æ”¶æ¬¾é‡‘é¡\"\n            />\n          </div>\n\n          {/* å‚™è¨» */}\n          <div>\n            <label className=\"block text-sm font-medium text-morandi-secondary mb-2\">\n              å‚™è¨»ï¼ˆé¸å¡«ï¼‰\n            </label>\n            <textarea\n              value={note}\n              onChange={(e) => setNote(e.target.value)}\n              className=\"input-morandi\"\n              rows={3}\n              placeholder=\"è¼¸å…¥å‚™è¨»...\"\n            />\n          </div>\n        </div>\n\n        {/* åº•éƒ¨æ“ä½œæŒ‰éˆ• */}\n        <div className=\"flex gap-2 justify-end pt-3 border-t border-morandi-gold/20\">\n          <button className=\"btn-morandi-secondary !py-2 !px-4\" onClick={onClose}>\n            å–æ¶ˆ\n          </button>\n          <button\n            className=\"btn-morandi-primary !py-2 !px-4\"\n            onClick={handleCreate}\n            disabled={!amount || parseFloat(amount) <= 0}\n          >\n            å»ºç«‹æ”¶æ¬¾å–®\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/FinanceAlertCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getRiskBadge' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":34,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { AlertTriangle, ChevronDown, ChevronUp, Send } from 'lucide-react';\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\nimport { useTourStore } from '@/stores';\n\ninterface FinanceAlertCardProps {\n  tourIds: string[];\n  authorName: string;\n  createdAt: string;\n}\n\nexport function FinanceAlertCard({ tourIds, authorName, createdAt }: FinanceAlertCardProps) {\n  const { items: tours } = useTourStore();\n  const [expanded, setExpanded] = useState(false);\n\n  // å–å¾—é¸ä¸­çš„æ—…éŠåœ˜è³‡æ–™\n  const selectedTours = tours.filter(tour => tourIds.includes(tour.id)).map(tour => ({\n    ...tour,\n    totalCost: tour.total_cost || 0,\n    totalRevenue: tour.total_revenue || 0,\n    gap: (tour.total_cost || 0) - (tour.total_revenue || 0),\n    riskLevel: ((tour.total_cost || 0) - (tour.total_revenue || 0)) > 50000 ? 'high' : 'medium'\n  }));\n\n  // åˆ†é¡è¨‚å–®\n  const criticalTours = selectedTours.filter(t => t.totalCost > 0 && t.totalRevenue === 0);\n  const partialTours = selectedTours.filter(t => t.totalRevenue > 0 && t.gap > 0);\n\n  const totalGap = selectedTours.reduce((sum, tour) => sum + tour.gap, 0);\n\n  const getRiskBadge = (level: string) => {\n    switch (level) {\n      case 'high':\n        return 'ğŸ”´';\n      case 'medium':\n        return 'ğŸŸ¡';\n      default:\n        return 'ğŸŸ¢';\n    }\n  };\n\n  const handleSendReminder = (tour: typeof selectedTours[0]) => {\n    // TODO: å¯¦ä½œç™¼é€æé†’åŠŸèƒ½\n    alert(`ç™¼é€æ”¶æ¬¾æé†’ï¼š${tour.name}`);\n  };\n\n  return (\n    <div className=\"card-morandi p-4 space-y-3\">\n      {/* æ¨™é¡Œ */}\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <AlertTriangle className=\"text-morandi-gold\" size={20} />\n          <div>\n            <p className=\"font-semibold text-morandi-primary\">\n              {authorName} åˆ†äº«äº†è²¡å‹™é è­¦è¨‚å–®\n            </p>\n            <p className=\"text-xs text-morandi-secondary mt-0.5\">\n              {new Date(createdAt).toLocaleString('zh-TW')}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* é«˜é¢¨éšªå€ï¼šå·²æ”¯å‡ºæœªæ”¶æ¬¾ */}\n      {criticalTours.length > 0 && (\n        <div className=\"bg-morandi-red/10 border border-morandi-red/20 rounded-lg p-3\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <span className=\"text-sm font-semibold text-morandi-red\">\n              ğŸ”´ å·²æ”¯å‡ºæœªæ”¶æ¬¾ï¼ˆ{criticalTours.length}ç­†ï¼‰- å„ªå…ˆè™•ç†\n            </span>\n          </div>\n\n          <div className=\"space-y-2\">\n            {criticalTours.map(tour => (\n              <div\n                key={tour.id}\n                className=\"bg-white rounded p-3 space-y-2\"\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"font-medium text-morandi-primary\">\n                      {tour.name} <span className=\"text-xs text-morandi-secondary\">#{tour.code}</span>\n                    </p>\n                    <p className=\"text-sm text-morandi-secondary mt-1\">\n                      å·²æ”¯å‡ºï¼š<span className=\"text-morandi-primary font-medium\">\n                        NT$ {tour.totalCost.toLocaleString()}\n                      </span> | å·²æ”¶ï¼š<span className=\"text-morandi-red font-medium\">NT$ 0</span> âš ï¸\n                    </p>\n                  </div>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => handleSendReminder(tour)}\n                    className=\"btn-morandi-primary !h-8\"\n                  >\n                    <Send size={14} className=\"mr-1\" />\n                    å‚¬æ¬¾\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n\n          <div className=\"mt-3 pt-3 border-t border-morandi-red/20\">\n            <p className=\"text-sm font-semibold text-morandi-red\">\n              ç¸½è¨ˆå·²å¢Šï¼šNT$ {criticalTours.reduce((sum, t) => sum + t.totalCost, 0).toLocaleString()}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* ä¸­é¢¨éšªå€ï¼šéƒ¨åˆ†æ”¶æ¬¾ */}\n      {partialTours.length > 0 && (\n        <div>\n          <button\n            onClick={() => setExpanded(!expanded)}\n            className=\"flex items-center gap-2 text-sm font-semibold text-morandi-gold hover:text-morandi-primary transition-colors\"\n          >\n            ğŸŸ¡ éƒ¨åˆ†æ”¶æ¬¾ï¼ˆ{partialTours.length}ç­†ï¼‰- ä¸€èˆ¬è¿½è¹¤\n            {expanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n          </button>\n\n          {expanded && (\n            <div className=\"mt-2 space-y-2\">\n              {partialTours.map(tour => (\n                <div\n                  key={tour.id}\n                  className=\"bg-morandi-container/20 rounded p-3\"\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium text-morandi-primary text-sm\">\n                        {tour.name}\n                      </p>\n                      <p className=\"text-xs text-morandi-secondary mt-1\">\n                        å·²ä»˜ ${(tour.totalCost / 1000).toFixed(0)}k |\n                        å·²æ”¶ ${(tour.totalRevenue / 1000).toFixed(0)}k |\n                        ç¼º <span className=\"text-morandi-red font-medium\">\n                          ${(tour.gap / 1000).toFixed(0)}k\n                        </span>\n                      </p>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleSendReminder(tour)}\n                      className=\"btn-morandi-secondary !h-8\"\n                    >\n                      æé†’\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* åº•éƒ¨çµ±è¨ˆ */}\n      <div className=\"pt-3 border-t border-morandi-gold/20\">\n        <div className=\"flex items-center justify-between\">\n          <p className=\"text-sm text-morandi-secondary\">\n            å…± {selectedTours.length} ç­†è¨‚å–®\n          </p>\n          <p className=\"text-sm font-semibold text-morandi-primary\">\n            ç¸½ç¼ºå£ï¼š<span className=\"text-morandi-red\">NT$ {totalGap.toLocaleString()}</span>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/FinanceAlertDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/OrderListCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Order' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[782,785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[782,785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'currentUserId' is defined but never used. Allowed unused args must match /^_/u.","line":42,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1255,1258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1255,1258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":142,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":54}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Receipt, ChevronDown, ChevronUp, DollarSign, Check } from 'lucide-react';\nimport { Order } from '@/stores/types';\n\ninterface SharedOrderList {\n  id: string;\n  channel_id: string;\n  orders: Array<{\n    id: string;\n    order_number: string;\n    contact_person: string;\n    total_amount: number;\n    paid_amount: number;\n    gap: number;\n    collection_rate: number;\n    invoice_status?: 'not_invoiced' | 'invoiced';\n    receipt_status?: 'not_received' | 'received';\n  }>;\n  created_by: string;\n  created_at: string;\n  author?: {\n    id: string;\n    display_name: string;\n    avatar?: string;\n  };\n}\n\ninterface OrderListCardProps {\n  orderList: SharedOrderList;\n  userName?: string;\n  onCreateReceipt: (orderId: string, order: any) => void;\n  currentUserId: string;\n  userRole?: 'admin' | 'finance' | 'member';\n}\n\nexport function OrderListCard({\n  orderList,\n  userName = 'æœƒè¨ˆ',\n  onCreateReceipt,\n  currentUserId,\n  userRole = 'member'\n}: OrderListCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const totalGap = orderList.orders.reduce((sum, order) => sum + order.gap, 0);\n  const canProcess = userRole === 'admin' || userRole === 'finance';\n\n  const getOrderStatus = (order: any) => {\n    const isFullyUnpaid = order.total_amount > 0 && order.paid_amount === 0;\n    const isLowRate = order.collection_rate < 30;\n\n    if (isFullyUnpaid) {\n      return {\n        text: 'âŒâŒ æœªè«‹æ¬¾/æœªæ”¶æ¬¾',\n        color: 'text-red-600',\n        bgColor: 'bg-red-50'\n      };\n    } else if (isLowRate) {\n      return {\n        text: 'âœ…âŒ å·²è«‹æ¬¾/æœªæ”¶æ¬¾',\n        color: 'text-orange-600',\n        bgColor: 'bg-orange-50'\n      };\n    } else {\n      return {\n        text: 'éƒ¨åˆ†æ”¶æ¬¾',\n        color: 'text-yellow-600',\n        bgColor: 'bg-yellow-50'\n      };\n    }\n  };\n\n  return (\n    <div className=\"card-morandi-elevated my-3\">\n      {/* æ¨™é¡Œ */}\n      <div className=\"flex items-start gap-2 mb-3\">\n        <Receipt className=\"text-morandi-gold shrink-0 mt-1\" size={20} />\n        <div className=\"flex-1\">\n          <div className=\"font-medium text-morandi-primary\">\n            {userName} åˆ†äº«äº†å¾…æ”¶æ¬¾è¨‚å–®\n          </div>\n          <div className=\"text-xs text-morandi-secondary mt-1\">\n            {new Date(orderList.created_at).toLocaleString('zh-TW')}\n          </div>\n        </div>\n      </div>\n\n      {/* è¨‚å–®å¡ç‰‡ */}\n      <div className=\"bg-gradient-to-br from-morandi-container/5 to-morandi-container/10 rounded-lg border border-morandi-gold/20 overflow-hidden\">\n        {/* æ”¶åˆæ‘˜è¦ */}\n        <div\n          className=\"p-4 cursor-pointer hover:bg-morandi-gold/5 transition-colors\"\n          onClick={() => setIsExpanded(!isExpanded)}\n        >\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"text-2xl\">ğŸ’°</div>\n              <div>\n                <div className=\"font-medium text-morandi-primary\">\n                  ğŸ“‹ å¾…è™•ç†è¨‚å–® ({orderList.orders.length}ç­† / ${totalGap.toLocaleString()})\n                </div>\n                <div className=\"text-xs text-morandi-secondary mt-1\">\n                  {isExpanded ? 'é»æ“Šæ”¶åˆè©³æƒ…' : 'é»æ“Šå±•é–‹è©³æƒ…'}\n                </div>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"text-right\">\n                <div className=\"text-xs text-morandi-secondary\">ç¸½ç¼ºå£</div>\n                <div className=\"text-lg font-semibold text-red-600\">\n                  ${totalGap.toLocaleString()}\n                </div>\n              </div>\n              {isExpanded ? (\n                <ChevronUp className=\"text-morandi-secondary\" size={20} />\n              ) : (\n                <ChevronDown className=\"text-morandi-secondary\" size={20} />\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* å±•é–‹è©³æƒ…è¡¨æ ¼ */}\n        {isExpanded && (\n          <div className=\"border-t border-morandi-gold/20\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead className=\"bg-morandi-container/5 border-b border-morandi-gold/20\">\n                  <tr>\n                    <th className=\"text-left py-2 px-3 text-xs font-semibold text-morandi-secondary\">è¨‚å–®è™Ÿ</th>\n                    <th className=\"text-left py-2 px-3 text-xs font-semibold text-morandi-secondary\">å®¢æˆ¶</th>\n                    <th className=\"text-right py-2 px-3 text-xs font-semibold text-morandi-secondary\">ç¸½é¡</th>\n                    <th className=\"text-right py-2 px-3 text-xs font-semibold text-morandi-secondary\">å·²æ”¶</th>\n                    <th className=\"text-right py-2 px-3 text-xs font-semibold text-morandi-secondary\">ç¼ºå£</th>\n                    <th className=\"text-center py-2 px-3 text-xs font-semibold text-morandi-secondary\">ç‹€æ…‹</th>\n                    <th className=\"text-center py-2 px-3 text-xs font-semibold text-morandi-secondary\">æ“ä½œ</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {orderList.orders.map((order, index) => {\n                    const status = getOrderStatus(order);\n                    const isProcessed = order.receipt_status === 'received';\n\n                    return (\n                      <tr\n                        key={order.id}\n                        className={`border-b border-morandi-container/10 hover:bg-morandi-container/5 transition-colors ${\n                          isProcessed ? 'opacity-60' : ''\n                        }`}\n                      >\n                        <td className=\"py-2 px-3 text-sm font-medium text-morandi-primary\">\n                          {order.order_number}\n                        </td>\n                        <td className=\"py-2 px-3 text-sm text-morandi-primary\">\n                          {order.contact_person || '-'}\n                        </td>\n                        <td className=\"py-2 px-3 text-sm text-right text-morandi-primary\">\n                          ${order.total_amount.toLocaleString()}\n                        </td>\n                        <td className=\"py-2 px-3 text-sm text-right text-morandi-primary\">\n                          ${order.paid_amount.toLocaleString()}\n                        </td>\n                        <td className=\"py-2 px-3 text-sm text-right font-semibold text-red-600\">\n                          ${order.gap.toLocaleString()}\n                        </td>\n                        <td className=\"py-2 px-3 text-center\">\n                          <span className={`text-xs px-2 py-0.5 rounded ${status.bgColor} ${status.color}`}>\n                            {status.text}\n                          </span>\n                        </td>\n                        <td className=\"py-2 px-3 text-center\">\n                          {isProcessed ? (\n                            <div className=\"flex items-center justify-center gap-1 text-xs text-morandi-secondary\">\n                              <Check size={14} className=\"text-green-600\" />\n                              <span>å·²è™•ç†</span>\n                            </div>\n                          ) : canProcess ? (\n                            <button\n                              onClick={() => onCreateReceipt(order.id, order)}\n                              className=\"btn-morandi-primary !py-1 !px-2 text-xs flex items-center gap-1 mx-auto\"\n                            >\n                              <DollarSign size={12} />\n                              <span>å»ºç«‹æ”¶æ¬¾å–®</span>\n                            </button>\n                          ) : (\n                            <div className=\"text-xs text-morandi-secondary\">å¾…è™•ç†</div>\n                          )}\n                        </td>\n                      </tr>\n                    );\n                  })}\n                </tbody>\n              </table>\n            </div>\n\n            {/* åº•éƒ¨çµ±è¨ˆ */}\n            <div className=\"p-3 bg-morandi-container/5 border-t border-morandi-gold/20\">\n              <div className=\"flex items-center justify-between text-xs text-morandi-secondary\">\n                <div>\n                  å…± {orderList.orders.length} ç­†è¨‚å–®\n                  {orderList.orders.filter(o => o.receipt_status === 'received').length > 0 && (\n                    <span className=\"ml-2\">\n                      ({orderList.orders.filter(o => o.receipt_status === 'received').length} ç­†å·²è™•ç†)\n                    </span>\n                  )}\n                </div>\n                <div className=\"font-medium text-morandi-primary\">\n                  ç¸½ç¼ºå£ï¼š${totalGap.toLocaleString()}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/PersonalCanvas.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tag' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":6},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3938,3941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3938,3941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleUpdateTags' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":186,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":186,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  FileText,\n  Plus,\n  Edit,\n  Trash2,\n  Star,\n  Search,\n  Grid,\n  List,\n  Eye,\n  Settings,\n  Tag\n} from 'lucide-react';\nimport { RichTextEditor, RichTextViewer } from './RichTextEditor';\nimport { useWorkspaceStore, PersonalCanvas as PersonalCanvasType, RichDocument } from '@/stores/workspace-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { format } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ninterface PersonalCanvasProps {\n  canvasId?: string;\n}\n\ntype ViewMode = 'grid' | 'list';\ntype EditMode = 'view' | 'create' | 'edit';\n\nexport function PersonalCanvas({ canvasId }: PersonalCanvasProps) {\n  const [viewMode, setViewMode] = useState<ViewMode>('grid');\n  const [editMode, setEditMode] = useState<EditMode>('view');\n  const [selectedDocument, setSelectedDocument] = useState<RichDocument | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedTag, setSelectedTag] = useState<string>('');\n  const [activeCanvasId, setActiveCanvasId] = useState<string | null>(canvasId || null);\n\n  const {\n    richDocuments,\n    personalCanvases,\n    currentWorkspace,\n    loadRichDocuments,\n    createRichDocument,\n    updateRichDocument,\n    deleteRichDocument,\n    loadPersonalCanvases,\n    createPersonalCanvas\n  } = useWorkspaceStore();\n\n  const { user } = useAuthStore();\n\n  // Load personal canvases when component mounts\n  useEffect(() => {\n    if (user?.id && currentWorkspace?.id) {\n      loadPersonalCanvases(user.id, currentWorkspace.id);\n    }\n  }, [user?.id, currentWorkspace?.id, loadPersonalCanvases]);\n\n  // Load documents when canvas changes\n  useEffect(() => {\n    if (activeCanvasId) {\n      loadRichDocuments(activeCanvasId);\n    }\n  }, [activeCanvasId, loadRichDocuments]);\n\n  // Get current canvas info\n  const currentCanvas = personalCanvases.find((canvas: PersonalCanvasType) => canvas.id === activeCanvasId);\n\n  // Function to add new canvas\n  const addNewCanvas = async () => {\n    if (!user?.id || !currentWorkspace?.id) return;\n\n    // é™åˆ¶æœ€å¤šåªèƒ½æœ‰ 5 å€‹è‡ªè¨‚å·¥ä½œå€\n    if (personalCanvases.length >= 5) {\n      alert('æœ€å¤šåªèƒ½å»ºç«‹ 5 å€‹è‡ªè¨‚å·¥ä½œå€ï¼Œè«‹åˆªé™¤ä¸éœ€è¦çš„å·¥ä½œå€å¾Œå†æ–°å¢ã€‚');\n      return;\n    }\n\n    const canvasNumber = personalCanvases.length + 1;\n    const newCanvas = {\n      employee_id: user.id,\n      workspace_id: currentWorkspace.id,\n      canvas_number: canvasNumber,\n      title: `æˆ‘çš„å·¥ä½œå€ ${canvasNumber}`,\n      type: 'custom' as const,\n      content: {},\n      layout: {}\n    };\n\n    try {\n      const createdCanvas = await createPersonalCanvas(newCanvas);\n      // è‡ªå‹•åˆ‡æ›åˆ°æ–°å»ºç«‹çš„å·¥ä½œå€\n      if (createdCanvas) {\n        setActiveCanvasId(createdCanvas.id);\n      }\n    } catch (error) {\n      console.error('å»ºç«‹å·¥ä½œå€å¤±æ•—:', error);\n      alert('å»ºç«‹å·¥ä½œå€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');\n    }\n  };\n\n  // Filter documents based on search and tags\n  const filteredDocuments = richDocuments.filter((doc: RichDocument) => {\n    const matchesSearch = !searchTerm ||\n      doc.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      doc.content.toLowerCase().includes(searchTerm.toLowerCase());\n\n    const matchesTag = !selectedTag || (doc.tags?.includes(selectedTag) ?? false);\n\n    return matchesSearch && matchesTag;\n  });\n\n  // Get all unique tags\n  const allTags = [...new Set(richDocuments.flatMap((doc: RichDocument) => doc.tags || []).filter(Boolean))];\n\n  const handleCreateDocument = () => {\n    setSelectedDocument(null);\n    setEditMode('create');\n  };\n\n  const handleEditDocument = (document: RichDocument) => {\n    setSelectedDocument(document);\n    setEditMode('edit');\n  };\n\n  const handleViewDocument = (document: RichDocument) => {\n    setSelectedDocument(document);\n    setEditMode('view');\n  };\n\n  const handleSaveDocument = async (title: string, content: string, formatData: Record<string, any>) => {\n    if (!activeCanvasId) return;\n\n    try {\n      if (editMode === 'create') {\n        await createRichDocument({\n          canvas_id: activeCanvasId,\n          title,\n          content,\n          format_data: formatData,\n          tags: [], // Start with empty tags, can be added later\n          is_favorite: false\n        });\n      } else if (editMode === 'edit' && selectedDocument) {\n        await updateRichDocument(selectedDocument.id, {\n          title,\n          content,\n          format_data: formatData\n        });\n      }\n      setEditMode('view');\n      setSelectedDocument(null);\n    } catch (error) {\n      console.error('å„²å­˜æ–‡ä»¶å¤±æ•—:', error);\n      throw error;\n    }\n  };\n\n  const handleDeleteDocument = async (documentId: string) => {\n    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ–‡ä»¶å—ï¼Ÿ')) {\n      try {\n        await deleteRichDocument(documentId);\n        if (selectedDocument?.id === documentId) {\n          setSelectedDocument(null);\n          setEditMode('view');\n        }\n      } catch (error) {\n        console.error('åˆªé™¤æ–‡ä»¶å¤±æ•—:', error);\n      }\n    }\n  };\n\n  const handleToggleFavorite = async (document: RichDocument) => {\n    try {\n      await updateRichDocument(document.id, {\n        is_favorite: !document.is_favorite\n      });\n    } catch (error) {\n      console.error('æ›´æ–°æ”¶è—å¤±æ•—:', error);\n    }\n  };\n\n  const handleUpdateTags = async (documentId: string, tags: string[]) => {\n    try {\n      await updateRichDocument(documentId, { tags });\n    } catch (error) {\n      console.error('æ›´æ–°æ¨™ç±¤å¤±æ•—:', error);\n    }\n  };\n\n  // Render document editing/viewing\n  if (editMode === 'create' || (editMode === 'edit' && selectedDocument)) {\n    return (\n      <div className=\"h-full p-6\">\n        <RichTextEditor\n          initialTitle={selectedDocument?.title || ''}\n          initialContent={selectedDocument?.content || ''}\n          onSave={handleSaveDocument}\n          onCancel={() => {\n            setEditMode('view');\n            setSelectedDocument(null);\n          }}\n          className=\"h-full\"\n        />\n      </div>\n    );\n  }\n\n  // Render document viewer\n  if (editMode === 'view' && selectedDocument) {\n    return (\n      <div className=\"h-full flex flex-col\">\n        {/* æ–‡ä»¶æª¢è¦–å·¥å…·åˆ— */}\n        <div className=\"flex items-center justify-between p-4 border-b border-border bg-white\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setEditMode('view')}\n            >\n              â† è¿”å›\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <Star\n                className={cn(\n                  \"w-5 h-5 cursor-pointer\",\n                  selectedDocument.is_favorite\n                    ? \"text-morandi-gold fill-morandi-gold\"\n                    : \"text-morandi-secondary\"\n                )}\n                onClick={() => handleToggleFavorite(selectedDocument)}\n              />\n              <span className=\"text-sm text-morandi-secondary\">\n                {selectedDocument.created_at ? format(new Date(selectedDocument.created_at), 'yyyy/MM/dd HH:mm') : 'æœªçŸ¥æ™‚é–“'}\n              </span>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleEditDocument(selectedDocument)}\n            >\n              <Edit size={16} className=\"mr-2\" />\n              ç·¨è¼¯\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"hover:bg-morandi-red/10 hover:text-morandi-red\"\n              onClick={() => handleDeleteDocument(selectedDocument.id)}\n            >\n              <Trash2 size={16} />\n            </Button>\n          </div>\n        </div>\n\n        {/* æ–‡ä»¶å…§å®¹ */}\n        <div className=\"flex-1 overflow-auto p-6\">\n          <RichTextViewer\n            title={selectedDocument.title}\n            content={selectedDocument.content}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  // If no active canvas selected, show canvas selection interface\n  if (!activeCanvasId) {\n    return (\n      <div className=\"h-full flex flex-col\">\n        {/* å·¥ä½œå€é¸æ“‡é ­éƒ¨ */}\n        <div className=\"flex items-center justify-between p-6 border-b border-border bg-white\">\n          <div>\n            <h2 className=\"text-lg font-semibold text-morandi-primary\">ç§äººç•«å¸ƒ</h2>\n            <p className=\"text-sm text-morandi-secondary\">\n              é¸æ“‡æˆ–å‰µå»ºæ‚¨çš„å€‹äººå·¥ä½œå€\n            </p>\n          </div>\n          <Button\n            onClick={addNewCanvas}\n            disabled={personalCanvases.length >= 5}\n            className={cn(\n              \"text-sm\",\n              personalCanvases.length >= 5\n                ? \"bg-gray-300 text-gray-500 cursor-not-allowed\"\n                : \"bg-morandi-gold hover:bg-morandi-gold/80 text-white\"\n            )}\n            title={personalCanvases.length >= 5 ? \"æœ€å¤šåªèƒ½å»ºç«‹ 5 å€‹è‡ªè¨‚å·¥ä½œå€\" : \"æ–°å¢è‡ªè¨‚å·¥ä½œå€\"}\n          >\n            <Plus size={16} className=\"mr-2\" />\n            æ–°å¢å·¥ä½œå€ ({personalCanvases.length}/5)\n          </Button>\n        </div>\n\n        {/* å·¥ä½œå€å¡ç‰‡åˆ—è¡¨ */}\n        <div className=\"flex-1 overflow-auto p-6\">\n          {personalCanvases.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full text-center\">\n              <FileText className=\"w-16 h-16 text-morandi-secondary/50 mb-4\" />\n              <h3 className=\"text-lg font-medium text-morandi-primary mb-2\">\n                é‚„æ²’æœ‰ä»»ä½•å·¥ä½œå€\n              </h3>\n              <p className=\"text-morandi-secondary mb-4\">\n                å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹å€‹äººå·¥ä½œå€ä¾†é–‹å§‹ä½¿ç”¨\n              </p>\n              <Button\n                onClick={addNewCanvas}\n                className=\"bg-morandi-gold hover:bg-morandi-gold/80 text-white\"\n              >\n                <Plus size={16} className=\"mr-2\" />\n                å»ºç«‹å·¥ä½œå€\n              </Button>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {personalCanvases.map((canvas: PersonalCanvasType) => (\n                <div\n                  key={canvas.id}\n                  className=\"morandi-card p-6 transition-all hover:shadow-md cursor-pointer\"\n                  onClick={() => setActiveCanvasId(canvas.id)}\n                >\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <h3 className=\"font-medium text-morandi-primary text-base\">\n                      {canvas.title}\n                    </h3>\n                    <FileText className=\"w-5 h-5 text-morandi-secondary\" />\n                  </div>\n                  <p className=\"text-sm text-morandi-secondary mb-4\">\n                    å·¥ä½œå€ #{canvas.canvas_number}\n                  </p>\n                  <div className=\"flex items-center justify-between text-xs text-morandi-secondary\">\n                    <span>\n                      {canvas.updated_at ? format(new Date(canvas.updated_at), 'MM/dd') : 'æœªçŸ¥æ—¥æœŸ'}\n                    </span>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"w-6 h-6\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setActiveCanvasId(canvas.id);\n                      }}\n                    >\n                      <Eye size={12} />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  // Render document list/grid view for selected canvas\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* å·¥å…·åˆ— */}\n      <div className=\"flex items-center justify-between p-4 border-b border-border bg-white\">\n        <div className=\"flex items-center gap-3\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setActiveCanvasId(null)}\n          >\n            â† è¿”å›å·¥ä½œå€åˆ—è¡¨\n          </Button>\n          <div>\n            <h2 className=\"text-lg font-semibold text-morandi-primary\">\n              {currentCanvas?.title || 'å€‹äººå·¥ä½œå€'}\n            </h2>\n            <p className=\"text-sm text-morandi-secondary\">\n              {filteredDocuments.length} å€‹æ–‡ä»¶\n            </p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            onClick={handleCreateDocument}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n          >\n            <Plus size={16} className=\"mr-2\" />\n            æ–°å¢æ–‡ä»¶\n          </Button>\n        </div>\n      </div>\n\n      {/* æœå°‹å’Œç¯©é¸ */}\n      <div className=\"flex items-center gap-4 p-4 border-b border-border bg-morandi-container/10\">\n        <div className=\"flex-1 relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-morandi-secondary\" />\n          <Input\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            placeholder=\"æœå°‹æ–‡ä»¶...\"\n            className=\"pl-10\"\n          />\n        </div>\n\n        {allTags.length > 0 && (\n          <select\n            value={selectedTag}\n            onChange={(e) => setSelectedTag(e.target.value)}\n            className=\"px-3 py-2 border border-border rounded-md text-sm\"\n          >\n            <option value=\"\">å…¨éƒ¨æ¨™ç±¤</option>\n            {allTags.map((tag: string) => (\n              <option key={tag} value={tag}>{tag}</option>\n            ))}\n          </select>\n        )}\n\n        <div className=\"flex gap-1\">\n          <Button\n            variant={viewMode === 'grid' ? 'default' : 'ghost'}\n            size=\"icon\"\n            className=\"w-8 h-8\"\n            onClick={() => setViewMode('grid')}\n          >\n            <Grid size={16} />\n          </Button>\n          <Button\n            variant={viewMode === 'list' ? 'default' : 'ghost'}\n            size=\"icon\"\n            className=\"w-8 h-8\"\n            onClick={() => setViewMode('list')}\n          >\n            <List size={16} />\n          </Button>\n        </div>\n      </div>\n\n      {/* æ–‡ä»¶åˆ—è¡¨ */}\n      <div className=\"flex-1 overflow-auto p-4\">\n        {filteredDocuments.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-center\">\n            <FileText className=\"w-16 h-16 text-morandi-secondary/50 mb-4\" />\n            <h3 className=\"text-lg font-medium text-morandi-primary mb-2\">\n              {searchTerm || selectedTag ? 'æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„æ–‡ä»¶' : 'é‚„æ²’æœ‰ä»»ä½•æ–‡ä»¶'}\n            </h3>\n            <p className=\"text-morandi-secondary mb-4\">\n              {searchTerm || selectedTag\n                ? 'å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶æˆ–æ¸…é™¤ç¯©é¸å™¨'\n                : 'é–‹å§‹å‰µå»ºæ‚¨çš„ç¬¬ä¸€å€‹æ–‡ä»¶'\n              }\n            </p>\n            {!searchTerm && !selectedTag && (\n              <Button\n                onClick={handleCreateDocument}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n              >\n                <Plus size={16} className=\"mr-2\" />\n                æ–°å¢æ–‡ä»¶\n              </Button>\n            )}\n          </div>\n        ) : (\n          <div className={cn(\n            viewMode === 'grid'\n              ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\"\n              : \"space-y-3\"\n          )}>\n            {filteredDocuments.map((document: RichDocument) => (\n              <div\n                key={document.id}\n                className={cn(\n                  \"morandi-card transition-all hover:shadow-md cursor-pointer\",\n                  viewMode === 'list' && \"flex items-center\"\n                )}\n                onClick={() => handleViewDocument(document)}\n              >\n                <div className={cn(\n                  \"p-4\",\n                  viewMode === 'list' && \"flex-1 flex items-center justify-between\"\n                )}>\n                  <div className={cn(\n                    viewMode === 'grid' && \"mb-3\",\n                    viewMode === 'list' && \"flex-1\"\n                  )}>\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <h3 className={cn(\n                        \"font-medium text-morandi-primary\",\n                        viewMode === 'grid' && \"text-base line-clamp-2\",\n                        viewMode === 'list' && \"text-sm\"\n                      )}>\n                        {document.title}\n                      </h3>\n                      <Star\n                        className={cn(\n                          \"w-4 h-4 ml-2 cursor-pointer\",\n                          document.is_favorite\n                            ? \"text-morandi-gold fill-morandi-gold\"\n                            : \"text-morandi-secondary\"\n                        )}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handleToggleFavorite(document);\n                        }}\n                      />\n                    </div>\n\n                    {viewMode === 'grid' && (\n                      <p className=\"text-sm text-morandi-secondary line-clamp-3 mb-3\">\n                        {document.content.replace(/<[^>]*>/g, '')}\n                      </p>\n                    )}\n\n                    <div className={cn(\n                      \"flex items-center justify-between text-xs text-morandi-secondary\",\n                      viewMode === 'list' && \"mt-1\"\n                    )}>\n                      <span>\n                        {document.updated_at ? format(new Date(document.updated_at), 'MM/dd') : 'æœªçŸ¥'}\n                      </span>\n                      <div className=\"flex items-center gap-2\">\n                        {document.tags && document.tags.length > 0 && (\n                          <div className=\"flex gap-1\">\n                            {document.tags.slice(0, 2).map((tag: string) => (\n                              <span\n                                key={tag}\n                                className=\"px-2 py-1 bg-morandi-container/30 text-morandi-secondary rounded-full text-xs\"\n                              >\n                                {tag}\n                              </span>\n                            ))}\n                            {document.tags.length > 2 && (\n                              <span className=\"text-morandi-secondary\">+{document.tags.length - 2}</span>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n\n                  {viewMode === 'list' && (\n                    <div className=\"flex items-center gap-1 ml-4\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"w-8 h-8\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handleEditDocument(document);\n                        }}\n                      >\n                        <Edit size={14} />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"w-8 h-8 hover:bg-morandi-red/10 hover:text-morandi-red\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handleDeleteDocument(document.id);\n                        }}\n                      >\n                        <Trash2 size={14} />\n                      </Button>\n                    </div>\n                  )}\n                </div>\n\n                {viewMode === 'grid' && (\n                  <div className=\"px-4 pb-4 flex justify-end gap-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"w-8 h-8\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleEditDocument(document);\n                      }}\n                    >\n                      <Edit size={14} />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"w-8 h-8 hover:bg-morandi-red/10 hover:text-morandi-red\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleDeleteDocument(document.id);\n                      }}\n                    >\n                      <Trash2 size={14} />\n                    </Button>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/QuickTools.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'newChecklist' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":68,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setNewChecklist' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":68,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4345,4348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4345,4348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport {\n  Calculator,\n  DollarSign,\n  FileText,\n  CheckSquare,\n  Plus,\n  Trash2,\n  Save,\n  X\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface Note {\n  id: string;\n  title: string;\n  content: string;\n  created_at: string;\n}\n\ninterface ChecklistItem {\n  id: string;\n  text: string;\n  completed: boolean;\n}\n\ninterface Checklist {\n  id: string;\n  title: string;\n  items: ChecklistItem[];\n  created_at: string;\n}\n\nexport function QuickTools() {\n  const [activeTab, setActiveTab] = useState<'calculator' | 'currency' | 'notes' | 'checklist'>('calculator');\n\n  // Calculator state\n  const [display, setDisplay] = useState('0');\n  const [previousValue, setPreviousValue] = useState<number | null>(null);\n  const [operation, setOperation] = useState<string | null>(null);\n  const [waitingForOperand, setWaitingForOperand] = useState(false);\n\n  // Currency converter state\n  const [amount, setAmount] = useState('');\n  const [fromCurrency, setFromCurrency] = useState('USD');\n  const [toCurrency, setToCurrency] = useState('TWD');\n  const [convertedAmount, setConvertedAmount] = useState<number | null>(null);\n  const [exchangeRates] = useState({\n    USD: { TWD: 31.5, EUR: 0.85, JPY: 110 },\n    TWD: { USD: 0.032, EUR: 0.027, JPY: 3.5 },\n    EUR: { USD: 1.18, TWD: 37.1, JPY: 129 },\n    JPY: { USD: 0.009, TWD: 0.29, EUR: 0.008 }\n  });\n\n  // Notes state\n  const [notes, setNotes] = useState<Note[]>([]);\n  const [newNote, setNewNote] = useState({ title: '', content: '' });\n  const [editingNote, setEditingNote] = useState<Note | null>(null);\n\n  // Checklist state\n  const [checklists, setChecklists] = useState<Checklist[]>([]);\n  const [newChecklist, setNewChecklist] = useState({ title: '', items: [] as ChecklistItem[] });\n  const [editingChecklist, setEditingChecklist] = useState<Checklist | null>(null);\n\n  // Load data from localStorage\n  useEffect(() => {\n    const savedNotes = localStorage.getItem('venturo-notes');\n    if (savedNotes) {\n      setNotes(JSON.parse(savedNotes));\n    }\n\n    const savedChecklists = localStorage.getItem('venturo-checklists');\n    if (savedChecklists) {\n      setChecklists(JSON.parse(savedChecklists));\n    }\n  }, []);\n\n  // Calculator functions\n  const inputNumber = (num: string) => {\n    if (waitingForOperand) {\n      setDisplay(num);\n      setWaitingForOperand(false);\n    } else {\n      setDisplay(display === '0' ? num : display + num);\n    }\n  };\n\n  const inputOperation = (nextOperation: string) => {\n    const inputValue = parseFloat(display);\n\n    if (previousValue === null) {\n      setPreviousValue(inputValue);\n    } else if (operation) {\n      const currentValue = previousValue || 0;\n      const newValue = calculate(currentValue, inputValue, operation);\n\n      setDisplay(`${parseFloat(newValue.toFixed(7))}`);\n      setPreviousValue(newValue);\n    }\n\n    setWaitingForOperand(true);\n    setOperation(nextOperation);\n  };\n\n  const calculate = (firstValue: number, secondValue: number, operation: string): number => {\n    switch (operation) {\n      case '+': return firstValue + secondValue;\n      case '-': return firstValue - secondValue;\n      case 'Ã—': return firstValue * secondValue;\n      case 'Ã·': return firstValue / secondValue;\n      case '=': return secondValue;\n      default: return secondValue;\n    }\n  };\n\n  const performCalculation = () => {\n    const inputValue = parseFloat(display);\n\n    if (previousValue !== null && operation) {\n      const newValue = calculate(previousValue, inputValue, operation);\n      setDisplay(`${parseFloat(newValue.toFixed(7))}`);\n      setPreviousValue(null);\n      setOperation(null);\n      setWaitingForOperand(true);\n    }\n  };\n\n  const clearCalculator = () => {\n    setDisplay('0');\n    setPreviousValue(null);\n    setOperation(null);\n    setWaitingForOperand(false);\n  };\n\n  // Currency converter functions\n  const convertCurrency = () => {\n    const amountNum = parseFloat(amount);\n    if (isNaN(amountNum) || amountNum <= 0) return;\n\n    if (fromCurrency === toCurrency) {\n      setConvertedAmount(amountNum);\n      return;\n    }\n\n    const rate = (exchangeRates as any)[fromCurrency]?.[toCurrency];\n    if (rate) {\n      setConvertedAmount(amountNum * rate);\n    }\n  };\n\n  // Notes functions\n  const saveNote = () => {\n    if (!newNote.title.trim() || !newNote.content.trim()) return;\n\n    const note: Note = {\n      id: Date.now().toString(),\n      title: newNote.title,\n      content: newNote.content,\n      created_at: new Date().toISOString()\n    };\n\n    const updatedNotes = [note, ...notes];\n    setNotes(updatedNotes);\n    localStorage.setItem('venturo-notes', JSON.stringify(updatedNotes));\n    setNewNote({ title: '', content: '' });\n  };\n\n  const updateNote = () => {\n    if (!editingNote || !newNote.title.trim() || !newNote.content.trim()) return;\n\n    const updatedNotes = notes.map(note =>\n      note.id === editingNote.id\n        ? { ...note, title: newNote.title, content: newNote.content }\n        : note\n    );\n    setNotes(updatedNotes);\n    localStorage.setItem('venturo-notes', JSON.stringify(updatedNotes));\n    setEditingNote(null);\n    setNewNote({ title: '', content: '' });\n  };\n\n  const deleteNote = (id: string) => {\n    const updatedNotes = notes.filter(note => note.id !== id);\n    setNotes(updatedNotes);\n    localStorage.setItem('venturo-notes', JSON.stringify(updatedNotes));\n  };\n\n  // Checklist functions\n  const addChecklistItem = (checklistId: string) => {\n    if (editingChecklist && editingChecklist.id === checklistId) {\n      const newItem: ChecklistItem = {\n        id: Date.now().toString(),\n        text: '',\n        completed: false\n      };\n      setEditingChecklist({\n        ...editingChecklist,\n        items: [...editingChecklist.items, newItem]\n      });\n    }\n  };\n\n  const updateChecklistItem = (itemId: string, updates: Partial<ChecklistItem>) => {\n    if (!editingChecklist) return;\n\n    const updatedItems = editingChecklist.items.map(item =>\n      item.id === itemId ? { ...item, ...updates } : item\n    );\n    setEditingChecklist({ ...editingChecklist, items: updatedItems });\n  };\n\n  const removeChecklistItem = (itemId: string) => {\n    if (!editingChecklist) return;\n\n    const updatedItems = editingChecklist.items.filter(item => item.id !== itemId);\n    setEditingChecklist({ ...editingChecklist, items: updatedItems });\n  };\n\n  const saveChecklist = () => {\n    if (!editingChecklist || !editingChecklist.title.trim()) return;\n\n    const validItems = editingChecklist.items.filter(item => item.text.trim());\n    if (validItems.length === 0) return;\n\n    const checklist: Checklist = {\n      ...editingChecklist,\n      items: validItems,\n      created_at: editingChecklist.id ? editingChecklist.created_at : new Date().toISOString()\n    };\n\n    let updatedChecklists;\n    if (checklists.find(c => c.id === checklist.id)) {\n      updatedChecklists = checklists.map(c => c.id === checklist.id ? checklist : c);\n    } else {\n      updatedChecklists = [checklist, ...checklists];\n    }\n\n    setChecklists(updatedChecklists);\n    localStorage.setItem('venturo-checklists', JSON.stringify(updatedChecklists));\n    setEditingChecklist(null);\n  };\n\n  const deleteChecklist = (id: string) => {\n    const updatedChecklists = checklists.filter(checklist => checklist.id !== id);\n    setChecklists(updatedChecklists);\n    localStorage.setItem('venturo-checklists', JSON.stringify(updatedChecklists));\n  };\n\n  const toggleChecklistItem = (checklistId: string, itemId: string) => {\n    const updatedChecklists = checklists.map(checklist =>\n      checklist.id === checklistId\n        ? {\n            ...checklist,\n            items: checklist.items.map(item =>\n              item.id === itemId ? { ...item, completed: !item.completed } : item\n            )\n          }\n        : checklist\n    );\n    setChecklists(updatedChecklists);\n    localStorage.setItem('venturo-checklists', JSON.stringify(updatedChecklists));\n  };\n\n  const tabs = [\n    { id: 'calculator', label: 'è¨ˆç®—æ©Ÿ', icon: Calculator },\n    { id: 'currency', label: 'åŒ¯ç‡', icon: DollarSign },\n    { id: 'notes', label: 'ç­†è¨˜', icon: FileText },\n    { id: 'checklist', label: 'æ¸…å–®', icon: CheckSquare }\n  ] as const;\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* å·¥å…·é¸é …å¡ */}\n      <div className=\"border-b border-border bg-white p-4\">\n        <div className=\"flex gap-2\">\n          {tabs.map(tab => {\n            const IconComponent = tab.icon;\n            return (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id)}\n                className={cn(\n                  \"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors\",\n                  activeTab === tab.id\n                    ? \"bg-morandi-gold text-white\"\n                    : \"text-morandi-secondary hover:bg-morandi-container/20 hover:text-morandi-primary\"\n                )}\n              >\n                <IconComponent size={16} />\n                {tab.label}\n              </button>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* å·¥å…·å…§å®¹å€åŸŸ */}\n      <div className=\"flex-1 overflow-auto p-6\">\n        {/* è¨ˆç®—æ©Ÿ */}\n        {activeTab === 'calculator' && (\n          <div className=\"max-w-sm mx-auto\">\n            <Card className=\"p-4\">\n              <div className=\"mb-4\">\n                <div className=\"bg-morandi-container/10 p-4 rounded-lg text-right text-2xl font-mono\">\n                  {display}\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-4 gap-2\">\n                <Button variant=\"outline\" onClick={clearCalculator} className=\"col-span-2\">C</Button>\n                <Button variant=\"outline\" onClick={() => inputOperation('Ã·')}>Ã·</Button>\n                <Button variant=\"outline\" onClick={() => inputOperation('Ã—')}>Ã—</Button>\n\n                <Button variant=\"outline\" onClick={() => inputNumber('7')}>7</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('8')}>8</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('9')}>9</Button>\n                <Button variant=\"outline\" onClick={() => inputOperation('-')}>-</Button>\n\n                <Button variant=\"outline\" onClick={() => inputNumber('4')}>4</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('5')}>5</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('6')}>6</Button>\n                <Button variant=\"outline\" onClick={() => inputOperation('+')} className=\"row-span-2\">+</Button>\n\n                <Button variant=\"outline\" onClick={() => inputNumber('1')}>1</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('2')}>2</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('3')}>3</Button>\n\n                <Button variant=\"outline\" onClick={() => inputNumber('0')} className=\"col-span-2\">0</Button>\n                <Button variant=\"outline\" onClick={() => inputNumber('.')}>.</Button>\n                <Button onClick={performCalculation} className=\"bg-morandi-gold hover:bg-morandi-gold-hover\">=</Button>\n              </div>\n            </Card>\n          </div>\n        )}\n\n        {/* åŒ¯ç‡è½‰æ›å™¨ */}\n        {activeTab === 'currency' && (\n          <div className=\"max-w-md mx-auto\">\n            <Card className=\"p-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">åŒ¯ç‡è½‰æ›</h3>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium mb-1\">é‡‘é¡</label>\n                  <Input\n                    type=\"number\"\n                    value={amount}\n                    onChange={(e) => setAmount(e.target.value)}\n                    placeholder=\"è¼¸å…¥é‡‘é¡\"\n                  />\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">å¾</label>\n                    <select\n                      value={fromCurrency}\n                      onChange={(e) => setFromCurrency(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-border rounded-md\"\n                    >\n                      <option value=\"USD\">ç¾å…ƒ (USD)</option>\n                      <option value=\"TWD\">å°å¹£ (TWD)</option>\n                      <option value=\"EUR\">æ­å…ƒ (EUR)</option>\n                      <option value=\"JPY\">æ—¥åœ“ (JPY)</option>\n                    </select>\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium mb-1\">åˆ°</label>\n                    <select\n                      value={toCurrency}\n                      onChange={(e) => setToCurrency(e.target.value)}\n                      className=\"w-full px-3 py-2 border border-border rounded-md\"\n                    >\n                      <option value=\"USD\">ç¾å…ƒ (USD)</option>\n                      <option value=\"TWD\">å°å¹£ (TWD)</option>\n                      <option value=\"EUR\">æ­å…ƒ (EUR)</option>\n                      <option value=\"JPY\">æ—¥åœ“ (JPY)</option>\n                    </select>\n                  </div>\n                </div>\n\n                <Button onClick={convertCurrency} className=\"w-full\">\n                  è½‰æ›\n                </Button>\n\n                {convertedAmount !== null && (\n                  <div className=\"bg-morandi-container/10 p-4 rounded-lg text-center\">\n                    <div className=\"text-2xl font-semibold text-morandi-primary\">\n                      {convertedAmount.toFixed(2)} {toCurrency}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </Card>\n          </div>\n        )}\n\n        {/* ç­†è¨˜ */}\n        {activeTab === 'notes' && (\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"flex gap-6\">\n              {/* æ–°å¢/ç·¨è¼¯ç­†è¨˜è¡¨å–® */}\n              <div className=\"w-1/2\">\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold mb-4\">\n                    {editingNote ? 'ç·¨è¼¯ç­†è¨˜' : 'æ–°å¢ç­†è¨˜'}\n                  </h3>\n\n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">æ¨™é¡Œ</label>\n                      <Input\n                        value={newNote.title}\n                        onChange={(e) => setNewNote({ ...newNote, title: e.target.value })}\n                        placeholder=\"ç­†è¨˜æ¨™é¡Œ\"\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium mb-1\">å…§å®¹</label>\n                      <Textarea\n                        value={newNote.content}\n                        onChange={(e) => setNewNote({ ...newNote, content: e.target.value })}\n                        placeholder=\"ç­†è¨˜å…§å®¹\"\n                        className=\"min-h-[200px]\"\n                      />\n                    </div>\n\n                    <div className=\"flex gap-2\">\n                      <Button\n                        onClick={editingNote ? updateNote : saveNote}\n                        className=\"flex-1\"\n                        disabled={!newNote.title.trim() || !newNote.content.trim()}\n                      >\n                        <Save size={16} className=\"mr-2\" />\n                        {editingNote ? 'æ›´æ–°' : 'å„²å­˜'}\n                      </Button>\n                      {editingNote && (\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => {\n                            setEditingNote(null);\n                            setNewNote({ title: '', content: '' });\n                          }}\n                        >\n                          <X size={16} />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </Card>\n              </div>\n\n              {/* ç­†è¨˜åˆ—è¡¨ */}\n              <div className=\"w-1/2\">\n                <div className=\"space-y-3\">\n                  {notes.length === 0 ? (\n                    <Card className=\"p-8 text-center\">\n                      <FileText className=\"w-12 h-12 mx-auto mb-4 text-morandi-secondary opacity-50\" />\n                      <p className=\"text-morandi-secondary\">é‚„æ²’æœ‰ä»»ä½•ç­†è¨˜</p>\n                    </Card>\n                  ) : (\n                    notes.map(note => (\n                      <Card key={note.id} className=\"p-4\">\n                        <div className=\"flex justify-between items-start mb-2\">\n                          <h4 className=\"font-medium text-morandi-primary\">{note.title}</h4>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"w-8 h-8\"\n                              onClick={() => {\n                                setEditingNote(note);\n                                setNewNote({ title: note.title, content: note.content });\n                              }}\n                            >\n                              <FileText size={14} />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"w-8 h-8 hover:bg-morandi-red/10 hover:text-morandi-red\"\n                              onClick={() => deleteNote(note.id)}\n                            >\n                              <Trash2 size={14} />\n                            </Button>\n                          </div>\n                        </div>\n                        <p className=\"text-sm text-morandi-secondary line-clamp-3\">\n                          {note.content}\n                        </p>\n                        <p className=\"text-xs text-morandi-secondary mt-2\">\n                          {new Date(note.created_at).toLocaleString()}\n                        </p>\n                      </Card>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* æ¸…å–® */}\n        {activeTab === 'checklist' && (\n          <div className=\"max-w-4xl mx-auto\">\n            <div className=\"flex gap-6\">\n              {/* æ–°å¢/ç·¨è¼¯æ¸…å–®è¡¨å–® */}\n              <div className=\"w-1/2\">\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold mb-4\">\n                    {editingChecklist?.id ? 'ç·¨è¼¯æ¸…å–®' : 'æ–°å¢æ¸…å–®'}\n                  </h3>\n\n                  {editingChecklist ? (\n                    <div className=\"space-y-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium mb-1\">æ¸…å–®æ¨™é¡Œ</label>\n                        <Input\n                          value={editingChecklist.title}\n                          onChange={(e) => setEditingChecklist({ ...editingChecklist, title: e.target.value })}\n                          placeholder=\"æ¸…å–®æ¨™é¡Œ\"\n                        />\n                      </div>\n\n                      <div>\n                        <div className=\"flex justify-between items-center mb-2\">\n                          <label className=\"block text-sm font-medium\">é …ç›®</label>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => addChecklistItem(editingChecklist.id)}\n                          >\n                            <Plus size={14} className=\"mr-1\" />\n                            æ–°å¢é …ç›®\n                          </Button>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                          {editingChecklist.items.map(item => (\n                            <div key={item.id} className=\"flex gap-2\">\n                              <Input\n                                value={item.text}\n                                onChange={(e) => updateChecklistItem(item.id, { text: e.target.value })}\n                                placeholder=\"é …ç›®å…§å®¹\"\n                                className=\"flex-1\"\n                              />\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"w-8 h-8\"\n                                onClick={() => removeChecklistItem(item.id)}\n                              >\n                                <X size={14} />\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-2\">\n                        <Button onClick={saveChecklist} className=\"flex-1\">\n                          <Save size={16} className=\"mr-2\" />\n                          å„²å­˜æ¸…å–®\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setEditingChecklist(null)}\n                        >\n                          <X size={16} />\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    <Button\n                      onClick={() => setEditingChecklist({\n                        id: Date.now().toString(),\n                        title: '',\n                        items: [{ id: Date.now().toString(), text: '', completed: false }],\n                        created_at: new Date().toISOString()\n                      })}\n                      className=\"w-full\"\n                    >\n                      <Plus size={16} className=\"mr-2\" />\n                      å»ºç«‹æ–°æ¸…å–®\n                    </Button>\n                  )}\n                </Card>\n              </div>\n\n              {/* æ¸…å–®åˆ—è¡¨ */}\n              <div className=\"w-1/2\">\n                <div className=\"space-y-3\">\n                  {checklists.length === 0 ? (\n                    <Card className=\"p-8 text-center\">\n                      <CheckSquare className=\"w-12 h-12 mx-auto mb-4 text-morandi-secondary opacity-50\" />\n                      <p className=\"text-morandi-secondary\">é‚„æ²’æœ‰ä»»ä½•æ¸…å–®</p>\n                    </Card>\n                  ) : (\n                    checklists.map(checklist => (\n                      <Card key={checklist.id} className=\"p-4\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <h4 className=\"font-medium text-morandi-primary\">{checklist.title}</h4>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"w-8 h-8\"\n                              onClick={() => setEditingChecklist(checklist)}\n                            >\n                              <FileText size={14} />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"w-8 h-8 hover:bg-morandi-red/10 hover:text-morandi-red\"\n                              onClick={() => deleteChecklist(checklist.id)}\n                            >\n                              <Trash2 size={14} />\n                            </Button>\n                          </div>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                          {checklist.items.map(item => (\n                            <div key={item.id} className=\"flex items-center gap-2\">\n                              <input\n                                type=\"checkbox\"\n                                checked={item.completed}\n                                onChange={() => toggleChecklistItem(checklist.id, item.id)}\n                                className=\"rounded\"\n                              />\n                              <span className={cn(\n                                \"text-sm\",\n                                item.completed\n                                  ? \"line-through text-morandi-secondary\"\n                                  : \"text-morandi-primary\"\n                              )}>\n                                {item.text}\n                              </span>\n                            </div>\n                          ))}\n                        </div>\n\n                        <div className=\"text-xs text-morandi-secondary mt-3\">\n                          {checklist.items.filter(item => item.completed).length} / {checklist.items.length} å®Œæˆ\n                        </div>\n                      </Card>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/RichTextEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[530,533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[530,533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport {\n  Bold,\n  Italic,\n  Underline,\n  AlignLeft,\n  AlignCenter,\n  AlignRight,\n  List,\n  ListOrdered,\n  Quote,\n  Link,\n  Type,\n  Palette,\n  Save,\n  X\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface RichTextEditorProps {\n  initialTitle?: string;\n  initialContent?: string;\n  onSave?: (title: string, content: string, formatData: Record<string, any>) => void;\n  onCancel?: () => void;\n  className?: string;\n}\n\nexport function RichTextEditor({\n  initialTitle = '',\n  initialContent = '',\n  onSave,\n  onCancel,\n  className\n}: RichTextEditorProps) {\n  const [title, setTitle] = useState(initialTitle);\n  const [isSaving, setIsSaving] = useState(false);\n  const editorRef = useRef<HTMLDivElement>(null);\n  const [selectedColor, setSelectedColor] = useState('#000000');\n  const [fontSize, setFontSize] = useState('14');\n\n  useEffect(() => {\n    if (editorRef.current && initialContent) {\n      editorRef.current.innerHTML = initialContent;\n    }\n  }, [initialContent]);\n\n  const execCommand = (command: string, value: string | boolean = false) => {\n    document.execCommand(command, false, value as string);\n    editorRef.current?.focus();\n  };\n\n  const setTextAlign = (align: string) => {\n    execCommand('justify' + align.charAt(0).toUpperCase() + align.slice(1));\n  };\n\n  const setTextColor = (color: string) => {\n    setSelectedColor(color);\n    execCommand('foreColor', color);\n  };\n\n  const setTextSize = (size: string) => {\n    setFontSize(size);\n    const selection = window.getSelection();\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      if (!range.collapsed) {\n        const span = document.createElement('span');\n        span.style.fontSize = size + 'px';\n        try {\n          range.surroundContents(span);\n        } catch {\n          // If selection spans multiple elements, wrap content differently\n          const contents = range.extractContents();\n          span.appendChild(contents);\n          range.insertNode(span);\n        }\n        selection.removeAllRanges();\n      }\n    }\n  };\n\n  const insertLink = () => {\n    const url = prompt('è«‹è¼¸å…¥ç¶²å€ï¼š');\n    if (url) {\n      execCommand('createLink', url);\n    }\n  };\n\n  const insertList = (ordered: boolean = false) => {\n    execCommand(ordered ? 'insertOrderedList' : 'insertUnorderedList');\n  };\n\n  const formatBlock = (tag: string) => {\n    execCommand('formatBlock', tag);\n  };\n\n  const handleSave = async () => {\n    if (!title.trim()) {\n      alert('è«‹è¼¸å…¥æ–‡ä»¶æ¨™é¡Œ');\n      return;\n    }\n\n    const content = editorRef.current?.innerHTML || '';\n    if (!content.trim() || content === '<br>') {\n      alert('è«‹è¼¸å…¥æ–‡ä»¶å…§å®¹');\n      return;\n    }\n\n    setIsSaving(true);\n    try {\n      // Extract format data from the content\n      const formatData = {\n        wordCount: editorRef.current?.textContent?.length || 0,\n        hasFormatting: content.includes('<') && content.includes('>'),\n        lastModified: new Date().toISOString()\n      };\n\n      await onSave?.(title, content, formatData);\n    } catch (error) {\n      console.error('å„²å­˜æ–‡ä»¶å¤±æ•—:', error);\n      alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const colors = [\n    '#000000', '#333333', '#666666', '#999999', '#CCCCCC',\n    '#FF0000', '#FF6600', '#FFCC00', '#CCFF00', '#66FF00',\n    '#00FF00', '#00FF66', '#00FFCC', '#00CCFF', '#0066FF',\n    '#0000FF', '#6600FF', '#CC00FF', '#FF00CC', '#FF0066'\n  ];\n\n  const fontSizes = ['10', '12', '14', '16', '18', '20', '24', '28', '32', '36'];\n\n  return (\n    <div className={cn(\"bg-white border border-border rounded-lg shadow-sm\", className)}>\n      {/* æ¨™é¡Œè¼¸å…¥ */}\n      <div className=\"p-4 border-b border-border\">\n        <Input\n          value={title}\n          onChange={(e) => setTitle(e.target.value)}\n          placeholder=\"æ–‡ä»¶æ¨™é¡Œ\"\n          className=\"text-lg font-medium\"\n        />\n      </div>\n\n      {/* å·¥å…·åˆ— */}\n      <div className=\"p-3 border-b border-border bg-morandi-container/10\">\n        <div className=\"flex flex-wrap gap-1 items-center\">\n          {/* åŸºæœ¬æ ¼å¼åŒ– */}\n          <div className=\"flex gap-1 mr-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => execCommand('bold')}\n              title=\"ç²—é«”\"\n            >\n              <Bold size={14} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => execCommand('italic')}\n              title=\"æ–œé«”\"\n            >\n              <Italic size={14} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => execCommand('underline')}\n              title=\"åº•ç·š\"\n            >\n              <Underline size={14} />\n            </Button>\n          </div>\n\n          {/* å°é½Šæ–¹å¼ */}\n          <div className=\"flex gap-1 mr-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => setTextAlign('left')}\n              title=\"é å·¦å°é½Š\"\n            >\n              <AlignLeft size={14} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => setTextAlign('center')}\n              title=\"ç½®ä¸­å°é½Š\"\n            >\n              <AlignCenter size={14} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => setTextAlign('right')}\n              title=\"é å³å°é½Š\"\n            >\n              <AlignRight size={14} />\n            </Button>\n          </div>\n\n          {/* åˆ—è¡¨ */}\n          <div className=\"flex gap-1 mr-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => insertList(false)}\n              title=\"é …ç›®ç¬¦è™Ÿåˆ—è¡¨\"\n            >\n              <List size={14} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => insertList(true)}\n              title=\"ç·¨è™Ÿåˆ—è¡¨\"\n            >\n              <ListOrdered size={14} />\n            </Button>\n          </div>\n\n          {/* å¼•ç”¨ */}\n          <div className=\"flex gap-1 mr-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={() => formatBlock('blockquote')}\n              title=\"å¼•ç”¨\"\n            >\n              <Quote size={14} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"w-8 h-8\"\n              onClick={insertLink}\n              title=\"æ’å…¥é€£çµ\"\n            >\n              <Link size={14} />\n            </Button>\n          </div>\n\n          {/* å­—é«”å¤§å° */}\n          <div className=\"flex items-center gap-2 mr-4\">\n            <Type size={14} />\n            <select\n              value={fontSize}\n              onChange={(e) => setTextSize(e.target.value)}\n              className=\"px-2 py-1 border border-border rounded text-xs\"\n            >\n              {fontSizes.map(size => (\n                <option key={size} value={size}>{size}px</option>\n              ))}\n            </select>\n          </div>\n\n          {/* æ–‡å­—é¡è‰² */}\n          <div className=\"flex items-center gap-2\">\n            <Palette size={14} />\n            <div className=\"flex gap-1\">\n              {colors.slice(0, 10).map(color => (\n                <button\n                  key={color}\n                  onClick={() => setTextColor(color)}\n                  className={cn(\n                    \"w-5 h-5 rounded border border-gray-300\",\n                    selectedColor === color && \"ring-2 ring-morandi-gold\"\n                  )}\n                  style={{ backgroundColor: color }}\n                  title={color}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* ç¬¬äºŒè¡Œé¡è‰² */}\n        <div className=\"flex gap-1 mt-2 ml-8\">\n          {colors.slice(10).map(color => (\n            <button\n              key={color}\n              onClick={() => setTextColor(color)}\n              className={cn(\n                \"w-5 h-5 rounded border border-gray-300\",\n                selectedColor === color && \"ring-2 ring-morandi-gold\"\n              )}\n              style={{ backgroundColor: color }}\n              title={color}\n            />\n          ))}\n        </div>\n      </div>\n\n      {/* ç·¨è¼¯å€åŸŸ */}\n      <div\n        ref={editorRef}\n        contentEditable\n        suppressContentEditableWarning\n        className=\"min-h-[400px] p-6 outline-none prose max-w-none\"\n        style={{\n          lineHeight: '1.6',\n          fontSize: `${fontSize}px`,\n          color: selectedColor\n        }}\n        onPaste={(e) => {\n          // Handle paste events to clean up formatting if needed\n          e.preventDefault();\n          const text = e.clipboardData.getData('text/plain');\n          document.execCommand('insertText', false, text);\n        }}\n      />\n\n      {/* æ“ä½œæŒ‰éˆ• */}\n      <div className=\"flex justify-end gap-2 p-4 border-t border-border bg-morandi-container/5\">\n        {onCancel && (\n          <Button variant=\"outline\" onClick={onCancel} disabled={isSaving}>\n            <X size={16} className=\"mr-2\" />\n            å–æ¶ˆ\n          </Button>\n        )}\n        <Button\n          onClick={handleSave}\n          disabled={isSaving || !title.trim()}\n          className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n        >\n          <Save size={16} className=\"mr-2\" />\n          {isSaving ? 'å„²å­˜ä¸­...' : 'å„²å­˜'}\n        </Button>\n      </div>\n\n      {/* å­—æ•¸çµ±è¨ˆ */}\n      <div className=\"px-4 pb-2 text-xs text-morandi-secondary text-right\">\n        å­—æ•¸ï¼š{editorRef.current?.textContent?.length || 0}\n      </div>\n    </div>\n  );\n}\n\n// ç°¡åŒ–ç‰ˆçš„å¯Œæ–‡æœ¬é¡¯ç¤ºå™¨\nexport function RichTextViewer({\n  title,\n  content,\n  className\n}: {\n  title: string;\n  content: string;\n  className?: string;\n}) {\n  return (\n    <div className={cn(\"bg-white border border-border rounded-lg\", className)}>\n      <div className=\"p-4 border-b border-border\">\n        <h3 className=\"text-lg font-semibold text-morandi-primary\">{title}</h3>\n      </div>\n      <div\n        className=\"p-6 prose max-w-none\"\n        dangerouslySetInnerHTML={{ __html: content }}\n        style={{ lineHeight: '1.6' }}\n      />\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/ShareAdvanceDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1297,1300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1297,1300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1343,1346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1343,1346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useState, useMemo } from 'react';\nimport { Plus, Trash2, X } from 'lucide-react';\nimport { useWorkspaceStore } from '@/stores/workspace-store';\nimport { useUserStore } from '@/stores/user-store';\nimport { Combobox } from '@/components/ui/combobox';\n\ninterface AdvanceRow {\n  name: string;\n  description: string;\n  amount: string;\n  advance_person: string;\n}\n\ninterface ShareAdvanceDialogProps {\n  channelId: string;\n  currentUserId: string;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport function ShareAdvanceDialog({\n  channelId,\n  currentUserId,\n  onClose,\n  onSuccess\n}: ShareAdvanceDialogProps) {\n  const { shareAdvanceList } = useWorkspaceStore();\n  const { items: employees, fetchAll: fetchEmployees } = useUserStore();\n\n  const [rows, setRows] = useState<AdvanceRow[]>([\n    { name: '', description: '', amount: '', advance_person: '' },\n    { name: '', description: '', amount: '', advance_person: '' },\n    { name: '', description: '', amount: '', advance_person: '' }\n  ]);\n\n  // è¼‰å…¥å“¡å·¥è³‡æ–™\n  React.useEffect(() => {\n    if (employees.length === 0) {\n      fetchEmployees();\n    }\n  }, [employees.length, fetchEmployees]);\n\n  // ç¯©é¸æ´»èºå“¡å·¥\n  const activeEmployees = useMemo(() => {\n    return employees.filter(emp => {\n      const notDeleted = !(emp as any)._deleted;\n      const isActive = (emp as any).status === 'active';\n      return notDeleted && isActive;\n    });\n  }, [employees]);\n\n  const addRow = () => {\n    setRows([...rows, { name: '', description: '', amount: '', advance_person: '' }]);\n  };\n\n  const removeRow = (index: number) => {\n    if (rows.length > 1) {\n      setRows(rows.filter((_, i) => i !== index));\n    }\n  };\n\n  const updateRow = (index: number, field: keyof AdvanceRow, value: string) => {\n    const newRows = [...rows];\n    newRows[index][field] = value;\n    setRows(newRows);\n  };\n\n  const totalAmount = rows.reduce((sum, row) => {\n    const amount = parseFloat(row.amount) || 0;\n    return sum + amount;\n  }, 0);\n\n  const handleShare = async () => {\n    // é©—è­‰ï¼šè‡³å°‘æœ‰ä¸€ç­†æœ‰æ•ˆè³‡æ–™\n    const validRows = rows.filter(\n      row => row.name.trim() && row.amount && parseFloat(row.amount) > 0 && row.advance_person.trim()\n    );\n\n    if (validRows.length === 0) {\n      alert('è«‹è‡³å°‘å¡«å¯«ä¸€ç­†å®Œæ•´çš„ä»£å¢Šé …ç›®');\n      return;\n    }\n\n    try {\n      const items = validRows.map(row => ({\n        name: row.name.trim(),\n        description: row.description.trim(),\n        amount: parseFloat(row.amount),\n        advance_person: row.advance_person.trim()\n      }));\n\n      await shareAdvanceList(channelId, items, currentUserId);\n      onSuccess();\n      onClose();\n    } catch (error) {\n      console.error('åˆ†äº«ä»£å¢Šæ¸…å–®å¤±æ•—:', error);\n      alert('åˆ†äº«å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/20 flex items-center justify-center z-50\" onClick={onClose}>\n      <div className=\"card-morandi-elevated w-[800px] max-h-[80vh] overflow-hidden flex flex-col\" onClick={(e) => e.stopPropagation()}>\n        {/* æ¨™é¡Œåˆ— */}\n        <div className=\"flex items-center justify-between pb-3 border-b border-morandi-gold/20\">\n          <h3 className=\"text-lg font-semibold text-morandi-primary\">è¨˜éŒ„ä»£å¢Šé …ç›®</h3>\n          <button onClick={onClose} className=\"btn-icon-morandi !w-8 !h-8\">\n            <X size={16} />\n          </button>\n        </div>\n\n        {/* è¡¨æ ¼å€åŸŸ */}\n        <div className=\"flex-1 overflow-y-auto my-4\">\n          <table className=\"w-full\">\n            <thead className=\"sticky top-0 bg-morandi-container/5 border-b border-morandi-gold/20\">\n              <tr>\n                <th className=\"text-left py-2 px-2 text-sm font-semibold text-morandi-secondary w-[30%]\">å“é …</th>\n                <th className=\"text-left py-2 px-2 text-sm font-semibold text-morandi-secondary w-[25%]\">èªªæ˜</th>\n                <th className=\"text-left py-2 px-2 text-sm font-semibold text-morandi-secondary w-[20%]\">é‡‘é¡</th>\n                <th className=\"text-left py-2 px-2 text-sm font-semibold text-morandi-secondary w-[20%]\">ä»£å¢Šäºº</th>\n                <th className=\"w-[5%]\"></th>\n              </tr>\n            </thead>\n            <tbody>\n              {rows.map((row, index) => (\n                <tr key={index} className=\"border-b border-morandi-container/20\">\n                  <td className=\"py-2 px-2\">\n                    <input\n                      type=\"text\"\n                      value={row.name}\n                      onChange={(e) => updateRow(index, 'name', e.target.value)}\n                      placeholder=\"å“é …åç¨±\"\n                      className=\"input-morandi !py-1.5 text-sm w-full\"\n                    />\n                  </td>\n                  <td className=\"py-2 px-2\">\n                    <input\n                      type=\"text\"\n                      value={row.description}\n                      onChange={(e) => updateRow(index, 'description', e.target.value)}\n                      placeholder=\"èªªæ˜\"\n                      className=\"input-morandi !py-1.5 text-sm w-full\"\n                    />\n                  </td>\n                  <td className=\"py-2 px-2\">\n                    <input\n                      type=\"number\"\n                      value={row.amount}\n                      onChange={(e) => updateRow(index, 'amount', e.target.value)}\n                      placeholder=\"0\"\n                      className=\"input-morandi !py-1.5 text-sm w-full\"\n                    />\n                  </td>\n                  <td className=\"py-2 px-2\">\n                    <Combobox\n                      options={activeEmployees.map((emp) => ({\n                        value: emp.display_name || emp.english_name,\n                        label: `${emp.display_name || emp.english_name} (${emp.employee_number})`\n                      }))}\n                      value={row.advance_person}\n                      onChange={(value) => updateRow(index, 'advance_person', value)}\n                      placeholder=\"é¸æ“‡ä»£å¢Šäºº...\"\n                      emptyMessage=\"æ‰¾ä¸åˆ°å“¡å·¥\"\n                      showSearchIcon={true}\n                      showClearButton={true}\n                      className=\"!py-1.5 text-sm\"\n                    />\n                  </td>\n                  <td className=\"py-2 px-2 text-center\">\n                    <button\n                      onClick={() => removeRow(index)}\n                      disabled={rows.length === 1}\n                      className=\"btn-icon-morandi !w-7 !h-7 disabled:opacity-30 disabled:cursor-not-allowed\"\n                    >\n                      <Trash2 size={14} />\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n\n          {/* æ–°å¢åˆ—æŒ‰éˆ• */}\n          <button\n            onClick={addRow}\n            className=\"flex items-center gap-2 mt-3 text-sm text-morandi-gold hover:text-morandi-primary transition-colors\"\n          >\n            <Plus size={16} />\n            <span>æ–°å¢åˆ—</span>\n          </button>\n        </div>\n\n        {/* åº•éƒ¨ï¼šç¸½è¨ˆèˆ‡æ“ä½œæŒ‰éˆ• */}\n        <div className=\"pt-3 border-t border-morandi-gold/20\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <span className=\"text-sm text-morandi-secondary\">ç¸½è¨ˆé‡‘é¡ï¼š</span>\n            <span className=\"text-lg font-semibold text-morandi-primary\">\n              ${totalAmount.toLocaleString()}\n            </span>\n          </div>\n          <div className=\"flex gap-2 justify-end\">\n            <button className=\"btn-morandi-secondary !py-2 !px-4\" onClick={onClose}>\n              å–æ¶ˆ\n            </button>\n            <button className=\"btn-morandi-primary !py-2 !px-4\" onClick={handleShare}>\n              åˆ†äº«åˆ°é »é“\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/ShareOrdersDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Order' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { X, Search, Receipt } from 'lucide-react';\nimport { useOrderStore } from '@/stores';\nimport { useWorkspaceStore } from '@/stores/workspace-store';\nimport { useAuthStore } from '@/stores/auth-store';\nimport { Order } from '@/stores/types';\n\ninterface ShareOrdersDialogProps {\n  channelId: string;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport function ShareOrdersDialog({\n  channelId,\n  onClose,\n  onSuccess\n}: ShareOrdersDialogProps) {\n  const { items: orders } = useOrderStore();\n  const { shareOrderList } = useWorkspaceStore();\n  const { user } = useAuthStore();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedOrders, setSelectedOrders] = useState<Set<string>>(new Set());\n\n  // è¨ˆç®—è¨‚å–®çš„æ”¶æ¬¾ç‡å’Œç¼ºå£\n  const ordersWithGap = useMemo(() => {\n    return orders\n      .map(order => {\n        const totalCost = order.total_amount || 0;\n        const collected = order.paid_amount || 0;\n        const gap = totalCost - collected;\n        const collectionRate = totalCost > 0 ? (collected / totalCost) * 100 : 0;\n\n        return {\n          ...order,\n          gap,\n          collectionRate\n        };\n      })\n      .filter(order => {\n        // éæ¿¾ï¼šæœ‰ç¼ºå£çš„è¨‚å–®ï¼ˆå¾…æ”¶æ¬¾ï¼‰\n        return order.gap > 0;\n      })\n      .sort((a, b) => {\n        // æ’åºå„ªå…ˆç´šï¼š\n        // 1. æˆæœ¬ > 0 ä¸”æ”¶æ¬¾ = 0ï¼ˆå®Œå…¨æ²’æ”¶ï¼‰\n        // 2. æ”¶æ¬¾ç‡ < 30%\n        // 3. ç¼ºå£é‡‘é¡å¤§çš„å„ªå…ˆ\n        const aFullyUnpaid = a.total_amount > 0 && a.paid_amount === 0;\n        const bFullyUnpaid = b.total_amount > 0 && b.paid_amount === 0;\n\n        if (aFullyUnpaid && !bFullyUnpaid) return -1;\n        if (!aFullyUnpaid && bFullyUnpaid) return 1;\n\n        const aLowRate = a.collectionRate < 30;\n        const bLowRate = b.collectionRate < 30;\n\n        if (aLowRate && !bLowRate) return -1;\n        if (!aLowRate && bLowRate) return 1;\n\n        return b.gap - a.gap;\n      });\n  }, [orders]);\n\n  // æœå°‹éæ¿¾\n  const filteredOrders = useMemo(() => {\n    if (!searchQuery.trim()) return ordersWithGap;\n\n    const query = searchQuery.toLowerCase();\n    return ordersWithGap.filter(order =>\n      order.order_number.toLowerCase().includes(query) ||\n      order.contact_person?.toLowerCase().includes(query) ||\n      order.tour_name?.toLowerCase().includes(query)\n    );\n  }, [ordersWithGap, searchQuery]);\n\n  // åˆ‡æ›è¨‚å–®é¸æ“‡\n  const toggleOrderSelection = (orderId: string) => {\n    const newSelected = new Set(selectedOrders);\n    if (newSelected.has(orderId)) {\n      newSelected.delete(orderId);\n    } else {\n      newSelected.add(orderId);\n    }\n    setSelectedOrders(newSelected);\n  };\n\n  // è¨ˆç®—å·²é¸è¨‚å–®çš„ç¸½ç¼ºå£\n  const selectedStats = useMemo(() => {\n    const selected = filteredOrders.filter(order => selectedOrders.has(order.id));\n    const totalGap = selected.reduce((sum, order) => sum + order.gap, 0);\n    return {\n      count: selected.length,\n      totalGap\n    };\n  }, [filteredOrders, selectedOrders]);\n\n  const handleShare = async () => {\n    if (selectedOrders.size === 0) {\n      alert('è«‹è‡³å°‘é¸æ“‡ä¸€ç­†è¨‚å–®');\n      return;\n    }\n\n    if (!user) {\n      alert('è«‹å…ˆç™»å…¥');\n      return;\n    }\n\n    try {\n      await shareOrderList(channelId, Array.from(selectedOrders), user.id);\n      onSuccess();\n      onClose();\n    } catch (error) {\n      console.error('åˆ†äº«è¨‚å–®å¤±æ•—:', error);\n      alert('åˆ†äº«è¨‚å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/20 flex items-center justify-center z-50\" onClick={onClose}>\n      <div className=\"card-morandi-elevated w-[900px] max-h-[80vh] overflow-hidden flex flex-col\" onClick={(e) => e.stopPropagation()}>\n        {/* æ¨™é¡Œåˆ— */}\n        <div className=\"flex items-center justify-between pb-3 border-b border-morandi-gold/20\">\n          <div className=\"flex items-center gap-2\">\n            <Receipt className=\"text-morandi-gold\" size={20} />\n            <h3 className=\"text-lg font-semibold text-morandi-primary\">é¸æ“‡å¾…æ”¶æ¬¾è¨‚å–®</h3>\n          </div>\n          <button onClick={onClose} className=\"btn-icon-morandi !w-8 !h-8\">\n            <X size={16} />\n          </button>\n        </div>\n\n        {/* æœå°‹åˆ— */}\n        <div className=\"my-3\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-morandi-secondary\" size={16} />\n            <input\n              type=\"text\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              placeholder=\"æœå°‹è¨‚å–®è™Ÿã€å®¢æˆ¶åç¨±...\"\n              className=\"input-morandi pl-10\"\n            />\n          </div>\n        </div>\n\n        {/* è¨‚å–®åˆ—è¡¨ */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {filteredOrders.length === 0 ? (\n            <div className=\"text-center py-8 text-morandi-secondary\">\n              {searchQuery ? 'æ²’æœ‰ç¬¦åˆæœå°‹æ¢ä»¶çš„è¨‚å–®' : 'ç›®å‰æ²’æœ‰å¾…æ”¶æ¬¾è¨‚å–®'}\n            </div>\n          ) : (\n            <table className=\"w-full\">\n              <thead className=\"sticky top-0 bg-morandi-container/5 border-b border-morandi-gold/20\">\n                <tr>\n                  <th className=\"w-10 py-2 px-2\"></th>\n                  <th className=\"text-left py-2 px-2 text-sm font-semibold text-morandi-secondary\">è¨‚å–®è™Ÿ</th>\n                  <th className=\"text-left py-2 px-2 text-sm font-semibold text-morandi-secondary\">å®¢æˆ¶</th>\n                  <th className=\"text-right py-2 px-2 text-sm font-semibold text-morandi-secondary\">ç¸½é¡</th>\n                  <th className=\"text-right py-2 px-2 text-sm font-semibold text-morandi-secondary\">å·²æ”¶</th>\n                  <th className=\"text-right py-2 px-2 text-sm font-semibold text-morandi-secondary\">ç¼ºå£</th>\n                  <th className=\"text-center py-2 px-2 text-sm font-semibold text-morandi-secondary\">ç‹€æ…‹</th>\n                </tr>\n              </thead>\n              <tbody>\n                {filteredOrders.map((order) => {\n                  const isSelected = selectedOrders.has(order.id);\n                  const isFullyUnpaid = order.total_amount > 0 && order.paid_amount === 0;\n                  const isLowRate = order.collectionRate < 30;\n\n                  return (\n                    <tr\n                      key={order.id}\n                      className={`border-b border-morandi-container/20 hover:bg-morandi-gold/5 cursor-pointer transition-colors ${\n                        isSelected ? 'bg-morandi-gold/10' : ''\n                      }`}\n                      onClick={() => toggleOrderSelection(order.id)}\n                    >\n                      <td className=\"py-2 px-2 text-center\">\n                        <input\n                          type=\"checkbox\"\n                          checked={isSelected}\n                          onChange={() => toggleOrderSelection(order.id)}\n                          className=\"w-4 h-4 rounded border-morandi-gold/30 text-morandi-gold focus:ring-morandi-gold/20\"\n                          onClick={(e) => e.stopPropagation()}\n                        />\n                      </td>\n                      <td className=\"py-2 px-2 text-sm text-morandi-primary font-medium\">\n                        {order.order_number}\n                      </td>\n                      <td className=\"py-2 px-2 text-sm text-morandi-primary\">\n                        {order.contact_person || '-'}\n                      </td>\n                      <td className=\"py-2 px-2 text-sm text-right text-morandi-primary\">\n                        ${order.total_amount.toLocaleString()}\n                      </td>\n                      <td className=\"py-2 px-2 text-sm text-right text-morandi-primary\">\n                        ${order.paid_amount.toLocaleString()}\n                      </td>\n                      <td className=\"py-2 px-2 text-sm text-right font-semibold text-red-600\">\n                        ${order.gap.toLocaleString()}\n                      </td>\n                      <td className=\"py-2 px-2 text-center\">\n                        {isFullyUnpaid ? (\n                          <span className=\"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded\">\n                            âŒâŒ æœªæ”¶æ¬¾\n                          </span>\n                        ) : isLowRate ? (\n                          <span className=\"text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded\">\n                            âš ï¸ æ”¶æ¬¾ç‡ä½\n                          </span>\n                        ) : (\n                          <span className=\"text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded\">\n                            éƒ¨åˆ†æ”¶æ¬¾\n                          </span>\n                        )}\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          )}\n        </div>\n\n        {/* åº•éƒ¨ï¼šçµ±è¨ˆèˆ‡æ“ä½œæŒ‰éˆ• */}\n        <div className=\"pt-3 border-t border-morandi-gold/20\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"text-sm text-morandi-secondary\">\n              å·²é¸æ“‡ <span className=\"font-semibold text-morandi-primary\">{selectedStats.count}</span> ç­†è¨‚å–®\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-xs text-morandi-secondary\">ç¸½ç¼ºå£é‡‘é¡</div>\n              <div className=\"text-lg font-semibold text-red-600\">\n                ${selectedStats.totalGap.toLocaleString()}\n              </div>\n            </div>\n          </div>\n          <div className=\"flex gap-2 justify-end\">\n            <button className=\"btn-morandi-secondary !py-2 !px-4\" onClick={onClose}>\n              å–æ¶ˆ\n            </button>\n            <button\n              className=\"btn-morandi-primary !py-2 !px-4\"\n              onClick={handleShare}\n              disabled={selectedOrders.size === 0}\n            >\n              åˆ†äº«åˆ°é »é“\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/canvas-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[717,720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[717,720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[769,772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[769,772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[777,780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[777,780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[891,894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[891,894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1621,1624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1621,1624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2344,2347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2344,2347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4197,4200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4197,4200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\n\nimport { FileText, CheckSquare, Folder, Plus } from 'lucide-react';\n\nimport { WorkspaceTaskList } from './workspace-task-list';\nimport { Button } from '@/components/ui/button';\nimport type { Channel } from '@/stores/workspace-store';\nimport { useWorkspaceStore } from '@/stores/workspace-store';\n\nimport { cn } from '@/lib/utils';\n\ninterface CanvasViewProps {\n  channel: Channel;\n}\n\nexport function CanvasView({ channel }: CanvasViewProps) {\n  const { personalCanvases, createPersonalCanvas } = useWorkspaceStore();\n  const [activeDocId, setActiveDocId] = useState<string | null>(null);\n\n  // ç²å–è©²é »é“çš„ Canvas æ–‡ä»¶\n  const channelDocs = personalCanvases\n    .filter((doc: any) => doc.channelId === channel.id)\n    .sort((a: any, b: any) => a.order - b.order);\n  \n  // å¦‚æœæ²’æœ‰é¸æ“‡æ–‡ä»¶ï¼Œè‡ªå‹•é¸æ“‡ç¬¬ä¸€å€‹\n  const activeDoc = activeDocId\n    ? channelDocs.find((doc: any) => doc.id === activeDocId)\n    : channelDocs[0];\n  \n  const getDocIcon = (type: string) => {\n    switch (type) {\n      case 'document':\n        return FileText;\n      case 'tasks':\n        return CheckSquare;\n      case 'files':\n        return Folder;\n      default:\n        return FileText;\n    }\n  };\n  \n  const handleCreateDoc = (type: 'document' | 'tools' | 'custom') => {\n    const typeNames = {\n      document: 'æ–°æ–‡ä»¶',\n      tools: 'å¾…è¾¦æ¸…å–®',\n      custom: 'æª”æ¡ˆåº«',\n    };\n\n    createPersonalCanvas({\n      employee_id: '1', // TODO: å¾ auth store ç²å–\n      workspace_id: channel.workspace_id,\n      canvas_number: channelDocs.length + 1,\n      title: typeNames[type],\n      type,\n      content: {},\n      layout: {},\n    } as any);\n  };\n  \n  return (\n    <div className=\"flex-1 flex overflow-hidden\">\n      {/* å·¦å´ï¼šCanvas æ–‡ä»¶åˆ—è¡¨ */}\n      <div className=\"w-48 border-r border-border bg-morandi-container/5 flex flex-col\">\n        <div className=\"p-3 border-b border-border\">\n          <div className=\"text-xs font-semibold text-morandi-secondary mb-2\">Canvas</div>\n          <Button\n            onClick={() => handleCreateDoc('document')}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-full justify-start text-xs\"\n          >\n            <Plus size={12} className=\"mr-1\" />\n            æ–°å¢æ–‡ä»¶\n          </Button>\n        </div>\n        \n        <div className=\"flex-1 overflow-y-auto py-2\">\n          {channelDocs.map((doc: any) => {\n            const Icon = getDocIcon(doc.type);\n            const is_active = activeDoc?.id === doc.id;\n\n            return (\n              <button\n                key={doc.id}\n                onClick={() => setActiveDocId(doc.id)}\n                className={cn(\n                  'w-full text-left px-3 py-2 text-sm transition-colors flex items-center gap-2',\n                  is_active\n                    ? 'bg-morandi-gold/10 text-morandi-primary font-medium'\n                    : 'text-morandi-secondary hover:bg-morandi-container/20 hover:text-morandi-primary'\n                )}\n              >\n                <Icon size={14} className=\"flex-shrink-0\" />\n                <span className=\"flex-1 truncate\">{doc.title}</span>\n              </button>\n            );\n          })}\n          \n          {channelDocs.length === 0 && (\n            <div className=\"px-3 py-8 text-center text-xs text-morandi-secondary\">\n              <p>å°šç„¡ Canvas æ–‡ä»¶</p>\n              <p className=\"mt-1\">é»æ“Šä¸Šæ–¹æŒ‰éˆ•å»ºç«‹</p>\n            </div>\n          )}\n        </div>\n      </div>\n      \n      {/* å³å´ï¼šCanvas å…§å®¹ */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {activeDoc ? (\n          <div className=\"p-6\">\n            <div className=\"mb-6\">\n              <h3 className=\"text-xl font-semibold text-morandi-primary mb-2\">\n                {activeDoc.title}\n              </h3>\n              <div className=\"text-sm text-morandi-secondary\">\n                {activeDoc.type === 'tools' && 'ç®¡ç†åœ˜éšŠå¾…è¾¦äº‹é …'}\n                {activeDoc.type === 'document' && 'å…±åŒç·¨è¼¯æ–‡ä»¶'}\n                {activeDoc.type === 'custom' && 'å…±äº«æª”æ¡ˆåº«'}\n              </div>\n            </div>\n            \n            {/* æ ¹æ“šé¡å‹æ¸²æŸ“ä¸åŒå…§å®¹ */}\n            {activeDoc.type === 'tools' && (\n              <WorkspaceTaskList\n                channelId={channel.id}\n                tour_id={(channel as any).tour_id}\n              />\n            )}\n            \n            {activeDoc.type === 'document' && (\n              <div className=\"border border-border rounded-lg p-4 bg-white\">\n                <p className=\"text-sm text-morandi-secondary\">\n                  å¯Œæ–‡æœ¬ç·¨è¼¯å™¨é–‹ç™¼ä¸­...\n                </p>\n              </div>\n            )}\n            \n            {activeDoc.type === 'custom' && (\n              <div className=\"border border-border rounded-lg p-4 bg-white\">\n                <p className=\"text-sm text-morandi-secondary\">\n                  æª”æ¡ˆåº«åŠŸèƒ½é–‹ç™¼ä¸­...\n                </p>\n              </div>\n            )}\n          </div>\n        ) : (\n          <div className=\"flex items-center justify-center h-full text-morandi-secondary\">\n            <div className=\"text-center\">\n              <FileText size={48} className=\"mx-auto mb-4 opacity-50\" />\n              <p className=\"text-sm\">å°šç„¡ Canvas æ–‡ä»¶</p>\n              <p className=\"text-xs mt-1\">å¾å·¦å´å»ºç«‹æ–°æ–‡ä»¶</p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/channel-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[756,759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[756,759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Hash, Lock, Archive } from 'lucide-react';\n\nimport type { Channel } from '@/stores/workspace-store';\n\nimport { cn } from '@/lib/utils';\n\ninterface ChannelListProps {\n  channels: Channel[];\n  activeChannelId: string | null;\n  onSelectChannel: (id: string) => void;\n}\n\nexport function ChannelList({ channels, activeChannelId, onSelectChannel }: ChannelListProps) {\n  // åˆ†é¡é »é“ - ä½¿ç”¨å¯¦éš›çš„ type å€¼\n  const publicChannels = channels.filter(c => c.type === 'public');\n  const privateChannels = channels.filter(c => c.type === 'private');\n  const directChannels = channels.filter(c => c.type === 'direct');\n\n  const renderChannel = (channel: Channel) => {\n    const is_active = channel.id === activeChannelId;\n    const isArchived = (channel as any).isArchived; // TODO: Add isArchived to Channel interface\n\n    return (\n      <button\n        onClick={() => onSelectChannel(channel.id)}\n        className={cn(\n          'w-full text-left px-3 py-2 text-sm transition-colors rounded-md flex items-center gap-2',\n          is_active\n            ? 'bg-morandi-gold/10 text-morandi-primary font-medium'\n            : 'text-morandi-secondary hover:bg-morandi-container/20 hover:text-morandi-primary',\n          isArchived && 'opacity-60'\n        )}\n      >\n        {channel.type === 'private' ? (\n          <Lock size={14} className=\"flex-shrink-0\" />\n        ) : (\n          <Hash size={14} className=\"flex-shrink-0\" />\n        )}\n        <span className=\"flex-1 truncate\">{channel.name}</span>\n        {isArchived && <Archive size={12} className=\"flex-shrink-0\" />}\n      </button>\n    );\n  };\n  \n  return (\n    <div className=\"py-2 space-y-4\">\n      {/* å…¬é–‹é »é“ */}\n      {publicChannels.length > 0 && (\n        <div className=\"px-3\">\n          <div className=\"text-xs font-semibold text-morandi-secondary mb-2\">å…¬é–‹é »é“</div>\n          <div className=\"space-y-0.5\">\n            {publicChannels.map(channel => (\n              <div key={channel.id}>{renderChannel(channel)}</div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* ç§äººé »é“ */}\n      {privateChannels.length > 0 && (\n        <div className=\"px-3\">\n          <div className=\"text-xs font-semibold text-morandi-secondary mb-2\">ç§äººé »é“</div>\n          <div className=\"space-y-0.5\">\n            {privateChannels.map(channel => (\n              <div key={channel.id}>{renderChannel(channel)}</div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* ç›´æ¥è¨Šæ¯ */}\n      {directChannels.length > 0 && (\n        <div className=\"px-3\">\n          <div className=\"text-xs font-semibold text-morandi-secondary mb-2\">ç›´æ¥è¨Šæ¯</div>\n          <div className=\"space-y-0.5\">\n            {directChannels.map(channel => (\n              <div key={channel.id}>{renderChannel(channel)}</div>\n            ))}\n          </div>\n        </div>\n      )}\n      \n      {/* ç©ºç‹€æ…‹ */}\n      {channels.length === 0 && (\n        <div className=\"px-3 py-8 text-center text-sm text-morandi-secondary\">\n          <p>å°šç„¡é »é“</p>\n          <p className=\"text-xs mt-1\">é»æ“Šä¸Šæ–¹ + å»ºç«‹é »é“</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/channel-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateMessage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":23,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'deleteMessage' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useRef, useEffect } from 'react';\n\nimport { Send, Paperclip, Smile, MoreVertical, Pin } from 'lucide-react';\n\nimport { CanvasView } from './canvas-view';\nimport { Button } from '@/components/ui/button';\nimport type { Channel } from '@/stores/workspace-store';\nimport { useWorkspaceStore } from '@/stores/workspace-store';\nimport { useAuthStore } from '@/stores/auth-store';\n\nimport { cn } from '@/lib/utils';\n\ninterface ChannelViewProps {\n  channel: Channel;\n}\n\nexport function ChannelView({ channel }: ChannelViewProps) {\n  const {\n    messages,\n    addMessage,\n    updateMessage,\n    deleteMessage,\n    togglePinMessage,\n    addReaction,\n    activeCanvasTab,\n    setActiveCanvasTab\n  } = useWorkspaceStore();\n\n  // âœ… å¾ auth-store è®€å–ç•¶å‰ç™»å…¥è€…è³‡è¨Š\n  const { user } = useAuthStore();\n  const currentUserId = user?.id || '';\n  const currentUserName = user?.display_name || 'æœªçŸ¥ä½¿ç”¨è€…';\n\n  const [messageInput, setMessageInput] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  \n  // ç²å–è©²é »é“çš„è¨Šæ¯\n  const channelMessages = messages\n    .filter(m => m.channel_id === channel.id)\n    .sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n  \n  // é‡˜é¸çš„è¨Šæ¯\n  const pinnedMessages = channelMessages.filter(m => m.is_pinned);\n  \n  // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [channelMessages.length]);\n  \n  const handleSendMessage = () => {\n    if (!messageInput.trim()) return;\n\n    // âœ… ä½¿ç”¨æ­£ç¢ºçš„ author è³‡æ–™çµæ§‹\n    addMessage({\n      channel_id: channel.id,\n      author_id: currentUserId,\n      content: messageInput.trim(),\n      author: {\n        id: currentUserId,\n        display_name: currentUserName,\n      },\n    });\n\n    setMessageInput('');\n  };\n  \n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n  \n  const formatTime = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    \n    if (diffInHours < 24) {\n      return date.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });\n    } else {\n      return date.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' });\n    }\n  };\n  \n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* é »é“æ¨™é¡Œ */}\n      <div className=\"px-4 h-[57px] flex items-center justify-between\">\n        <h2 className=\"text-sm font-semibold text-morandi-primary\">{channel.name}</h2>\n        <div className=\"flex items-center gap-2\">\n          {/* åˆ†é æŒ‰éˆ• */}\n          <div className=\"flex items-center gap-1\">\n            <button\n              onClick={() => setActiveCanvasTab('messages')}\n              className={cn(\n                'px-2.5 py-1 text-xs font-medium transition-colors rounded',\n                activeCanvasTab === 'messages'\n                  ? 'bg-morandi-gold/10 text-morandi-primary'\n                  : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/20'\n              )}\n            >\n              ğŸ’¬ è¨Šæ¯\n            </button>\n            <button\n              onClick={() => setActiveCanvasTab('canvas')}\n              className={cn(\n                'px-2.5 py-1 text-xs font-medium transition-colors rounded',\n                activeCanvasTab === 'canvas'\n                  ? 'bg-morandi-gold/10 text-morandi-primary'\n                  : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/20'\n              )}\n            >\n              ğŸ“‹ Canvas\n            </button>\n            <button\n              onClick={() => setActiveCanvasTab('settings')}\n              className={cn(\n                'px-2.5 py-1 text-xs font-medium transition-colors rounded',\n                activeCanvasTab === 'settings'\n                  ? 'bg-morandi-gold/10 text-morandi-primary'\n                  : 'text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/20'\n              )}\n            >\n              âš™ï¸ è¨­å®š\n            </button>\n          </div>\n\n          <Button variant=\"outline\" size=\"sm\" className=\"h-6 w-6 p-0\">\n            <MoreVertical size={14} />\n          </Button>\n        </div>\n      </div>\n      <div className=\"mx-4 border-b border-border\"></div>\n      \n      {/* å…§å®¹å€ */}\n      {activeCanvasTab === 'messages' ? (\n        <>\n          {/* é‡˜é¸è¨Šæ¯ */}\n          {pinnedMessages.length > 0 && (\n            <div className=\"bg-morandi-gold/5 px-6 py-2\">\n              <div className=\"flex items-center gap-2\">\n                <Pin size={14} className=\"text-morandi-gold\" />\n                <span className=\"text-sm text-morandi-secondary\">\n                  {pinnedMessages.length} å‰‡é‡˜é¸è¨Šæ¯\n                </span>\n              </div>\n            </div>\n          )}\n          \n          {/* è¨Šæ¯åˆ—è¡¨ */}\n          <div className=\"flex-1 overflow-y-auto px-6 py-4 space-y-4\">\n            {channelMessages.map((message) => (\n              <div \n                key={message.id}\n                className={cn(\n                  'group relative',\n                  message.is_pinned && 'bg-morandi-gold/5 -mx-2 px-2 py-1 rounded'\n                )}\n              >\n                {message.is_pinned && (\n                  <div className=\"absolute -left-6 top-2\">\n                    <Pin size={12} className=\"text-morandi-gold\" />\n                  </div>\n                )}\n                \n                <div className=\"flex items-start gap-3\">\n                  {/* é ­åƒ */}\n                  <div className=\"w-8 h-8 rounded-full bg-morandi-gold/20 flex items-center justify-center text-sm font-medium text-morandi-primary flex-shrink-0\">\n                    {message.author?.display_name?.[0] || '?'}\n                  </div>\n\n                  {/* è¨Šæ¯å…§å®¹ */}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-baseline gap-2 mb-1\">\n                      <span className=\"font-medium text-sm text-morandi-primary\">\n                        {message.author?.display_name || 'æœªçŸ¥ä½¿ç”¨è€…'}\n                      </span>\n                      <span className=\"text-xs text-morandi-secondary\">\n                        {formatTime(message.created_at)}\n                      </span>\n                    </div>\n                    <div className=\"text-sm text-morandi-primary whitespace-pre-wrap break-words\">\n                      {message.content}\n                    </div>\n                    \n                    {/* åæ‡‰ */}\n                    {Object.keys(message.reactions).length > 0 && (\n                      <div className=\"flex items-center gap-1 mt-2\">\n                        {Object.entries(message.reactions).map(([emoji, users], i) => (\n                          <button\n                            key={i}\n                            onClick={() => addReaction(message.id, emoji, currentUserId)}\n                            className={cn(\n                              'px-2 py-0.5 rounded-full text-xs flex items-center gap-1 transition-colors',\n                              users.includes(currentUserId)\n                                ? 'bg-morandi-gold/20 border border-morandi-gold/40'\n                                : 'bg-morandi-container/20 border border-border hover:border-morandi-gold/40'\n                            )}\n                          >\n                            <span>{emoji}</span>\n                            <span className=\"text-morandi-secondary\">{users.length}</span>\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                  \n                  {/* æ“ä½œæŒ‰éˆ•ï¼ˆæ‡¸åœé¡¯ç¤ºï¼‰ */}\n                  <div className=\"opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n                    <button\n                      onClick={() => addReaction(message.id, 'ğŸ‘', currentUserId)}\n                      className=\"p-1 text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/20 rounded\"\n                      title=\"æ–°å¢åæ‡‰\"\n                    >\n                      <Smile size={14} />\n                    </button>\n                    <button\n                      onClick={() => togglePinMessage(message.id)}\n                      className=\"p-1 text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/20 rounded\"\n                      title={message.is_pinned ? 'å–æ¶ˆé‡˜é¸' : 'é‡˜é¸'}\n                    >\n                      <Pin size={14} />\n                    </button>\n                  </div>\n                </div>\n              </div>\n            ))}\n            \n            {channelMessages.length === 0 && (\n              <div className=\"flex items-center justify-center h-full text-morandi-secondary\">\n                <div className=\"text-center\">\n                  <p className=\"text-sm\">é–‹å§‹å°è©±</p>\n                  <p className=\"text-xs mt-1\">åœ¨ä¸‹æ–¹è¼¸å…¥è¨Šæ¯</p>\n                </div>\n              </div>\n            )}\n            \n            <div ref={messagesEndRef} />\n          </div>\n          \n          {/* è¨Šæ¯è¼¸å…¥å€ */}\n          <div className=\"px-6 py-4\">\n            <div className=\"border-t border-border mb-4 -mx-2\"></div>\n            <div className=\"flex items-end gap-3\">\n              <button className=\"p-2 text-morandi-secondary hover:text-morandi-primary hover:bg-morandi-container/20 rounded transition-colors\">\n                <Paperclip size={20} />\n              </button>\n              \n              <div className=\"flex-1\">\n                <textarea\n                  value={messageInput}\n                  onChange={(e) => setMessageInput(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  placeholder={`åœ¨ ${channel.name} å‚³é€è¨Šæ¯...`}\n                  className=\"w-full px-4 py-2 border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-morandi-gold/50\"\n                  rows={1}\n                  style={{\n                    minHeight: '40px',\n                    maxHeight: '120px',\n                  }}\n                />\n                <div className=\"text-xs text-morandi-secondary mt-1\">\n                  Enter å‚³é€ï¼ŒShift + Enter æ›è¡Œ\n                </div>\n              </div>\n              \n              <Button\n                onClick={handleSendMessage}\n                disabled={!messageInput.trim()}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                <Send size={16} />\n              </Button>\n            </div>\n          </div>\n        </>\n      ) : activeCanvasTab === 'canvas' ? (\n        <CanvasView channel={channel} />\n      ) : (\n        <div className=\"flex-1 flex items-center justify-center text-morandi-secondary\">\n          <p>è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/create-channel-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/components/workspace/workspace-task-list.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'channelId' is defined but never used. Allowed unused args must match /^_/u.","line":26,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1027,1030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1027,1030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1501,1504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1501,1504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1570,1573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1570,1573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2762,2765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2762,2765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":131,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":131,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'hasNotes' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":135,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":135,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9413,9416],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9413,9416],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9820,9823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9820,9823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\n\nimport { Clock, User, Calendar, ChevronDown, ChevronUp } from 'lucide-react';\n\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { StarRating } from '@/components/ui/star-rating';\nimport { useTodoStore } from '@/stores';\n\nimport { cn } from '@/lib/utils';\n\ninterface WorkspaceTaskListProps {\n  channelId: string;\n  tour_id: string;\n}\n\nconst employees = [\n  { id: '1', name: 'å¨å»‰', role: 'ç®¡ç†è€…' },\n  { id: '2', name: 'æåŠ©ç†', role: 'OP' },\n  { id: '3', name: 'ç‹è²¡å‹™', role: 'è²¡å‹™' },\n  { id: '4', name: 'é™³æ¥­å‹™', role: 'æ¥­å‹™' },\n];\n\nexport function WorkspaceTaskList({ channelId, tour_id }: WorkspaceTaskListProps) {\n  const { items: todos, update: updateTodo } = useTodoStore();\n  const [expandedTaskId, setExpandedTaskId] = useState<string | null>(null);\n  const [replyInputs, setReplyInputs] = useState<Record<string, string>>({});\n  \n  // ç²å–è©²æ—…éŠåœ˜çš„ä»»å‹™\n  const tourTasks = (todos || []).filter(todo =>\n    todo.related_items?.some((item: any) => (item.type === 'quote' || item.type === 'order') && item.id === tour_id)\n  ).sort((a, b) => {\n    // æœªå®Œæˆçš„æ’åœ¨å‰é¢\n    if (a.completed !== b.completed) {\n      return a.completed ? 1 : -1;\n    }\n    // æŒ‰å„ªå…ˆç´šæ’åº\n    return (b.priority || 0) - (a.priority || 0);\n  });\n  \n  const getEmployeeName = (employee_id?: string) => {\n    if (!employee_id) return 'æœªæŒ‡æ´¾';\n    return employees.find(emp => emp.id === employee_id)?.name || 'æœªçŸ¥';\n  };\n  \n  const getProgressInfo = (todo: any) => {\n    const completed = (todo.sub_tasks || []).filter((task: any) => task.done).length;\n    const total = (todo.sub_tasks || []).length;\n    return { completed, total, percentage: total > 0 ? (completed / total) * 100 : 0 };\n  };\n  \n  const formatDate = (dateString?: string) => {\n    if (!dateString) return 'æœªè¨­å®š';\n    return new Date(dateString).toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' });\n  };\n  \n  const formatTimestamp = (timestamp: string) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);\n    \n    if (diffInHours < 1) {\n      const minutes = Math.floor(diffInHours * 60);\n      return `${minutes}åˆ†é˜å‰`;\n    } else if (diffInHours < 24) {\n      return `${Math.floor(diffInHours)}å°æ™‚å‰`;\n    } else {\n      return date.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' });\n    }\n  };\n  \n  const handleToggleComplete = (taskId: string) => {\n    const task = todos.find(t => t.id === taskId);\n    if (!task) return;\n    \n    updateTodo(taskId, {\n      completed: !task.completed,\n      status: !task.completed ? 'completed' : 'pending',\n      completed_at: !task.completed ? new Date().toISOString() : undefined,\n    } as any);\n  };\n  \n  const handleToggleSubTask = (taskId: string, subTaskId: string) => {\n    const task = todos.find(t => t.id === taskId);\n    if (!task) return;\n    \n    const updatedSubTasks = (task.sub_tasks || []).map(st =>\n      st.id === subTaskId\n        ? { ...st, done: !st.done, completed_at: !st.done ? new Date().toISOString() : undefined }\n        : st\n    );\n    \n    updateTodo(taskId, { sub_tasks: updatedSubTasks });\n  };\n  \n  const handleAddReply = (taskId: string) => {\n    const content = replyInputs[taskId];\n    if (!content?.trim()) return;\n    \n    const task = todos.find(t => t.id === taskId);\n    if (!task) return;\n    \n    const newNote = {\n      timestamp: new Date().toISOString(),\n      content: content.trim(),\n      user_id: '1', // TODO: å¾ auth store ç²å–\n    };\n    \n    updateTodo(taskId, {\n      notes: [...(task.notes || []), newNote],\n    });\n    \n    setReplyInputs(prev => ({ ...prev, [taskId]: '' }));\n  };\n  \n  const toggleExpand = (taskId: string) => {\n    setExpandedTaskId(expandedTaskId === taskId ? null : taskId);\n  };\n  \n  return (\n    <div className=\"space-y-0 border border-border rounded-lg overflow-hidden bg-white\">\n      {tourTasks.length === 0 ? (\n        <div className=\"text-center py-12 text-morandi-secondary\">\n          <Clock size={48} className=\"mx-auto mb-4 opacity-50\" />\n          <p className=\"text-sm\">æ­¤é »é“å°šç„¡ä»»å‹™</p>\n          <p className=\"text-xs mt-1\">å‰å¾€æ—…éŠåœ˜ç®¡ç† &gt; æŒ‡æ´¾ä»»å‹™å»ºç«‹ä»»å‹™</p>\n        </div>\n      ) : (\n        tourTasks.map((task, index) => {\n          const progress = getProgressInfo(task);\n          const isExpanded = expandedTaskId === task.id;\n          const hasSubTasks = (task.sub_tasks || []).length > 0;\n          const hasNotes = (task.notes || []).length > 0;\n          \n          return (\n            <div key={task.id}>\n              {/* ä»»å‹™åˆ—è¡¨é … */}\n              <div\n                className={cn(\n                  'flex items-center gap-3 p-3 hover:bg-morandi-container/10 transition-colors',\n                  'border-b border-border last:border-b-0',\n                  task.completed && 'opacity-60'\n                )}\n              >\n                {/* å‹¾é¸æ¡† */}\n                <input\n                  type=\"checkbox\"\n                  checked={task.completed || false}\n                  onChange={() => handleToggleComplete(task.id)}\n                  className=\"w-4 h-4 cursor-pointer\"\n                />\n                \n                {/* æ˜Ÿç´š */}\n                <div className=\"flex-shrink-0\">\n                  <StarRating value={task.priority || 3} readonly size=\"sm\" />\n                </div>\n                \n                {/* æ¨™é¡Œ */}\n                <div className=\"flex-1 min-w-0\">\n                  <span\n                    className={cn(\n                      'font-medium text-sm',\n                      task.completed && 'line-through text-morandi-secondary'\n                    )}\n                  >\n                    {task.title}\n                  </span>\n                </div>\n                \n                {/* è² è²¬äºº */}\n                <div className=\"flex items-center gap-1 text-sm text-morandi-secondary flex-shrink-0\">\n                  <User size={14} />\n                  <span>@{getEmployeeName(task.assignee)}</span>\n                </div>\n                \n                {/* æœŸé™ */}\n                <div className=\"flex items-center gap-1 text-sm text-morandi-secondary flex-shrink-0\">\n                  <Calendar size={14} />\n                  <span>{formatDate(task.deadline)}</span>\n                </div>\n                \n                {/* é€²åº¦ */}\n                {hasSubTasks && (\n                  <div className=\"flex items-center gap-2 flex-shrink-0\">\n                    <div className=\"w-16 bg-morandi-container/30 rounded-full h-2\">\n                      <div\n                        className=\"bg-morandi-gold h-2 rounded-full transition-all duration-300\"\n                        style={{ width: `${progress.percentage}%` }}\n                      />\n                    </div>\n                    <span className=\"text-sm text-morandi-secondary\">\n                      {progress.completed}/{progress.total}\n                    </span>\n                  </div>\n                )}\n                \n                {/* å±•é–‹æŒ‰éˆ• */}\n                <button\n                  onClick={() => toggleExpand(task.id)}\n                  className=\"text-morandi-secondary hover:text-morandi-primary transition-colors flex-shrink-0\"\n                >\n                  {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n                </button>\n              </div>\n              \n              {/* å±•é–‹å…§å®¹ï¼ˆå­ä»»å‹™ + è¨è«–ï¼‰ */}\n              {isExpanded && (\n                <div className=\"bg-morandi-container/5 p-4 border-b border-border\">\n                  {/* å­ä»»å‹™ */}\n                  {hasSubTasks && (\n                    <div className=\"mb-4\">\n                      <div className=\"text-sm font-medium text-morandi-primary mb-2\">å­ä»»å‹™ï¼š</div>\n                      <div className=\"space-y-1\">\n                        {(task.sub_tasks || []).map(subTask => (\n                          <div key={subTask.id} className=\"flex items-center gap-2 py-1\">\n                            <input\n                              type=\"checkbox\"\n                              checked={subTask.done}\n                              onChange={() => handleToggleSubTask(task.id, subTask.id)}\n                              className=\"w-3 h-3 cursor-pointer\"\n                            />\n                            <span\n                              className={cn(\n                                'text-sm',\n                                subTask.done && 'line-through opacity-60'\n                              )}\n                            >\n                              {subTask.title}\n                            </span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  \n                  {/* è¨è«–å€ */}\n                  <div>\n                    <div className=\"text-sm font-medium text-morandi-primary mb-2\">\n                      è¨è«– ({(task.notes || []).length})ï¼š\n                    </div>\n                    <div className=\"space-y-3\">\n                      {(task.notes || []).map((note, i) => (\n                        <div key={i} className=\"flex gap-2\">\n                          {/* é ­åƒ */}\n                          <div className=\"w-6 h-6 rounded-full bg-morandi-gold/20 flex items-center justify-center text-xs font-medium text-morandi-primary flex-shrink-0\">\n                            {getEmployeeName((note as any).user_id)[0]}\n                          </div>\n\n                          {/* è¨Šæ¯å…§å®¹ */}\n                          <div className=\"flex-1 bg-white rounded p-2 text-sm border border-border\">\n                            <div className=\"flex items-center gap-2 mb-1\">\n                              <span className=\"font-medium text-morandi-primary\">\n                                {getEmployeeName((note as any).user_id)}\n                              </span>\n                              <span className=\"text-xs text-morandi-secondary\">\n                                {formatTimestamp(note.timestamp)}\n                              </span>\n                            </div>\n                            <div className=\"text-morandi-primary whitespace-pre-wrap\">\n                              {note.content}\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                      \n                      {/* å›è¦†è¼¸å…¥æ¡† */}\n                      <div className=\"flex gap-2\">\n                        <Input\n                          value={replyInputs[task.id] || ''}\n                          onChange={(e) =>\n                            setReplyInputs(prev => ({ ...prev, [task.id]: e.target.value }))\n                          }\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter' && !e.shiftKey) {\n                              e.preventDefault();\n                              handleAddReply(task.id);\n                            }\n                          }}\n                          placeholder=\"ğŸ’¬ å›è¦†... (Enter é€å‡º)\"\n                          className=\"text-sm\"\n                        />\n                        <Button\n                          onClick={() => handleAddReply(task.id)}\n                          disabled={!replyInputs[task.id]?.trim()}\n                          size=\"sm\"\n                          className=\"bg-morandi-gold hover:bg-morandi-gold-hover\"\n                        >\n                          é€å‡º\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          );\n        })\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/destinations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/locations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/order-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/payment-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/quote-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/status-maps.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/constants/tour-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/core/errors/app-errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/core/services/base.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ValidationError' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is defined but never used. Allowed unused args must match /^_/u.","line":36,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1276,1279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1276,1279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":74,"column":55,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":74,"endColumn":69,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[2158,2159],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2297,2300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2297,2300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":81,"column":35,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":81,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2348,2351],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2348,2351],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":82,"column":35,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":82,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2416,2419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2416,2419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2498,2501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2498,2501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-catch","severity":1,"message":"Unnecessary try/catch wrapper.","line":109,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":120,"endColumn":6}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseEntity, PageRequest, PageResponse } from '@/core/types/common';\nimport { NotFoundError, ValidationError } from '@/core/errors/app-errors';\n\n/**\n * Store æ“ä½œä»‹é¢ï¼ˆFastIn æ¶æ§‹ - éåŒæ­¥ç‰ˆæœ¬ï¼‰\n * æ‰€æœ‰ CRUD æ“ä½œéƒ½å›å‚³ Promiseï¼Œé…åˆ createStore çš„éåŒæ­¥å¯¦ä½œ\n */\nexport interface StoreOperations<T> {\n  getAll: () => T[];\n  getById: (id: string) => T | undefined;\n  add: (entity: T) => Promise<T | undefined>;\n  update: (id: string, data: Partial<T>) => Promise<void>;\n  delete: (id: string) => Promise<void>;\n}\n\nexport abstract class BaseService<T extends BaseEntity> {\n  protected abstract resourceName: string;\n  protected abstract getStore: () => StoreOperations<T>;\n\n  // çµ±ä¸€çš„ ID ç”Ÿæˆ\n  protected generateId(): string {\n    // é–‹ç™¼éšæ®µä½¿ç”¨ crypto.randomUUIDï¼Œç”Ÿç”¢ç’°å¢ƒç”±å¾Œç«¯ç”Ÿæˆ\n    if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n      return crypto.randomUUID();\n    }\n    // Fallback for environments without crypto.randomUUID\n    return 'id_' + Date.now().toString(36) + Math.random().toString(36).substr(2);\n  }\n\n  // çµ±ä¸€çš„æ™‚é–“æˆ³\n  protected now(): string {\n    return new Date().toISOString();\n  }\n\n  // é©—è­‰è³‡æ–™ï¼ˆå­é¡å¯ä»¥è¦†å¯«ï¼‰\n  protected validate(data: Partial<T>): void {\n    // åŸºæœ¬é©—è­‰é‚è¼¯ï¼Œå­é¡å¯ä»¥æ“´å±•\n  }\n\n  // CREATE\n  async create(data: Omit<T, keyof BaseEntity>): Promise<T> {\n    try {\n      this.validate(data as any);\n\n      const entity: T = {\n        ...data,\n        id: this.generateId(),\n        created_at: this.now(),\n        updated_at: this.now(),\n      } as T;\n\n      // FastIn æ¶æ§‹ï¼šawait store æ“ä½œç¢ºä¿å¯«å…¥å®Œæˆ\n      const store = this.getStore();\n      const result = await store.add(entity);\n\n      // æœªä¾†ï¼šèª¿ç”¨ API\n      // const response = await api.post(`/${this.resourceName}`, data);\n\n      return result || entity;\n    } catch (error) {\n      throw error instanceof Error ? error : new Error(`Failed to create ${this.resourceName}`);\n    }\n  }\n\n  // READ (List with pagination and filtering)\n  async list(params?: PageRequest): Promise<PageResponse<T>> {\n    try {\n      const store = this.getStore();\n      let allData = store.getAll();\n\n      // æœå°‹éæ¿¾\n      if (params?.search) {\n        allData = allData.filter(item =>\n          JSON.stringify(item).toLowerCase().includes(params.search!.toLowerCase())\n        );\n      }\n\n      // æ’åº\n      if (params?.sortBy) {\n        allData.sort((a, b) => {\n          const aVal = (a as any)[params.sortBy!];\n          const bVal = (b as any)[params.sortBy!];\n\n          if (aVal < bVal) return (params as any).sort_order === 'desc' ? 1 : -1;\n          if (aVal > bVal) return (params as any).sort_order === 'desc' ? -1 : 1;\n          return 0;\n        });\n      }\n\n      // åˆ†é \n      const page = params?.page || 1;\n      const pageSize = params?.pageSize || 10;\n      const start = (page - 1) * pageSize;\n      const end = start + pageSize;\n\n      return {\n        data: allData.slice(start, end),\n        total: allData.length,\n        page,\n        pageSize,\n      };\n    } catch (error) {\n      throw error instanceof Error ? error : new Error(`Failed to list ${this.resourceName}`);\n    }\n  }\n\n  // READ (Single)\n  async getById(id: string): Promise<T | null> {\n    try {\n      const store = this.getStore();\n      const entity = store.getById(id);\n\n      if (!entity) {\n        throw new NotFoundError(this.resourceName, id);\n      }\n\n      return entity;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // UPDATE\n  async update(id: string, data: Partial<T>): Promise<T> {\n    try {\n      this.validate(data);\n\n      const store = this.getStore();\n      const existing = store.getById(id);\n\n      if (!existing) {\n        throw new NotFoundError(this.resourceName, id);\n      }\n\n      const updated = {\n        ...existing,\n        ...data,\n        id, // ç¢ºä¿ ID ä¸æœƒè¢«è¦†è“‹\n        updated_at: this.now(),\n      } as T;\n\n      // FastIn æ¶æ§‹ï¼šawait store æ“ä½œç¢ºä¿å¯«å…¥å®Œæˆ\n      await store.update(id, updated);\n      return updated;\n    } catch (error) {\n      throw error instanceof Error ? error : new Error(`Failed to update ${this.resourceName}`);\n    }\n  }\n\n  // DELETE\n  async delete(id: string): Promise<boolean> {\n    try {\n      const store = this.getStore();\n      const existing = store.getById(id);\n\n      if (!existing) {\n        throw new NotFoundError(this.resourceName, id);\n      }\n\n      // FastIn æ¶æ§‹ï¼šawait store æ“ä½œç¢ºä¿å¯«å…¥å®Œæˆ\n      await store.delete(id);\n      return true;\n    } catch (error) {\n      throw error instanceof Error ? error : new Error(`Failed to delete ${this.resourceName}`);\n    }\n  }\n\n  // Batch operations\n  async batchCreate(items: Omit<T, keyof BaseEntity>[]): Promise<T[]> {\n    const results: T[] = [];\n\n    for (const item of items) {\n      try {\n        const created = await this.create(item);\n        results.push(created);\n      } catch (error) {\n        // ç¹¼çºŒè™•ç†å…¶ä»–é …ç›®ï¼Œä½†è¨˜éŒ„éŒ¯èª¤\n        console.error(`Failed to create item:`, error);\n      }\n    }\n\n    return results;\n  }\n\n  async batchUpdate(updates: { id: string; data: Partial<T> }[]): Promise<T[]> {\n    const results: T[] = [];\n\n    for (const { id, data } of updates) {\n      try {\n        const updated = await this.update(id, data);\n        results.push(updated);\n      } catch (error) {\n        console.error(`Failed to update item ${id}:`, error);\n      }\n    }\n\n    return results;\n  }\n\n  async batchDelete(ids: string[]): Promise<{ success: string[]; failed: string[] }> {\n    const success: string[] = [];\n    const failed: string[] = [];\n\n    for (const id of ids) {\n      try {\n        await this.delete(id);\n        success.push(id);\n      } catch (error) {\n        console.error(`Failed to delete item ${id}:`, error);\n        failed.push(id);\n      }\n    }\n\n    return { success, failed };\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/core/types/common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/data/region-options.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/accounting/hooks/useAccounting.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/accounting/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/accounting/services/accounting.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[573,576],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[573,576],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[650,653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[650,653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[738,741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[738,741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3846,3849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3846,3849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Account, Transaction } from '@/types/accounting.types';\nimport { Category } from '@/stores/accounting-types';\nimport { useAccountingStore } from '@/stores/accounting-store';\nimport { ValidationError } from '@/core/errors/app-errors';\n\nclass AccountingService extends BaseService<Account> {\n  protected resourceName = 'accounts';\n\n  protected getStore = (): StoreOperations<Account> => {\n    const store = useAccountingStore.getState();\n    return {\n      getAll: () => store.accounts as any,\n      getById: (id: string) => store.accounts.find(a => a.id === id) as any,\n      add: async (account: Account) => {\n        await store.addAccount(account as any);\n        return account;\n      },\n      update: async (id: string, data: Partial<Account>) => {\n        await store.updateAccount(id, data);\n      },\n      delete: async (id: string) => {\n        await store.deleteAccount(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Account>): void {\n    if (data.name && data.name.trim().length === 0) {\n      throw new ValidationError('name', 'å¸³æˆ¶åç¨±ä¸èƒ½ç‚ºç©º');\n    }\n\n    if (data.balance !== undefined && isNaN(data.balance)) {\n      throw new ValidationError('balance', 'é¤˜é¡æ ¼å¼éŒ¯èª¤');\n    }\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  getAccountBalance(account_id: string): number {\n    const store = useAccountingStore.getState();\n    return store.getAccountBalance(account_id);\n  }\n\n  getCategoryTotal(category_id: string, start_date?: string, end_date?: string): number {\n    const store = useAccountingStore.getState();\n    return store.getCategoryTotal(category_id, start_date, end_date);\n  }\n\n  calculateStats(): void {\n    const store = useAccountingStore.getState();\n    store.calculateStats();\n  }\n\n  getAccountsByType(type: Account['type']): Account[] {\n    const store = useAccountingStore.getState();\n    return store.accounts.filter(a => a.type === type);\n  }\n\n  getTotalAssets(): number {\n    const store = useAccountingStore.getState();\n    return store.stats.total_assets;\n  }\n\n  getMonthlyIncome(): number {\n    const store = useAccountingStore.getState();\n    return store.stats.monthly_income;\n  }\n\n  getMonthlyExpense(): number {\n    const store = useAccountingStore.getState();\n    return store.stats.monthly_expense;\n  }\n\n  getNetWorth(): number {\n    const store = useAccountingStore.getState();\n    return store.stats.net_worth;\n  }\n\n  // Transaction ç›¸é—œ\n  addTransaction(transaction: Omit<Transaction, 'id' | 'created_at' | 'updated_at'>): string {\n    const store = useAccountingStore.getState();\n    return store.addTransaction(transaction);\n  }\n\n  updateTransaction(id: string, transaction: Partial<Transaction>): void {\n    const store = useAccountingStore.getState();\n    store.updateTransaction(id, transaction);\n  }\n\n  deleteTransaction(id: string): void {\n    const store = useAccountingStore.getState();\n    store.deleteTransaction(id);\n  }\n\n  getTransactionsByAccount(account_id: string): Transaction[] {\n    const store = useAccountingStore.getState();\n    return store.transactions.filter(t =>\n      t.account_id === account_id || t.to_account_id === account_id\n    );\n  }\n\n  getTransactionsByDateRange(start_date: string, end_date: string): Transaction[] {\n    const store = useAccountingStore.getState();\n    return store.transactions.filter(t =>\n      t.date >= start_date && t.date <= end_date\n    );\n  }\n}\n\nclass CategoryService extends BaseService<Category> {\n  protected resourceName = 'categories';\n\n  protected getStore = (): StoreOperations<Category> => {\n    const store = useAccountingStore.getState();\n    return {\n      getAll: () => store.categories,\n      getById: (id: string) => store.categories.find(c => c.id === id),\n      add: async (category: Category) => {\n        await store.addCategory(category as any);\n        return category;\n      },\n      update: async (id: string, data: Partial<Category>) => {\n        await store.updateCategory(id, data);\n      },\n      delete: async (id: string) => {\n        await store.deleteCategory(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Category>): void {\n    if (data.name && data.name.trim().length === 0) {\n      throw new ValidationError('name', 'åˆ†é¡åç¨±ä¸èƒ½ç‚ºç©º');\n    }\n  }\n\n  getCategoriesByType(type: Category['type']): Category[] {\n    const store = useAccountingStore.getState();\n    return store.categories.filter(c => c.type === type);\n  }\n}\n\nexport const accountingService = new AccountingService();\nexport const categoryService = new CategoryService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/customers/hooks/useCustomers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[530,533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[530,533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCustomerStore } from '@/stores';\nimport { customerService } from '../services/customer.service';\nimport { Customer } from '@/stores/types';\n\n/**\n * å®¢æˆ¶ç®¡ç† Hook\n * æä¾›å®¢æˆ¶ç›¸é—œçš„æ‰€æœ‰æ“ä½œ\n */\nexport const useCustomers = () => {\n  const store = useCustomerStore();\n\n  return {\n    // ========== è³‡æ–™ ==========\n    customers: store.items,\n\n    // ========== CRUD æ“ä½œ ==========\n    /**\n     * å‰µå»ºæ–°å®¢æˆ¶\n     */\n    createCustomer: async (data: Omit<Customer, 'id' | 'created_at' | 'updated_at'>) => {\n      return await store.create(data as any);\n    },\n\n    /**\n     * æ›´æ–°å®¢æˆ¶è³‡è¨Š\n     */\n    updateCustomer: async (id: string, data: Partial<Customer>) => {\n      return await store.update(id, data);\n    },\n\n    /**\n     * åˆªé™¤å®¢æˆ¶\n     */\n    deleteCustomer: async (id: string) => {\n      return await store.delete(id);\n    },\n\n    /**\n     * è¼‰å…¥å®¢æˆ¶åˆ—è¡¨\n     */\n    loadCustomers: async () => {\n      return await store.fetchAll();\n    },\n\n    // ========== æ¥­å‹™æ–¹æ³• ==========\n    /**\n     * æœå°‹å®¢æˆ¶\n     */\n    searchCustomers: (searchTerm: string) => {\n      return customerService.searchCustomers(searchTerm);\n    },\n\n    /**\n     * ç²å–ç‰¹å®šæ—…éŠåœ˜çš„å®¢æˆ¶\n     */\n    getCustomersByTour: (tour_id: string) => {\n      return customerService.getCustomersByTour(tour_id);\n    },\n\n    /**\n     * ç²å– VIP å®¢æˆ¶\n     */\n    getVIPCustomers: () => {\n      return customerService.getVIPCustomers();\n    },\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/customers/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/customers/services/customer.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[629,632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[629,632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tour_id' is defined but never used. Allowed unused args must match /^_/u.","line":71,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'store' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":72,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Customer } from '@/types/customer.types';\nimport { useCustomerStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\n\nclass CustomerService extends BaseService<Customer> {\n  protected resourceName = 'customers';\n\n  protected getStore = (): StoreOperations<Customer> => {\n    const store = useCustomerStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(c => c.id === id),\n      add: async (customer: Customer) => {\n        await store.create(customer as any);\n        return customer;\n      },\n      update: async (id: string, data: Partial<Customer>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Customer>): void {\n    if (data.name && data.name.trim().length < 2) {\n      throw new ValidationError('name', 'å®¢æˆ¶å§“åè‡³å°‘éœ€è¦ 2 å€‹å­—ç¬¦');\n    }\n\n    if (data.email && !this.isValidEmail(data.email)) {\n      throw new ValidationError('email', 'éƒµä»¶æ ¼å¼éŒ¯èª¤');\n    }\n\n    if (data.phone && !this.isValidPhone(data.phone)) {\n      throw new ValidationError('phone', 'é›»è©±æ ¼å¼éŒ¯èª¤');\n    }\n\n    if (data.id_number && !this.isValidIdNumber(data.id_number)) {\n      throw new ValidationError('id_number', 'èº«ä»½è­‰å­—è™Ÿæ ¼å¼éŒ¯èª¤');\n    }\n  }\n\n  private isValidEmail(email: string): boolean {\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n  }\n\n  private isValidPhone(phone: string): boolean {\n    return /^[\\d\\s\\-+()]{8,}$/.test(phone);\n  }\n\n  private isValidIdNumber(id_number: string): boolean {\n    // å°ç£èº«ä»½è­‰æˆ–è­·ç…§åŸºæœ¬é©—è­‰\n    return /^[A-Z][12]\\d{8}$/.test(id_number) || /^[A-Z]{1,2}\\d{6,9}$/.test(id_number);\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  searchCustomers(searchTerm: string): Customer[] {\n    const store = useCustomerStore.getState();\n    const term = searchTerm.toLowerCase();\n    return store.items.filter(c =>\n      c.name.toLowerCase().includes(term) ||\n      c.email?.toLowerCase().includes(term) ||\n      c.phone?.includes(term) ||\n      c.id_number?.toLowerCase().includes(term)\n    );\n  }\n\n  getCustomersByTour(tour_id: string): Customer[] {\n    const store = useCustomerStore.getState();\n    // TODO: Order é¡å‹éœ€è¦åŠ å…¥ customer_id æ¬„ä½\n    // const tourOrders = useOrderStore.getState().items.filter(o => o.tour_id === tour_id);\n    // const customerIds = tourOrders.map(o => o.customer_id);\n    // return store.items.filter(c => customerIds.includes(c.id));\n    return []; // æš«æ™‚è¿”å›ç©ºé™£åˆ—ï¼Œç­‰ Order é¡å‹æ›´æ–°\n  }\n\n  getVIPCustomers(): Customer[] {\n    const store = useCustomerStore.getState();\n    return store.items.filter(c => c.is_vip);\n  }\n}\n\nexport const customerService = new CustomerService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/orders/hooks/useOrders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[994,997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[994,997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useOrderStore } from '@/stores';\nimport { orderService } from '../services/order.service';\nimport { Order } from '@/stores/types';\n\nexport const useOrders = () => {\n  const store = useOrderStore();\n\n  return {\n    // ========== è³‡æ–™ ==========\n    orders: store.items,\n\n    // ========== CRUD æ“ä½œ ==========\n    createOrder: async (data: Omit<Order, 'id' | 'created_at' | 'updated_at'>) => {\n      return await store.create(data as any);\n    },\n\n    updateOrder: async (id: string, data: Partial<Order>) => {\n      return await store.update(id, data);\n    },\n\n    deleteOrder: async (id: string) => {\n      return await store.delete(id);\n    },\n\n    loadOrders: async () => {\n      return await store.fetchAll();\n    },\n\n    // ========== æ¥­å‹™æ–¹æ³• ==========\n    getOrdersByTour: (tour_id: string) => {\n      return orderService.getOrdersByTour(tour_id);\n    },\n\n    getOrdersByStatus: (status: string) => {\n      // Order ä»‹é¢æ²’æœ‰ status æ¬„ä½\n      return orderService.getOrdersByStatus(status as any);\n    },\n\n    getOrdersByCustomer: (customer_id: string) => {\n      return orderService.getOrdersByCustomer(customer_id);\n    },\n\n    calculateTotalRevenue: () => {\n      return orderService.calculateTotalRevenue();\n    },\n\n    getPendingOrders: () => {\n      return orderService.getPendingOrders();\n    },\n\n    getConfirmedOrders: () => {\n      return orderService.getConfirmedOrders();\n    },\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/orders/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/orders/services/order.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[606,609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[606,609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1657,1660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1657,1660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Order } from '@/stores/types';\nimport { useOrderStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\n\nclass OrderService extends BaseService<Order> {\n  protected resourceName = 'orders';\n\n  protected getStore = (): StoreOperations<Order> => {\n    const store = useOrderStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(o => o.id === id),\n      add: async (order: Order) => {\n        const result = await store.create(order as any);\n        return result || order;\n      },\n      update: async (id: string, data: Partial<Order>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Order>): void {\n    if (data.tour_id && !data.tour_id.trim()) {\n      throw new ValidationError('tour_id', 'å¿…é ˆé—œè¯æ—…éŠåœ˜');\n    }\n\n    if (data.total_amount !== undefined && data.total_amount < 0) {\n      throw new ValidationError('total_amount', 'è¨‚å–®é‡‘é¡ä¸èƒ½ç‚ºè² æ•¸');\n    }\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  getOrdersByTour(tour_id: string): Order[] {\n    const store = useOrderStore.getState();\n    return store.items.filter(o => o.tour_id === tour_id);\n  }\n\n  getOrdersByStatus(status: 'unpaid' | 'partial' | 'paid'): Order[] {\n    const store = useOrderStore.getState();\n    return store.items.filter(o => o.payment_status === status);\n  }\n\n  getOrdersByCustomer(customer_id: string): Order[] {\n    const store = useOrderStore.getState();\n    return store.items.filter((o: any) => o.customer_id === customer_id);\n  }\n\n  calculateTotalRevenue(): number {\n    const store = useOrderStore.getState();\n    return store.items\n      .filter(o => o.payment_status === 'paid')\n      .reduce((sum, o) => sum + (o.total_amount || 0), 0);\n  }\n\n  getPendingOrders(): Order[] {\n    return this.getOrdersByStatus('unpaid');\n  }\n\n  getConfirmedOrders(): Order[] {\n    return this.getOrdersByStatus('paid');\n  }\n}\n\nexport const orderService = new OrderService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/payments/hooks/usePayments.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[949,952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[949,952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { usePaymentRequestStore, useDisbursementOrderStore } from '@/stores';\nimport { paymentRequestService } from '../services/payment-request.service';\nimport { disbursementOrderService } from '../services/disbursement-order.service';\nimport { PaymentRequest, PaymentRequestItem, DisbursementOrder } from '@/stores/types';\nimport { BaseEntity } from '@/types';\n\n/**\n * Payments Hook - çµ±ä¸€è²¡å‹™æ“ä½œæ¥å£\n *\n * ä½¿ç”¨æ–°çš„ Service å±¤æ¶æ§‹\n */\nexport const usePayments = () => {\n  const paymentRequestStore = usePaymentRequestStore();\n  const disbursementOrderStore = useDisbursementOrderStore();\n\n  return {\n    // ========== è³‡æ–™ ==========\n    payment_requests: paymentRequestStore.items,\n    disbursement_orders: disbursementOrderStore.items,\n\n    // ========== PaymentRequest CRUD æ“ä½œ ==========\n    createPaymentRequest: async (\n      data: Omit<PaymentRequest, keyof BaseEntity | 'request_number'>\n    ) => {\n      return await paymentRequestService.create(data as any);\n    },\n\n    updatePaymentRequest: async (id: string, data: Partial<PaymentRequest>) => {\n      return await paymentRequestService.update(id, data);\n    },\n\n    deletePaymentRequest: async (id: string) => {\n      return await paymentRequestService.delete(id);\n    },\n\n    loadPaymentRequests: async () => {\n      return await paymentRequestStore.fetchAll();\n    },\n\n    // ========== PaymentRequestItem æ“ä½œ ==========\n    addPaymentItem: async (\n      requestId: string,\n      item: Omit<PaymentRequestItem, 'id' | 'request_id' | 'item_number' | 'subtotal' | 'created_at' | 'updated_at'>\n    ) => {\n      return await paymentRequestService.addItem(requestId, item);\n    },\n\n    updatePaymentItem: async (\n      requestId: string,\n      itemId: string,\n      data: Partial<PaymentRequestItem>\n    ) => {\n      return await paymentRequestService.updateItem(requestId, itemId, data);\n    },\n\n    deletePaymentItem: async (requestId: string, itemId: string) => {\n      return await paymentRequestService.deleteItem(requestId, itemId);\n    },\n\n    // ========== PaymentRequest æ¥­å‹™é‚è¼¯ ==========\n    createFromQuote: async (\n      tourId: string,\n      quoteId: string,\n      requestDate: string,\n      tourName: string,\n      code: string\n    ) => {\n      return await paymentRequestService.createFromQuote(\n        tourId,\n        quoteId,\n        requestDate,\n        tourName,\n        code\n      );\n    },\n\n    calculateTotalAmount: async (requestId: string) => {\n      return await paymentRequestService.calculateTotalAmount(requestId);\n    },\n\n    getItemsByCategory: (requestId: string, category: PaymentRequestItem['category']) => {\n      return paymentRequestService.getItemsByCategory(requestId, category);\n    },\n\n    getPendingRequests: () => {\n      return paymentRequestService.getPendingRequests();\n    },\n\n    getProcessingRequests: () => {\n      return paymentRequestService.getProcessingRequests();\n    },\n\n    // ========== DisbursementOrder CRUD æ“ä½œ ==========\n    createDisbursementOrder: async (paymentRequestIds: string[], note?: string) => {\n      return await disbursementOrderService.createWithRequests(paymentRequestIds, note);\n    },\n\n    updateDisbursementOrder: async (id: string, data: Partial<DisbursementOrder>) => {\n      return await disbursementOrderService.update(id, data);\n    },\n\n    deleteDisbursementOrder: async (id: string) => {\n      return await disbursementOrderService.delete(id);\n    },\n\n    loadDisbursementOrders: async () => {\n      return await disbursementOrderStore.fetchAll();\n    },\n\n    // ========== DisbursementOrder æ¥­å‹™é‚è¼¯ ==========\n    confirmDisbursementOrder: async (id: string, confirmedBy: string) => {\n      return await disbursementOrderService.confirmOrder(id, confirmedBy);\n    },\n\n    addToCurrentDisbursementOrder: async (paymentRequestIds: string[]) => {\n      return await disbursementOrderService.addToCurrentWeekOrder(paymentRequestIds);\n    },\n\n    removeFromDisbursementOrder: async (orderId: string, requestId: string) => {\n      return await disbursementOrderService.removePaymentRequest(orderId, requestId);\n    },\n\n    addPaymentRequestsToOrder: async (orderId: string, requestIds: string[]) => {\n      return await disbursementOrderService.addPaymentRequests(orderId, requestIds);\n    },\n\n    getCurrentWeekDisbursementOrder: () => {\n      return disbursementOrderService.getCurrentWeekOrder();\n    },\n\n    getNextThursday: () => {\n      return disbursementOrderService.getNextThursday();\n    },\n\n    getPendingOrders: () => {\n      return disbursementOrderService.getPendingOrders();\n    },\n\n    getConfirmedOrders: () => {\n      return disbursementOrderService.getConfirmedOrders();\n    },\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/payments/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/payments/services/disbursement-order.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[743,746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[743,746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2896,2899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2896,2899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3287,3290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3287,3290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { DisbursementOrder, PaymentRequest } from '@/stores/types';\nimport { useDisbursementOrderStore, usePaymentRequestStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\n\nclass DisbursementOrderService extends BaseService<DisbursementOrder> {\n  protected resourceName = 'disbursement_orders';\n\n  protected getStore = (): StoreOperations<DisbursementOrder> => {\n    const store = useDisbursementOrderStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(o => o.id === id),\n      add: async (order: DisbursementOrder) => {\n        const result = await store.create(order as any);\n        return result || order;\n      },\n      update: async (id: string, data: Partial<DisbursementOrder>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<DisbursementOrder>): void {\n    if (data.payment_request_ids && data.payment_request_ids.length === 0) {\n      throw new ValidationError('payment_request_ids', 'å‡ºç´å–®å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹è«‹æ¬¾å–®');\n    }\n\n    if (data.total_amount !== undefined && data.total_amount < 0) {\n      throw new ValidationError('total_amount', 'ç¸½é‡‘é¡ä¸èƒ½ç‚ºè² æ•¸');\n    }\n\n    if (data.disbursement_date) {\n      const date = new Date(data.disbursement_date);\n      const dayOfWeek = date.getDay();\n      if (dayOfWeek !== 4) {\n        throw new ValidationError('disbursement_date', 'å‡ºç´æ—¥æœŸå¿…é ˆç‚ºé€±å››');\n      }\n    }\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  /**\n   * å–å¾—ä¸‹é€±å››æ—¥æœŸ\n   */\n  getNextThursday(): string {\n    const today = new Date();\n    const dayOfWeek = today.getDay();\n    const daysUntilThursday = (4 - dayOfWeek + 7) % 7;\n    const nextThursday = new Date(today);\n\n    // å¦‚æœä»Šå¤©æ˜¯é€±å››ä¸”è¶…é 17:00ï¼Œå‰‡ç‚ºä¸‹é€±å››\n    if (daysUntilThursday === 0 && today.getHours() >= 17) {\n      nextThursday.setDate(today.getDate() + 7);\n    } else if (daysUntilThursday === 0) {\n      nextThursday.setDate(today.getDate());\n    } else {\n      nextThursday.setDate(today.getDate() + daysUntilThursday);\n    }\n\n    return nextThursday.toISOString().split('T')[0];\n  }\n\n  /**\n   * å–å¾—ç•¶é€±å‡ºç´å–®ï¼ˆå¾…è™•ç†ï¼‰\n   */\n  getCurrentWeekOrder(): DisbursementOrder | null {\n    const nextThursday = this.getNextThursday();\n    const store = useDisbursementOrderStore.getState();\n\n    return store.items.find(order =>\n      order.disbursement_date === nextThursday && order.status === 'pending'\n    ) || null;\n  }\n\n  /**\n   * ä½¿ç”¨è«‹æ¬¾å–®å‰µå»ºå‡ºç´å–®\n   */\n  async createWithRequests(\n    paymentRequestIds: string[],\n    note?: string\n  ): Promise<DisbursementOrder> {\n    // è¨ˆç®—ç¸½é‡‘é¡\n    const paymentRequestStore = usePaymentRequestStore.getState();\n    const totalAmount = paymentRequestIds.reduce((sum, requestId) => {\n      const request = paymentRequestStore.items.find((r: any) => r.id === requestId);\n      return sum + (request?.total_amount || 0);\n    }, 0);\n\n    const orderData = {\n      disbursement_date: this.getNextThursday(),\n      payment_request_ids: [...paymentRequestIds],\n      total_amount: totalAmount,\n      status: 'pending' as const,\n      note,\n      created_by: '1', // TODO: ä½¿ç”¨å¯¦éš›ç”¨æˆ¶ID\n    };\n\n    const order = await this.create(orderData as any);\n\n    // æ›´æ–°è«‹æ¬¾å–®ç‹€æ…‹ç‚º processing\n    for (const requestId of paymentRequestIds) {\n      await this.updatePaymentRequestStatus(requestId, 'processing');\n    }\n\n    return order;\n  }\n\n  /**\n   * ç¢ºèªå‡ºç´å–®\n   */\n  async confirmOrder(orderId: string, confirmedBy: string): Promise<void> {\n    const order = await this.getById(orderId);\n    if (!order) {\n      throw new Error(`æ‰¾ä¸åˆ°å‡ºç´å–®: ${orderId}`);\n    }\n\n    if (order.status !== 'pending') {\n      throw new Error('åªèƒ½ç¢ºèªå¾…è™•ç†çš„å‡ºç´å–®');\n    }\n\n    const now = this.now();\n\n    // æ›´æ–°å‡ºç´å–®ç‹€æ…‹\n    await this.update(orderId, {\n      status: 'confirmed',\n      confirmed_by: confirmedBy,\n      confirmed_at: now,\n      updated_at: now\n    });\n\n    // æ›´æ–°æ‰€æœ‰é—œè¯è«‹æ¬¾å–®ç‹€æ…‹ç‚º confirmed\n    for (const requestId of order.payment_request_ids) {\n      await this.updatePaymentRequestStatus(requestId, 'confirmed');\n    }\n  }\n\n  /**\n   * æ·»åŠ è«‹æ¬¾å–®åˆ°å‡ºç´å–®\n   */\n  async addPaymentRequests(orderId: string, requestIds: string[]): Promise<void> {\n    const order = await this.getById(orderId);\n    if (!order) {\n      throw new Error(`æ‰¾ä¸åˆ°å‡ºç´å–®: ${orderId}`);\n    }\n\n    if (order.status !== 'pending') {\n      throw new Error('åªèƒ½ä¿®æ”¹å¾…è™•ç†çš„å‡ºç´å–®');\n    }\n\n    // è¨ˆç®—æ–°çš„ç¸½é‡‘é¡\n    const paymentRequestStore = usePaymentRequestStore.getState();\n    const newRequestIds = [...order.payment_request_ids, ...requestIds];\n    const newTotalAmount = newRequestIds.reduce((sum, requestId) => {\n      const request = paymentRequestStore.items.find(r => r.id === requestId);\n      return sum + (request?.total_amount || 0);\n    }, 0);\n\n    // æ›´æ–°å‡ºç´å–®\n    await this.update(orderId, {\n      payment_request_ids: newRequestIds,\n      total_amount: newTotalAmount,\n      updated_at: this.now()\n    });\n\n    // æ›´æ–°è«‹æ¬¾å–®ç‹€æ…‹\n    for (const requestId of requestIds) {\n      await this.updatePaymentRequestStatus(requestId, 'processing');\n    }\n  }\n\n  /**\n   * å¾å‡ºç´å–®ç§»é™¤è«‹æ¬¾å–®\n   */\n  async removePaymentRequest(orderId: string, requestId: string): Promise<void> {\n    const order = await this.getById(orderId);\n    if (!order) {\n      throw new Error(`æ‰¾ä¸åˆ°å‡ºç´å–®: ${orderId}`);\n    }\n\n    if (order.status !== 'pending') {\n      throw new Error('åªèƒ½ä¿®æ”¹å¾…è™•ç†çš„å‡ºç´å–®');\n    }\n\n    // è¨ˆç®—æ–°çš„ç¸½é‡‘é¡\n    const paymentRequestStore = usePaymentRequestStore.getState();\n    const newRequestIds = order.payment_request_ids.filter(id => id !== requestId);\n    const newTotalAmount = newRequestIds.reduce((sum, reqId) => {\n      const request = paymentRequestStore.items.find(r => r.id === reqId);\n      return sum + (request?.total_amount || 0);\n    }, 0);\n\n    // æ›´æ–°å‡ºç´å–®\n    await this.update(orderId, {\n      payment_request_ids: newRequestIds,\n      total_amount: newTotalAmount,\n      updated_at: this.now()\n    });\n\n    // å°‡è«‹æ¬¾å–®ç‹€æ…‹æ”¹å› pending\n    await this.updatePaymentRequestStatus(requestId, 'pending');\n  }\n\n  /**\n   * æ·»åŠ åˆ°ç•¶é€±å‡ºç´å–®ï¼ˆæ‰¾ä¸åˆ°å‰‡å‰µå»ºæ–°çš„ï¼‰\n   */\n  async addToCurrentWeekOrder(requestIds: string[]): Promise<DisbursementOrder> {\n    const currentOrder = this.getCurrentWeekOrder();\n\n    if (currentOrder) {\n      // å·²æœ‰ç•¶é€±å‡ºç´å–®ï¼Œç›´æ¥æ·»åŠ \n      await this.addPaymentRequests(currentOrder.id, requestIds);\n      return await this.getById(currentOrder.id) as DisbursementOrder;\n    } else {\n      // æ²’æœ‰ç•¶é€±å‡ºç´å–®ï¼Œå‰µå»ºæ–°çš„\n      return await this.createWithRequests(requestIds);\n    }\n  }\n\n  // ========== Helper æ–¹æ³• ==========\n\n  /**\n   * æ›´æ–°è«‹æ¬¾å–®ç‹€æ…‹ï¼ˆç§æœ‰æ–¹æ³•ï¼‰\n   */\n  private async updatePaymentRequestStatus(\n    requestId: string,\n    status: PaymentRequest['status']\n  ): Promise<void> {\n    const store = usePaymentRequestStore.getState();\n    await store.update(requestId, {\n      status,\n      updated_at: this.now()\n    });\n  }\n\n  // ========== Query æ–¹æ³• ==========\n\n  /**\n   * å–å¾—å¾…è™•ç†å‡ºç´å–®\n   */\n  getPendingOrders(): DisbursementOrder[] {\n    const store = useDisbursementOrderStore.getState();\n    return store.items.filter(o => o.status === 'pending');\n  }\n\n  /**\n   * å–å¾—å·²ç¢ºèªå‡ºç´å–®\n   */\n  getConfirmedOrders(): DisbursementOrder[] {\n    const store = useDisbursementOrderStore.getState();\n    return store.items.filter(o => o.status === 'confirmed');\n  }\n\n  /**\n   * æŒ‰æ—¥æœŸå–å¾—å‡ºç´å–®\n   */\n  getOrdersByDate(date: string): DisbursementOrder[] {\n    const store = useDisbursementOrderStore.getState();\n    return store.items.filter(o => o.disbursement_date === date);\n  }\n}\n\nexport const disbursementOrderService = new DisbursementOrderService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/payments/services/payment-request.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[762,765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[762,765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5417,5420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5417,5420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { PaymentRequest, PaymentRequestItem } from '@/stores/types';\nimport { usePaymentRequestStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\nimport { generateId } from '@/lib/data/create-data-store';\n\nclass PaymentRequestService extends BaseService<PaymentRequest> {\n  protected resourceName = 'payment_requests';\n\n  protected getStore = (): StoreOperations<PaymentRequest> => {\n    const store = usePaymentRequestStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(r => r.id === id),\n      add: async (request: PaymentRequest) => {\n        const result = await store.create(request as any);\n        return result || request;\n      },\n      update: async (id: string, data: Partial<PaymentRequest>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<PaymentRequest>): void {\n    if (data.tour_id && !data.tour_id.trim()) {\n      throw new ValidationError('tour_id', 'å¿…é ˆé—œè¯æ—…éŠåœ˜');\n    }\n\n    if (data.total_amount !== undefined && data.total_amount < 0) {\n      throw new ValidationError('total_amount', 'ç¸½é‡‘é¡ä¸èƒ½ç‚ºè² æ•¸');\n    }\n\n    if (data.request_date) {\n      const requestDate = new Date(data.request_date);\n      const dayOfWeek = requestDate.getDay();\n      if (dayOfWeek !== 4) {\n        throw new ValidationError('request_date', 'è«‹æ¬¾æ—¥æœŸå¿…é ˆç‚ºé€±å››');\n      }\n    }\n  }\n\n  // ========== PaymentRequestItem ç®¡ç† ==========\n\n  /**\n   * æ–°å¢è«‹æ¬¾é …ç›®\n   */\n  async addItem(\n    requestId: string,\n    itemData: Omit<PaymentRequestItem, 'id' | 'request_id' | 'item_number' | 'subtotal' | 'created_at' | 'updated_at'>\n  ): Promise<PaymentRequestItem> {\n    const request = await this.getById(requestId);\n    if (!request) {\n      throw new Error(`æ‰¾ä¸åˆ°è«‹æ¬¾å–®: ${requestId}`);\n    }\n\n    const id = generateId();\n    const now = this.now();\n    const itemNumber = `${request.request_number}-${String(request.items.length + 1).padStart(3, '0')}`;\n\n    const item: PaymentRequestItem = {\n      ...itemData,\n      id,\n      request_id: requestId,\n      item_number: itemNumber,\n      subtotal: itemData.unit_price * itemData.quantity,\n      created_at: now,\n      updated_at: now,\n    };\n\n    // æ›´æ–° request çš„ items å’Œ total_amount\n    const updatedItems = [...request.items, item];\n    const totalAmount = updatedItems.reduce((sum, i) => sum + i.subtotal, 0);\n\n    await this.update(requestId, {\n      items: updatedItems,\n      total_amount: totalAmount,\n      updated_at: now\n    });\n\n    return item;\n  }\n\n  /**\n   * æ›´æ–°è«‹æ¬¾é …ç›®\n   */\n  async updateItem(\n    requestId: string,\n    itemId: string,\n    itemData: Partial<PaymentRequestItem>\n  ): Promise<void> {\n    const request = await this.getById(requestId);\n    if (!request) {\n      throw new Error(`æ‰¾ä¸åˆ°è«‹æ¬¾å–®: ${requestId}`);\n    }\n\n    const now = this.now();\n    const updatedItems = request.items.map(item => {\n      if (item.id === itemId) {\n        const updated = { ...item, ...itemData, updated_at: now };\n        updated.subtotal = updated.unit_price * updated.quantity;\n        return updated;\n      }\n      return item;\n    });\n\n    const totalAmount = updatedItems.reduce((sum, i) => sum + i.subtotal, 0);\n\n    await this.update(requestId, {\n      items: updatedItems,\n      total_amount: totalAmount,\n      updated_at: now\n    });\n  }\n\n  /**\n   * åˆªé™¤è«‹æ¬¾é …ç›®\n   */\n  async deleteItem(requestId: string, itemId: string): Promise<void> {\n    const request = await this.getById(requestId);\n    if (!request) {\n      throw new Error(`æ‰¾ä¸åˆ°è«‹æ¬¾å–®: ${requestId}`);\n    }\n\n    const now = this.now();\n    const updatedItems = request.items.filter(item => item.id !== itemId);\n    const totalAmount = updatedItems.reduce((sum, i) => sum + i.subtotal, 0);\n\n    await this.update(requestId, {\n      items: updatedItems,\n      total_amount: totalAmount,\n      updated_at: now\n    });\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  /**\n   * è¨ˆç®—è«‹æ¬¾å–®ç¸½é‡‘é¡ï¼ˆæ‰‹å‹•è§¸ç™¼ï¼‰\n   */\n  async calculateTotalAmount(requestId: string): Promise<number> {\n    const request = await this.getById(requestId);\n    if (!request) {\n      throw new Error(`æ‰¾ä¸åˆ°è«‹æ¬¾å–®: ${requestId}`);\n    }\n\n    const totalAmount = request.items.reduce((sum, item) => sum + item.subtotal, 0);\n\n    await this.update(requestId, {\n      total_amount: totalAmount,\n      updated_at: this.now()\n    });\n\n    return totalAmount;\n  }\n\n  /**\n   * æŒ‰é¡åˆ¥å–å¾—è«‹æ¬¾é …ç›®\n   */\n  getItemsByCategory(\n    requestId: string,\n    category: PaymentRequestItem['category']\n  ): PaymentRequestItem[] {\n    const store = usePaymentRequestStore.getState();\n    const request = store.items.find((r: PaymentRequest) => r.id === requestId);\n    return request?.items.filter((item: PaymentRequestItem) => item.category === category) || [];\n  }\n\n  /**\n   * å¾å ±åƒ¹å–®å‰µå»ºè«‹æ¬¾å–®\n   */\n  async createFromQuote(\n    tourId: string,\n    quoteId: string,\n    requestDate: string,\n    tourName: string,\n    code: string\n  ): Promise<PaymentRequest> {\n    const requestData = {\n      tour_id: tourId,\n      code,\n      tour_name: tourName,\n      quote_id: quoteId,\n      request_date: requestDate,\n      items: [],\n      total_amount: 0,\n      status: 'pending' as const,\n      note: 'å¾å ±åƒ¹å–®è‡ªå‹•ç”Ÿæˆ',\n      budget_warning: false,\n      created_by: '1', // TODO: ä½¿ç”¨å¯¦éš›ç”¨æˆ¶ID\n    };\n\n    return await this.create(requestData as any);\n  }\n\n  // ========== Query æ–¹æ³• ==========\n\n  /**\n   * å–å¾—å¾…è™•ç†è«‹æ¬¾å–®\n   */\n  getPendingRequests(): PaymentRequest[] {\n    const store = usePaymentRequestStore.getState();\n    return store.items.filter(r => r.status === 'pending');\n  }\n\n  /**\n   * å–å¾—è™•ç†ä¸­è«‹æ¬¾å–®\n   */\n  getProcessingRequests(): PaymentRequest[] {\n    const store = usePaymentRequestStore.getState();\n    return store.items.filter(r => r.status === 'processing');\n  }\n\n  /**\n   * æŒ‰æ—…éŠåœ˜å–å¾—è«‹æ¬¾å–®\n   */\n  getRequestsByTour(tourId: string): PaymentRequest[] {\n    const store = usePaymentRequestStore.getState();\n    return store.items.filter(r => r.tour_id === tourId);\n  }\n\n  /**\n   * æŒ‰è¨‚å–®å–å¾—è«‹æ¬¾å–®\n   */\n  getRequestsByOrder(orderId: string): PaymentRequest[] {\n    const store = usePaymentRequestStore.getState();\n    return store.items.filter(r => r.order_id === orderId);\n  }\n}\n\nexport const paymentRequestService = new PaymentRequestService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/quotes/hooks/useQuotes.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[460,463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[460,463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuoteStore } from '@/stores';\nimport { quoteService } from '../services/quote.service';\nimport { Quote } from '@/stores/types';\n\nexport const useQuotes = () => {\n  const store = useQuoteStore();\n\n  return {\n    // ========== è³‡æ–™ ==========\n    quotes: store.items,\n\n    // ========== CRUD æ“ä½œ ==========\n    addQuote: async (data: Omit<Quote, 'id' | 'created_at' | 'updated_at' | 'version' | 'versions'>) => {\n      return await store.create(data as any);\n    },\n\n    updateQuote: async (id: string, data: Partial<Quote>) => {\n      return await store.update(id, data);\n    },\n\n    deleteQuote: async (id: string) => {\n      return await store.delete(id);\n    },\n\n    loadQuotes: async () => {\n      return await store.fetchAll();\n    },\n\n    // ========== æ¥­å‹™æ–¹æ³• ==========\n    duplicateQuote: async (id: string) => {\n      return await quoteService.duplicateQuote(id);\n    },\n\n    createNewVersion: async (id: string, updates: Partial<Quote>) => {\n      return await quoteService.createNewVersion(id, updates);\n    },\n\n    getQuotesByTour: (tour_id: string) => {\n      return quoteService.getQuotesByTour(tour_id);\n    },\n\n    getQuotesByStatus: (status: Quote['status']) => {\n      return quoteService.getQuotesByStatus(status);\n    },\n\n    calculateTotalCost: (quote: Quote) => {\n      return quoteService.calculateTotalCost(quote);\n    },\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/quotes/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/quotes/services/quote.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1769,1772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1769,1772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Quote } from '@/stores/types';\nimport { useQuoteStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\nimport { generateId } from '@/lib/data/create-data-store';\n\nclass QuoteService extends BaseService<Quote> {\n  protected resourceName = 'quotes';\n\n  protected getStore = (): StoreOperations<Quote> => {\n    const store = useQuoteStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(q => q.id === id),\n      add: async (quote: Quote) => {\n        const result = await store.create(quote as any);\n        return result || quote;\n      },\n      update: async (id: string, data: Partial<Quote>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Quote>): void {\n    if (data.name && data.name.trim().length < 2) {\n      throw new ValidationError('name', 'å ±åƒ¹å–®æ¨™é¡Œè‡³å°‘éœ€è¦ 2 å€‹å­—ç¬¦');\n    }\n\n    if (data.categories) {\n      const total_cost = data.categories.reduce((sum, cat) => sum + cat.total, 0);\n      if (total_cost < 0) {\n        throw new ValidationError('categories', 'ç¸½é‡‘é¡ä¸èƒ½ç‚ºè² æ•¸');\n      }\n    }\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  async duplicateQuote(id: string): Promise<Quote | undefined> {\n    const store = useQuoteStore.getState();\n    const original = store.items.find(q => q.id === id);\n    if (!original) return undefined;\n\n    // æ’é™¤ä¸æ‡‰è©²å‚³å…¥çš„æ¬„ä½\n    const { id: _, created_at, updated_at, version, versions, ...rest } = original;\n\n    const duplicated = await store.create({\n      ...rest,\n      name: `${original.name} (å‰¯æœ¬)`,\n      status: 'proposed'\n    } as any);\n\n    return duplicated;\n  }\n\n  async createNewVersion(id: string, updates: Partial<Quote>): Promise<Quote | undefined> {\n    const store = useQuoteStore.getState();\n    const current = store.items.find(q => q.id === id);\n    if (!current) return undefined;\n\n    const newVersion = {\n      id: generateId(),\n      version: (current.version || 1) + 1,\n      categories: current.categories,\n      total_cost: current.total_cost,\n      group_size: current.group_size,\n      accommodation_days: current.accommodation_days,\n      participant_counts: current.participant_counts || {\n        adult: 0,\n        child_with_bed: 0,\n        child_no_bed: 0,\n        single_room: 0,\n        infant: 0\n      },\n      selling_prices: current.selling_prices || {\n        adult: 0,\n        child_with_bed: 0,\n        child_no_bed: 0,\n        single_room: 0,\n        infant: 0\n      },\n      created_at: new Date().toISOString()\n    };\n\n    return await store.update(id, {\n      version: (current.version || 1) + 1,\n      versions: [...(current.versions || []), newVersion],\n      ...updates\n    });\n  }\n\n  getQuotesByTour(tour_id: string): Quote[] {\n    const store = useQuoteStore.getState();\n    return store.items.filter(q => q.tour_id === tour_id);\n  }\n\n  getQuotesByStatus(status: Quote['status']): Quote[] {\n    const store = useQuoteStore.getState();\n    return store.items.filter(q => q.status === status);\n  }\n\n  calculateTotalCost(quote: Quote): number {\n    return quote.categories.reduce((sum, cat) => sum + cat.total, 0);\n  }\n}\n\nexport const quoteService = new QuoteService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/suppliers/hooks/useSuppliers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/suppliers/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/suppliers/services/supplier.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[649,652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[649,652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Supplier } from '@/stores/types';\nimport { useSupplierStore, useRegionStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\n\nclass SupplierService extends BaseService<Supplier> {\n  protected resourceName = 'suppliers';\n\n  protected getStore = (): StoreOperations<Supplier> => {\n    const store = useSupplierStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find((s: Supplier) => s.id === id),\n      add: async (supplier: Supplier) => {\n        await store.create(supplier as any);\n        return supplier;\n      },\n      update: async (id: string, data: Partial<Supplier>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  };\n\n  protected validate(data: Partial<Supplier>): void {\n    if (data.name && data.name.trim().length < 2) {\n      throw new ValidationError('name', 'ä¾›æ‡‰å•†åç¨±è‡³å°‘éœ€è¦ 2 å€‹å­—ç¬¦');\n    }\n\n    // Supplier ä½¿ç”¨ contact ç‰©ä»¶\n    if (data.contact?.email && !this.isValidEmail(data.contact.email)) {\n      throw new ValidationError('email', 'éƒµä»¶æ ¼å¼éŒ¯èª¤');\n    }\n\n    if (data.contact?.phone && !this.isValidPhone(data.contact.phone)) {\n      throw new ValidationError('phone', 'é›»è©±æ ¼å¼éŒ¯èª¤');\n    }\n  }\n\n  private isValidEmail(email: string): boolean {\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n  }\n\n  private isValidPhone(phone: string): boolean {\n    return /^[\\d\\s\\-+()]{8,}$/.test(phone);\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  getSuppliersByCategory(category: Supplier['type']): Supplier[] {\n    const store = useSupplierStore.getState();\n    return store.items.filter((s: Supplier) => s.type === category);\n  }\n\n  getActiveSuppliers(): Supplier[] {\n    const store = useSupplierStore.getState();\n    return store.items.filter((s: Supplier) => s.status === 'active');\n  }\n\n  searchSuppliers(searchTerm: string): Supplier[] {\n    const store = useSupplierStore.getState();\n    const term = searchTerm.toLowerCase();\n    return store.items.filter((s: Supplier) =>\n      s.name.toLowerCase().includes(term) ||\n      s.contact.contact_person?.toLowerCase().includes(term) ||\n      s.contact.email?.toLowerCase().includes(term)\n    );\n  }\n\n  /**\n   * ç”Ÿæˆä¾›æ‡‰å•†ç·¨è™Ÿ\n   * æ ¼å¼ï¼šS + åœ‹å®¶ä»£ç¢¼ï¼ˆ3ç¢¼ï¼‰+ æµæ°´è™Ÿï¼ˆ3ç¢¼ï¼‰\n   * ä¾‹å¦‚ï¼šSJPN001ï¼ˆæ—¥æœ¬çš„ç¬¬ä¸€å€‹ä¾›æ‡‰å•†ï¼‰\n   */\n  async generateSupplierCode(countryName: string): Promise<string> {\n    const supplierStore = useSupplierStore.getState();\n    const regionStore = useRegionStore.getState();\n\n    // å¾ regions æ ¹æ“šåœ‹å®¶åç¨±æ‰¾åˆ°åœ‹å®¶ä»£ç¢¼\n    let countryCode = 'OTH'; // é è¨­å…¶ä»–\n    const country = regionStore.items.find(\n      r => r.type === 'country' && r.name === countryName && !r._deleted\n    );\n    if (country) {\n      countryCode = country.code;\n    }\n\n    // æ‰¾å‡ºè©²åœ‹å®¶ç¾æœ‰çš„ä¾›æ‡‰å•†æ•¸é‡ï¼Œä½œç‚ºæµæ°´è™Ÿ\n    const sameCountrySuppliers = supplierStore.items.filter(\n      (s: Supplier) => s.country === countryName\n    );\n\n    // ç”Ÿæˆæµæ°´è™Ÿï¼ˆå¾ç¾æœ‰æ•¸é‡ +1 é–‹å§‹ï¼‰\n    const sequence = (sameCountrySuppliers.length + 1).toString().padStart(3, '0');\n\n    return `S${countryCode}${sequence}`;\n  }\n}\n\nexport const supplierService = new SupplierService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/todos/hooks/useTodos.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user_id' is defined but never used. Allowed unused args must match /^_/u.","line":29,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTodoStore } from '@/stores';\nimport { todoService } from '../services/todo.service';\nimport { Todo } from '@/stores/types';\n\nexport const useTodos = () => {\n  const store = useTodoStore();\n\n  return {\n    // ========== è³‡æ–™ ==========\n    todos: store.items,\n\n    // ========== CRUD æ“ä½œ ==========\n    createTodo: async (data: Omit<Todo, 'id' | 'created_at' | 'updated_at' | 'creator' | 'visibility'>) => {\n      return await store.create(data as Omit<Todo, 'id' | 'created_at' | 'updated_at'>);\n    },\n\n    updateTodo: async (id: string, data: Partial<Todo>) => {\n      return await store.update(id, data);\n    },\n\n    deleteTodo: async (id: string) => {\n      return await store.delete(id);\n    },\n\n    toggleTodo: async (id: string) => {\n      return await todoService.toggleTodo(id);\n    },\n\n    loadTodos: async (user_id?: string) => {\n      return await store.fetchAll();\n    },\n\n    clearAllTodos: () => {\n      store.clear();\n    },\n\n    // ========== æ¥­å‹™æ–¹æ³• ==========\n    getTodosByUser: (user_id: string) => {\n      return todoService.getTodosByUser(user_id);\n    },\n\n    getTodosByStatus: (completed: boolean) => {\n      return todoService.getTodosByStatus(completed);\n    },\n\n    getTodosByPriority: (priority: Todo['priority']) => {\n      return todoService.getTodosByPriority(priority);\n    },\n\n    getOverdueTodos: () => {\n      return todoService.getOverdueTodos();\n    },\n\n    getTodayTodos: () => {\n      return todoService.getTodayTodos();\n    },\n\n    getUpcomingTodos: (days?: number) => {\n      return todoService.getUpcomingTodos(days);\n    },\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/todos/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/todos/services/todo.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[581,584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[581,584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1465,1468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1465,1468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Todo } from '@/stores/types';\nimport { useTodoStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\n\nclass TodoService extends BaseService<Todo> {\n  protected resourceName = 'todos';\n\n  protected getStore = (): StoreOperations<Todo> => {\n    const store = useTodoStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(t => t.id === id),\n      add: async (todo: Todo) => {\n        await store.create(todo as any);\n        return todo;\n      },\n      update: async (id: string, data: Partial<Todo>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Todo>): void {\n    if (data.title && data.title.trim().length === 0) {\n      throw new ValidationError('title', 'å¾…è¾¦äº‹é …æ¨™é¡Œä¸èƒ½ç‚ºç©º');\n    }\n\n    if (data.deadline) {\n      const deadline = new Date(data.deadline);\n      if (isNaN(deadline.getTime())) {\n        throw new ValidationError('deadline', 'æˆªæ­¢æ—¥æœŸæ ¼å¼éŒ¯èª¤');\n      }\n    }\n  }\n\n  // ========== æ¥­å‹™é‚è¼¯æ–¹æ³• ==========\n\n  async toggleTodo(id: string): Promise<void> {\n    const store = useTodoStore.getState();\n    const todo = store.items.find(t => t.id === id);\n    if (todo) {\n      await store.update(id, { status: todo.status === 'completed' ? 'pending' : 'completed' } as any);\n    }\n  }\n\n  getTodosByUser(user_id: string): Todo[] {\n    const store = useTodoStore.getState();\n    return store.items.filter(t =>\n      t.creator === user_id || t.assignee === user_id || t.visibility?.includes(user_id)\n    );\n  }\n\n  getTodosByStatus(completed: boolean): Todo[] {\n    const store = useTodoStore.getState();\n    return store.items.filter(t => t.completed === completed);\n  }\n\n  getTodosByPriority(priority: Todo['priority']): Todo[] {\n    const store = useTodoStore.getState();\n    return store.items.filter(t => t.priority === priority);\n  }\n\n  getOverdueTodos(): Todo[] {\n    const store = useTodoStore.getState();\n    const now = new Date();\n    return store.items.filter(t =>\n      !t.completed &&\n      t.deadline &&\n      new Date(t.deadline) < now\n    );\n  }\n\n  getTodayTodos(): Todo[] {\n    const store = useTodoStore.getState();\n    const today = new Date().toISOString().split('T')[0];\n    return store.items.filter(t =>\n      !t.completed &&\n      t.deadline?.startsWith(today)\n    );\n  }\n\n  getUpcomingTodos(days: number = 7): Todo[] {\n    const store = useTodoStore.getState();\n    const now = new Date();\n    const future = new Date();\n    future.setDate(future.getDate() + days);\n\n    return store.items.filter(t => {\n      if (!t.deadline || t.completed) return false;\n      const deadline = new Date(t.deadline);\n      return deadline >= now && deadline <= future;\n    });\n  }\n}\n\nexport const todoService = new TodoService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/tours/hooks/useTours-advanced.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PageResponse' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":35},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'params'. Either include it or remove the dependency array.","line":16,"column":46,"nodeType":"ArrayExpression","endLine":22,"endColumn":4,"suggestions":[{"desc":"Update the dependencies array to be: [params]","fix":{"range":[729,846],"text":"[params]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":21,"column":5,"nodeType":"ChainExpression","endLine":21,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[826,829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[826,829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'tourStore'. Either exclude it or remove the dependency array.","line":64,"column":6,"nodeType":"ArrayExpression","endLine":64,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [loadTours]","fix":{"range":[2025,2047],"text":"[loadTours]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'originalData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":101,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":101,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3806,3809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3806,3809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useMemo } from 'react';\nimport { tourService } from '../services/tour.service';\nimport { Tour } from '@/stores/types';\nimport { PageRequest, PageResponse, UseEntityResult } from '@/core/types/common';\nimport { BaseEntity } from '@/core/types/common';\nimport { useTourStore } from '@/stores';\n\nexport function useTours(params?: PageRequest): UseEntityResult<Tour> {\n  const [data, setData] = useState<Tour[]>([]);\n  const [totalCount, setTotalCount] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const tourStore = useTourStore();\n\n  // ä½¿ç”¨ useMemo ä¾†ç©©å®š params ç‰©ä»¶çš„åƒè€ƒ\n  const stableParams = useMemo(() => params, [\n    params?.page,\n    params?.pageSize,\n    params?.search,\n    params?.sortBy,\n    (params as any)?.sort_order\n  ]);\n\n  const loadTours = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const result = await tourService.list(stableParams);\n      setData(result.data);\n      setTotalCount(result.total);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'è¼‰å…¥æ—…éŠåœ˜è³‡æ–™å¤±æ•—';\n      setError(errorMessage);\n      console.error('Failed to load tours:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [stableParams]);\n\n  useEffect(() => {\n    loadTours();\n  }, [loadTours]);\n\n  const createTour = useCallback(async (tourData: Omit<Tour, keyof BaseEntity>) => {\n    try {\n      setError(null);\n      const newTour = await tourService.create(tourData);\n\n      // âœ… æ¨‚è§€æ›´æ–° - ç«‹å³åŠ å…¥ UIï¼Œä¸ç­‰å¾…é‡æ–°è¼‰å…¥\n      setData(prevData => [newTour, ...prevData]);\n      setTotalCount(prev => prev + 1);\n\n      // ğŸ”§ Store å·²ç¶“åœ¨ tourService.create() ä¸­æ›´æ–°äº†ï¼Œé€™è£¡ä¸éœ€è¦é‡è¤‡æ›´æ–°\n      console.log('âœ… å·²å»ºç«‹æ–°æ—…éŠåœ˜:', newTour.code);\n\n      return newTour;\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'å»ºç«‹æ—…éŠåœ˜å¤±æ•—';\n      setError(errorMessage);\n      // å¤±æ•—æ™‚é‡æ–°è¼‰å…¥ä»¥ç¢ºä¿æ•¸æ“šä¸€è‡´æ€§\n      await loadTours();\n      throw err; // è®“èª¿ç”¨è€…å¯ä»¥è™•ç†éŒ¯èª¤\n    }\n  }, [loadTours, tourStore]);\n\n  const updateTour = useCallback(async (id: string, tourData: Partial<Tour>) => {\n    try {\n      setError(null);\n\n      // æ¨‚è§€æ›´æ–° - ç«‹å³æ›´æ–° UI\n      setData(prevData =>\n        prevData.map(tour =>\n          tour.id === id ? { ...tour, ...tourData } : tour\n        )\n      );\n\n      const updated = await tourService.update(id, tourData);\n\n      // æˆåŠŸå¾Œç”¨çœŸå¯¦è³‡æ–™æ›´æ–°\n      setData(prevData =>\n        prevData.map(tour =>\n          tour.id === id ? updated : tour\n        )\n      );\n\n      return updated;\n    } catch (err) {\n      // å¤±æ•—æ™‚å›æ»¾\n      await loadTours();\n      const errorMessage = err instanceof Error ? err.message : 'æ›´æ–°æ—…éŠåœ˜å¤±æ•—';\n      setError(errorMessage);\n      throw err;\n    }\n  }, [loadTours]);\n\n  const deleteTour = useCallback(async (id: string) => {\n    try {\n      setError(null);\n\n      // æ¨‚è§€æ›´æ–° - ç«‹å³å¾ UI ç§»é™¤\n      const originalData = data;\n      setData(prevData => prevData.filter(tour => tour.id !== id));\n      setTotalCount(prev => Math.max(0, prev - 1));\n\n      await tourService.delete(id);\n    } catch (err) {\n      // å¤±æ•—æ™‚å›æ»¾\n      await loadTours();\n      const errorMessage = err instanceof Error ? err.message : 'åˆªé™¤æ—…éŠåœ˜å¤±æ•—';\n      setError(errorMessage);\n      throw err;\n    }\n  }, [data, loadTours]);\n\n  const refresh = useCallback(async () => {\n    await loadTours();\n  }, [loadTours]);\n\n  return {\n    data,\n    totalCount,\n    loading,\n    error,\n    actions: {\n      create: createTour,\n      update: updateTour,\n      delete: (async (id: string) => { await deleteTour(id); return true; }) as (id: string) => Promise<boolean>,\n      refresh,\n    },\n  };\n}\n\n// å°ˆé–€ç”¨æ–¼å–®å€‹æ—…éŠåœ˜è©³æƒ…çš„ hook\nexport function useTourDetails(tour_id: string) {\n  const [tour, setTour] = useState<Tour | null>(null);\n  const [financials, setFinancials] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadTourDetails = useCallback(async () => {\n    if (!tour_id) {\n      setLoading(false);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n\n      const [tourData, financialData] = await Promise.all([\n        tourService.getById(tour_id),\n        tourService.calculateFinancialSummary(tour_id),\n      ]);\n\n      setTour(tourData);\n      setFinancials(financialData);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'è¼‰å…¥æ—…éŠåœ˜è©³æƒ…å¤±æ•—';\n      setError(errorMessage);\n      console.error('Failed to load tour details:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [tour_id]);\n\n  useEffect(() => {\n    loadTourDetails();\n  }, [loadTourDetails]);\n\n  const updateTourStatus = useCallback(async (newStatus: Tour['status'], reason?: string) => {\n    if (!tour_id) return null;\n\n    try {\n      setError(null);\n      const updated = await tourService.updateTourStatus(tour_id, newStatus, reason);\n      setTour(updated);\n      return updated;\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'æ›´æ–°æ—…éŠåœ˜ç‹€æ…‹å¤±æ•—';\n      setError(errorMessage);\n      throw err;\n    }\n  }, [tour_id]);\n\n  const generateTourCode = useCallback(async (location: string, date: Date, isSpecial?: boolean) => {\n    try {\n      setError(null);\n      return await tourService.generateTourCode(location, date, isSpecial);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'ç”Ÿæˆåœ˜è™Ÿå¤±æ•—';\n      setError(errorMessage);\n      throw err;\n    }\n  }, []);\n\n  return {\n    tour,\n    financials,\n    loading,\n    error,\n    actions: {\n      updateStatus: updateTourStatus,\n      generateCode: generateTourCode,\n      refresh: loadTourDetails,\n    }\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/tours/hooks/useTours.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Order' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Customer' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Member' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[585,588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[585,588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTourStore } from '@/stores';\nimport { tourService } from '../services/tour.service';\nimport { Tour, Order, Customer, Member } from '@/stores/types';\n\n/**\n * ç°¡åŒ–ç‰ˆ Tours Hookï¼ˆèˆ‡å…¶ä»–æ¨¡çµ„æ¥å£çµ±ä¸€ï¼‰\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * const { tours, orders, createTour, updateTour } = useTours();\n */\nexport const useTours = () => {\n  const tourStore = useTourStore();\n\n  return {\n    // ========== è³‡æ–™ ==========\n    tours: tourStore.items,\n\n    // ========== Tour CRUD æ“ä½œ ==========\n    createTour: async (data: Omit<Tour, 'id' | 'created_at' | 'updated_at'>) => {\n      return await tourStore.create(data as any);\n    },\n\n    updateTour: async (id: string, data: Partial<Tour>) => {\n      return await tourStore.update(id, data);\n    },\n\n    deleteTour: async (id: string) => {\n      return await tourStore.delete(id);\n    },\n\n    loadTours: async () => {\n      return await tourStore.fetchAll();\n    },\n\n    // ========== æ¥­å‹™æ–¹æ³•ï¼ˆä¾†è‡ª Serviceï¼‰ ==========\n    generateTourCode: async (location: string, date: Date, isSpecial?: boolean) => {\n      return await tourService.generateTourCode(location, date, isSpecial);\n    },\n\n    isTourCodeExists: async (code: string) => {\n      return await tourService.isTourCodeExists(code);\n    },\n\n    calculateFinancialSummary: async (tour_id: string) => {\n      return await tourService.calculateFinancialSummary(tour_id);\n    },\n\n    updateTourStatus: async (tour_id: string, status: Tour['status'], reason?: string) => {\n      return await tourService.updateTourStatus(tour_id, status, reason);\n    },\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/features/tours/services/tour.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[721,724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[721,724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-catch","severity":1,"message":"Unnecessary try/catch wrapper.","line":124,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":145,"endColumn":6},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3933,3936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3933,3936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-catch","severity":1,"message":"Unnecessary try/catch wrapper.","line":150,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":172,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reason' is defined but never used. Allowed unused args must match /^_/u.","line":176,"column":70,"nodeType":null,"messageId":"unusedVar","endLine":176,"endColumn":76},{"ruleId":"no-useless-catch","severity":1,"message":"Unnecessary try/catch wrapper.","line":177,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":193,"endColumn":6},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6220,6223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6220,6223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6375,6378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6375,6378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6589,6592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6589,6592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'store' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":233,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":233,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8108,8111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8108,8111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":279,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8155,8158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8155,8158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BaseService, StoreOperations } from '@/core/services/base.service';\nimport { Tour } from '@/stores/types';\nimport { useTourStore } from '@/stores';\nimport { ValidationError } from '@/core/errors/app-errors';\n\ninterface TourFinancialSummary {\n  total_revenue: number;\n  total_cost: number;\n  profit: number;\n  profitMargin: number;\n}\n\nclass TourService extends BaseService<Tour> {\n  protected resourceName = 'tours';\n\n  protected getStore = (): StoreOperations<Tour> => {\n    const store = useTourStore.getState();\n    return {\n      getAll: () => store.items,\n      getById: (id: string) => store.items.find(t => t.id === id),\n      add: async (tour: Tour) => {\n        const result = await store.create(tour as any);\n        return result || tour;\n      },\n      update: async (id: string, data: Partial<Tour>) => {\n        await store.update(id, data);\n      },\n      delete: async (id: string) => {\n        await store.delete(id);\n      }\n    };\n  }\n\n  protected validate(data: Partial<Tour>): void {\n    super.validate(data);\n\n    if (data.name && data.name.trim().length < 2) {\n      throw new ValidationError('name', 'æ—…éŠåœ˜åç¨±è‡³å°‘éœ€è¦ 2 å€‹å­—ç¬¦');\n    }\n\n    if (data.max_participants && data.max_participants < 1) {\n      throw new ValidationError('max_participants', 'æœ€å¤§åƒèˆ‡äººæ•¸å¿…é ˆå¤§æ–¼ 0');\n    }\n\n    if (data.price && data.price < 0) {\n      throw new ValidationError('price', 'åƒ¹æ ¼ä¸èƒ½ç‚ºè² æ•¸');\n    }\n\n    // ç§»é™¤éå»æ—¥æœŸé©—è­‰ - å…è¨±å»ºç«‹æ­·å²æ—…éŠåœ˜è³‡æ–™\n    // if (data.departure_date) {\n    //   const depDate = new Date(data.departure_date);\n    //   const today = new Date();\n    //   today.setHours(0, 0, 0, 0);\n    //   if (depDate < today) {\n    //     throw new ValidationError('departure_date', 'å‡ºç™¼æ—¥æœŸä¸èƒ½æ˜¯éå»çš„æ™‚é–“');\n    //   }\n    // }\n\n    if (data.return_date && data.departure_date) {\n      const depDate = new Date(data.departure_date);\n      const retDate = new Date(data.return_date);\n\n      if (retDate < depDate) {\n        throw new ValidationError('return_date', 'è¿”å›æ—¥æœŸä¸èƒ½æ—©æ–¼å‡ºç™¼æ—¥æœŸ');\n      }\n    }\n  }\n\n  // æª¢æŸ¥åœ˜è™Ÿæ˜¯å¦å·²å­˜åœ¨\n  async isTourCodeExists(code: string): Promise<boolean> {\n    const allTours = await this.list();\n    return allTours.data.some(t => t.code === code);\n  }\n\n  /**\n   * ç”Ÿæˆåœ˜è™Ÿ\n   * @param cityCode - 3ç¢¼åŸå¸‚ä»£è™Ÿ (å¦‚: TYO, BKK, OSA)\n   * @param date - å‡ºç™¼æ—¥æœŸ\n   * @param isSpecial - æ˜¯å¦ç‚ºç‰¹æ®Šåœ˜\n   * @returns åœ˜è™Ÿ (æ ¼å¼: TYO250101001 æˆ– SPC250101001)\n   */\n  async generateTourCode(cityCode: string, date: Date, isSpecial: boolean = false): Promise<string> {\n    const year = date.getFullYear().toString().slice(-2);\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const dateStr = `${year}${month}${day}`;\n\n    // ç²å–ç•¶æ—¥å·²æœ‰çš„åœ˜è™Ÿä¾†ç”Ÿæˆæµæ°´è™Ÿ\n    const allTours = await this.list();\n    const todayTours = allTours.data.filter(t =>\n      t.code && t.code.includes(dateStr)\n    );\n\n    // æ‰¾å‡ºæœ€å¤§çš„æµæ°´è™Ÿä¸¦ +1ï¼Œé¿å…é‡è¤‡\n    let maxSequence = 0;\n    todayTours.forEach(tour => {\n      const match = tour.code.match(/(\\d{3})$/);\n      if (match) {\n        const seq = parseInt(match[1], 10);\n        if (seq > maxSequence) maxSequence = seq;\n      }\n    });\n\n    const sequence = (maxSequence + 1).toString().padStart(3, '0');\n    const code = isSpecial\n      ? `SPC${dateStr}${sequence}`\n      : `${cityCode.toUpperCase()}${dateStr}${sequence}`;\n\n    // é›™é‡æª¢æŸ¥ï¼šç¢ºä¿ç”Ÿæˆçš„åœ˜è™Ÿä¸å­˜åœ¨\n    const exists = await this.isTourCodeExists(code);\n    if (exists) {\n      // å¦‚æœä»ç„¶é‡è¤‡ï¼Œä½¿ç”¨æ™‚é–“æˆ³ç¢ºä¿å”¯ä¸€æ€§\n      const timestamp = Date.now().toString().slice(-3);\n      return isSpecial\n        ? `SPC${dateStr}${timestamp}`\n        : `${cityCode.toUpperCase()}${dateStr}${timestamp}`;\n    }\n\n    return code;\n  }\n\n  // è¨ˆç®—åœ˜é«”è²¡å‹™æ‘˜è¦\n  async calculateFinancialSummary(tour_id: string): Promise<TourFinancialSummary> {\n    try {\n      const tour = await this.getById(tour_id);\n      if (!tour) {\n        throw new Error('Tour not found');\n      }\n\n      // é€™è£¡éœ€è¦ç²å–ç›¸é—œè¨‚å–®è³‡æ–™ä¾†è¨ˆç®—\n      // ç›®å‰å…ˆä½¿ç”¨æ¨¡æ“¬é‚è¼¯\n      const total_revenue = tour.price * ((tour as any).current_participants || 0);\n      const estimatedCost = total_revenue * 0.7; // å‡è¨­æˆæœ¬ç‚ºæ”¶å…¥çš„70%\n      const profit = total_revenue - estimatedCost;\n      const profitMargin = total_revenue > 0 ? (profit / total_revenue) * 100 : 0;\n\n      return {\n        total_revenue,\n        total_cost: estimatedCost,\n        profit,\n        profitMargin,\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // æª¢æŸ¥åœ˜é«”æ˜¯å¦å¯ä»¥å–æ¶ˆ\n  async canCancelTour(tour_id: string): Promise<{ canCancel: boolean; reason?: string }> {\n    try {\n      const tour = await this.getById(tour_id);\n      if (!tour) {\n        return { canCancel: false, reason: 'æ‰¾ä¸åˆ°è©²æ—…éŠåœ˜' };\n      }\n\n      // Tour ç‹€æ…‹æª¢æŸ¥\n      if (tour.status === 'closed') {\n        return { canCancel: false, reason: 'è©²æ—…éŠåœ˜å·²ç¶“çµæ¡ˆï¼Œç„¡æ³•å–æ¶ˆ' };\n      }\n\n      const departure_date = new Date(tour.departure_date);\n      const now = new Date();\n      const daysDiff = Math.ceil((departure_date.getTime() - now.getTime()) / (1000 * 60 * 60 * 24));\n\n      if (daysDiff < 3) {\n        return { canCancel: false, reason: 'å‡ºç™¼å‰3å¤©å…§ç„¡æ³•å–æ¶ˆ' };\n      }\n\n      return { canCancel: true };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  // æ›´æ–°åœ˜é«”ç‹€æ…‹\n  async updateTourStatus(tour_id: string, newStatus: Tour['status'], reason?: string): Promise<Tour> {\n    try {\n      const tour = await this.getById(tour_id);\n      if (!tour) {\n        throw new Error('Tour not found');\n      }\n\n      // ç‹€æ…‹è½‰æ›é©—è­‰ï¼ˆæš«æ™‚è¨»è§£ï¼Œå› ç‚ºç‹€æ…‹å€¼æ˜¯ä¸­æ–‡ï¼‰\n      // TODO: å¯¦ä½œä¸­æ–‡ç‹€æ…‹çš„è½‰æ›é©—è­‰é‚è¼¯\n\n      return await this.update(tour_id, {\n        status: newStatus,\n        // å¯ä»¥åœ¨é€™è£¡è¨˜éŒ„ç‹€æ…‹è®Šæ›´çš„åŸå› å’Œæ™‚é–“\n        updated_at: this.now()\n      });\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * å–å¾—æˆ–å»ºç«‹å¹´åº¦ç°½è­‰å°ˆç”¨åœ˜\n   * @param year - å¹´ä»½ (å¦‚: 2025)\n   * @returns ç°½è­‰å°ˆç”¨åœ˜\n   */\n  async getOrCreateVisaTour(year?: number): Promise<Tour> {\n    const targetYear = year || new Date().getFullYear();\n    const visaCode = `VISA${targetYear}001`;\n\n    // ğŸ”§ ç›´æ¥æŸ¥è©¢ Supabaseï¼ˆåŒ…å«å·²åˆªé™¤çš„è³‡æ–™ï¼‰\n    try {\n      if (typeof window !== 'undefined') {\n        const { supabase } = await import('@/lib/supabase/client');\n        const { data, error } = await supabase\n          .from('tours')\n          .select('*')\n          .eq('code', visaCode)\n          .maybeSingle();\n\n        if (!error && data) {\n          // å¦‚æœæ‰¾åˆ°å·²åˆªé™¤çš„ç°½è­‰åœ˜ï¼Œå¾©åŸå®ƒ\n          if ((data as any)._deleted) {\n            console.log(`ğŸ”„ [Visa Tour] æ‰¾åˆ°å·²åˆªé™¤çš„ç°½è­‰åœ˜ï¼Œæ­£åœ¨å¾©åŸ...`);\n            const { data: updated, error: updateError } = await (supabase as any)\n              .from('tours')\n              .update({\n                _deleted: false,\n                _synced_at: null,\n                updated_at: this.now()\n              })\n              .eq('id', (data as any).id)\n              .select()\n              .single();\n\n            if (!updateError && updated) {\n              console.log(`âœ… [Visa Tour] ç°½è­‰åœ˜å·²å¾©åŸ`);\n              // é‡æ–°è¼‰å…¥ tours\n              const store = this.getStore();\n              const tourStore = useTourStore.getState();\n              await tourStore.fetchAll();\n              return updated as Tour;\n            }\n          } else {\n            // æ‰¾åˆ°ä¸”æœªè¢«åˆªé™¤ï¼Œç›´æ¥è¿”å›\n            console.log(`âœ… [Visa Tour] æ‰¾åˆ°ç¾æœ‰ç°½è­‰åœ˜`);\n            return data as Tour;\n          }\n        }\n      }\n    } catch (error) {\n      console.warn(`âš ï¸ [Visa Tour] Supabase æŸ¥è©¢å¤±æ•—ï¼Œç¹¼çºŒå»ºç«‹æ–°çš„:`, error);\n    }\n\n    // æª¢æŸ¥æœ¬åœ° Store æ˜¯å¦æœ‰ï¼ˆæœªåˆªé™¤çš„ï¼‰\n    const allTours = await this.list();\n    const existingVisaTour = allTours.data.find(t => t.code === visaCode);\n    if (existingVisaTour) {\n      return existingVisaTour;\n    }\n\n    // ä¸å­˜åœ¨å‰‡å»ºç«‹æ–°çš„ç°½è­‰å°ˆç”¨åœ˜\n    console.log(`ğŸ“ [Visa Tour] å»ºç«‹æ–°çš„ç°½è­‰å°ˆç”¨åœ˜...`);\n    const today = new Date();\n    const yearStart = new Date(targetYear, 0, 1);\n    const departureDate = today > yearStart ? today : yearStart;\n\n    const visaTour: Partial<Tour> = {\n      code: visaCode,\n      name: `${targetYear}å¹´åº¦ç°½è­‰å°ˆç”¨åœ˜`,\n      departure_date: departureDate.toISOString().split('T')[0],\n      return_date: `${targetYear}-12-31`,\n      status: 'special',\n      location: 'ç°½è­‰å°ˆç”¨',\n      price: 0,\n      max_participants: 9999,\n      contract_status: 'pending',\n      total_revenue: 0,\n      total_cost: 0,\n      profit: 0,\n      created_at: this.now(),\n      updated_at: this.now()\n    } as any;\n\n    return await this.create(visaTour as any);\n  }\n\n  /**\n   * å–å¾—æ‰€æœ‰éç‰¹æ®Šåœ˜çš„æ—…éŠåœ˜ï¼ˆç”¨æ–¼è¡Œäº‹æ›†é¡¯ç¤ºï¼‰\n   * @returns ä¸€èˆ¬æ—…éŠåœ˜åˆ—è¡¨\n   */\n  async listRegularTours() {\n    const allTours = await this.list();\n    return {\n      ...allTours,\n      data: allTours.data.filter(tour => tour.status !== 'special')\n    };\n  }\n}\n\nexport const tourService = new TourService();","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/use-auto-create-tour-channels.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/use-cleanup-orphan-channels.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useCrudOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useCustomers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useDialog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useEnterSubmit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useOrders.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OrderStatus' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PaymentStatus' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":72,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":85},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'validateOrderData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'order' is defined but never used. Allowed unused args must match /^_/u.","line":42,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'order' is defined but never used. Allowed unused args must match /^_/u.","line":47,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2194,2197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2194,2197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3128,3131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3128,3131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useOrders - è¨‚å–®æ¥­å‹™é‚è¼¯ Hook\n */\n\nimport { useMemo } from 'react';\n\nimport { useOrderStore, useMemberStore } from '@/stores';\nimport { Order, Member, CreateOrderData, UpdateOrderData, OrderStatus, PaymentStatus } from '@/types';\n\nexport function useOrders() {\n  const orderStore = useOrderStore();\n  const memberStore = useMemberStore();\n\n  // ============================================\n  // è³‡æ–™é©—è­‰\n  // ============================================\n\n  const validateOrderData = (data: Partial<Order>): void => {\n    if (data.total_amount !== undefined && data.total_amount < 0) {\n      throw new Error('ç¸½é‡‘é¡ä¸èƒ½ç‚ºè² æ•¸');\n    }\n\n    if (data.member_count !== undefined && data.member_count < 1) {\n      throw new Error('äººæ•¸å¿…é ˆå¤§æ–¼ 0');\n    }\n\n    if (data.paid_amount !== undefined && data.total_amount !== undefined) {\n      if (data.paid_amount > data.total_amount) {\n        throw new Error('å·²ä»˜é‡‘é¡ä¸èƒ½å¤§æ–¼ç¸½é‡‘é¡');\n      }\n    }\n  };\n\n  // ============================================\n  // æ¥­å‹™é‚è¼¯\n  // ============================================\n\n  const calculateRemainingAmount = (order: Order): number => {\n    return Math.max(0, order.total_amount - order.paid_amount);\n  };\n\n  const canEditOrder = (order: Order): boolean => {\n    // Order ä»‹é¢æ²’æœ‰ status æ¬„ä½ï¼Œé è¨­éƒ½å¯ä»¥ç·¨è¼¯\n    return true;\n  };\n\n  const canCancelOrder = (order: Order): boolean => {\n    // Order ä»‹é¢æ²’æœ‰ status æ¬„ä½ï¼Œé è¨­éƒ½å¯ä»¥å–æ¶ˆ\n    return true;\n  };\n\n  const getPaymentProgress = (order: Order): number => {\n    if (order.total_amount === 0) return 0;\n    return Math.round((order.paid_amount / order.total_amount) * 100);\n  };\n\n  const updatePaymentStatus = (order: Order): 'æœªæ”¶æ¬¾' | 'éƒ¨åˆ†æ”¶æ¬¾' | 'å·²æ”¶æ¬¾' => {\n    if (order.paid_amount === 0) return 'æœªæ”¶æ¬¾';\n    if (order.paid_amount < order.total_amount) return 'éƒ¨åˆ†æ”¶æ¬¾';\n    if (order.paid_amount >= order.total_amount) return 'å·²æ”¶æ¬¾';\n    return 'æœªæ”¶æ¬¾';\n  };\n\n  // ============================================\n  // CRUD æ“ä½œ\n  // ============================================\n\n  const createOrder = async (data: Omit<CreateOrderData, 'id'>): Promise<Order> => {\n    // CreateOrderData ä½¿ç”¨ number_of_peopleï¼Œä½† Order ä½¿ç”¨ member_count\n    // CreateOrderData æœ‰ status å’Œ is_activeï¼Œä½† Order æ²’æœ‰\n    // éœ€è¦è½‰æ›æ¬„ä½\n    const orderData: any = {\n      order_number: data.code || '',\n      code: data.code || '',\n      tour_id: data.tour_id,\n      tour_name: '', // éœ€è¦å¾ tour_id æŸ¥è©¢\n      contact_person: data.contact_person,\n      sales_person: '', // CreateOrderData æ²’æœ‰é€™å€‹æ¬„ä½\n      assistant: '', // CreateOrderData æ²’æœ‰é€™å€‹æ¬„ä½\n      member_count: data.number_of_people,\n      payment_status: data.payment_status || 'unpaid',\n      total_amount: data.total_amount,\n      paid_amount: data.paid_amount,\n      remaining_amount: data.total_amount - (data.paid_amount || 0),\n    };\n\n    return await orderStore.create(orderData);\n  };\n\n  const updateOrder = async (id: string, data: UpdateOrderData): Promise<Order> => {\n    const existing = await orderStore.fetchById(id);\n    if (!existing) throw new Error('è¨‚å–®ä¸å­˜åœ¨');\n    if (!canEditOrder(existing)) throw new Error('æ­¤è¨‚å–®ç„¡æ³•ç·¨è¼¯');\n\n    // UpdateOrderData ä½¿ç”¨ number_of_peopleï¼Œä½† Order ä½¿ç”¨ member_count\n    // éœ€è¦è½‰æ›æ¬„ä½\n    const updateData: any = {};\n\n    if (data.contact_person) updateData.contact_person = data.contact_person;\n    if (data.number_of_people) updateData.member_count = data.number_of_people;\n    if (data.total_amount !== undefined) updateData.total_amount = data.total_amount;\n    if (data.paid_amount !== undefined) updateData.paid_amount = data.paid_amount;\n\n    // è½‰æ› payment_status\n    if (data.payment_status) {\n      updateData.payment_status = data.payment_status || 'unpaid';\n    }\n\n    // é‡æ–°è¨ˆç®—ä»˜æ¬¾ç‹€æ…‹\n    if (data.total_amount !== undefined || data.paid_amount !== undefined) {\n      const updated = { ...existing, ...updateData };\n      updateData.remaining_amount = calculateRemainingAmount(updated);\n      updateData.payment_status = updatePaymentStatus(updated);\n    }\n\n    return await orderStore.update(id, updateData);\n  };\n\n  const cancelOrder = async (id: string): Promise<Order> => {\n    const order = await orderStore.fetchById(id);\n    if (!order) throw new Error('è¨‚å–®ä¸å­˜åœ¨');\n    if (!canCancelOrder(order)) throw new Error('æ­¤è¨‚å–®ç„¡æ³•å–æ¶ˆ');\n\n    // Order ä»‹é¢æ²’æœ‰ status æ¬„ä½ï¼Œç„¡æ³•è¨­å®šç‚º cancelled\n    // æ”¹ç‚ºè¨­å®š payment_status æˆ–å…¶ä»–æ¬„ä½ä¾†è¡¨ç¤ºå–æ¶ˆ\n    return await orderStore.update(id, {});\n  };\n\n  // ============================================\n  // åœ˜å“¡ç®¡ç†\n  // ============================================\n\n  const getOrderMembers = async (order_id: string): Promise<Member[]> => {\n    await memberStore.fetchAll();\n    return memberStore.findByField('order_id', order_id);\n  };\n\n  const addMember = async (orderData: Member): Promise<Member> => {\n    const member = await memberStore.create(orderData);\n\n    // æ›´æ–°è¨‚å–®äººæ•¸\n    const order = await orderStore.fetchById(orderData.order_id);\n    if (order) {\n      const members = await getOrderMembers(orderData.order_id);\n      await orderStore.update(orderData.order_id, {\n        member_count: members.length,\n      });\n    }\n\n    return member;\n  };\n\n  // ============================================\n  // æŸ¥è©¢æ–¹æ³•\n  // ============================================\n\n  const getPendingOrders = useMemo(() => {\n    // Order ä»‹é¢æ²’æœ‰ status å’Œ is_active æ¬„ä½\n    return orderStore.items;\n  }, [orderStore.items]);\n\n  const getUnpaidOrders = useMemo(() => {\n    return orderStore.items.filter(o =>\n      o.payment_status === 'unpaid' || o.payment_status === 'partial'\n    );\n  }, [orderStore.items]);\n\n  const getOrdersByTour = (tour_id: string): Order[] => {\n    return orderStore.items.filter(o => o.tour_id === tour_id);\n  };\n\n  return {\n    orders: orderStore.items,\n    loading: orderStore.loading,\n    error: orderStore.error,\n\n    fetchAll: orderStore.fetchAll,\n    fetchById: orderStore.fetchById,\n    createOrder,\n    updateOrder,\n    deleteOrder: orderStore.delete,\n    cancelOrder,\n\n    canEditOrder,\n    canCancelOrder,\n    calculateRemainingAmount,\n    getPaymentProgress,\n\n    getOrderMembers,\n    addMember,\n\n    pendingOrders: getPendingOrders,\n    unpaidOrders: getUnpaidOrders,\n    getOrdersByTour,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/usePermissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useStatusBadge.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/hooks/useTours.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tour' is defined but never used. Allowed unused args must match /^_/u.","line":170,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'action' is defined but never used. Allowed unused args must match /^_/u.","line":188,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * useTours - æ—…éŠåœ˜æ¥­å‹™é‚è¼¯ Hook\n * æä¾›å®Œæ•´çš„ CRUDã€é©—è­‰ã€æ¥­å‹™é‚è¼¯\n */\n\nimport { useMemo } from 'react';\n\nimport { useTourStore } from '@/stores';\nimport { Tour, CreateTourData, UpdateTourData, TourStatus } from '@/types';\n\n/**\n * æ—…éŠåœ˜æ—¥æœŸé©—è­‰éŒ¯èª¤\n */\nclass TourDateValidationError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'TourDateValidationError';\n  }\n}\n\n/**\n * æ—…éŠåœ˜æ¬Šé™éŒ¯èª¤\n */\nclass TourPermissionError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = 'TourPermissionError';\n  }\n}\n\n/**\n * useTours Hook\n */\nexport function useTours() {\n  const store = useTourStore();\n\n  // ============================================\n  // è³‡æ–™é©—è­‰\n  // ============================================\n\n  /**\n   * é©—è­‰æ—…éŠåœ˜æ—¥æœŸ\n   */\n  const validateTourDates = (start_date: string, end_date: string): void => {\n    const start = new Date(start_date);\n    const end = new Date(end_date);\n    const now = new Date();\n\n    // æª¢æŸ¥æ—¥æœŸæ ¼å¼\n    if (isNaN(start.getTime()) || isNaN(end.getTime())) {\n      throw new TourDateValidationError('æ—¥æœŸæ ¼å¼éŒ¯èª¤');\n    }\n\n    // çµæŸæ—¥æœŸå¿…é ˆå¤§æ–¼é–‹å§‹æ—¥æœŸ\n    if (end <= start) {\n      throw new TourDateValidationError('çµæŸæ—¥æœŸå¿…é ˆæ™šæ–¼é–‹å§‹æ—¥æœŸ');\n    }\n\n    // é–‹å§‹æ—¥æœŸä¸èƒ½æ˜¯éå»ï¼ˆè‰ç¨¿ç‹€æ…‹é™¤å¤–ï¼‰\n    if (start < now) {\n      console.warn('é–‹å§‹æ—¥æœŸæ—©æ–¼ä»Šå¤©ï¼Œè«‹ç¢ºèª');\n    }\n\n    // æ—…éŠå¤©æ•¸ä¸èƒ½è¶…é 365 å¤©\n    const diffDays = Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24));\n    if (diffDays > 365) {\n      throw new TourDateValidationError('æ—…éŠå¤©æ•¸ä¸èƒ½è¶…é 365 å¤©');\n    }\n  };\n\n  /**\n   * é©—è­‰æ—…éŠåœ˜è³‡æ–™\n   */\n  const validateTourData = (data: Partial<Tour>): void => {\n    // æª¢æŸ¥å¿…å¡«æ¬„ä½\n    if (data.name && data.name.trim().length === 0) {\n      throw new Error('åœ˜åä¸èƒ½ç‚ºç©º');\n    }\n\n    if (data.location && data.location.trim().length === 0) {\n      throw new Error('ç›®çš„åœ°ä¸èƒ½ç‚ºç©º');\n    }\n\n    // æª¢æŸ¥äººæ•¸\n    if (data.max_participants !== undefined && data.max_participants < 1) {\n      throw new Error('æœ€é«˜äººæ•¸å¿…é ˆå¤§æ–¼ 0');\n    }\n\n    // æª¢æŸ¥åƒ¹æ ¼\n    if (data.price !== undefined && data.price < 0) {\n      throw new Error('åƒ¹æ ¼ä¸èƒ½ç‚ºè² æ•¸');\n    }\n\n    // æª¢æŸ¥æ—¥æœŸ\n    if (data.departure_date && data.return_date) {\n      validateTourDates(data.departure_date, data.return_date);\n    }\n  };\n\n  // ============================================\n  // æ¥­å‹™é‚è¼¯\n  // ============================================\n\n  /**\n   * è¨ˆç®—æ—…éŠå¤©æ•¸\n   */\n  const calculateDays = (start_date: string, end_date: string): number => {\n    const start = new Date(start_date);\n    const end = new Date(end_date);\n    return Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) + 1;\n  };\n\n  /**\n   * è¨ˆç®—å¤œæ•¸\n   */\n  const calculateNights = (days: number): number => {\n    return Math.max(0, days - 1);\n  };\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦å¯ä»¥ç·¨è¼¯\n   */\n  const canEditTour = (tour: Tour): boolean => {\n    // åªæœ‰ææ¡ˆå’Œé€²è¡Œä¸­çš„åœ˜å¯ä»¥ç·¨è¼¯\n    return tour.status === 'draft' || tour.status === 'active';\n  };\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦å¯ä»¥åˆªé™¤\n   */\n  const canDeleteTour = (tour: Tour): boolean => {\n    // åªæœ‰ææ¡ˆç‹€æ…‹å¯ä»¥åˆªé™¤\n    return tour.status === 'draft';\n  };\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦å¯ä»¥å–æ¶ˆ\n   */\n  const canCancelTour = (tour: Tour): boolean => {\n    // ææ¡ˆå’Œé€²è¡Œä¸­çš„åœ˜å¯ä»¥å–æ¶ˆ\n    return tour.status === 'draft' || tour.status === 'active';\n  };\n\n  /**\n   * å–å¾—ä¸‹ä¸€å€‹ç‹€æ…‹\n   */\n  const getNextStatus = (currentStatus: TourStatus): TourStatus | null => {\n    const statusFlow: Record<TourStatus, TourStatus | null> = {\n      draft: 'active',\n      active: 'pending_close',\n      pending_close: 'closed',\n      closed: null,\n      cancelled: null,\n      special: null,\n    };\n    return statusFlow[currentStatus];\n  };\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦å·²æ»¿åœ˜\n   */\n  const isFullyBooked = (tour: Tour): boolean => {\n    if (!tour.max_participants || !tour.current_participants) return false;\n    return tour.current_participants >= tour.max_participants;\n  };\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦æˆåœ˜ï¼ˆæ³¨æ„ï¼šTour é¡å‹æ²’æœ‰ min_people æ¬„ä½ï¼‰\n   */\n  const hasMetMinimum = (tour: Tour): boolean => {\n    // TODO: å¦‚æœéœ€è¦æœ€ä½æˆåœ˜äººæ•¸ï¼Œè«‹åœ¨ Tour é¡å‹ä¸­æ·»åŠ  min_participants æ¬„ä½\n    return false;\n  };\n\n  /**\n   * è¨ˆç®—å‰©é¤˜åé¡\n   */\n  const getRemainingSeats = (tour: Tour): number | null => {\n    if (!tour.max_participants) return null;\n    const current = tour.current_participants || 0;\n    return Math.max(0, tour.max_participants - current);\n  };\n\n  // ============================================\n  // æ¬Šé™æª¢æŸ¥ï¼ˆç°¡åŒ–ç‰ˆï¼Œå¯¦éš›æ‡‰å¾ auth å–å¾—ï¼‰\n  // ============================================\n\n  const hasPermission = (action: 'create' | 'update' | 'delete'): boolean => {\n    // TODO: å¾ auth store å–å¾—å¯¦éš›æ¬Šé™\n    // ç›®å‰ç°¡åŒ–ç‚ºéƒ½å…è¨±\n    return true;\n  };\n\n  // ============================================\n  // å¢å¼·çš„ CRUD æ“ä½œ\n  // ============================================\n\n  /**\n   * å»ºç«‹æ—…éŠåœ˜\n   */\n  const createTour = async (data: Omit<CreateTourData, 'id' | 'code'>): Promise<Tour> => {\n    // 1. æ¬Šé™æª¢æŸ¥\n    if (!hasPermission('create')) {\n      throw new TourPermissionError('æ²’æœ‰å»ºç«‹æ—…éŠåœ˜çš„æ¬Šé™');\n    }\n\n    // 2. è³‡æ–™é©—è­‰\n    validateTourData(data);\n\n    // 3. è¨ˆç®—å¤©æ•¸å’Œå¤œæ•¸ï¼ˆå¦‚æœéœ€è¦ï¼‰\n    // const days = calculateDays(data.departure_date, data.return_date);\n    // const nights = calculateNights(days);\n\n    // 4. çµ„åˆå®Œæ•´è³‡æ–™\n    const tourData: Omit<CreateTourData, 'code'> = {\n      ...data,\n      status: data.status || 'draft',\n    };\n\n    // 5. å‘¼å« Store\n    return await store.create(tourData as Tour);\n  };\n\n  /**\n   * æ›´æ–°æ—…éŠåœ˜\n   */\n  const updateTour = async (id: string, data: UpdateTourData): Promise<Tour> => {\n    // 1. æ¬Šé™æª¢æŸ¥\n    if (!hasPermission('update')) {\n      throw new TourPermissionError('æ²’æœ‰æ›´æ–°æ—…éŠåœ˜çš„æ¬Šé™');\n    }\n\n    // 2. æª¢æŸ¥æ—…éŠåœ˜æ˜¯å¦å­˜åœ¨\n    const existingTour = await store.fetchById(id);\n    if (!existingTour) {\n      throw new Error('æ—…éŠåœ˜ä¸å­˜åœ¨');\n    }\n\n    // 3. æª¢æŸ¥æ˜¯å¦å¯ä»¥ç·¨è¼¯\n    if (!canEditTour(existingTour)) {\n      throw new Error(`${existingTour.status} ç‹€æ…‹çš„æ—…éŠåœ˜ç„¡æ³•ç·¨è¼¯`);\n    }\n\n    // 4. è³‡æ–™é©—è­‰\n    validateTourData(data);\n\n    // 5. ç›´æ¥ä½¿ç”¨è³‡æ–™ï¼ˆä¸éœ€è¦è¨ˆç®—å¤©æ•¸ï¼‰\n    const updatedData = { ...data };\n\n    // 6. å‘¼å« Store\n    return await store.update(id, updatedData);\n  };\n\n  /**\n   * åˆªé™¤æ—…éŠåœ˜\n   */\n  const deleteTour = async (id: string): Promise<void> => {\n    // 1. æ¬Šé™æª¢æŸ¥\n    if (!hasPermission('delete')) {\n      throw new TourPermissionError('æ²’æœ‰åˆªé™¤æ—…éŠåœ˜çš„æ¬Šé™');\n    }\n\n    // 2. æª¢æŸ¥æ—…éŠåœ˜æ˜¯å¦å­˜åœ¨\n    const tour = await store.fetchById(id);\n    if (!tour) {\n      throw new Error('æ—…éŠåœ˜ä¸å­˜åœ¨');\n    }\n\n    // 3. æª¢æŸ¥æ˜¯å¦å¯ä»¥åˆªé™¤\n    if (!canDeleteTour(tour)) {\n      throw new Error(`${tour.status} ç‹€æ…‹çš„æ—…éŠåœ˜ç„¡æ³•åˆªé™¤`);\n    }\n\n    // 4. å‘¼å« Store\n    await store.delete(id);\n  };\n\n  /**\n   * å–æ¶ˆæ—…éŠåœ˜\n   */\n  const cancelTour = async (id: string): Promise<Tour> => {\n    const tour = await store.fetchById(id);\n    if (!tour) {\n      throw new Error('æ—…éŠåœ˜ä¸å­˜åœ¨');\n    }\n\n    if (!canCancelTour(tour)) {\n      throw new Error(`${tour.status} ç‹€æ…‹çš„æ—…éŠåœ˜ç„¡æ³•å–æ¶ˆ`);\n    }\n\n    return await store.update(id, { status: 'cancelled' });\n  };\n\n  /**\n   * å®Œæˆæ—…éŠåœ˜\n   */\n  const completeTour = async (id: string): Promise<Tour> => {\n    const tour = await store.fetchById(id);\n    if (!tour) {\n      throw new Error('æ—…éŠåœ˜ä¸å­˜åœ¨');\n    }\n\n    if (tour.status !== 'active') {\n      throw new Error('åªæœ‰é€²è¡Œä¸­çš„æ—…éŠåœ˜å¯ä»¥å®Œæˆ');\n    }\n\n    return await store.update(id, { status: 'pending_close' });\n  };\n\n  // ============================================\n  // æŸ¥è©¢æ–¹æ³•\n  // ============================================\n\n  /**\n   * å–å¾—é€²è¡Œä¸­çš„æ—…éŠåœ˜\n   */\n  const getActiveTours = useMemo(() => {\n    return store.items.filter((tour) => tour.status === 'active');\n  }, [store.items]);\n\n  /**\n   * å–å¾—è‰ç¨¿æ—…éŠåœ˜\n   */\n  const getDraftTours = useMemo(() => {\n    return store.items.filter((tour) => tour.status === 'draft');\n  }, [store.items]);\n\n  /**\n   * æ ¹æ“šæ—¥æœŸç¯„åœæŸ¥è©¢\n   */\n  const getToursByDateRange = (start_date: string, end_date: string): Tour[] => {\n    const start = new Date(start_date);\n    const end = new Date(end_date);\n\n    return store.items.filter((tour) => {\n      const tourStart = new Date(tour.departure_date);\n      const tourEnd = new Date(tour.return_date);\n      return tourStart <= end && tourEnd >= start;\n    });\n  };\n\n  /**\n   * æœå°‹æ—…éŠåœ˜\n   */\n  const searchTours = (keyword: string): Tour[] => {\n    const lowerKeyword = keyword.toLowerCase();\n    return store.items.filter(\n      (tour) =>\n        tour.code.toLowerCase().includes(lowerKeyword) ||\n        tour.name.toLowerCase().includes(lowerKeyword) ||\n        tour.location.toLowerCase().includes(lowerKeyword)\n    );\n  };\n\n  // ============================================\n  // è¿”å›å€¼\n  // ============================================\n\n  return {\n    // è³‡æ–™\n    tours: store.items,\n    loading: store.loading,\n    error: store.error,\n\n    // CRUD æ“ä½œ\n    fetchAll: store.fetchAll,\n    fetchById: store.fetchById,\n    createTour,\n    updateTour,\n    deleteTour,\n    cancelTour,\n    completeTour,\n\n    // æ¥­å‹™é‚è¼¯\n    canEditTour,\n    canDeleteTour,\n    canCancelTour,\n    getNextStatus,\n    isFullyBooked,\n    hasMetMinimum,\n    getRemainingSeats,\n    calculateDays,\n    calculateNights,\n\n    // æŸ¥è©¢æ–¹æ³•\n    activeTours: getActiveTours,\n    draftTours: getDraftTours,\n    getToursByDateRange,\n    searchTours,\n\n    // é©—è­‰æ–¹æ³•\n    validateTourData,\n    validateTourDates,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/auth-guard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profile' is defined but never used. Allowed unused args must match /^_/u.","line":103,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3157,3160],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3157,3160],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter, usePathname } from 'next/navigation';\nimport { useLocalAuthStore } from '@/lib/auth/local-auth-manager';\nimport { useAuthStore } from '@/stores/auth-store';\n// âš ï¸ Supabase å·²åœç”¨ - ç´”æœ¬åœ°æ¨¡å¼\n// import { supabase } from '@/lib/supabase/client';\nimport { hasPermissionForRoute } from '@/lib/permissions';\nimport { logger } from '@/lib/utils/logger';\n\ninterface AuthGuardProps {\n  children: React.ReactNode;\n  requiredPermission?: string;\n}\n\nexport function AuthGuard({ children, requiredPermission }: AuthGuardProps) {\n  const router = useRouter();\n  const pathname = usePathname();\n  const { currentProfile, setCurrentProfile, profiles } = useLocalAuthStore();\n  const { user } = useAuthStore();\n  const [isOnline, setIsOnline] = useState(typeof navigator !== 'undefined' ? navigator.onLine : true);\n\n  // ç›£è½ç¶²è·¯ç‹€æ…‹è®ŠåŒ–\n  useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  useEffect(() => {\n    const checkAuth = async () => {\n      // å¦‚æœåœ¨ç™»å…¥é é¢ï¼Œè·³éæª¢æŸ¥\n      if (pathname === '/login') {\n        return;\n      }\n\n      logger.debug('AuthGuard æª¢æŸ¥', {\n        hasCurrentProfile: !!currentProfile,\n        hasUser: !!user,\n        pathname\n      });\n\n      // 1. å„ªå…ˆæª¢æŸ¥ auth-store çš„ userï¼ˆæŒä¹…åŒ–çš„ï¼‰\n      if (user && user.id) {\n        logger.info(`å¾ auth-store æ‰¾åˆ°ç”¨æˆ¶: ${user.display_name}`);\n        // å¦‚æœ currentProfile æ²’æœ‰ï¼ŒåŒæ­¥ä¸€ä¸‹\n        if (!currentProfile) {\n          const profile = profiles.find(p => p.id === user.id);\n          if (profile) {\n            setCurrentProfile(profile);\n          }\n        }\n        return;\n      }\n\n      // 2. æª¢æŸ¥æœ¬åœ°æ˜¯å¦æœ‰ç™»å…¥çš„è§’è‰²\n      if (!currentProfile) {\n        // ğŸ“¦ ç´”æœ¬åœ°æ¨¡å¼ - æ²’æœ‰ç™»å…¥å°±å°å‘ç™»å…¥é \n        logger.warn('æ²’æœ‰ currentProfileï¼Œæ‡‰è©²è·³è½‰ç™»å…¥');\n        // æš«æ™‚åœç”¨è‡ªå‹•è·³è½‰ï¼Œé¿å…ç„¡é™å¾ªç’°\n        // router.push('/login');\n        return;\n      }\n\n      // 2. æª¢æŸ¥æ¬Šé™\n      if (requiredPermission) {\n        const hasPermission = currentProfile.permissions.includes(requiredPermission);\n\n        if (!hasPermission) {\n          logger.warn(`ç”¨æˆ¶ ${currentProfile.display_name} ç„¡æ¬Šé™è¨ªå• ${pathname}`);\n          router.push('/unauthorized');\n          return;\n        }\n      }\n\n      // 2.1 æª¢æŸ¥è·¯ç”±æ¬Šé™\n      const hasRoutePermission = hasPermissionForRoute(currentProfile.permissions, pathname);\n      if (!hasRoutePermission && pathname !== '/') {\n        logger.warn(`ç”¨æˆ¶ ${currentProfile.display_name} ç„¡æ¬Šé™è¨ªå•è·¯ç”± ${pathname}`);\n        // æš«æ™‚åœç”¨è·¯ç”±æ¬Šé™æª¢æŸ¥\n        // router.push('/');\n        return;\n      }\n\n      // 3. å¦‚æœåœ¨ç·šï¼Œå˜—è©¦åˆ·æ–° Supabase sessionï¼ˆèƒŒæ™¯åŸ·è¡Œï¼‰\n      if (isOnline && currentProfile.cachedPassword) {\n        refreshSupabaseSession(currentProfile);\n      }\n    };\n\n    checkAuth();\n  }, [currentProfile, user, isOnline, requiredPermission, pathname, router, setCurrentProfile, profiles]);\n\n  // ğŸ“¦ ç´”æœ¬åœ°æ¨¡å¼ - ç„¡éœ€åˆ·æ–° session\n  const refreshSupabaseSession = async (profile: any) => {\n    logger.debug('æœ¬åœ°æ¨¡å¼ï¼šç„¡éœ€åˆ·æ–° session');\n  };\n\n  // ç™»å…¥é é¢ä¸é¡¯ç¤ºè¼‰å…¥ç•«é¢ï¼Œç›´æ¥æ¸²æŸ“\n  if (pathname === '/login') {\n    return <>{children}</>;\n  }\n\n  // å¦‚æœæœ‰ userï¼ˆæŒä¹…åŒ–çš„ç‹€æ…‹ï¼‰ï¼Œç›´æ¥æ¸²æŸ“\n  if (user && user.id) {\n    return <>{children}</>;\n  }\n\n  // å¦‚æœæœ‰ currentProfileï¼Œç›´æ¥æ¸²æŸ“\n  if (currentProfile) {\n    return <>{children}</>;\n  }\n\n  // å¦‚æœéƒ½æ²’æœ‰ï¼Œé¡¯ç¤ºè¼‰å…¥ç•«é¢ï¼ˆå¾ˆå¿«å°±æœƒè·³è½‰åˆ°ç™»å…¥é ï¼‰\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-morandi-gold mx-auto mb-4\"></div>\n        <p className=\"text-morandi-secondary\">è¼‰å…¥ä¸­...</p>\n      </div>\n    </div>\n  );\n}\n\n/**\n * æ¬Šé™æª¢æŸ¥ Hook\n */\nexport function usePermissionCheck(requiredRoute?: string) {\n  const pathname = usePathname();\n  const { currentProfile } = useLocalAuthStore();\n\n  const checkRoute = requiredRoute || pathname;\n  const hasPermission = currentProfile ? hasPermissionForRoute(currentProfile.permissions, checkRoute) : false;\n\n  return {\n    hasPermission,\n    userPermissions: currentProfile?.permissions || [],\n    isAdmin: currentProfile?.permissions.includes('admin') || currentProfile?.permissions.includes('super_admin'),\n    isSuperAdmin: currentProfile?.permissions.includes('super_admin'),\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'jwtError' is defined but never used.","line":37,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'venturo_app_jwt_secret_key_change_in_production_2024';\n\nexport interface AuthPayload {\n  id: string;\n  employee_number: string;\n  permissions: string[];\n  role: string;\n}\n\n// ç”Ÿæˆ JWT token\nexport function generateToken(payload: AuthPayload): string {\n  try {\n    return jwt.sign(payload, JWT_SECRET, {\n      expiresIn: '8h',\n      issuer: 'venturo-app'\n    });\n  } catch (error) {\n    console.warn('JWT generation failed, using simple token', error);\n    // å¦‚æœ JWT å¤±æ•—ï¼Œä½¿ç”¨ç°¡å–®çš„ç·¨ç¢¼æ–¹æ¡ˆ\n    return btoa(JSON.stringify({\n      ...payload,\n      exp: Date.now() + 8 * 60 * 60 * 1000, // 8å°æ™‚\n      iss: 'venturo-app'\n    }));\n  }\n}\n\n// é©—è­‰ JWT token\nexport function verifyToken(token: string): AuthPayload | null {\n  try {\n    // å˜—è©¦ JWT é©—è­‰\n    const decoded = jwt.verify(token, JWT_SECRET) as AuthPayload;\n    return decoded;\n  } catch (jwtError) {\n    try {\n      // å¦‚æœ JWT å¤±æ•—ï¼Œå˜—è©¦ç°¡å–®è§£ç¢¼\n      const decoded = JSON.parse(atob(token));\n\n      // æª¢æŸ¥æ˜¯å¦éæœŸ\n      if (decoded.exp && Date.now() > decoded.exp) {\n        console.log('Token expired');\n        return null;\n      }\n\n      return decoded as AuthPayload;\n    } catch (fallbackError) {\n      console.error('Token verification failed:', fallbackError);\n      return null;\n    }\n  }\n}\n\n// åŠ å¯†å¯†ç¢¼\nexport async function hashPassword(password: string): Promise<string> {\n  const saltRounds = 12;\n  return bcrypt.hash(password, saltRounds);\n}\n\n// é©—è­‰å¯†ç¢¼\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword);\n}\n\n// å¾ token å–å¾—ç”¨æˆ¶è³‡è¨Š\nexport function getUserFromToken(token: string): AuthPayload | null {\n  return verifyToken(token);\n}\n\n// æª¢æŸ¥æ¬Šé™\nexport function hasPermission(userPermissions: string[], requiredPermission: string): boolean {\n  return userPermissions.includes(requiredPermission) ||\n         userPermissions.includes('admin'); // ç§»é™¤ super_adminï¼Œçµ±ä¸€ä½¿ç”¨ admin\n}\n\n// æª¢æŸ¥è§’è‰²\nexport function hasRole(userPermissions: string[], requiredRoles: string[]): boolean {\n  return requiredRoles.some(role => userPermissions.includes(role));\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/auth/auth-provider.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'token' is defined but never used. Allowed unused args must match /^_/u.","line":72,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":72,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { createContext, useContext, useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { logger } from '@/lib/utils/logger';\n\ninterface User {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  permissions: string[];\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isLoading: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  logout: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  user: null,\n  isLoading: true,\n  login: async () => {},\n  logout: () => {},\n});\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const router = useRouter();\n  \n  useEffect(() => {\n    // æª¢æŸ¥æ˜¯å¦æœ‰å·²ç™»å…¥çš„ session\n    const savedAuth = localStorage.getItem('auth-token');\n    if (savedAuth) {\n      // é©—è­‰ token\n      validateToken(savedAuth);\n    } else {\n      setIsLoading(false);\n    }\n  }, []);\n  \n  const login = async (email: string, password: string) => {\n    try {\n      const response = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, password })\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setUser(data.user);\n        localStorage.setItem('auth-token', data.token);\n      } else {\n        throw new Error('ç™»å…¥å¤±æ•—');\n      }\n    } catch (error) {\n      logger.error('Login error', error);\n      throw error;\n    }\n  };\n  \n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('auth-token');\n    router.push('/login');\n  };\n  \n  const validateToken = async (token: string) => {\n    // é©—è­‰ token çš„é‚è¼¯\n    try {\n      // é€™è£¡å¯ä»¥åŠ å…¥ JWT é©—è­‰æˆ– API å‘¼å«\n      // æš«æ™‚ç°¡å–®è™•ç†\n      setIsLoading(false);\n    } catch (error) {\n      logger.error('Token validation error', error);\n      setIsLoading(false);\n    }\n  };\n  \n  return (\n    <AuthContext.Provider value={{ user, isLoading, login, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n};\n\n// ä¿è­·è·¯ç”±çš„ HOC\nexport function withAuth<P extends object>(\n  Component: React.ComponentType<P>,\n  requiredRole?: string\n) {\n  return function AuthenticatedComponent(props: P) {\n    const { user, isLoading } = useAuth();\n    const router = useRouter();\n    \n    useEffect(() => {\n      // çœŸå¯¦é©—è­‰ - æ²’æœ‰ç™»å…¥å°±å°å‘ç™»å…¥é \n      if (!isLoading && !user) {\n        router.push('/login');\n      }\n      \n      if (user && requiredRole && user.role !== requiredRole) {\n        router.push('/unauthorized');\n      }\n    }, [user, isLoading, router]);\n    \n    if (isLoading) {\n      return (\n        <div className=\"flex items-center justify-center h-screen\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n        </div>\n      );\n    }\n    \n    // åªæœ‰å·²ç™»å…¥æ‰é¡¯ç¤ºçµ„ä»¶\n    if (user) {\n      return <Component {...props} />;\n    }\n    \n    return null;\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/auth/local-auth-manager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[613,616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[613,616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[631,634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[631,634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[652,655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[652,655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[671,674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[671,674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[693,696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[693,696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { logger } from '@/lib/utils/logger';\n\n// ============= 1. é¡å‹å®šç¾© =============\nexport interface LocalProfile {\n  id: string;\n  email: string;\n  employee_number: string;\n  display_name: string;\n  english_name: string;\n  role: 'SUPER_ADMIN' | 'ADMIN' | 'EMPLOYEE';\n  permissions: string[];\n  roles?: ('admin' | 'employee' | 'user' | 'tour_leader' | 'sales' | 'accountant' | 'assistant')[]; // é™„åŠ èº«ä»½æ¨™ç±¤ï¼ˆæ”¯æ´å¤šé‡è§’è‰²ï¼‰\n\n  // é›¢ç·šèªè­‰ç›¸é—œ\n  cachedPassword?: string; // åŠ å¯†çš„å¯†ç¢¼å¿«å–ï¼ˆç”¨æ–¼èƒŒæ™¯åŒæ­¥ï¼‰\n  pinHash?: string; // PIN ç¢¼çš„é›œæ¹Šå€¼\n\n  // å€‹äººè³‡è¨Š\n  personal_info?: any;\n  job_info?: any;\n  salary_info?: any;\n  contracts?: any[];\n  attendance?: any;\n\n  // å…ƒè³‡æ–™\n  lastLoginAt: string;\n  lastSyncAt?: string;\n  created_at: string;\n  status: 'active' | 'inactive' | 'suspended';\n}\n\nexport interface ProfileCard {\n  id: string;\n  display_name: string;\n  english_name: string;\n  role: string;\n  avatarUrl?: string;\n  lastLoginAt: string;\n}\n\n// ============= 2. æœ¬åœ°èªè­‰ç‹€æ…‹ç®¡ç† =============\ninterface LocalAuthState {\n  profiles: LocalProfile[];\n  currentProfile: LocalProfile | null;\n  lastSelectedProfileId: string | null;\n\n  // Profile ç®¡ç†\n  addProfile: (profile: LocalProfile) => void;\n  removeProfile: (profileId: string) => void;\n  updateProfile: (profileId: string, updates: Partial<LocalProfile>) => void;\n  getProfileById: (profileId: string) => LocalProfile | null;\n  getProfileCards: () => ProfileCard[];\n\n  // ç•¶å‰ç™»å…¥\n  setCurrentProfile: (profile: LocalProfile | null) => void;\n  getCurrentProfile: () => LocalProfile | null;\n\n  // PIN ç¢¼ç®¡ç†\n  setPinForProfile: (profileId: string, pinHash: string) => void;\n  verifyPin: (profileId: string, pin: string) => Promise<boolean>;\n\n  // æ¸…ç†\n  clearAll: () => void;\n}\n\nexport const useLocalAuthStore = create<LocalAuthState>()(\n  persist(\n    (set, get) => ({\n      profiles: [],\n      currentProfile: null,\n      lastSelectedProfileId: null,\n\n      addProfile: (profile) => {\n        set((state) => {\n          // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨\n          const exists = state.profiles.some(p => p.id === profile.id);\n          if (exists) {\n            // æ›´æ–°ç¾æœ‰çš„\n            return {\n              profiles: state.profiles.map(p =>\n                p.id === profile.id\n                  ? { ...p, ...profile, lastLoginAt: new Date().toISOString() }\n                  : p\n              )\n            };\n          }\n          // æ·»åŠ æ–°çš„\n          return {\n            profiles: [...state.profiles, { ...profile, lastLoginAt: new Date().toISOString() }]\n          };\n        });\n      },\n\n      removeProfile: (profileId) => {\n        set((state) => ({\n          profiles: state.profiles.filter(p => p.id !== profileId),\n          currentProfile: state.currentProfile?.id === profileId ? null : state.currentProfile\n        }));\n      },\n\n      updateProfile: (profileId, updates) => {\n        set((state) => ({\n          profiles: state.profiles.map(p =>\n            p.id === profileId ? { ...p, ...updates } : p\n          ),\n          currentProfile: state.currentProfile?.id === profileId\n            ? { ...state.currentProfile, ...updates }\n            : state.currentProfile\n        }));\n      },\n\n      getProfileById: (profileId) => {\n        return get().profiles.find(p => p.id === profileId) || null;\n      },\n\n      getProfileCards: () => {\n        return get().profiles.map(profile => ({\n          id: profile.id,\n          display_name: profile.display_name,\n          english_name: profile.english_name,\n          role: profile.role,\n          lastLoginAt: profile.lastLoginAt\n        }));\n      },\n\n      setCurrentProfile: (profile) => {\n        // åŒæ™‚å„²å­˜åˆ° localStorage\n        if (profile) {\n          localStorage.setItem('current-profile-id', profile.id);\n        } else {\n          localStorage.removeItem('current-profile-id');\n        }\n\n        set({\n          currentProfile: profile,\n          lastSelectedProfileId: profile?.id || null\n        });\n\n        // æ›´æ–°æœ€å¾Œç™»å…¥æ™‚é–“\n        if (profile) {\n          get().updateProfile(profile.id, {\n            lastLoginAt: new Date().toISOString()\n          });\n        }\n      },\n\n      getCurrentProfile: () => get().currentProfile,\n\n      setPinForProfile: (profileId, pinHash) => {\n        get().updateProfile(profileId, { pinHash });\n      },\n\n      verifyPin: async (profileId, pin) => {\n        const profile = get().getProfileById(profileId);\n        if (!profile || !profile.pinHash) {\n          return false;\n        }\n\n        // ä½¿ç”¨ bcrypt é©—è­‰ PIN\n        try {\n          const bcrypt = (await import('bcryptjs')).default;\n          return await bcrypt.compare(pin, profile.pinHash);\n        } catch (error) {\n          logger.error('PIN é©—è­‰å¤±æ•—', error);\n          return false;\n        }\n      },\n\n      clearAll: () => {\n        localStorage.removeItem('current-profile-id');\n        set({ profiles: [], currentProfile: null, lastSelectedProfileId: null });\n      }\n    }),\n    {\n      name: 'local-auth-storage',\n      version: 1,\n      partialize: (state) => ({\n        profiles: state.profiles,\n        currentProfile: state.currentProfile,  // é‡è¦ï¼ç¢ºä¿æŒä¹…åŒ–\n        lastSelectedProfileId: state.lastSelectedProfileId\n      })\n    }\n  )\n);\n\n// ============= 3. å¯†ç¢¼åŠ å¯†å·¥å…· =============\nexport class PasswordEncryption {\n  private static readonly ENCRYPTION_KEY = 'venturo-offline-auth-2024';\n\n  /**\n   * ç°¡å–®çš„å¯†ç¢¼åŠ å¯†ï¼ˆç”¨æ–¼æœ¬åœ°å¿«å–ï¼‰\n   * æ³¨æ„ï¼šé€™ä¸æ˜¯é«˜å¼·åº¦åŠ å¯†ï¼Œåƒ…ç”¨æ–¼é˜²æ­¢æ˜æ–‡å„²å­˜\n   */\n  static async encrypt(password: string): Promise<string> {\n    try {\n      // ä½¿ç”¨ Web Crypto API\n      const encoder = new TextEncoder();\n      const data = encoder.encode(password);\n      const key = encoder.encode(this.ENCRYPTION_KEY);\n\n      // ç°¡å–®çš„ XOR åŠ å¯†\n      const encrypted = new Uint8Array(data.length);\n      for (let i = 0; i < data.length; i++) {\n        encrypted[i] = data[i] ^ key[i % key.length];\n      }\n\n      return btoa(String.fromCharCode(...encrypted));\n    } catch (error) {\n      logger.error('åŠ å¯†å¤±æ•—', error);\n      return btoa(password); // é™ç´šæ–¹æ¡ˆ\n    }\n  }\n\n  /**\n   * è§£å¯†å¯†ç¢¼\n   */\n  static async decrypt(encryptedPassword: string): Promise<string> {\n    try {\n      const encoder = new TextEncoder();\n      const key = encoder.encode(this.ENCRYPTION_KEY);\n      const encrypted = Uint8Array.from(atob(encryptedPassword), c => c.charCodeAt(0));\n\n      // XOR è§£å¯†\n      const decrypted = new Uint8Array(encrypted.length);\n      for (let i = 0; i < encrypted.length; i++) {\n        decrypted[i] = encrypted[i] ^ key[i % key.length];\n      }\n\n      const decoder = new TextDecoder();\n      return decoder.decode(decrypted);\n    } catch (error) {\n      logger.error('è§£å¯†å¤±æ•—', error);\n      return atob(encryptedPassword); // é™ç´šæ–¹æ¡ˆ\n    }\n  }\n\n  /**\n   * ç”Ÿæˆ PIN ç¢¼é›œæ¹Š\n   */\n  static async hashPin(pin: string): Promise<string> {\n    const bcrypt = (await import('bcryptjs')).default;\n    return bcrypt.hash(pin, 10);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/cache/cache-strategy.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[285,288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[285,288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'compress' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":88,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5563,5566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5563,5566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5824,5827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5824,5827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":264,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6097,6100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6097,6100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * VENTURO 5.0 - çµ±ä¸€å¿«å–ç­–ç•¥\n *\n * ä¸‰å±¤å¿«å–æ¶æ§‹ï¼š\n * - L1 (ç†±å¿«å–): Memory - ç•¶å‰é é¢æ­£åœ¨ä½¿ç”¨çš„è³‡æ–™\n * - L2 (æº«å¿«å–): SessionStorage - è·¨é é¢å¯èƒ½ä½¿ç”¨çš„è³‡æ–™\n * - L3 (å†·å¿«å–): IndexedDB - æŒä¹…åŒ–å‚™ä»½è³‡æ–™\n */\n\nimport { localDB } from '@/lib/db';\nimport { logger } from '@/lib/utils/logger';\n\ntype CacheKey = string;\ntype CacheValue = any;\n\ninterface CacheOptions {\n  /** å¿«å–å±¤ç´š */\n  level?: 'hot' | 'warm' | 'cold';\n  /** éæœŸæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰ï¼Œ0 è¡¨ç¤ºæ°¸ä¸éæœŸ */\n  ttl?: number;\n  /** æ˜¯å¦å£“ç¸®å„²å­˜ï¼ˆé‡å°å¤§å‹è³‡æ–™ï¼‰ */\n  compress?: boolean;\n}\n\ninterface CacheEntry {\n  value: CacheValue;\n  timestamp: number;\n  ttl: number;\n}\n\nclass CacheStrategy {\n  // L1: ç†±å¿«å– - è¨˜æ†¶é«”ï¼ˆä¸éæœŸï¼Œé é¢é—œé–‰å³æ¸…é™¤ï¼‰\n  private hotCache = new Map<CacheKey, CacheEntry>();\n\n  // L2: æº«å¿«å– - SessionStorageï¼ˆç€è¦½å™¨é—œé–‰æ‰æ¸…é™¤ï¼‰\n  private warmCacheKey = 'venturo-warm-cache';\n\n  // L3: å†·å¿«å–ä½¿ç”¨ IndexedDBï¼ˆå·²åœ¨ localDB ä¸­å¯¦ä½œï¼‰\n\n  /**\n   * ç²å–å¿«å–è³‡æ–™\n   * è‡ªå‹•ä¾åºæŸ¥æ‰¾ï¼šç†± â†’ æº« â†’ å†·\n   */\n  async get<T = CacheValue>(key: CacheKey): Promise<T | null> {\n    // 1. æŸ¥æ‰¾ç†±å¿«å–\n    const hotEntry = this.hotCache.get(key);\n    if (hotEntry && !this.isExpired(hotEntry)) {\n      return hotEntry.value as T;\n    }\n\n    // 2. æŸ¥æ‰¾æº«å¿«å–\n    const warmEntry = this.getFromSessionStorage(key);\n    if (warmEntry && !this.isExpired(warmEntry)) {\n      // æå‡åˆ°ç†±å¿«å–\n      this.hotCache.set(key, warmEntry);\n      return warmEntry.value as T;\n    }\n\n    // 3. æŸ¥æ‰¾å†·å¿«å–ï¼ˆIndexedDBï¼‰\n    try {\n      const coldValue = await this.getFromIndexedDB(key);\n      if (coldValue !== null) {\n        // æå‡åˆ°ç†±å¿«å–å’Œæº«å¿«å–\n        const entry: CacheEntry = {\n          value: coldValue,\n          timestamp: Date.now(),\n          ttl: 0 // IndexedDB çš„è³‡æ–™ä¸è¨­éæœŸ\n        };\n        this.hotCache.set(key, entry);\n        this.setToSessionStorage(key, entry);\n        return coldValue as T;\n      }\n    } catch (error) {\n      logger.warn(`å¾ IndexedDB è®€å–å¿«å–å¤±æ•—: ${key}`, error);\n    }\n\n    return null;\n  }\n\n  /**\n   * è¨­å®šå¿«å–è³‡æ–™\n   */\n  async set(\n    key: CacheKey,\n    value: CacheValue,\n    options: CacheOptions = {}\n  ): Promise<void> {\n    const { level = 'hot', ttl = 0, compress = false } = options;\n\n    const entry: CacheEntry = {\n      value,\n      timestamp: Date.now(),\n      ttl\n    };\n\n    // æ ¹æ“šå±¤ç´šå„²å­˜\n    switch (level) {\n      case 'hot':\n        // åªå­˜è¨˜æ†¶é«”\n        this.hotCache.set(key, entry);\n        break;\n\n      case 'warm':\n        // å­˜è¨˜æ†¶é«” + SessionStorage\n        this.hotCache.set(key, entry);\n        this.setToSessionStorage(key, entry);\n        break;\n\n      case 'cold':\n        // å­˜æ‰€æœ‰ä¸‰å±¤\n        this.hotCache.set(key, entry);\n        this.setToSessionStorage(key, entry);\n        await this.setToIndexedDB(key, value);\n        break;\n    }\n  }\n\n  /**\n   * åˆªé™¤å¿«å–\n   */\n  async delete(key: CacheKey): Promise<void> {\n    // å¾æ‰€æœ‰å±¤ç´šåˆªé™¤\n    this.hotCache.delete(key);\n    this.deleteFromSessionStorage(key);\n    await this.deleteFromIndexedDB(key);\n  }\n\n  /**\n   * æ¸…é™¤ç‰¹å®šå±¤ç´šçš„æ‰€æœ‰å¿«å–\n   */\n  async clear(level?: 'hot' | 'warm' | 'cold'): Promise<void> {\n    if (!level || level === 'hot') {\n      this.hotCache.clear();\n    }\n\n    if (!level || level === 'warm') {\n      this.clearSessionStorage();\n    }\n\n    if (!level || level === 'cold') {\n      // IndexedDB çš„æ¸…é™¤ç”± localDB ç®¡ç†\n      // é€™è£¡ä¸ä¸»å‹•æ¸…é™¤ï¼Œå› ç‚ºé‚£æ˜¯æŒä¹…åŒ–è³‡æ–™\n    }\n  }\n\n  /**\n   * ç²å–å¿«å–çµ±è¨ˆè³‡è¨Š\n   */\n  getStats() {\n    const warmCache = this.getAllFromSessionStorage();\n\n    return {\n      hot: {\n        size: this.hotCache.size,\n        keys: Array.from(this.hotCache.keys())\n      },\n      warm: {\n        size: Object.keys(warmCache).length,\n        keys: Object.keys(warmCache)\n      }\n    };\n  }\n\n  // ==================== ç§æœ‰æ–¹æ³• ====================\n\n  /**\n   * æª¢æŸ¥å¿«å–æ˜¯å¦éæœŸ\n   */\n  private isExpired(entry: CacheEntry): boolean {\n    if (entry.ttl === 0) return false;\n    return Date.now() - entry.timestamp > entry.ttl;\n  }\n\n  /**\n   * SessionStorage æ“ä½œ\n   */\n  private getFromSessionStorage(key: CacheKey): CacheEntry | null {\n    if (typeof window === 'undefined') return null;\n\n    try {\n      const warmCache = sessionStorage.getItem(this.warmCacheKey);\n      if (!warmCache) return null;\n\n      const cache = JSON.parse(warmCache);\n      return cache[key] || null;\n    } catch {\n      return null;\n    }\n  }\n\n  private setToSessionStorage(key: CacheKey, entry: CacheEntry): void {\n    if (typeof window === 'undefined') return;\n\n    try {\n      const warmCache = sessionStorage.getItem(this.warmCacheKey);\n      const cache = warmCache ? JSON.parse(warmCache) : {};\n      cache[key] = entry;\n      sessionStorage.setItem(this.warmCacheKey, JSON.stringify(cache));\n    } catch (error) {\n      logger.warn('SessionStorage å¯«å…¥å¤±æ•—ï¼Œå¯èƒ½ç©ºé–“ä¸è¶³', error);\n    }\n  }\n\n  private deleteFromSessionStorage(key: CacheKey): void {\n    if (typeof window === 'undefined') return;\n\n    try {\n      const warmCache = sessionStorage.getItem(this.warmCacheKey);\n      if (!warmCache) return;\n\n      const cache = JSON.parse(warmCache);\n      delete cache[key];\n      sessionStorage.setItem(this.warmCacheKey, JSON.stringify(cache));\n    } catch {\n      // å¿½ç•¥éŒ¯èª¤\n    }\n  }\n\n  private clearSessionStorage(): void {\n    if (typeof window === 'undefined') return;\n    sessionStorage.removeItem(this.warmCacheKey);\n  }\n\n  private getAllFromSessionStorage(): Record<string, CacheEntry> {\n    if (typeof window === 'undefined') return {};\n\n    try {\n      const warmCache = sessionStorage.getItem(this.warmCacheKey);\n      return warmCache ? JSON.parse(warmCache) : {};\n    } catch {\n      return {};\n    }\n  }\n\n  /**\n   * IndexedDB æ“ä½œ\n   */\n  private async getFromIndexedDB(key: CacheKey): Promise<CacheValue | null> {\n    if (typeof window === 'undefined') return null;\n\n    try {\n      // ä½¿ç”¨ç‰¹æ®Šçš„ cache è¡¨\n      const value = await localDB.read('cache' as any, key);\n      return value || null;\n    } catch {\n      return null;\n    }\n  }\n\n  private async setToIndexedDB(key: CacheKey, value: CacheValue): Promise<void> {\n    if (typeof window === 'undefined') return;\n\n    try {\n      await localDB.create('cache' as any, { id: key, data: value });\n    } catch (error) {\n      logger.warn('IndexedDB å¯«å…¥å¤±æ•—', error);\n    }\n  }\n\n  private async deleteFromIndexedDB(key: CacheKey): Promise<void> {\n    if (typeof window === 'undefined') return;\n\n    try {\n      await localDB.delete('cache' as any, key);\n    } catch {\n      // å¿½ç•¥éŒ¯èª¤\n    }\n  }\n}\n\n// åŒ¯å‡ºå–®ä¾‹\nexport const cacheStrategy = new CacheStrategy();\n\n// åŒ¯å‡ºé¡å‹\nexport type { CacheKey, CacheValue, CacheOptions };\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/cache/memory-cache.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[172,175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[172,175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * L1 Memory Cache - LRU å¿«å–å¯¦ä½œ\n * æ ¹æ“š VENTURO 5.2.0 æ‰‹å†Šçš„ä¸‰å±¤å¿«å–ç­–ç•¥\n */\n\ninterface CacheItem<T> {\n  value: T;\n  timestamp: number;\n  hits: number;\n}\n\nexport class LRUCache<T = any> {\n  private cache: Map<string, CacheItem<T>> = new Map();\n  private maxSize: number;\n  private ttl: number;\n\n  constructor(\n    maxSize: number = 100, // æœ€å¤š 100 å€‹é …ç›®\n    ttl: number = 10000 // 10 ç§’ TTL\n  ) {\n    this.maxSize = maxSize;\n    this.ttl = ttl;\n  }\n\n  /**\n   * å–å¾—å¿«å–è³‡æ–™\n   */\n  get(key: string): T | null {\n    const item = this.cache.get(key);\n\n    if (!item) {\n      return null;\n    }\n\n    // æª¢æŸ¥æ˜¯å¦éæœŸ\n    const now = Date.now();\n    if (now - item.timestamp > this.ttl) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    // LRU: æ›´æ–°ä½ç½®ï¼ˆç§»åˆ°æœ€å¾Œ = æœ€è¿‘ä½¿ç”¨ï¼‰\n    item.hits++;\n    this.cache.delete(key);\n    this.cache.set(key, item);\n\n    return item.value;\n  }\n\n  /**\n   * è¨­å®šå¿«å–è³‡æ–™\n   */\n  set(key: string, value: T): void {\n    // å¦‚æœå·²é”ä¸Šé™ï¼Œåˆªé™¤æœ€ä¹…æœªä½¿ç”¨çš„é …ç›®ï¼ˆç¬¬ä¸€å€‹ï¼‰\n    if (this.cache.size >= this.maxSize && !this.cache.has(key)) {\n      const firstKey = this.cache.keys().next().value as string;\n      this.cache.delete(firstKey);\n    }\n\n    this.cache.set(key, {\n      value,\n      timestamp: Date.now(),\n      hits: 0,\n    });\n  }\n\n  /**\n   * åˆªé™¤ç‰¹å®šå¿«å–\n   */\n  delete(key: string): boolean {\n    return this.cache.delete(key);\n  }\n\n  /**\n   * æ¸…ç©ºæ‰€æœ‰å¿«å–\n   */\n  clear(): void {\n    this.cache.clear();\n  }\n\n  /**\n   * å–å¾—å¿«å–çµ±è¨ˆ\n   */\n  getStats() {\n    const items = Array.from(this.cache.values());\n    return {\n      size: this.cache.size,\n      maxSize: this.maxSize,\n      ttl: this.ttl,\n      totalHits: items.reduce((sum, item) => sum + item.hits, 0),\n      avgHits: items.length > 0\n        ? items.reduce((sum, item) => sum + item.hits, 0) / items.length\n        : 0,\n    };\n  }\n\n  /**\n   * æ‰¹æ¬¡åˆªé™¤ï¼ˆæ ¹æ“š patternï¼‰\n   */\n  invalidatePattern(pattern: string): number {\n    let count = 0;\n    for (const key of this.cache.keys()) {\n      if (key.startsWith(pattern)) {\n        this.cache.delete(key);\n        count++;\n      }\n    }\n    return count;\n  }\n}\n\n// å…¨åŸŸ Memory Cache å¯¦ä¾‹\nexport const memoryCache = new LRUCache();\n\n// å¿«å– key ç”¢ç”Ÿå™¨\nexport const cacheKeys = {\n  tour: (id: string) => `tour:${id}`,\n  tourList: (filter?: string) => `tours:list:${filter || 'all'}`,\n  order: (id: string) => `order:${id}`,\n  orderList: (tour_id?: string) => `orders:list:${tour_id || 'all'}`,\n  customer: (id: string) => `customer:${id}`,\n  customerList: () => `customers:list`,\n  payment: (id: string) => `payment:${id}`,\n  paymentList: (order_id?: string) => `payments:list:${order_id || 'all'}`,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/data/create-data-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/database-initializer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5799,5802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5799,5802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * è³‡æ–™åº«åˆå§‹åŒ–ç³»çµ±\n *\n * ç¢ºä¿ IndexedDB åœ¨æ‡‰ç”¨å•Ÿå‹•æ™‚æœ‰å¿…è¦çš„è³‡æ–™\n * è™•ç†å¾èˆŠç‰ˆ LocalProfile é·ç§»åˆ°æ–°ç‰ˆ IndexedDB\n */\n\nimport { localDB } from '@/lib/db';\nimport { Employee as User } from '@/stores/types';\n\nexport class DatabaseInitializer {\n  /**\n   * ä¸»å…¥å£ï¼šç¢ºä¿è³‡æ–™åº«å·²åˆå§‹åŒ–\n   */\n  static async ensureInitialized(): Promise<void> {\n    try {\n      console.log('ğŸ” æª¢æŸ¥è³‡æ–™åº«åˆå§‹åŒ–ç‹€æ…‹...');\n\n      // 1. æª¢æŸ¥ users è¡¨\n      const userCount = await this.checkUsersTable();\n\n      if (userCount === 0) {\n        console.log('ğŸ“¦ è³‡æ–™åº«ç‚ºç©ºï¼Œé–‹å§‹åˆå§‹åŒ–...');\n        await this.initializeDatabase();\n      } else {\n        console.log(`âœ… è³‡æ–™åº«å·²æœ‰ ${userCount} ä½ä½¿ç”¨è€…ï¼Œç„¡éœ€åˆå§‹åŒ–`);\n      }\n\n    } catch (error) {\n      console.error('âŒ è³‡æ–™åº«åˆå§‹åŒ–å¤±æ•—:', error);\n      // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œè®“æ‡‰ç”¨ç¹¼çºŒé‹è¡Œ\n    }\n  }\n\n  /**\n   * æª¢æŸ¥ employees è¡¨ç‹€æ…‹\n   */\n  private static async checkUsersTable(): Promise<number> {\n    try {\n      const users = await localDB.getAll<User>('employees');\n      return Array.isArray(users) ? users.length : 0;\n    } catch (error) {\n      console.warn('âš ï¸ ç„¡æ³•æª¢æŸ¥ employees è¡¨:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * åˆå§‹åŒ–è³‡æ–™åº«\n   *\n   * å„ªå…ˆé †åºï¼š\n   * 1. å˜—è©¦å¾ LocalProfile é·ç§»\n   * 2. å¦‚æœæ²’æœ‰ LocalProfileï¼Œå»ºç«‹é è¨­ç®¡ç†å“¡\n   */\n  private static async initializeDatabase(): Promise<void> {\n    // Step 1: å˜—è©¦å¾ LocalProfile é·ç§»\n    const migratedCount = await this.migrateFromLocalProfile();\n\n    if (migratedCount > 0) {\n      console.log(`âœ… å¾ LocalProfile é·ç§»äº† ${migratedCount} ä½ä½¿ç”¨è€…`);\n      return;\n    }\n\n    // Step 2: æ²’æœ‰ LocalProfileï¼Œå»ºç«‹é è¨­ç®¡ç†å“¡\n    console.log('â• å»ºç«‹é è¨­ç®¡ç†å“¡å¸³è™Ÿ...');\n    await this.createDefaultAdmin();\n  }\n\n  /**\n   * å¾ LocalProfile (localStorage) é·ç§»åˆ° IndexedDB\n   */\n  private static async migrateFromLocalProfile(): Promise<number> {\n    try {\n      // è®€å– localStorage ä¸­çš„ LocalProfile\n      const authStoreRaw = localStorage.getItem('venturo-local-auth-store');\n      if (!authStoreRaw) {\n        console.log('ğŸ“ æ²’æœ‰æ‰¾åˆ° LocalProfile è³‡æ–™');\n        return 0;\n      }\n\n      const authStore = JSON.parse(authStoreRaw);\n      const profiles = authStore?.state?.profiles || [];\n\n      if (profiles.length === 0) {\n        console.log('ğŸ“ LocalProfile ç‚ºç©º');\n        return 0;\n      }\n\n      console.log(`ğŸ”„ ç™¼ç¾ ${profiles.length} å€‹ LocalProfileï¼Œé–‹å§‹é·ç§»...`);\n\n      let migratedCount = 0;\n\n      for (const profile of profiles) {\n        try {\n          // å°‡ LocalProfile è½‰æ›ç‚ºå®Œæ•´ User\n          const user: User = {\n            id: profile.id || crypto.randomUUID(),\n            employee_number: profile.employee_number,\n            display_name: profile.display_name || '',\n            english_name: profile.english_name || '',\n            chinese_name: profile.display_name || '',\n            permissions: profile.permissions || [],\n            personal_info: {\n              national_id: '',\n              birthday: '',\n              phone: '',\n              email: profile.email || '',\n              address: '',\n              emergency_contact: { name: '', relationship: '', phone: '' }\n            },\n            job_info: {\n              hire_date: new Date().toISOString()\n            },\n            salary_info: {\n              base_salary: 0,\n              allowances: [],\n              salary_history: []\n            },\n            attendance: {\n              leave_records: [],\n              overtime_records: []\n            },\n            contracts: [],\n            status: 'active',\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          };\n\n          await localDB.create<User>('employees', user);\n          migratedCount++;\n          console.log(`  âœ… é·ç§»: ${user.employee_number} - ${user.display_name}`);\n\n        } catch (error) {\n          console.warn(`  âš ï¸ é·ç§»å¤±æ•—: ${profile.employee_number}`, error);\n        }\n      }\n\n      return migratedCount;\n\n    } catch (error) {\n      console.warn('âš ï¸ LocalProfile é·ç§»å¤±æ•—:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * å»ºç«‹é è¨­ç®¡ç†å“¡å¸³è™Ÿ (William)\n   */\n  private static async createDefaultAdmin(): Promise<void> {\n    try {\n      // å…ˆæª¢æŸ¥æ˜¯å¦å·²ç¶“å­˜åœ¨\n      const existing = await localDB.getAll<User>('employees');\n      const hasWilliam = existing?.some(u => u.employee_number === 'william01');\n\n      if (hasWilliam) {\n        console.log('âœ… william01 å·²å­˜åœ¨ï¼Œè·³éå»ºç«‹');\n        return;\n      }\n\n      const adminUser: User = {\n        id: crypto.randomUUID(),\n        employee_number: 'william01',\n        display_name: 'William Chien',\n        english_name: 'William Chien',\n        chinese_name: 'ç°¡å¨å»‰',\n        permissions: [\n          'super_admin',\n          'admin',\n          'tours',\n          'orders',\n          'quotes',\n          'finance',\n          'hr',\n          'database',\n          'reports',\n          'settings'\n        ],\n        personal_info: {\n          national_id: '',\n          birthday: '',\n          phone: '',\n          email: 'william@venturo.com',\n          address: '',\n          emergency_contact: { name: '', relationship: '', phone: '' }\n        },\n        job_info: {\n          hire_date: new Date().toISOString()\n        },\n        salary_info: {\n          base_salary: 0,\n          allowances: [],\n          salary_history: []\n        },\n        attendance: {\n          leave_records: [],\n          overtime_records: []\n        },\n        contracts: [],\n        status: 'active',\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      };\n\n      await localDB.create<User>('employees', adminUser);\n      console.log(`âœ… å»ºç«‹é è¨­ç®¡ç†å“¡: william01`);\n      console.log(`   å¯†ç¢¼: Venturo2025!`);\n    } catch (error) {\n      console.warn('âš ï¸ å»ºç«‹é è¨­ç®¡ç†å“¡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n      // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œå¯èƒ½å·²ç¶“å­˜åœ¨\n    }\n  }\n\n  /**\n   * æ‰‹å‹•è§¸ç™¼åˆå§‹åŒ–ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–ä¿®å¾©ï¼‰\n   */\n  static async forceInitialize(): Promise<void> {\n    console.log('ğŸ”§ å¼·åˆ¶åˆå§‹åŒ–è³‡æ–™åº«...');\n    await this.initializeDatabase();\n  }\n}\n\n// ç€è¦½å™¨ç’°å¢ƒä¸­æä¾›å…¨åŸŸè¨ªå•\nif (typeof window !== 'undefined') {\n  (window as any).DatabaseInitializer = DatabaseInitializer;\n  console.log('ğŸ’¡ DatabaseInitializer å·²è¼‰å…¥');\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1597,1600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1597,1600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6309,6312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6309,6312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-async-promise-executor","severity":1,"message":"Promise executor functions should not be async.","line":284,"column":24,"nodeType":"Identifier","messageId":"async","endLine":284,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":399,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10740,10743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10740,10743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":485,"column":28,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":485,"endColumn":44},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":486,"column":28,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":486,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":561,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":561,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15034,15037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15034,15037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":561,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":561,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15061,15064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15061,15064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":563,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15123,15126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15123,15126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":563,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15151,15154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15151,15154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":565,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15212,15215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15212,15215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":565,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":565,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15239,15242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15239,15242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":567,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":567,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15301,15304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15301,15304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":567,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":567,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15329,15332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15329,15332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * IndexedDB æœ¬åœ°è³‡æ–™åº«ç®¡ç†å™¨\n * æä¾›å®Œæ•´çš„ CRUD æ“ä½œå’ŒæŸ¥è©¢åŠŸèƒ½\n */\n\nimport { handleUpgrade, clearAllTables, exportData, importData } from './migrations';\nimport { DB_NAME, DB_VERSION, TableName } from './schemas';\nimport { checkAndHandleVersion } from './version-manager';\n\n// Re-export TableName for external use\nexport type { TableName };\n\n/**\n * æŸ¥è©¢é¸é …\n */\nexport interface QueryOptions {\n  limit?: number;\n  offset?: number;\n  orderBy?: string;\n  direction?: 'asc' | 'desc';\n}\n\n/**\n * éæ¿¾æ¢ä»¶\n */\nexport interface FilterCondition {\n  field: string;\n  operator: 'eq' | 'ne' | 'gt' | 'gte' | 'lt' | 'lte' | 'contains';\n  value: unknown;\n}\n\n/**\n * LocalDatabase é¡åˆ¥\n * ç®¡ç†æ‰€æœ‰ IndexedDB æ“ä½œ\n */\nexport class LocalDatabase {\n  private db: IDBDatabase | null = null;\n  private initPromise: Promise<IDBDatabase> | null = null;\n\n  /**\n   * Put è³‡æ–™ï¼ˆæ›´æ–°æˆ–æ–°å¢ï¼‰\n   * å¦‚æœ ID å­˜åœ¨å‰‡æ›´æ–°ï¼Œä¸å­˜åœ¨å‰‡æ–°å¢\n   */\n  async put<T extends { id: string }>(\n    tableName: TableName,\n    data: T\n  ): Promise<T> {\n    try {\n      const db = await this.ensureInit();\n\n      // æª¢æŸ¥ tableName æ˜¯å¦æœ‰æ•ˆ\n      if (!db.objectStoreNames.contains(tableName)) {\n        console.error(`[LocalDB] è³‡æ–™è¡¨ä¸å­˜åœ¨: ${tableName}`);\n        console.log('å¯ç”¨çš„è³‡æ–™è¡¨:', Array.from(db.objectStoreNames));\n        throw new Error(`è³‡æ–™è¡¨ä¸å­˜åœ¨: ${tableName}`);\n      }\n\n      return new Promise((resolve, reject) => {\n        const transaction = db.transaction(tableName, 'readwrite');\n        const objectStore = transaction.objectStore(tableName);\n\n        // åŠ å…¥æ™‚é–“æˆ³\n        const now = new Date().toISOString();\n        const recordWithTimestamp = {\n          ...data,\n          created_at: (data as any).created_at || now,\n          updated_at: now,\n        } as T;\n\n        const request = objectStore.put(recordWithTimestamp);\n\n        request.onsuccess = () => {\n          resolve(recordWithTimestamp);\n        };\n\n        request.onerror = () => {\n          const error = new Error(\n            `Put è³‡æ–™å¤±æ•— (${tableName}): ${request.error?.message}`\n          );\n          console.error('[LocalDB]', error);\n          reject(error);\n        };\n      });\n    } catch (error) {\n      console.error('[LocalDB] put æ–¹æ³•éŒ¯èª¤:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * åˆå§‹åŒ–è³‡æ–™åº«\n   */\n  async init(): Promise<IDBDatabase> {\n    console.log('[LocalDB] init() é–‹å§‹åŸ·è¡Œ');\n\n    // ğŸ”’ æª¢æŸ¥æ˜¯å¦åœ¨ç€è¦½å™¨ç’°å¢ƒ\n    if (typeof window === 'undefined' || typeof indexedDB === 'undefined') {\n      const error = new Error('IndexedDB ä¸å¯ç”¨ï¼ˆéç€è¦½å™¨ç’°å¢ƒï¼‰');\n      console.warn('[LocalDB]', error.message);\n      throw error;\n    }\n\n    // å¦‚æœå·²ç¶“åˆå§‹åŒ–ï¼Œç›´æ¥è¿”å›\n    if (this.db) {\n      console.log('[LocalDB] è³‡æ–™åº«å·²åˆå§‹åŒ–ï¼Œç›´æ¥è¿”å›');\n      return this.db;\n    }\n\n    // å¦‚æœæ­£åœ¨åˆå§‹åŒ–ï¼Œç­‰å¾…å®Œæˆ\n    if (this.initPromise) {\n      console.log('[LocalDB] æ­£åœ¨åˆå§‹åŒ–ä¸­ï¼Œç­‰å¾…å®Œæˆ');\n      return this.initPromise;\n    }\n\n    // âœ¨ æª¢æŸ¥ç‰ˆæœ¬ä¸¦è™•ç†å‡ç´šï¼ˆå¦‚æœ‰éœ€è¦ï¼‰\n    try {\n      const needsSync = await checkAndHandleVersion();\n      if (needsSync) {\n        console.log('[LocalDB] âš ï¸ ç‰ˆæœ¬å·²å‡ç´šï¼Œç¨å¾Œéœ€è¦å¾ Supabase é‡æ–°åŒæ­¥è³‡æ–™');\n        // æ³¨æ„ï¼šå¯¦éš›åŒæ­¥æœƒç”± stores çš„ fetchAll() è§¸ç™¼\n      }\n    } catch (error) {\n      console.error('[LocalDB] ç‰ˆæœ¬æª¢æŸ¥å¤±æ•—:', error);\n      // ä¸é˜»æ“‹åˆå§‹åŒ–ï¼Œç¹¼çºŒåŸ·è¡Œ\n    }\n\n    // é–‹å§‹åˆå§‹åŒ–\n    console.log(`[LocalDB] é–‹å§‹åˆå§‹åŒ–è³‡æ–™åº«: ${DB_NAME} v${DB_VERSION}`);\n    this.initPromise = new Promise((resolve, reject) => {\n      // ğŸ”¥ é—œéµä¿®æ­£ï¼šå»¶é²åŸ·è¡Œç¢ºä¿ç’°å¢ƒå°±ç·’\n      setTimeout(() => {\n        try {\n          console.log('[LocalDB] å‘¼å« indexedDB.open()');\n          const request = indexedDB.open(DB_NAME, DB_VERSION);\n          console.log('[LocalDB] indexedDB.open() è¿”å›:', request);\n\n        request.onerror = (event) => {\n          const error = new Error(\n            `ç„¡æ³•é–‹å•Ÿè³‡æ–™åº«: ${request.error?.message || 'æœªçŸ¥éŒ¯èª¤'}`\n          );\n          console.error('[LocalDB] request.onerror è§¸ç™¼:', error, event);\n          this.initPromise = null; // æ¸…é™¤å¤±æ•—çš„ Promise\n          reject(error);\n        };\n\n        request.onsuccess = (event) => {\n          console.log('[LocalDB] request.onsuccess è§¸ç™¼', event);\n          this.db = request.result;\n          console.log('[LocalDB] è³‡æ–™åº«åˆå§‹åŒ–æˆåŠŸ, version:', this.db.version);\n          console.log('[LocalDB] è³‡æ–™è¡¨:', Array.from(this.db.objectStoreNames));\n          resolve(this.db);\n        };\n\n        request.onupgradeneeded = (event) => {\n          console.log('[LocalDB] request.onupgradeneeded è§¸ç™¼', event);\n          const db = (event.target as IDBOpenDBRequest).result;\n          const oldVersion = event.oldVersion;\n          const newVersion = event.newVersion;\n          console.log(`[LocalDB] å‡ç´šè³‡æ–™åº«: v${oldVersion} -> v${newVersion}`);\n\n          try {\n            handleUpgrade(db, oldVersion, newVersion);\n            console.log('[LocalDB] handleUpgrade å®Œæˆ');\n          } catch (error) {\n            console.error('[LocalDB] å‡ç´šå¤±æ•—:', error);\n            this.initPromise = null; // æ¸…é™¤å¤±æ•—çš„ Promise\n            // æ³¨æ„: åœ¨ onupgradeneeded ä¸­ reject å¯èƒ½ç„¡æ•ˆ\n            // å› ç‚ºé‚„æœƒè§¸ç™¼ onsuccess æˆ– onerror\n            throw error;\n          }\n        };\n\n        request.onblocked = (event) => {\n          console.warn('[LocalDB] request.onblocked è§¸ç™¼ - è³‡æ–™åº«è¢«å…¶ä»–é€£ç·šé˜»æ“‹', event);\n        };\n\n          console.log('[LocalDB] å·²è¨­å®šæ‰€æœ‰å›èª¿å‡½æ•¸');\n        } catch (error) {\n          console.error('[LocalDB] Promise å…§éƒ¨éŒ¯èª¤:', error);\n          this.initPromise = null;\n          reject(error);\n        }\n      }, 100); // å»¶é² 100ms ç¢ºä¿ç’°å¢ƒå°±ç·’\n    });\n\n    return this.initPromise;\n  }\n\n  /**\n   * ç¢ºä¿è³‡æ–™åº«å·²åˆå§‹åŒ–\n   */\n  private async ensureInit(): Promise<IDBDatabase> {\n    console.log('[LocalDB] ensureInit called, db exists:', !!this.db);\n    if (!this.db) {\n      console.log('[LocalDB] DB not initialized, calling init()');\n      await this.init();\n      console.log('[LocalDB] init() completed');\n    }\n\n    if (!this.db) {\n      throw new Error('è³‡æ–™åº«åˆå§‹åŒ–å¤±æ•—');\n    }\n\n    console.log('[LocalDB] ensureInit completed');\n    return this.db;\n  }\n\n  // ============================================\n  // åŸºæœ¬ CRUD æ“ä½œ\n  // ============================================\n\n  /**\n   * å»ºç«‹å–®ç­†è³‡æ–™\n   */\n  async create<T extends { id: string }>(\n    tableName: TableName,\n    data: T\n  ): Promise<T> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n\n      // åŠ å…¥æ™‚é–“æˆ³\n      const now = new Date().toISOString();\n      const recordWithTimestamp = {\n        ...data,\n        created_at: (data as any).created_at || now,\n        updated_at: now,\n      } as T;\n\n      const request = objectStore.add(recordWithTimestamp);\n\n      request.onsuccess = () => {\n        resolve(recordWithTimestamp);\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `æ–°å¢è³‡æ–™å¤±æ•— (${tableName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n  /**\n   * è®€å–å–®ç­†è³‡æ–™\n   */\n  async read<T>(tableName: TableName, id: string): Promise<T | null> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readonly');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.get(id);\n\n      request.onsuccess = () => {\n        resolve(request.result || null);\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `è®€å–è³‡æ–™å¤±æ•— (${tableName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n  /**\n   * æ›´æ–°å–®ç­†è³‡æ–™\n   */\n  async update<T extends { id: string }>(\n    tableName: TableName,\n    id: string,\n    data: Partial<T>\n  ): Promise<T> {\n    const db = await this.ensureInit();\n\n    return new Promise(async (resolve, reject) => {\n      // å…ˆè®€å–ç¾æœ‰è³‡æ–™\n      const existing = await this.read<T>(tableName, id);\n      if (!existing) {\n        reject(new Error(`è³‡æ–™ä¸å­˜åœ¨ (${tableName}): ${id}`));\n        return;\n      }\n\n      const transaction = db.transaction(tableName, 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n\n      // åˆä½µè³‡æ–™ä¸¦æ›´æ–°æ™‚é–“æˆ³\n      const updated = {\n        ...existing,\n        ...data,\n        id, // ç¢ºä¿ ID ä¸è¢«è¦†è“‹\n        updated_at: new Date().toISOString(),\n      };\n\n      const request = objectStore.put(updated);\n\n      request.onsuccess = () => {\n        resolve(updated);\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `æ›´æ–°è³‡æ–™å¤±æ•— (${tableName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n\n  /**\n   * åˆªé™¤å–®ç­†è³‡æ–™\n   */\n  async delete(tableName: TableName, id: string): Promise<void> {\n    console.log('[LocalDB] é–‹å§‹åˆªé™¤:', tableName, id);\n\n    try {\n      console.log('[LocalDB] èª¿ç”¨ ensureInit, this.db å­˜åœ¨:', !!this.db);\n      const db = await this.ensureInit();\n      console.log('[LocalDB] DB åˆå§‹åŒ–å®Œæˆ');\n\n      return new Promise((resolve, reject) => {\n        console.log('[LocalDB] å»ºç«‹ transaction');\n        const transaction = db.transaction(tableName, 'readwrite');\n        const objectStore = transaction.objectStore(tableName);\n        console.log('[LocalDB] èª¿ç”¨ delete');\n        const request = objectStore.delete(id);\n\n        request.onsuccess = () => {\n          console.log('[LocalDB] delete request æˆåŠŸ');\n          resolve();\n        };\n\n        request.onerror = () => {\n          const error = new Error(\n            `åˆªé™¤è³‡æ–™å¤±æ•— (${tableName}): ${request.error?.message}`\n          );\n          console.error('[LocalDB]', error);\n          reject(error);\n        };\n\n        transaction.oncomplete = () => {\n          console.log('[LocalDB] transaction å®Œæˆ');\n        };\n\n        transaction.onerror = () => {\n          console.error('[LocalDB] transaction éŒ¯èª¤:', transaction.error);\n        };\n      });\n    } catch (error) {\n      console.error('[LocalDB] delete æ–¹æ³•ç•°å¸¸:', error);\n      throw error;\n    }\n  }\n\n  // ============================================\n  // æ‰¹æ¬¡æ“ä½œ\n  // ============================================\n\n  /**\n   * æ‰¹æ¬¡å»ºç«‹è³‡æ–™\n   */\n  async createMany<T extends { id: string }>(\n    tableName: TableName,\n    dataArray: T[]\n  ): Promise<T[]> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const now = new Date().toISOString();\n      const results: T[] = [];\n\n      transaction.oncomplete = () => {\n        resolve(results);\n      };\n\n      transaction.onerror = () => {\n        const error = new Error(\n          `æ‰¹æ¬¡æ–°å¢å¤±æ•— (${tableName}): ${transaction.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n\n      dataArray.forEach((data) => {\n        const recordWithTimestamp = {\n          ...data,\n          created_at: (data as any).created_at || now,\n          updated_at: now,\n        } as T;\n        objectStore.add(recordWithTimestamp);\n        results.push(recordWithTimestamp);\n      });\n    });\n  }\n\n  /**\n   * æ‰¹æ¬¡æ›´æ–°è³‡æ–™\n   */\n  async updateMany<T extends { id: string }>(\n    tableName: TableName,\n    updates: Array<{ id: string; data: Partial<T> }>\n  ): Promise<T[]> {\n    const results: T[] = [];\n\n    for (const { id, data } of updates) {\n      const updated = await this.update<T>(tableName, id, data);\n      results.push(updated);\n    }\n\n    return results;\n  }\n\n  /**\n   * æ‰¹æ¬¡åˆªé™¤è³‡æ–™\n   */\n  async deleteMany(tableName: TableName, ids: string[]): Promise<void> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n\n      transaction.oncomplete = () => {\n        resolve();\n      };\n\n      transaction.onerror = () => {\n        const error = new Error(\n          `æ‰¹æ¬¡åˆªé™¤å¤±æ•— (${tableName}): ${transaction.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n\n      ids.forEach((id) => {\n        objectStore.delete(id);\n      });\n    });\n  }\n\n  // ============================================\n  // æŸ¥è©¢åŠŸèƒ½\n  // ============================================\n\n  /**\n   * å–å¾—æ‰€æœ‰è³‡æ–™\n   */\n  async getAll<T>(\n    tableName: TableName,\n    options?: QueryOptions\n  ): Promise<T[]> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      // æª¢æŸ¥è³‡æ–™è¡¨æ˜¯å¦å­˜åœ¨\n      if (!db.objectStoreNames.contains(tableName)) {\n        console.error(`[LocalDB] getAll - è³‡æ–™è¡¨ä¸å­˜åœ¨: ${tableName}`);\n        console.log('[LocalDB] å¯ç”¨çš„è³‡æ–™è¡¨:', Array.from(db.objectStoreNames));\n        reject(new Error(`è³‡æ–™è¡¨ä¸å­˜åœ¨: ${tableName}`));\n        return;\n      }\n\n      const transaction = db.transaction(tableName, 'readonly');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.getAll();\n\n      request.onsuccess = () => {\n        let results = request.result;\n\n        // æ’åº\n        if (options?.orderBy) {\n          results.sort((a, b) => {\n            const aVal = a[options.orderBy!];\n            const bVal = b[options.orderBy!];\n            const order = options.direction === 'desc' ? -1 : 1;\n            return aVal > bVal ? order : aVal < bVal ? -order : 0;\n          });\n        }\n\n        // åˆ†é \n        if (options?.offset !== undefined || options?.limit !== undefined) {\n          const offset = options.offset || 0;\n          const limit = options.limit || results.length;\n          results = results.slice(offset, offset + limit);\n        }\n\n        resolve(results);\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `æŸ¥è©¢å¤±æ•— (${tableName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n  /**\n   * æ ¹æ“šç´¢å¼•æŸ¥è©¢\n   */\n  async findByIndex<T>(\n    tableName: TableName,\n    indexName: string,\n    value: unknown\n  ): Promise<T[]> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readonly');\n      const objectStore = transaction.objectStore(tableName);\n      const index = objectStore.index(indexName);\n      const request = index.getAll(value as IDBValidKey);\n\n      request.onsuccess = () => {\n        resolve(request.result);\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `ç´¢å¼•æŸ¥è©¢å¤±æ•— (${tableName}.${indexName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n  /**\n   * éæ¿¾æŸ¥è©¢\n   */\n  async filter<T>(\n    tableName: TableName,\n    conditions: FilterCondition[]\n  ): Promise<T[]> {\n    const allRecords = await this.getAll<T>(tableName);\n\n    return allRecords.filter((record) => {\n      return conditions.every((condition) => {\n        const fieldValue = (record as Record<string, unknown>)[condition.field];\n\n        switch (condition.operator) {\n          case 'eq':\n            return fieldValue === condition.value;\n          case 'ne':\n            return fieldValue !== condition.value;\n          case 'gt':\n            return (fieldValue as any) > (condition.value as any);\n          case 'gte':\n            return (fieldValue as any) >= (condition.value as any);\n          case 'lt':\n            return (fieldValue as any) < (condition.value as any);\n          case 'lte':\n            return (fieldValue as any) <= (condition.value as any);\n          case 'contains':\n            return String(fieldValue)\n              .toLowerCase()\n              .includes(String(condition.value).toLowerCase());\n          default:\n            return true;\n        }\n      });\n    });\n  }\n\n  /**\n   * è¨ˆç®—è³‡æ–™ç­†æ•¸\n   */\n  async count(tableName: TableName): Promise<number> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readonly');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.count();\n\n      request.onsuccess = () => {\n        resolve(request.result);\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `è¨ˆæ•¸å¤±æ•— (${tableName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n  /**\n   * æª¢æŸ¥è³‡æ–™æ˜¯å¦å­˜åœ¨\n   */\n  async exists(tableName: TableName, id: string): Promise<boolean> {\n    const result = await this.read(tableName, id);\n    return result !== null;\n  }\n\n  /**\n   * æ¸…ç©ºè³‡æ–™è¡¨\n   */\n  async clear(tableName: TableName): Promise<void> {\n    const db = await this.ensureInit();\n\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(tableName, 'readwrite');\n      const objectStore = transaction.objectStore(tableName);\n      const request = objectStore.clear();\n\n      request.onsuccess = () => {\n        console.log(`[LocalDB] å·²æ¸…ç©ºè³‡æ–™è¡¨: ${tableName}`);\n        resolve();\n      };\n\n      request.onerror = () => {\n        const error = new Error(\n          `æ¸…ç©ºå¤±æ•— (${tableName}): ${request.error?.message}`\n        );\n        console.error('[LocalDB]', error);\n        reject(error);\n      };\n    });\n  }\n\n  // ============================================\n  // å·¥å…·æ–¹æ³•\n  // ============================================\n\n  /**\n   * æ¸…ç©ºæ‰€æœ‰è³‡æ–™è¡¨\n   */\n  async clearAll(): Promise<void> {\n    const db = await this.ensureInit();\n    await clearAllTables(db);\n  }\n\n  /**\n   * åŒ¯å‡ºè³‡æ–™\n   */\n  async export(): Promise<Record<string, unknown[]>> {\n    const db = await this.ensureInit();\n    return exportData(db);\n  }\n\n  /**\n   * åŒ¯å…¥è³‡æ–™\n   */\n  async import(data: Record<string, unknown[]>): Promise<void> {\n    const db = await this.ensureInit();\n    await importData(db, data);\n  }\n\n  /**\n   * é—œé–‰è³‡æ–™åº«é€£ç·š\n   */\n  close(): void {\n    if (this.db) {\n      this.db.close();\n      this.db = null;\n      this.initPromise = null;\n      console.log('[LocalDB] è³‡æ–™åº«é€£ç·šå·²é—œé–‰');\n    }\n  }\n\n  /**\n   * é‡ç½®è³‡æ–™åº«å¯¦ä¾‹ï¼ˆå¼·åˆ¶æ¸…é™¤æ‰€æœ‰ç‹€æ…‹ï¼‰\n   */\n  reset(): void {\n    console.log('[LocalDB] é‡ç½®è³‡æ–™åº«å¯¦ä¾‹');\n    if (this.db) {\n      this.db.close();\n    }\n    this.db = null;\n    this.initPromise = null;\n  }\n}\n\n// åŒ¯å‡ºå–®ä¾‹å¯¦ä¾‹å’Œé¡åˆ¥\nexport const localDB = new LocalDatabase();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/init-default-user.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/init-local-data.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'bcrypt' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateUUID' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateCode' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1812,1815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1812,1815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3236,3239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3236,3239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * åˆå§‹åŒ–æœ¬åœ°è³‡æ–™åº«\n * å»ºç«‹æ‰€æœ‰å¿…è¦çš„é è¨­è³‡æ–™\n */\n\nimport bcrypt from 'bcryptjs';\nimport { localDB } from '@/lib/db';\nimport { DB_NAME } from '@/lib/db/schemas';\nimport { generateUUID } from '@/lib/utils/uuid';\n\n/**\n * ç”¢ç”Ÿ UUIDï¼ˆå·²ç§»é™¤ï¼Œæ”¹ç”¨ç³»çµ±çµ±ä¸€çš„ UUID ç”Ÿæˆå™¨ï¼‰\n * æ³¨æ„ï¼šæ­¤è™•æ”¹ç”¨ @/lib/utils/uuid çš„ generateUUID\n */\n\n/**\n * ç”¢ç”Ÿç·¨è™Ÿ\n */\nfunction generateCode(prefix: string, index: number): string {\n  const year = new Date().getFullYear();\n  const number = (index + 1).toString().padStart(4, '0');\n  return `${prefix}${year}${number}`;\n}\n\n/**\n * åˆå§‹åŒ–æœ¬åœ°è³‡æ–™åº«\n */\nexport async function initLocalDatabase(): Promise<void> {\n  console.log('ğŸ”§ åˆå§‹åŒ–æœ¬åœ°è³‡æ–™åº«...');\n\n  try {\n    // åˆå§‹åŒ– IndexedDB\n    await localDB.init();\n    console.log('âœ… IndexedDB å·²åˆå§‹åŒ–');\n\n    // æª¢æŸ¥æ˜¯å¦å·²æœ‰è³‡æ–™\n    const employeeCount = await localDB.count('employees');\n\n    if (employeeCount === 0) {\n      console.log('ğŸ“ IndexedDB ç„¡è³‡æ–™ï¼Œå˜—è©¦å¾ Supabase åŒæ­¥...');\n\n      // ğŸ”„ å„ªå…ˆå¾ Supabase åŒæ­¥è³‡æ–™ï¼ˆå¦‚æœæœ‰ç¶²è·¯ï¼‰\n      const syncedFromSupabase = await syncFromSupabase();\n\n      if (!syncedFromSupabase) {\n        // Supabase ä¹Ÿæ²’è³‡æ–™æˆ–ç„¡ç¶²è·¯ â†’ ä¸è‡ªå‹•å»ºç«‹ç®¡ç†å“¡\n        console.log('âš ï¸ Supabase ç„¡è³‡æ–™');\n        console.log('ğŸ’¡ è«‹é€éç³»çµ±ä»‹é¢å»ºç«‹ç®¡ç†å“¡å¸³è™Ÿ');\n      } else {\n        console.log('âœ… å·²å¾ Supabase åŒæ­¥è³‡æ–™åˆ°æœ¬åœ°');\n      }\n    } else {\n      console.log('âœ… è³‡æ–™åº«å·²æœ‰è³‡æ–™ï¼Œè·³éåˆå§‹åŒ–');\n    }\n  } catch (error) {\n    console.error('âŒ åˆå§‹åŒ–è³‡æ–™åº«å¤±æ•—:', error);\n    throw error;\n  }\n}\n\n/**\n * å¾ Supabase åŒæ­¥è³‡æ–™åˆ°æœ¬åœ°\n * @returns true è¡¨ç¤ºæˆåŠŸåŒæ­¥ï¼Œfalse è¡¨ç¤ºç„¡è³‡æ–™æˆ–å¤±æ•—\n */\nasync function syncFromSupabase(): Promise<boolean> {\n  try {\n    // æª¢æŸ¥æ˜¯å¦æœ‰ç¶²è·¯\n    if (typeof navigator !== 'undefined' && !navigator.onLine) {\n      console.log('âš ï¸ ç„¡ç¶²è·¯é€£ç·šï¼Œç„¡æ³•å¾ Supabase åŒæ­¥');\n      return false;\n    }\n\n    console.log('ğŸŒ å˜—è©¦å¾ Supabase ä¸‹è¼‰è³‡æ–™...');\n    const { supabase } = await import('@/lib/supabase/client');\n\n    // ä¸‹è¼‰ employees è³‡æ–™\n    const { data: employees, error } = await (supabase as any)\n      .from('employees')\n      .select('*')\n      .eq('status', 'active');\n\n    if (error) {\n      console.error('âŒ Supabase æŸ¥è©¢å¤±æ•—:', error);\n      return false;\n    }\n\n    if (!employees || employees.length === 0) {\n      console.log('âš ï¸ Supabase æ²’æœ‰å“¡å·¥è³‡æ–™');\n      return false;\n    }\n\n    console.log(`ğŸ“¥ å¾ Supabase ä¸‹è¼‰äº† ${employees.length} ä½å“¡å·¥`);\n\n    // å¯«å…¥åˆ° IndexedDB\n    for (const employee of employees) {\n      await localDB.create('employees', employee);\n    }\n\n    console.log('âœ… å“¡å·¥è³‡æ–™å·²åŒæ­¥åˆ°æœ¬åœ°');\n    return true;\n\n  } catch (error) {\n    console.error('âŒ å¾ Supabase åŒæ­¥å¤±æ•—:', error);\n    return false;\n  }\n}\n\n/**\n * å»ºç«‹é è¨­ç®¡ç†å“¡ï¼ˆå·²åœç”¨ï¼‰\n * æ­¤å‡½æ•¸å·²ä¸å†ä½¿ç”¨ï¼Œè«‹é€éç³»çµ±ä»‹é¢å»ºç«‹ç®¡ç†å“¡\n */\n// async function createDefaultAdmin(): Promise<void> {\n//   ... å·²ç§»é™¤\n// }\n\n/**\n * æª¢æŸ¥é è¨­ç®¡ç†å“¡å¯†ç¢¼ï¼ˆå·²åœç”¨ï¼‰\n * æ­¤å‡½æ•¸å·²ä¸å†ä½¿ç”¨\n */\n// async function checkDefaultAdminPassword(): Promise<void> {\n//   ... å·²ç§»é™¤\n// }\n\n\n// ========================================\n// æ¸¬è©¦è³‡æ–™å‡½æ•¸å·²ç§»é™¤\n// æ ¹æ“š STORE_UNIFICATION_FINAL.md å®šæ¡ˆï¼š\n// - åªä¿ç•™ william01 ç®¡ç†å“¡å¸³è™Ÿ\n// - å…¶ä»–è³‡æ–™é€éç³»çµ±ä»‹é¢æ–°å¢\n// ========================================\n\n/**\n * æ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼ˆå±éšªæ“ä½œï¼‰\n */\nexport async function clearAllData(): Promise<void> {\n  const tables = [\n    'employees', 'tours', 'orders', 'customers',\n    'members', 'payments', 'todos', 'visas',\n    'suppliers', 'quotes', 'quote_items',\n    'payment_requests', 'disbursement_orders', 'receipt_orders'\n  ];\n  \n  for (const table of tables) {\n    try {\n      await localDB.clear(table as any);\n      console.log(`âœ… å·²æ¸…ç©º ${table} è¡¨`);\n    } catch (error) {\n      console.error(`âŒ æ¸…ç©º ${table} è¡¨å¤±æ•—:`, error);\n    }\n  }\n}\n\n/**\n * åŒ¯å‡ºæ‰€æœ‰è³‡æ–™\n */\nexport async function exportAllData(): Promise<Record<string, unknown[]>> {\n  return await localDB.export();\n}\n\n/**\n * åŒ¯å…¥è³‡æ–™\n */\nexport async function importData(data: Record<string, unknown[]>): Promise<void> {\n  await localDB.import(data);\n}\n\n// è‡ªå‹•åˆå§‹åŒ–ï¼ˆåœ¨ç€è¦½å™¨ç’°å¢ƒï¼‰\nif (typeof window !== 'undefined') {\n  // æª¢æŸ¥æ˜¯å¦éœ€è¦åˆå§‹åŒ–\n  const initKey = `${DB_NAME}-initialized`;\n  const needsInit = localStorage.getItem(initKey) !== 'true';\n\n  if (needsInit) {\n    initLocalDatabase().then(() => {\n      localStorage.setItem(initKey, 'true');\n    }).catch(error => {\n      console.error('è‡ªå‹•åˆå§‹åŒ–å¤±æ•—:', error);\n    });\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/migrations.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addSyncIndexes' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSyncableTable' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * IndexedDB è³‡æ–™åº«å‡ç´šèˆ‡é·ç§»é‚è¼¯\n */\n\nimport { TABLE_SCHEMAS } from './schemas';\nimport { addSyncIndexes, isSyncableTable } from './sync-schema-helper';\n\n/**\n * è³‡æ–™åº«å‡ç´šè™•ç†å™¨\n * @param db - IDBDatabase å¯¦ä¾‹\n * @param oldVersion - èˆŠç‰ˆæœ¬è™Ÿ\n * @param newVersion - æ–°ç‰ˆæœ¬è™Ÿ\n */\nexport function handleUpgrade(\n  db: IDBDatabase,\n  oldVersion: number,\n  newVersion: number | null\n): void {\n  console.log(`[DB Migration] å‡ç´šè³‡æ–™åº«: v${oldVersion} -> v${newVersion}`);\n\n  try {\n    // v0 -> v1: å»ºç«‹æ‰€æœ‰è³‡æ–™è¡¨ï¼ˆåŒ…å« regions å’Œ workspaceï¼‰\n    if (oldVersion === 0) {\n      console.log('[DB Migration] åˆå§‹åŒ– v1 è³‡æ–™åº«ï¼ˆåŒ…å«æ‰€æœ‰è³‡æ–™è¡¨ï¼‰');\n      createAllTables(db);\n    }\n\n    console.log('[DB Migration] å‡ç´šå®Œæˆï¼');\n  } catch (error) {\n    console.error('[DB Migration] å‡ç´šå¤±æ•—:', error);\n    throw error;\n  }\n}\n\n/**\n * å»ºç«‹æ‰€æœ‰è³‡æ–™è¡¨ï¼ˆv1ï¼‰\n * åŒ…å«ï¼štours, orders, workspace ç­‰æ‰€æœ‰è¡¨æ ¼\n */\nfunction createAllTables(db: IDBDatabase): void {\n  console.log('[DB Migration] å»ºç«‹æ‰€æœ‰è³‡æ–™è¡¨ï¼ˆv1 å®Œæ•´ç‰ˆï¼‰...');\n\n  TABLE_SCHEMAS.forEach((schema) => {\n    // å¦‚æœè³‡æ–™è¡¨å·²å­˜åœ¨ï¼Œè·³éï¼ˆç†è«–ä¸Šä¸æ‡‰è©²ç™¼ç”Ÿï¼‰\n    if (db.objectStoreNames.contains(schema.name)) {\n      console.warn(`[DB Migration] è³‡æ–™è¡¨ ${schema.name} å·²å­˜åœ¨ï¼Œè·³é`);\n      return;\n    }\n\n    // å»ºç«‹è³‡æ–™è¡¨\n    const objectStore = db.createObjectStore(schema.name, {\n      keyPath: schema.keyPath,\n      autoIncrement: schema.autoIncrement,\n    });\n\n    // å»ºç«‹ç´¢å¼•\n    schema.indexes.forEach((index) => {\n      objectStore.createIndex(index.name, index.keyPath, {\n        unique: index.unique,\n      });\n    });\n\n    console.log(`[DB Migration] âœ“ å»ºç«‹è³‡æ–™è¡¨: ${schema.name} (${schema.indexes.length} å€‹ç´¢å¼•)`);\n  });\n\n  console.log(`[DB Migration] âœ“ å®Œæˆï¼å…±å»ºç«‹ ${TABLE_SCHEMAS.length} å€‹è³‡æ–™è¡¨`);\n}\n\n/**\n * æ¸…é™¤æ‰€æœ‰è³‡æ–™è¡¨ï¼ˆå±éšªæ“ä½œï¼Œåƒ…ä¾›é–‹ç™¼æ¸¬è©¦ï¼‰\n */\nexport function clearAllTables(db: IDBDatabase): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const transaction = db.transaction(\n      Array.from(db.objectStoreNames),\n      'readwrite'\n    );\n\n    transaction.onerror = () => reject(transaction.error);\n    transaction.oncomplete = () => {\n      console.log('[DB Migration] æ‰€æœ‰è³‡æ–™è¡¨å·²æ¸…ç©º');\n      resolve();\n    };\n\n    Array.from(db.objectStoreNames).forEach((tableName) => {\n      const objectStore = transaction.objectStore(tableName);\n      objectStore.clear();\n    });\n  });\n}\n\n/**\n * åŒ¯å‡ºè³‡æ–™ï¼ˆå‚™ä»½ç”¨ï¼‰\n */\nexport async function exportData(db: IDBDatabase): Promise<Record<string, unknown[]>> {\n  const data: Record<string, unknown[]> = {};\n\n  for (const tableName of Array.from(db.objectStoreNames)) {\n    const transaction = db.transaction(tableName, 'readonly');\n    const objectStore = transaction.objectStore(tableName);\n    const request = objectStore.getAll();\n\n    await new Promise<void>((resolve, reject) => {\n      request.onsuccess = () => {\n        data[tableName] = request.result;\n        resolve();\n      };\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n  return data;\n}\n\n/**\n * åŒ¯å…¥è³‡æ–™ï¼ˆé‚„åŸç”¨ï¼‰\n */\nexport async function importData(\n  db: IDBDatabase,\n  data: Record<string, unknown[]>\n): Promise<void> {\n  for (const [tableName, records] of Object.entries(data)) {\n    if (!db.objectStoreNames.contains(tableName)) {\n      console.warn(`[DB Migration] è³‡æ–™è¡¨ ${tableName} ä¸å­˜åœ¨ï¼Œè·³éåŒ¯å…¥`);\n      continue;\n    }\n\n    const transaction = db.transaction(tableName, 'readwrite');\n    const objectStore = transaction.objectStore(tableName);\n\n    for (const record of records) {\n      objectStore.put(record);\n    }\n\n    await new Promise<void>((resolve, reject) => {\n      transaction.oncomplete = () => resolve();\n      transaction.onerror = () => reject(transaction.error);\n    });\n\n    console.log(`[DB Migration] åŒ¯å…¥ ${records.length} ç­†è³‡æ–™åˆ° ${tableName}`);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/sync-schema-helper.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[996,999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[996,999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * åŒæ­¥ Schema è¼”åŠ©å·¥å…·\n * ç‚ºæ‰€æœ‰æ¥­å‹™è¡¨è‡ªå‹•åŠ å…¥åŒæ­¥ç›¸é—œç´¢å¼•\n */\n\nimport type { IndexSchema } from './schemas';\n\n/**\n * åŒæ­¥ç›¸é—œçš„ç´¢å¼•å®šç¾©\n * æ‰€æœ‰æ¥­å‹™è¡¨éƒ½éœ€è¦é€™äº›ç´¢å¼•\n */\nexport const SYNC_INDEXES: IndexSchema[] = [\n  { name: 'sync_status', keyPath: 'sync_status', unique: false },\n  { name: 'temp_code', keyPath: 'temp_code', unique: false },\n  { name: 'synced_at', keyPath: 'synced_at', unique: false },\n];\n\n/**\n * éœ€è¦åŠ å…¥åŒæ­¥ç´¢å¼•çš„æ¥­å‹™è¡¨æ¸…å–®\n * ä¸åŒ…æ‹¬ç³»çµ±è¡¨ï¼ˆå¦‚ syncQueueï¼‰å’Œ UI ç‹€æ…‹è¡¨\n */\nexport const SYNCABLE_TABLES = [\n  // æ ¸å¿ƒæ¥­å‹™\n  'employees',\n  'tours',\n  'itineraries',\n  'orders',\n  'members',\n  'tour_addons',\n  'customers',\n\n  // è²¡å‹™\n  'payments',\n  'payment_requests',\n  'disbursement_orders',\n  'receipt_orders',\n\n  // å ±åƒ¹èˆ‡ä¾›æ‡‰å•†\n  'quotes',\n  'quote_items',\n  'suppliers',\n\n  // é™„åŠ åŠŸèƒ½\n  'visas',\n  'todos',\n  'calendar_events',\n\n  // ç³»çµ±\n  'regions',\n  'templates',\n  'workspace_items',\n  'timebox_sessions',\n] as const;\n\n/**\n * æª¢æŸ¥è¡¨æ˜¯å¦éœ€è¦åŒæ­¥ç´¢å¼•\n */\nexport function isSyncableTable(tableName: string): boolean {\n  return SYNCABLE_TABLES.includes(tableName as any);\n}\n\n/**\n * ç‚ºè¡¨çµæ§‹åŠ å…¥åŒæ­¥ç´¢å¼•\n * å¦‚æœç´¢å¼•å·²å­˜åœ¨å‰‡è·³é\n */\nexport function addSyncIndexes(existingIndexes: IndexSchema[]): IndexSchema[] {\n  const indexNames = new Set(existingIndexes.map(idx => idx.name));\n  const newIndexes = [...existingIndexes];\n\n  for (const syncIndex of SYNC_INDEXES) {\n    if (!indexNames.has(syncIndex.name)) {\n      newIndexes.push(syncIndex);\n    }\n  }\n\n  return newIndexes;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/sync-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[347,350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[347,350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[683,686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[683,686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[948,951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[948,951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1199,1202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1199,1202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * åŒæ­¥ç‹€æ…‹å·¥å…·å‡½æ•¸\n * æä¾›åŒæ­¥ç‹€æ…‹ç®¡ç†çš„è¼”åŠ©åŠŸèƒ½\n *\n * FastIn æ¶æ§‹ï¼š\n * - _needs_sync: æ˜¯å¦å¾…åŒæ­¥\n * - _synced_at: æœ€å¾ŒåŒæ­¥æ™‚é–“\n * - _deleted: è»Ÿåˆªé™¤æ¨™è¨˜\n */\n\nimport type { SyncableEntity } from '@/types';\n\n/**\n * ç‚ºæ–°å»ºç«‹çš„å¯¦é«”åŠ å…¥åŒæ­¥æ¬„ä½\n * @param data - åŸå§‹è³‡æ–™\n * @param isSynced - æ˜¯å¦å·²åŒæ­¥ï¼ˆtrue: å·²åŒæ­¥, false: å¾…åŒæ­¥ï¼‰\n * @returns åŠ å…¥åŒæ­¥æ¬„ä½çš„è³‡æ–™\n */\nexport function withSyncFields<T extends Record<string, any>>(\n  data: T,\n  isSynced: boolean = false\n): T & Partial<SyncableEntity> {\n  return {\n    ...data,\n    _needs_sync: !isSynced,\n    _synced_at: isSynced ? new Date().toISOString() : null,\n    _deleted: false,\n  };\n}\n\n/**\n * æ¨™è¨˜ç‚ºå·²åŒæ­¥\n * @param data - åŸå§‹è³‡æ–™\n * @returns æ›´æ–°åŒæ­¥ç‹€æ…‹çš„è³‡æ–™\n */\nexport function markAsSynced<T extends Record<string, any>>(\n  data: T\n): T & Partial<SyncableEntity> {\n  return {\n    ...data,\n    _needs_sync: false,\n    _synced_at: new Date().toISOString(),\n  };\n}\n\n/**\n * æ¨™è¨˜ç‚ºå¾…åŒæ­¥\n * @param data - åŸå§‹è³‡æ–™\n * @returns æ›´æ–°åŒæ­¥ç‹€æ…‹çš„è³‡æ–™\n */\nexport function markAsPending<T extends Record<string, any>>(\n  data: T\n): T & Partial<SyncableEntity> {\n  return {\n    ...data,\n    _needs_sync: true,\n    _synced_at: null,\n  };\n}\n\n/**\n * æ¨™è¨˜ç‚ºè»Ÿåˆªé™¤ï¼ˆå¾…åŒæ­¥åˆªé™¤ï¼‰\n * @param data - åŸå§‹è³‡æ–™\n * @returns æ›´æ–°åˆªé™¤ç‹€æ…‹çš„è³‡æ–™\n */\nexport function markAsDeleted<T extends Record<string, any>>(\n  data: T\n): T & Partial<SyncableEntity> {\n  return {\n    ...data,\n    _deleted: true,\n    _needs_sync: true,\n    _synced_at: null,\n  };\n}\n\n/**\n * æª¢æŸ¥å¯¦é«”æ˜¯å¦å·²åŒæ­¥\n */\nexport function isSynced(entity: Partial<SyncableEntity>): boolean {\n  return entity._needs_sync === false && entity._synced_at !== null;\n}\n\n/**\n * æª¢æŸ¥å¯¦é«”æ˜¯å¦å¾…åŒæ­¥\n */\nexport function isPending(entity: Partial<SyncableEntity>): boolean {\n  return entity._needs_sync === true;\n}\n\n/**\n * æª¢æŸ¥å¯¦é«”æ˜¯å¦å·²è»Ÿåˆªé™¤\n */\nexport function isDeleted(entity: Partial<SyncableEntity>): boolean {\n  return entity._deleted === true;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/verify-and-fix.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4872,4875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4872,4875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4919,4922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4919,4922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4962,4965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4962,4965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * é©—è­‰å’Œä¿®å¾©å·¥å…·\n *\n * ä½¿ç”¨æ–¹å¼ï¼š\n * 1. åœ¨ç€è¦½å™¨ Console åŸ·è¡Œï¼š\n *    const { verifyAndFix } = await import('/src/lib/db/verify-and-fix')\n *    await verifyAndFix()\n *\n * 2. æˆ–ç›´æ¥åœ¨ä»»ä½•é é¢åŸ·è¡Œï¼ˆå·²è‡ªå‹•æ›è¼‰åˆ° windowï¼‰\n */\n\nimport { localDB } from '@/lib/db';\nimport { Employee as User } from '@/stores/types';\n\nexport async function verifyAndFix() {\n  console.log('ğŸ” é–‹å§‹é©—è­‰ç³»çµ±ç‹€æ…‹...\\n');\n\n  try {\n    // 1. æª¢æŸ¥ IndexedDB\n    console.log('ğŸ“Š æª¢æŸ¥ IndexedDB...');\n    const users = await localDB.getAll<User>('employees');\n    console.log(`   æ‰¾åˆ° ${users.length} ä½å“¡å·¥`);\n\n    if (users.length > 0) {\n      console.log('   å“¡å·¥åˆ—è¡¨ï¼š');\n      users.forEach(u => {\n        console.log(`   - ${u.display_name} (${u.employee_number}) [${u.status}]`);\n      });\n    }\n\n    // 2. æª¢æŸ¥ William\n    const william = users.find(u => u.employee_number === 'william01');\n\n    if (william) {\n      console.log('\\nâœ… William å¸³è™Ÿå­˜åœ¨');\n      console.log(`   å§“å: ${william.display_name}`);\n      console.log(`   å“¡å·¥ç·¨è™Ÿ: ${william.employee_number}`);\n      console.log(`   ç‹€æ…‹: ${william.status}`);\n      console.log(`   ID: ${william.id}`);\n      console.log(`   æ¬Šé™: ${william.permissions.join(', ')}`);\n\n      console.log('\\nâœ… ç³»çµ±ç‹€æ…‹æ­£å¸¸ï¼Œç„¡éœ€ä¿®å¾©');\n      return { status: 'ok', user: william };\n    }\n\n    // 3. William ä¸å­˜åœ¨ï¼Œéœ€è¦å»ºç«‹\n    console.log('\\nâš ï¸ æ‰¾ä¸åˆ° William å¸³è™Ÿ');\n    console.log('ğŸ”§ é–‹å§‹å»ºç«‹ William ç®¡ç†å“¡å¸³è™Ÿ...\\n');\n\n    const newWilliam: User = {\n      id: crypto.randomUUID(),\n      employee_number: 'william01',\n      display_name: 'William Chien',\n      english_name: 'William Chien',\n      chinese_name: 'ç°¡å¨å»‰',\n      permissions: [\n        'super_admin',\n        'admin',\n        'tours',\n        'orders',\n        'quotes',\n        'finance',\n        'hr',\n        'database',\n        'reports',\n        'settings'\n      ],\n      personal_info: {\n        national_id: '',\n        birthday: '',\n        phone: '',\n        email: 'william@venturo.com',\n        address: '',\n        emergency_contact: { name: '', relationship: '', phone: '' }\n      },\n      job_info: {\n        hire_date: new Date().toISOString()\n      },\n      salary_info: {\n        base_salary: 0,\n        allowances: [],\n        salary_history: []\n      },\n      attendance: {\n        leave_records: [],\n        overtime_records: []\n      },\n      contracts: [],\n      status: 'active',\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString()\n    };\n\n    await localDB.create<User>('employees', newWilliam);\n\n    console.log('âœ… William å¸³è™Ÿå»ºç«‹æˆåŠŸï¼');\n    console.log(`   å“¡å·¥ç·¨è™Ÿ: william01`);\n    console.log(`   å¯†ç¢¼: 83212711`);\n    console.log(`   å§“å: ${newWilliam.display_name}`);\n    console.log(`   ID: ${newWilliam.id}`);\n    console.log(`   æ¬Šé™: è¶…ç´šç®¡ç†å“¡ï¼ˆæ‰€æœ‰æ¬Šé™ï¼‰`);\n\n    // 4. é©—è­‰å»ºç«‹çµæœ\n    const verify = await localDB.getAll<User>('employees');\n    console.log(`\\nâœ… é©—è­‰å®Œæˆï¼Œç¾æœ‰å“¡å·¥æ•¸é‡: ${verify.length}`);\n\n    console.log('\\nğŸ‰ ä¿®å¾©å®Œæˆï¼è«‹é‡æ–°æ•´ç† HR é é¢æŸ¥çœ‹');\n\n    return { status: 'fixed', user: newWilliam };\n\n  } catch (error) {\n    console.error('\\nâŒ é©—è­‰/ä¿®å¾©å¤±æ•—:', error);\n    return { status: 'error', error };\n  }\n}\n\n/**\n * å¿«é€Ÿæª¢æŸ¥ï¼ˆä¸ä¿®å¾©ï¼‰\n */\nexport async function quickCheck() {\n  console.log('ğŸ” å¿«é€Ÿæª¢æŸ¥...\\n');\n\n  try {\n    const users = await localDB.getAll<User>('employees');\n    const william = users.find(u => u.employee_number === 'william01');\n\n    console.log(`ğŸ“Š IndexedDB ç‹€æ…‹:`);\n    console.log(`   ç¸½å“¡å·¥æ•¸: ${users.length}`);\n    console.log(`   William å¸³è™Ÿ: ${william ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`);\n\n    if (william) {\n      console.log(`   ç‹€æ…‹: ${william.status}`);\n      console.log(`   æ¬Šé™: ${william.permissions.length} é …`);\n    }\n\n    // æª¢æŸ¥ LocalStorage\n    const authStore = localStorage.getItem('auth-storage');\n    const localAuthStore = localStorage.getItem('venturo-local-auth-store');\n\n    console.log(`\\nğŸ’¾ LocalStorage ç‹€æ…‹:`);\n    console.log(`   auth-storage: ${authStore ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`);\n    console.log(`   venturo-local-auth-store: ${localAuthStore ? 'âš ï¸ å­˜åœ¨ï¼ˆv4.0 éºç•™ï¼‰' : 'ç„¡'}`);\n\n    if (authStore) {\n      const parsed = JSON.parse(authStore);\n      console.log(`   å·²ç™»å…¥: ${parsed.state?.isAuthenticated || false}`);\n      console.log(`   ä½¿ç”¨è€…: ${parsed.state?.user?.display_name || 'ç„¡'}`);\n    }\n\n    return { users, william, hasAuth: !!authStore };\n\n  } catch (error) {\n    console.error('âŒ æª¢æŸ¥å¤±æ•—:', error);\n    return { error };\n  }\n}\n\n/**\n * æ¸…é™¤ä¸¦é‡å»ºï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰\n */\nexport async function clearAndRebuild() {\n  const confirm = window.confirm(\n    'âš ï¸ é€™æœƒåˆªé™¤æ‰€æœ‰å“¡å·¥è³‡æ–™ä¸¦é‡æ–°å»ºç«‹ William å¸³è™Ÿã€‚\\n\\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ'\n  );\n\n  if (!confirm) {\n    console.log('âŒ ä½¿ç”¨è€…å–æ¶ˆæ“ä½œ');\n    return;\n  }\n\n  console.log('ğŸ”§ æ¸…é™¤ä¸¦é‡å»ºä¸­...\\n');\n\n  try {\n    // æ¸…é™¤æ‰€æœ‰å“¡å·¥\n    await localDB.clear('employees');\n    console.log('âœ… å·²æ¸…é™¤æ‰€æœ‰å“¡å·¥è³‡æ–™');\n\n    // é‡æ–°å»ºç«‹ William\n    const result = await verifyAndFix();\n    return result;\n\n  } catch (error) {\n    console.error('âŒ æ¸…é™¤ä¸¦é‡å»ºå¤±æ•—:', error);\n    return { status: 'error', error };\n  }\n}\n\n// è‡ªå‹•æ›è¼‰åˆ° windowï¼ˆæ–¹ä¾¿ Console ä½¿ç”¨ï¼‰\nif (typeof window !== 'undefined') {\n  (window as any).verifyAndFix = verifyAndFix;\n  (window as any).quickCheck = quickCheck;\n  (window as any).clearAndRebuild = clearAndRebuild;\n\n  console.log('ğŸ’¡ é©—è­‰å·¥å…·å·²è¼‰å…¥');\n  console.log('ğŸ“ å¯ç”¨æŒ‡ä»¤ï¼š');\n  console.log('   verifyAndFix()      - é©—è­‰ä¸¦è‡ªå‹•ä¿®å¾©');\n  console.log('   quickCheck()        - å¿«é€Ÿæª¢æŸ¥ï¼ˆä¸ä¿®å¾©ï¼‰');\n  console.log('   clearAndRebuild()   - æ¸…é™¤ä¸¦é‡å»ºï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰');\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/db/version-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/error-handler.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[524,527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[524,527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[712,715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[712,715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":67,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1736,1739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1736,1739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1851,1854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1851,1854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1883,1886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1883,1886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'context' is defined but never used. Allowed unused args must match /^_/u.","line":95,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3414,3417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3414,3417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3618,3621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3618,3621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * çµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * import { handleError, AsyncErrorBoundary } from '@/lib/error-handler';\n *\n * try {\n *   await service.create(data);\n * } catch (error) {\n *   handleError(error, 'PaymentService.create');\n * }\n */\n\nimport { ValidationError, NotFoundError } from '@/core/errors/app-errors';\nimport { logger } from '@/lib/utils/logger';\n\nexport interface ErrorLogEntry {\n  timestamp: string;\n  level: 'error' | 'warn' | 'info';\n  context: string;\n  message: string;\n  stack?: string;\n  metadata?: Record<string, any>;\n}\n\nclass ErrorHandler {\n  private logs: ErrorLogEntry[] = [];\n  private maxLogs = 1000;\n\n  /**\n   * è™•ç†éŒ¯èª¤ä¸¦è¨˜éŒ„\n   */\n  handle(error: unknown, context: string, metadata?: Record<string, any>): void {\n    const entry: ErrorLogEntry = {\n      timestamp: new Date().toISOString(),\n      level: 'error',\n      context,\n      message: this.extractMessage(error),\n      stack: error instanceof Error ? error.stack : undefined,\n      metadata,\n    };\n\n    this.log(entry);\n    this.notifyUser(error, context);\n\n    // å¦‚æœæ˜¯é–‹ç™¼ç’°å¢ƒï¼Œç›´æ¥æ‹‹å‡ºä»¥ä¾¿èª¿è©¦\n    if (process.env.NODE_ENV === 'development') {\n      logger.error(`[${context}]`, error);\n    }\n  }\n\n  /**\n   * è¨˜éŒ„éŒ¯èª¤\n   */\n  private log(entry: ErrorLogEntry): void {\n    this.logs.push(entry);\n\n    // é™åˆ¶æ—¥èªŒæ•¸é‡\n    if (this.logs.length > this.maxLogs) {\n      this.logs.shift();\n    }\n\n    // æŒä¹…åŒ–åˆ° localStorageï¼ˆå¯é¸ï¼‰\n    if (typeof window !== 'undefined') {\n      try {\n        localStorage.setItem('venturo-error-logs', JSON.stringify(this.logs.slice(-100)));\n      } catch (e) {\n        // localStorage å¯èƒ½å·²æ»¿ï¼Œå¿½ç•¥\n      }\n    }\n  }\n\n  /**\n   * æå–éŒ¯èª¤è¨Šæ¯\n   */\n  private extractMessage(error: unknown): string {\n    if (error instanceof ValidationError) {\n      return `é©—è­‰éŒ¯èª¤: ${(error as any).field} - ${error.message}`;\n    }\n\n    if (error instanceof NotFoundError) {\n      return `æ‰¾ä¸åˆ°è³‡æº: ${(error as any).resource} (ID: ${(error as any).id})`;\n    }\n\n    if (error instanceof Error) {\n      return error.message;\n    }\n\n    return String(error);\n  }\n\n  /**\n   * é€šçŸ¥ç”¨æˆ¶ï¼ˆå¯æ“´å±•ç‚º Toast é€šçŸ¥ï¼‰\n   */\n  private notifyUser(error: unknown, context: string): void {\n    // TODO: æ•´åˆ Toast é€šçŸ¥ç³»çµ±\n    const message = this.getUserFriendlyMessage(error);\n\n    // æœªä¾†å¯ä»¥é€™æ¨£ï¼š\n    // toast.error(message);\n    logger.warn(`[ç”¨æˆ¶é€šçŸ¥] ${message}`);\n  }\n\n  /**\n   * è½‰æ›ç‚ºç”¨æˆ¶å‹å–„çš„éŒ¯èª¤è¨Šæ¯\n   */\n  private getUserFriendlyMessage(error: unknown): string {\n    if (error instanceof ValidationError) {\n      return `è¼¸å…¥éŒ¯èª¤ï¼š${error.message}`;\n    }\n\n    if (error instanceof NotFoundError) {\n      return `æ‰¾ä¸åˆ°è³‡æ–™ï¼Œè«‹é‡æ–°æ•´ç†å¾Œå†è©¦`;\n    }\n\n    if (error instanceof Error) {\n      // éš±è—æŠ€è¡“ç´°ç¯€\n      if (error.message.includes('network') || error.message.includes('fetch')) {\n        return 'ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²è·¯å¾Œå†è©¦';\n      }\n\n      if (error.message.includes('timeout')) {\n        return 'æ“ä½œé€¾æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦';\n      }\n\n      return 'æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';\n    }\n\n    return 'ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤';\n  }\n\n  /**\n   * ç²å–éŒ¯èª¤æ—¥èªŒ\n   */\n  getLogs(limit = 100): ErrorLogEntry[] {\n    return this.logs.slice(-limit);\n  }\n\n  /**\n   * æ¸…é™¤éŒ¯èª¤æ—¥èªŒ\n   */\n  clearLogs(): void {\n    this.logs = [];\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('venturo-error-logs');\n    }\n  }\n\n  /**\n   * å°å‡ºæ—¥èªŒç‚º JSONï¼ˆä¾›èª¿è©¦ä½¿ç”¨ï¼‰\n   */\n  exportLogs(): string {\n    return JSON.stringify(this.logs, null, 2);\n  }\n}\n\n// å–®ä¾‹æ¨¡å¼\nexport const errorHandler = new ErrorHandler();\n\n/**\n * ä¾¿æ·å‡½æ•¸ï¼šè™•ç†éŒ¯èª¤\n */\nexport function handleError(\n  error: unknown,\n  context: string,\n  metadata?: Record<string, any>\n): void {\n  errorHandler.handle(error, context, metadata);\n}\n\n/**\n * ç•°æ­¥æ“ä½œçš„éŒ¯èª¤åŒ…è£å™¨\n */\nexport async function withErrorHandling<T>(\n  fn: () => Promise<T>,\n  context: string,\n  metadata?: Record<string, any>\n): Promise<T | null> {\n  try {\n    return await fn();\n  } catch (error) {\n    handleError(error, context, metadata);\n    return null;\n  }\n}\n\n/**\n * React Error Boundary ç”¨çš„éŒ¯èª¤è™•ç†\n */\nexport function handleReactError(\n  error: Error,\n  errorInfo: { componentStack: string }\n): void {\n  handleError(error, 'React Error Boundary', {\n    componentStack: errorInfo.componentStack,\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/formula-calculator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":124,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":124,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3549,3552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3549,3552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3568,3571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3568,3571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4680,4683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4680,4683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Excel-like formula calculator for custom fields\n\nexport interface FormulaContext {\n  [fieldName: string]: number | string;\n}\n\n// æ¬„ä½åç¨±æ˜ å°„è¡¨ - å°‡ä¸­æ–‡æ¬„ä½åæ˜ å°„åˆ°å¯¦éš›æ•¸æ“š\nexport const FIELD_MAP: Record<string, string> = {\n  'å§“å': 'name',\n  'è‹±æ–‡å§“å': 'nameEn',\n  'å¹´é½¡': 'age',\n  'åŸºæœ¬è²»ç”¨': 'basePrice',\n  'åŠ è³¼è²»ç”¨': 'addOnTotal',\n  'ç¸½è²»ç”¨': 'totalPrice',\n  'è¨‚ä½ä»£è™Ÿ': 'reservationCode',\n  // å¯ä»¥ç¹¼çºŒæ“´å±•\n};\n\n// æ¬„ä½åº§æ¨™æ˜ å°„ - Excel å¼åº§æ¨™ç³»çµ±\nexport const FIELD_COORDINATES: Record<string, string> = {\n  'C1': 'name',           // å§“å\n  'D1': 'nameEn',         // è‹±æ–‡å§“å\n  'E1': 'birthday',       // ç”Ÿæ—¥\n  'F1': 'age',            // å¹´é½¡\n  'G1': 'gender',         // æ€§åˆ¥\n  'H1': 'idNumber',       // èº«åˆ†è­‰å­—è™Ÿ\n  'I1': 'passportNumber', // è­·ç…§è™Ÿç¢¼\n  'J1': 'passportExpiry', // è­·ç…§æ•ˆæœŸ\n  'K1': 'reservationCode',// è¨‚ä½ä»£è™Ÿ\n  'L1': 'assignedRoom',   // åˆ†æˆ¿\n  // å‹•æ…‹æ¬„ä½æœƒå¾ M1 é–‹å§‹\n};\n\n// ç²å–æ¬„ä½çš„ Excel åº§æ¨™ï¼ˆåŒ…å«è‡ªå®šç¾©æ¬„ä½ï¼‰\nexport function getFieldCoordinate(fieldName: string, customFields: Array<{id: string, name: string}> = []): string | null {\n  // æª¢æŸ¥é å®šç¾©æ¬„ä½\n  for (const [coord, field] of Object.entries(FIELD_COORDINATES)) {\n    if (field === fieldName) {\n      return coord;\n    }\n  }\n\n  // æª¢æŸ¥è‡ªå®šç¾©æ¬„ä½ï¼ˆå¾ M1 é–‹å§‹ï¼‰\n  const customFieldIndex = customFields.findIndex(field => field.id === fieldName);\n  if (customFieldIndex !== -1) {\n    const column = String.fromCharCode(77 + customFieldIndex); // M, N, O, P...\n    return `${column}1`;\n  }\n\n  return null;\n}\n\n// å°‡ Excel åº§æ¨™è½‰æ›ç‚ºæ¬„ä½åç¨±\nexport function getFieldFromCoordinate(coordinate: string): string | null {\n  return FIELD_COORDINATES[coordinate.toUpperCase()] || null;\n}\n\n// è§£æå…¬å¼ä¸¦è¨ˆç®—çµæœ\nexport function calculateFormula(formula: string, context: FormulaContext): number | string | null {\n  try {\n    // å¦‚æœä¸æ˜¯ä»¥ = é–‹é ­ï¼Œç›´æ¥è¿”å›åŸå€¼\n    if (!formula.startsWith('=')) {\n      return formula;\n    }\n\n    // ç§»é™¤ = ç¬¦è™Ÿ\n    let expression = formula.substring(1).trim();\n\n    // æ›¿æ› Excel åº§æ¨™ç‚ºå¯¦éš›å€¼\n    for (const [coordinate, fieldKey] of Object.entries(FIELD_COORDINATES)) {\n      const regex = new RegExp(coordinate, 'gi');\n      const value = context[fieldKey];\n\n      if (value !== undefined) {\n        // å¦‚æœæ˜¯æ•¸å­—ï¼Œç›´æ¥æ›¿æ›ï¼›å¦‚æœæ˜¯å­—ä¸²ï¼ŒåŠ ä¸Šå¼•è™Ÿ\n        const replacementValue = typeof value === 'number' ? value.toString() : `\"${value}\"`;\n        expression = expression.replace(regex, replacementValue);\n      }\n    }\n\n    // æ›¿æ›ä¸­æ–‡æ¬„ä½åç¨±ç‚ºå¯¦éš›å€¼\n    for (const [display_name, fieldKey] of Object.entries(FIELD_MAP)) {\n      const regex = new RegExp(display_name, 'g');\n      const value = context[fieldKey];\n\n      if (value !== undefined) {\n        // å¦‚æœæ˜¯æ•¸å­—ï¼Œç›´æ¥æ›¿æ›ï¼›å¦‚æœæ˜¯å­—ä¸²ï¼ŒåŠ ä¸Šå¼•è™Ÿ\n        const replacementValue = typeof value === 'number' ? value.toString() : `\"${value}\"`;\n        expression = expression.replace(regex, replacementValue);\n      }\n    }\n\n    // è™•ç†åŸºæœ¬æ•¸å­¸é‹ç®—\n    // æ”¯æ´ +ã€-ã€*ã€/ é‹ç®—ç¬¦\n    const result = evaluateExpression(expression);\n\n    return result;\n  } catch (error) {\n    console.error('Formula calculation error:', error);\n    return '#ERROR';\n  }\n}\n\n// å®‰å…¨çš„è¡¨é”å¼è¨ˆç®—å™¨\nfunction evaluateExpression(expression: string): number | string {\n  // ç§»é™¤æ‰€æœ‰ç©ºæ ¼\n  expression = expression.replace(/\\s/g, '');\n\n  // æª¢æŸ¥æ˜¯å¦åŒ…å«ä¸å®‰å…¨çš„å­—ç¬¦ï¼ˆåªå…è¨±æ•¸å­—ã€é‹ç®—ç¬¦ã€å°æ•¸é»ã€æ‹¬è™Ÿï¼‰\n  if (!/^[0-9+\\-*/().]+$/.test(expression)) {\n    throw new Error('Invalid expression');\n  }\n\n  try {\n    // ä½¿ç”¨ Function æ§‹é€ å™¨é€²è¡Œå®‰å…¨è¨ˆç®—\n    const result = new Function('return (' + expression + ')')();\n\n    // æª¢æŸ¥çµæœæ˜¯å¦ç‚ºæœ‰æ•ˆæ•¸å­—\n    if (typeof result === 'number' && !isNaN(result)) {\n      return Math.round(result * 100) / 100; // å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œå…©ä½\n    }\n\n    return result;\n  } catch (error) {\n    throw new Error('Expression evaluation failed');\n  }\n}\n\n// ç²å–åœ˜å“¡çš„è¨ˆç®—ä¸Šä¸‹æ–‡\nexport function getMemberContext(member: any, tour_add_ons: any[] = [], tourPrice: number = 0): FormulaContext {\n  // è¨ˆç®—åŠ è³¼ç¸½é‡‘é¡\n  const addOnTotal = (member.addOns || []).reduce((sum: number, addOnId: string) => {\n    const addOn = tour_add_ons.find(a => a.id === addOnId);\n    return sum + (addOn?.price || 0);\n  }, 0);\n\n  // åŸºæœ¬è²»ç”¨ï¼ˆä½¿ç”¨æ—…éŠåœ˜åƒ¹æ ¼æˆ–è‡ªå®šç¾©åŸºæœ¬è²»ç”¨ï¼‰\n  const basePrice = member.basePrice || tourPrice;\n\n  return {\n    name: member.name || '',\n    nameEn: member.nameEn || '',\n    birthday: member.birthday || '',\n    age: member.age || 0,\n    gender: member.gender || '',\n    idNumber: member.idNumber || '',\n    passport_number: member.passport_number || '',\n    passportExpiry: member.passportExpiry || '',\n    reservationCode: member.reservationCode || '',\n    assignedRoom: member.assignedRoom || '',\n    basePrice: basePrice,\n    addOnTotal: addOnTotal,\n    totalPrice: basePrice + addOnTotal,\n    // åŠ å…¥è‡ªå®šç¾©æ¬„ä½æ•¸æ“šï¼Œè®“å…¶ä»–æ¬„ä½å¯ä»¥å¼•ç”¨\n    ...Object.entries(member.customFields || {}).reduce((acc, [fieldId, value]) => {\n      // å¦‚æœå€¼æ˜¯æ•¸å­—ï¼Œè½‰æ›ç‚ºæ•¸å­—é¡å‹\n      const numValue = Number(value);\n      acc[fieldId] = isNaN(numValue) ? value : numValue;\n      return acc;\n    }, {} as Record<string, any>),\n  };\n}\n\n// é è¨­çš„å…¬å¼ç¯„ä¾‹\nexport const FORMULA_EXAMPLES = [\n  { name: 'ç¸½è²»ç”¨', formula: '=åŸºæœ¬è²»ç”¨+åŠ è³¼è²»ç”¨', description: 'è¨ˆç®—åŸºæœ¬è²»ç”¨åŠ ä¸ŠåŠ è³¼è²»ç”¨' },\n  { name: 'æŠ˜æ‰£å¾Œè²»ç”¨', formula: '=ç¸½è²»ç”¨*0.9', description: 'ç¸½è²»ç”¨æ‰“9æŠ˜' },\n  { name: 'æˆäººè²»ç”¨', formula: '=å¹´é½¡>=18?åŸºæœ¬è²»ç”¨:åŸºæœ¬è²»ç”¨*0.8', description: 'æˆäººå…¨åƒ¹ï¼Œå…’ç«¥8æŠ˜' },\n];","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/init-passwords.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userStoreHelpers' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1589,1592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1589,1592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1934,1937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1934,1937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2936,2939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2936,2939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5920,5923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5920,5923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * åˆå§‹åŒ–å“¡å·¥å¯†ç¢¼\n * ç”¨æ–¼ç‚ºç¾æœ‰å“¡å·¥è³‡æ–™åŠ å…¥é è¨­å¯†ç¢¼\n */\n\nimport { useUserStore, userStoreHelpers } from '@/stores/user-store';\nimport { PasswordUtils } from '@/lib/password-utils';\nimport { localDB } from '@/lib/db';\nimport { generateUUID } from '@/lib/utils/uuid';\n\n// å¼•å…¥æ­£ç¢ºçš„è¡¨åå¸¸æ•¸\nimport { TABLES } from '@/lib/db/schemas';\n\nexport async function initializeEmployeePasswords() {\n  console.log('ğŸ” é–‹å§‹åˆå§‹åŒ–å“¡å·¥å¯†ç¢¼...');\n\n  const userStore = useUserStore.getState();\n  const users = userStore.items;\n\n  if (users.length === 0) {\n    console.log('âš ï¸ æ²’æœ‰æ‰¾åˆ°å“¡å·¥è³‡æ–™');\n    \n    // å»ºç«‹é è¨­ç®¡ç†å“¡å¸³è™Ÿ\n    const defaultAdminPassword = await PasswordUtils.hashPassword('admin123');\n    const adminUser = {\n      employee_number: 'admin',\n      english_name: 'Administrator',\n      display_name: 'ç³»çµ±ç®¡ç†å“¡',\n      chinese_name: 'ç³»çµ±ç®¡ç†å“¡',\n      password_hash: defaultAdminPassword,\n      must_change_password: true,\n      personal_info: {\n        national_id: 'A123456789',\n        birthday: '1990-01-01',\n        phone: '0912-345-678',\n        email: 'admin@venturo.com',\n        address: 'å°åŒ—å¸‚ä¿¡ç¾©å€',\n        emergency_contact: {\n          name: 'ç·Šæ€¥è¯çµ¡äºº',\n          relationship: 'é…å¶',\n          phone: '0923-456-789'\n        }\n      },\n      job_info: {\n        hire_date: new Date().toISOString().split('T')[0],\n      },\n      salary_info: {\n        base_salary: 0,\n        allowances: [],\n        salary_history: []\n      },\n      permissions: ['admin'],\n      attendance: {\n        leave_records: [],\n        overtime_records: []\n      },\n      contracts: [],\n      status: 'active' as const\n    };\n\n    await userStore.create(adminUser as any);\n    console.log('âœ… å·²å»ºç«‹é è¨­ç®¡ç†å“¡å¸³è™Ÿ');\n    console.log('   å¸³è™Ÿï¼šadmin');\n    console.log('   å¯†ç¢¼ï¼šadmin123');\n    console.log('   âš ï¸ è«‹æ–¼é¦–æ¬¡ç™»å…¥å¾Œç«‹å³ä¿®æ”¹å¯†ç¢¼ï¼');\n\n    // åŒæ­¥åˆ° IndexedDBï¼ˆåƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒï¼‰\n    if (typeof window !== 'undefined' && 'indexedDB' in window) {\n      try {\n        await localDB.init(); // ç¢ºä¿è³‡æ–™åº«å·²åˆå§‹åŒ–\n        await localDB.put(TABLES.EMPLOYEES as any, {\n          ...adminUser,\n          id: generateUUID(),\n          created_at: new Date().toISOString()\n        });\n        console.log('âœ… å·²åŒæ­¥åˆ° IndexedDB');\n      } catch (dbError) {\n        console.warn('âš ï¸ IndexedDB å„²å­˜å¤±æ•—ï¼Œä½†æœ¬åœ° store å·²æ›´æ–°:', dbError);\n      }\n    } else {\n      console.log('â„¹ï¸ IndexedDB ä¸å¯ç”¨ï¼Œåƒ…æ›´æ–°æœ¬åœ° store');\n    }\n\n    return;\n  }\n\n  // ç‚ºç¾æœ‰å“¡å·¥è¨­å®šé è¨­å¯†ç¢¼\n  let updatedCount = 0;\n  \n  for (const user of users) {\n    if (!user.password_hash) {\n      // ç”Ÿæˆé è¨­å¯†ç¢¼\n      const defaultPassword = PasswordUtils.generateDefaultPassword(user.employee_number);\n      const hashedPassword = await PasswordUtils.hashPassword(defaultPassword);\n\n      // æ›´æ–°å“¡å·¥è³‡æ–™\n      await userStore.update(user.id, {\n        password_hash: hashedPassword,\n        must_change_password: true,\n        last_password_change: new Date().toISOString()\n      });\n\n      // åŒæ­¥åˆ° IndexedDBï¼ˆåƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒï¼‰\n      if (typeof window !== 'undefined' && 'indexedDB' in window) {\n        try {\n          await localDB.put(TABLES.EMPLOYEES as any, {\n            ...user,\n            password_hash: hashedPassword,\n            must_change_password: true,\n            last_password_change: new Date().toISOString()\n          });\n        } catch (dbError) {\n          console.warn(`âš ï¸ IndexedDB å„²å­˜å¤±æ•— (${user.employee_number}):`, dbError);\n        }\n      }\n\n      console.log(`âœ… å·²ç‚º ${user.display_name} (${user.employee_number}) è¨­å®šé è¨­å¯†ç¢¼`);\n      console.log(`   é è¨­å¯†ç¢¼ï¼š${defaultPassword}`);\n      \n      updatedCount++;\n    }\n  }\n\n  if (updatedCount > 0) {\n    console.log(`\\nâœ… æˆåŠŸåˆå§‹åŒ– ${updatedCount} ä½å“¡å·¥çš„å¯†ç¢¼`);\n    console.log('âš ï¸ è«‹é€šçŸ¥å“¡å·¥æ–¼é¦–æ¬¡ç™»å…¥å¾Œä¿®æ”¹å¯†ç¢¼');\n  } else {\n    console.log('â„¹ï¸ æ‰€æœ‰å“¡å·¥éƒ½å·²æœ‰å¯†ç¢¼è¨­å®š');\n  }\n}\n\n// å»ºç«‹æ¸¬è©¦å“¡å·¥è³‡æ–™\nexport async function createTestEmployees() {\n  console.log('ğŸ§ª å»ºç«‹æ¸¬è©¦å“¡å·¥è³‡æ–™...');\n\n  const testEmployees = [\n    {\n      employee_number: 'john01',\n      english_name: 'John',\n      display_name: 'ç´„ç¿°',\n      password: 'john123',\n      permissions: ['orders', 'quotes', 'customers']\n    },\n    {\n      employee_number: 'mary01',\n      english_name: 'Mary',\n      display_name: 'ç‘ªéº—',\n      password: 'mary123',\n      permissions: ['finance', 'payments']\n    },\n    {\n      employee_number: 'peter01',\n      english_name: 'Peter',\n      display_name: 'å½¼å¾—',\n      password: 'peter123',\n      permissions: ['hr']\n    }\n  ];\n\n  const userStore = useUserStore.getState();\n\n  for (const emp of testEmployees) {\n    // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨\n    const existing = userStore.items.find(u => u.employee_number === emp.employee_number);\n    if (existing) {\n      console.log(`âš ï¸ å“¡å·¥ ${emp.employee_number} å·²å­˜åœ¨ï¼Œè·³é`);\n      continue;\n    }\n\n    // åŠ å¯†å¯†ç¢¼\n    const password_hash = await PasswordUtils.hashPassword(emp.password);\n\n    // å»ºç«‹å“¡å·¥è³‡æ–™\n    const newEmployee = {\n      employee_number: emp.employee_number,\n      english_name: emp.english_name,\n      display_name: emp.display_name,\n      chinese_name: emp.display_name,\n      password_hash,\n      must_change_password: false, // æ¸¬è©¦å¸³è™Ÿä¸å¼·åˆ¶æ”¹å¯†ç¢¼\n      personal_info: {\n        national_id: `TEST${Math.random().toString(36).substr(2, 9).toUpperCase()}`,\n        birthday: '1990-01-01',\n        phone: `09${Math.floor(Math.random() * 100000000).toString().padStart(8, '0')}`,\n        email: `${emp.employee_number}@venturo.com`,\n        address: 'å°åŒ—å¸‚',\n        emergency_contact: {\n          name: 'ç·Šæ€¥è¯çµ¡äºº',\n          relationship: 'å®¶äºº',\n          phone: '0900-000-000'\n        }\n      },\n      job_info: {\n        hire_date: new Date().toISOString().split('T')[0],\n      },\n      salary_info: {\n        base_salary: 50000,\n        allowances: [],\n        salary_history: []\n      },\n      permissions: emp.permissions,\n      attendance: {\n        leave_records: [],\n        overtime_records: []\n      },\n      contracts: [],\n      status: 'active' as const\n    };\n\n    await userStore.create(newEmployee);\n\n    // åŒæ­¥åˆ° IndexedDBï¼ˆåƒ…åœ¨ç€è¦½å™¨ç’°å¢ƒï¼‰\n    if (typeof window !== 'undefined' && 'indexedDB' in window) {\n      try {\n        await localDB.init(); // ç¢ºä¿è³‡æ–™åº«å·²åˆå§‹åŒ–\n        await localDB.put(TABLES.EMPLOYEES as any, {\n          ...newEmployee,\n          id: generateUUID(),\n          created_at: new Date().toISOString()\n        });\n      } catch (dbError) {\n        console.warn(`âš ï¸ IndexedDB å„²å­˜å¤±æ•— (${emp.employee_number}):`, dbError);\n      }\n    }\n\n    console.log(`âœ… å·²å»ºç«‹æ¸¬è©¦å“¡å·¥ï¼š${emp.display_name} (${emp.employee_number})`);\n    console.log(`   å¯†ç¢¼ï¼š${emp.password}`);\n  }\n\n  console.log('\\nâœ… æ¸¬è©¦å“¡å·¥å»ºç«‹å®Œæˆï¼');\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/logger.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LogLevel' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Venturo çµ±ä¸€æ—¥èªŒç³»çµ±\n *\n * åŠŸèƒ½ï¼š\n * - é–‹ç™¼ç’°å¢ƒï¼šé¡¯ç¤ºæ‰€æœ‰æ—¥èªŒ\n * - ç”Ÿç”¢ç’°å¢ƒï¼šåªé¡¯ç¤º warn å’Œ error\n * - ç‚ºæœªä¾† Sentry æ•´åˆé ç•™æ¥å£\n */\n\ntype LogLevel = 'debug' | 'info' | 'warn' | 'error';\n\ninterface LogMeta {\n  [key: string]: unknown;\n}\n\nclass AppLogger {\n  private isDev = process.env.NODE_ENV === 'development';\n\n  /**\n   * é™¤éŒ¯è¨Šæ¯ï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰\n   */\n  debug(message: string, meta?: LogMeta) {\n    if (this.isDev) {\n      console.log(`ğŸ› [DEBUG] ${message}`, meta || '');\n    }\n  }\n\n  /**\n   * ä¸€èˆ¬è¨Šæ¯\n   */\n  info(message: string, meta?: LogMeta) {\n    if (this.isDev) {\n      console.log(`â„¹ï¸ [INFO] ${message}`, meta || '');\n    }\n  }\n\n  /**\n   * è­¦å‘Šè¨Šæ¯\n   */\n  warn(message: string, meta?: LogMeta) {\n    console.warn(`âš ï¸ [WARN] ${message}`, meta || '');\n  }\n\n  /**\n   * éŒ¯èª¤è¨Šæ¯\n   */\n  error(message: string, meta?: LogMeta) {\n    console.error(`âŒ [ERROR] ${message}`, meta || '');\n\n    // ç”Ÿç”¢ç’°å¢ƒå¯æ•´åˆ Sentry\n    if (!this.isDev && typeof window !== 'undefined') {\n      // TODO: æ•´åˆ Sentry\n      // Sentry.captureException(new Error(message), { extra: meta });\n    }\n  }\n}\n\nexport const logger = new AppLogger();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/newebpay/crypto.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1760,1763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1760,1763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2438,2441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2438,2441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2851,2854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2851,2854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3583,3586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3583,3586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * è—æ–°é‡‘æµæ—…è¡Œæ¥­ä»£è½‰ç™¼ç¥¨åŠ å¯†è§£å¯†å·¥å…·\n * ä½¿ç”¨ AES-256-CBC åŠ å¯†\n */\n\nimport crypto from 'crypto'\n\n// è—æ–° API è¨­å®š\nexport const NEWEBPAY_CONFIG = {\n  // æ¸¬è©¦ç’°å¢ƒ\n  test: {\n    apiUrl: 'https://cwww.travelinvoice.com.tw',\n    merchantId: process.env.NEWEBPAY_TEST_MERCHANT_ID || '',\n    hashKey: process.env.NEWEBPAY_TEST_HASH_KEY || '',\n    hashIv: process.env.NEWEBPAY_TEST_HASH_IV || '',\n  },\n  // æ­£å¼ç’°å¢ƒ\n  production: {\n    apiUrl: 'https://www.travelinvoice.com.tw',\n    merchantId: process.env.NEWEBPAY_MERCHANT_ID || '',\n    hashKey: process.env.NEWEBPAY_HASH_KEY || '',\n    hashIv: process.env.NEWEBPAY_HASH_IV || '',\n  },\n}\n\n/**\n * å–å¾—ç›®å‰ç’°å¢ƒè¨­å®š\n */\nexport function getNewebpayConfig() {\n  const isProduction = process.env.NEWEBPAY_ENV === 'production'\n  return isProduction ? NEWEBPAY_CONFIG.production : NEWEBPAY_CONFIG.test\n}\n\n/**\n * AES-256-CBC åŠ å¯†\n * @param data è¦åŠ å¯†çš„è³‡æ–™\n * @param key HashKey\n * @param iv HashIV\n * @returns åŠ å¯†å¾Œçš„ hex å­—ä¸²\n */\nexport function aesEncrypt(data: string, key: string, iv: string): string {\n  const cipher = crypto.createCipheriv('aes-256-cbc', key, iv)\n  let encrypted = cipher.update(data, 'utf8', 'hex')\n  encrypted += cipher.final('hex')\n  return encrypted\n}\n\n/**\n * AES-256-CBC è§£å¯†\n * @param encryptedData åŠ å¯†çš„è³‡æ–™ (hex)\n * @param key HashKey\n * @param iv HashIV\n * @returns è§£å¯†å¾Œçš„å­—ä¸²\n */\nexport function aesDecrypt(encryptedData: string, key: string, iv: string): string {\n  const decipher = crypto.createDecipheriv('aes-256-cbc', key, iv)\n  let decrypted = decipher.update(encryptedData, 'hex', 'utf8')\n  decrypted += decipher.final('utf8')\n  return decrypted\n}\n\n/**\n * ç”¢ç”Ÿ CheckCode (SHA256)\n * @param params åƒæ•¸ç‰©ä»¶\n * @param hashKey HashKey\n * @param hashIv HashIV\n * @returns SHA256 é›œæ¹Šå€¼ (å¤§å¯«)\n */\nexport function generateCheckCode(\n  params: Record<string, any>,\n  hashKey: string,\n  hashIv: string\n): string {\n  // å°‡åƒæ•¸è½‰ç‚ºæŸ¥è©¢å­—ä¸²æ ¼å¼\n  const queryString = Object.keys(params)\n    .sort()\n    .map((key) => {\n      const value = params[key]\n      return `${key}=${typeof value === 'object' ? JSON.stringify(value) : value}`\n    })\n    .join('&')\n\n  // çµ„åˆ: HashIV + æŸ¥è©¢å­—ä¸² + HashKey\n  const rawString = `${hashIv}${queryString}${hashKey}`\n\n  // SHA256 é›œæ¹Šä¸¦è½‰å¤§å¯«\n  const hash = crypto.createHash('sha256').update(rawString, 'utf8').digest('hex')\n  return hash.toUpperCase()\n}\n\n/**\n * çµ„åˆå®Œæ•´çš„åŠ å¯† POST è³‡æ–™\n * @param postData è¦å‚³é€çš„åŸå§‹è³‡æ–™\n * @returns åŠ å¯†å¾Œçš„ POST è³‡æ–™ç‰©ä»¶ { MerchantID, PostData }\n */\nexport function createEncryptedPostData(postData: Record<string, any>) {\n  const config = getNewebpayConfig()\n\n  // å°‡è³‡æ–™è½‰ç‚º JSON å­—ä¸²\n  const jsonData = JSON.stringify(postData)\n\n  // AES åŠ å¯†\n  const encryptedData = aesEncrypt(jsonData, config.hashKey, config.hashIv)\n\n  return {\n    MerchantID: config.merchantId,\n    PostData: encryptedData,\n  }\n}\n\n/**\n * è§£å¯†è—æ–°å›å‚³çš„è³‡æ–™\n * @param encryptedData åŠ å¯†çš„å›å‚³è³‡æ–™\n * @returns è§£å¯†å¾Œçš„ç‰©ä»¶\n */\nexport function decryptResponseData(encryptedData: string): any {\n  const config = getNewebpayConfig()\n  const decryptedString = aesDecrypt(encryptedData, config.hashKey, config.hashIv)\n  return JSON.parse(decryptedString)\n}\n\n/**\n * ç”¢ç”Ÿä»£è½‰äº¤æ˜“ç·¨è™Ÿ\n * @returns æ ¼å¼: TRI-YYYYMMDD-XXXXX\n */\nexport function generateTransactionNo(): string {\n  const now = new Date()\n  const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '')\n  const randomStr = Math.random().toString(36).substring(2, 7).toUpperCase()\n  const timestamp = now.getTime().toString().slice(-5)\n  return `TRI-${dateStr}-${timestamp}${randomStr}`\n}\n\n/**\n * é©—è­‰è—æ–°å›å‚³çš„ CheckCode\n * @param responseData å›å‚³çš„è³‡æ–™\n * @param receivedCheckCode æ”¶åˆ°çš„ CheckCode\n * @returns æ˜¯å¦é©—è­‰é€šé\n */\nexport function verifyCheckCode(\n  responseData: Record<string, any>,\n  receivedCheckCode: string\n): boolean {\n  const config = getNewebpayConfig()\n  const calculatedCheckCode = generateCheckCode(responseData, config.hashKey, config.hashIv)\n  return calculatedCheckCode === receivedCheckCode.toUpperCase()\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/password-utils.ts","messages":[{"ruleId":"no-useless-escape","severity":1,"message":"Unnecessary escape character: \\[.","line":73,"column":26,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":73,"endColumn":27,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1609,1610],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1609,1609],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":1,"message":"Unnecessary escape character: \\/.","line":73,"column":43,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":73,"endColumn":44,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1626,1627],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1626,1626],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import bcrypt from 'bcryptjs';\n\n/**\n * å¯†ç¢¼ç®¡ç†å·¥å…·\n */\nexport class PasswordUtils {\n  /**\n   * åŠ å¯†å¯†ç¢¼\n   */\n  static async hashPassword(password: string): Promise<string> {\n    const salt = await bcrypt.genSalt(10);\n    return bcrypt.hash(password, salt);\n  }\n\n  /**\n   * é©—è­‰å¯†ç¢¼\n   */\n  static async verifyPassword(password: string, hash: string): Promise<boolean> {\n    return bcrypt.compare(password, hash);\n  }\n\n  /**\n   * ç”Ÿæˆé è¨­å¯†ç¢¼\n   * æ ¼å¼ï¼šå“¡å·¥ç·¨è™Ÿ@ç•¶å‰å¹´ä»½\n   */\n  static generateDefaultPassword(employee_number: string): string {\n    const year = new Date().getFullYear();\n    return `${employee_number}@${year}`;\n  }\n\n  /**\n   * ç”Ÿæˆéš¨æ©Ÿå¯†ç¢¼\n   */\n  static generateRandomPassword(length: number = 8): string {\n    const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%';\n    let password = '';\n    for (let i = 0; i < length; i++) {\n      password += charset.charAt(Math.floor(Math.random() * charset.length));\n    }\n    return password;\n  }\n\n  /**\n   * æª¢æŸ¥å¯†ç¢¼å¼·åº¦\n   */\n  static checkPasswordStrength(password: string): {\n    score: number;\n    message: string;\n    isValid: boolean;\n  } {\n    let score = 0;\n    const messages: string[] = [];\n\n    // é•·åº¦æª¢æŸ¥\n    if (password.length >= 8) score += 1;\n    else messages.push('å¯†ç¢¼è‡³å°‘éœ€è¦ 8 å€‹å­—å…ƒ');\n\n    if (password.length >= 12) score += 1;\n\n    // åŒ…å«å°å¯«å­—æ¯\n    if (/[a-z]/.test(password)) score += 1;\n    else messages.push('éœ€è¦åŒ…å«å°å¯«å­—æ¯');\n\n    // åŒ…å«å¤§å¯«å­—æ¯\n    if (/[A-Z]/.test(password)) score += 1;\n    else messages.push('éœ€è¦åŒ…å«å¤§å¯«å­—æ¯');\n\n    // åŒ…å«æ•¸å­—\n    if (/\\d/.test(password)) score += 1;\n    else messages.push('éœ€è¦åŒ…å«æ•¸å­—');\n\n    // åŒ…å«ç‰¹æ®Šå­—ç¬¦\n    if (/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password)) score += 1;\n\n    // è©•åˆ†\n    let strength = 'å¼±';\n    let isValid = false;\n\n    if (score <= 2) {\n      strength = 'å¼±';\n    } else if (score <= 4) {\n      strength = 'ä¸­ç­‰';\n      isValid = true;\n    } else {\n      strength = 'å¼·';\n      isValid = true;\n    }\n\n    const finalMessage = messages.length > 0 \n      ? messages.join('ã€') \n      : `å¯†ç¢¼å¼·åº¦ï¼š${strength}`;\n\n    return {\n      score,\n      message: finalMessage,\n      isValid\n    };\n  }\n\n  /**\n   * æª¢æŸ¥å¯†ç¢¼æ˜¯å¦éæœŸï¼ˆ90å¤©ï¼‰\n   */\n  static isPasswordExpired(last_password_change?: string): boolean {\n    if (!last_password_change) return true;\n\n    const lastChange = new Date(last_password_change);\n    const now = new Date();\n    const daysDiff = Math.floor((now.getTime() - lastChange.getTime()) / (1000 * 60 * 60 * 24));\n\n    return daysDiff >= 90;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/performance/memory-manager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1347,1350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1347,1350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1423,1426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1423,1426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2567,2570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2567,2570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2609,2612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2609,2612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * VENTURO 5.0 - è¨˜æ†¶é«”ç®¡ç†å·¥å…·\n *\n * æ ¸å¿ƒæ¦‚å¿µï¼š\n * - è‡ªå‹•æ¸…ç†æœªä½¿ç”¨çš„å¿«å–\n * - ç›£æ§è¨˜æ†¶é«”ä½¿ç”¨é‡\n * - æä¾›è¨˜æ†¶é«”å£“åŠ›è­¦å‘Š\n * - æ”¯æ´æ‰‹å‹•å›æ”¶\n */\n\nimport { cacheStrategy } from '@/lib/cache/cache-strategy';\n\ninterface MemoryStats {\n  /** ä½¿ç”¨çš„è¨˜æ†¶é«”ï¼ˆMBï¼‰ */\n  usedMemory: number;\n  /** ç¸½è¨˜æ†¶é«”é™åˆ¶ï¼ˆMBï¼‰ */\n  totalMemory: number;\n  /** ä½¿ç”¨ç‡ï¼ˆ%ï¼‰ */\n  usagePercent: number;\n  /** æ˜¯å¦è™•æ–¼è¨˜æ†¶é«”å£“åŠ›ç‹€æ…‹ */\n  isUnderPressure: boolean;\n}\n\ninterface CleanupOptions {\n  /** æ¸…ç†ç†±å¿«å– */\n  clearHot?: boolean;\n  /** æ¸…ç†æº«å¿«å– */\n  clearWarm?: boolean;\n  /** å¼·åˆ¶æ¸…ç†ï¼ˆå³ä½¿æ²’æœ‰å£“åŠ›ï¼‰ */\n  force?: boolean;\n}\n\nclass MemoryManager {\n  private static instance: MemoryManager;\n  private cleanupTimer: NodeJS.Timeout | null = null;\n  private pressureThreshold = 0.8; // 80% è¨˜æ†¶é«”ä½¿ç”¨ç‡è¦–ç‚ºå£“åŠ›\n  private autoCleanupInterval = 5 * 60 * 1000; // 5 åˆ†é˜è‡ªå‹•æ¸…ç†ä¸€æ¬¡\n\n  private constructor() {\n    // å•Ÿå‹•è‡ªå‹•æ¸…ç†\n    this.startAutoCleanup();\n\n    // ç›£è½é é¢éš±è—äº‹ä»¶ï¼ˆç”¨æˆ¶åˆ‡æ›åˆ†é æ™‚æ¸…ç†ï¼‰\n    if (typeof window !== 'undefined') {\n      document.addEventListener('visibilitychange', () => {\n        if (document.hidden) {\n          this.cleanup({ clearHot: true });\n        }\n      });\n    }\n  }\n\n  static getInstance(): MemoryManager {\n    if (!MemoryManager.instance) {\n      MemoryManager.instance = new MemoryManager();\n    }\n    return MemoryManager.instance;\n  }\n\n  /**\n   * ç²å–è¨˜æ†¶é«”çµ±è¨ˆè³‡è¨Š\n   */\n  getMemoryStats(): MemoryStats | null {\n    if (typeof window === 'undefined' || !(performance as any).memory) {\n      return null;\n    }\n\n    const memory = (performance as any).memory;\n    const usedMemory = memory.usedJSHeapSize / 1024 / 1024; // è½‰æ›ç‚º MB\n    const totalMemory = memory.jsHeapSizeLimit / 1024 / 1024;\n    const usagePercent = (usedMemory / totalMemory) * 100;\n\n    return {\n      usedMemory: Math.round(usedMemory * 100) / 100,\n      totalMemory: Math.round(totalMemory * 100) / 100,\n      usagePercent: Math.round(usagePercent * 100) / 100,\n      isUnderPressure: usagePercent / 100 > this.pressureThreshold\n    };\n  }\n\n  /**\n   * æ¸…ç†è¨˜æ†¶é«”\n   */\n  async cleanup(options: CleanupOptions = {}): Promise<void> {\n    const { clearHot = false, clearWarm = false, force = false } = options;\n\n    // æª¢æŸ¥æ˜¯å¦éœ€è¦æ¸…ç†\n    if (!force) {\n      const stats = this.getMemoryStats();\n      if (!stats?.isUnderPressure) {\n        return; // è¨˜æ†¶é«”å……è¶³ï¼Œä¸éœ€æ¸…ç†\n      }\n    }\n\n    console.log('ğŸ§¹ é–‹å§‹æ¸…ç†è¨˜æ†¶é«”...');\n\n    // æ¸…ç†ç†±å¿«å–ï¼ˆè¨˜æ†¶é«”ï¼‰\n    if (clearHot) {\n      await cacheStrategy.clear('hot');\n      console.log('  âœ… æ¸…ç†ç†±å¿«å–');\n    }\n\n    // æ¸…ç†æº«å¿«å–ï¼ˆSessionStorageï¼‰\n    if (clearWarm) {\n      await cacheStrategy.clear('warm');\n      console.log('  âœ… æ¸…ç†æº«å¿«å–');\n    }\n\n    // è§¸ç™¼åƒåœ¾å›æ”¶ï¼ˆå¦‚æœç€è¦½å™¨æ”¯æ´ï¼‰\n    if (typeof window !== 'undefined' && (window as any).gc) {\n      try {\n        (window as any).gc();\n        console.log('  âœ… è§¸ç™¼åƒåœ¾å›æ”¶');\n      } catch {\n        // å¿½ç•¥éŒ¯èª¤\n      }\n    }\n\n    const afterStats = this.getMemoryStats();\n    if (afterStats) {\n      console.log(`  ğŸ“Š æ¸…ç†å¾Œè¨˜æ†¶é«”ä½¿ç”¨: ${afterStats.usedMemory} MB (${afterStats.usagePercent}%)`);\n    }\n  }\n\n  /**\n   * å•Ÿå‹•è‡ªå‹•æ¸…ç†\n   */\n  private startAutoCleanup(): void {\n    if (this.cleanupTimer) return;\n\n    this.cleanupTimer = setInterval(() => {\n      this.cleanup({ clearHot: true });\n    }, this.autoCleanupInterval);\n  }\n\n  /**\n   * åœæ­¢è‡ªå‹•æ¸…ç†\n   */\n  stopAutoCleanup(): void {\n    if (this.cleanupTimer) {\n      clearInterval(this.cleanupTimer);\n      this.cleanupTimer = null;\n    }\n  }\n\n  /**\n   * ç›£æ§è¨˜æ†¶é«”ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰\n   */\n  startMonitoring(interval: number = 10000): void {\n    if (typeof window === 'undefined') return;\n\n    setInterval(() => {\n      const stats = this.getMemoryStats();\n      if (stats) {\n        const emoji = stats.isUnderPressure ? 'âš ï¸' : 'âœ…';\n        console.log(\n          `${emoji} è¨˜æ†¶é«”ä½¿ç”¨: ${stats.usedMemory} MB / ${stats.totalMemory} MB (${stats.usagePercent}%)`\n        );\n\n        if (stats.isUnderPressure) {\n          console.warn('âš ï¸ è¨˜æ†¶é«”å£“åŠ›éé«˜ï¼Œå»ºè­°æ¸…ç†');\n        }\n      }\n    }, interval);\n  }\n\n  /**\n   * ç²å–å¿«å–çµ±è¨ˆ\n   */\n  getCacheStats() {\n    return cacheStrategy.getStats();\n  }\n}\n\n// åŒ¯å‡ºå–®ä¾‹\nexport const memoryManager = MemoryManager.getInstance();\n\n// åŒ¯å‡ºé¡å‹\nexport type { MemoryStats, CleanupOptions };\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/performance/performance-monitor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[397,400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[397,400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * VENTURO 5.0 - æ•ˆèƒ½ç›£æ§çµ„ä»¶\n *\n * é–‹ç™¼æ¨¡å¼ä¸‹é¡¯ç¤ºæ•ˆèƒ½æŒ‡æ¨™\n */\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { memoryManager, type MemoryStats } from './memory-manager';\nimport { cacheStrategy } from '@/lib/cache/cache-strategy';\n\nexport function PerformanceMonitor() {\n  const [stats, setStats] = useState<MemoryStats | null>(null);\n  const [cacheStats, setCacheStats] = useState<any>(null);\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    // åªåœ¨é–‹ç™¼æ¨¡å¼é¡¯ç¤º\n    if (process.env.NODE_ENV !== 'development') return;\n\n    const interval = setInterval(() => {\n      setStats(memoryManager.getMemoryStats());\n      setCacheStats(cacheStrategy.getStats());\n    }, 2000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  if (process.env.NODE_ENV !== 'development') return null;\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-[9999]\">\n      {/* åˆ‡æ›æŒ‰éˆ• */}\n      <button\n        onClick={() => setIsVisible(!isVisible)}\n        className=\"mb-2 px-3 py-2 bg-black/80 text-white rounded-lg text-xs font-mono hover:bg-black/90 transition-colors\"\n      >\n        {isVisible ? 'éš±è—' : 'é¡¯ç¤º'} æ•ˆèƒ½\n      </button>\n\n      {/* æ•ˆèƒ½é¢æ¿ */}\n      {isVisible && (\n        <div className=\"bg-black/90 text-white rounded-lg p-4 font-mono text-xs space-y-3 backdrop-blur-sm\">\n          {/* è¨˜æ†¶é«”ä½¿ç”¨ */}\n          <div>\n            <div className=\"font-bold mb-1\">è¨˜æ†¶é«”ä½¿ç”¨</div>\n            {stats ? (\n              <>\n                <div className=\"flex items-center gap-2\">\n                  <span>{stats.isUnderPressure ? 'âš ï¸' : 'âœ…'}</span>\n                  <span>\n                    {stats.usedMemory} MB / {stats.totalMemory} MB\n                  </span>\n                </div>\n                <div className=\"mt-1\">\n                  <div className=\"w-full bg-gray-700 rounded-full h-2\">\n                    <div\n                      className={`h-2 rounded-full transition-all ${\n                        stats.isUnderPressure ? 'bg-red-500' : 'bg-green-500'\n                      }`}\n                      style={{ width: `${stats.usagePercent}%` }}\n                    />\n                  </div>\n                  <div className=\"text-right mt-1 text-gray-400\">\n                    {stats.usagePercent}%\n                  </div>\n                </div>\n              </>\n            ) : (\n              <div className=\"text-gray-400\">ç„¡æ³•å–å¾—è¨˜æ†¶é«”è³‡è¨Š</div>\n            )}\n          </div>\n\n          {/* å¿«å–çµ±è¨ˆ */}\n          <div>\n            <div className=\"font-bold mb-1\">å¿«å–çµ±è¨ˆ</div>\n            {cacheStats ? (\n              <>\n                <div className=\"space-y-1\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-400\">ç†±å¿«å– (è¨˜æ†¶é«”):</span>\n                    <span>{cacheStats.hot.size} é …</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-400\">æº«å¿«å– (Session):</span>\n                    <span>{cacheStats.warm.size} é …</span>\n                  </div>\n                </div>\n              </>\n            ) : (\n              <div className=\"text-gray-400\">è¼‰å…¥ä¸­...</div>\n            )}\n          </div>\n\n          {/* æ“ä½œæŒ‰éˆ• */}\n          <div className=\"pt-2 border-t border-gray-700 space-y-2\">\n            <button\n              onClick={() => {\n                memoryManager.cleanup({ clearHot: true, force: true });\n                alert('å·²æ¸…ç†ç†±å¿«å–');\n              }}\n              className=\"w-full px-3 py-1.5 bg-yellow-600 hover:bg-yellow-700 rounded text-white transition-colors\"\n            >\n              æ¸…ç†ç†±å¿«å–\n            </button>\n            <button\n              onClick={() => {\n                memoryManager.cleanup({ clearHot: true, clearWarm: true, force: true });\n                alert('å·²æ¸…ç†æ‰€æœ‰å¿«å–');\n              }}\n              className=\"w-full px-3 py-1.5 bg-red-600 hover:bg-red-700 rounded text-white transition-colors\"\n            >\n              æ¸…ç†æ‰€æœ‰å¿«å–\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/store/lazy-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3220,3223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3220,3223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5118,5121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5118,5121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":288,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6570,6573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6570,6573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * VENTURO 5.0 - æŒ‰éœ€è¼‰å…¥ Store åŸºç¤æ¶æ§‹\n *\n * æ ¸å¿ƒæ¦‚å¿µï¼š\n * - ä¸é å…ˆè¼‰å…¥æ‰€æœ‰è³‡æ–™\n * - æ”¯æ´åˆ†é è¼‰å…¥\n * - è‡ªå‹•æ•´åˆä¸‰å±¤å¿«å–\n * - æä¾›è¼‰å…¥ç‹€æ…‹è¿½è¹¤\n */\n\nimport { cacheStrategy, type CacheKey } from '@/lib/cache/cache-strategy';\nimport { localDB } from '@/lib/db';\nimport { supabase } from '@/lib/supabase/client';\n\ninterface LazyLoadOptions {\n  /** è³‡æ–™è¡¨åç¨± */\n  table: string;\n  /** å¿«å– key å‰ç¶´ */\n  cachePrefix: string;\n  /** é è¨­æ¯é ç­†æ•¸ */\n  pageSize?: number;\n  /** æ˜¯å¦å•Ÿç”¨å¿«å– */\n  enableCache?: boolean;\n}\n\ninterface LoadState {\n  isLoading: boolean;\n  error: string | null;\n  lastUpdated: number | null;\n}\n\ninterface PaginatedData<T> {\n  data: T[];\n  total: number;\n  page: number;\n  pageSize: number;\n  hasMore: boolean;\n}\n\n/**\n * å»ºç«‹æ”¯æ´æŒ‰éœ€è¼‰å…¥çš„ Store åŸºç¤é¡åˆ¥\n */\nexport class LazyStore<T extends { id: string }> {\n  private options: Required<LazyLoadOptions>;\n  private loadStates = new Map<string, LoadState>();\n\n  constructor(options: LazyLoadOptions) {\n    this.options = {\n      pageSize: 10,\n      enableCache: true,\n      ...options\n    };\n  }\n\n  /**\n   * åˆ†é è¼‰å…¥è³‡æ–™\n   */\n  async fetchPage(\n    page: number = 1,\n    pageSize?: number\n  ): Promise<PaginatedData<T>> {\n    const actualPageSize = pageSize || this.options.pageSize;\n    const cacheKey = this.getCacheKey('page', `${page}-${actualPageSize}`);\n\n    // 1. å˜—è©¦å¾å¿«å–è®€å–\n    if (this.options.enableCache) {\n      const cached = await cacheStrategy.get<PaginatedData<T>>(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    }\n\n    // 2. å¾è³‡æ–™åº«è¼‰å…¥\n    this.setLoadState(cacheKey, { isLoading: true, error: null, lastUpdated: null });\n\n    try {\n      // å„ªå…ˆå¾ IndexedDB è®€å–\n      const localData = await this.fetchFromIndexedDB(page, actualPageSize);\n\n      if (localData.data.length > 0) {\n        // æœ‰æœ¬åœ°è³‡æ–™ï¼Œå…ˆè¿”å›\n        const result = localData;\n\n        // å¿«å–åˆ°ç†±å¿«å–ï¼ˆè¨˜æ†¶é«”ï¼‰\n        if (this.options.enableCache) {\n          await cacheStrategy.set(cacheKey, result, { level: 'hot' });\n        }\n\n        this.setLoadState(cacheKey, {\n          isLoading: false,\n          error: null,\n          lastUpdated: Date.now()\n        });\n\n        // èƒŒæ™¯åŒæ­¥ Supabaseï¼ˆä¸é˜»å¡ï¼‰\n        this.syncFromSupabase(page, actualPageSize, cacheKey);\n\n        return result;\n      }\n\n      // æ²’æœ‰æœ¬åœ°è³‡æ–™ï¼Œå¾ Supabase è¼‰å…¥\n      const supabaseData = await this.fetchFromSupabase(page, actualPageSize);\n\n      // å¿«å–åˆ°æº«å¿«å–ï¼ˆè·¨é é¢ï¼‰\n      if (this.options.enableCache) {\n        await cacheStrategy.set(cacheKey, supabaseData, { level: 'warm' });\n      }\n\n      this.setLoadState(cacheKey, {\n        isLoading: false,\n        error: null,\n        lastUpdated: Date.now()\n      });\n\n      return supabaseData;\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'è¼‰å…¥å¤±æ•—';\n\n      this.setLoadState(cacheKey, {\n        isLoading: false,\n        error: errorMessage,\n        lastUpdated: null\n      });\n\n      throw error;\n    }\n  }\n\n  /**\n   * è¼‰å…¥å–®ç­†è³‡æ–™\n   */\n  async fetchById(id: string): Promise<T | null> {\n    const cacheKey = this.getCacheKey('item', id);\n\n    // 1. å˜—è©¦å¾å¿«å–è®€å–\n    if (this.options.enableCache) {\n      const cached = await cacheStrategy.get<T>(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    }\n\n    // 2. å¾ IndexedDB è®€å–\n    try {\n      const localItem = await localDB.read(this.options.table as any, id);\n      if (localItem) {\n        // å¿«å–åˆ°ç†±å¿«å–\n        if (this.options.enableCache) {\n          await cacheStrategy.set(cacheKey, localItem, { level: 'hot' });\n        }\n        return localItem as T;\n      }\n    } catch (error) {\n      console.warn(`å¾ IndexedDB è®€å– ${id} å¤±æ•—`, error);\n    }\n\n    // 3. å¾ Supabase è®€å–\n    try {\n      const { data, error } = await supabase\n        .from(this.options.table)\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      // å¿«å–åˆ°æº«å¿«å–\n      if (this.options.enableCache && data) {\n        await cacheStrategy.set(cacheKey, data, { level: 'warm' });\n      }\n\n      return data as T;\n    } catch (error) {\n      console.error(`å¾ Supabase è®€å– ${id} å¤±æ•—`, error);\n      return null;\n    }\n  }\n\n  /**\n   * æ¸…é™¤å¿«å–\n   */\n  async clearCache(key?: string): Promise<void> {\n    if (key) {\n      await cacheStrategy.delete(this.getCacheKey('custom', key));\n    } else {\n      // æ¸…é™¤æ‰€æœ‰ç›¸é—œå¿«å–\n      const stats = cacheStrategy.getStats();\n      const prefix = this.options.cachePrefix;\n\n      for (const key of [...stats.hot.keys, ...stats.warm.keys]) {\n        if (key.startsWith(prefix)) {\n          await cacheStrategy.delete(key);\n        }\n      }\n    }\n  }\n\n  /**\n   * ç²å–è¼‰å…¥ç‹€æ…‹\n   */\n  getLoadState(key: string): LoadState {\n    return (\n      this.loadStates.get(key) || {\n        isLoading: false,\n        error: null,\n        lastUpdated: null\n      }\n    );\n  }\n\n  // ==================== ç§æœ‰æ–¹æ³• ====================\n\n  private getCacheKey(type: string, id: string): CacheKey {\n    return `${this.options.cachePrefix}:${type}:${id}`;\n  }\n\n  private setLoadState(key: string, state: LoadState): void {\n    this.loadStates.set(key, state);\n  }\n\n  private async fetchFromIndexedDB(\n    page: number,\n    pageSize: number\n  ): Promise<PaginatedData<T>> {\n    try {\n      const allData = (await localDB.getAll(this.options.table as any)) as T[];\n      const start = (page - 1) * pageSize;\n      const end = start + pageSize;\n      const pageData = allData.slice(start, end);\n\n      return {\n        data: pageData,\n        total: allData.length,\n        page,\n        pageSize,\n        hasMore: end < allData.length\n      };\n    } catch {\n      return {\n        data: [],\n        total: 0,\n        page,\n        pageSize,\n        hasMore: false\n      };\n    }\n  }\n\n  private async fetchFromSupabase(\n    page: number,\n    pageSize: number\n  ): Promise<PaginatedData<T>> {\n    const start = (page - 1) * pageSize;\n    const end = start + pageSize - 1;\n\n    const { data, error, count } = await supabase\n      .from(this.options.table)\n      .select('*', { count: 'exact' })\n      .range(start, end)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n\n    return {\n      data: (data as T[]) || [],\n      total: count || 0,\n      page,\n      pageSize,\n      hasMore: (count || 0) > end + 1\n    };\n  }\n\n  private async syncFromSupabase(\n    page: number,\n    pageSize: number,\n    cacheKey: string\n  ): Promise<void> {\n    try {\n      const supabaseData = await this.fetchFromSupabase(page, pageSize);\n\n      // æ›´æ–°å¿«å–\n      if (this.options.enableCache) {\n        await cacheStrategy.set(cacheKey, supabaseData, { level: 'warm' });\n      }\n\n      // åŒæ­¥åˆ° IndexedDB\n      for (const item of supabaseData.data) {\n        await localDB.create(this.options.table as any, item);\n      }\n    } catch (error) {\n      console.warn('èƒŒæ™¯åŒæ­¥å¤±æ•—', error);\n    }\n  }\n}\n\n// åŒ¯å‡ºé¡å‹\nexport type { LazyLoadOptions, LoadState, PaginatedData };\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/supabase/api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[122,125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[122,125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[128,131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[128,131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[302,305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[302,305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[644,647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[644,647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[650,653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[650,653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[824,827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[824,827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1093,1096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1093,1096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1314,1317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1314,1317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1340,1343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1340,1343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2117,2120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2117,2120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2143,2146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2143,2146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2336,2339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2336,2339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2370,2373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2370,2373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2770,2773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2770,2773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4286,4289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4286,4289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4928,4931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4928,4931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4966,4969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4966,4969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5220,5223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5220,5223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5249,5252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5249,5252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5772,5775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5772,5775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5825,5828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5825,5828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5841,5844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5841,5844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6075,6078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6075,6078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6104,6107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6104,6107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":285,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7300,7303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7300,7303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7884,7887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7884,7887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8507,8510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8507,8510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8534,8537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8534,8537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":339,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8633,8636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8633,8636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":342,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":342,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8700,8703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8700,8703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9050,9053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9050,9053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":359,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9068,9071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9068,9071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":32,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './client';\n\n/**\n * å°‡ camelCase è½‰æ›ç‚º snake_case\n * ä¸¦æ¸…ç†ç©ºå­—ä¸²ï¼ˆè½‰æ›ç‚º nullï¼‰\n */\nfunction toSnakeCase(obj: any): any {\n  if (obj === null || obj === undefined) return obj;\n  if (Array.isArray(obj)) return obj.map(toSnakeCase);\n  if (typeof obj !== 'object') return obj;\n\n  const result: any = {};\n  for (const key in obj) {\n    const snakeKey = key.replace(/([A-Z])/g, '_$1').toLowerCase();\n    const value = obj[key];\n    // å°‡ç©ºå­—ä¸²è½‰æ›ç‚º nullï¼ˆé¿å… PostgreSQL DATE/TIMESTAMPTZ æ¬„ä½éŒ¯èª¤ï¼‰\n    result[snakeKey] = value === '' ? null : toSnakeCase(value);\n  }\n  return result;\n}\n\n/**\n * å°‡ snake_case è½‰æ›ç‚º camelCase\n */\nfunction toCamelCase(obj: any): any {\n  if (obj === null || obj === undefined) return obj;\n  if (Array.isArray(obj)) return obj.map(toCamelCase);\n  if (typeof obj !== 'object') return obj;\n\n  const result: any = {};\n  for (const key in obj) {\n    const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n    result[camelKey] = toCamelCase(obj[key]);\n  }\n  return result;\n}\n\nexport interface QueryOptions {\n  select?: string;\n  filters?: Record<string, any>;\n  orderBy?: { column: string; ascending?: boolean };\n  limit?: number;\n  offset?: number;\n}\n\n/**\n * Venturo API çµ±ä¸€æœå‹™å±¤\n * æä¾›æ‰€æœ‰è³‡æ–™åº«æ“ä½œçš„æŠ½è±¡æ¥å£\n */\nexport class VenturoAPI {\n  /**\n   * å‰µå»ºæ–°è¨˜éŒ„\n   */\n  static async create<T = any>(table: string, data: any): Promise<T> {\n    try {\n      // å°‡ camelCase è½‰æ›ç‚º snake_case\n      const snakeData = toSnakeCase(data);\n\n      const { data: result, error } = await supabase\n        .from(table)\n        .insert(snakeData)\n        .select()\n        .single();\n\n      if (error) {\n        console.error(`âŒ Create error in ${table}:`, {\n          message: error.message,\n          details: error.details,\n          hint: error.hint,\n          code: error.code,\n          data: snakeData\n        });\n        throw new Error(`å‰µå»ºå¤±æ•—: ${error.message}`);\n      }\n\n      // å°‡å›å‚³çš„ snake_case è½‰æ›ç‚º camelCase\n      return toCamelCase(result) as T;\n    } catch (error) {\n      console.error(`API Create Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æ‰¹é‡å‰µå»ºè¨˜éŒ„\n   */\n  static async createMany<T = any>(table: string, data: any[]): Promise<T[]> {\n    try {\n      // å°‡ camelCase è½‰æ›ç‚º snake_case\n      const snakeData = data.map(toSnakeCase);\n\n      const { data: result, error } = await supabase\n        .from(table as any)\n        .insert(snakeData as any)\n        .select();\n\n      if (error) {\n        console.error(`CreateMany error in ${table}:`, error);\n        throw new Error(`æ‰¹é‡å‰µå»ºå¤±æ•—: ${error.message}`);\n      }\n\n      // å°‡å›å‚³çš„ snake_case è½‰æ›ç‚º camelCase\n      return toCamelCase(result) as T[];\n    } catch (error) {\n      console.error(`API CreateMany Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æŸ¥è©¢è¨˜éŒ„\n   */\n  static async read<T = any>(table: string, options: QueryOptions = {}): Promise<T[]> {\n    try {\n      let query = supabase.from(table).select(options.select || '*');\n\n      // æ·»åŠ éæ¿¾æ¢ä»¶ (å°‡ camelCase key è½‰ç‚º snake_case)\n      if (options.filters) {\n        Object.entries(options.filters).forEach(([key, value]) => {\n          const snakeKey = key.replace(/([A-Z])/g, '_$1').toLowerCase();\n          if (Array.isArray(value)) {\n            query = query.in(snakeKey, value);\n          } else if (value !== null && value !== undefined) {\n            query = query.eq(snakeKey, value);\n          }\n        });\n      }\n\n      // æ’åº (å°‡ camelCase column è½‰ç‚º snake_case)\n      if (options.orderBy) {\n        const snakeColumn = options.orderBy.column.replace(/([A-Z])/g, '_$1').toLowerCase();\n        query = query.order(snakeColumn, {\n          ascending: options.orderBy.ascending ?? true\n        });\n      }\n\n      // åˆ†é \n      if (options.limit) {\n        query = query.limit(options.limit);\n      }\n      if (options.offset) {\n        query = query.range(options.offset, options.offset + (options.limit || 10) - 1);\n      }\n\n      const { data, error } = await query;\n\n      if (error) {\n        console.error(`Read error in ${table}:`, error);\n        throw new Error(`æŸ¥è©¢å¤±æ•—: ${error.message}`);\n      }\n\n      // å°‡å›å‚³çš„ snake_case è½‰æ›ç‚º camelCase\n      return toCamelCase(data || []) as T[];\n    } catch (error) {\n      console.error(`API Read Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æ ¹æ“š ID æŸ¥è©¢å–®ç­†è¨˜éŒ„\n   */\n  static async readById<T = any>(table: string, id: string): Promise<T | null> {\n    try {\n      const { data, error } = await supabase\n        .from(table)\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) {\n        if (error.code === 'PGRST116') {\n          return null; // è¨˜éŒ„ä¸å­˜åœ¨\n        }\n        console.error(`ReadById error in ${table}:`, error);\n        throw new Error(`æŸ¥è©¢å¤±æ•—: ${error.message}`);\n      }\n\n      // å°‡å›å‚³çš„ snake_case è½‰æ›ç‚º camelCase\n      return toCamelCase(data) as T;\n    } catch (error) {\n      console.error(`API ReadById Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æ›´æ–°è¨˜éŒ„\n   */\n  static async update<T = any>(table: string, id: string, data: any): Promise<T> {\n    try {\n      // å°‡ camelCase è½‰æ›ç‚º snake_case\n      const snakeData = toSnakeCase(data);\n      // æ·»åŠ æ›´æ–°æ™‚é–“\n      const updateData = {\n        ...snakeData,\n        updated_at: new Date().toISOString()\n      };\n\n      const queryBuilder: any = supabase.from(table as any);\n      const { data: result, error } = await queryBuilder\n        .update(updateData)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) {\n        console.error(`Update error in ${table}:`, error);\n        throw new Error(`æ›´æ–°å¤±æ•—: ${error.message}`);\n      }\n\n      // å°‡å›å‚³çš„ snake_case è½‰æ›ç‚º camelCase\n      return toCamelCase(result) as T;\n    } catch (error) {\n      console.error(`API Update Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æ¢ä»¶æ›´æ–°è¨˜éŒ„\n   */\n  static async updateWhere<T = any>(\n    table: string,\n    filters: Record<string, any>,\n    data: any\n  ): Promise<T[]> {\n    try {\n      // å°‡ camelCase è½‰æ›ç‚º snake_case\n      const snakeData = toSnakeCase(data);\n      const updateData = {\n        ...snakeData,\n        updated_at: new Date().toISOString()\n      };\n\n      let query: any = supabase.from(table as any);\n      query = query.update(updateData);\n\n      // éæ¿¾æ¢ä»¶ä¹Ÿè½‰æ›\n      Object.entries(filters).forEach(([key, value]) => {\n        const snakeKey = key.replace(/([A-Z])/g, '_$1').toLowerCase();\n        query = query.eq(snakeKey, value);\n      });\n\n      const { data: result, error } = await query.select();\n\n      if (error) {\n        console.error(`UpdateWhere error in ${table}:`, error);\n        throw new Error(`æ¢ä»¶æ›´æ–°å¤±æ•—: ${error.message}`);\n      }\n\n      // å°‡å›å‚³çš„ snake_case è½‰æ›ç‚º camelCase\n      return toCamelCase(result || []) as T[];\n    } catch (error) {\n      console.error(`API UpdateWhere Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * åˆªé™¤è¨˜éŒ„\n   */\n  static async delete(table: string, id: string): Promise<boolean> {\n    try {\n      const { error } = await supabase\n        .from(table)\n        .delete()\n        .eq('id', id);\n\n      if (error) {\n        console.error(`Delete error in ${table}:`, error);\n        throw new Error(`åˆªé™¤å¤±æ•—: ${error.message}`);\n      }\n\n      return true;\n    } catch (error) {\n      console.error(`API Delete Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * æ¢ä»¶åˆªé™¤è¨˜éŒ„\n   */\n  static async deleteWhere(table: string, filters: Record<string, any>): Promise<boolean> {\n    try {\n      let query = supabase.from(table).delete();\n\n      Object.entries(filters).forEach(([key, value]) => {\n        query = query.eq(key, value);\n      });\n\n      const { error } = await query;\n\n      if (error) {\n        console.error(`DeleteWhere error in ${table}:`, error);\n        throw new Error(`æ¢ä»¶åˆªé™¤å¤±æ•—: ${error.message}`);\n      }\n\n      return true;\n    } catch (error) {\n      console.error(`API DeleteWhere Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * è¨ˆæ•¸æŸ¥è©¢\n   */\n  static async count(table: string, filters?: Record<string, any>): Promise<number> {\n    try {\n      let query = supabase.from(table).select('*', { count: 'exact', head: true });\n\n      if (filters) {\n        Object.entries(filters).forEach(([key, value]) => {\n          query = query.eq(key, value);\n        });\n      }\n\n      const { count, error } = await query;\n\n      if (error) {\n        console.error(`Count error in ${table}:`, error);\n        throw new Error(`è¨ˆæ•¸å¤±æ•—: ${error.message}`);\n      }\n\n      return count || 0;\n    } catch (error) {\n      console.error(`API Count Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * åŸ·è¡ŒåŸç”Ÿ SQL æŸ¥è©¢\n   */\n  static async query<T = any>(sql: string, params?: any[]): Promise<T[]> {\n    try {\n      const { data, error } = await supabase.rpc('execute_sql' as any, {\n        query: sql,\n        params: params || []\n      } as any);\n\n      if (error) {\n        console.error(`SQL Query error:`, error);\n        throw new Error(`SQL æŸ¥è©¢å¤±æ•—: ${error.message}`);\n      }\n\n      return (data || []) as T[];\n    } catch (error) {\n      console.error(`API Query Error:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * äº‹å‹™è™•ç†\n   */\n  static async transaction(operations: (() => Promise<any>)[]): Promise<any[]> {\n    const results = [];\n\n    for (const operation of operations) {\n      try {\n        const result = await operation();\n        results.push(result);\n      } catch (error) {\n        // å¦‚æœä»»ä½•æ“ä½œå¤±æ•—ï¼Œæ‹‹å‡ºéŒ¯èª¤ï¼ˆç°¡å–®çš„äº‹å‹™è™•ç†ï¼‰\n        console.error('Transaction failed:', error);\n        throw new Error(`äº‹å‹™è™•ç†å¤±æ•—: ${error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤'}`);\n      }\n    }\n\n    return results;\n  }\n}\n\n// å°å‡º Supabase å®¢æˆ¶ç«¯ä¾›ç‰¹æ®Šéœ€æ±‚ä½¿ç”¨\nexport { supabase };","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/supabase/client.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SupabaseClient' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient, SupabaseClient } from '@supabase/supabase-js'\nimport { Database } from './types'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://placeholder.supabase.co'\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'placeholder-key'\n\n// ç°¡å–®çš„å–®ä¾‹æ¨¡å¼ï¼Œé¿å…è¤‡é›œçš„ Proxy\n// ğŸ”§ æ–°å¢ï¼šfetch timeout é˜²æ­¢è«‹æ±‚å¡ä½\nexport const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {\n  auth: {\n    autoRefreshToken: false,\n    persistSession: false,\n    detectSessionInUrl: false\n  },\n  global: {\n    fetch: (url, options = {}) => {\n      // 60 ç§’è¶…æ™‚ï¼Œçµ¦æœ¬åœ°ç¶²è·¯æ›´å¤šæ™‚é–“\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 60000);\n\n      return fetch(url, {\n        ...options,\n        signal: controller.signal,\n      }).finally(() => clearTimeout(timeoutId));\n    },\n  },\n})\n\n// æ¸¬è©¦é€£æ¥\nexport async function testSupabaseConnection() {\n  try {\n    const { data, error } = await supabase.from('employees').select('count').limit(1);\n\n    if (error) {\n      console.error('âŒ Supabase é€£æ¥å¤±æ•—:', error.message);\n      return { success: false, error: error.message };\n    }\n\n    console.log('âœ… Supabase é€£æ¥æˆåŠŸï¼');\n    return { success: true, data };\n  } catch (err) {\n    console.error('âŒ Supabase é€£æ¥éŒ¯èª¤:', err);\n    return { success: false, error: String(err) };\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/supabase/helpers.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141,144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141,144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[156,159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[156,159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[179,182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[179,182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[283,286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[283,286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[307,310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[307,310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330,333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330,333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[411,414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[411,414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Supabase å‹åˆ¥è¼”åŠ©å‡½æ•¸\n * ç”¨æ–¼è™•ç†è‡ªå‹•ç”Ÿæˆå‹åˆ¥çš„å•é¡Œ\n */\n\n/**\n * å®‰å…¨çš„ insert è¼”åŠ©å‡½æ•¸\n * è§£æ±º Supabase insert å‹åˆ¥æ¨æ–·ç‚º never çš„å•é¡Œ\n */\nexport function safeInsert<T = any>(data: T): any {\n  return data as any;\n}\n\n/**\n * å®‰å…¨çš„ update è¼”åŠ©å‡½æ•¸\n * è§£æ±º Supabase update å‹åˆ¥æ¨æ–·ç‚º never çš„å•é¡Œ\n */\nexport function safeUpdate<T = any>(data: Partial<T>): any {\n  return data as any;\n}\n\n/**\n * å®‰å…¨çš„è³‡æ–™è®€å–\n * è™•ç† Supabase æŸ¥è©¢çµæœçš„å‹åˆ¥å•é¡Œ\n */\nexport function safeData<T = any>(data: unknown): T {\n  return data as T;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/supabase/storage.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './client';\n\nexport interface UploadProgress {\n  loaded: number;\n  total: number;\n  percentage: number;\n}\n\nexport interface UploadResult {\n  url: string;\n  path: string;\n  fileName: string;\n}\n\n/**\n * ä¸Šå‚³æª”æ¡ˆåˆ° Supabase Storage\n * @param file è¦ä¸Šå‚³çš„æª”æ¡ˆ\n * @param bucket Storage bucket åç¨±ï¼ˆé è¨­ï¼š'workspace-files'ï¼‰\n * @param folder è³‡æ–™å¤¾è·¯å¾‘ï¼ˆé¸å¡«ï¼‰\n * @param onProgress ä¸Šå‚³é€²åº¦å›èª¿\n * @returns ä¸Šå‚³çµæœåŒ…å«æª”æ¡ˆ URL å’Œè·¯å¾‘\n */\nexport async function uploadFile(\n  file: File,\n  bucket: string = 'workspace-files',\n  folder?: string,\n  onProgress?: (progress: UploadProgress) => void\n): Promise<UploadResult> {\n  try {\n    // ç”Ÿæˆå”¯ä¸€æª”å (é¿å…æª”åè¡çª)\n    const timestamp = Date.now();\n    const randomStr = Math.random().toString(36).substring(2, 8);\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${timestamp}_${randomStr}.${fileExt}`;\n\n    // çµ„åˆå®Œæ•´è·¯å¾‘\n    const file_path = folder ? `${folder}/${fileName}` : fileName;\n\n    // æ¨¡æ“¬é€²åº¦æ›´æ–° (Supabase JS å®¢æˆ¶ç«¯ä¸ç›´æ¥æ”¯æ´é€²åº¦è¿½è¹¤)\n    if (onProgress) {\n      onProgress({ loaded: 0, total: file.size, percentage: 0 });\n    }\n\n    // ä¸Šå‚³æª”æ¡ˆ\n    // cacheControl: å¿«å–æ™‚é–“ï¼ˆç§’ï¼‰\n    // 3600 = 1å°æ™‚, 86400 = 1å¤©, 2592000 = 30å¤©, 7776000 = 90å¤©\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .upload(file_path, file, {\n        cacheControl: '7776000', // 90 å¤©å¿«å–\n        upsert: false\n      });\n\n    if (error) {\n      throw new Error(`æª”æ¡ˆä¸Šå‚³å¤±æ•—: ${error.message}`);\n    }\n\n    // æ›´æ–°é€²åº¦ç‚ºå®Œæˆ\n    if (onProgress) {\n      onProgress({ loaded: file.size, total: file.size, percentage: 100 });\n    }\n\n    // ç²å–å…¬é–‹ URL\n    const { data: urlData } = supabase.storage\n      .from(bucket)\n      .getPublicUrl(file_path);\n\n    return {\n      url: urlData.publicUrl,\n      path: file_path,\n      fileName: file.name\n    };\n  } catch (error) {\n    console.error('Upload file error:', error);\n    throw error;\n  }\n}\n\n/**\n * æ‰¹æ¬¡ä¸Šå‚³å¤šå€‹æª”æ¡ˆ\n * @param files è¦ä¸Šå‚³çš„æª”æ¡ˆé™£åˆ—\n * @param bucket Storage bucket åç¨±\n * @param folder è³‡æ–™å¤¾è·¯å¾‘\n * @param onProgress æ¯å€‹æª”æ¡ˆçš„ä¸Šå‚³é€²åº¦å›èª¿\n * @returns ä¸Šå‚³çµæœé™£åˆ—\n */\nexport async function uploadFiles(\n  files: File[],\n  bucket: string = 'workspace-files',\n  folder?: string,\n  onProgress?: (fileIndex: number, progress: UploadProgress) => void\n): Promise<UploadResult[]> {\n  const results: UploadResult[] = [];\n\n  for (let i = 0; i < files.length; i++) {\n    const file = files[i];\n    const result = await uploadFile(\n      file,\n      bucket,\n      folder,\n      onProgress ? (progress) => onProgress(i, progress) : undefined\n    );\n    results.push(result);\n  }\n\n  return results;\n}\n\n/**\n * åˆªé™¤æª”æ¡ˆ\n * @param path æª”æ¡ˆè·¯å¾‘\n * @param bucket Storage bucket åç¨±\n */\nexport async function deleteFile(\n  path: string,\n  bucket: string = 'workspace-files'\n): Promise<void> {\n  try {\n    const { error } = await supabase.storage\n      .from(bucket)\n      .remove([path]);\n\n    if (error) {\n      throw new Error(`æª”æ¡ˆåˆªé™¤å¤±æ•—: ${error.message}`);\n    }\n  } catch (error) {\n    console.error('Delete file error:', error);\n    throw error;\n  }\n}\n\n/**\n * ä¸‹è¼‰æª”æ¡ˆ\n * @param path æª”æ¡ˆè·¯å¾‘\n * @param bucket Storage bucket åç¨±\n * @param fileName ä¸‹è¼‰æ™‚çš„æª”æ¡ˆåç¨±\n */\nexport async function downloadFile(\n  path: string,\n  bucket: string = 'workspace-files',\n  fileName?: string\n): Promise<void> {\n  try {\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .download(path);\n\n    if (error) {\n      throw new Error(`æª”æ¡ˆä¸‹è¼‰å¤±æ•—: ${error.message}`);\n    }\n\n    // å‰µå»ºä¸‹è¼‰é€£çµ\n    const url = URL.createObjectURL(data);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = fileName || path.split('/').pop() || 'download';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n  } catch (error) {\n    console.error('Download file error:', error);\n    throw error;\n  }\n}\n\n/**\n * ç²å–æª”æ¡ˆçš„å…¬é–‹ URL\n * @param path æª”æ¡ˆè·¯å¾‘\n * @param bucket Storage bucket åç¨±\n * @returns å…¬é–‹ URL\n */\nexport function getPublicUrl(\n  path: string,\n  bucket: string = 'workspace-files'\n): string {\n  const { data } = supabase.storage\n    .from(bucket)\n    .getPublicUrl(path);\n\n  return data.publicUrl;\n}\n\n/**\n * åˆ—å‡ºè³‡æ–™å¤¾ä¸­çš„æª”æ¡ˆ\n * @param folder è³‡æ–™å¤¾è·¯å¾‘\n * @param bucket Storage bucket åç¨±\n */\nexport async function listFiles(\n  folder?: string,\n  bucket: string = 'workspace-files'\n) {\n  try {\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .list(folder, {\n        limit: 100,\n        offset: 0,\n        sortBy: { column: 'created_at', order: 'desc' }\n      });\n\n    if (error) {\n      throw new Error(`åˆ—å‡ºæª”æ¡ˆå¤±æ•—: ${error.message}`);\n    }\n\n    return data;\n  } catch (error) {\n    console.error('List files error:', error);\n    throw error;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/supabase/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/sync/background-sync-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1724,1727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1724,1727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2062,2065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2062,2065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2641,2644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2641,2644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2832,2835],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2832,2835],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2936,2939],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2936,2939],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3398,3401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3398,3401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3830,3833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3830,3833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4814,4817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4814,4817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4999,5002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4999,5002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5481,5484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5481,5484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5819,5822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5819,5822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6394,6397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6394,6397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6807,6810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6807,6810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7111,7114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7111,7114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7646,7649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7646,7649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7960,7963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7960,7963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * èƒŒæ™¯åŒæ­¥æœå‹™\n *\n * è² è²¬è™•ç†é›¢ç·šæ™‚çš„è³‡æ–™åŒæ­¥ï¼ŒåŒ…æ‹¬ï¼š\n * 1. TBC ç·¨è™Ÿè½‰æ›ï¼ˆé›¢ç·šå»ºç«‹çš„é …ç›®ï¼‰\n * 2. å¾…åŒæ­¥çš„æ–°å¢/ä¿®æ”¹é …ç›®\n * 3. å¾…åˆªé™¤çš„é …ç›®\n *\n * æ¶æ§‹ï¼šåŒæ­¥é‚è¼¯èˆ‡è³‡æ–™è®€å–åˆ†é›¢\n */\n\nimport { supabase } from '@/lib/supabase/client';\nimport { localDB } from '@/lib/db';\nimport { TABLES, TableName } from '@/lib/db/schemas';\nimport { logger } from '@/lib/utils/logger';\n\nexport class BackgroundSyncService {\n  private syncInProgress: Set<string> = new Set();\n\n  /**\n   * åŒæ­¥å–®ä¸€è¡¨æ ¼çš„æ‰€æœ‰å¾…è™•ç†é …ç›®\n   */\n  async syncTable(tableName: TableName): Promise<void> {\n    // é˜²æ­¢é‡è¤‡åŒæ­¥\n    if (this.syncInProgress.has(tableName)) {\n      logger.log(`â³ [${tableName}] åŒæ­¥é€²è¡Œä¸­ï¼Œè·³é`);\n      return;\n    }\n\n    try {\n      this.syncInProgress.add(tableName);\n      logger.log(`ğŸ”„ [${tableName}] é–‹å§‹èƒŒæ™¯åŒæ­¥...`);\n\n      // 1. åŒæ­¥ TBC ç·¨è™Ÿè½‰æ›\n      await this.syncTbcCodes(tableName);\n\n      // 2. åŒæ­¥å¾…ä¸Šå‚³é …ç›®\n      await this.syncPendingUpserts(tableName);\n\n      // 3. åŒæ­¥å¾…åˆªé™¤é …ç›®\n      await this.syncPendingDeletes(tableName);\n\n      logger.log(`âœ… [${tableName}] èƒŒæ™¯åŒæ­¥å®Œæˆ`);\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] èƒŒæ™¯åŒæ­¥å¤±æ•—:`, error);\n      // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œéœé»˜å¤±æ•—\n    } finally {\n      this.syncInProgress.delete(tableName);\n    }\n  }\n\n  /**\n   * åŒæ­¥æ‰€æœ‰è¡¨æ ¼\n   */\n  async syncAllTables(): Promise<void> {\n    const tables = Object.values(TABLES);\n\n    logger.log('ğŸŒ é–‹å§‹åŒæ­¥æ‰€æœ‰è¡¨æ ¼...');\n\n    // ä¸¦è¡ŒåŒæ­¥æ‰€æœ‰è¡¨æ ¼\n    await Promise.allSettled(\n      tables.map(tableName => this.syncTable(tableName))\n    );\n\n    logger.log('âœ… æ‰€æœ‰è¡¨æ ¼åŒæ­¥å®Œæˆ');\n  }\n\n  /**\n   * 1. åŒæ­¥ TBC ç·¨è™Ÿè½‰æ›\n   *\n   * å°‡é›¢ç·šå»ºç«‹çš„é …ç›®ï¼ˆTBC ç·¨è™Ÿï¼‰è½‰æ›ç‚ºæ­£å¼ç·¨è™Ÿ\n   */\n  private async syncTbcCodes(tableName: TableName): Promise<void> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName);\n      const tbcItems = allLocalItems.filter((item: unknown) => {\n        const typedItem = item as any;\n        // TODO: è»Ÿåˆªé™¤æ©Ÿåˆ¶éœ€è¦é‡æ–°è¨­è¨ˆï¼ˆç›®å‰æš«æ™‚ç§»é™¤ _deleted éæ¿¾ï¼‰\n        return typedItem.code && typedItem.code.endsWith('TBC');\n      });\n\n      if (tbcItems.length === 0) return;\n\n      logger.log(`ğŸ”§ [${tableName}] ç™¼ç¾ ${tbcItems.length} ç­† TBC ç·¨è™Ÿï¼Œæº–å‚™è½‰æ›...`);\n\n      for (const item of tbcItems) {\n        try {\n          const typedItem = item as any;\n          const itemData = { ...typedItem };\n          delete itemData.code; // ç§»é™¤ TBC code\n\n          // ä¸Šå‚³åˆ° Supabaseï¼ˆæœƒè‡ªå‹•ç”Ÿæˆæ­£å¼ç·¨è™Ÿï¼‰\n          // @ts-ignore\n          const { data: supabaseData, error } = await supabase.from(tableName).insert([itemData]).select().single();\n\n          if (error) throw error;\n          if (!supabaseData) throw new Error('No data returned from insert');\n\n          // æ›´æ–° IndexedDBï¼ˆç”¨æ–°çš„æ­£å¼ç·¨è™Ÿï¼‰\n          await localDB.delete(tableName, typedItem.id);\n          // @ts-ignore\n          await localDB.put(tableName, {\n            ...(supabaseData as any),\n            _needs_sync: false,\n            _synced_at: new Date().toISOString()\n          });\n\n          logger.log(`âœ… [${tableName}] TBC ç·¨è™Ÿå·²è½‰æ›: ${typedItem.code} â†’ ${(supabaseData as any).code}`);\n        } catch (error) {\n          logger.error(`âŒ [${tableName}] TBC ç·¨è™Ÿè½‰æ›å¤±æ•—:`, (item as any).code, error);\n        }\n      }\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] syncTbcCodes å¤±æ•—:`, error);\n    }\n  }\n\n  /**\n   * 2. åŒæ­¥å¾…ä¸Šå‚³é …ç›®ï¼ˆæ–°å¢/ä¿®æ”¹ï¼‰\n   *\n   * åŒæ­¥æ¨™è¨˜ç‚º sync_status: 'pending' çš„é …ç›®\n   */\n  private async syncPendingUpserts(tableName: TableName): Promise<void> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName);\n      const pendingUpserts = allLocalItems.filter((item: unknown) => {\n        const typedItem = item as any;\n        // éæ¿¾ï¼šå¾…åŒæ­¥ ä¸” ä¸æ˜¯ TBC ç·¨è™Ÿ ä¸” æœªè»Ÿåˆªé™¤\n        return typedItem._needs_sync === true &&\n               !(typedItem.code && typedItem.code.endsWith('TBC')) &&\n               !typedItem._deleted;\n      });\n\n      if (pendingUpserts.length === 0) return;\n\n      logger.log(`ğŸ“¤ [${tableName}] ç™¼ç¾ ${pendingUpserts.length} ç­†å¾…åŒæ­¥é …ç›®ï¼Œé–‹å§‹ä¸Šå‚³...`);\n\n      for (const item of pendingUpserts) {\n        try {\n          const typedItem = item as any;\n          // ç§»é™¤åŒæ­¥æ¨™è¨˜æ¬„ä½\n          const { _needs_sync, _synced_at, _deleted, temp_code, ...syncData } = typedItem;\n\n          // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆupdateï¼‰æˆ–æ–°å»ºï¼ˆinsertï¼‰\n          const { data: existing } = await supabase\n            .from(tableName)\n            .select('id')\n            .eq('id', typedItem.id)\n            .single();\n\n          if (existing) {\n            // æ›´æ–°\n            // @ts-ignore\n            const { error } = await supabase.from(tableName).update(syncData).eq('id', typedItem.id);\n\n            if (error) throw error;\n            logger.log(`âœ… [${tableName}] æ›´æ–°æˆåŠŸ: ${typedItem.id}`);\n          } else {\n            // æ–°å¢\n            // @ts-ignore\n            const { error } = await supabase.from(tableName).insert([syncData]);\n\n            if (error) throw error;\n            logger.log(`âœ… [${tableName}] æ–°å¢æˆåŠŸ: ${typedItem.id}`);\n          }\n\n          // æ›´æ–° IndexedDBï¼ˆæ¨™è¨˜ç‚ºå·²åŒæ­¥ï¼‰\n          // @ts-ignore\n          await localDB.put(tableName, {\n            ...(item as any),\n            _needs_sync: false,\n            _synced_at: new Date().toISOString()\n          });\n        } catch (error) {\n          logger.error(`âŒ [${tableName}] åŒæ­¥å¤±æ•—:`, (item as any).id, error);\n        }\n      }\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] syncPendingUpserts å¤±æ•—:`, error);\n    }\n  }\n\n  /**\n   * 3. åŒæ­¥å¾…åˆªé™¤é …ç›®\n   *\n   * è™•ç† syncQueue è¡¨ä¸­çš„åˆªé™¤æ“ä½œ\n   */\n  private async syncPendingDeletes(tableName: TableName): Promise<void> {\n    try {\n      // å¾ syncQueue è¡¨ä¸­å–å¾—è©²è¡¨çš„åˆªé™¤æ“ä½œ\n      const allQueueItems = await localDB.getAll('syncQueue');\n      const pendingDeletes = allQueueItems.filter((item: unknown) => {\n        const typedItem = item as any;\n        return typedItem.table_name === tableName && typedItem.operation === 'delete';\n      });\n\n      if (pendingDeletes.length === 0) return;\n\n      logger.log(`ğŸ—‘ï¸ [${tableName}] ç™¼ç¾ ${pendingDeletes.length} ç­†å¾…åˆªé™¤é …ç›®ï¼Œé–‹å§‹åˆªé™¤...`);\n\n      for (const queueItem of pendingDeletes) {\n        try {\n          const typedItem = queueItem as any;\n          // å¾ Supabase åˆªé™¤\n          const { error } = await supabase\n            .from(tableName)\n            .delete()\n            .eq('id', typedItem.record_id);\n\n          // åˆªé™¤æˆåŠŸæˆ–è³‡æ–™å·²ä¸å­˜åœ¨ï¼Œæ¸…é™¤éšŠåˆ—è¨˜éŒ„\n          await localDB.delete('syncQueue', typedItem.id);\n\n          if (error) {\n            logger.warn(`âš ï¸ [${tableName}] Supabase åˆªé™¤å¤±æ•—ï¼ˆå·²æ¸…é™¤éšŠåˆ—ï¼‰:`, typedItem.record_id, error);\n          } else {\n            logger.log(`âœ… [${tableName}] åˆªé™¤æˆåŠŸ: ${typedItem.record_id}`);\n          }\n        } catch (error) {\n          logger.error(`âŒ [${tableName}] åˆªé™¤å¤±æ•—:`, (queueItem as any).record_id, error);\n        }\n      }\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] syncPendingDeletes å¤±æ•—:`, error);\n    }\n  }\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦æœ‰å¾…åŒæ­¥é …ç›®\n   */\n  async hasPendingSync(tableName: TableName): Promise<boolean> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName);\n      const hasLocalPending = allLocalItems.some((item: unknown) => {\n        const typedItem = item as any;\n        return typedItem._needs_sync === true || (typedItem.code && typedItem.code.endsWith('TBC'));\n      });\n\n      // æª¢æŸ¥æ˜¯å¦æœ‰åˆªé™¤éšŠåˆ—\n      const allQueueItems = await localDB.getAll('syncQueue');\n      const hasDeletePending = allQueueItems.some((item: unknown) => {\n        const typedItem = item as any;\n        return typedItem.table_name === tableName && typedItem.operation === 'delete';\n      });\n\n      return hasLocalPending || hasDeletePending;\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] æª¢æŸ¥å¾…åŒæ­¥é …ç›®å¤±æ•—:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * å–å¾—å¾…åŒæ­¥é …ç›®æ•¸é‡\n   */\n  async getPendingCount(tableName: TableName): Promise<number> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName);\n      const localPendingCount = allLocalItems.filter((item: unknown) => {\n        const typedItem = item as any;\n        return typedItem._needs_sync === true || (typedItem.code && typedItem.code.endsWith('TBC'));\n      }).length;\n\n      // è¨ˆç®—åˆªé™¤éšŠåˆ—æ•¸é‡\n      const allQueueItems = await localDB.getAll('syncQueue');\n      const deletePendingCount = allQueueItems.filter((item: unknown) => {\n        const typedItem = item as any;\n        return typedItem.table_name === tableName && typedItem.operation === 'delete';\n      }).length;\n\n      return localPendingCount + deletePendingCount;\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] å–å¾—å¾…åŒæ­¥æ•¸é‡å¤±æ•—:`, error);\n      return 0;\n    }\n  }\n}\n\n// å–®ä¾‹æ¨¡å¼\nexport const backgroundSyncService = new BackgroundSyncService();\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/sync/network-monitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/sync/sync-status-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[444,447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[444,447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":23,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * åŒæ­¥ç‹€æ…‹æœå‹™ï¼ˆFastIn æ¶æ§‹ç‰ˆæœ¬ï¼‰\n * æä¾›é‡å°å–®ä¸€è¡¨çš„åŒæ­¥ç‹€æ…‹æª¢æŸ¥\n */\n\nimport { localDB, type TableName } from '@/lib/db';\nimport { TABLES } from '@/lib/db/schemas';\nimport { useState, useCallback } from 'react';\n\n/**\n * æª¢æŸ¥æŒ‡å®šè¡¨çš„å¾…åŒæ­¥é …ç›®æ•¸é‡\n * @param tableName - è¡¨åç¨±\n * @returns å¾…åŒæ­¥é …ç›®æ•¸é‡\n */\nexport async function checkPendingCount(tableName: TableName): Promise<number> {\n  try {\n    const items = await localDB.getAll(tableName);\n    const pending = items.filter((item: any) =>\n      item._needs_sync === true ||\n      (item.code && item.code.endsWith('TBC'))\n    );\n    return pending.length;\n  } catch (error) {\n    return 0;\n  }\n}\n\n/**\n * æª¢æŸ¥ç•¶å‰æ˜¯å¦åœ¨ç·š\n */\nexport function isOnline(): boolean {\n  return typeof navigator !== 'undefined' ? navigator.onLine : true;\n}\n\n/**\n * åŒæ­¥ç‹€æ…‹ Hook\n * ç”¨æ–¼ React çµ„ä»¶ä¸­ç²å–åŒæ­¥ç‹€æ…‹\n */\nexport function useSyncStatus() {\n  const [pendingCount, setPendingCount] = useState(0);\n  const [online, setOnline] = useState(true);\n  const [lastSyncTime, setLastSyncTime] = useState<Date | null>(null);\n\n  const updateStatus = useCallback(async () => {\n    setOnline(isOnline());\n\n    try {\n      // æª¢æŸ¥æ‰€æœ‰è¡¨çš„å¾…åŒæ­¥æ•¸é‡ï¼ˆå‹•æ…‹è®€å– TABLESï¼‰\n      const tables = Object.values(TABLES);\n      let total = 0;\n      for (const table of tables) {\n        const count = await checkPendingCount(table);\n        total += count;\n      }\n      setPendingCount(total);\n      setLastSyncTime(new Date());\n    } catch (error) {\n      console.error('æ›´æ–°åŒæ­¥ç‹€æ…‹å¤±æ•—:', error);\n    }\n  }, []);\n\n  return {\n    pendingCount,\n    isOnline: online,\n    lastSyncTime,\n    updateStatus\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/task-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/template-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/utils/logger.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[404,407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[404,407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[538,541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[538,541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[673,676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[673,676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[807,810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[807,810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[942,945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[942,945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Safe Logger for SSR\n * é˜²æ­¢ Next.js SSR æ™‚çš„ console éŒ¯èª¤\n * ä½¿ç”¨å‹•æ…‹å¼•ç”¨é¿å… Turbopack éœæ…‹åˆ†æéŒ¯èª¤\n */\n\nconst isDevelopment = process.env.NODE_ENV === 'development';\nconst isBrowser = typeof window !== 'undefined';\n\n// å‹•æ…‹ç²å– consoleï¼Œé¿å… SSR ç·¨è­¯æ™‚çš„éœæ…‹åˆ†æ\nconst getConsole = () => {\n  if (!isBrowser) return null;\n  return typeof window !== 'undefined' ? window.console : null;\n};\n\nexport const logger = {\n  log: (...args: any[]) => {\n    if (isDevelopment && isBrowser) {\n      const c = getConsole();\n      c?.log(...args);\n    }\n  },\n\n  error: (...args: any[]) => {\n    if (isDevelopment && isBrowser) {\n      const c = getConsole();\n      c?.error(...args);\n    }\n  },\n\n  warn: (...args: any[]) => {\n    if (isDevelopment && isBrowser) {\n      const c = getConsole();\n      c?.warn(...args);\n    }\n  },\n\n  info: (...args: any[]) => {\n    if (isDevelopment && isBrowser) {\n      const c = getConsole();\n      c?.info(...args);\n    }\n  },\n\n  debug: (...args: any[]) => {\n    if (isDevelopment && isBrowser) {\n      const c = getConsole();\n      c?.debug(...args);\n    }\n  },\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/utils/text.ts","messages":[{"ruleId":"no-irregular-whitespace","severity":1,"message":"Irregular whitespace not allowed.","line":19,"column":15,"nodeType":"Program","messageId":"noIrregularWhitespace","endLine":19,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * å…¨å½¢è½‰åŠå½¢å·¥å…·å‡½æ•¸\n * è‡ªå‹•å°‡å…¨å½¢å­—ç¬¦ï¼ˆæ•¸å­—ã€è‹±æ–‡ã€ç¬¦è™Ÿï¼‰è½‰æ›ç‚ºåŠå½¢\n */\n\n/**\n * å°‡å…¨å½¢å­—ç¬¦è½‰æ›ç‚ºåŠå½¢\n * @param str è¼¸å…¥å­—ä¸²\n * @returns è½‰æ›å¾Œçš„åŠå½¢å­—ä¸²\n */\nexport function toHalfWidth(str: string): string {\n  if (!str) return str;\n\n  return str.replace(/[ï¼-ï½]/g, (char) => {\n    // å…¨å½¢å­—ç¬¦ç¯„åœï¼šï¼(0xFF01) åˆ° ï½(0xFF5E)\n    // è½‰æ›ç‚ºåŠå½¢ï¼š!(0x0021) åˆ° ~(0x007E)\n    const code = char.charCodeAt(0);\n    return String.fromCharCode(code - 0xFEE0);\n  }).replace(/ã€€/g, ' '); // å…¨å½¢ç©ºæ ¼è½‰åŠå½¢ç©ºæ ¼\n}\n\n/**\n * React Input onChange äº‹ä»¶åŒ…è£å™¨\n * è‡ªå‹•å°‡å…¨å½¢è½‰æ›ç‚ºåŠå½¢\n */\nexport function withHalfWidthConversion<T extends HTMLInputElement | HTMLTextAreaElement>(\n  originalOnChange?: React.ChangeEventHandler<T>\n): React.ChangeEventHandler<T> {\n  return (e) => {\n    // è½‰æ›ç‚ºåŠå½¢\n    const convertedValue = toHalfWidth(e.target.value);\n\n    // å¦‚æœå€¼æœ‰æ”¹è®Šï¼Œæ›´æ–° input çš„å€¼\n    if (convertedValue !== e.target.value) {\n      e.target.value = convertedValue;\n    }\n\n    // å‘¼å«åŸæœ¬çš„ onChange\n    if (originalOnChange) {\n      originalOnChange(e);\n    }\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/lib/utils/uuid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/services/auth-service-v5.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1165,1168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1165,1168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1769,1772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1769,1772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * èªè­‰æœå‹™ v5 - Supabase æ•´åˆç‰ˆæœ¬\n */\n\nimport { supabase } from '@/lib/supabase/client';\nimport type { User } from '@/stores/types';\n\nexport interface LoginResult {\n  success: boolean;\n  message?: string;\n  user?: User;\n  usedFallback?: boolean;\n}\n\nexport class AuthServiceV5 {\n  /**\n   * ç™»å…¥é©—è­‰ï¼ˆSupabaseï¼‰\n   */\n  static async login(username: string, password: string): Promise<LoginResult> {\n    try {\n      console.log('ğŸ” ç™»å…¥é©—è­‰ï¼š', username);\n\n      // å›ºå®šé è¨­å¯†ç¢¼\n      const DEFAULT_PASSWORD = 'Venturo2025!';\n\n      if (password !== DEFAULT_PASSWORD) {\n        return {\n          success: false,\n          message: 'å¯†ç¢¼éŒ¯èª¤'\n        };\n      }\n\n      // å¾ API æŸ¥è©¢ä½¿ç”¨è€…ï¼ˆæœƒè‡ªå‹•è·¯ç”±åˆ° SQLiteï¼‰\n      const { data: users, error } = await supabase\n        .from('employees')\n        .select('*')\n        .eq('employee_number', username);\n\n      if (error) {\n        console.error('âŒ æŸ¥è©¢éŒ¯èª¤:', error);\n        return {\n          success: false,\n          message: 'ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦'\n        };\n      }\n\n      const user = users?.[0] as User | undefined;\n\n      if (!user) {\n        return {\n          success: false,\n          message: 'å¸³è™Ÿä¸å­˜åœ¨'\n        };\n      }\n\n      // æª¢æŸ¥ç‹€æ…‹\n      if (!(user as any).is_active || user.status === 'terminated') {\n        return {\n          success: false,\n          message: 'å¸³è™Ÿå·²åœç”¨'\n        };\n      }\n\n      console.log('âœ… ç™»å…¥æˆåŠŸ:', user.employee_number);\n\n      return {\n        success: true,\n        user,\n        usedFallback: false\n      };\n\n    } catch (error) {\n      console.error('âŒ ç™»å…¥éŒ¯èª¤:', error);\n      return {\n        success: false,\n        message: 'ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦'\n      };\n    }\n  }\n\n  /**\n   * æ›´æ–°æœ€å¾Œç™»å…¥æ™‚é–“\n   */\n  static async updateLastLogin(user_id: string): Promise<void> {\n    try {\n      const now = new Date().toISOString();\n\n      await (supabase as any)\n        .from('employees')\n        .update({\n          last_login: now,\n          updated_at: now\n        })\n        .eq('id', user_id);\n\n      console.log('âœ… æ›´æ–°ç™»å…¥æ™‚é–“:', user_id);\n    } catch (error) {\n      console.error('âŒ æ›´æ–°ç™»å…¥æ™‚é–“å¤±æ•—:', error);\n      // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œå…è¨±ç™»å…¥ç¹¼çºŒ\n    }\n  }\n\n  /**\n   * ç™»å‡º\n   */\n  static logout(): void {\n    // æ¸…é™¤ localStorage\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem('auth-storage');\n    }\n    console.log('âœ… å·²ç™»å‡º');\n  }\n\n  /**\n   * æª¢æŸ¥æ¬Šé™\n   */\n  static hasPermission(user: User | null, permission: string): boolean {\n    if (!user) return false;\n    \n    const permissions = user.permissions || [];\n    return permissions.includes(permission) ||\n           permissions.includes('super_admin') ||\n           permissions.includes('admin');\n  }\n\n  /**\n   * æª¢æŸ¥å¤šå€‹æ¬Šé™ï¼ˆä»»ä¸€ç¬¦åˆï¼‰\n   */\n  static hasAnyPermission(user: User | null, permissions: string[]): boolean {\n    if (!user) return false;\n    \n    return permissions.some(permission => \n      this.hasPermission(user, permission)\n    );\n  }\n\n  /**\n   * æª¢æŸ¥å¤šå€‹æ¬Šé™ï¼ˆå…¨éƒ¨ç¬¦åˆï¼‰\n   */\n  static hasAllPermissions(user: User | null, permissions: string[]): boolean {\n    if (!user) return false;\n    \n    return permissions.every(permission => \n      this.hasPermission(user, permission)\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/services/local-auth-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[739,742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[739,742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2089,2092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2089,2092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2318,2321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2318,2321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2855,2858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2855,2858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2900,2903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2900,2903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3810,3813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3810,3813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4503,4506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4503,4506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5143,5146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5143,5146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6720,6723],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6720,6723],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * ç´”æœ¬åœ°èªè­‰æœå‹™\n * å®Œå…¨ä¸ä¾è³´ Supabaseï¼Œä½¿ç”¨ IndexedDB å„²å­˜æ‰€æœ‰è³‡æ–™\n */\n\nimport bcrypt from 'bcryptjs';\nimport { localDB } from '@/lib/db';\nimport type { User } from '@/stores/types';\n\nexport interface LocalLoginResult {\n  success: boolean;\n  message?: string;\n  user?: User;\n}\n\nexport class LocalAuthService {\n  /**\n   * æœ¬åœ°ç™»å…¥é©—è­‰\n   */\n  static async login(username: string, password: string): Promise<LocalLoginResult> {\n    try {\n      // 1. å¾ IndexedDB æŸ¥è©¢å“¡å·¥\n      const employees = await localDB.filter('employees', [\n        { field: 'employee_number', operator: 'eq', value: username }\n      ]);\n\n      if (employees.length === 0) {\n        return { \n          success: false, \n          message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' \n        };\n      }\n\n      const employee: any = employees[0];\n\n      // 2. æª¢æŸ¥å¸³è™Ÿæ˜¯å¦å•Ÿç”¨\n      if (employee.is_active === false) {\n        return { \n          success: false, \n          message: 'å¸³è™Ÿå·²åœç”¨ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡' \n        };\n      }\n\n      // 3. æª¢æŸ¥å¸³è™Ÿé–å®š\n      if (employee.lockedUntil) {\n        const lockedTime = new Date(employee.lockedUntil);\n        if (lockedTime > new Date()) {\n          const remainingMinutes = Math.ceil((lockedTime.getTime() - Date.now()) / (60 * 1000));\n          return { \n            success: false, \n            message: `å¸³è™Ÿå·²é–å®šï¼Œè«‹ ${remainingMinutes} åˆ†é˜å¾Œå†è©¦` \n          };\n        }\n      }\n\n      // 4. é©—è­‰å¯†ç¢¼\n      let isValidPassword = false;\n      \n      if (employee.password_hash) {\n        try {\n          isValidPassword = await bcrypt.compare(password, employee.password_hash);\n        } catch (error) {\n          console.error('å¯†ç¢¼é©—è­‰å¤±æ•—:', error);\n          // é–‹ç™¼ç’°å¢ƒ fallback\n          if (password === 'Venturo2025!' && username === 'william01') {\n            isValidPassword = true;\n            console.warn('âš ï¸ ä½¿ç”¨é–‹ç™¼ç’°å¢ƒé è¨­å¯†ç¢¼');\n          }\n        }\n      } else {\n        // æ²’æœ‰å¯†ç¢¼é›œæ¹Šï¼Œæª¢æŸ¥æ˜¯å¦ç‚ºé è¨­å¸³è™Ÿ\n        if (password === 'Venturo2025!' && username === 'william01') {\n          // è‡ªå‹•è¨­å®šå¯†ç¢¼\n          const hashedPassword = await bcrypt.hash(password, 10);\n          await localDB.update('employees', employee.id, {\n            password_hash: hashedPassword\n          } as any);\n          isValidPassword = true;\n          console.log('âœ… å·²ç‚ºé è¨­å¸³è™Ÿè¨­å®šå¯†ç¢¼');\n        }\n      }\n\n      if (!isValidPassword) {\n        // è¨˜éŒ„å¤±æ•—æ¬¡æ•¸\n        const attempts = (employee.loginAttempts || 0) + 1;\n        const updates: any = { loginAttempts: attempts };\n\n        // è¶…é 5 æ¬¡é–å®š 30 åˆ†é˜\n        if (attempts >= 5) {\n          updates.lockedUntil = new Date(Date.now() + 30 * 60 * 1000).toISOString();\n        }\n\n        await localDB.update('employees', employee.id, updates);\n\n        return { \n          success: false, \n          message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' \n        };\n      }\n\n      // 5. ç™»å…¥æˆåŠŸï¼Œé‡è¨­å¤±æ•—æ¬¡æ•¸\n      await localDB.update('employees', employee.id, {\n        lastLoginAt: new Date().toISOString(),\n        loginAttempts: 0,\n        lockedUntil: null\n      } as any);\n\n      // 6. å»ºç«‹ä½¿ç”¨è€…ç‰©ä»¶\n      const user: any = {\n        id: employee.id,\n        employee_number: employee.employee_number,\n        name: employee.name,\n        email: employee.email,\n        permissions: employee.permissions || [],\n        department: employee.department,\n        position: employee.position,\n        avatar: employee.avatar,\n        is_active: employee.is_active !== false,\n        created_at: employee.created_at,\n        updated_at: employee.updated_at || employee.updatedAt\n      };\n\n      return { \n        success: true, \n        user\n      };\n\n    } catch (error) {\n      console.error('ç™»å…¥éŒ¯èª¤:', error);\n      return { \n        success: false, \n        message: 'ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦' \n      };\n    }\n  }\n\n  /**\n   * è®Šæ›´å¯†ç¢¼\n   */\n  static async changePassword(\n    user_id: string,\n    oldPassword: string,\n    newPassword: string\n  ): Promise<{ success: boolean; message?: string }> {\n    try {\n      // 1. å–å¾—ä½¿ç”¨è€…è³‡æ–™\n      const employee: any = await localDB.read('employees', user_id);\n      \n      if (!employee) {\n        return { \n          success: false, \n          message: 'ä½¿ç”¨è€…ä¸å­˜åœ¨' \n        };\n      }\n\n      // 2. é©—è­‰èˆŠå¯†ç¢¼\n      if (employee.password_hash) {\n        const isValid = await bcrypt.compare(oldPassword, employee.password_hash);\n        if (!isValid) {\n          return { \n            success: false, \n            message: 'èˆŠå¯†ç¢¼éŒ¯èª¤' \n          };\n        }\n      }\n\n      // 3. åŠ å¯†æ–°å¯†ç¢¼\n      const newPasswordHash = await bcrypt.hash(newPassword, 10);\n\n      // 4. æ›´æ–°å¯†ç¢¼\n      await localDB.update('employees', user_id, {\n        password_hash: newPasswordHash,\n        updated_at: new Date().toISOString()\n      } as any);\n\n      return { success: true };\n\n    } catch (error) {\n      console.error('è®Šæ›´å¯†ç¢¼éŒ¯èª¤:', error);\n      return { \n        success: false, \n        message: 'è®Šæ›´å¯†ç¢¼å¤±æ•—' \n      };\n    }\n  }\n\n  /**\n   * é‡è¨­å¯†ç¢¼ï¼ˆç®¡ç†å“¡åŠŸèƒ½ï¼‰\n   */\n  static async resetPassword(\n    user_id: string,\n    newPassword: string\n  ): Promise<{ success: boolean; message?: string }> {\n    try {\n      // åŠ å¯†æ–°å¯†ç¢¼\n      const password_hash = await bcrypt.hash(newPassword, 10);\n\n      // æ›´æ–°å¯†ç¢¼ä¸¦æ¸…é™¤é–å®š\n      await localDB.update('employees', user_id, {\n        password_hash,\n        loginAttempts: 0,\n        lockedUntil: null,\n        updated_at: new Date().toISOString()\n      } as any);\n\n      return { success: true };\n\n    } catch (error) {\n      console.error('é‡è¨­å¯†ç¢¼éŒ¯èª¤:', error);\n      return { \n        success: false, \n        message: 'é‡è¨­å¯†ç¢¼å¤±æ•—' \n      };\n    }\n  }\n\n  /**\n   * å»ºç«‹æ–°ä½¿ç”¨è€…\n   */\n  static async createUser(userData: {\n    employee_number: string;\n    name: string;\n    email: string;\n    password: string;\n    department?: string;\n    position?: string;\n    permissions?: string[];\n  }): Promise<{ success: boolean; message?: string; user?: User }> {\n    try {\n      // æª¢æŸ¥å“¡å·¥ç·¨è™Ÿæ˜¯å¦å·²å­˜åœ¨\n      const existing = await localDB.filter('employees', [\n        { field: 'employee_number', operator: 'eq', value: userData.employee_number }\n      ]);\n\n      if (existing.length > 0) {\n        return { \n          success: false, \n          message: 'å“¡å·¥ç·¨è™Ÿå·²å­˜åœ¨' \n        };\n      }\n\n      // åŠ å¯†å¯†ç¢¼\n      const password_hash = await bcrypt.hash(userData.password, 10);\n\n      // å»ºç«‹å“¡å·¥è³‡æ–™\n      const newEmployee = {\n        id: `emp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        employee_number: userData.employee_number,\n        name: userData.name,\n        email: userData.email,\n        password_hash,\n        permissions: userData.permissions || [],\n        department: userData.department || '',\n        position: userData.position || '',\n        salary: 0,\n        is_active: true,\n        loginAttempts: 0,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString()\n      };\n\n      // å„²å­˜åˆ° IndexedDB\n      const created = await localDB.create('employees', newEmployee);\n\n      // å»ºç«‹ä½¿ç”¨è€…ç‰©ä»¶\n      const user: any = {\n        id: created.id,\n        employee_number: created.employee_number,\n        name: created.name,\n        email: created.email,\n        permissions: created.permissions,\n        department: created.department,\n        position: created.position,\n        is_active: true,\n        created_at: created.created_at,\n        updated_at: created.updated_at\n      };\n\n      return { \n        success: true, \n        user \n      };\n\n    } catch (error) {\n      console.error('å»ºç«‹ä½¿ç”¨è€…éŒ¯èª¤:', error);\n      return { \n        success: false, \n        message: 'å»ºç«‹ä½¿ç”¨è€…å¤±æ•—' \n      };\n    }\n  }\n\n  /**\n   * æª¢æŸ¥æ¬Šé™\n   */\n  static hasPermission(user: User | null, permission: string): boolean {\n    if (!user) return false;\n    \n    const permissions = user.permissions || [];\n    return permissions.includes(permission) ||\n           permissions.includes('super_admin') ||\n           permissions.includes('admin');\n  }\n\n  /**\n   * æª¢æŸ¥å¤šå€‹æ¬Šé™ï¼ˆä»»ä¸€ç¬¦åˆï¼‰\n   */\n  static hasAnyPermission(user: User | null, permissions: string[]): boolean {\n    if (!user) return false;\n    \n    return permissions.some(permission => \n      this.hasPermission(user, permission)\n    );\n  }\n\n  /**\n   * æª¢æŸ¥å¤šå€‹æ¬Šé™ï¼ˆå…¨éƒ¨ç¬¦åˆï¼‰\n   */\n  static hasAllPermissions(user: User | null, permissions: string[]): boolean {\n    if (!user) return false;\n    \n    return permissions.every(permission => \n      this.hasPermission(user, permission)\n    );\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/services/offline-auth.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'verifyPassword' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[949,952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[949,952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[974,977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[974,977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'profile' is defined but never used. Allowed unused args must match /^_/u.","line":258,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":258,"endColumn":54}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { verifyPassword } from '@/lib/auth';\nimport {\n  useLocalAuthStore,\n  LocalProfile,\n  PasswordEncryption\n} from '@/lib/auth/local-auth-manager';\nimport { localDB } from '@/lib/db';\nimport { TABLES } from '@/lib/db/schemas';\nimport bcrypt from 'bcryptjs';\n\n// ============= é›¢ç·šèªè­‰æœå‹™ =============\nexport class OfflineAuthService {\n  /**\n   * åˆæ¬¡ç™»å…¥ï¼ˆéœ€è¦ç¶²è·¯ï¼‰\n   * å¾ Supabase é©—è­‰ä¸¦å»ºç«‹æœ¬åœ° Profile\n   */\n  static async initialLogin(\n    email: string,\n    password: string\n  ): Promise<{ success: boolean; profile?: LocalProfile; message?: string }> {\n    try {\n      // ğŸš€ TODO: [ä¸Šç·šä¿®æ”¹] æ”¹æˆ Supabase å„ªå…ˆï¼ŒIndexedDB å‚™æ´\n      // åƒè€ƒï¼šdocs/PRODUCTION_TODO.md\n      console.log('ğŸ” ç´”æœ¬åœ°ç™»å…¥é©—è­‰...');\n      console.log('è¼¸å…¥çš„å¸³è™Ÿ:', email);\n\n      // ğŸš€ TODO: [ä¸Šç·šä¿®æ”¹] é€™è£¡è¦æ”¹æˆï¼š\n      // 1. å…ˆå˜—è©¦å¾ Supabase è®€å–\n      // 2. æˆåŠŸå‰‡åŒæ­¥åˆ° IndexedDB\n      // 3. å¤±æ•—å‰‡ä½¿ç”¨ IndexedDB é›¢ç·šç™»å…¥\n      // å¾ IndexedDB è®€å–çœŸå¯¦ä½¿ç”¨è€…\n      await localDB.init(); // ç¢ºä¿è³‡æ–™åº«å·²åˆå§‹åŒ–\n      const users = await localDB.getAll<any>(TABLES.EMPLOYEES as any);\n      const employee = users.find(u => u.employee_number === email || u.employee_number === email);\n\n      if (!employee) {\n        return {\n          success: false,\n          message: 'ç”¨æˆ¶åç¨±æˆ–å¯†ç¢¼éŒ¯èª¤'\n        };\n      }\n\n      // é©—è­‰å¯†ç¢¼ - æ”¯æ´å¤šç¨®æ¬„ä½åç¨±\n      const password_hash = employee.password_hash || employee.password_hash;\n      if (!password_hash) {\n        console.error('å“¡å·¥æ²’æœ‰å¯†ç¢¼è¨­å®š:', employee);\n        return {\n          success: false,\n          message: 'å¸³è™Ÿå°šæœªè¨­å®šå¯†ç¢¼'\n        };\n      }\n\n      const isValidPassword = await bcrypt.compare(password, password_hash);\n      if (!isValidPassword) {\n        return {\n          success: false,\n          message: 'ç”¨æˆ¶åç¨±æˆ–å¯†ç¢¼éŒ¯èª¤'\n        };\n      }\n\n      console.log('âœ“ å¯†ç¢¼é©—è­‰æˆåŠŸ:', employee.name || employee.display_name);\n\n      // 3. å»ºç«‹æœ¬åœ° Profile\n      console.log('é–‹å§‹åŠ å¯†å¯†ç¢¼...');\n      let encryptedPassword;\n      try {\n        encryptedPassword = await PasswordEncryption.encrypt(password);\n        console.log('å¯†ç¢¼åŠ å¯†æˆåŠŸ');\n      } catch (encErr) {\n        console.error('å¯†ç¢¼åŠ å¯†å¤±æ•—:', encErr);\n        throw encErr;\n      }\n\n      // æ”¯æ´å¤šç¨®å±¬æ€§åç¨±æ ¼å¼\n      const profile: LocalProfile = {\n        id: employee.id,\n        email: employee.email || employee.employee_number + '@venturo.local',\n        employee_number: employee.employee_number || employee.employee_number,\n        display_name: employee.name || employee.display_name || employee.display_name,\n        english_name: employee.english_name || employee.english_name || employee.name,\n        role: this.determineRole(employee.permissions),\n        permissions: employee.permissions || [],\n        cachedPassword: encryptedPassword,\n        personal_info: employee.personal_info || employee.personal_info,\n        job_info: employee.job_info || employee.job_info || {\n          department: employee.department,\n          position: employee.position,\n          salary: employee.salary\n        },\n        salary_info: employee.salary_info || employee.salary_info,\n        contracts: employee.contracts,\n        attendance: employee.attendance,\n        lastLoginAt: new Date().toISOString(),\n        created_at: employee.created_at || employee.created_at || new Date().toISOString(),\n        status: (employee.is_active || employee.is_active) ? 'active' : 'inactive'\n      };\n\n      // 4. å„²å­˜åˆ°æœ¬åœ°\n      console.log('æº–å‚™å„²å­˜ Profile:', profile);\n      try {\n        useLocalAuthStore.getState().addProfile(profile);\n        console.log('Profile å·²åŠ å…¥');\n        useLocalAuthStore.getState().setCurrentProfile(profile);\n        console.log('Profile å·²è¨­ç‚ºç•¶å‰');\n      } catch (storeErr) {\n        console.error('å„²å­˜ Profile å¤±æ•—:', storeErr);\n        throw storeErr;\n      }\n\n      console.log('âœ… Profile å·²å»ºç«‹ä¸¦å„²å­˜åˆ°æœ¬åœ°');\n\n      return { success: true, profile };\n\n    } catch (error) {\n      console.error('åˆæ¬¡ç™»å…¥å¤±æ•—:', error);\n      return {\n        success: false,\n        message: 'ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦'\n      };\n    }\n  }\n\n  /**\n   * é›¢ç·šç™»å…¥ï¼ˆä½¿ç”¨ PIN ç¢¼æˆ–å¯†ç¢¼ï¼‰\n   */\n  static async offlineLogin(\n    profileId: string,\n    credential: string,\n    usePin: boolean = true\n  ): Promise<{ success: boolean; profile?: LocalProfile; message?: string }> {\n    try {\n      const profile = useLocalAuthStore.getState().getProfileById(profileId);\n\n      if (!profile) {\n        return {\n          success: false,\n          message: 'æ‰¾ä¸åˆ°æ­¤ç”¨æˆ¶è³‡æ–™'\n        };\n      }\n\n      let isValid = false;\n\n      if (usePin) {\n        // ä½¿ç”¨ PIN ç¢¼é©—è­‰\n        if (!profile.pinHash) {\n          return {\n            success: false,\n            message: 'æ­¤å¸³è™Ÿå°šæœªè¨­å®š PIN ç¢¼'\n          };\n        }\n\n        isValid = await useLocalAuthStore.getState().verifyPin(profileId, credential);\n      } else {\n        // ä½¿ç”¨å¯†ç¢¼é©—è­‰ï¼ˆé›¢ç·šï¼‰\n        if (!profile.cachedPassword) {\n          return {\n            success: false,\n            message: 'æ­¤å¸³è™Ÿç„¡æ³•ä½¿ç”¨é›¢ç·šç™»å…¥'\n          };\n        }\n\n        const decryptedPassword = await PasswordEncryption.decrypt(profile.cachedPassword);\n        isValid = credential === decryptedPassword;\n      }\n\n      if (!isValid) {\n        return {\n          success: false,\n          message: usePin ? 'PIN ç¢¼éŒ¯èª¤' : 'å¯†ç¢¼éŒ¯èª¤'\n        };\n      }\n\n      // è¨­å®šç‚ºç•¶å‰ç™»å…¥\n      useLocalAuthStore.getState().setCurrentProfile(profile);\n\n      console.log('âœ… é›¢ç·šç™»å…¥æˆåŠŸ');\n\n      // èƒŒæ™¯å˜—è©¦åˆ·æ–° Supabase session\n      if (typeof navigator !== 'undefined' && navigator.onLine && profile.cachedPassword) {\n        this.refreshSupabaseSession(profile).catch(console.error);\n      }\n\n      return { success: true, profile };\n\n    } catch (error) {\n      console.error('é›¢ç·šç™»å…¥å¤±æ•—:', error);\n      return {\n        success: false,\n        message: 'ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦'\n      };\n    }\n  }\n\n  /**\n   * è¨­å®š PIN ç¢¼\n   */\n  static async setupPin(profileId: string, pin: string): Promise<boolean> {\n    try {\n      if (pin.length < 4 || pin.length > 6) {\n        throw new Error('PIN ç¢¼é•·åº¦å¿…é ˆæ˜¯ 4-6 ä½æ•¸å­—');\n      }\n\n      if (!/^\\d+$/.test(pin)) {\n        throw new Error('PIN ç¢¼åªèƒ½åŒ…å«æ•¸å­—');\n      }\n\n      const pinHash = await PasswordEncryption.hashPin(pin);\n      useLocalAuthStore.getState().setPinForProfile(profileId, pinHash);\n\n      console.log('âœ… PIN ç¢¼è¨­å®šæˆåŠŸ');\n      return true;\n\n    } catch (error) {\n      console.error('è¨­å®š PIN ç¢¼å¤±æ•—:', error);\n      return false;\n    }\n  }\n\n  /**\n   * åˆ‡æ›è§’è‰²\n   */\n  static switchProfile(profileId: string): boolean {\n    try {\n      const profile = useLocalAuthStore.getState().getProfileById(profileId);\n\n      if (!profile) {\n        console.error('æ‰¾ä¸åˆ° Profile:', profileId);\n        return false;\n      }\n\n      useLocalAuthStore.getState().setCurrentProfile(profile);\n      console.log('âœ… å·²åˆ‡æ›åˆ°:', profile.display_name);\n\n      // èƒŒæ™¯åˆ·æ–° session\n      if (typeof navigator !== 'undefined' && navigator.onLine && profile.cachedPassword) {\n        this.refreshSupabaseSession(profile).catch(console.error);\n      }\n\n      return true;\n\n    } catch (error) {\n      console.error('åˆ‡æ›è§’è‰²å¤±æ•—:', error);\n      return false;\n    }\n  }\n\n  /**\n   * ç™»å‡º\n   */\n  static logout(): void {\n    useLocalAuthStore.getState().setCurrentProfile(null);\n    console.log('âœ… å·²ç™»å‡º');\n  }\n\n  /**\n   * èƒŒæ™¯åˆ·æ–°ï¼ˆç´”æœ¬åœ°æ¨¡å¼ - å·²åœç”¨ï¼‰\n   */\n  private static async refreshSupabaseSession(profile: LocalProfile): Promise<void> {\n    console.log('ğŸ“¦ æœ¬åœ°æ¨¡å¼ï¼šç„¡éœ€åˆ·æ–° session');\n  }\n\n  /**\n   * åˆ¤æ–·ç”¨æˆ¶è§’è‰²\n   */\n  private static determineRole(permissions: string[]): 'ADMIN' | 'EMPLOYEE' {\n    if (permissions?.includes('admin')) return 'ADMIN';\n    return 'EMPLOYEE';\n  }\n\n  /**\n   * åŒæ­¥æœ¬åœ° Profile èˆ‡é ç«¯\n   */\n  static async syncProfile(profileId: string): Promise<boolean> {\n    try {\n      const isOnline = typeof navigator !== 'undefined' ? navigator.onLine : false;\n\n      if (!isOnline) {\n        console.log('é›¢ç·šç‹€æ…‹ï¼Œç„¡æ³•åŒæ­¥');\n        return false;\n      }\n\n      const profile = useLocalAuthStore.getState().getProfileById(profileId);\n\n      if (!profile) {\n        return false;\n      }\n\n      // ğŸš€ TODO: [ä¸Šç·šä¿®æ”¹] é€™è£¡éœ€è¦å¯¦ä½œ Supabase åŒæ­¥\n      // ç›®å‰æš«æ™‚è¿”å› false\n      console.log('âš ï¸ Supabase åŒæ­¥å°šæœªå¯¦ä½œ');\n      return false;\n\n    } catch (error) {\n      console.error('åŒæ­¥å¤±æ•—:', error);\n      return false;\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/accounting-store.ts","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":101,"column":61,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":101,"endColumn":69},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":149,"column":65,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":149,"endColumn":73},{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":243,"column":59,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":243,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { Account, TransactionCategory, Transaction, Budget, AccountingStats } from '@/types';\nimport { generateUUID } from '@/lib/utils/uuid';\n\n/**\n * æœƒè¨ˆç³»çµ± Store (ç´” localStorage ç‰ˆæœ¬)\n *\n * èªªæ˜ï¼šæœƒè¨ˆç³»çµ±ä½¿ç”¨ localStorage æŒä¹…åŒ–ï¼ŒåŸå› ï¼š\n * 1. è³‡æ–™é‡å° (å¸³æˆ¶ã€äº¤æ˜“è¨˜éŒ„)\n * 2. éœ€è¦å³æ™‚è¨ˆç®—çµ±è¨ˆ (ä¸é©åˆ IndexedDB)\n * 3. æš«ä¸åŒæ­¥åˆ° Supabaseï¼ˆå¾…æœªä¾†æ“´å……ï¼‰\n */\n\ninterface AccountingStore {\n  // è³‡æ–™ç‹€æ…‹\n  accounts: Account[];\n  categories: TransactionCategory[];\n  transactions: Transaction[];\n  budgets: Budget[];\n\n  // çµ±è¨ˆè³‡æ–™\n  stats: AccountingStats;\n\n  // å¸³æˆ¶ç®¡ç†\n  addAccount: (account: Omit<Account, 'id' | 'created_at' | 'updated_at'>) => Account;\n  updateAccount: (id: string, account: Partial<Account>) => Account | undefined;\n  deleteAccount: (id: string) => boolean;\n  loadAccounts: () => Account[];\n\n  // åˆ†é¡ç®¡ç†\n  addCategory: (category: Omit<TransactionCategory, 'id' | 'created_at' | 'updated_at'>) => TransactionCategory;\n  updateCategory: (id: string, category: Partial<TransactionCategory>) => TransactionCategory | undefined;\n  deleteCategory: (id: string) => boolean;\n  loadCategories: () => TransactionCategory[];\n\n  // äº¤æ˜“è¨˜éŒ„\n  addTransaction: (transaction: Omit<Transaction, 'id' | 'created_at' | 'updated_at'>) => string;\n  updateTransaction: (id: string, transaction: Partial<Transaction>) => void;\n  deleteTransaction: (id: string) => void;\n\n  // é ç®—ç®¡ç†\n  addBudget: (budget: Omit<Budget, 'id' | 'created_at' | 'updated_at'>) => Budget;\n  updateBudget: (id: string, budget: Partial<Budget>) => Budget | undefined;\n  deleteBudget: (id: string) => boolean;\n\n  // çµ±è¨ˆè¨ˆç®—\n  calculateStats: () => void;\n  getAccountBalance: (account_id: string) => number;\n  getCategoryTotal: (category_id: string, start_date?: string, end_date?: string) => number;\n\n  // è¼”åŠ©æ–¹æ³•\n  updateAccountBalances: (transaction: Transaction) => void;\n  reverseAccountBalances: (transaction: Transaction) => void;\n}\n\nconst generateId = () => generateUUID();\n\nexport const useAccountingStore = create<AccountingStore>()(\n  persist(\n    (set, get) => ({\n      // åˆå§‹è³‡æ–™\n      accounts: [],\n      categories: [],\n      transactions: [],\n      budgets: [],\n\n      stats: {\n        total_assets: 0,\n        total_income: 0,\n        total_expense: 0,\n        monthly_income: 0,\n        monthly_expense: 0,\n        net_worth: 0,\n        category_breakdown: []\n      },\n\n      // ===== å¸³æˆ¶ç®¡ç† =====\n      addAccount: (accountData) => {\n        const id = generateId();\n        const now = new Date().toISOString();\n        const account: Account = {\n          ...accountData,\n          id,\n          created_at: now,\n          updated_at: now,\n        };\n        set((state) => ({ accounts: [...state.accounts, account] }));\n        get().calculateStats();\n        return account;\n      },\n\n      updateAccount: (id, accountData) => {\n        let updated: Account | undefined;\n        set((state) => {\n          const account = state.accounts.find(a => a.id === id);\n          if (!account) return state;\n\n          updated = { ...account, ...accountData, updated_at: new Date().toISOString() };\n          return {\n            accounts: state.accounts.map(a => a.id === id ? updated! : a)\n          };\n        });\n        get().calculateStats();\n        return updated;\n      },\n\n      deleteAccount: (id) => {\n        // å…ˆåˆªé™¤ç›¸é—œäº¤æ˜“\n        set((state) => ({\n          transactions: state.transactions.filter(transaction =>\n            transaction.account_id !== id && transaction.to_account_id !== id\n          ),\n        }));\n\n        set((state) => ({\n          accounts: state.accounts.filter(a => a.id !== id)\n        }));\n        get().calculateStats();\n        return true;\n      },\n\n      loadAccounts: () => {\n        return get().accounts;\n      },\n\n      // ===== åˆ†é¡ç®¡ç† =====\n      addCategory: (categoryData) => {\n        const id = generateId();\n        const now = new Date().toISOString();\n        const category: TransactionCategory = {\n          ...categoryData,\n          id,\n          created_at: now,\n          updated_at: now,\n        };\n        set((state) => ({ categories: [...state.categories, category] }));\n        return category;\n      },\n\n      updateCategory: (id, categoryData) => {\n        let updated: TransactionCategory | undefined;\n        set((state) => {\n          const category = state.categories.find(c => c.id === id);\n          if (!category) return state;\n\n          updated = { ...category, ...categoryData, updated_at: new Date().toISOString() };\n          return {\n            categories: state.categories.map(c => c.id === id ? updated! : c)\n          };\n        });\n        return updated;\n      },\n\n      deleteCategory: (id) => {\n        // å…ˆåˆªé™¤è©²åˆ†é¡çš„äº¤æ˜“\n        set((state) => ({\n          transactions: state.transactions.filter(transaction => transaction.category_id !== id),\n        }));\n\n        set((state) => ({\n          categories: state.categories.filter(c => c.id !== id)\n        }));\n        return true;\n      },\n\n      loadCategories: () => {\n        return get().categories;\n      },\n\n      // ===== äº¤æ˜“è¨˜éŒ„ =====\n      addTransaction: (transactionData) => {\n        const id = generateId();\n        const now = new Date().toISOString();\n\n        const transaction: Transaction = {\n          ...transactionData,\n          id,\n          created_at: now,\n          updated_at: now,\n        };\n\n        set((state) => ({ transactions: [...state.transactions, transaction] }));\n        get().updateAccountBalances(transaction);\n        get().calculateStats();\n        return id;\n      },\n\n      updateTransaction: (id, transactionData) => {\n        const now = new Date().toISOString();\n        const oldTransaction = get().transactions.find(t => t.id === id);\n\n        set((state) => ({\n          transactions: state.transactions.map(transaction =>\n            transaction.id === id ? { ...transaction, ...transactionData, updated_at: now } : transaction\n          ),\n        }));\n\n        if (oldTransaction) {\n          get().reverseAccountBalances(oldTransaction);\n        }\n        const newTransaction = get().transactions.find(t => t.id === id);\n        if (newTransaction) {\n          get().updateAccountBalances(newTransaction);\n        }\n        get().calculateStats();\n      },\n\n      deleteTransaction: (id) => {\n        const transaction = get().transactions.find(t => t.id === id);\n        if (transaction) {\n          get().reverseAccountBalances(transaction);\n        }\n\n        set((state) => ({\n          transactions: state.transactions.filter(transaction => transaction.id !== id),\n        }));\n        get().calculateStats();\n      },\n\n      // ===== é ç®—ç®¡ç† =====\n      addBudget: (budgetData) => {\n        const id = generateId();\n        const now = new Date().toISOString();\n        const budget: Budget = {\n          ...budgetData,\n          id,\n          created_at: now,\n          updated_at: now,\n        };\n        set((state) => ({ budgets: [...state.budgets, budget] }));\n        return budget;\n      },\n\n      updateBudget: (id, budgetData) => {\n        let updated: Budget | undefined;\n        set((state) => {\n          const budget = state.budgets.find(b => b.id === id);\n          if (!budget) return state;\n\n          updated = { ...budget, ...budgetData, updated_at: new Date().toISOString() };\n          return {\n            budgets: state.budgets.map(b => b.id === id ? updated! : b)\n          };\n        });\n        return updated;\n      },\n\n      deleteBudget: (id) => {\n        set((state) => ({\n          budgets: state.budgets.filter(b => b.id !== id)\n        }));\n        return true;\n      },\n\n      // ===== è¼”åŠ©æ–¹æ³• =====\n      updateAccountBalances: (transaction: Transaction) => {\n        set((state) => ({\n          accounts: state.accounts.map(account => {\n            if (account.id === transaction.account_id) {\n              const balanceChange = transaction.type === 'income' ? transaction.amount : -transaction.amount;\n              const newBalance = account.balance + balanceChange;\n              const availableCredit = account.type === 'credit' && account.credit_limit\n                ? (account.credit_limit ?? 0) + newBalance\n                : account.available_credit;\n              return { ...account, balance: newBalance, available_credit: availableCredit };\n            }\n            if (transaction.to_account_id && account.id === transaction.to_account_id) {\n              const newBalance = account.balance + transaction.amount;\n              const availableCredit = account.type === 'credit' && account.credit_limit\n                ? (account.credit_limit ?? 0) + newBalance\n                : account.available_credit;\n              return { ...account, balance: newBalance, available_credit: availableCredit };\n            }\n            return account;\n          })\n        }));\n      },\n\n      reverseAccountBalances: (transaction: Transaction) => {\n        set((state) => ({\n          accounts: state.accounts.map(account => {\n            if (account.id === transaction.account_id) {\n              const balanceChange = transaction.type === 'income' ? -transaction.amount : transaction.amount;\n              return { ...account, balance: account.balance + balanceChange };\n            }\n            if (transaction.to_account_id && account.id === transaction.to_account_id) {\n              return { ...account, balance: account.balance - transaction.amount };\n            }\n            return account;\n          })\n        }));\n      },\n\n      // ===== çµ±è¨ˆè¨ˆç®— =====\n      calculateStats: () => {\n        const { accounts, transactions, categories } = get();\n        const now = new Date();\n        const currentMonth = now.getMonth();\n        const currentYear = now.getFullYear();\n\n        const totalAssets = accounts\n          .filter(account => account.balance > 0)\n          .reduce((sum, account) => sum + account.balance, 0);\n\n        const totalDebt = accounts\n          .filter(account => account.balance < 0)\n          .reduce((sum, account) => sum + Math.abs(account.balance), 0);\n\n        const netWorth = totalAssets - totalDebt;\n\n        const totalIncome = transactions\n          .filter(t => t.type === 'income')\n          .reduce((sum, t) => sum + t.amount, 0);\n\n        const totalExpense = transactions\n          .filter(t => t.type === 'expense')\n          .reduce((sum, t) => sum + t.amount, 0);\n\n        const monthlyIncome = transactions\n          .filter(t => {\n            const transactionDate = new Date(t.date);\n            return t.type === 'income' &&\n                   transactionDate.getMonth() === currentMonth &&\n                   transactionDate.getFullYear() === currentYear;\n          })\n          .reduce((sum, t) => sum + t.amount, 0);\n\n        const monthlyExpense = transactions\n          .filter(t => {\n            const transactionDate = new Date(t.date);\n            return t.type === 'expense' &&\n                   transactionDate.getMonth() === currentMonth &&\n                   transactionDate.getFullYear() === currentYear;\n          })\n          .reduce((sum, t) => sum + t.amount, 0);\n\n        const categoryTotals = new Map<string, number>();\n\n        transactions\n          .filter(t => t.type === 'expense')\n          .forEach(t => {\n            const current = categoryTotals.get(t.category_id) || 0;\n            categoryTotals.set(t.category_id, current + t.amount);\n          });\n\n        const categoryBreakdown = Array.from(categoryTotals.entries())\n          .map(([categoryId, amount]) => {\n            const category = categories.find(c => c.id === categoryId);\n            return {\n              category_id: categoryId,\n              category_name: category?.name || 'æœªçŸ¥åˆ†é¡',\n              amount,\n              percentage: totalExpense > 0 ? (amount / totalExpense) * 100 : 0\n            };\n          })\n          .sort((a, b) => b.amount - a.amount);\n\n        set({\n          stats: {\n            total_assets: totalAssets,\n            total_income: totalIncome,\n            total_expense: totalExpense,\n            monthly_income: monthlyIncome,\n            monthly_expense: monthlyExpense,\n            net_worth: netWorth,\n            category_breakdown: categoryBreakdown\n          }\n        });\n      },\n\n      // å·¥å…·æ–¹æ³•\n      getAccountBalance: (accountId: string) => {\n        const account = get().accounts.find(a => a.id === accountId);\n        return account?.balance || 0;\n      },\n\n      getCategoryTotal: (categoryId: string, start_date?: string, end_date?: string) => {\n        const { transactions } = get();\n        return transactions\n          .filter(t => {\n            if (t.category_id !== categoryId) return false;\n            if (start_date && t.date < start_date) return false;\n            if (end_date && t.date > end_date) return false;\n            return true;\n          })\n          .reduce((sum, t) => sum + t.amount, 0);\n      }\n    }),\n    {\n      name: 'venturo-accounting-store',\n      version: 2, // ç‰ˆæœ¬å‡ç´š\n    }\n  )\n);\n\n// åˆå§‹åŒ–çµ±è¨ˆè³‡æ–™\nif (typeof window !== 'undefined') {\n  setTimeout(() => {\n    useAccountingStore.getState().calculateStats();\n  }, 0);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/accounting-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/auth-store-local.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/auth-store.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useUserStore' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'verifyPassword' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":154,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4892,4895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4892,4895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":260,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8756,8759],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8756,8759],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { User } from './types';\nimport { useUserStore } from './user-store';\nimport { generateToken, verifyPassword, type AuthPayload } from '@/lib/auth';\nimport { useLocalAuthStore, LocalProfile } from '@/lib/auth/local-auth-manager';\nimport { OfflineAuthService } from '@/services/offline-auth.service';\nimport { logger } from '@/lib/utils/logger';\n\ninterface AuthState {\n  // ä¿æŒå‘ä¸‹ç›¸å®¹çš„å±¬æ€§\n  user: User | null;\n  isAuthenticated: boolean;\n  sidebarCollapsed: boolean;\n  loginAttempts: Map<string, { count: number; lastAttempt: Date }>;\n\n  // æ–°å¢å±¬æ€§\n  currentProfile: LocalProfile | null;\n  isOfflineMode: boolean;\n\n  // æ–¹æ³•\n  login: (user: User) => void;\n  logout: () => void;\n  validateLogin: (username: string, password: string) => Promise<{ success: boolean; message?: string }>;\n  toggleSidebar: () => void;\n  setSidebarCollapsed: (collapsed: boolean) => void;\n  checkPermission: (permission: string) => boolean;\n  switchProfile: (profileId: string) => boolean;\n}\n\n// é˜²æš´åŠ›ç ´è§£çš„å¤±æ•—è¨˜éŒ„\nconst loginAttemptsMap = new Map<string, { count: number; lastAttempt: Date }>();\n\nfunction checkLoginAttempts(username: string): { allowed: boolean; message?: string } {\n  const attempts = loginAttemptsMap.get(username);\n\n  if (!attempts) {\n    loginAttemptsMap.set(username, { count: 1, lastAttempt: new Date() });\n    return { allowed: true };\n  }\n\n  // 15 åˆ†é˜å¾Œé‡ç½®\n  const timeDiff = Date.now() - attempts.lastAttempt.getTime();\n  if (timeDiff > 15 * 60 * 1000) {\n    loginAttemptsMap.set(username, { count: 1, lastAttempt: new Date() });\n    return { allowed: true };\n  }\n\n  // è¶…é 5 æ¬¡å˜—è©¦\n  if (attempts.count >= 5) {\n    const remainingTime = Math.ceil((15 * 60 * 1000 - timeDiff) / (60 * 1000));\n    return {\n      allowed: false,\n      message: `ç™»å…¥å¤±æ•—æ¬¡æ•¸éå¤šï¼Œè«‹ ${remainingTime} åˆ†é˜å¾Œå†è©¦`\n    };\n  }\n\n  attempts.count++;\n  attempts.lastAttempt = new Date();\n  return { allowed: true };\n}\n\nfunction recordLoginAttempt(username: string, success: boolean): void {\n  if (success) {\n    // ç™»å…¥æˆåŠŸï¼Œæ¸…é™¤å¤±æ•—è¨˜éŒ„\n    loginAttemptsMap.delete(username);\n  }\n  // å¤±æ•—è¨˜éŒ„å·²åœ¨ checkLoginAttempts ä¸­è™•ç†\n}\n\nfunction setSecureCookie(token: string, rememberMe: boolean = false): void {\n  const maxAge = rememberMe ? 30 * 24 * 60 * 60 : 8 * 60 * 60; // 30å¤© or 8å°æ™‚\n  const secure = window.location.protocol === 'https:' ? 'Secure; ' : '';\n\n  // åœ¨ localhost é–‹ç™¼ç’°å¢ƒä¸­ï¼Œä¸ä½¿ç”¨ Secure å’Œ SameSite=Strict\n  if (window.location.hostname === 'localhost') {\n    document.cookie = `auth-token=${token}; path=/; max-age=${maxAge}; SameSite=Lax`;\n  } else {\n    document.cookie = `auth-token=${token}; path=/; max-age=${maxAge}; SameSite=Strict; ${secure}`;\n  }\n}\n\nexport const useAuthStore = create<AuthState>(\n  // @ts-expect-error - zustand persist middleware type issue\n  persist(\n    (set, get) => ({\n      user: null,\n      isAuthenticated: false,\n      sidebarCollapsed: true,  // é è¨­æ”¶åˆï¼Œhover æ™‚å±•é–‹\n      loginAttempts: new Map(),\n      currentProfile: null,\n      isOfflineMode: false,\n\n      login: (user) => {\n        // åŒæ™‚æ›´æ–° user å’Œ currentProfile\n        const profile = useLocalAuthStore.getState().currentProfile;\n        set({\n          user,\n          isAuthenticated: true,\n          currentProfile: profile\n        });\n      },\n\n      logout: () => {\n        // ä½¿ç”¨é›¢ç·šèªè­‰æœå‹™ç™»å‡º\n        OfflineAuthService.logout();\n\n        // å®‰å…¨æ¸…é™¤èªè­‰ cookie\n        if (typeof window !== 'undefined') {\n          if (window.location.hostname === 'localhost') {\n            document.cookie = 'auth-token=; path=/; max-age=0; SameSite=Lax';\n          } else {\n            document.cookie = 'auth-token=; path=/; max-age=0; SameSite=Strict; Secure';\n          }\n        }\n\n        set({\n          user: null,\n          isAuthenticated: false,\n          currentProfile: null\n        });\n      },\n\n  validateLogin: async (username: string, password: string) => {\n    try {\n      // æª¢æŸ¥ç™»å…¥æ¬¡æ•¸é™åˆ¶\n      const attemptCheck = checkLoginAttempts(username);\n      if (!attemptCheck.allowed) {\n        return { success: false, message: attemptCheck.message };\n      }\n\n      const localAuthStore = useLocalAuthStore.getState();\n      const existingProfile = localAuthStore.profiles.find(p => p.employee_number === username);\n\n      // ğŸŒ å„ªå…ˆæª¢æŸ¥ç¶²è·¯ç‹€æ…‹\n      const isOnline = navigator.onLine;\n\n      // ğŸŒ æœ‰ç¶²è·¯ â†’ å„ªå…ˆå¾ Supabase é©—è­‰ï¼ˆç¢ºä¿å¯†ç¢¼ã€æ¬Šé™ã€ç‹€æ…‹éƒ½æ˜¯æœ€æ–°çš„ï¼‰\n      if (isOnline) {\n        logger.log('ğŸŒ æœ‰ç¶²è·¯é€£ç·šï¼Œå¾ Supabase é©—è­‰...', username);\n\n        // ç›´æ¥è·³åˆ° Supabase é©—è­‰ï¼ˆè·³éè§’è‰²å¡ç™»å…¥ï¼‰\n        // ï¼ˆä¸‹é¢çš„ Supabase é©—è­‰é‚è¼¯æœƒåœ¨é©—è­‰æˆåŠŸå¾Œæ›´æ–°è§’è‰²å¡ï¼‰\n      }\n      // ğŸ“´ ç„¡ç¶²è·¯ + æœ‰è§’è‰²å¡ â†’ é›¢ç·šå¿«é€Ÿç™»å…¥ï¼ˆä½¿ç”¨ IndexedDBï¼‰\n      else if (!isOnline && existingProfile) {\n        logger.log('ğŸ“´ é›¢ç·šæ¨¡å¼ + æ‰¾åˆ°è§’è‰²å¡ï¼Œä½¿ç”¨é›¢ç·šç™»å…¥:', username);\n\n        try {\n          // å¾ IndexedDB è®€å–å“¡å·¥è³‡æ–™\n          const { localDB } = await import('@/lib/db');\n          const { TABLES } = await import('@/lib/db/schemas');\n\n          const employee = await localDB.read(TABLES.EMPLOYEES, existingProfile.id) as any;\n\n          if (!employee) {\n            logger.error('âŒ IndexedDB æ‰¾ä¸åˆ°å“¡å·¥è³‡æ–™');\n            localAuthStore.removeProfile(existingProfile.id);\n            return { success: false, message: 'æœ¬åœ°è³‡æ–™å·²æå£ï¼Œè«‹é€£ç·šç¶²è·¯å¾Œé‡æ–°ç™»å…¥' };\n          }\n\n          // ğŸ” æª¢æŸ¥è³‡æ–™æ ¼å¼ï¼ˆçµ±ä¸€ä½¿ç”¨ snake_caseï¼‰\n          if (!employee.password_hash || !employee.employee_number || !employee.display_name) {\n            logger.error('âŒ IndexedDB è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼ˆæ‡‰ç‚º snake_caseï¼‰');\n            logger.error('   è«‹é–‹å•Ÿ http://localhost:3000/check-db.html æ¸…ç©ºè³‡æ–™åº«');\n            localAuthStore.removeProfile(existingProfile.id);\n            return {\n              success: false,\n              message: 'æœ¬åœ°è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹é€£ç·šç¶²è·¯å¾Œé‡æ–°ç™»å…¥\\nï¼ˆæˆ–è¨ªå• /check-db.html æ¸…ç©ºè³‡æ–™åº«ï¼‰'\n            };\n          }\n\n          // æª¢æŸ¥å“¡å·¥ç‹€æ…‹\n          if (employee.status === 'terminated') {\n            logger.error('âŒ å¸³è™Ÿå·²åœç”¨');\n            return { success: false, message: 'æ­¤å¸³è™Ÿå·²åœç”¨' };\n          }\n\n          // é©—è­‰å¯†ç¢¼ï¼ˆä½¿ç”¨ bcryptï¼‰\n          const bcrypt = (await import('bcryptjs')).default;\n          const isValidPassword = await bcrypt.compare(password, employee.password_hash);\n\n          if (!isValidPassword) {\n            logger.error('âŒ å¯†ç¢¼éŒ¯èª¤');\n            recordLoginAttempt(username, false);\n            return { success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' };\n          }\n\n          // âœ… é›¢ç·šç™»å…¥æˆåŠŸ\n          logger.log('âœ… ğŸ“´ é›¢ç·šç™»å…¥æˆåŠŸ');\n          recordLoginAttempt(username, true);\n\n          const user: User = {\n            id: employee.id,\n            employee_number: employee.employee_number,\n            english_name: employee.english_name,\n            display_name: employee.display_name,\n            chinese_name: employee.chinese_name || employee.display_name,\n            personal_info: employee.personal_info || {},\n            job_info: employee.job_info || {},\n            salary_info: employee.salary_info || {},\n            permissions: employee.permissions || [],\n            roles: employee.roles || [],\n            attendance: employee.attendance || { leave_records: [], overtime_records: [] },\n            contracts: employee.contracts || [],\n            status: employee.status,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          };\n\n          set({ user, isAuthenticated: true, currentProfile: existingProfile, isOfflineMode: true });\n          return { success: true };\n\n        } catch (error) {\n          logger.error('âŒ é›¢ç·šç™»å…¥å¤±æ•—:', error);\n          // åˆªé™¤æå£çš„è§’è‰²å¡\n          localAuthStore.removeProfile(existingProfile.id);\n          return { success: false, message: 'é›¢ç·šç™»å…¥å¤±æ•—ï¼Œè«‹é€£ç·šç¶²è·¯å¾Œé‡æ–°ç™»å…¥' };\n        }\n      }\n      // ğŸ“´ ç„¡ç¶²è·¯ + ç„¡è§’è‰²å¡ â†’ ç„¡æ³•ç™»å…¥\n      else if (!isOnline && !existingProfile) {\n        logger.error('âŒ é›¢ç·šç‹€æ…‹ä¸”ç„¡è§’è‰²å¡');\n        return { success: false, message: 'é›¢ç·šç‹€æ…‹ä¸‹ç„¡æ³•ç™»å…¥ï¼Œè«‹é€£æ¥ç¶²è·¯' };\n      }\n\n      // ğŸŒ æ²’æœ‰è§’è‰²å¡ â†’ å¾ Supabase é©—è­‰ï¼ˆç¬¬ä¸€æ¬¡ç™»å…¥ï¼‰\n      logger.log('ğŸŒ ç¬¬ä¸€æ¬¡ç™»å…¥ï¼ŒæŸ¥è©¢ Supabase...');\n\n      // æª¢æŸ¥ç’°å¢ƒè®Šæ•¸\n      logger.log('ğŸ”§ ç’°å¢ƒè®Šæ•¸æª¢æŸ¥:', {\n        hasUrl: !!process.env.NEXT_PUBLIC_SUPABASE_URL,\n        hasKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n        url: process.env.NEXT_PUBLIC_SUPABASE_URL?.substring(0, 30) + '...'\n      });\n\n      // å¾ Supabase æŸ¥è©¢å“¡å·¥è³‡æ–™\n      const { supabase } = await import('@/lib/supabase/client');\n      logger.log('ğŸ“¡ Supabase client è¼‰å…¥æˆåŠŸ');\n\n      const { data: employees, error: queryError } = await supabase\n        .from('employees')\n        .select('*')\n        .eq('employee_number', username)\n        .single();\n\n      logger.log('ğŸ“Š æŸ¥è©¢çµæœ:', {\n        hasData: !!employees,\n        hasError: !!queryError,\n        errorMessage: queryError?.message\n      });\n\n      if (queryError || !employees) {\n        logger.error('âŒ Supabase æŸ¥è©¢å¤±æ•—:', queryError?.message);\n        logger.error('   å®Œæ•´éŒ¯èª¤:', queryError);\n        recordLoginAttempt(username, false);\n        return { success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' };\n      }\n\n      const employeeData = employees as any;\n      logger.log('âœ… æ‰¾åˆ°å“¡å·¥è³‡æ–™:', employeeData.display_name);\n\n      // å°‡ snake_case è½‰æ›ç‚º camelCaseï¼ˆå‰ç«¯çµ±ä¸€æ ¼å¼ï¼‰\n      const employee = {\n        id: employeeData.id,\n        employee_number: employeeData.employee_number,\n        display_name: employeeData.display_name,\n        english_name: employeeData.english_name,\n        chinese_name: employeeData.chinese_name,\n        password_hash: employeeData.password_hash,\n        must_change_password: employeeData.must_change_password,\n        last_password_change: employeeData.last_password_change,\n        personal_info: employeeData.personal_info || {},\n        job_info: employeeData.job_info || {},\n        salary_info: employeeData.salary_info || {},\n        permissions: employeeData.permissions || [],\n        roles: employeeData.roles || [], // é™„åŠ èº«ä»½æ¨™ç±¤\n        attendance: employeeData.attendance || { leave_records: [], overtime_records: [] },\n        contracts: employeeData.contracts || [],\n        status: employeeData.status,\n        created_at: employeeData.created_at,\n        updated_at: employeeData.updated_at\n      };\n\n      // æª¢æŸ¥å“¡å·¥ç‹€æ…‹\n      logger.log('ğŸ” æª¢æŸ¥å“¡å·¥ç‹€æ…‹:', employee.status);\n      if (employee.status === 'terminated') {\n        logger.error('âŒ å¸³è™Ÿå·²åœç”¨');\n        return { success: false, message: 'æ­¤å¸³è™Ÿå·²åœç”¨' };\n      }\n\n      // é©—è­‰å¯†ç¢¼\n      logger.log('ğŸ” æª¢æŸ¥å¯†ç¢¼ hash:', {\n        hasPasswordHash: !!employee.password_hash,\n        hashLength: employee.password_hash?.length\n      });\n\n      if (!employee.password_hash) {\n        logger.warn('âš ï¸ å“¡å·¥å°šæœªè¨­å®šå¯†ç¢¼:', username);\n        return { success: false, message: 'è«‹å…ˆè¨­å®šå¯†ç¢¼' };\n      }\n\n      // ä½¿ç”¨ bcrypt é©—è­‰å¯†ç¢¼\n      logger.log('ğŸ”‘ é–‹å§‹é©—è­‰å¯†ç¢¼...');\n      const bcrypt = (await import('bcryptjs')).default;\n      const isValidPassword = await bcrypt.compare(password, employee.password_hash);\n\n      logger.log('ğŸ”‘ å¯†ç¢¼é©—è­‰çµæœ:', isValidPassword);\n\n      if (!isValidPassword) {\n        logger.error('âŒ å¯†ç¢¼éŒ¯èª¤');\n        recordLoginAttempt(username, false);\n        return { success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' };\n      }\n\n      // âœ… Supabase é©—è­‰æˆåŠŸï¼\n      logger.log('âœ… Supabase é©—è­‰æˆåŠŸï¼Œå»ºç«‹è§’è‰²å¡...');\n      recordLoginAttempt(username, true);\n\n      // å»ºç«‹ç”¨æˆ¶å°è±¡ï¼ˆå‘ä¸‹ç›¸å®¹ï¼‰\n      const user: User = {\n        id: employee.id,\n        employee_number: employee.employee_number,\n        english_name: employee.english_name,\n        display_name: employee.display_name,\n        chinese_name: employee.chinese_name || employee.display_name,\n        personal_info: employee.personal_info,\n        job_info: employee.job_info,\n        salary_info: employee.salary_info,\n        permissions: employee.permissions,\n        roles: employee.roles || [], // é™„åŠ èº«ä»½æ¨™ç±¤\n        attendance: employee.attendance,\n        contracts: employee.contracts,\n        status: employee.status,\n        created_at: employee.created_at || new Date().toISOString(),\n        updated_at: employee.updated_at || new Date().toISOString()\n      };\n\n      // ğŸ´ å»ºç«‹è§’è‰²å¡ï¼ˆProfile Cardï¼‰- ç”¨æ–¼é›¢ç·šå¿«é€Ÿç™»å…¥\n      const profile: LocalProfile = {\n        id: employee.id,\n        email: employee.personal_info?.email || `${username}@venturo.local`,\n        employee_number: employee.employee_number,\n        display_name: employee.display_name,\n        english_name: employee.english_name,\n        role: employee.permissions?.includes('admin') ? 'ADMIN' : 'EMPLOYEE',\n        permissions: employee.permissions || [],\n        roles: employee.roles || [], // é™„åŠ èº«ä»½æ¨™ç±¤ï¼ˆæ”¯æ´å¤šé‡è§’è‰²ï¼‰\n        personal_info: employee.personal_info,\n        job_info: employee.job_info,\n        salary_info: employee.salary_info,\n        contracts: employee.contracts,\n        attendance: employee.attendance,\n        lastLoginAt: new Date().toISOString(),\n        created_at: employee.created_at || new Date().toISOString(),\n        status: employee.status === 'active' ? 'active' : 'inactive'\n      };\n\n      // ğŸ’¾ å„²å­˜è§’è‰²å¡åˆ° local-auth-managerï¼ˆä¸‹æ¬¡å¯é›¢ç·šç™»å…¥ï¼‰\n      localAuthStore.addProfile(profile);\n      localAuthStore.setCurrentProfile(profile);\n      logger.log('ğŸ´ è§’è‰²å¡å·²å»ºç«‹ï¼Œä¸‹æ¬¡å¯é›¢ç·šç™»å…¥');\n\n      // ç”Ÿæˆ JWT token\n      const authPayload: AuthPayload = {\n        id: employee.id,\n        employee_number: employee.employee_number,\n        permissions: employee.permissions || [],\n        role: employee.permissions?.includes('admin') ? 'admin' : 'employee'\n      };\n\n      const token = generateToken(authPayload);\n\n      // è¨­å®šå®‰å…¨ cookie\n      setSecureCookie(token, false);\n\n      // æ›´æ–° store ç‹€æ…‹\n      set({\n        user,\n        isAuthenticated: true,\n        currentProfile: profile\n      });\n\n      // TODO: åˆå§‹åŒ–åŒæ­¥å·²æ”¹ç”¨ createStore çš„ fetchAll è‡ªå‹•è™•ç†\n      // æ¯å€‹é é¢è¼‰å…¥æ™‚æœƒè‡ªå‹•å¾ Supabase ä¸‹è¼‰è³‡æ–™\n      logger.log('âœ… ç™»å…¥æˆåŠŸï¼Œè³‡æ–™å°‡åœ¨å„é é¢è¼‰å…¥æ™‚è‡ªå‹•åŒæ­¥');\n\n      /* èˆŠçš„åˆå§‹åŒ–åŒæ­¥ç¨‹å¼ç¢¼ï¼ˆå·²å»¢æ£„ï¼‰\n      try {\n        const { needsInitialSync, initialSync } = await import('@/lib/offline/initial-sync');\n        const needsSync = await needsInitialSync();\n        if (needsSync) {\n          logger.log('ğŸ“¥ é–‹å§‹åˆå§‹åŒ–åŒæ­¥...');\n          initialSync((progress) => {\n            logger.log(`ğŸ“Š åŒæ­¥é€²åº¦: ${progress.current}/${progress.total} - ${progress.table}`);\n          }).then((result) => {\n            if (result.success) {\n              logger.log('âœ… åˆå§‹åŒ–åŒæ­¥å®Œæˆï¼');\n            } else {\n              logger.error('âŒ åˆå§‹åŒ–åŒæ­¥å¤±æ•—:', result.error);\n            }\n          });\n        } else {\n          logger.log('â„¹ï¸ æœ¬åœ°è³‡æ–™æ­£å¸¸ï¼Œè·³éåˆå§‹åŒ–åŒæ­¥');\n        }\n      } catch (syncError) {\n        logger.warn('âš ï¸ åŒæ­¥æª¢æŸ¥å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿ç™»å…¥:', syncError);\n      }\n      */\n\n      logger.log('âœ… ç™»å…¥æˆåŠŸ:', employee.display_name);\n      return { success: true };\n\n    } catch (error) {\n      logger.error('ğŸ’¥ ç™»å…¥é©—è­‰éŒ¯èª¤:', error);\n      return { success: false, message: 'ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦' };\n    }\n  },\n\n      checkPermission: (permission: string) => {\n        const profile = get().currentProfile;\n        if (!profile) return false;\n        return profile.permissions.includes(permission) ||\n               profile.permissions.includes('admin');\n      },\n\n      switchProfile: (profileId: string) => {\n        const success = OfflineAuthService.switchProfile(profileId);\n        if (success) {\n          const profile = useLocalAuthStore.getState().getProfileById(profileId);\n          if (profile) {\n            const user: User = {\n              id: profile.id,\n              employee_number: profile.employee_number,\n              english_name: profile.english_name,\n              display_name: profile.display_name,\n              chinese_name: profile.display_name, // å¾ profile å–å¾—\n              personal_info: profile.personal_info || {},\n              job_info: profile.job_info || {},\n              salary_info: profile.salary_info || {},\n              permissions: profile.permissions || [],\n              roles: profile.roles || [], // é™„åŠ èº«ä»½æ¨™ç±¤\n              attendance: profile.attendance || { leave_records: [], overtime_records: [] },\n              contracts: profile.contracts || [],\n              status: profile.status as 'active' | 'probation' | 'leave' | 'terminated',\n              created_at: profile.created_at || new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            };\n\n            set({\n              currentProfile: profile,\n              user,\n              isAuthenticated: true\n            });\n          }\n        }\n        return success;\n      },\n\n      toggleSidebar: () => set((state) => ({ sidebarCollapsed: !state.sidebarCollapsed })),\n      setSidebarCollapsed: (collapsed) => set({ sidebarCollapsed: collapsed }),\n    }),\n    {\n      name: 'auth-storage',\n      skipHydration: true, // ğŸ”¥ é¿å… SSR æ™‚è®€å– localStorage\n      partialize: (state) => ({\n        user: state.user,\n        isAuthenticated: state.isAuthenticated,\n        currentProfile: state.currentProfile,\n        sidebarCollapsed: state.sidebarCollapsed,\n        isOfflineMode: state.isOfflineMode\n      })\n    }\n  )\n);\n\n// ğŸ”„ å®¢æˆ¶ç«¯è‡ªå‹• hydrateï¼ˆæ¢å¾©ç™»å…¥ç‹€æ…‹ï¼‰\nif (typeof window !== 'undefined') {\n  // @ts-expect-error - zustand persist API type issue\n  useAuthStore.persist.rehydrate();\n}","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/calendar-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/create-store.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'markAsSynced' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateCode' is defined but never used. Allowed unused vars must match /^_/u.","line":71,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fastInsert' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":146,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":146,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4995,4998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4995,4998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":199,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5904,5907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5904,5907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":264,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8459,8462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8459,8462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8783,8786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8783,8786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10774,10777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10774,10777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":369,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":369,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12765,12768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12765,12768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":391,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":391,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13557,13560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13557,13560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":454,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15806,15809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15806,15809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":455,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":455,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15847,15850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15847,15850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":511,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":511,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17839,17842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17839,17842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Zustand Store å·¥å» å‡½æ•¸\n * æ”¯æ´ Supabase é›²ç«¯åŒæ­¥ + IndexedDB æœ¬åœ°å¿«å–\n *\n * æ¶æ§‹ï¼š\n * - Supabase: é›²ç«¯è³‡æ–™åº«ï¼ˆSingle Source of Truthï¼‰\n * - IndexedDB: æœ¬åœ°å¿«å–ï¼ˆé›¢ç·šæ”¯æ´ï¼‰\n * - Zustand: UI ç‹€æ…‹ç®¡ç†\n */\n\nimport { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nimport { BaseEntity } from '@/types';\n\nimport { memoryCache } from '@/lib/cache/memory-cache';\nimport { localDB } from '@/lib/db';\nimport { TableName } from '@/lib/db/schemas';\nimport { isSyncableTable } from '@/lib/db/sync-schema-helper';\nimport { withSyncFields, markAsSynced } from '@/lib/db/sync-utils';\nimport { generateUUID } from '@/lib/utils/uuid';\nimport { logger } from '@/lib/utils/logger';\nimport { backgroundSyncService } from '@/lib/sync/background-sync-service';\n\n/**\n * Store ç‹€æ…‹ä»‹é¢\n */\ninterface StoreState<T extends BaseEntity> {\n  // è³‡æ–™ç‹€æ…‹\n  items: T[];\n  loading: boolean;\n  error: string | null;\n\n  // ğŸ”§ æ–°å¢ï¼šè«‹æ±‚å–æ¶ˆæ§åˆ¶å™¨\n  _abortController?: AbortController;\n\n  // CRUD æ“ä½œ\n  fetchAll: () => Promise<void>;\n  fetchById: (id: string) => Promise<T | null>;\n  create: (data: Omit<T, 'id' | 'created_at' | 'updated_at'>) => Promise<T>;\n  update: (id: string, data: Partial<T>) => Promise<T>;\n  delete: (id: string) => Promise<void>;\n\n  // æ‰¹æ¬¡æ“ä½œ\n  createMany: (dataArray: Omit<T, 'id' | 'created_at' | 'updated_at'>[]) => Promise<T[]>;\n  deleteMany: (ids: string[]) => Promise<void>;\n\n  // æŸ¥è©¢æ“ä½œ\n  findByField: (field: keyof T, value: unknown) => T[];\n  filter: (predicate: (item: T) => boolean) => T[];\n  count: () => number;\n\n  // å·¥å…·æ–¹æ³•\n  clear: () => Promise<void>;\n  setError: (error: string | null) => void;\n  setLoading: (loading: boolean) => void;\n  cancelRequests: () => void; // ğŸ”§ æ–°å¢ï¼šå–æ¶ˆé€²è¡Œä¸­çš„è«‹æ±‚\n}\n\n/**\n * ç·¨è™Ÿç”Ÿæˆé…ç½®\n */\ninterface CodeConfig {\n  prefix: string; // å‰ç¶´ï¼ˆå¦‚ 'T', 'O', 'C'ï¼‰\n  year?: number;  // å¹´ä»½ï¼ˆé è¨­ç•¶å‰å¹´ä»½ï¼‰\n}\n\n/**\n * ç”Ÿæˆç·¨è™Ÿ\n */\nfunction generateCode(config: CodeConfig, existingItems: BaseEntity[]): string {\n  const year = config.year || new Date().getFullYear();\n  const yearStr = year.toString();\n\n  // æ‰¾å‡ºç•¶å¹´åº¦æœ€å¤§çš„æµæ°´è™Ÿ\n  const prefix = `${config.prefix}${yearStr}`;\n  const maxNumber = existingItems\n    .map((item) => {\n      if ('code' in item) {\n        const code = (item as { code?: string }).code;\n        if (code?.startsWith(prefix)) {\n          const numPart = code.substring(prefix.length);\n          return parseInt(numPart, 10) || 0;\n        }\n      }\n      return 0;\n    })\n    .reduce((max, num) => Math.max(max, num), 0);\n\n  // ç”Ÿæˆæ–°ç·¨è™Ÿ\n  const nextNumber = (maxNumber + 1).toString().padStart(4, '0');\n  return `${prefix}${nextNumber}`;\n}\n\n/**\n * Store é…ç½®é¸é …\n */\ninterface StoreConfig {\n  /** è³‡æ–™è¡¨åç¨± */\n  tableName: TableName;\n  /** ç·¨è™Ÿå‰ç¶´ï¼ˆå¯é¸ï¼Œå¦‚ 'T', 'O', 'C'ï¼‰ */\n  codePrefix?: string;\n  /** æ˜¯å¦å•Ÿç”¨ Supabase åŒæ­¥ï¼ˆé è¨­è®€å–ç’°å¢ƒè®Šæ•¸ï¼‰ */\n  enableSupabase?: boolean;\n  /** FastIn æ¨¡å¼ï¼šæœ¬åœ°å…ˆå¯«å…¥ IndexedDB â†’ èƒŒæ™¯åŒæ­¥ Supabaseï¼ˆé è¨­ trueï¼‰ */\n  fastInsert?: boolean;\n}\n\n/**\n * å»ºç«‹ Store å·¥å» å‡½æ•¸\n *\n * @example\n * // åŸºæœ¬ä½¿ç”¨\n * const useTourStore = createStore({ tableName: 'tours', codePrefix: 'T' });\n *\n * // FastIn æ¨¡å¼ï¼ˆé è¨­ï¼‰\n * const useQuoteStore = createStore({ tableName: 'quotes', fastInsert: true });\n *\n * // Supabase å„ªå…ˆæ¨¡å¼\n * const useOrderStore = createStore({ tableName: 'orders', fastInsert: false });\n */\nexport function createStore<T extends BaseEntity>(\n  tableNameOrConfig: TableName | StoreConfig,\n  codePrefixParam?: string,\n  enableSupabaseParam: boolean = process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true'\n) {\n  // æ”¯æ´å…©ç¨®èª¿ç”¨æ–¹å¼ï¼š1. èˆŠç‰ˆåƒæ•¸ 2. é…ç½®ç‰©ä»¶\n  let config: StoreConfig;\n  if (typeof tableNameOrConfig === 'string') {\n    // èˆŠç‰ˆèª¿ç”¨æ–¹å¼ï¼ˆå‘å¾Œç›¸å®¹ï¼‰\n    config = {\n      tableName: tableNameOrConfig,\n      codePrefix: codePrefixParam,\n      enableSupabase: enableSupabaseParam,\n      fastInsert: true, // é è¨­å•Ÿç”¨ FastIn\n    };\n  } else {\n    // æ–°ç‰ˆé…ç½®ç‰©ä»¶\n    config = {\n      ...tableNameOrConfig,\n      enableSupabase: tableNameOrConfig.enableSupabase ?? (process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true'),\n      fastInsert: tableNameOrConfig.fastInsert ?? true, // é è¨­å•Ÿç”¨ FastIn\n    };\n  }\n\n  const { tableName, codePrefix, enableSupabase, fastInsert } = config;\n  const store = create<StoreState<T>>()(\n    persist(\n      (set, get) => ({\n        // åˆå§‹ç‹€æ…‹\n        items: [],\n        loading: false,\n        error: null,\n\n        // è¨­å®šè¼‰å…¥ç‹€æ…‹\n        setLoading: (loading: boolean) => set({ loading }),\n\n        // è¨­å®šéŒ¯èª¤\n        setError: (error: string | null) => set({ error }),\n\n        // å–å¾—æ‰€æœ‰è³‡æ–™ï¼ˆIndexedDB å„ªå…ˆé¡¯ç¤ºï¼ŒèƒŒæ™¯åŒæ­¥ Supabaseï¼‰\n        fetchAll: async () => {\n          try {\n            // ğŸ”§ å–æ¶ˆå‰ä¸€å€‹è«‹æ±‚\n            const state = get();\n            if (state._abortController) {\n              state._abortController.abort();\n            }\n\n            // å»ºç«‹æ–°çš„ AbortController\n            const controller = new AbortController();\n            set({ loading: true, error: null, _abortController: controller });\n\n            if (enableSupabase && typeof window !== 'undefined') {\n              // 1. å…ˆå¾ IndexedDB è®€å–\n              let cachedItems = await localDB.getAll(tableName) as T[];\n              // éæ¿¾è»Ÿåˆªé™¤çš„é …ç›®\n              cachedItems = cachedItems.filter((item: any) => !item._deleted);\n\n              // 2. æª¢æŸ¥æ˜¯å¦éœ€è¦é¦–æ¬¡åˆå§‹åŒ–ä¸‹è¼‰\n              const initFlag = `${tableName}_initialized`;\n              const isInitialized = localStorage.getItem(initFlag);\n\n              if (!isInitialized && cachedItems.length === 0) {\n                // ğŸ”„ é¦–æ¬¡è¼‰å…¥ + æœ¬åœ°ç‚ºç©º â†’ å‰æ™¯å®Œæ•´ä¸‹è¼‰\n                logger.log(`ğŸ”„ [${tableName}] é¦–æ¬¡åˆå§‹åŒ–ï¼Œå¾ Supabase ä¸‹è¼‰è³‡æ–™...`);\n\n                try {\n                  const { supabase } = await import('@/lib/supabase/client');\n                  const { data, error: supabaseError } = await supabase\n                    .from(tableName)\n                    .select('*')\n                    .order('created_at', { ascending: true })\n                    .abortSignal(controller.signal);\n\n                  if (!supabaseError && data) {\n                    let items = (data || []) as T[];\n                    // éæ¿¾è»Ÿåˆªé™¤çš„é …ç›®\n                    items = items.filter((item: any) => !item._deleted);\n\n                    // æ‰¹æ¬¡å­˜å…¥ IndexedDB\n                    for (const item of items) {\n                      await localDB.put(tableName, item);\n                    }\n\n                    // æ›´æ–° UI\n                    set({ items, loading: false });\n\n                    // è¨­ç½®åˆå§‹åŒ–æ¨™è¨˜\n                    localStorage.setItem(initFlag, 'true');\n\n                    logger.log(`âœ… [${tableName}] åˆå§‹åŒ–å®Œæˆ:`, items.length, 'ç­†');\n                    return;\n                  } else {\n                    logger.warn(`âš ï¸ [${tableName}] Supabase åˆå§‹åŒ–å¤±æ•—ï¼Œç¹¼çºŒä½¿ç”¨ç©ºè³‡æ–™`);\n                  }\n                } catch (initError) {\n                  logger.warn(`âš ï¸ [${tableName}] åˆå§‹åŒ–ä¸‹è¼‰å¤±æ•—:`, initError);\n                }\n              }\n\n              // 3. å·²åˆå§‹åŒ–æˆ–æœ‰å¿«å–è³‡æ–™ â†’ ä½¿ç”¨å¿«å–å„ªå…ˆç­–ç•¥\n              logger.log(`ğŸ’¾ [${tableName}] å¾ IndexedDB å¿«é€Ÿè¼‰å…¥...`);\n\n              // ç«‹å³æ›´æ–° UIï¼ˆä¸ç­‰ Supabaseï¼‰\n              set({ items: cachedItems, loading: false });\n              logger.log(`âœ… [${tableName}] IndexedDB å¿«é€Ÿè¼‰å…¥å®Œæˆ:`, cachedItems.length, 'ç­†');\n\n              // 2. èƒŒæ™¯å¾ Supabase åŒæ­¥ï¼ˆä¸é˜»å¡ UIï¼‰\n              setTimeout(async () => {\n                try {\n                  // ğŸ”„ Step 1: å…ˆä¸Šå‚³å¾…åŒæ­¥è³‡æ–™\n                  if (isSyncableTable(tableName)) {\n                    logger.log(`ğŸ“¤ [${tableName}] ä¸Šå‚³å¾…åŒæ­¥è³‡æ–™...`);\n                    await backgroundSyncService.syncTable(tableName);\n                    logger.log(`âœ… [${tableName}] å¾…åŒæ­¥è³‡æ–™å·²ä¸Šå‚³`);\n                  }\n\n                  // ğŸ”„ Step 2: ä¸‹è¼‰æœ€æ–°è³‡æ–™\n                  logger.log(`â˜ï¸ [${tableName}] èƒŒæ™¯åŒæ­¥ Supabase...`);\n                  const { supabase } = await import('@/lib/supabase/client');\n\n                  const { data, error: supabaseError } = await supabase\n                    .from(tableName)\n                    .select('*')\n                    .order('created_at', { ascending: true })\n                    .abortSignal(controller.signal);\n\n                  if (supabaseError) {\n                    logger.warn(`âš ï¸ [${tableName}] Supabase åŒæ­¥å¤±æ•—ï¼Œç¹¼çºŒä½¿ç”¨å¿«å–è³‡æ–™`);\n                    return;\n                  }\n\n                  const items = (data || []) as T[];\n                  // TODO: è»Ÿåˆªé™¤æ©Ÿåˆ¶éœ€è¦é‡æ–°è¨­è¨ˆï¼ˆç›®å‰æš«æ™‚ç§»é™¤ _deleted éæ¿¾ï¼‰\n                  // items = items.filter((item: any) => !item._deleted);\n\n                  logger.log(`âœ… [${tableName}] Supabase åŒæ­¥æˆåŠŸ:`, items.length, 'ç­†');\n\n                  // ğŸ”§ ä¿®æ­£ï¼šåˆä½µæœ¬åœ°å¾…ä¸Šå‚³è³‡æ–™ï¼Œä¸ç›´æ¥è¦†è“‹\n                  const currentItems = get().items;\n\n                  // æ‰¾å‡ºæœ¬åœ°æœ‰ä½† Supabase æ²’æœ‰çš„è³‡æ–™ï¼ˆå¾…ä¸Šå‚³æˆ–æ–°å¢çš„ï¼‰\n                  const localOnlyItems = currentItems.filter((localItem: any) => {\n                    // éæ¿¾è»Ÿåˆªé™¤é …ç›®\n                    if (localItem._deleted) return false;\n\n                    // ä¿ç•™æœ‰ _needs_sync: true æ¨™è¨˜çš„æœ¬åœ°è³‡æ–™ï¼ˆæ–°å¢æˆ–ä¿®æ”¹ï¼‰\n                    if (localItem._needs_sync === true) return true;\n                    // ä¿ç•™ Supabase ä¸­ä¸å­˜åœ¨çš„è³‡æ–™\n                    return !items.find((serverItem: any) => serverItem.id === localItem.id);\n                  });\n\n                  // åˆä½µï¼šSupabase è³‡æ–™ + æœ¬åœ°å°ˆå±¬è³‡æ–™\n                  const mergedItems = [...items, ...localOnlyItems];\n\n                  if (JSON.stringify(mergedItems) !== JSON.stringify(currentItems)) {\n                    set({ items: mergedItems });\n                    logger.log(`ğŸ”„ [${tableName}] UI å·²æ›´æ–° (Supabase: ${items.length} ç­† + æœ¬åœ°: ${localOnlyItems.length} ç­†)`);\n                  }\n\n                  // åˆ†æ‰¹æ›´æ–° IndexedDB å¿«å–\n                  const batchSize = 10;\n                  const syncBatch = async (startIndex: number) => {\n                    if (startIndex >= items.length) {\n                      logger.log(`âœ… [${tableName}] IndexedDB å¿«å–å®Œæˆ (å…± ${items.length} ç­†)`);\n                      return;\n                    }\n                    const batch = items.slice(startIndex, startIndex + batchSize);\n                    await Promise.all(batch.map(item => localDB.put(tableName, item)));\n                    setTimeout(() => syncBatch(startIndex + batchSize), 10);\n                  };\n                  syncBatch(0).catch(err => {\n                    logger.warn(`âš ï¸ [${tableName}] IndexedDB å¿«å–å¤±æ•—:`, err);\n                  });\n                } catch (syncError) {\n                  logger.warn(`âš ï¸ [${tableName}] èƒŒæ™¯åŒæ­¥å¤±æ•—:`, syncError);\n                }\n              }, 0);\n\n            } else {\n              // å¾ IndexedDB è®€å–ï¼ˆé›¢ç·šæ¨¡å¼æˆ–æœªå•Ÿç”¨ Supabaseï¼‰\n              logger.log(`ğŸ’¾ [${tableName}] å¾ IndexedDB è¼‰å…¥è³‡æ–™...`);\n              const items = await localDB.getAll(tableName) as T[];\n\n              // TODO: è»Ÿåˆªé™¤æ©Ÿåˆ¶éœ€è¦é‡æ–°è¨­è¨ˆï¼ˆç›®å‰æš«æ™‚ç§»é™¤ _deleted éæ¿¾ï¼‰\n              // items = items.filter((item: any) => !item._deleted);\n\n              set({ items, loading: false });\n              logger.log(`âœ… [${tableName}] IndexedDB è®€å–æˆåŠŸ:`, items.length, 'ç­†');\n            }\n\n          } catch (error) {\n            // ğŸ”§ å¿½ç•¥ AbortErrorï¼ˆæ­£å¸¸çš„è«‹æ±‚å–æ¶ˆï¼‰\n            if (error && typeof error === 'object' && 'code' in error && (error as any).code === '20') {\n              set({ loading: false });\n              return;\n            }\n\n            // ğŸ”§ å¿½ç•¥ AbortErrorï¼ˆDOMException é¡å‹ï¼‰\n            if (error && error instanceof Error && error.name === 'AbortError') {\n              set({ loading: false });\n              return;\n            }\n\n            // ğŸ”§ ä»»ä½•å…¶ä»–éŒ¯èª¤ï¼šéœé»˜åˆ‡æ›åˆ°æœ¬åœ°æ¨¡å¼\n            try {\n              const items = await localDB.getAll(tableName) as T[];\n              // TODO: è»Ÿåˆªé™¤æ©Ÿåˆ¶éœ€è¦é‡æ–°è¨­è¨ˆï¼ˆç›®å‰æš«æ™‚ç§»é™¤ _deleted éæ¿¾ï¼‰\n              // items = items.filter((item: any) => !item._deleted);\n              set({ items, loading: false, error: null });\n              logger.log(`ğŸ’¾ [${tableName}] IndexedDB è®€å–æˆåŠŸ:`, items.length, 'ç­†');\n            } catch (localError) {\n              // é€£ IndexedDB éƒ½å¤±æ•—ï¼Œæ‰é¡¯ç¤ºéŒ¯èª¤\n              logger.error(`âŒ [${tableName}] ç„¡æ³•è¼‰å…¥è³‡æ–™:`, localError);\n              set({ error: 'ç„¡æ³•è¼‰å…¥è³‡æ–™', loading: false });\n            }\n          }\n        },\n\n        // æ ¹æ“š ID å–å¾—å–®ç­†\n        fetchById: async (id: string) => {\n          try {\n            set({ loading: true, error: null });\n\n            // å˜—è©¦å¾ Supabase è®€å–\n            if (enableSupabase && typeof window !== 'undefined') {\n              try {\n                const { supabase } = await import('@/lib/supabase/client');\n                const { data, error: supabaseError } = await supabase\n                  .from(tableName)\n                  .select('*')\n                  .eq('id', id)\n                  .single();\n\n                if (supabaseError) throw supabaseError;\n\n                // Supabase æˆåŠŸï¼Œè¿”å›è³‡æ–™\n                set({ loading: false });\n                return data as T;\n              } catch (supabaseError) {\n                // Supabase å¤±æ•—ï¼ˆæ‰¾ä¸åˆ°è³‡æ–™æˆ–é€£ç·šéŒ¯èª¤ï¼‰ï¼Œéœé»˜é™ç´šåˆ° IndexedDB\n                logger.log(`âš ï¸ [${tableName}] Supabase æŸ¥è©¢å¤±æ•—ï¼Œåˆ‡æ›åˆ°æœ¬åœ°æ¨¡å¼`, supabaseError);\n              }\n            }\n\n            // å¾ IndexedDB è®€å–ï¼ˆç„¡è«–æ˜¯ Supabase é—œé–‰æˆ–å¤±æ•—ï¼‰\n            const items = await localDB.getAll(tableName) as T[];\n            const item = items.find((i: any) => i.id === id) || null;\n            set({ loading: false });\n            return item;\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'è®€å–å¤±æ•—';\n            set({ error: errorMessage, loading: false });\n            logger.error(`âŒ [${tableName}] fetchById å¤±æ•—:`, error);\n            return null;\n          }\n        },\n\n        // å»ºç«‹è³‡æ–™ï¼ˆFastIn æ¨¡å¼ï¼šIndexedDB å„ªå…ˆ â†’ èƒŒæ™¯åŒæ­¥ Supabaseï¼‰\n        create: async (data) => {\n          try {\n            set({ loading: true, error: null });\n\n            // ç”Ÿæˆ ID\n            const id = generateUUID();\n\n            // å¦‚æœæœ‰ codePrefixï¼Œæš«æ™‚ä½¿ç”¨ TBC ç·¨è™Ÿï¼ˆèƒŒæ™¯åŒæ­¥æ™‚æœƒå–å¾—æ­£å¼ç·¨è™Ÿï¼‰\n            let recordData = { ...data, id } as T;\n            if (codePrefix && 'code' in data) {\n              const existingCode = (data as any).code;\n              if (!existingCode) {\n                // FastIn æ¨¡å¼ï¼šä¸€å¾‹å…ˆç”¨ TBC ç·¨è™Ÿ\n                const code: string = `${codePrefix}TBC`;\n                recordData = { ...recordData, code } as T;\n                logger.log(`âš¡ [${tableName}] FastIn: ä½¿ç”¨ TBC ç·¨è™Ÿ ${code}`);\n              }\n            }\n\n            // æª¢æŸ¥æ˜¯å¦ç‚ºå¯åŒæ­¥è¡¨\n            const needsSyncFields = isSyncableTable(tableName);\n\n            // FastIn Step 1: ç«‹å³å¯«å…¥ IndexedDB\n            recordData = needsSyncFields\n              ? withSyncFields(recordData, false) as T  // _needs_sync: true\n              : recordData;\n\n            await localDB.put(tableName, recordData);\n            logger.log(`ğŸ’¾ [${tableName}] FastIn: å·²å¯«å…¥æœ¬åœ° IndexedDB`);\n\n            // FastIn Step 2: ç«‹å³æ›´æ–° UI\n            set((state) => ({\n              items: [...state.items, recordData],\n              loading: false,\n            }));\n\n            logger.log(`âš¡ [${tableName}] FastIn: UI å·²æ›´æ–°ï¼ˆæœ¬åœ°è³‡æ–™ï¼‰`);\n\n            // FastIn Step 3: èƒŒæ™¯åŒæ­¥åˆ° Supabaseï¼ˆä¸é˜»å¡ UIï¼‰\n            if (enableSupabase && typeof window !== 'undefined' && needsSyncFields) {\n              setTimeout(async () => {\n                try {\n                  logger.log(`â˜ï¸ [${tableName}] FastIn: é–‹å§‹èƒŒæ™¯åŒæ­¥...`);\n                  await backgroundSyncService.syncTable(tableName);\n                  logger.log(`âœ… [${tableName}] FastIn: èƒŒæ™¯åŒæ­¥å®Œæˆ`);\n                } catch (syncError) {\n                  logger.warn(`âš ï¸ [${tableName}] FastIn: èƒŒæ™¯åŒæ­¥å¤±æ•—ï¼ˆä¸å½±éŸ¿æœ¬åœ°è³‡æ–™ï¼‰`, syncError);\n                }\n              }, 0);\n            }\n\n            return recordData;\n\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'å»ºç«‹å¤±æ•—';\n            set({ error: errorMessage, loading: false });\n            throw error;\n          }\n        },\n\n        // æ›´æ–°è³‡æ–™ï¼ˆFastIn æ¨¡å¼ï¼šIndexedDB å„ªå…ˆ â†’ èƒŒæ™¯åŒæ­¥ Supabaseï¼‰\n        update: async (id: string, data: Partial<T>) => {\n          try {\n            set({ loading: true, error: null });\n\n            // æª¢æŸ¥æ˜¯å¦ç‚ºå¯åŒæ­¥è¡¨\n            const needsSyncFields = isSyncableTable(tableName);\n\n            // FastIn Step 1: æº–å‚™æ›´æ–°è³‡æ–™ï¼ˆæ¨™è¨˜ç‚ºå¾…åŒæ­¥ï¼‰\n            let syncData = data;\n            if (needsSyncFields) {\n              syncData = {\n                ...data,\n                _needs_sync: true as any,\n                _synced_at: null as any,\n              };\n            }\n\n            // FastIn Step 2: ç«‹å³æ›´æ–° IndexedDB\n            await localDB.update(tableName, id, syncData);\n            logger.log(`ğŸ’¾ [${tableName}] FastIn: å·²æ›´æ–°æœ¬åœ° IndexedDB`);\n\n            // FastIn Step 3: ç«‹å³æ›´æ–° UI\n            let updatedItem: T | undefined;\n            set((state) => {\n              const newItems = (state.items || []).map(item => {\n                if (item.id === id) {\n                  updatedItem = { ...item, ...syncData, updated_at: new Date().toISOString() };\n                  return updatedItem;\n                }\n                return item;\n              });\n              return { items: newItems, loading: false };\n            });\n\n            if (!updatedItem) {\n              throw new Error('æ‰¾ä¸åˆ°è¦æ›´æ–°çš„é …ç›®');\n            }\n\n            logger.log(`âš¡ [${tableName}] FastIn: UI å·²æ›´æ–°ï¼ˆæœ¬åœ°è³‡æ–™ï¼‰`);\n\n            // FastIn Step 4: èƒŒæ™¯åŒæ­¥åˆ° Supabaseï¼ˆä¸é˜»å¡ UIï¼‰\n            if (enableSupabase && typeof window !== 'undefined' && needsSyncFields) {\n              setTimeout(async () => {\n                try {\n                  logger.log(`â˜ï¸ [${tableName}] FastIn: é–‹å§‹èƒŒæ™¯åŒæ­¥...`);\n                  await backgroundSyncService.syncTable(tableName);\n                  logger.log(`âœ… [${tableName}] FastIn: èƒŒæ™¯åŒæ­¥å®Œæˆ`);\n                } catch (syncError) {\n                  logger.warn(`âš ï¸ [${tableName}] FastIn: èƒŒæ™¯åŒæ­¥å¤±æ•—ï¼ˆä¸å½±éŸ¿æœ¬åœ°è³‡æ–™ï¼‰`, syncError);\n                }\n              }, 0);\n            }\n\n            return updatedItem;\n\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'æ›´æ–°å¤±æ•—';\n            set({ error: errorMessage, loading: false });\n            throw error;\n          }\n        },\n\n        // åˆªé™¤è³‡æ–™ï¼ˆFastIn æ¨¡å¼ï¼šç«‹å³åˆªé™¤ â†’ èƒŒæ™¯åŒæ­¥ Supabaseï¼‰\n        delete: async (id: string) => {\n          try {\n            set({ loading: true, error: null });\n\n            // FastIn Step 1: åŠ å…¥åˆªé™¤éšŠåˆ—ï¼ˆç”¨æ–¼èƒŒæ™¯åŒæ­¥ï¼‰\n            const items = await localDB.getAll(tableName) as T[];\n            const item = items.find((i: any) => i.id === id);\n\n            if (item) {\n              // åŠ å…¥åˆªé™¤éšŠåˆ—\n              try {\n                await localDB.put('syncQueue', {\n                  id: generateUUID(),\n                  table_name: tableName,\n                  record_id: id,\n                  operation: 'delete',\n                  data: item,\n                  created_at: new Date().toISOString(),\n                });\n                logger.log(`ğŸ“ [${tableName}] FastIn: å·²åŠ å…¥åˆªé™¤éšŠåˆ—`);\n              } catch (queueError) {\n                logger.warn(`âš ï¸ [${tableName}] FastIn: ç„¡æ³•åŠ å…¥åˆªé™¤éšŠåˆ—:`, queueError);\n              }\n            }\n\n            // FastIn Step 2: ç«‹å³å¾ IndexedDB åˆªé™¤\n            await localDB.delete(tableName, id);\n            logger.log(`ğŸ’¾ [${tableName}] FastIn: å·²å¾æœ¬åœ°åˆªé™¤`);\n\n            // FastIn Step 3: ç«‹å³æ›´æ–° UI\n            set((state) => ({\n              items: (state.items || []).filter(item => item.id !== id),\n              loading: false,\n            }));\n\n            logger.log(`âš¡ [${tableName}] FastIn: UI å·²æ›´æ–°ï¼ˆæœ¬åœ°åˆªé™¤ï¼‰`);\n\n            // FastIn Step 4: èƒŒæ™¯åŒæ­¥åˆ° Supabaseï¼ˆä¸é˜»å¡ UIï¼‰\n            if (enableSupabase && typeof window !== 'undefined') {\n              setTimeout(async () => {\n                try {\n                  logger.log(`â˜ï¸ [${tableName}] FastIn: é–‹å§‹èƒŒæ™¯åŒæ­¥åˆªé™¤...`);\n                  await backgroundSyncService.syncTable(tableName);\n                  logger.log(`âœ… [${tableName}] FastIn: èƒŒæ™¯åŒæ­¥åˆªé™¤å®Œæˆ`);\n                } catch (syncError) {\n                  logger.warn(`âš ï¸ [${tableName}] FastIn: èƒŒæ™¯åŒæ­¥åˆªé™¤å¤±æ•—ï¼ˆä¸å½±éŸ¿æœ¬åœ°ï¼‰`, syncError);\n                }\n              }, 0);\n            }\n\n          } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : 'åˆªé™¤å¤±æ•—';\n            set({ error: errorMessage, loading: false });\n            throw error;\n          }\n        },\n\n        // æ‰¹æ¬¡å»ºç«‹\n        createMany: async (dataArray) => {\n          const results: T[] = [];\n\n          for (const data of dataArray) {\n            const created = await get().create(data);\n            results.push(created);\n          }\n\n          return results;\n        },\n\n        // æ‰¹æ¬¡åˆªé™¤\n        deleteMany: async (ids: string[]) => {\n          for (const id of ids) {\n            await get().delete(id);\n          }\n        },\n\n        // æ ¹æ“šæ¬„ä½æŸ¥è©¢\n        findByField: (field: keyof T, value: unknown) => {\n          return get().items.filter((item) => item[field] === value);\n        },\n\n        // è‡ªè¨‚éæ¿¾\n        filter: (predicate: (item: T) => boolean) => {\n          return get().items.filter(predicate);\n        },\n\n        // è¨ˆæ•¸\n        count: () => {\n          return get().items.length;\n        },\n\n        // æ¸…ç©ºè³‡æ–™\n        clear: async () => {\n          set({ items: [], error: null });\n          memoryCache.invalidatePattern(`${tableName}:`);\n        },\n\n        // ğŸ”„ åŒæ­¥å¾…è™•ç†è³‡æ–™åˆ° Supabaseï¼ˆæ‰‹å‹•è§¸ç™¼ï¼‰\n        syncPending: async () => {\n          if (!enableSupabase || typeof window === 'undefined') {\n            logger.log(`â­ï¸ [${tableName}] è·³éåŒæ­¥ï¼ˆSupabase æœªå•Ÿç”¨æˆ–éç€è¦½å™¨ç’°å¢ƒï¼‰`);\n            return;\n          }\n\n          try {\n            logger.log(`ğŸ”„ [${tableName}] é–‹å§‹æ‰‹å‹•åŒæ­¥...`);\n\n            // ä½¿ç”¨èƒŒæ™¯åŒæ­¥æœå‹™\n            await backgroundSyncService.syncTable(tableName);\n\n            // åŒæ­¥å®Œæˆå¾Œé‡æ–°è¼‰å…¥è³‡æ–™\n            await get().fetchAll();\n\n            logger.log(`âœ… [${tableName}] åŒæ­¥å®Œæˆ`);\n          } catch (error) {\n            logger.error(`âŒ [${tableName}] åŒæ­¥å¤±æ•—:`, error);\n            throw error;\n          }\n        },\n\n        // ğŸ”§ å–æ¶ˆé€²è¡Œä¸­çš„è«‹æ±‚\n        cancelRequests: () => {\n          const state = get();\n          if (state._abortController) {\n            state._abortController.abort();\n            set({ _abortController: undefined, loading: false });\n            logger.log(`ğŸ›‘ [${tableName}] å·²å–æ¶ˆé€²è¡Œä¸­çš„è«‹æ±‚`);\n          }\n        },\n      }),\n      {\n        name: `${tableName}-storage`,\n        // åªæŒä¹…åŒ– itemsï¼Œä¸æŒä¹…åŒ– loading å’Œ error\n        partialize: (state) => ({ items: state.items }),\n      }\n    )\n  );\n\n  // ç›£è½ç¶²è·¯åŒæ­¥å®Œæˆäº‹ä»¶ï¼Œè‡ªå‹•é‡æ–°è¼‰å…¥è³‡æ–™\n  if (typeof window !== 'undefined') {\n    const handleSyncCompleted = () => {\n      logger.log(`ğŸ“¥ [${tableName}] æ”¶åˆ°åŒæ­¥å®Œæˆé€šçŸ¥ï¼Œé‡æ–°è¼‰å…¥è³‡æ–™...`);\n      store.getState().fetchAll();\n    };\n\n    window.addEventListener('venturo:sync-completed', handleSyncCompleted);\n\n    // æ³¨æ„ï¼šåœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæ‡‰è©²åœ¨é©ç•¶çš„æ™‚æ©Ÿç§»é™¤ç›£è½å™¨\n    // ä½†ç”±æ–¼ Store æ˜¯å…¨åŸŸå–®ä¾‹ï¼Œé€šå¸¸ä¸éœ€è¦æ¸…ç†\n  }\n\n  return store;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/home-settings-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/index.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2268,2271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2268,2271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Stores çµ±ä¸€åŒ¯å‡º\n * ä½¿ç”¨å·¥å» å‡½æ•¸å»ºç«‹æ‰€æœ‰ Store\n * æ”¯æ´ Supabase é›²ç«¯åŒæ­¥ + IndexedDB æœ¬åœ°å¿«å–\n */\n\nimport { createStore } from './create-store';\n\n// å¾ @/types åŒ¯å…¥ï¼ˆä½¿ç”¨ types/ ç›®éŒ„ä¸‹çš„æ¨™æº–å®šç¾©ï¼‰\nimport type {\n  Tour,\n  Order,\n  Member,\n  Customer,\n  ReceiptOrder,\n  Employee,\n  Region,\n} from '@/types';\n\n// å¾æœ¬åœ° types åŒ¯å…¥ï¼ˆåŒ…å« PaymentRequest, DisbursementOrder ç­‰ï¼‰\nimport type {\n  PaymentRequest,\n  DisbursementOrder,\n  Todo,\n  Visa,\n  Payment,\n  Quote,\n  QuoteItem,\n  Itinerary,\n} from './types';\n\n// Supplier å¾æ¨™æº– types åŒ¯å…¥ï¼ˆå®Œæ•´å®šç¾©å« supplier_code, country, locationï¼‰\nimport type { Supplier } from '@/types/supplier.types';\n\n// ============================================\n// æ¥­å‹™å¯¦é«” Storesï¼ˆæœ‰ç·¨è™Ÿå‰ç¶´ï¼‰\n// ============================================\n\n/**\n * æ—…éŠåœ˜ Store\n * ç·¨è™Ÿæ ¼å¼ï¼šT{year}{4ä½æ•¸} (å¦‚: T20240001)\n */\nexport const useTourStore = createStore<Tour>('tours', 'T');\n\n/**\n * è¡Œç¨‹è¡¨ Store\n * ç·¨è™Ÿæ ¼å¼ï¼šI{year}{4ä½æ•¸} (å¦‚: I20240001)\n */\nexport const useItineraryStore = createStore<Itinerary>('itineraries', 'I');\n\n/**\n * è¨‚å–® Store\n * ç·¨è™Ÿæ ¼å¼ï¼šO{year}{4ä½æ•¸} (å¦‚: O20240001)\n */\nexport const useOrderStore = createStore<Order>('orders', 'O');\n\n/**\n * å®¢æˆ¶ Store\n * ç·¨è™Ÿæ ¼å¼ï¼šC{year}{4ä½æ•¸} (å¦‚: C20240001)\n */\nexport const useCustomerStore = createStore<Customer>('customers', 'C');\n\n/**\n * å ±åƒ¹å–® Store\n * ç·¨è™Ÿæ ¼å¼ï¼šQ{year}{4ä½æ•¸} (å¦‚: Q20240001)\n */\nexport const useQuoteStore = createStore<Quote>('quotes', 'Q');\n\n/**\n * è«‹æ¬¾å–® Store\n * ç·¨è™Ÿæ ¼å¼ï¼šPR{year}{4ä½æ•¸} (å¦‚: PR20240001)\n */\nexport const usePaymentRequestStore = createStore<PaymentRequest>(\n  'payment_requests',\n  'PR'\n);\n\n/**\n * å‡ºç´å–® Store\n * ç·¨è™Ÿæ ¼å¼ï¼šDO{year}{4ä½æ•¸} (å¦‚: DO20240001)\n */\nexport const useDisbursementOrderStore = createStore<DisbursementOrder>(\n  'disbursement_orders',\n  'DO'\n);\n\n/**\n * æ”¶æ¬¾å–® Store\n * ç·¨è™Ÿæ ¼å¼ï¼šRO{year}{4ä½æ•¸} (å¦‚: RO20240001)\n */\nexport const useReceiptOrderStore = createStore<ReceiptOrder>(\n  'receipt_orders',\n  'RO'\n);\n\n// ============================================\n// å­å¯¦é«” Storesï¼ˆç„¡ç·¨è™Ÿï¼‰\n// ============================================\n\n/**\n * åœ˜å“¡ Store\n * ç„¡ç¨ç«‹ç·¨è™Ÿï¼Œä¾é™„æ–¼è¨‚å–®\n */\nexport const useMemberStore = createStore<Member>('members');\n\n/**\n * å ±åƒ¹é …ç›® Store\n * ç„¡ç¨ç«‹ç·¨è™Ÿï¼Œä¾é™„æ–¼å ±åƒ¹å–®\n */\nexport const useQuoteItemStore = createStore<QuoteItem>('quote_items');\n\n/**\n * åœ˜é«”åŠ è³¼é …ç›® Store\n * ç„¡ç¨ç«‹ç·¨è™Ÿï¼Œä¾é™„æ–¼æ—…éŠåœ˜\n */\nexport const useTourAddOnStore = createStore<import('./types').TourAddOn>('tour_addons' as any);\n\n// ============================================\n// ç³»çµ±ç®¡ç† Storesï¼ˆç„¡ç·¨è™Ÿï¼‰\n// ============================================\n\n/**\n * å“¡å·¥ Store\n * ä½¿ç”¨å“¡å·¥ç·¨è™Ÿï¼ˆemployee_numberï¼‰ï¼Œä¸æ˜¯ code\n */\nexport const useEmployeeStore = createStore<Employee>('employees');\n\n// ============================================\n// å¾…è£œå……çš„ Storesï¼ˆæ ¹æ“šéœ€è¦å•Ÿç”¨ï¼‰\n// ============================================\n\n// å¾…è¾¦äº‹é … Store\nexport const useTodoStore = createStore<Todo>('todos');\n\n// ç°½è­‰ Store\nexport const useVisaStore = createStore<Visa>('visas', 'V');\n\n// ä¾›æ‡‰å•† Store\nexport const useSupplierStore = createStore<Supplier>('suppliers', 'S');\n\n// åœ°å€ Store\nexport const useRegionStore = createStore<Region>('regions');\n\n// è¡Œäº‹æ›†äº‹ä»¶ Store\nexport const useCalendarEventStore = createStore<import('@/types/calendar.types').CalendarEvent>('calendar_events');\n\n// TODO: WorkspaceItem, Template, TimeboxSession å‹åˆ¥éœ€è¦å®šç¾©å¾Œå†å•Ÿç”¨\n// export const useTemplateStore = createStore<Template>('templates');\n// export const useTimeboxSessionStore = createStore<TimeboxSession>('timebox_sessions');\n// export const useWorkspaceItemStore = createStore<WorkspaceItem>('workspace_items');\n\n// ============================================\n// å‹åˆ¥åŒ¯å‡ºï¼ˆæ–¹ä¾¿ä½¿ç”¨ï¼‰\n// ============================================\n\n// ============================================\n// ä¿ç•™çš„ç‰¹æ®Š Storesï¼ˆèªè­‰ã€UI ç‹€æ…‹ï¼‰\n// ============================================\n\nexport { useAuthStore } from './auth-store';\nexport { useThemeStore } from './theme-store';\nexport { useHomeSettingsStore } from './home-settings-store';\n\n// ============================================\n// æš«æ™‚ä¿ç•™çš„è¤‡é›œ Storesï¼ˆå¾…é‡æ§‹ï¼‰\n// ============================================\n\n// TODO: ç§»åˆ° hooks/use-employees.ts\nexport { useUserStore } from './user-store';\n\n// TODO: æ‹†åˆ†ç‚º 4 å€‹ createStore + hooks/use-accounting.ts\nexport { useAccountingStore } from './accounting-store';\n\n// TODO: ç§»åˆ° hooks/use-calendar.ts\n// calendar-store éœ€è¦é¡å¤–çš„ settings åŠŸèƒ½ï¼Œæš«æ™‚ä¿ç•™\nexport { useCalendarStore } from './calendar-store';\n\n// TODO: ç§»åˆ° hooks/use-timebox.ts\nexport { useTimeboxStore } from './timebox-store';\n\n// TODO: å·²æœ‰ useTemplateStoreï¼Œæª¢æŸ¥æ˜¯å¦é‡è¤‡\n// export { useTemplateStore } from './template-store';\n\n// TODO: å·²æœ‰ useWorkspaceItemStoreï¼Œæª¢æŸ¥æ˜¯å¦é‡è¤‡\nexport { useWorkspaceStore } from './workspace-store';\n\n// ============================================\n// æš«æ™‚ä¿ç•™çš„èˆŠ Storesï¼ˆå¾…é‡æ§‹ï¼‰\n// ============================================\n\n/**\n * @deprecated payment-store å°‡é€æ­¥é·ç§»åˆ°æ–°æ¶æ§‹\n *\n * æ­¤ Store åŒ…å«ï¼š\n * - PaymentRequest (è«‹æ¬¾å–®) - æ‡‰æ”¹ç”¨ usePaymentRequestStore\n * - DisbursementOrder (å‡ºç´å–®) - æ‡‰æ”¹ç”¨ useDisbursementOrderStore\n * - è¤‡é›œçš„æ¥­å‹™é‚è¼¯ - æ‡‰ç§»åˆ° payment.service.ts\n *\n * TODO:\n * - [ ] é·ç§» PaymentRequest ç›¸é—œé é¢\n * - [ ] é·ç§» DisbursementOrder ç›¸é—œé é¢\n * - [ ] æ¥­å‹™é‚è¼¯ç§»åˆ° service\n * - [ ] åˆªé™¤ payment-store.deprecated.ts\n */\n// usePaymentStore å·²é·ç§»åˆ°æ–°æ¶æ§‹ï¼ˆpayment-store.deprecated.tsï¼‰\n// æ–°çš„ Storeï¼šusePaymentRequestStore, useDisbursementOrderStore\n// export { usePaymentStore } from './payment-store'; // DEPRECATED\n\n// ============================================\n// å‹åˆ¥åŒ¯å‡ºï¼ˆæ–¹ä¾¿ä½¿ç”¨ï¼‰\n// ============================================\n\nexport type {\n  Tour,\n  Itinerary,\n  Order,\n  Member,\n  Customer,\n  Payment,\n  PaymentRequest,\n  DisbursementOrder,\n  ReceiptOrder,\n  Quote,\n  QuoteItem,\n  Employee,\n  Todo,\n  Visa,\n  Supplier,\n  Region,\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/template-store.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DEFAULT_PAPER_SETTINGS' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nimport { Template, GeneratedDocument, PaperSettings } from '@/types/template';\nimport { logger } from '@/lib/utils/logger';\n\ninterface TemplateStore {\n  // ç‹€æ…‹\n  templates: Template[];\n  documents: GeneratedDocument[];\n\n  // æ¨¡æ¿æ“ä½œï¼ˆçµ±ä¸€ä½¿ç”¨ Promiseï¼‰\n  addTemplate: (template: Omit<Template, 'id' | 'version' | 'usage_count' | 'metadata' | 'is_deleted'>) => Promise<Template>;\n  updateTemplate: (id: string, updates: Partial<Template>) => Promise<void>;\n  deleteTemplate: (id: string, user_id: string) => Promise<void>;\n  getTemplate: (id: string) => Template | undefined;\n  duplicateTemplate: (id: string, newName: string) => Promise<Template>;\n\n  // æ–‡ä»¶æ“ä½œ\n  addDocument: (document: Omit<GeneratedDocument, 'id' | 'created_at'>) => Promise<GeneratedDocument>;\n  getDocumentsByTemplate: (template_id: string) => GeneratedDocument[];\n\n  // å·¥å…·å‡½æ•¸\n  incrementUsageCount: (templateId: string) => void;\n\n  // åˆå§‹åŒ–é è¨­æ¨¡æ¿\n  initializeDefaultTemplates: () => void;\n}\n\n// é è¨­ç´™å¼µè¨­å®š\nconst DEFAULT_PAPER_SETTINGS: PaperSettings = {\n  size: 'A4',\n  orientation: 'portrait',\n  margins: {\n    top: 2.0,\n    bottom: 2.0,\n    left: 2.0,\n    right: 2.0,\n  },\n  show_grid: true,\n  show_ruler: true,\n};\n\nexport const useTemplateStore = create<TemplateStore>()(\n  persist(\n    (set, get) => ({\n      templates: [],\n      documents: [],\n\n      addTemplate: async (templateData) => {\n        const newTemplate: Template = {\n          ...templateData,\n          id: crypto.randomUUID(),\n          version: 1,\n          usage_count: 0,\n          is_deleted: false,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n          metadata: {\n            created_by: templateData.paper_settings ? 'user' : 'system',\n          },\n        };\n\n        set((state) => ({\n          templates: [...state.templates, newTemplate],\n        }));\n\n        return newTemplate;\n      },\n\n      updateTemplate: async (id, updates) => {\n        set((state) => ({\n          templates: state.templates.map((template) =>\n            template.id === id\n              ? {\n                  ...template,\n                  ...updates,\n                  metadata: {\n                    ...template.metadata,\n                    updated_at: new Date().toISOString(),\n                  },\n                }\n              : template\n          ),\n        }));\n      },\n\n      deleteTemplate: async (id, user_id) => {\n        set((state) => ({\n          templates: state.templates.map((template) =>\n            template.id === id\n              ? {\n                  ...template,\n                  is_deleted: true,\n                  deleted_at: new Date().toISOString(),\n                  deleted_by: user_id,\n                }\n              : template\n          ),\n        }));\n      },\n\n      getTemplate: (id) => {\n        return get().templates.find((t) => t.id === id && !t.is_deleted);\n      },\n\n      duplicateTemplate: async (id, newName) => {\n        const original = get().getTemplate(id);\n        if (!original) {\n          throw new Error('Template not found');\n        }\n\n        const duplicated: Template = {\n          ...original,\n          id: crypto.randomUUID(),\n          name: newName,\n          version: 1,\n          usage_count: 0,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n          metadata: {\n            created_by: original.metadata.created_by,\n          },\n        };\n\n        set((state) => ({\n          templates: [...state.templates, duplicated],\n        }));\n\n        return duplicated;\n      },\n\n      addDocument: async (documentData) => {\n        const newDocument: GeneratedDocument = {\n          ...documentData,\n          id: crypto.randomUUID(),\n          created_at: new Date().toISOString(),\n        };\n\n        set((state) => ({\n          documents: [...state.documents, newDocument],\n        }));\n\n        // å¢åŠ æ¨¡æ¿ä½¿ç”¨æ¬¡æ•¸\n        get().incrementUsageCount(documentData.template_id);\n\n        return newDocument;\n      },\n\n      getDocumentsByTemplate: (templateId) => {\n        return get().documents.filter((doc) => doc.template_id === templateId);\n      },\n\n      incrementUsageCount: (templateId) => {\n        set((state) => ({\n          templates: state.templates.map((template) =>\n            template.id === templateId\n              ? { ...template, usage_count: template.usage_count + 1 }\n              : template\n          ),\n        }));\n      },\n\n      initializeDefaultTemplates: () => {\n        const { templates } = get();\n        if (templates.length === 0) {\n          // ç›®å‰ä¸è‡ªå‹•å»ºç«‹é è¨­æ¨¡æ¿\n          // ç­‰å¾…ä½¿ç”¨è€…å¾è¨­è¨ˆå™¨å»ºç«‹\n          logger.log('æ¨¡æ¿åˆ—è¡¨ç‚ºç©ºï¼Œç­‰å¾…ä½¿ç”¨è€…å»ºç«‹ç¬¬ä¸€å€‹æ¨¡æ¿');\n        }\n      },\n    }),\n    {\n      name: 'template-storage',\n    }\n  )\n);\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/theme-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/timebox-store-supabase.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":433,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11309,11312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11309,11312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * âš ï¸ EXPERIMENTAL - NOT IN USE âš ï¸\n *\n * é€™æ˜¯å¯¦é©—æ€§çš„ Supabase ç‰ˆæ™‚é–“ç®± Storeï¼Œç›®å‰æœªè¢«ä½¿ç”¨ã€‚\n *\n * ç¾æ³ï¼š\n * - æ‰€æœ‰é é¢ä½¿ç”¨ timebox-store.tsï¼ˆæœ¬åœ° persist ç‰ˆæœ¬ï¼‰\n * - æ­¤æª”æ¡ˆæ¡ç”¨ VenturoAPI + currentUserId éåŒæ­¥æµç¨‹\n * - æ¬„ä½çµæ§‹èˆ‡ timebox-store.ts ä¸åŒï¼ˆuser_id vs ç„¡ç”¨æˆ¶æ¬„ä½ï¼‰\n * - æ²’æœ‰ä»»ä½•åœ°æ–¹è¼‰å…¥æ­¤æ¨¡çµ„\n *\n * ä½¿ç”¨ä¸­çš„ç‰ˆæœ¬ï¼šsrc/stores/timebox-store.ts\n *\n * æ±ºç­–å¾…å®šï¼š\n * 1. å¦‚è¦å•Ÿç”¨ Supabase ç‰ˆï¼Œéœ€åŒæ­¥æ›´æ–°æ‰€æœ‰ UI ç‚ºéåŒæ­¥æµç¨‹\n * 2. å¦‚ä¸å•Ÿç”¨ï¼Œå»ºè­°é‡æ–°å‘½åæˆ–æ¬ç§»åˆ° experimental/ ç›®éŒ„\n *\n * æ­¤æª”æ¡ˆä¿ç•™ä½œç‚ºæœªä¾†æ•´åˆ Supabase çš„åƒè€ƒå¯¦ä½œã€‚\n */\n\nimport { create } from 'zustand'\n\nimport { VenturoAPI } from '@/lib/supabase/api'\nimport { logger } from '@/lib/utils/logger'\n\n// åŸºç¤é¡å‹å®šç¾©\nexport interface BaseBox {\n  id: string\n  user_id: string\n  name: string\n  color: string\n  type: 'workout' | 'reminder' | 'basic'\n  created_at: Date\n  updated_at: Date\n  // é‡è¨“å°ˆç”¨æ¬„ä½\n  equipment?: string\n  weight?: number\n  reps?: number\n  sets?: number\n}\n\n// é‡è¨“è³‡æ–™\nexport interface WorkoutData {\n  setsCompleted: boolean[]\n  completedSetsTime: Date[]\n  totalVolume?: number\n}\n\n// æé†’è³‡æ–™\nexport interface ReminderData {\n  text: string\n  lastUpdated: Date\n}\n\n// æ’ç¨‹ç®±å­å¯¦ä¾‹\nexport interface ScheduledBox {\n  id: string\n  boxId: string\n  weekId: string\n  user_id: string\n  dayOfWeek: number\n  start_time: string\n  duration: number\n  completed: boolean\n  completedAt?: Date\n  workoutData?: WorkoutData\n  reminderData?: ReminderData\n}\n\n// é€±è¨˜éŒ„\nexport interface WeekRecord {\n  id: string\n  user_id: string\n  weekStart: Date\n  weekEnd: Date\n  name?: string\n  archived: boolean\n  completionRate: number\n  totalWorkoutVolume?: number\n  totalWorkoutSessions?: number\n  completedCount: number\n  totalCount: number\n  reviewNotes?: string\n  reviewCreatedAt?: Date\n}\n\n// çµ±è¨ˆè³‡æ–™\nexport interface WeekStatistics {\n  completionRate: number\n  totalWorkoutTime: number\n  completedByType: {\n    workout: number\n    reminder: number\n    basic: number\n  }\n  totalWorkoutVolume?: number\n  totalWorkoutSessions?: number\n}\n\n// è«è˜­è¿ªé…è‰²é¸é …\nexport const morandiColors = [\n  { name: 'æŸ”éœ§ç²‰', value: '#E2C4C4', hover: '#D9B3B3' },\n  { name: 'æ™¨éœ²ç¶ ', value: '#C4D6C4', hover: '#B3CAB3' },\n  { name: 'é›²çŸ³ç°', value: '#D4D4D4', hover: '#C4C4C4' },\n  { name: 'å¥¶èŒ¶æ£•', value: '#D6C4B8', hover: '#CAB3A5' },\n  { name: 'è–°è¡£è‰', value: '#D0C4D6', hover: '#C3B3CA' },\n  { name: 'æä»é»ƒ', value: '#E0D6B8', hover: '#D6CAA5' },\n  { name: 'æµ·éœ§è—', value: '#C4D0D6', hover: '#B3C3CA' },\n  { name: 'çŠç‘šæ©˜', value: '#E0C8B8', hover: '#D6B9A5' },\n  { name: 'é¼ å°¾è‰', value: '#B8C8B8', hover: '#A5B9A5' },\n  { name: 'æš®è‰²ç´«', value: '#C4B8D0', hover: '#B3A5C3' },\n  { name: 'ç‡•éº¥ç±³', value: '#D6D0C4', hover: '#CAC3B3' },\n  { name: 'çŸ³å¢¨è—', value: '#B8C4D0', hover: '#A5B3C3' },\n  { name: 'æ¥“è‘‰ç´…', value: '#D0B8B8', hover: '#C3A5A5' },\n  { name: 'è‹”è˜šç¶ ', value: '#B8C4B8', hover: '#A5B3A5' },\n  { name: 'ç ‚å²©è¤', value: '#C8B8B0', hover: '#B9A59C' },\n  { name: 'æœˆå…‰ç™½', value: '#E8E8E8', hover: '#DEDEDE' },\n]\n\ninterface TimeboxState {\n  // ç•¶å‰ä½¿ç”¨è€… ID\n  currentUserId: string | null\n  setCurrentUserId: (user_id: string) => void\n\n  // ç‹€æ…‹\n  boxes: BaseBox[]\n  currentWeek: WeekRecord | null\n  scheduledBoxes: ScheduledBox[]\n  weekRecords: WeekRecord[]\n  loading: boolean\n  error: string | null\n\n  // ç®±å­ç®¡ç†\n  loadBoxes: () => Promise<void>\n  createBox: (box: Omit<BaseBox, 'id' | 'user_id' | 'created_at' | 'updated_at'>) => Promise<void>\n  updateBox: (id: string, updates: Partial<BaseBox>) => Promise<void>\n  deleteBox: (id: string) => Promise<void>\n\n  // é€±è¨˜éŒ„\n  loadCurrentWeek: () => Promise<void>\n  loadWeekRecords: () => Promise<void>\n  initializeCurrentWeek: (weekStart: Date) => Promise<void>\n  archiveCurrentWeek: (name: string) => Promise<void>\n\n  // æ’ç¨‹ç®¡ç†\n  loadScheduledBoxes: (weekId: string) => Promise<void>\n  addScheduledBox: (box: Omit<ScheduledBox, 'id' | 'user_id'>) => Promise<void>\n  updateScheduledBox: (id: string, updates: Partial<ScheduledBox>) => Promise<void>\n  removeScheduledBox: (id: string) => Promise<void>\n  toggleBoxCompletion: (id: string) => Promise<void>\n  toggleSetCompletion: (boxId: string, setIndex: number) => Promise<void>\n\n  // çµ±è¨ˆ\n  getWeekStatistics: () => WeekStatistics\n}\n\n// è¼”åŠ©å‡½æ•¸\nconst getWeekStart = (date: Date) => {\n  const d = new Date(date)\n  const day = d.getDay()\n  const diff = d.getDate() - day + (day === 0 ? -6 : 1)\n  return new Date(d.setDate(diff))\n}\n\nconst getWeekEnd = (date: Date) => {\n  const start = getWeekStart(date)\n  const end = new Date(start)\n  end.setDate(start.getDate() + 6)\n  return end\n}\n\nexport const useTimeboxStore = create<TimeboxState>((set, get) => ({\n  // åˆå§‹ç‹€æ…‹\n  currentUserId: null,\n  boxes: [],\n  currentWeek: null,\n  scheduledBoxes: [],\n  weekRecords: [],\n  loading: false,\n  error: null,\n\n  setCurrentUserId: (user_id) => {\n    set({ currentUserId: user_id })\n  },\n\n  // è¼‰å…¥ç®±å­\n  loadBoxes: async () => {\n    const { currentUserId } = get()\n    if (!currentUserId) return\n\n    set({ loading: true, error: null })\n    try {\n      const boxes = await VenturoAPI.read<BaseBox>('timebox_boxes', {\n        filters: { user_id: currentUserId },\n        orderBy: { column: 'created_at', ascending: false }\n      })\n      set({ boxes, loading: false })\n    } catch (error) {\n      logger.error('è¼‰å…¥ç®±å­å¤±æ•—:', error)\n      set({ error: 'è¼‰å…¥ç®±å­å¤±æ•—', loading: false })\n    }\n  },\n\n  // å»ºç«‹ç®±å­\n  createBox: async (boxData) => {\n    const { currentUserId } = get()\n    if (!currentUserId) return\n\n    try {\n      const newBox = await VenturoAPI.create<BaseBox>('timebox_boxes', {\n        ...boxData,\n        user_id: currentUserId\n      })\n      set((state) => ({ boxes: [newBox, ...state.boxes] }))\n    } catch (error) {\n      logger.error('å»ºç«‹ç®±å­å¤±æ•—:', error)\n      set({ error: 'å»ºç«‹ç®±å­å¤±æ•—' })\n    }\n  },\n\n  // æ›´æ–°ç®±å­\n  updateBox: async (id, updates) => {\n    try {\n      const updatedBox = await VenturoAPI.update<BaseBox>('timebox_boxes', id, updates)\n      set((state) => ({\n        boxes: state.boxes.map((box) => (box.id === id ? updatedBox : box))\n      }))\n    } catch (error) {\n      logger.error('æ›´æ–°ç®±å­å¤±æ•—:', error)\n      set({ error: 'æ›´æ–°ç®±å­å¤±æ•—' })\n    }\n  },\n\n  // åˆªé™¤ç®±å­\n  deleteBox: async (id) => {\n    try {\n      await VenturoAPI.delete('timebox_boxes', id)\n      set((state) => ({\n        boxes: state.boxes.filter((box) => box.id !== id),\n        scheduledBoxes: state.scheduledBoxes.filter((sb) => sb.boxId !== id)\n      }))\n    } catch (error) {\n      logger.error('åˆªé™¤ç®±å­å¤±æ•—:', error)\n      set({ error: 'åˆªé™¤ç®±å­å¤±æ•—' })\n    }\n  },\n\n  // è¼‰å…¥ç•¶å‰é€±\n  loadCurrentWeek: async () => {\n    const { currentUserId } = get()\n    if (!currentUserId) return\n\n    set({ loading: true })\n    try {\n      const today = new Date()\n      const weekStart = getWeekStart(today)\n\n      // æŸ¥è©¢ç•¶å‰é€±\n      const weeks = await VenturoAPI.read<WeekRecord>('timebox_weeks', {\n        filters: {\n          user_id: currentUserId,\n          weekStart: weekStart.toISOString().split('T')[0],\n          archived: false\n        }\n      })\n\n      if (weeks.length > 0) {\n        const currentWeek = weeks[0]\n        set({ currentWeek, loading: false })\n        await get().loadScheduledBoxes(currentWeek.id)\n      } else {\n        // è‡ªå‹•åˆå§‹åŒ–ç•¶å‰é€±\n        await get().initializeCurrentWeek(weekStart)\n      }\n    } catch (error) {\n      logger.error('è¼‰å…¥ç•¶å‰é€±å¤±æ•—:', error)\n      set({ error: 'è¼‰å…¥ç•¶å‰é€±å¤±æ•—', loading: false })\n    }\n  },\n\n  // è¼‰å…¥é€±è¨˜éŒ„\n  loadWeekRecords: async () => {\n    const { currentUserId } = get()\n    if (!currentUserId) return\n\n    try {\n      const records = await VenturoAPI.read<WeekRecord>('timebox_weeks', {\n        filters: { user_id: currentUserId, archived: true },\n        orderBy: { column: 'weekStart', ascending: false }\n      })\n      set({ weekRecords: records })\n    } catch (error) {\n      logger.error('è¼‰å…¥é€±è¨˜éŒ„å¤±æ•—:', error)\n      set({ error: 'è¼‰å…¥é€±è¨˜éŒ„å¤±æ•—' })\n    }\n  },\n\n  // åˆå§‹åŒ–ç•¶å‰é€±\n  initializeCurrentWeek: async (weekStart) => {\n    const { currentUserId } = get()\n    if (!currentUserId) return\n\n    try {\n      const weekEnd = getWeekEnd(weekStart)\n      const newWeek = await VenturoAPI.create<WeekRecord>('timebox_weeks', {\n        user_id: currentUserId,\n        weekStart: weekStart.toISOString().split('T')[0],\n        weekEnd: weekEnd.toISOString().split('T')[0],\n        archived: false,\n        completionRate: 0,\n        completedCount: 0,\n        totalCount: 0\n      })\n\n      set({ currentWeek: newWeek, scheduledBoxes: [] })\n    } catch (error) {\n      logger.error('åˆå§‹åŒ–ç•¶å‰é€±å¤±æ•—:', error)\n      set({ error: 'åˆå§‹åŒ–ç•¶å‰é€±å¤±æ•—' })\n    }\n  },\n\n  // å°å­˜ç•¶å‰é€±\n  archiveCurrentWeek: async (name) => {\n    const { currentWeek, scheduledBoxes } = get()\n    if (!currentWeek) return\n\n    try {\n      // è¨ˆç®—çµ±è¨ˆè³‡æ–™\n      const completedCount = scheduledBoxes.filter((box) => box.completed).length\n      const totalCount = scheduledBoxes.length\n      const completionRate = totalCount > 0 ? completedCount / totalCount : 0\n\n      await VenturoAPI.update('timebox_weeks', currentWeek.id, {\n        name,\n        archived: true,\n        completionRate,\n        completedCount,\n        totalCount\n      })\n\n      // é‡æ–°è¼‰å…¥\n      await get().loadWeekRecords()\n      await get().loadCurrentWeek()\n    } catch (error) {\n      logger.error('å°å­˜é€±è¨˜éŒ„å¤±æ•—:', error)\n      set({ error: 'å°å­˜é€±è¨˜éŒ„å¤±æ•—' })\n    }\n  },\n\n  // è¼‰å…¥æ’ç¨‹\n  loadScheduledBoxes: async (weekId) => {\n    try {\n      const schedules = await VenturoAPI.read<ScheduledBox>('timebox_schedules', {\n        filters: { weekId },\n        orderBy: { column: 'dayOfWeek', ascending: true }\n      })\n      set({ scheduledBoxes: schedules })\n    } catch (error) {\n      logger.error('è¼‰å…¥æ’ç¨‹å¤±æ•—:', error)\n      set({ error: 'è¼‰å…¥æ’ç¨‹å¤±æ•—' })\n    }\n  },\n\n  // æ–°å¢æ’ç¨‹\n  addScheduledBox: async (boxData) => {\n    const { currentUserId } = get()\n    if (!currentUserId) return\n\n    try {\n      const newSchedule = await VenturoAPI.create<ScheduledBox>('timebox_schedules', {\n        ...boxData,\n        user_id: currentUserId\n      })\n      set((state) => ({\n        scheduledBoxes: [...state.scheduledBoxes, newSchedule]\n      }))\n    } catch (error) {\n      logger.error('æ–°å¢æ’ç¨‹å¤±æ•—:', error)\n      set({ error: 'æ–°å¢æ’ç¨‹å¤±æ•—' })\n    }\n  },\n\n  // æ›´æ–°æ’ç¨‹\n  updateScheduledBox: async (id, updates) => {\n    try {\n      const updated = await VenturoAPI.update<ScheduledBox>('timebox_schedules', id, updates)\n      set((state) => ({\n        scheduledBoxes: state.scheduledBoxes.map((box) => (box.id === id ? updated : box))\n      }))\n    } catch (error) {\n      logger.error('æ›´æ–°æ’ç¨‹å¤±æ•—:', error)\n      set({ error: 'æ›´æ–°æ’ç¨‹å¤±æ•—' })\n    }\n  },\n\n  // åˆªé™¤æ’ç¨‹\n  removeScheduledBox: async (id) => {\n    try {\n      await VenturoAPI.delete('timebox_schedules', id)\n      set((state) => ({\n        scheduledBoxes: state.scheduledBoxes.filter((box) => box.id !== id)\n      }))\n    } catch (error) {\n      logger.error('åˆªé™¤æ’ç¨‹å¤±æ•—:', error)\n      set({ error: 'åˆªé™¤æ’ç¨‹å¤±æ•—' })\n    }\n  },\n\n  // åˆ‡æ›å®Œæˆç‹€æ…‹\n  toggleBoxCompletion: async (id) => {\n    const box = get().scheduledBoxes.find((b) => b.id === id)\n    if (!box) return\n\n    await get().updateScheduledBox(id, {\n      completed: !box.completed,\n      completedAt: !box.completed ? new Date() : undefined\n    })\n  },\n\n  // åˆ‡æ›çµ„åˆ¥å®Œæˆ\n  toggleSetCompletion: async (boxId, setIndex) => {\n    const box = get().scheduledBoxes.find((b) => b.id === boxId)\n    if (!box) return\n\n    const currentData = box.workoutData || {\n      setsCompleted: [],\n      completedSetsTime: [],\n      totalVolume: 0\n    }\n\n    const updated = { ...currentData }\n    updated.setsCompleted[setIndex] = !updated.setsCompleted[setIndex]\n    updated.completedSetsTime[setIndex] = updated.setsCompleted[setIndex] ? new Date() : null as any\n\n    await get().updateScheduledBox(boxId, { workoutData: updated })\n  },\n\n  // çµ±è¨ˆ\n  getWeekStatistics: () => {\n    const { scheduledBoxes, boxes } = get()\n    const completedBoxes = scheduledBoxes.filter((box) => box.completed)\n    const totalBoxes = scheduledBoxes.length\n\n    const completedByType = {\n      workout: 0,\n      reminder: 0,\n      basic: 0,\n    }\n\n    let totalWorkoutTime = 0\n    let totalWorkoutVolume = 0\n    let totalWorkoutSessions = 0\n\n    completedBoxes.forEach((box) => {\n      const baseBox = boxes.find((b) => b.id === box.boxId)\n      if (baseBox) {\n        completedByType[baseBox.type]++\n\n        if (baseBox.type === 'workout') {\n          totalWorkoutTime += box.duration\n          totalWorkoutSessions++\n\n          if (box.workoutData?.totalVolume) {\n            totalWorkoutVolume += box.workoutData.totalVolume\n          }\n        }\n      }\n    })\n\n    return {\n      completionRate: totalBoxes > 0 ? completedBoxes.length / totalBoxes : 0,\n      totalWorkoutTime,\n      completedByType,\n      totalWorkoutVolume,\n      totalWorkoutSessions,\n    }\n  },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/timebox-store.ts","messages":[{"ruleId":"@typescript-eslint/no-non-null-assertion","severity":1,"message":"Forbidden non-null assertion.","line":472,"column":19,"nodeType":"TSNonNullExpression","messageId":"noNonNull","endLine":472,"endColumn":37,"suggestions":[{"messageId":"suggestOptionalChain","fix":{"range":[13706,13707],"text":"?"},"desc":"Consider using the optional chain operator `?.` instead. This operator includes runtime checks, so it is safer than the compile-only non-null assertion operator."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand'\nimport { persist } from 'zustand/middleware'\n\nconst generateId = () => crypto.randomUUID()\n\n// åŸºç¤é¡å‹å®šç¾©\nexport interface BaseBox {\n  id: string\n  name: string\n  color: string\n  type: 'workout' | 'reminder' | 'basic'\n  user_id: string\n  created_at: Date\n  updated_at: Date\n  // é‡è¨“å°ˆç”¨æ¬„ä½\n  equipment?: string // å™¨æ\n  weight?: number    // é‡é‡ (kg)\n  reps?: number      // æ¬¡æ•¸\n  sets?: number      // çµ„æ•¸\n}\n\n// å–®å€‹é‡è¨“å‹•ä½œ\nexport interface WorkoutExercise {\n  id: string\n  equipment: string // å™¨æ/å‹•ä½œåç¨±\n  weight: number    // é‡é‡ (kg)\n  reps: number      // æ¬¡æ•¸\n  sets: number      // çµ„æ•¸\n  setsCompleted: boolean[] // æ¯çµ„çš„å®Œæˆç‹€æ…‹\n  completedSetsTime: (Date | null)[] // æ¯çµ„å®Œæˆçš„æ™‚é–“\n}\n\n// é‡è¨“è³‡æ–™ - æ”¯æ´å¤šå€‹å‹•ä½œ\nexport interface WorkoutData {\n  exercises: WorkoutExercise[] // å¤šå€‹å‹•ä½œ\n  totalVolume?: number     // ç¸½è¨“ç·´é‡ (é‡é‡ Ã— æ¬¡æ•¸ Ã— çµ„æ•¸)\n}\n\n// æé†’è³‡æ–™\nexport interface ReminderData {\n  text: string\n  lastUpdated: Date\n}\n\n// æ’ç¨‹ç®±å­å¯¦ä¾‹\nexport interface ScheduledBox {\n  id: string\n  boxId: string\n  weekId: string\n  dayOfWeek: number // 0-6 (é€±æ—¥åˆ°é€±å…­)\n  start_time: string // \"HH:mm\" æ ¼å¼\n  duration: number // åˆ†é˜æ•¸\n  completed: boolean\n  completedAt?: Date\n  data?: WorkoutData | ReminderData\n  // é‡è¨“çµ„åˆ¥é€²åº¦è¿½è¹¤\n  setsProgress?: {\n    completed: number // å·²å®Œæˆçµ„æ•¸\n    total: number     // ç¸½çµ„æ•¸\n  }\n}\n\n// é€±è¨˜éŒ„\nexport interface WeekRecord {\n  id: string\n  user_id: string\n  weekStart: Date\n  weekEnd: Date\n  name?: string\n  archived: boolean\n  scheduledBoxes: ScheduledBox[]\n  statistics: {\n    completionRate: number\n    totalWorkoutVolume?: number\n    totalWorkoutSessions?: number\n    completedCount: number\n    totalCount: number\n  }\n  review?: {\n    notes: string\n    created_at: Date\n  }\n}\n\n// çµ±è¨ˆè³‡æ–™\nexport interface WeekStatistics {\n  completionRate: number\n  totalWorkoutTime: number\n  completedByType: {\n    workout: number\n    reminder: number\n    basic: number\n  }\n  totalWorkoutVolume?: number\n  totalWorkoutSessions?: number\n}\n\n// è¶¨å‹¢è³‡æ–™\nexport interface WorkoutTrend {\n  week: string\n  volume: number\n  sessions: number\n  completionRate: number\n}\n\n// è«è˜­è¿ªé…è‰²é¸é …\nexport const morandiColors = [\n  { name: 'æŸ”éœ§ç²‰', value: '#E2C4C4', hover: '#D9B3B3' },\n  { name: 'æ™¨éœ²ç¶ ', value: '#C4D6C4', hover: '#B3CAB3' },\n  { name: 'é›²çŸ³ç°', value: '#D4D4D4', hover: '#C4C4C4' },\n  { name: 'å¥¶èŒ¶æ£•', value: '#D6C4B8', hover: '#CAB3A5' },\n  { name: 'è–°è¡£è‰', value: '#D0C4D6', hover: '#C3B3CA' },\n  { name: 'æä»é»ƒ', value: '#E0D6B8', hover: '#D6CAA5' },\n  { name: 'æµ·éœ§è—', value: '#C4D0D6', hover: '#B3C3CA' },\n  { name: 'çŠç‘šæ©˜', value: '#E0C8B8', hover: '#D6B9A5' },\n  { name: 'é¼ å°¾è‰', value: '#B8C8B8', hover: '#A5B9A5' },\n  { name: 'æš®è‰²ç´«', value: '#C4B8D0', hover: '#B3A5C3' },\n  { name: 'ç‡•éº¥ç±³', value: '#D6D0C4', hover: '#CAC3B3' },\n  { name: 'çŸ³å¢¨è—', value: '#B8C4D0', hover: '#A5B3C3' },\n  { name: 'æ¥“è‘‰ç´…', value: '#D0B8B8', hover: '#C3A5A5' },\n  { name: 'è‹”è˜šç¶ ', value: '#B8C4B8', hover: '#A5B3A5' },\n  { name: 'ç ‚å²©è¤', value: '#C8B8B0', hover: '#B9A59C' },\n  { name: 'æœˆå…‰ç™½', value: '#E8E8E8', hover: '#DEDEDE' },\n]\n\ninterface TimeboxState {\n  // ç®±å­ç®¡ç†\n  boxes: BaseBox[]\n  createBox: (box: Omit<BaseBox, 'id' | 'created_at' | 'updated_at'>) => void\n  updateBox: (id: string, updates: Partial<BaseBox>) => void\n  deleteBox: (id: string) => void\n\n  // é€±æ’ç¨‹\n  currentWeek: WeekRecord | null\n  scheduledBoxes: ScheduledBox[]\n  addScheduledBox: (box: Omit<ScheduledBox, 'id'>) => void\n  updateScheduledBox: (id: string, updates: Partial<ScheduledBox>) => void\n  removeScheduledBox: (id: string) => void\n  toggleBoxCompletion: (id: string) => void\n\n  // é‡è¨“è³‡æ–™\n  updateWorkoutData: (boxId: string, data: WorkoutData) => void\n  addWorkoutExercise: (boxId: string, exercise: Omit<WorkoutExercise, 'id'>) => void\n  removeWorkoutExercise: (boxId: string, exerciseId: string) => void\n  updateWorkoutExercise: (boxId: string, exerciseId: string, updates: Partial<WorkoutExercise>) => void\n  toggleSetCompletion: (boxId: string, exerciseId: string, setIndex: number) => void\n\n  // æ–‡å­—æç¤ºè³‡æ–™\n  updateReminderData: (boxId: string, data: ReminderData) => void\n\n  // é€±è¨˜éŒ„\n  weekRecords: WeekRecord[]\n  archiveCurrentWeek: (name: string) => void\n  loadWeekRecord: (id: string) => void\n  copyToNextWeek: (recordId: string) => void\n\n  // çµ±è¨ˆ\n  getWeekStatistics: () => WeekStatistics\n  getWorkoutTrends: (weeks: number) => WorkoutTrend[]\n\n  // åˆå§‹åŒ–\n  initializeCurrentWeek: (weekStart: Date) => void\n}\n\n// è¼”åŠ©å‡½æ•¸\nconst getWeekStart = (date: Date) => {\n  const d = new Date(date)\n  const day = d.getDay()\n  const diff = d.getDate() - day + (day === 0 ? -6 : 1) // èª¿æ•´ç‚ºé€±ä¸€é–‹å§‹\n  return new Date(d.setDate(diff))\n}\n\nconst getWeekEnd = (date: Date) => {\n  const start = getWeekStart(date)\n  const end = new Date(start)\n  end.setDate(start.getDate() + 6)\n  return end\n}\n\nexport const useTimeboxStore = create<TimeboxState>()(\n  persist(\n    (set, get) => ({\n      // åˆå§‹ç‹€æ…‹\n      boxes: [],\n      currentWeek: null,\n      scheduledBoxes: [],\n      weekRecords: [],\n\n      // ç®±å­ç®¡ç†\n      createBox: (boxData) => {\n        const newBox: BaseBox = {\n          ...boxData,\n          id: generateId(),\n          created_at: new Date(),\n          updated_at: new Date(),\n        }\n        set((state) => ({\n          boxes: [...state.boxes, newBox]\n        }))\n      },\n\n      updateBox: (id, updates) => {\n        set((state) => ({\n          boxes: state.boxes.map((box) =>\n            box.id === id ? { ...box, ...updates, updated_at: new Date() } : box\n          )\n        }))\n      },\n\n      deleteBox: (id) => {\n        set((state) => ({\n          boxes: state.boxes.filter((box) => box.id !== id),\n          scheduledBoxes: state.scheduledBoxes.filter((sb) => sb.boxId !== id)\n        }))\n      },\n\n      // é€±æ’ç¨‹\n      addScheduledBox: (boxData) => {\n        const newScheduledBox: ScheduledBox = {\n          ...boxData,\n          id: generateId(),\n        }\n        set((state) => ({\n          scheduledBoxes: [...state.scheduledBoxes, newScheduledBox]\n        }))\n      },\n\n      updateScheduledBox: (id, updates) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) =>\n            box.id === id ? { ...box, ...updates } : box\n          )\n        }))\n      },\n\n      removeScheduledBox: (id) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.filter((box) => box.id !== id)\n        }))\n      },\n\n      toggleBoxCompletion: (id) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) =>\n            box.id === id\n              ? {\n                  ...box,\n                  completed: !box.completed,\n                  completedAt: !box.completed ? new Date() : undefined\n                }\n              : box\n          )\n        }))\n      },\n\n      // é‡è¨“è³‡æ–™\n      updateWorkoutData: (boxId, data) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) =>\n            box.id === boxId ? { ...box, data } : box\n          )\n        }))\n      },\n\n      addWorkoutExercise: (boxId, exercise) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) => {\n            if (box.id !== boxId) return box\n\n            const currentData = (box.data as WorkoutData) || { exercises: [] }\n            const newExercise: WorkoutExercise = {\n              ...exercise,\n              id: generateId(),\n              setsCompleted: Array(exercise.sets).fill(false),\n              completedSetsTime: Array(exercise.sets).fill(null),\n            }\n\n            return {\n              ...box,\n              data: {\n                ...currentData,\n                exercises: [...currentData.exercises, newExercise]\n              }\n            }\n          })\n        }))\n      },\n\n      removeWorkoutExercise: (boxId, exerciseId) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) => {\n            if (box.id !== boxId) return box\n\n            const currentData = box.data as WorkoutData\n            if (!currentData) return box\n\n            return {\n              ...box,\n              data: {\n                ...currentData,\n                exercises: currentData.exercises.filter(ex => ex.id !== exerciseId)\n              }\n            }\n          })\n        }))\n      },\n\n      updateWorkoutExercise: (boxId, exerciseId, updates) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) => {\n            if (box.id !== boxId) return box\n\n            const currentData = box.data as WorkoutData\n            if (!currentData) return box\n\n            return {\n              ...box,\n              data: {\n                ...currentData,\n                exercises: currentData.exercises.map(ex => {\n                  if (ex.id !== exerciseId) return ex\n\n                  // å¦‚æœä¿®æ”¹äº†çµ„æ•¸ï¼Œéœ€è¦èª¿æ•´é™£åˆ—é•·åº¦\n                  const newSets = updates.sets ?? ex.sets\n                  let newSetsCompleted = ex.setsCompleted\n                  let newCompletedTime = ex.completedSetsTime\n\n                  if (newSets !== ex.sets) {\n                    if (newSets > ex.sets) {\n                      // å¢åŠ çµ„æ•¸ï¼Œè£œå…… false å’Œ null\n                      newSetsCompleted = [...ex.setsCompleted, ...Array(newSets - ex.sets).fill(false)]\n                      newCompletedTime = [...ex.completedSetsTime, ...Array(newSets - ex.sets).fill(null)]\n                    } else {\n                      // æ¸›å°‘çµ„æ•¸ï¼Œæˆªæ–·é™£åˆ—\n                      newSetsCompleted = ex.setsCompleted.slice(0, newSets)\n                      newCompletedTime = ex.completedSetsTime.slice(0, newSets)\n                    }\n                  }\n\n                  return {\n                    ...ex,\n                    ...updates,\n                    setsCompleted: newSetsCompleted,\n                    completedSetsTime: newCompletedTime\n                  }\n                })\n              }\n            }\n          })\n        }))\n      },\n\n      toggleSetCompletion: (boxId, exerciseId, setIndex) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) => {\n            if (box.id !== boxId) return box\n\n            const currentData = box.data as WorkoutData\n            if (!currentData) return box\n\n            return {\n              ...box,\n              data: {\n                ...currentData,\n                exercises: currentData.exercises.map(ex => {\n                  if (ex.id !== exerciseId) return ex\n\n                  const updatedSetsCompleted = [...ex.setsCompleted]\n                  const updatedCompletedTime = [...ex.completedSetsTime]\n\n                  // åˆ‡æ›è©²çµ„çš„å®Œæˆç‹€æ…‹\n                  updatedSetsCompleted[setIndex] = !updatedSetsCompleted[setIndex]\n                  updatedCompletedTime[setIndex] = updatedSetsCompleted[setIndex] ? new Date() : null\n\n                  return {\n                    ...ex,\n                    setsCompleted: updatedSetsCompleted,\n                    completedSetsTime: updatedCompletedTime\n                  }\n                })\n              }\n            }\n          })\n        }))\n      },\n\n      // æ–‡å­—æç¤ºè³‡æ–™\n      updateReminderData: (boxId, data) => {\n        set((state) => ({\n          scheduledBoxes: state.scheduledBoxes.map((box) =>\n            box.id === boxId ? { ...box, data } : box\n          )\n        }))\n      },\n\n      // é€±è¨˜éŒ„\n      archiveCurrentWeek: (name) => {\n        const { currentWeek, scheduledBoxes } = get()\n        if (!currentWeek) return\n\n        const completedCount = scheduledBoxes.filter((box) => box.completed).length\n        const totalCount = scheduledBoxes.length\n        const completionRate = totalCount > 0 ? completedCount / totalCount : 0\n\n        const workoutBoxes = scheduledBoxes.filter((box) => {\n          const baseBox = get().boxes.find((b) => b.id === box.boxId)\n          return baseBox?.type === 'workout' && box.completed\n        })\n\n        const totalWorkoutVolume = workoutBoxes.reduce((total, box) => {\n          if (box.data) {\n            const workoutData = box.data as WorkoutData\n            // æ–°æ ¼å¼ï¼šè¨ˆç®—æ‰€æœ‰å‹•ä½œçš„è¨“ç·´é‡\n            if (workoutData.exercises && workoutData.exercises.length > 0) {\n              return total + workoutData.exercises.reduce((exerciseTotal, exercise) => {\n                const completedSets = exercise.setsCompleted.filter(Boolean).length\n                return exerciseTotal + (completedSets * exercise.weight * exercise.reps)\n              }, 0)\n            }\n            // èˆŠæ ¼å¼ç›¸å®¹ï¼ˆå·²å»¢æ£„ï¼‰\n            if (workoutData.totalVolume) {\n              return total + workoutData.totalVolume\n            }\n          }\n          return total\n        }, 0)\n\n        const archivedWeek: WeekRecord = {\n          ...currentWeek,\n          name,\n          archived: true,\n          scheduledBoxes,\n          statistics: {\n            completionRate,\n            totalWorkoutVolume,\n            totalWorkoutSessions: workoutBoxes.length,\n            completedCount,\n            totalCount,\n          }\n        }\n\n        set((state) => ({\n          weekRecords: [...state.weekRecords, archivedWeek]\n        }))\n      },\n\n      loadWeekRecord: (id) => {\n        const { weekRecords } = get()\n        const record = weekRecords.find((r) => r.id === id)\n        if (record) {\n          set({\n            currentWeek: record,\n            scheduledBoxes: record.scheduledBoxes\n          })\n        }\n      },\n\n      copyToNextWeek: (recordId) => {\n        const { weekRecords } = get()\n        const record = weekRecords.find((r) => r.id === recordId)\n        if (!record) return\n\n        const nextWeekStart = new Date(record.weekEnd)\n        nextWeekStart.setDate(nextWeekStart.getDate() + 1)\n\n        get().initializeCurrentWeek(nextWeekStart)\n\n        // è¤‡è£½æ’ç¨‹ä½†æ¸…é™¤å®Œæˆç‹€æ…‹\n        const copiedBoxes = record.scheduledBoxes.map((box) => ({\n          ...box,\n          id: generateId(),\n          weekId: get().currentWeek!.id,\n          completed: false,\n          completedAt: undefined,\n        }))\n\n        set({\n          scheduledBoxes: copiedBoxes\n        })\n      },\n\n      // çµ±è¨ˆ\n      getWeekStatistics: () => {\n        const { scheduledBoxes, boxes } = get()\n        const completedBoxes = scheduledBoxes.filter((box) => box.completed)\n        const totalBoxes = scheduledBoxes.length\n\n        const completedByType = {\n          workout: 0,\n          reminder: 0,\n          basic: 0,\n        }\n\n        let totalWorkoutTime = 0\n        let totalWorkoutVolume = 0\n        let totalWorkoutSessions = 0\n\n        completedBoxes.forEach((box) => {\n          const baseBox = boxes.find((b) => b.id === box.boxId)\n          if (baseBox) {\n            completedByType[baseBox.type]++\n\n            if (baseBox.type === 'workout') {\n              totalWorkoutTime += box.duration\n              totalWorkoutSessions++\n\n              // è¨ˆç®—é‡è¨“é‡ï¼šå¾ box.data ç²å–æ‰€æœ‰å‹•ä½œçš„è³‡æ–™\n              if (box.data) {\n                const workoutData = box.data as WorkoutData\n                // æ–°æ ¼å¼ï¼šè¨ˆç®—æ‰€æœ‰å‹•ä½œçš„è¨“ç·´é‡\n                if (workoutData.exercises && workoutData.exercises.length > 0) {\n                  totalWorkoutVolume += workoutData.exercises.reduce((exerciseTotal, exercise) => {\n                    const completedSets = exercise.setsCompleted.filter(Boolean).length\n                    return exerciseTotal + (completedSets * exercise.weight * exercise.reps)\n                  }, 0)\n                }\n                // èˆŠæ ¼å¼ç›¸å®¹ï¼ˆå·²å»¢æ£„ï¼‰\n                else if (workoutData.totalVolume) {\n                  totalWorkoutVolume += workoutData.totalVolume\n                }\n              }\n            }\n          }\n        })\n\n        return {\n          completionRate: totalBoxes > 0 ? completedBoxes.length / totalBoxes : 0,\n          totalWorkoutTime,\n          completedByType,\n          totalWorkoutVolume,\n          totalWorkoutSessions,\n        }\n      },\n\n      getWorkoutTrends: (weeks) => {\n        const { weekRecords } = get()\n        return weekRecords\n          .slice(-weeks)\n          .map((record) => ({\n            week: `${record.weekStart.getMonth() + 1}/${record.weekStart.getDate()}`,\n            volume: record.statistics.totalWorkoutVolume || 0,\n            sessions: record.statistics.totalWorkoutSessions || 0,\n            completionRate: record.statistics.completionRate,\n          }))\n      },\n\n      // åˆå§‹åŒ–\n      initializeCurrentWeek: (weekStart) => {\n        const weekEnd = getWeekEnd(weekStart)\n        const newWeek: WeekRecord = {\n          id: generateId(),\n          user_id: 'current-user', // TODO: å¯¦éš›ç”¨æˆ¶ID\n          weekStart: getWeekStart(weekStart),\n          weekEnd,\n          archived: false,\n          scheduledBoxes: [],\n          statistics: {\n            completionRate: 0,\n            completedCount: 0,\n            totalCount: 0,\n          },\n        }\n\n        set({\n          currentWeek: newWeek,\n          scheduledBoxes: [],\n        })\n      },\n    }),\n    {\n      name: 'timebox-storage',\n      version: 1,\n    }\n  )\n)","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4140,4143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4140,4143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// ============================\n// æ ¸å¿ƒå‹åˆ¥å®šç¾©\n// ============================\n\n// æ”¶æ¬¾ç‹€æ…‹\nexport type ReceiptStatus = 'received' | 'confirmed' | 'rejected';\n\n// ä»˜æ¬¾æ–¹å¼\nexport type PaymentMethod = 'cash' | 'transfer' | 'card' | 'check';\n\n// ç°½è­‰ç‹€æ…‹\nexport type VisaStatus = 'pending' | 'submitted' | 'issued' | 'collected' | 'rejected';\n\n// æ­£ç¢ºçš„ User å‹åˆ¥ï¼ˆèˆ‡ Employee ä¸€è‡´ï¼‰\nexport interface User {\n  id: string;\n  employee_number: string;\n  english_name: string;\n  display_name: string;\n  chinese_name: string; // ä¸­æ–‡å§“åï¼ˆæœ¬åï¼‰\n  personal_info: {\n    national_id: string;\n    birthday: string;\n    phone: string | string[]; // æ”¯æ´å–®ä¸€é›»è©±æˆ–å¤šå€‹é›»è©±\n    email: string;\n    address: string;\n    emergency_contact: {\n      name: string;\n      relationship: string;\n      phone: string;\n    };\n  };\n  job_info: {\n    supervisor?: string;\n    hire_date: string;\n    probation_end_date?: string;\n  };\n  salary_info: {\n    base_salary: number;\n    allowances: {\n      type: string;\n      amount: number;\n    }[];\n    salary_history: {\n      effective_date: string;\n      base_salary: number;\n      reason: string;\n    }[];\n  };\n  permissions: string[];\n  roles?: ('admin' | 'employee' | 'user' | 'tour_leader' | 'sales' | 'accountant' | 'assistant')[]; // é™„åŠ èº«ä»½æ¨™ç±¤ï¼ˆä¸å½±éŸ¿æ¬Šé™ï¼‰ï¼Œæ”¯æ´å¤šé‡èº«ä»½\n  attendance: {\n    leave_records: {\n      id: string;\n      type: 'annual' | 'sick' | 'personal' | 'maternity' | 'other';\n      start_date: string;\n      end_date: string;\n      days: number;\n      reason?: string;\n      status: 'pending' | 'approved' | 'rejected';\n      approved_by?: string;\n    }[];\n    overtime_records: {\n      id: string;\n      date: string;\n      hours: number;\n      reason: string;\n      approved_by?: string;\n    }[];\n  };\n  contracts: {\n    id: string;\n    type: 'employment' | 'probation' | 'renewal';\n    start_date: string;\n    end_date?: string;\n    file_path?: string;\n    notes?: string;\n  }[];\n  status: 'active' | 'probation' | 'leave' | 'terminated';\n  avatar?: string;\n\n  // èªè­‰ç›¸é—œ\n  password_hash?: string; // åŠ å¯†å¾Œçš„å¯†ç¢¼\n  last_password_change?: string; // æœ€å¾Œä¿®æ”¹å¯†ç¢¼æ™‚é–“\n  must_change_password?: boolean; // æ˜¯å¦éœ€è¦ä¿®æ”¹å¯†ç¢¼ï¼ˆé¦–æ¬¡ç™»å…¥ï¼‰\n  failed_login_attempts?: number; // ç™»å…¥å¤±æ•—æ¬¡æ•¸\n  last_failed_login?: string; // æœ€å¾Œå¤±æ•—ç™»å…¥æ™‚é–“\n\n  created_at: string;\n  updated_at: string;\n}\n\n// Employee å‹åˆ¥ç¾åœ¨æ˜¯ User çš„åˆ¥å\nexport type Employee = User;\n\nexport interface Todo {\n  id: string;\n  title: string;\n  priority: 1 | 2 | 3 | 4 | 5; // æ˜Ÿç´šç·Šæ€¥åº¦\n  deadline?: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  completed?: boolean; // å°é½Šè³‡æ–™åº«æ¬„ä½\n\n  // äººå“¡é—œä¿‚ï¼ˆå…±äº«æ©Ÿåˆ¶ï¼‰\n  creator: string; // å»ºç«‹è€…\n  assignee?: string; // è¢«æŒ‡æ´¾è€…ï¼ˆå¯é¸ï¼‰\n  visibility: string[]; // å¯è¦‹äººå“¡IDåˆ—è¡¨ = [creator, assignee]\n\n  // é—œè¯è³‡æ–™\n  related_items: {\n    type: 'group' | 'quote' | 'order' | 'invoice' | 'receipt';\n    id: string;\n    title: string;\n  }[];\n\n  // å­ä»»å‹™\n  sub_tasks: {\n    id: string;\n    title: string;\n    done: boolean;\n    completed_at?: string;\n  }[];\n\n  // ç°¡å–®å‚™è¨»ï¼ˆéç•™è¨€æ¿ï¼‰\n  notes: {\n    timestamp: string;\n    content: string;\n  }[];\n\n  // å¿«é€ŸåŠŸèƒ½è¨­å®š\n  enabled_quick_actions: ('receipt' | 'invoice' | 'group' | 'quote' | 'assign')[];\n\n  // é€šçŸ¥æ¨™è¨˜\n  needs_creator_notification?: boolean; // è¢«æŒ‡æ´¾äººæœ‰æ›´æ–°ï¼Œéœ€è¦é€šçŸ¥å»ºç«‹è€…\n\n  created_at: string;\n  updated_at: string;\n}\n\n// èˆªç­è³‡è¨Š\nexport interface FlightInfo {\n  airline: string;  // èˆªç©ºå…¬å¸\n  flightNumber: string;  // ç­æ¬¡\n  departureAirport: string;  // å‡ºç™¼æ©Ÿå ´ä»£ç¢¼ï¼ˆå¦‚ï¼šTPEï¼‰\n  departureTime: string;  // å‡ºç™¼æ™‚é–“ï¼ˆå¦‚ï¼š06:50ï¼‰\n  departureDate?: string;  // å‡ºç™¼æ—¥æœŸï¼ˆå¦‚ï¼š10/21ï¼‰\n  arrivalAirport: string;  // æŠµé”æ©Ÿå ´ä»£ç¢¼ï¼ˆå¦‚ï¼šFUKï¼‰\n  arrivalTime: string;  // æŠµé”æ™‚é–“ï¼ˆå¦‚ï¼š09:55ï¼‰\n  duration?: string;  // é£›è¡Œæ™‚é–“ï¼ˆå¦‚ï¼š2å°æ™‚5åˆ†ï¼‰\n}\n\n// Tour é¡å‹å·²ç§»è‡³ @/types/tour.types.ts\n// ä½¿ç”¨å®Œæ•´çš„ Tour å®šç¾©\nexport type { Tour } from '@/types/tour.types';\n\nexport interface Member {\n  id: string;\n  order_id: string;\n  name: string;\n  name_en: string; // æ‹¼éŸ³\n  birthday: string; // YYYY-MM-DD\n  passport_number: string;\n  passport_expiry: string; // YYYY-MM-DD\n  id_number: string; // èº«åˆ†è­‰å­—è™Ÿ\n  gender: 'M' | 'F' | ''; // æ ¹æ“šèº«åˆ†è­‰è‡ªå‹•åˆ¤æ–·\n  age: number; // æ ¹æ“šç”Ÿæ—¥å’Œå‡ºç™¼æ—¥è‡ªå‹•è¨ˆç®—\n  assigned_room?: string; // åˆ†é…çš„æˆ¿é–“\n  is_child_no_bed?: boolean; // å°å­©ä¸ä½”åºŠ\n  reservation_code?: string; // è¨‚ä½ä»£è™Ÿ\n  add_ons?: string[]; // åŠ è³¼é …ç›®IDs\n  refunds?: string[]; // é€€è²»é …ç›®IDs\n  custom_fields?: Record<string, any>; // è‡ªå®šç¾©æ¬„ä½æ•¸æ“š {fieldId: value}\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface TourAddOn {\n  id: string;\n  tour_id: string;\n  name: string;\n  price: number;\n  description?: string;\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface TourRefund {\n  id: string;\n  tour_id: string;\n  order_id: string;\n  order_number: string;\n  member_name: string;\n  reason: string;\n  amount: number;\n  status: 'pending' | 'approved' | 'refunded' | 'rejected';\n  applied_date: string;\n  processed_date?: string;\n  notes?: string;\n  created_at: string;\n  updated_at: string;\n}\n\n// è¡Œç¨‹è¡¨ç›¸é—œå‹åˆ¥\nexport interface ItineraryFeature {\n  icon: string; // icon åç¨± (å¦‚: \"IconBuilding\")\n  title: string;\n  description: string;\n}\n\nexport interface FocusCard {\n  title: string;\n  src: string; // åœ–ç‰‡ URL\n}\n\nexport interface LeaderInfo {\n  name: string;\n  domesticPhone: string;\n  overseasPhone: string;\n}\n\nexport interface MeetingInfo {\n  time: string; // ISO 8601 æ ¼å¼\n  location: string;\n}\n\nexport interface DailyActivity {\n  icon: string; // emoji æˆ– icon\n  title: string;\n  description: string;\n}\n\nexport interface DailyMeals {\n  breakfast: string;\n  lunch: string;\n  dinner: string;\n}\n\nexport interface DailyItineraryDay {\n  dayLabel: string; // å¦‚: \"Day 1\"\n  date: string; // å¦‚: \"10/21 (äºŒ)\"\n  title: string;\n  highlight?: string;\n  description?: string;\n  activities: DailyActivity[];\n  recommendations: string[];\n  meals: DailyMeals;\n  accommodation: string;\n}\n\nexport interface Itinerary {\n  id: string;\n  tour_id?: string; // é—œè¯çš„åœ˜ IDï¼ˆé¸å¡«ï¼Œå› ç‚ºå¯èƒ½åªæ˜¯è‰ç¨¿ï¼‰\n\n  // å°é¢è³‡è¨Š\n  tagline: string;\n  title: string;\n  subtitle: string;\n  description: string;\n  departureDate: string;\n  tourCode: string;\n  coverImage: string;\n  country: string;\n  city: string;\n  status: 'draft' | 'published';\n\n  // èˆªç­è³‡è¨Š\n  outboundFlight?: FlightInfo;\n  returnFlight?: FlightInfo;\n\n  // è¡Œç¨‹ç‰¹è‰²\n  features: ItineraryFeature[];\n\n  // ç²¾é¸æ™¯é»\n  focusCards: FocusCard[];\n\n  // é ˜éšŠè³‡è¨Š\n  leader?: LeaderInfo;\n\n  // é›†åˆè³‡è¨Š\n  meetingInfo?: MeetingInfo;\n\n  // è¡Œç¨‹å‰¯æ¨™é¡Œ\n  itinerarySubtitle?: string;\n\n  // é€æ—¥è¡Œç¨‹\n  dailyItinerary: DailyItineraryDay[];\n\n  created_at: string;\n  updated_at: string;\n}\n\n// Order é¡å‹å·²ç§»è‡³ @/types/order.types.ts\n// ä½¿ç”¨å®Œæ•´çš„ Order å®šç¾©\nexport type { Order } from '@/types/order.types';\n\n// Customer é¡å‹å·²ç§»è‡³ @/types/customer.types.ts\n// ä½¿ç”¨å®Œæ•´çš„ Customer å®šç¾©ï¼Œä¸å†ä½¿ç”¨ç°¡åŒ–ç‰ˆ\nexport type { Customer } from '@/types/customer.types';\n\nexport interface Payment {\n  id: string;\n  type: 'receipt' | 'request' | 'disbursement';\n  // receipt: æ”¶æ¬¾\n  // request: è«‹æ¬¾\n  // disbursement: å‡ºç´\n  order_id?: string;\n  tour_id?: string;\n  amount: number;\n  description: string;\n  status: 'pending' | 'confirmed' | 'completed';\n  // pending: å¾…ç¢ºèª\n  // confirmed: å·²ç¢ºèª\n  // completed: å·²å®Œæˆ\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface Quote {\n  id: string;\n  quote_number?: string; // å ±åƒ¹å–®è™Ÿç¢¼ (QUOTE-2025-0001)\n  name: string; // åœ˜é«”åç¨±\n  status: 'draft' | 'proposed' | 'revised' | 'approved' | 'converted' | 'rejected';\n  // draft: è‰ç¨¿\n  // proposed: ææ¡ˆ\n  // revised: ä¿®æ”¹ä¸­\n  // approved: å·²æ ¸å‡†\n  // converted: å·²è½‰å–®\n  // rejected: å·²æ‹’çµ•\n  tour_id?: string; // é—œè¯çš„æ—…éŠåœ˜ID\n\n  // å®¢æˆ¶è³‡è¨Š\n  customer_name?: string; // å®¢æˆ¶åç¨±\n  contact_person?: string; // è¯çµ¡äºº\n  contact_phone?: string; // è¯çµ¡é›»è©±\n  contact_email?: string; // Email\n\n  // éœ€æ±‚è³‡è¨Š\n  group_size: number; // åœ˜é«”äººæ•¸ï¼ˆå‘ä¸‹ç›¸å®¹ï¼šç¸½äººæ•¸ï¼‰\n  accommodation_days: number; // ä½å®¿å¤©æ•¸\n  requirements?: string; // éœ€æ±‚èªªæ˜\n  budget_range?: string; // é ç®—ç¯„åœ\n  valid_until?: string; // å ±åƒ¹æœ‰æ•ˆæœŸ\n  payment_terms?: string; // ä»˜æ¬¾æ¢ä»¶\n\n  // å¤šèº«ä»½äººæ•¸çµ±è¨ˆ\n  participant_counts?: {\n    adult: number; // æˆäººï¼ˆé›™äººæˆ¿ï¼‰\n    child_with_bed: number; // å°æœ‹å‹ï¼ˆä½”åºŠï¼‰\n    child_no_bed: number; // ä¸ä½”åºŠ\n    single_room: number; // å–®äººæˆ¿\n    infant: number; // å¬°å…’\n  };\n\n  // å¤šèº«ä»½å”®åƒ¹\n  selling_prices?: {\n    adult: number;\n    child_with_bed: number;\n    child_no_bed: number;\n    single_room: number;\n    infant: number;\n  };\n\n  categories: QuoteCategory[]; // è²»ç”¨åˆ†é¡\n  total_cost: number; // ç¸½æˆæœ¬\n  version?: number; // ç‰ˆæœ¬è™Ÿ\n  versions?: QuoteVersion[]; // ç‰ˆæœ¬æ­·å²\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface QuoteVersion {\n  id: string;\n  version: number;\n  categories: QuoteCategory[];\n  total_cost: number;\n  group_size: number; // åœ˜é«”äººæ•¸\n  accommodation_days: number; // ä½å®¿å¤©æ•¸\n  participant_counts: {\n    adult: number;\n    child_with_bed: number;\n    child_no_bed: number;\n    single_room: number;\n    infant: number;\n  }; // å¤šèº«ä»½äººæ•¸çµ±è¨ˆ\n  selling_prices: {\n    adult: number;\n    child_with_bed: number;\n    child_no_bed: number;\n    single_room: number;\n    infant: number;\n  }; // å¤šèº«ä»½å”®åƒ¹\n  note?: string; // ä¿®æ”¹èªªæ˜\n  created_at: string;\n}\n\nexport interface QuoteCategory {\n  id: string;\n  name: string;\n  items: QuoteItem[];\n  total: number;\n}\n\nexport interface QuoteItem {\n  id: string;\n  name: string;\n  quantity: number;\n  unit_price: number;\n  total: number;\n  note?: string;\n  day?: number; // ä½å®¿å°ˆç”¨ï¼šç¬¬å¹¾å¤©\n  room_type?: string; // ä½å®¿å°ˆç”¨ï¼šæˆ¿å‹åç¨±\n  is_group_cost?: boolean; // äº¤é€šå’Œé ˜éšŠå°éŠå°ˆç”¨ï¼šåœ˜é«”åˆ†æ”¤\n  // å¤šèº«ä»½è¨ˆåƒ¹ï¼šæ©Ÿç¥¨å°ˆç”¨\n  pricing_type?: 'uniform' | 'by_identity'; // uniform: çµ±ä¸€åƒ¹æ ¼, by_identity: ä¾èº«ä»½è¨ˆåƒ¹\n  adult_price?: number; // æˆäººåƒ¹\n  child_price?: number; // å°æœ‹å‹åƒ¹\n  infant_price?: number; // å¬°å…’åƒ¹\n  created_at: string;\n  updated_at: string;\n}\n\n// === ä¾›æ‡‰å•†ç®¡ç†ç³»çµ± ===\n// Supplier é¡å‹å·²ç§»è‡³ @/types/supplier.types.ts\n// ä½¿ç”¨å®Œæ•´çš„ Supplier å®šç¾©\nexport type { Supplier, SupplierContact, SupplierBankInfo, PriceListItem } from '@/types/supplier.types';\n\n\n// === è«‹æ¬¾å–®ç®¡ç†ç³»çµ± ===\nexport interface PaymentRequest {\n  id: string;\n  request_number: string; // REQ-2024001\n\n  // åˆ†é…æ¨¡å¼\n  allocation_mode: 'single' | 'multiple'; // å–®ä¸€åœ˜é«” or æ‰¹é‡åˆ†é…\n\n  // å–®ä¸€åœ˜é«”æ¨¡å¼ï¼ˆå‘ä¸‹ç›¸å®¹ï¼‰\n  tour_id?: string; // åœ˜è™Ÿï¼ˆallocation_mode = 'single' æ™‚ä½¿ç”¨ï¼‰\n  code?: string; // CNX241225\n  tour_name?: string; // åœ˜é«”åç¨±å¿«ç…§\n\n  // æ‰¹é‡åˆ†é…æ¨¡å¼ï¼ˆä¸€ç­†å¸³åˆ†å¤šåœ˜ï¼‰\n  tour_allocations?: TourAllocation[]; // åœ˜é«”åˆ†é…åˆ—è¡¨ï¼ˆallocation_mode = 'multiple' æ™‚ä½¿ç”¨ï¼‰\n\n  // å…±ç”¨æ¬„ä½\n  quote_id?: string; // é—œè¯çš„å ±åƒ¹å–®ID\n  order_id?: string; // è¨‚å–®IDï¼ˆé¸å¡«ï¼‰\n  order_number?: string; // è¨‚å–®è™Ÿç¢¼\n  request_date: string; // è«‹æ¬¾æ—¥æœŸ (å›ºå®šåªèƒ½é¸æ¯é€±å››)\n  items: PaymentRequestItem[];\n  total_amount: number;\n  status: 'pending' | 'processing' | 'confirmed' | 'paid';\n  note?: string; // è«‹æ¬¾å‚™è¨»\n  budget_warning?: boolean; // è¶…é ç®—è­¦å‘Š\n  created_by: string; // å»ºç«‹è€…ID\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface PaymentRequestItem {\n  id: string;\n  request_id: string; // æ‰€å±¬è«‹æ¬¾å–®ID\n  item_number: string; // REQ-2024001-001\n  category: 'ä½å®¿' | 'äº¤é€š' | 'é¤é£Ÿ' | 'é–€ç¥¨' | 'å°éŠ' | 'å…¶ä»–';\n  supplier_id: string;\n  supplier_name: string; // ä¾›æ‡‰å•†åç¨±å¿«ç…§\n  description: string;\n  unit_price: number;\n  quantity: number;\n  subtotal: number;\n  note?: string; // é …ç›®å‚™è¨»\n  sort_order: number; // æ’åº\n  created_at: string;\n  updated_at: string;\n}\n\n// åœ˜é«”åˆ†é…é …ç›®ï¼ˆç”¨æ–¼æ‰¹é‡åˆ†é…ï¼‰\nexport interface TourAllocation {\n  tour_id: string; // åœ˜è™ŸID\n  code: string; // åœ˜é«”ä»£ç¢¼\n  tour_name: string; // åœ˜é«”åç¨±\n  allocated_amount: number; // åˆ†é…é‡‘é¡\n}\n\n// === å‡ºç´å–®ç®¡ç†ç³»çµ± ===\nexport interface DisbursementOrder {\n  id: string;\n  order_number: string; // CD-2024001\n  disbursement_date: string; // å‡ºå¸³æ—¥æœŸ (é è¨­æœ¬é€±å››)\n  payment_request_ids: string[]; // é—œè¯çš„è«‹æ¬¾å–®IDé™£åˆ—\n  total_amount: number; // ç¸½é‡‘é¡ (è‡ªå‹•åŠ ç¸½)\n  status: 'pending' | 'confirmed' | 'paid' | 'cancelled'; // å¾…ç¢ºèªã€å·²ç¢ºèªã€å·²ä»˜æ¬¾ã€å·²å–æ¶ˆ\n  note?: string; // å‡ºç´å‚™è¨»\n  created_by: string; // å»ºç«‹è€…ID\n  confirmed_by?: string; // ç¢ºèªè€…ID\n  confirmed_at?: string; // ç¢ºèªæ™‚é–“\n  paid_at?: string; // ä»˜æ¬¾æ™‚é–“\n  created_at: string;\n  updated_at: string;\n}\n\n// === æ”¶æ¬¾å–®ç®¡ç†ç³»çµ± ===\nexport interface ReceiptOrder {\n  id: string;\n  receipt_number: string; // REC-2024001\n\n  // åˆ†é…æ¨¡å¼\n  allocation_mode: 'single' | 'multiple'; // å–®ä¸€è¨‚å–® or æ‰¹é‡åˆ†é…\n\n  // å–®ä¸€è¨‚å–®æ¨¡å¼ï¼ˆå‘ä¸‹ç›¸å®¹ï¼‰\n  order_id?: string; // é—œè¯çš„è¨‚å–®IDï¼ˆallocation_mode = 'single' æ™‚ä½¿ç”¨ï¼‰\n  order_number?: string; // è¨‚å–®è™Ÿç¢¼å¿«ç…§\n  tour_id?: string; // åœ˜è™Ÿ\n  code?: string; // åœ˜é«”ä»£ç¢¼\n  tour_name?: string; // åœ˜é«”åç¨±å¿«ç…§\n  contact_person?: string; // è¯çµ¡äººå¿«ç…§\n\n  // æ‰¹é‡åˆ†é…æ¨¡å¼ï¼ˆä¸€ç­†æ¬¾åˆ†å¤šè¨‚å–®ï¼‰\n  order_allocations?: OrderAllocation[]; // è¨‚å–®åˆ†é…åˆ—è¡¨ï¼ˆallocation_mode = 'multiple' æ™‚ä½¿ç”¨ï¼‰\n\n  // å…±ç”¨æ¬„ä½\n  receipt_date: string; // æ”¶æ¬¾æ—¥æœŸ\n  payment_items: ReceiptPaymentItem[]; // æ”¶æ¬¾é …ç›®\n  total_amount: number; // ç¸½æ”¶æ¬¾é‡‘é¡\n  status: ReceiptStatus; // æ”¶æ¬¾ç‹€æ…‹\n  note?: string; // æ”¶æ¬¾å‚™è¨»\n  created_by: string; // å»ºç«‹è€…ID\n  confirmed_by?: string; // ç¢ºèªè€…ID\n  confirmed_at?: string; // ç¢ºèªæ™‚é–“\n  created_at: string;\n  updated_at: string;\n}\n\n// è¨‚å–®åˆ†é…é …ç›®ï¼ˆç”¨æ–¼æ‰¹é‡åˆ†é…ï¼‰\nexport interface OrderAllocation {\n  order_id: string; // è¨‚å–®ID\n  order_number: string; // è¨‚å–®è™Ÿç¢¼\n  tour_id: string; // åœ˜è™Ÿ\n  code: string; // åœ˜é«”ä»£ç¢¼\n  tour_name: string; // åœ˜é«”åç¨±\n  contact_person: string; // è¯çµ¡äºº\n  allocated_amount: number; // åˆ†é…é‡‘é¡\n}\n\nexport interface ReceiptPaymentItem {\n  id: string;\n  receipt_id: string; // æ‰€å±¬æ”¶æ¬¾å–®ID\n  payment_method: PaymentMethod; // æ”¶æ¬¾æ–¹å¼\n  amount: number; // é‡‘é¡\n  account_info?: string; // å¸³æˆ¶è³‡è¨Š (åŒ¯æ¬¾ç”¨)\n  card_last_four?: string; // å¡è™Ÿå¾Œå››ç¢¼ (åˆ·å¡ç”¨)\n  auth_code?: string; // æˆæ¬Šç¢¼ (åˆ·å¡ç”¨)\n  check_number?: string; // æ”¯ç¥¨è™Ÿç¢¼\n  check_bank?: string; // æ”¯ç¥¨éŠ€è¡Œ\n  check_due_date?: string; // æ”¯ç¥¨åˆ°æœŸæ—¥\n  transaction_date: string; // äº¤æ˜“æ—¥æœŸ\n  handler_name?: string; // ç¶“æ‰‹äºº (ç¾é‡‘ç”¨)\n  fees?: number; // æ‰‹çºŒè²»\n  note?: string; // å‚™è¨»\n  created_at: string;\n  updated_at: string;\n}\n\n// === ç°½è­‰ç®¡ç†ç³»çµ± ===\nexport interface Visa {\n  id: string;\n\n  // ç”³è«‹äººè³‡è¨Š\n  applicant_name: string; // ç”³è«‹äººå§“å\n  contact_person: string; // è¯çµ¡äºº\n  contact_phone: string; // è¯çµ¡é›»è©±\n\n  // ç°½è­‰è³‡è¨Š\n  visa_type: string; // ç°½è­‰é¡å‹ï¼ˆè­·ç…§ æˆäººã€å°èƒè­‰ç­‰ï¼‰\n  country: string; // åœ‹å®¶\n\n  // ç‹€æ…‹\n  status: VisaStatus;\n\n  // æ—¥æœŸ\n  submission_date?: string; // é€ä»¶æ™‚é–“\n  received_date?: string; // ä¸‹ä»¶æ™‚é–“\n  pickup_date?: string; // å–ä»¶æ™‚é–“\n\n  // é—œè¯è³‡è¨Š\n  order_id: string; // é—œè¯çš„è¨‚å–®ID\n  order_number: string; // è¨‚å–®è™Ÿç¢¼å¿«ç…§\n  tour_id: string; // åœ˜è™ŸID\n  code: string; // åœ˜é«”ä»£ç¢¼ (tourCode)\n\n  // è²»ç”¨\n  fee: number; // ä»£è¾¦è²»\n  cost: number; // æˆæœ¬\n\n  // å…¶ä»–\n  note?: string; // å‚™è¨»\n  created_by?: string; // å»ºç«‹è€…ID\n  created_at: string;\n  updated_at: string;\n}\n\n// ç³»çµ±åŠŸèƒ½æ¬Šé™æ¸…å–® - å¾çµ±ä¸€é…ç½®è‡ªå‹•ç”Ÿæˆ\nexport { SYSTEM_PERMISSIONS, FEATURE_PERMISSIONS } from '@/lib/permissions';\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/useTravelInvoiceStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3464,3467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3464,3467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4011,4014],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4011,4014],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":181,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4660,4663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4660,4663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":209,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5465,5468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5465,5468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6322,6325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6322,6325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ—…è¡Œæ¥­ä»£è½‰ç™¼ç¥¨ Zustand Store\n *\n * âš ï¸ ç‰¹æ®Šèªªæ˜ï¼šæ­¤ Store ä¸ä½¿ç”¨ FastIn æ¶æ§‹\n *\n * åŸå› ï¼š\n * 1. ç™¼ç¥¨éœ€è¦å³æ™‚èˆ‡ç¬¬ä¸‰æ–¹ APIï¼ˆè—æ–°é‡‘æµï¼‰äº’å‹•\n * 2. ç™¼ç¥¨é–‹ç«‹/ä½œå»¢å…·æœ‰æ³•å¾‹æ•ˆåŠ›ï¼Œä¸é©åˆé›¢ç·šæ¨‚è§€å¯«å…¥\n * 3. å¿…é ˆç¢ºä¿ API å›æ‡‰å¾Œæ‰èƒ½æ›´æ–° UIï¼Œé¿å…ç‹€æ…‹ä¸ä¸€è‡´\n * 4. ç™¼ç¥¨è³‡æ–™ç”±å¾Œç«¯çµ±ä¸€ç®¡ç†ï¼Œä¸éœ€è¦æœ¬åœ°å¿«å–\n *\n * æ¶æ§‹ï¼š\n * - ç›´æ¥å‘¼å« Next.js API routesï¼ˆ/api/travel-invoice/*ï¼‰\n * - ç„¡ IndexedDB å¿«å–\n * - ç„¡ _needs_sync æ¨™è¨˜\n * - ç„¡èƒŒæ™¯åŒæ­¥æ©Ÿåˆ¶\n *\n * é›¢ç·šè™•ç†ï¼š\n * - é›¢ç·šæ™‚æœƒé¡¯ç¤ºéŒ¯èª¤ï¼ˆé æœŸè¡Œç‚ºï¼‰\n * - ä¸æ”¯æ´é›¢ç·šé–‹ç«‹ç™¼ç¥¨\n *\n * å¦‚æœæœªä¾†éœ€è¦é›¢ç·šæŸ¥è©¢æ­·å²ç™¼ç¥¨ï¼Œå¯è€ƒæ…®ï¼š\n * 1. åƒ…å¿«å–æŸ¥è©¢çµæœï¼ˆread-only cacheï¼‰\n * 2. é–‹ç«‹/ä½œå»¢æ“ä½œä»ç¶­æŒå³æ™‚ API å‘¼å«\n */\n\nimport { create } from 'zustand'\n\nexport interface TravelInvoiceItem {\n  item_name: string\n  item_count: number\n  item_unit: string\n  item_price: number\n  itemAmt: number\n  itemTaxType?: string\n  itemWord?: string\n}\n\nexport interface BuyerInfo {\n  buyerName: string\n  buyerUBN?: string\n  buyerAddress?: string\n  buyerEmail?: string\n  buyerMobileCode?: string\n  buyerMobile?: string\n  carrierType?: string\n  carrierNum?: string\n  loveCode?: string\n  printFlag?: 'Y' | 'N'\n}\n\nexport interface TravelInvoice {\n  id: string\n  transactionNo: string\n  merchantId: string\n  invoice_number?: string\n  invoice_date: string\n  total_amount: number\n  tax_type: 'dutiable' | 'zero' | 'free'\n  buyerInfo: BuyerInfo\n  items: TravelInvoiceItem[]\n  status: 'pending' | 'issued' | 'voided' | 'allowance' | 'failed'\n  apiStatus?: string\n  apiMessage?: string\n  randomNum?: string\n  barcode?: string\n  qrcodeL?: string\n  qrcodeR?: string\n  voidDate?: string\n  voidReason?: string\n  allowanceDate?: string\n  allowanceAmount?: number\n  allowanceItems?: TravelInvoiceItem[]\n  order_id?: string\n  tour_id?: string\n  created_by: string\n  created_at: string\n  updated_at: string\n}\n\ninterface TravelInvoiceState {\n  invoices: TravelInvoice[]\n  currentInvoice: TravelInvoice | null\n  isLoading: boolean\n  error: string | null\n\n  // Actions\n  fetchInvoices: (filters?: {\n    status?: string\n    start_date?: string\n    end_date?: string\n    page?: number\n    limit?: number\n  }) => Promise<void>\n  fetchInvoiceById: (id: string) => Promise<void>\n  issueInvoice: (data: {\n    invoice_date: string\n    total_amount: number\n    tax_type?: string\n    buyerInfo: BuyerInfo\n    items: TravelInvoiceItem[]\n    order_id?: string\n    tour_id?: string\n    created_by: string\n  }) => Promise<TravelInvoice>\n  voidInvoice: (invoiceId: string, voidReason: string, operatedBy: string) => Promise<void>\n  allowanceInvoice: (\n    invoiceId: string,\n    allowanceAmount: number,\n    allowanceItems: TravelInvoiceItem[],\n    operatedBy: string\n  ) => Promise<void>\n  setCurrentInvoice: (invoice: TravelInvoice | null) => void\n  clearError: () => void\n}\n\nexport const useTravelInvoiceStore = create<TravelInvoiceState>((set, get) => ({\n  invoices: [],\n  currentInvoice: null,\n  isLoading: false,\n  error: null,\n\n  fetchInvoices: async (filters = {}) => {\n    set({ isLoading: true, error: null })\n    try {\n      const params = new URLSearchParams()\n      if (filters.status) params.append('status', filters.status)\n      if (filters.start_date) params.append('start_date', filters.start_date)\n      if (filters.end_date) params.append('end_date', filters.end_date)\n      if (filters.page) params.append('page', filters.page.toString())\n      if (filters.limit) params.append('limit', filters.limit.toString())\n\n      const response = await fetch(`/api/travel-invoice/query?${params.toString()}`)\n      if (!response.ok) throw new Error('æŸ¥è©¢ç™¼ç¥¨å¤±æ•—')\n\n      const result = await response.json()\n      set({ invoices: result.data, isLoading: false })\n    } catch (error: any) {\n      set({ error: error.message, isLoading: false })\n      throw error\n    }\n  },\n\n  fetchInvoiceById: async (id: string) => {\n    set({ isLoading: true, error: null })\n    try {\n      const response = await fetch(`/api/travel-invoice/query?id=${id}`)\n      if (!response.ok) throw new Error('æŸ¥è©¢ç™¼ç¥¨å¤±æ•—')\n\n      const result = await response.json()\n      if (result.data && result.data.length > 0) {\n        set({ currentInvoice: result.data[0], isLoading: false })\n      } else {\n        throw new Error('æ‰¾ä¸åˆ°ç™¼ç¥¨')\n      }\n    } catch (error: any) {\n      set({ error: error.message, isLoading: false })\n      throw error\n    }\n  },\n\n  issueInvoice: async (data) => {\n    set({ isLoading: true, error: null })\n    try {\n      const response = await fetch('/api/travel-invoice/issue', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      })\n\n      const result = await response.json()\n      if (!result.success) {\n        throw new Error(result.message || result.error || 'é–‹ç«‹ç™¼ç¥¨å¤±æ•—')\n      }\n\n      // é‡æ–°è¼‰å…¥ç™¼ç¥¨åˆ—è¡¨\n      await get().fetchInvoices()\n      set({ isLoading: false })\n\n      return result.data\n    } catch (error: any) {\n      set({ error: error.message, isLoading: false })\n      throw error\n    }\n  },\n\n  voidInvoice: async (invoiceId, voidReason, operatedBy) => {\n    set({ isLoading: true, error: null })\n    try {\n      const response = await fetch('/api/travel-invoice/void', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ invoiceId, voidReason, operatedBy }),\n      })\n\n      const result = await response.json()\n      if (!result.success) {\n        throw new Error(result.message || result.error || 'ä½œå»¢ç™¼ç¥¨å¤±æ•—')\n      }\n\n      // æ›´æ–°ç•¶å‰ç™¼ç¥¨\n      if (get().currentInvoice?.id === invoiceId) {\n        set({ currentInvoice: result.data })\n      }\n\n      // é‡æ–°è¼‰å…¥ç™¼ç¥¨åˆ—è¡¨\n      await get().fetchInvoices()\n      set({ isLoading: false })\n    } catch (error: any) {\n      set({ error: error.message, isLoading: false })\n      throw error\n    }\n  },\n\n  allowanceInvoice: async (invoiceId, allowanceAmount, allowanceItems, operatedBy) => {\n    set({ isLoading: true, error: null })\n    try {\n      const response = await fetch('/api/travel-invoice/allowance', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ invoiceId, allowanceAmount, allowanceItems, operatedBy }),\n      })\n\n      const result = await response.json()\n      if (!result.success) {\n        throw new Error(result.message || result.error || 'é–‹ç«‹æŠ˜è®“å¤±æ•—')\n      }\n\n      // æ›´æ–°ç•¶å‰ç™¼ç¥¨\n      if (get().currentInvoice?.id === invoiceId) {\n        set({ currentInvoice: result.data })\n      }\n\n      // é‡æ–°è¼‰å…¥ç™¼ç¥¨åˆ—è¡¨\n      await get().fetchInvoices()\n      set({ isLoading: false })\n    } catch (error: any) {\n      set({ error: error.message, isLoading: false })\n      throw error\n    }\n  },\n\n  setCurrentInvoice: (invoice) => set({ currentInvoice: invoice }),\n  clearError: () => set({ error: null }),\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/user-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[315,318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[315,318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2483,2486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2483,2486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3146,3149],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3146,3149],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3444,3447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3444,3447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3649,3652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3649,3652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3923,3926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3923,3926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4098,4101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4098,4101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4665,4668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4665,4668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4975,4978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4975,4978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5257,5260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5257,5260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":205,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5545,5548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5545,5548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5814,5817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5814,5817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6405,6408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6405,6408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6864,6867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6864,6867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7187,7190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7187,7190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7388,7391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7388,7391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * å“¡å·¥ç®¡ç† Store\n * é›¢ç·šå„ªå…ˆæ¶æ§‹ï¼šSupabaseï¼ˆé›²ç«¯ï¼‰+ IndexedDBï¼ˆå¿«å–ï¼‰\n */\n\nimport { User } from './types';\nimport { createStore } from './create-store';\nimport { TABLES } from '@/lib/db/schemas';\nimport { generateUUID } from '@/lib/utils/uuid';\n\n// å»ºç«‹å“¡å·¥ Store\nexport const useUserStore = createStore<User>(\n  TABLES.EMPLOYEES as any,\n  undefined, // å“¡å·¥ä½¿ç”¨ employee_number è€Œé codeï¼Œæ‰€ä»¥ä¸éœ€è¦ codePrefix\n  true // enableSupabase\n);\n\n// æ“´å……è‡ªè¨‚æ–¹æ³•ï¼ˆå¦‚æœéœ€è¦ï¼‰\nexport const userStoreHelpers = {\n  /**\n   * æ ¹æ“šå“¡å·¥ç·¨è™ŸæŸ¥è©¢\n   */\n  getUserByNumber: (employee_number: string): User | undefined => {\n    const state = useUserStore.getState();\n    return state.items.find(user => user.employee_number === employee_number);\n  },\n\n  /**\n   * å“¡å·¥ç·¨è™Ÿç”Ÿæˆ\n   */\n  generateUserNumber: (english_name: string): string => {\n    const state = useUserStore.getState();\n    const users = state.items;\n    const baseName = english_name.toLowerCase();\n\n    // æ‰€æœ‰ç¾æœ‰çš„å“¡å·¥ç·¨è™Ÿï¼ˆåŒ…æ‹¬åŒåå’Œä¸åŒåçš„ï¼‰\n    const allEmployeeNumbers = users.map(user => user.employee_number);\n\n    // å–å¾—æ‰€æœ‰æ•¸å­—ç·¨è™Ÿï¼ˆä¸é™åå­—ï¼‰\n    const allNumericNumbers = allEmployeeNumbers\n      .map(num => {\n        const match = num.match(/\\d+$/);\n        return match ? parseInt(match[0], 10) : 0;\n      })\n      .filter(num => num > 0);\n\n    // æ‰¾åˆ°å…¨å±€æœ€å¤§ç·¨è™Ÿ\n    const maxNumber = allNumericNumbers.length > 0 ? Math.max(...allNumericNumbers) : 0;\n    let nextNumber = maxNumber + 1;\n\n    // ç¢ºä¿é€™å€‹ç·¨è™Ÿä¸æœƒèˆ‡ç¾æœ‰çš„ä»»ä½•å“¡å·¥ç·¨è™Ÿè¡çª\n    let candidate = `${baseName}${nextNumber.toString().padStart(2, '0')}`;\n    while (allEmployeeNumbers.includes(candidate)) {\n      nextNumber++;\n      candidate = `${baseName}${nextNumber.toString().padStart(2, '0')}`;\n    }\n\n    console.log('ğŸ”¢ ç”¢ç”Ÿå“¡å·¥ç·¨è™Ÿ:', candidate, '(æª¢æŸ¥äº†', allEmployeeNumbers.length, 'å€‹ç¾æœ‰ç·¨è™Ÿ)');\n    return candidate;\n  },\n\n  /**\n   * æœå°‹å“¡å·¥\n   */\n  searchUsers: (searchTerm: string): User[] => {\n    const state = useUserStore.getState();\n    const users = state.items;\n    const term = searchTerm.toLowerCase();\n\n    return users.filter(user =>\n      user.employee_number.toLowerCase().includes(term) ||\n      user.english_name.toLowerCase().includes(term) ||\n      user.display_name.includes(term)\n    );\n  },\n\n  /**\n   * æŒ‰ç‹€æ…‹ç¯©é¸\n   */\n  getUsersByStatus: (status: User['status']): User[] => {\n    const state = useUserStore.getState();\n    return state.items.filter(user => user.status === status);\n  },\n\n  /**\n   * æ›´æ–°æ¬Šé™\n   */\n  updateUserPermissions: async (id: string, permissions: string[]): Promise<void> => {\n    await useUserStore.getState().update(id, { permissions } as any);\n    console.log('âœ… æ¬Šé™æ›´æ–°å®Œæˆ:', id, permissions);\n  },\n\n  /**\n   * æ›´æ–°åŸºæœ¬è–ªè³‡\n   */\n  updateBaseSalary: async (id: string, newSalary: number, reason: string): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === id);\n    if (!user) return;\n\n    const newHistory = [\n      ...user.salary_info.salary_history,\n      {\n        effective_date: new Date().toISOString().split('T')[0],\n        base_salary: newSalary,\n        reason\n      }\n    ];\n\n    await useUserStore.getState().update(id, {\n      salary_info: {\n        ...user.salary_info,\n        base_salary: newSalary,\n        salary_history: newHistory\n      }\n    } as any);\n  },\n\n  /**\n   * æ–°å¢æ´¥è²¼\n   */\n  addAllowance: async (id: string, type: string, amount: number): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === id);\n    if (!user) return;\n\n    const newAllowances = [\n      ...user.salary_info.allowances.filter((a: any) => a.type !== type),\n      { type, amount }\n    ];\n\n    await useUserStore.getState().update(id, {\n      salary_info: {\n        ...user.salary_info,\n        allowances: newAllowances\n      }\n    } as any);\n  },\n\n  /**\n   * ç§»é™¤æ´¥è²¼\n   */\n  removeAllowance: async (id: string, type: string): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === id);\n    if (!user) return;\n\n    const newAllowances = user.salary_info.allowances.filter((a: any) => a.type !== type);\n\n    await useUserStore.getState().update(id, {\n      salary_info: {\n        ...user.salary_info,\n        allowances: newAllowances\n      }\n    } as any);\n  },\n\n  /**\n   * æ–°å¢è«‹å‡è¨˜éŒ„\n   */\n  addLeaveRecord: async (id: string, leaveRecord: Omit<User['attendance']['leave_records'][0], 'id'>): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === id);\n    if (!user) return;\n\n    const newRecord = {\n      ...leaveRecord,\n      id: generateUUID()\n    };\n\n    const newLeaveRecords = [...user.attendance.leave_records, newRecord];\n\n    await useUserStore.getState().update(id, {\n      attendance: {\n        ...user.attendance,\n        leave_records: newLeaveRecords\n      }\n    } as any);\n  },\n\n  /**\n   * æ ¸å‡†è«‹å‡\n   */\n  approveLeave: async (user_id: string, leaveId: string, approved_by: string): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === user_id);\n    if (!user) return;\n\n    const updatedRecords = user.attendance.leave_records.map((record: any) =>\n      record.id === leaveId\n        ? { ...record, status: 'approved' as const, approved_by }\n        : record\n    );\n\n    await useUserStore.getState().update(user_id, {\n      attendance: {\n        ...user.attendance,\n        leave_records: updatedRecords\n      }\n    } as any);\n  },\n\n  /**\n   * æ‹’çµ•è«‹å‡\n   */\n  rejectLeave: async (user_id: string, leaveId: string): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === user_id);\n    if (!user) return;\n\n    const updatedRecords = user.attendance.leave_records.map((record: any) =>\n      record.id === leaveId\n        ? { ...record, status: 'rejected' as const }\n        : record\n    );\n\n    await useUserStore.getState().update(user_id, {\n      attendance: {\n        ...user.attendance,\n        leave_records: updatedRecords\n      }\n    } as any);\n  },\n\n  /**\n   * æ–°å¢åŠ ç­è¨˜éŒ„\n   */\n  addOvertimeRecord: async (id: string, overtimeRecord: Omit<User['attendance']['overtime_records'][0], 'id'>): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === id);\n    if (!user) return;\n\n    const newRecord = {\n      ...overtimeRecord,\n      id: generateUUID()\n    };\n\n    const newOvertimeRecords = [...user.attendance.overtime_records, newRecord];\n\n    await useUserStore.getState().update(id, {\n      attendance: {\n        ...user.attendance,\n        overtime_records: newOvertimeRecords\n      }\n    } as any);\n  },\n\n  /**\n   * æ–°å¢åˆç´„\n   */\n  addContract: async (id: string, contract: Omit<User['contracts'][0], 'id'>): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === id);\n    if (!user) return;\n\n    const newContract = {\n      ...contract,\n      id: generateUUID()\n    };\n\n    const newContracts = [...user.contracts, newContract];\n\n    await useUserStore.getState().update(id, {\n      contracts: newContracts\n    } as any);\n  },\n\n  /**\n   * æ›´æ–°åˆç´„\n   */\n  updateContract: async (user_id: string, contractId: string, updates: Partial<User['contracts'][0]>): Promise<void> => {\n    const user = useUserStore.getState().items.find((u: User) => u.id === user_id);\n    if (!user) return;\n\n    const updatedContracts = user.contracts.map((contract: any) =>\n      contract.id === contractId\n        ? { ...contract, ...updates }\n        : contract\n    );\n\n    await useUserStore.getState().update(user_id, {\n      contracts: updatedContracts\n    } as any);\n  },\n};\n\n// ç›¸å®¹æ€§ aliasï¼ˆä¿ç•™èˆŠçš„ APIï¼‰\nexport const useUserStoreCompat = () => {\n  const store = useUserStore();\n\n  return {\n    ...store,\n    users: store.items, // ç›¸å®¹æ€§ï¼šitems â†’ users\n    isLoading: store.loading, // ç›¸å®¹æ€§ï¼šloading â†’ isLoading\n    loadUsersFromDatabase: store.fetchAll, // ç›¸å®¹æ€§ï¼šfetchAll â†’ loadUsersFromDatabase\n    addUser: store.create, // ç›¸å®¹æ€§ï¼šcreate â†’ addUser\n    updateUser: store.update, // ç›¸å®¹æ€§ï¼šupdate â†’ updateUser\n    deleteUser: store.delete, // ç›¸å®¹æ€§ï¼šdelete â†’ deleteUser\n    getUser: (id: string) => store.items.find((u: User) => u.id === id), // ç›¸å®¹æ€§ï¼šæ›¿ä»£ findById\n    ...userStoreHelpers, // åŒ…å«æ‰€æœ‰è‡ªè¨‚æ–¹æ³•\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/stores/workspace-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1285,1288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1285,1288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1830,1833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1830,1833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3595,3598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3595,3598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7216,7219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7216,7219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9358,9361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9358,9361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":425,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":425,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13367,13370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13367,13370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":469,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":469,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14801,14804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14801,14804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":518,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":518,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16628,16631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16628,16631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":567,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":567,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18238,18241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18238,18241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":653,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":653,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20846,20849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20846,20849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":680,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":680,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21687,21690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21687,21690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":708,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":708,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22511,22514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22511,22514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":737,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":737,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23382,23385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23382,23385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":832,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":832,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26066,26069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26066,26069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":844,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":844,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26439,26442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26439,26442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":922,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":922,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28957,28960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28957,28960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":933,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":933,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29376,29379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29376,29379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":970,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":970,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30746,30749],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30746,30749],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":1017,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1017,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32308,32311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32308,32311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'receiptId' is defined but never used. Allowed unused args must match /^_/u.","line":1032,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":1032,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { supabase } from '@/lib/supabase/client';\nimport { v4 as uuidv4 } from 'uuid';\nimport { localDB } from '@/lib/db';\n\n\n\ninterface Workspace {\n  id: string;\n  name: string;\n  description?: string;\n  icon?: string;\n  is_active: boolean;\n  created_by?: string;\n  created_at?: string;\n  updated_at?: string;\n}\n\ninterface Bulletin {\n  id: string;\n  workspace_id: string;\n  title: string;\n  content: string;\n  type: 'announcement' | 'notice' | 'event';\n  priority: number;\n  is_pinned: boolean;\n  author_id: string;\n  created_at: string;\n  updated_at: string;\n  author?: {\n    display_name: string;\n    english_name: string;\n  };\n}\n\nexport interface Channel {\n  id: string;\n  workspace_id: string;\n  name: string;\n  description?: string;\n  type: 'public' | 'private' | 'direct';\n  created_by?: string;\n  created_at: string;\n  is_favorite?: boolean;\n  group_id?: string;\n  tour_id?: string;\n}\n\nexport interface ChannelGroup {\n  id: string;\n  workspace_id: string;\n  name: string;\n  is_collapsed: boolean;\n  order: number;\n  created_at?: string;\n}\n\nexport interface Message {\n  id: string;\n  channel_id: string;\n  author_id: string;\n  content: string;\n  reactions: Record<string, string[]>;\n  attachments?: any[];\n  created_at: string;\n  edited_at?: string;\n  is_pinned?: boolean;  // âœ¨ æ–°å¢ï¼šæ˜¯å¦ç½®é ‚\n  author?: {\n    id: string;\n    display_name: string;\n    avatar?: string;\n  };\n}\n\nexport interface PersonalCanvas {\n  id: string;\n  channelId: string;\n  name: string;\n  title?: string;  // âœ¨ æ–°å¢ï¼šæ–‡ä»¶æ¨™é¡Œ\n  type: string;\n  order: number;\n  canvas_number?: number;  // âœ¨ æ–°å¢ï¼šå·¥ä½œå€ç·¨è™Ÿ\n  created_at?: string;\n  updated_at?: string;  // âœ¨ æ–°å¢ï¼šæ›´æ–°æ™‚é–“\n}\n\nexport interface RichDocument {\n  id: string;\n  canvas_id: string;\n  title: string;\n  content: string;\n  format_data?: any;  // âœ¨ æ–°å¢ï¼šæ ¼å¼è³‡æ–™\n  tags?: string[];\n  is_favorite?: boolean;  // âœ¨ æ–°å¢ï¼šæ˜¯å¦æ”¶è—\n  created_at?: string;\n  updated_at?: string;\n}\n\nexport interface AdvanceItem {\n  id: string;\n  name: string;\n  description: string;\n  amount: number;\n  advance_person: string;\n  status: 'pending' | 'processing' | 'completed' | 'cancelled';\n  payment_request_id?: string;\n  processed_by?: string;\n  processed_at?: string;\n}\n\nexport interface AdvanceList {\n  id: string;\n  channel_id: string;\n  items: AdvanceItem[];\n  created_by: string;\n  created_at: string;\n  author?: {\n    id: string;\n    display_name: string;\n    avatar?: string;\n  };\n}\n\nexport interface SharedOrderList {\n  id: string;\n  channel_id: string;\n  orders: Array<{\n    id: string;\n    order_number: string;\n    contact_person: string;\n    total_amount: number;\n    paid_amount: number;\n    gap: number;\n    collection_rate: number;\n    invoice_status?: 'not_invoiced' | 'invoiced';\n    receipt_status?: 'not_received' | 'received';\n  }>;\n  created_by: string;\n  created_at: string;\n  author?: {\n    id: string;\n    display_name: string;\n    avatar?: string;\n  };\n}\n\ninterface WorkspaceState {\n  workspaces: Workspace[];\n  currentWorkspace: Workspace | null;\n  bulletins: Bulletin[];\n  channels: Channel[];\n  channelGroups: ChannelGroup[];\n  selectedChannel: Channel | null;  // âœ¨ æ–°å¢ï¼šç•¶å‰é¸æ“‡çš„é »é“\n  currentChannel: Channel | null;   // âœ¨ æ–°å¢ï¼šç•¶å‰é »é“ï¼ˆèˆ‡ selectedChannel åŒæ­¥ï¼‰\n  messages: Message[];\n  advanceLists: AdvanceList[];\n  sharedOrderLists: SharedOrderList[];\n  loading: boolean;\n  error: string | null;\n  searchQuery: string;\n  channelFilter: 'all' | 'starred' | 'unread' | 'muted';\n  personalCanvases: PersonalCanvas[];  // âœ¨ æ–°å¢ï¼šå€‹äºº Canvas æ–‡ä»¶\n  richDocuments: RichDocument[];  // âœ¨ æ–°å¢ï¼šå¯Œæ–‡æœ¬æ–‡ä»¶\n  createPersonalCanvas: (canvas: any) => Promise<PersonalCanvas>;  // âœ¨ æ–°å¢ï¼šå»ºç«‹å€‹äºº Canvas\n  loadRichDocuments: (canvasId?: string) => Promise<void>;  // âœ¨ æ–°å¢\n  createRichDocument: (document: Partial<RichDocument>) => Promise<void>;  // âœ¨ æ–°å¢\n  updateRichDocument: (id: string, updates: Partial<RichDocument>) => Promise<void>;  // âœ¨ æ–°å¢\n  deleteRichDocument: (id: string) => Promise<void>;  // âœ¨ æ–°å¢\n  loadPersonalCanvases: (userId?: string, workspaceId?: string) => Promise<void>;  // âœ¨ æ–°å¢\n\n  loadWorkspaces: () => Promise<void>;\n  setCurrentWorkspace: (workspace: Workspace) => void;\n\n  loadBulletins: (workspaceId?: string) => Promise<void>;\n  createBulletin: (bulletin: Omit<Bulletin, 'id' | 'created_at' | 'updated_at'>) => Promise<void>;\n  updateBulletin: (id: string, updates: Partial<Bulletin>) => Promise<void>;\n  deleteBulletin: (id: string) => Promise<void>;\n\n  loadChannels: (workspaceId?: string) => Promise<void>;\n  createChannel: (channel: Omit<Channel, 'id' | 'created_at'>) => Promise<void>;\n  updateChannel: (id: string, updates: Partial<Channel>) => Promise<void>;\n  deleteChannel: (id: string) => Promise<void>;\n  toggleChannelFavorite: (id: string) => void;\n\n  createChannelGroup: (group: Omit<ChannelGroup, 'id' | 'created_at'>) => void;\n  toggleGroupCollapse: (id: string) => void;\n\n  setSearchQuery: (query: string) => void;\n  setChannelFilter: (filter: 'all' | 'starred' | 'unread' | 'muted') => void;\n\n  selectChannel: (channel: Channel | null) => Promise<void>;  // âœ¨ æ–°å¢ï¼šåˆ‡æ›é »é“\n  loadMessages: (channelId: string) => Promise<void>;\n  sendMessage: (message: Omit<Message, 'id' | 'created_at' | 'reactions'>) => Promise<void>;\n  addMessage: (message: Omit<Message, 'id' | 'created_at' | 'reactions'>) => Promise<void>;  // âœ¨ æ–°å¢\n  updateMessage: (messageId: string, updates: Partial<Message>) => Promise<void>;  // âœ¨ æ–°å¢\n  togglePinMessage: (messageId: string) => void;  // âœ¨ æ–°å¢\n  addReaction: (messageId: string, emoji: string, userId: string) => void;  // âœ¨ æ–°å¢\n  updateMessageReactions: (messageId: string, reactions: Record<string, string[]>) => Promise<void>;\n  deleteMessage: (messageId: string) => Promise<void>;\n  softDeleteMessage: (messageId: string) => Promise<void>;\n  activeCanvasTab: string;  // âœ¨ æ–°å¢\n  setActiveCanvasTab: (tab: string) => void;  // âœ¨ æ–°å¢\n\n  shareAdvanceList: (channelId: string, items: Omit<AdvanceItem, 'id' | 'status'>[], currentUserId: string) => Promise<void>;\n  processAdvanceItem: (listId: string, itemId: string, paymentRequestId: string, processedBy: string) => Promise<void>;\n  updateAdvanceStatus: (listId: string, itemId: string, status: AdvanceItem['status']) => Promise<void>;\n  loadAdvanceLists: (channelId: string) => Promise<void>;\n  deleteAdvanceList: (listId: string) => Promise<void>;\n\n  shareOrderList: (channelId: string, orderIds: string[], currentUserId: string) => Promise<void>;\n  updateOrderReceiptStatus: (listId: string, orderId: string, receiptId: string) => Promise<void>;\n  loadSharedOrderLists: (channelId: string) => Promise<void>;\n\n  clearError: () => void;\n}\n\nexport const useWorkspaceStore = create<WorkspaceState>()(\n  persist(\n    (set, get) => ({\n      workspaces: [],\n      currentWorkspace: null,\n      bulletins: [],\n      channels: [],\n      channelGroups: [],\n      selectedChannel: null,  // âœ¨ æ–°å¢\n      currentChannel: null,   // âœ¨ æ–°å¢\n      messages: [],\n      advanceLists: [],\n      sharedOrderLists: [],\n      loading: false,\n      error: null,\n      searchQuery: '',\n      channelFilter: 'all',\n      personalCanvases: [],  // âœ¨ æ–°å¢åˆå§‹å€¼\n      richDocuments: [],  // âœ¨ æ–°å¢åˆå§‹å€¼\n      activeCanvasTab: 'canvas',  // âœ¨ æ–°å¢åˆå§‹å€¼\n      createPersonalCanvas: async (canvas: any) => {\n        // âœ¨ æ–°å¢ï¼šæš«æ™‚å¯¦ä½œï¼ˆå¾…å®Œæ•´å¯¦ä½œï¼‰\n        const newCanvas: PersonalCanvas = { ...canvas, id: Date.now().toString() };\n        set((state) => ({\n          personalCanvases: [...state.personalCanvases, newCanvas]\n        }));\n        return newCanvas;\n      },\n      loadRichDocuments: async (canvasId?: string) => {\n        // âœ¨ æ–°å¢ï¼šæš«æ™‚å¯¦ä½œï¼ˆå¾…å®Œæ•´å¯¦ä½œï¼‰\n        console.log('loadRichDocuments stub', canvasId);\n      },\n      createRichDocument: async (document: Partial<RichDocument>) => {\n        // âœ¨ æ–°å¢ï¼šæš«æ™‚å¯¦ä½œï¼ˆå¾…å®Œæ•´å¯¦ä½œï¼‰\n        const newDoc: RichDocument = {\n          id: Date.now().toString(),\n          canvas_id: document.canvas_id || '',\n          title: document.title || 'Untitled',\n          content: document.content || '',\n          tags: document.tags || [],\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString(),\n        };\n        set((state) => ({\n          richDocuments: [...state.richDocuments, newDoc]\n        }));\n      },\n      updateRichDocument: async (id: string, updates: Partial<RichDocument>) => {\n        // âœ¨ æ–°å¢ï¼šæš«æ™‚å¯¦ä½œï¼ˆå¾…å®Œæ•´å¯¦ä½œï¼‰\n        set((state) => ({\n          richDocuments: state.richDocuments.map(doc =>\n            doc.id === id ? { ...doc, ...updates, updated_at: new Date().toISOString() } : doc\n          )\n        }));\n      },\n      deleteRichDocument: async (id: string) => {\n        // âœ¨ æ–°å¢ï¼šæš«æ™‚å¯¦ä½œï¼ˆå¾…å®Œæ•´å¯¦ä½œï¼‰\n        set((state) => ({\n          richDocuments: state.richDocuments.filter(doc => doc.id !== id)\n        }));\n      },\n      loadPersonalCanvases: async (userId?: string, workspaceId?: string) => {\n        // âœ¨ æ–°å¢ï¼šæš«æ™‚å¯¦ä½œï¼ˆå¾…å®Œæ•´å¯¦ä½œï¼‰\n        console.log('loadPersonalCanvases stub', userId, workspaceId);\n      },\n      setActiveCanvasTab: (tab: string) => {\n        // âœ¨ æ–°å¢ï¼šè¨­å®šæ´»å‹• Canvas æ¨™ç±¤\n        set({ activeCanvasTab: tab });\n      },\n\n      loadWorkspaces: async () => {\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        set({ loading: true });\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¾ Supabase è¼‰å…¥\n            const { data, error } = await (supabase as any)\n              .from('workspaces')\n              .select('*')\n              .eq('is_active', true)\n              .order('created_at', { ascending: true });\n\n            if (error) throw error;\n\n            console.log('âœ… å¾ Supabase è¼‰å…¥å·¥ä½œç©ºé–“:', data);\n\n            set({\n              workspaces: data || [],\n              currentWorkspace: data?.[0] || null,\n              loading: false\n            });\n          } else {\n            // ğŸ“´ é›¢ç·šï¼šä½¿ç”¨æœ¬åœ°é è¨­å€¼\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šä½¿ç”¨æœ¬åœ°å·¥ä½œç©ºé–“');\n            const data: Workspace[] = [\n              {\n                id: 'workspace-001',\n                name: 'ç¸½éƒ¨è¾¦å…¬å®¤',\n                description: 'Venturo ç¸½éƒ¨å·¥ä½œç©ºé–“',\n                icon: 'ğŸ¢',\n                is_active: true,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n              }\n            ];\n\n            set({\n              workspaces: data,\n              currentWorkspace: data[0] || null,\n              loading: false\n            });\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¼‰å…¥å·¥ä½œç©ºé–“å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°é è¨­å€¼:', error);\n          // é™ç´šåˆ°æœ¬åœ°é è¨­å€¼\n          const data: Workspace[] = [\n            {\n              id: 'workspace-001',\n              name: 'ç¸½éƒ¨è¾¦å…¬å®¤',\n              description: 'Venturo ç¸½éƒ¨å·¥ä½œç©ºé–“',\n              icon: 'ğŸ¢',\n              is_active: true,\n              created_at: new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            }\n          ];\n\n          set({\n            workspaces: data,\n            currentWorkspace: data[0] || null,\n            loading: false\n          });\n        }\n      },\n\n      setCurrentWorkspace: (workspace) => set({ currentWorkspace: workspace }),\n\n      loadBulletins: async (workspaceId) => {\n        const currentWorkspaceId = workspaceId || get().currentWorkspace?.id;\n        if (!currentWorkspaceId) {\n          set({ loading: false });\n          return;\n        }\n\n        set({ loading: true });\n        await new Promise(resolve => setTimeout(resolve, 100));\n\n\n        const allBulletins = get().bulletins;\n        const filtered = allBulletins.filter(b => b.workspace_id === currentWorkspaceId);\n\n        set({ bulletins: filtered, loading: false });\n      },\n\n      createBulletin: async (bulletin) => {\n        const newBulletin: Bulletin = {\n          ...bulletin,\n          id: uuidv4(),\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        };\n\n        set(state => ({\n          bulletins: [...state.bulletins, newBulletin]\n        }));\n      },\n\n      updateBulletin: async (id, updates) => {\n        set(state => ({\n          bulletins: state.bulletins.map(b =>\n            b.id === id ? { ...b, ...updates, updated_at: new Date().toISOString() } : b\n          )\n        }));\n      },\n\n      deleteBulletin: async (id) => {\n        set(state => ({\n          bulletins: state.bulletins.filter(b => b.id !== id)\n        }));\n      },\n\n      loadChannels: async (workspaceId) => {\n        const currentWorkspaceId = workspaceId || get().currentWorkspace?.id;\n        if (!currentWorkspaceId) {\n          set({ loading: false });\n          return;\n        }\n\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          // âœ¨ 1. ç«‹å³å¾ IndexedDB å¿«å–è®€å–ï¼ˆå¿«ï¼ï¼‰\n          console.log('ğŸ’¾ [channels] å¾ IndexedDB å¿«é€Ÿè¼‰å…¥...');\n          const cachedChannels = (await localDB.getAll('channels') as Channel[])\n            .filter(ch => ch.workspace_id === currentWorkspaceId);\n\n          // ç«‹å³æ›´æ–° UIï¼ˆä¸ç­‰ Supabaseï¼‰\n          set({ channels: cachedChannels, loading: false });\n          console.log(`âœ… [channels] IndexedDB å¿«é€Ÿè¼‰å…¥å®Œæˆ: ${cachedChannels.length} ç­†`);\n\n          // âœ¨ 2. èƒŒæ™¯å¾ Supabase åŒæ­¥ï¼ˆä¸é˜»å¡ UIï¼‰\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            setTimeout(async () => {\n              try {\n                console.log('â˜ï¸ [channels] èƒŒæ™¯åŒæ­¥ Supabase...');\n                const { data, error } = await (supabase as any)\n                  .from('channels')\n                  .select('*')\n                  .eq('workspace_id', currentWorkspaceId)\n                  .order('created_at', { ascending: true });\n\n                if (error) {\n                  console.warn('âš ï¸ [channels] Supabase åŒæ­¥å¤±æ•—ï¼Œç¹¼çºŒä½¿ç”¨å¿«å–è³‡æ–™');\n                  return;\n                }\n\n                const freshChannels = data || [];\n                console.log(`âœ… [channels] Supabase åŒæ­¥æˆåŠŸ: ${freshChannels.length} ç­†`);\n\n                // æ‰¹æ¬¡å­˜å…¥ IndexedDB\n                for (const channel of freshChannels) {\n                  await localDB.put('channels', channel);\n                }\n\n                // éœé»˜æ›´æ–° UI\n                set({ channels: freshChannels });\n              } catch (syncError) {\n                console.warn('âš ï¸ [channels] èƒŒæ™¯åŒæ­¥å¤±æ•—:', syncError);\n              }\n            }, 0);\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¼‰å…¥é »é“å¤±æ•—:', error);\n          set({ loading: false });\n        }\n      },\n\n      createChannel: async (channel) => {\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        const newChannel: Channel = {\n          ...channel,\n          id: uuidv4(),\n          created_at: new Date().toISOString()\n        };\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¯«å…¥ Supabase\n            const { error } = await (supabase as any)\n              .from('channels')\n              .insert({\n                id: newChannel.id,\n                workspace_id: newChannel.workspace_id,\n                name: newChannel.name,\n                description: newChannel.description,\n                type: newChannel.type,\n                group_id: newChannel.group_id,\n                tour_id: newChannel.tour_id,\n                is_favorite: newChannel.is_favorite || false,\n                created_by: newChannel.created_by,\n                created_at: newChannel.created_at\n              });\n\n            if (error) throw error;\n            console.log('âœ… é »é“å·²åŒæ­¥åˆ° Supabase');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šé »é“åƒ…å„²å­˜åˆ°æœ¬åœ°');\n          }\n        } catch (error) {\n          console.log('âš ï¸ é »é“åŒæ­¥å¤±æ•—ï¼Œåƒ…å„²å­˜åˆ°æœ¬åœ°:', error);\n        }\n\n        // âœ¨ åŒæ™‚å¯«å…¥ IndexedDB å’Œ state\n        await localDB.put('channels', newChannel);\n        set(state => ({\n          channels: [...state.channels, newChannel]\n        }));\n      },\n\n      loadMessages: async (channelId) => {\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          // âœ¨ 1. ç«‹å³å¾ IndexedDB å¿«å–è®€å–ï¼ˆå¿«ï¼ï¼‰\n          console.log('ğŸ’¾ [messages] å¾ IndexedDB å¿«é€Ÿè¼‰å…¥...');\n          const cachedMessages = (await localDB.getAll('messages') as Message[])\n            .filter(m => m.channel_id === channelId);\n\n          // ç«‹å³æ›´æ–° UIï¼ˆä¸ç­‰ Supabaseï¼‰\n          set({ messages: cachedMessages });\n          console.log(`âœ… [messages] IndexedDB å¿«é€Ÿè¼‰å…¥å®Œæˆ: ${cachedMessages.length} ç­†`);\n\n          // âœ¨ 2. èƒŒæ™¯å¾ Supabase åŒæ­¥ï¼ˆä¸é˜»å¡ UIï¼‰\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            setTimeout(async () => {\n              try {\n                console.log('â˜ï¸ [messages] èƒŒæ™¯åŒæ­¥ Supabase...');\n                const { data, error } = await (supabase as any)\n                  .from('messages')\n                  .select(`\n                    *,\n                    author:employees!author_id(id, display_name, avatar)\n                  `)\n                  .eq('channel_id', channelId)\n                  .order('created_at', { ascending: true });\n\n                if (error) {\n                  console.warn('âš ï¸ [messages] Supabase åŒæ­¥å¤±æ•—ï¼Œç¹¼çºŒä½¿ç”¨å¿«å–è³‡æ–™');\n                  return;\n                }\n\n                const freshMessages = data || [];\n                console.log(`âœ… [messages] Supabase åŒæ­¥æˆåŠŸ: ${freshMessages.length} ç­†`);\n\n                // æ‰¹æ¬¡å­˜å…¥ IndexedDB\n                for (const message of freshMessages) {\n                  await localDB.put('messages', message);\n                }\n\n                // éœé»˜æ›´æ–° UI\n                set({ messages: freshMessages });\n              } catch (syncError) {\n                console.warn('âš ï¸ [messages] èƒŒæ™¯åŒæ­¥å¤±æ•—:', syncError);\n              }\n            }, 0);\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¼‰å…¥è¨Šæ¯å¤±æ•—:', error);\n        }\n      },\n\n      sendMessage: async (message) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        const newMessage: Message = {\n          ...message,\n          id: uuidv4(),\n          reactions: {},\n          created_at: new Date().toISOString(),\n          author: message.author\n        };\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¯«å…¥ Supabase\n            const { error } = await (supabase as any)\n              .from('messages')\n              .insert({\n                id: newMessage.id,\n                channel_id: newMessage.channel_id,\n                author_id: newMessage.author_id,\n                content: newMessage.content,\n                reactions: newMessage.reactions,\n                attachments: newMessage.attachments || [],\n                created_at: newMessage.created_at\n              });\n\n            if (error) throw error;\n\n            console.log('âœ… è¨Šæ¯å·²åŒæ­¥åˆ° Supabase');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šè¨Šæ¯åƒ…å„²å­˜åˆ°æœ¬åœ°');\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¨Šæ¯åŒæ­¥å¤±æ•—ï¼Œåƒ…å„²å­˜åˆ°æœ¬åœ°:', error);\n        }\n\n        // âœ¨ åŒæ™‚å¯«å…¥ IndexedDB å’Œ state\n        await localDB.put('messages', newMessage);\n        set(state => ({\n          messages: [...state.messages, newMessage]\n        }));\n      },\n\n      addMessage: async (message) => {\n        // âœ¨ æ–°å¢ï¼šåˆ¥åæ–¹æ³•ï¼ŒæŒ‡å‘ sendMessage\n        return get().sendMessage(message);\n      },\n\n      updateMessage: async (messageId, updates) => {\n        // âœ¨ æ–°å¢ï¼šæ›´æ–°è¨Šæ¯\n        set(state => ({\n          messages: state.messages.map(m =>\n            m.id === messageId ? { ...m, ...updates } : m\n          )\n        }));\n      },\n\n      togglePinMessage: (messageId) => {\n        // âœ¨ æ–°å¢ï¼šåˆ‡æ›è¨Šæ¯ç½®é ‚\n        set(state => ({\n          messages: state.messages.map(m =>\n            m.id === messageId ? { ...m, is_pinned: !m.is_pinned } : m\n          )\n        }));\n      },\n\n      addReaction: (messageId, emoji, userId) => {\n        // âœ¨ æ–°å¢ï¼šæ–°å¢åæ‡‰\n        set(state => ({\n          messages: state.messages.map(m => {\n            if (m.id === messageId) {\n              const reactions = { ...m.reactions };\n              if (!reactions[emoji]) {\n                reactions[emoji] = [];\n              }\n              if (!reactions[emoji].includes(userId)) {\n                reactions[emoji] = [...reactions[emoji], userId];\n              }\n              return { ...m, reactions };\n            }\n            return m;\n          })\n        }));\n      },\n\n      updateMessageReactions: async (messageId, reactions) => {\n        set(state => ({\n          messages: state.messages.map(m =>\n            m.id === messageId ? { ...m, reactions } : m\n          )\n        }));\n      },\n\n      deleteMessage: async (messageId) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¾ Supabase åˆªé™¤\n            const { error } = await (supabase as any)\n              .from('messages')\n              .delete()\n              .eq('id', messageId);\n\n            if (error) throw error;\n            console.log('âœ… è¨Šæ¯å·²å¾ Supabase åˆªé™¤');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šè¨Šæ¯åƒ…å¾æœ¬åœ°åˆªé™¤');\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¨Šæ¯åˆªé™¤å¤±æ•—ï¼Œåƒ…å¾æœ¬åœ°åˆªé™¤:', error);\n        }\n\n        // å¾æœ¬åœ° state ç§»é™¤\n        set((state) => ({\n          messages: state.messages.filter(m => m.id !== messageId)\n        }));\n      },\n\n      softDeleteMessage: async (messageId) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šæ›´æ–° Supabase\n            const { error } = await (supabase as any)\n              .from('messages')\n              .update({ content: 'æ­¤è¨Šæ¯å·²è¢«åˆªé™¤' })\n              .eq('id', messageId);\n\n            if (error) throw error;\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¨Šæ¯æ›´æ–°å¤±æ•—:', error);\n        }\n\n        // æ›´æ–°æœ¬åœ° state\n        set((state) => ({\n          messages: state.messages.map(m =>\n            m.id === messageId\n              ? { ...m, content: 'æ­¤è¨Šæ¯å·²è¢«åˆªé™¤' }\n              : m\n          )\n        }));\n      },\n\n      updateChannel: async (id, updates) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šæ›´æ–° Supabase\n            const { error } = await (supabase as any)\n              .from('channels')\n              .update(updates)\n              .eq('id', id);\n\n            if (error) throw error;\n            console.log('âœ… é »é“å·²æ›´æ–°åˆ° Supabase');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šé »é“åƒ…æ›´æ–°åˆ°æœ¬åœ°');\n          }\n        } catch (error) {\n          console.log('âš ï¸ é »é“æ›´æ–°å¤±æ•—ï¼Œåƒ…æ›´æ–°åˆ°æœ¬åœ°:', error);\n        }\n\n        // æ›´æ–°æœ¬åœ° state\n        set(state => ({\n          channels: state.channels.map(ch =>\n            ch.id === id ? { ...ch, ...updates } : ch\n          )\n        }));\n      },\n\n      deleteChannel: async (id) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¾ Supabase åˆªé™¤\n            const { error } = await (supabase as any)\n              .from('channels')\n              .delete()\n              .eq('id', id);\n\n            if (error) throw error;\n            console.log('âœ… é »é“å·²å¾ Supabase åˆªé™¤');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šé »é“åƒ…å¾æœ¬åœ°åˆªé™¤');\n          }\n        } catch (error) {\n          console.log('âš ï¸ é »é“åˆªé™¤å¤±æ•—ï¼Œåƒ…å¾æœ¬åœ°åˆªé™¤:', error);\n        }\n\n        // å¾æœ¬åœ° state åˆªé™¤\n        set(state => ({\n          channels: state.channels.filter(ch => ch.id !== id)\n        }));\n      },\n\n      toggleChannelFavorite: (id) => {\n        set(state => ({\n          channels: state.channels.map(ch =>\n            ch.id === id ? { ...ch, is_favorite: !ch.is_favorite } : ch\n          )\n        }));\n      },\n\n      createChannelGroup: (group) => {\n        const newGroup: ChannelGroup = {\n          ...group,\n          id: uuidv4(),\n          created_at: new Date().toISOString()\n        };\n\n        set(state => ({\n          channelGroups: [...state.channelGroups, newGroup]\n        }));\n      },\n\n      toggleGroupCollapse: (id) => {\n        set(state => ({\n          channelGroups: state.channelGroups.map(g =>\n            g.id === id ? { ...g, is_collapsed: !g.is_collapsed } : g\n          )\n        }));\n      },\n\n      setSearchQuery: (query) => set({ searchQuery: query }),\n      setChannelFilter: (filter) => set({ channelFilter: filter }),\n\n      // âœ¨ åˆ‡æ›é »é“\n      selectChannel: async (channel) => {\n        console.log('ğŸ“¢ åˆ‡æ›é »é“:', channel?.name || 'null');\n\n        // 1. æ¸…ç©ºç•¶å‰è¨Šæ¯å’Œç›¸é—œè³‡æ–™\n        set({\n          selectedChannel: channel,\n          currentChannel: channel,\n          messages: [],\n          advanceLists: [],\n          sharedOrderLists: []\n        });\n\n        // 2. è¼‰å…¥æ–°é »é“çš„è³‡æ–™\n        if (channel) {\n          await get().loadMessages(channel.id);\n          await get().loadAdvanceLists(channel.id);\n          await get().loadSharedOrderLists(channel.id);\n        }\n      },\n\n      shareAdvanceList: async (channelId, items, currentUserId) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        const listId = uuidv4();\n        const advanceItems = items.map(item => ({\n          ...item,\n          id: uuidv4(),\n          status: 'pending' as const\n        }));\n\n        const newList: AdvanceList = {\n          id: listId,\n          channel_id: channelId,\n          items: advanceItems,\n          created_by: currentUserId,\n          created_at: new Date().toISOString()\n        };\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¯«å…¥ Supabase\n            // 1. å»ºç«‹ä»£å¢Šæ¸…å–®\n            const { error: listError } = await (supabase as any)\n              .from('advance_lists')\n              .insert({\n                id: listId,\n                channel_id: channelId,\n                created_by: currentUserId,\n                created_at: newList.created_at\n              });\n\n            if (listError) throw listError;\n\n            // 2. å»ºç«‹ä»£å¢Šé …ç›®\n            const { error: itemsError } = await (supabase as any)\n              .from('advance_items')\n              .insert(\n                advanceItems.map(item => ({\n                  id: item.id,\n                  advance_list_id: listId,\n                  name: item.name,\n                  description: item.description,\n                  amount: item.amount,\n                  advance_person: item.advance_person,\n                  status: item.status,\n                  created_at: newList.created_at\n                }))\n              );\n\n            if (itemsError) throw itemsError;\n            console.log('âœ… ä»£å¢Šæ¸…å–®å·²åŒæ­¥åˆ° Supabase');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šä»£å¢Šæ¸…å–®åƒ…å„²å­˜åˆ°æœ¬åœ°');\n          }\n        } catch (error) {\n          console.log('âš ï¸ ä»£å¢Šæ¸…å–®åŒæ­¥å¤±æ•—ï¼Œåƒ…å„²å­˜åˆ°æœ¬åœ°:', error);\n        }\n\n        // æ›´æ–°æœ¬åœ° state\n        set(state => ({\n          advanceLists: [...state.advanceLists, newList]\n        }));\n      },\n\n      processAdvanceItem: async (listId, itemId, paymentRequestId, processedBy) => {\n        set(state => ({\n          advanceLists: state.advanceLists.map(list =>\n            list.id === listId\n              ? {\n                  ...list,\n                  items: list.items.map(item =>\n                    item.id === itemId\n                      ? {\n                          ...item,\n                          status: 'completed' as const,\n                          payment_request_id: paymentRequestId,\n                          processed_by: processedBy,\n                          processed_at: new Date().toISOString()\n                        }\n                      : item\n                  )\n                }\n              : list\n          )\n        }));\n      },\n\n      updateAdvanceStatus: async (listId, itemId, status) => {\n        set(state => ({\n          advanceLists: state.advanceLists.map(list =>\n            list.id === listId\n              ? {\n                  ...list,\n                  items: list.items.map(item =>\n                    item.id === itemId ? { ...item, status } : item\n                  )\n                }\n              : list\n          )\n        }));\n      },\n\n      loadAdvanceLists: async (channelId) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        set({ loading: true });\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¾ Supabase è¼‰å…¥\n            // 1. è¼‰å…¥ä»£å¢Šæ¸…å–®\n            const { data: lists, error: listsError } = await (supabase as any)\n              .from('advance_lists')\n              .select('*')\n              .eq('channel_id', channelId)\n              .order('created_at', { ascending: true });\n\n            if (listsError) throw listsError;\n\n            // 2. è¼‰å…¥æ¯å€‹æ¸…å–®çš„é …ç›®\n            const advanceLists: AdvanceList[] = [];\n            for (const list of lists || []) {\n              const { data: items, error: itemsError } = await (supabase as any)\n                .from('advance_items')\n                .select('*')\n                .eq('advance_list_id', list.id)\n                .order('created_at', { ascending: true });\n\n              if (itemsError) throw itemsError;\n\n              advanceLists.push({\n                ...list,\n                items: items || []\n              });\n            }\n\n            set({ advanceLists, loading: false });\n          } else {\n            // ğŸ“´ é›¢ç·šï¼šå¾æœ¬åœ° state è¼‰å…¥\n            const allLists = get().advanceLists;\n            const filtered = allLists.filter(list => list.channel_id === channelId);\n            set({ advanceLists: filtered, loading: false });\n          }\n        } catch (error) {\n          console.log('âš ï¸ è¼‰å…¥ä»£å¢Šæ¸…å–®å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°è³‡æ–™:', error);\n          // é™ç´šåˆ°æœ¬åœ°è³‡æ–™\n          const allLists = get().advanceLists;\n          const filtered = allLists.filter(list => list.channel_id === channelId);\n          set({ advanceLists: filtered, loading: false });\n        }\n      },\n\n      deleteAdvanceList: async (listId) => {\n        // supabase client already imported at top\n        const isOnline = typeof navigator !== 'undefined' && navigator.onLine;\n\n        try {\n          if (isOnline && process.env.NEXT_PUBLIC_ENABLE_SUPABASE === 'true') {\n            // ğŸŒ æœ‰ç¶²è·¯ï¼šå¾ Supabase åˆªé™¤ï¼ˆæœƒè‡ªå‹•åˆªé™¤é—œè¯çš„ itemsï¼Œå› ç‚ºæœ‰ ON DELETE CASCADEï¼‰\n            const { error } = await (supabase as any)\n              .from('advance_lists')\n              .delete()\n              .eq('id', listId);\n\n            if (error) throw error;\n            console.log('âœ… ä»£å¢Šæ¸…å–®å·²å¾ Supabase åˆªé™¤');\n          } else {\n            console.log('ğŸ“´ é›¢ç·šæ¨¡å¼ï¼šä»£å¢Šæ¸…å–®åƒ…å¾æœ¬åœ°åˆªé™¤');\n          }\n        } catch (error) {\n          console.log('âš ï¸ ä»£å¢Šæ¸…å–®åˆªé™¤å¤±æ•—ï¼Œåƒ…å¾æœ¬åœ°åˆªé™¤:', error);\n        }\n\n        // å¾æœ¬åœ° state åˆªé™¤\n        set(state => ({\n          advanceLists: state.advanceLists.filter(list => list.id !== listId)\n        }));\n      },\n\n      shareOrderList: async (channelId, orderIds, currentUserId) => {\n\n        const { useOrderStore } = await import('./index');\n        const allOrders = useOrderStore.getState().items;\n\n        const orders = orderIds\n          .map(orderId => {\n            const order = allOrders.find(o => o.id === orderId);\n            if (!order) return null;\n\n            const totalCost = order.total_amount || 0;\n            const collected = order.paid_amount || 0;\n            const gap = totalCost - collected;\n            const collectionRate = totalCost > 0 ? (collected / totalCost) * 100 : 0;\n\n            return {\n              id: order.id,\n              order_number: order.order_number,\n              contact_person: order.contact_person || '',\n              total_amount: totalCost,\n              paid_amount: collected,\n              gap,\n              collection_rate: collectionRate,\n              invoice_status: 'not_invoiced' as const,\n              receipt_status: 'not_received' as const\n            };\n          })\n          .filter(Boolean) as any[];\n\n        const newList: SharedOrderList = {\n          id: uuidv4(),\n          channel_id: channelId,\n          orders,\n          created_by: currentUserId,\n          created_at: new Date().toISOString()\n        };\n\n        set(state => ({\n          sharedOrderLists: [...state.sharedOrderLists, newList]\n        }));\n      },\n\n      updateOrderReceiptStatus: async (listId, orderId, receiptId) => {\n        set(state => ({\n          sharedOrderLists: state.sharedOrderLists.map(list =>\n            list.id === listId\n              ? {\n                  ...list,\n                  orders: list.orders.map(order =>\n                    order.id === orderId\n                      ? { ...order, receipt_status: 'received' as const }\n                      : order\n                  )\n                }\n              : list\n          )\n        }));\n      },\n\n      loadSharedOrderLists: async (channelId) => {\n        set({ loading: true });\n        await new Promise(resolve => setTimeout(resolve, 100));\n\n        const allLists = get().sharedOrderLists;\n        const filtered = allLists.filter(list => list.channel_id === channelId);\n\n        set({ sharedOrderLists: filtered, loading: false });\n      },\n\n      clearError: () => set({ error: null })\n    }),\n    {\n      name: 'workspace-storage',\n      partialize: (state) => ({\n        workspaces: state.workspaces,\n        currentWorkspace: state.currentWorkspace,\n        bulletins: state.bulletins,\n        channels: state.channels,\n        channelGroups: state.channelGroups,\n        selectedChannel: state.selectedChannel,  // âœ¨ è¨˜ä½æœ€å¾Œé¸æ“‡çš„é »é“\n        messages: state.messages,\n        advanceLists: state.advanceLists,\n        sharedOrderLists: state.sharedOrderLists\n      })\n    }\n  )\n);\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/accounting.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/base.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/calendar.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/common.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/customer.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/employee.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/order.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/quote.types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1170,1173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1170,1173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * å ±åƒ¹å–®ç›¸é—œå‹åˆ¥å®šç¾©\n */\n\nimport { BaseEntity } from './base.types';\n\n// ============================================\n// å ±åƒ¹å–®ä»‹é¢\n// ============================================\n\n/**\n * Quote - å ±åƒ¹å–®\n */\nexport interface Quote extends BaseEntity {\n  code: string;              // å ±åƒ¹å–®ç·¨è™Ÿ\n  customer_id?: string;      // å®¢æˆ¶ ID\n  customer_name?: string;    // å®¢æˆ¶å§“åï¼ˆå†—é¤˜æ¬„ä½ï¼‰\n  name?: string;             // å ±åƒ¹å–®åç¨±\n  destination: string;       // ç›®çš„åœ°\n  start_date: string;        // å‡ºç™¼æ—¥æœŸ (ISO 8601)\n  end_date: string;          // çµæŸæ—¥æœŸ (ISO 8601)\n  days: number;              // å¤©æ•¸\n  nights: number;            // å¤œæ•¸\n  number_of_people: number;  // äººæ•¸\n  group_size?: number;       // åœ˜é«”äººæ•¸ï¼ˆèˆ‡ number_of_people åŒç¾©ï¼Œä¿ç•™å‘å¾Œç›¸å®¹ï¼‰\n  accommodation_days?: number; // ä½å®¿å¤©æ•¸\n  status: QuoteStatus;       // å ±åƒ¹ç‹€æ…‹\n  total_amount: number;      // ç¸½é‡‘é¡\n  version: number;           // ç‰ˆæœ¬è™Ÿ\n  valid_until?: string;      // æœ‰æ•ˆæœŸé™ (ISO 8601)\n  notes?: string;            // å‚™è¨»\n  is_active: boolean;        // æ˜¯å¦å•Ÿç”¨\n  created_by?: string;       // å»ºç«‹äºº ID\n  created_by_name?: string;  // å»ºç«‹äººå§“åï¼ˆå†—é¤˜æ¬„ä½ï¼‰\n  converted_to_tour?: boolean; // æ˜¯å¦å·²è½‰æˆæ—…éŠåœ˜\n  tour_id?: string;          // è½‰æ›å¾Œçš„æ—…éŠåœ˜ ID\n\n  // æ“´å±•æ¬„ä½ï¼ˆç”¨æ–¼è©³ç´°é ï¼‰\n  categories?: any[];        // å ±åƒ¹åˆ†é¡ï¼ˆå‰ç«¯ä½¿ç”¨çš„è¤‡é›œçµæ§‹ï¼‰\n  versions?: QuoteVersion[]; // æ­·å²ç‰ˆæœ¬\n}\n\n/**\n * QuoteVersion - å ±åƒ¹ç‰ˆæœ¬\n */\nexport interface QuoteVersion extends BaseEntity {\n  quote_id: string;          // å ±åƒ¹å–® ID\n  version: number;           // ç‰ˆæœ¬è™Ÿ\n  total_amount: number;      // ç¸½é‡‘é¡\n  changes?: string;          // è®Šæ›´èªªæ˜\n  note?: string;             // å‚™è¨»èªªæ˜\n  created_by?: string;       // å»ºç«‹äºº ID\n  created_by_name?: string;  // å»ºç«‹äººå§“å\n  snapshot?: string;         // å¿«ç…§è³‡æ–™ï¼ˆJSON æ ¼å¼ï¼‰\n}\n\n/**\n * QuoteCategory - å ±åƒ¹åˆ†é¡\n */\nexport interface QuoteCategory extends BaseEntity {\n  quote_id: string;          // å ±åƒ¹å–® ID\n  name: string;              // åˆ†é¡åç¨±\n  order: number;             // æ’åº\n  is_active: boolean;        // æ˜¯å¦å•Ÿç”¨\n}\n\n/**\n * QuoteItem - å ±åƒ¹é …ç›®\n */\nexport interface QuoteItem extends BaseEntity {\n  quote_id: string;          // å ±åƒ¹å–® ID\n  category_id?: string;      // åˆ†é¡ ID\n  category_name?: string;    // åˆ†é¡åç¨±ï¼ˆå†—é¤˜æ¬„ä½ï¼‰\n  type: QuoteItemType;       // é …ç›®é¡å‹\n  name: string;              // é …ç›®åç¨±\n  description?: string;      // èªªæ˜\n  quantity: number;          // æ•¸é‡\n  unit_price: number;        // å–®åƒ¹\n  total_price: number;       // ç¸½åƒ¹\n  order: number;             // æ’åº\n  notes?: string;            // å‚™è¨»\n  is_optional: boolean;      // æ˜¯å¦ç‚ºé¸é…\n  is_active: boolean;        // æ˜¯å¦å•Ÿç”¨\n}\n\n// ============================================\n// å ±åƒ¹å–®ç‹€æ…‹èˆ‡é¡å‹\n// ============================================\n\n/**\n * QuoteStatus - å ±åƒ¹ç‹€æ…‹\n */\nexport type QuoteStatus =\n  | 'draft'      // è‰ç¨¿\n  | 'sent'       // å·²å¯„å‡º\n  | 'accepted'   // å·²æ¥å—\n  | 'rejected'   // å·²æ‹’çµ•\n  | 'expired'    // å·²éæœŸ\n  | 'converted'; // å·²è½‰å–®\n\n/**\n * QuoteItemType - å ±åƒ¹é …ç›®é¡å‹\n */\nexport type QuoteItemType =\n  | 'accommodation'  // ä½å®¿\n  | 'transportation' // äº¤é€š\n  | 'meals'          // é¤é£Ÿ\n  | 'tickets'        // é–€ç¥¨\n  | 'insurance'      // ä¿éšª\n  | 'guide'          // å°éŠ\n  | 'visa'           // ç°½è­‰\n  | 'shopping'       // è³¼ç‰©\n  | 'activity'       // æ´»å‹•\n  | 'other';         // å…¶ä»–\n\n// ============================================\n// å ±åƒ¹å–®å»ºç«‹èˆ‡æ›´æ–°\n// ============================================\n\n/**\n * CreateQuoteData - å»ºç«‹å ±åƒ¹å–®\n */\nexport interface CreateQuoteData {\n  code: string;\n  customer_id?: string;\n  customer_name?: string;\n  destination: string;\n  start_date: string;\n  end_date: string;\n  days: number;\n  nights: number;\n  number_of_people: number;\n  status: QuoteStatus;\n  total_amount: number;\n  valid_until?: string;\n  notes?: string;\n  is_active: boolean;\n}\n\n/**\n * UpdateQuoteData - æ›´æ–°å ±åƒ¹å–®\n */\nexport interface UpdateQuoteData {\n  customer_id?: string;\n  customer_name?: string;\n  destination?: string;\n  start_date?: string;\n  end_date?: string;\n  days?: number;\n  nights?: number;\n  number_of_people?: number;\n  status?: QuoteStatus;\n  total_amount?: number;\n  valid_until?: string;\n  notes?: string;\n  is_active?: boolean;\n  converted_to_tour?: boolean;\n  tour_id?: string;\n}\n\n/**\n * CreateQuoteItemData - å»ºç«‹å ±åƒ¹é …ç›®\n */\nexport interface CreateQuoteItemData {\n  quote_id: string;\n  category_id?: string;\n  type: QuoteItemType;\n  name: string;\n  description?: string;\n  quantity: number;\n  unit_price: number;\n  total_price: number;\n  order: number;\n  notes?: string;\n  is_optional: boolean;\n  is_active: boolean;\n}\n\n/**\n * UpdateQuoteItemData - æ›´æ–°å ±åƒ¹é …ç›®\n */\nexport interface UpdateQuoteItemData {\n  category_id?: string;\n  type?: QuoteItemType;\n  name?: string;\n  description?: string;\n  quantity?: number;\n  unit_price?: number;\n  total_price?: number;\n  order?: number;\n  notes?: string;\n  is_optional?: boolean;\n  is_active?: boolean;\n}\n\n// ============================================\n// å ±åƒ¹å–®æŸ¥è©¢èˆ‡ç¯©é¸\n// ============================================\n\n/**\n * QuoteFilter - å ±åƒ¹å–®ç¯©é¸æ¢ä»¶\n */\nexport interface QuoteFilter {\n  customer_id?: string;\n  status?: QuoteStatus | QuoteStatus[];\n  destination?: string;\n  start_date_from?: string;\n  start_date_to?: string;\n  is_active?: boolean;\n  search_term?: string; // æœå°‹å ±åƒ¹å–®ç·¨è™Ÿã€å®¢æˆ¶å§“å\n}\n\n/**\n * QuoteListItem - å ±åƒ¹å–®åˆ—è¡¨é …ç›®ï¼ˆç²¾ç°¡ç‰ˆï¼‰\n */\nexport interface QuoteListItem {\n  id: string;\n  code: string;\n  customer_name?: string;\n  destination: string;\n  start_date: string;\n  end_date: string;\n  number_of_people: number;\n  status: QuoteStatus;\n  total_amount: number;\n  valid_until?: string;\n  converted_to_tour?: boolean;\n  created_at: string;\n}\n\n// ============================================\n// å ±åƒ¹å–®çµ±è¨ˆ\n// ============================================\n\n/**\n * QuoteStats - å ±åƒ¹å–®çµ±è¨ˆè³‡æ–™\n */\nexport interface QuoteStats {\n  total_quotes: number;\n  draft_quotes: number;\n  sent_quotes: number;\n  accepted_quotes: number;\n  rejected_quotes: number;\n  converted_quotes: number;\n  conversion_rate: number;     // è½‰æ›ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰\n  total_quoted_amount: number;\n  average_quote_amount: number;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/region.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/supplier.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/timebox.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/todo.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/tour.types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[915,918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[915,918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1013,1016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1013,1016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2254,2257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2254,2257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2660,2663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2660,2663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * æ—…éŠåœ˜ç›¸é—œå‹åˆ¥å®šç¾©\n */\n\nimport { BaseEntity } from './base.types';\n\n// ============================================\n// æ—…éŠåœ˜ä»‹é¢\n// ============================================\n\n/**\n * Tour - æ—…éŠåœ˜è³‡æ–™\n */\nexport interface Tour extends BaseEntity {\n  code: string;              // åœ˜è™Ÿï¼ˆçµ±ä¸€ä½¿ç”¨ codeï¼‰\n  name: string;              // åœ˜å\n  location: string;          // ç›®çš„åœ°ï¼ˆç›¸å®¹èˆŠæ¬„ä½ï¼šdestinationï¼‰\n  departure_date: string;    // å‡ºç™¼æ—¥æœŸ (ISO 8601)ï¼ˆç›¸å®¹èˆŠæ¬„ä½ï¼šstart_dateï¼‰\n  return_date: string;       // è¿”å›æ—¥æœŸ (ISO 8601)ï¼ˆç›¸å®¹èˆŠæ¬„ä½ï¼šend_dateï¼‰\n  status: TourStatus; // ç‹€æ…‹ï¼ˆè‹±æ–‡ï¼‰\n  price: number;             // åŸºæœ¬åƒ¹æ ¼\n  max_participants: number;  // æœ€å¤§åƒèˆ‡äººæ•¸ï¼ˆç›¸å®¹èˆŠæ¬„ä½ï¼šmax_peopleï¼‰\n  current_participants?: number; // ç•¶å‰åƒèˆ‡äººæ•¸\n  contract_status: ContractStatus; // åˆç´„ç‹€æ…‹\n  total_revenue: number;     // ç¸½æ”¶å…¥\n  total_cost: number;        // ç¸½æˆæœ¬\n  profit: number;            // åˆ©æ½¤\n  description?: string;      // åœ˜é«”èªªæ˜/æè¿°\n  archived?: boolean;        // æ˜¯å¦å·²å°å­˜\n  features?: any[];          // è¡Œç¨‹ç‰¹è‰²ï¼ˆç”¨æ–¼å±•ç¤ºé é¢ï¼‰\n  quote_id?: string;         // é—œè¯çš„å ±åƒ¹å–®ID\n  quote_cost_structure?: any[]; // å ±åƒ¹æˆæœ¬çµæ§‹å¿«ç…§\n}\n\n// ============================================\n// æ—…éŠåœ˜ç‹€æ…‹\n// ============================================\n\n/**\n * TourStatus - æ—…éŠåœ˜ç‹€æ…‹ï¼ˆè‹±æ–‡ï¼‰\n */\nexport type TourStatus =\n  | 'draft'          // ææ¡ˆéšæ®µ\n  | 'active'         // é€²è¡Œä¸­\n  | 'pending_close'  // å¾…çµæ¡ˆ\n  | 'closed'         // å·²çµæ¡ˆ\n  | 'cancelled'      // å·²å–æ¶ˆ\n  | 'special';       // ç‰¹æ®Šåœ˜\n\n/**\n * ContractStatus - åˆç´„ç‹€æ…‹ï¼ˆè‹±æ–‡ï¼‰\n */\nexport type ContractStatus =\n  | 'pending'  // æœªç°½ç½²\n  | 'partial'  // éƒ¨åˆ†ç°½ç½²\n  | 'signed';  // å·²ç°½ç½²\n\n/**\n * TourCategory - æ—…éŠåœ˜åˆ†é¡\n */\nexport type TourCategory =\n  | 'domestic'      // åœ‹å…§\n  | 'international' // åœ‹å¤–\n  | 'group'         // åœ˜é«”\n  | 'custom'        // å®¢è£½åŒ–\n  | 'cruise'        // éƒµè¼ª\n  | 'study';        // éŠå­¸\n\n// ============================================\n// æ—…éŠåœ˜å»ºç«‹èˆ‡æ›´æ–°\n// ============================================\n\n/**\n * CreateTourData - å»ºç«‹æ—…éŠåœ˜æ‰€éœ€è³‡æ–™\n */\nexport interface CreateTourData {\n  code?: string;             // å¯é¸ï¼Œç”± createStore è‡ªå‹•ç”Ÿæˆ\n  name: string;\n  location: string;\n  departure_date: string;\n  return_date: string;\n  status: TourStatus;\n  price: number;\n  max_participants: number;\n  contract_status: ContractStatus;\n  total_revenue: number;\n  total_cost: number;\n  profit: number;\n  quote_id?: string;\n  quote_cost_structure?: any[];\n}\n\n/**\n * UpdateTourData - æ›´æ–°æ—…éŠåœ˜è³‡æ–™\n */\nexport interface UpdateTourData {\n  code?: string;\n  name?: string;\n  location?: string;\n  departure_date?: string;\n  return_date?: string;\n  status?: TourStatus;\n  price?: number;\n  max_participants?: number;\n  contract_status?: ContractStatus;\n  total_revenue?: number;\n  total_cost?: number;\n  profit?: number;\n  quote_id?: string;\n  quote_cost_structure?: any[];\n}\n\n// ============================================\n// æ—…éŠåœ˜æŸ¥è©¢èˆ‡ç¯©é¸\n// ============================================\n\n/**\n * TourFilter - æ—…éŠåœ˜ç¯©é¸æ¢ä»¶\n */\nexport interface TourFilter {\n  status?: TourStatus | TourStatus[];\n  category?: TourCategory | TourCategory[];\n  destination?: string;\n  start_date_from?: string;\n  start_date_to?: string;\n  is_active?: boolean;\n  search_term?: string; // æœå°‹åœ˜è™Ÿæˆ–åœ˜å\n}\n\n/**\n * TourListItem - æ—…éŠåœ˜åˆ—è¡¨é …ç›®ï¼ˆç²¾ç°¡ç‰ˆï¼‰\n */\nexport interface TourListItem {\n  id: string;\n  code: string;\n  name: string;\n  location: string;\n  departure_date: string;\n  return_date: string;\n  status: TourStatus;\n  max_participants: number;\n  price: number;\n}\n\n// ============================================\n// æ—…éŠåœ˜çµ±è¨ˆ\n// ============================================\n\n/**\n * TourStats - æ—…éŠåœ˜çµ±è¨ˆè³‡æ–™\n */\nexport interface TourStats {\n  total_tours: number;\n  active_tours: number;\n  completed_tours: number;\n  cancelled_tours: number;\n  total_revenue: number;\n  average_price: number;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/visa.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/src/types/workspace.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/tests/e2e/indexeddb-sync-simple.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/Corner/tests/e2e/indexeddb-sync.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1067,1070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1067,1070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1512,1515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1512,1515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clearIndexedDB' is defined but never used. Allowed unused vars must match /^_/u.","line":57,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'context' is defined but never used. Allowed unused args must match /^_/u.","line":75,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2585,2588],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2585,2588],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":160,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4810,4813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4810,4813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5985,5988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5985,5988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6204,6207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6204,6207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8345,8348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8345,8348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8416,8419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8416,8419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * IndexedDB åŒæ­¥æ¸¬è©¦ - E2E è‡ªå‹•åŒ–æ¸¬è©¦\n *\n * æ¸¬è©¦ç›®æ¨™ï¼šé©—è­‰ Supabase â†” IndexedDB é›™å‘åŒæ­¥æ©Ÿåˆ¶\n * æ¸¬è©¦ç’°å¢ƒï¼šPlaywright + Chrome\n */\n\nimport { test, expect, Page } from '@playwright/test';\n\n/**\n * è¼”åŠ©å‡½æ•¸ï¼šæª¢æŸ¥ IndexedDB ä¸­çš„è³‡æ–™æ•¸é‡\n */\nasync function getIndexedDBCount(page: Page, storeName: string): Promise<number> {\n  return await page.evaluate(async (store) => {\n    const db = await new Promise<IDBDatabase>((resolve, reject) => {\n      const request = indexedDB.open('venturo-db', 1);\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    });\n\n    const transaction = db.transaction(store, 'readonly');\n    const objectStore = transaction.objectStore(store);\n\n    return await new Promise<number>((resolve, reject) => {\n      const countRequest = objectStore.count();\n      countRequest.onsuccess = () => resolve(countRequest.result);\n      countRequest.onerror = () => reject(countRequest.error);\n    });\n  }, storeName);\n}\n\n/**\n * è¼”åŠ©å‡½æ•¸ï¼šå¾ IndexedDB å–å¾—æ‰€æœ‰è³‡æ–™\n */\nasync function getAllFromIndexedDB(page: Page, storeName: string): Promise<any[]> {\n  return await page.evaluate(async (store) => {\n    const db = await new Promise<IDBDatabase>((resolve, reject) => {\n      const request = indexedDB.open('venturo-db', 1);\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    });\n\n    const transaction = db.transaction(store, 'readonly');\n    const objectStore = transaction.objectStore(store);\n\n    return await new Promise<any[]>((resolve, reject) => {\n      const getAllRequest = objectStore.getAll();\n      getAllRequest.onsuccess = () => resolve(getAllRequest.result);\n      getAllRequest.onerror = () => reject(getAllRequest.error);\n    });\n  }, storeName);\n}\n\n/**\n * è¼”åŠ©å‡½æ•¸ï¼šæ¸…ç©º IndexedDB\n */\nasync function clearIndexedDB(page: Page): Promise<void> {\n  await page.evaluate(async () => {\n    await new Promise<void>((resolve) => {\n      const request = indexedDB.deleteDatabase('venturo-db');\n      request.onsuccess = () => resolve();\n      request.onerror = () => resolve(); // å³ä½¿å¤±æ•—ä¹Ÿç¹¼çºŒ\n    });\n  });\n}\n\n/**\n * è¼”åŠ©å‡½æ•¸ï¼šç­‰å¾… IndexedDB åŒæ­¥å®Œæˆ\n */\nasync function waitForSync(page: Page, timeMs: number = 3000): Promise<void> {\n  await page.waitForTimeout(timeMs);\n}\n\ntest.describe('IndexedDB åŒæ­¥æ¸¬è©¦', () => {\n  test.beforeEach(async ({ page, context }) => {\n    // è¨ªå•æ‡‰ç”¨ç¨‹å¼ï¼ˆå¿…é ˆå…ˆè¨ªå•é é¢æ‰èƒ½ä½¿ç”¨ IndexedDBï¼‰\n    await page.goto('/');\n\n    // ç­‰å¾…é é¢è¼‰å…¥\n    await page.waitForLoadState('domcontentloaded');\n\n    // æ¸…ç©º IndexedDBï¼ˆåœ¨é é¢ context ä¸­åŸ·è¡Œï¼‰\n    await page.evaluate(async () => {\n      const databases = await (window as any).indexedDB?.databases?.();\n      if (databases) {\n        for (const db of databases) {\n          if (db.name === 'venturo-db') {\n            await new Promise<void>((resolve) => {\n              const request = indexedDB.deleteDatabase(db.name);\n              request.onsuccess = () => resolve();\n              request.onerror = () => resolve();\n            });\n          }\n        }\n      }\n    });\n\n    // é‡æ–°è¼‰å…¥é é¢ä»¥åˆå§‹åŒ– IndexedDB\n    await page.reload();\n    await page.waitForLoadState('networkidle');\n  });\n\n  test('æ¸¬è©¦ 1: åˆå§‹è®€å– â†’ IndexedDB å¿«å–', async ({ page }) => {\n    console.log('ğŸ§ª æ¸¬è©¦ 1: åˆå§‹è®€å– â†’ IndexedDB å¿«å–');\n\n    // æ¨¡æ“¬ä½¿ç”¨è€…æ“ä½œï¼šè¼‰å…¥è³‡æ–™\n    // æ³¨æ„ï¼šé€™è£¡å‡è¨­æ‡‰ç”¨ç¨‹å¼åœ¨è¼‰å…¥æ™‚æœƒè‡ªå‹• fetchAll\n    // å¦‚æœéœ€è¦é»æ“ŠæŒ‰éˆ•ï¼Œè«‹ä¿®æ”¹æ­¤è™•\n\n    // ç­‰å¾…è³‡æ–™è¼‰å…¥\n    await waitForSync(page, 5000);\n\n    // æª¢æŸ¥ IndexedDB ä¸­æ˜¯å¦æœ‰è³‡æ–™\n    const toursCount = await getIndexedDBCount(page, 'tours');\n    const ordersCount = await getIndexedDBCount(page, 'orders');\n    const quotesCount = await getIndexedDBCount(page, 'quotes');\n\n    console.log(`ğŸ“Š IndexedDB å¿«å–ç‹€æ…‹:`);\n    console.log(`  Tours: ${toursCount} ç­†`);\n    console.log(`  Orders: ${ordersCount} ç­†`);\n    console.log(`  Quotes: ${quotesCount} ç­†`);\n\n    // é©—è­‰ï¼šè‡³å°‘æ‡‰è©²æœ‰ä¸€äº›è³‡æ–™ï¼ˆå…·é«”æ•¸é‡å–æ±ºæ–¼ä½ çš„æ¸¬è©¦è³‡æ–™ï¼‰\n    expect(toursCount).toBeGreaterThanOrEqual(0);\n    expect(ordersCount).toBeGreaterThanOrEqual(0);\n    expect(quotesCount).toBeGreaterThanOrEqual(0);\n\n    console.log('âœ… æ¸¬è©¦ 1 é€šé');\n  });\n\n  test('æ¸¬è©¦ 2: å»ºç«‹è³‡æ–™ â†’ IndexedDB åŒæ­¥', async ({ page }) => {\n    console.log('ğŸ§ª æ¸¬è©¦ 2: å»ºç«‹è³‡æ–™ â†’ IndexedDB åŒæ­¥');\n\n    // å…ˆè¼‰å…¥åˆå§‹è³‡æ–™\n    await waitForSync(page, 5000);\n\n    // è¨˜éŒ„å»ºç«‹å‰çš„æ•¸é‡\n    const beforeCount = await getIndexedDBCount(page, 'tours');\n    console.log(`ğŸ“Š å»ºç«‹å‰ Tours æ•¸é‡: ${beforeCount}`);\n\n    // æ¨¡æ“¬å»ºç«‹æ–°è³‡æ–™\n    await page.evaluate(async () => {\n      const { useTourStore } = await import('@/stores');\n      const store = useTourStore.getState();\n\n      await store.create({\n        code: `E2E-TEST-${Date.now()}`,\n        name: 'E2E æ¸¬è©¦æ—…éŠåœ˜',\n        location: 'æ¸¬è©¦åœ°é»',\n        departure_date: '2025-12-01',\n        return_date: '2025-12-05',\n        status: 'ææ¡ˆ',\n        price: 50000,\n        max_participants: 20,\n        contract_status: 'æœªç°½ç½²',\n        total_revenue: 0,\n        total_cost: 0,\n        profit: 0,\n        is_active: true,\n      } as any);\n    });\n\n    // ç­‰å¾…åŒæ­¥\n    await waitForSync(page, 3000);\n\n    // æª¢æŸ¥æ•¸é‡æ˜¯å¦å¢åŠ \n    const afterCount = await getIndexedDBCount(page, 'tours');\n    console.log(`ğŸ“Š å»ºç«‹å¾Œ Tours æ•¸é‡: ${afterCount}`);\n    console.log(`è®ŠåŒ–: +${afterCount - beforeCount}`);\n\n    // é©—è­‰ï¼šæ•¸é‡æ‡‰è©²å¢åŠ  1\n    expect(afterCount).toBe(beforeCount + 1);\n\n    console.log('âœ… æ¸¬è©¦ 2 é€šé');\n  });\n\n  test('æ¸¬è©¦ 3: æ›´æ–°è³‡æ–™ â†’ IndexedDB åŒæ­¥', async ({ page }) => {\n    console.log('ğŸ§ª æ¸¬è©¦ 3: æ›´æ–°è³‡æ–™ â†’ IndexedDB åŒæ­¥');\n\n    // å…ˆè¼‰å…¥åˆå§‹è³‡æ–™\n    await waitForSync(page, 5000);\n\n    // å–å¾—ç¬¬ä¸€ç­†è³‡æ–™\n    const tours = await getAllFromIndexedDB(page, 'tours');\n\n    if (tours.length === 0) {\n      console.log('âš ï¸ æ²’æœ‰è³‡æ–™å¯ä»¥æ¸¬è©¦ï¼Œè·³éæ­¤æ¸¬è©¦');\n      test.skip();\n      return;\n    }\n\n    const firstTour = tours[0];\n    console.log(`ğŸ“Š æ›´æ–°å‰:`);\n    console.log(`  ID: ${firstTour.id}`);\n    console.log(`  ç‹€æ…‹: ${firstTour.status}`);\n    console.log(`  åƒåŠ äººæ•¸: ${firstTour.current_participants || 0}`);\n\n    // æ¨¡æ“¬æ›´æ–°è³‡æ–™\n    await page.evaluate(async (tourId) => {\n      const { useTourStore } = await import('@/stores');\n      const store = useTourStore.getState();\n\n      await store.update(tourId, {\n        status: 'é€²è¡Œä¸­',\n        current_participants: 10,\n      } as any);\n    }, firstTour.id);\n\n    // ç­‰å¾…åŒæ­¥\n    await waitForSync(page, 3000);\n\n    // æª¢æŸ¥ IndexedDB ä¸­çš„è³‡æ–™æ˜¯å¦æ›´æ–°\n    const updatedTours = await getAllFromIndexedDB(page, 'tours');\n    const updatedTour = updatedTours.find((t: any) => t.id === firstTour.id);\n\n    console.log(`ğŸ“Š æ›´æ–°å¾Œ:`);\n    console.log(`  ID: ${updatedTour.id}`);\n    console.log(`  ç‹€æ…‹: ${updatedTour.status}`);\n    console.log(`  åƒåŠ äººæ•¸: ${updatedTour.current_participants}`);\n\n    // é©—è­‰ï¼šç‹€æ…‹å’ŒåƒåŠ äººæ•¸æ‡‰è©²æ›´æ–°\n    expect(updatedTour.status).toBe('é€²è¡Œä¸­');\n    expect(updatedTour.current_participants).toBe(10);\n\n    console.log('âœ… æ¸¬è©¦ 3 é€šé');\n  });\n\n  test('æ¸¬è©¦ 4: åˆªé™¤è³‡æ–™ â†’ IndexedDB åŒæ­¥', async ({ page }) => {\n    console.log('ğŸ§ª æ¸¬è©¦ 4: åˆªé™¤è³‡æ–™ â†’ IndexedDB åŒæ­¥');\n\n    // å…ˆè¼‰å…¥åˆå§‹è³‡æ–™\n    await waitForSync(page, 5000);\n\n    // è¨˜éŒ„åˆªé™¤å‰çš„æ•¸é‡\n    const beforeCount = await getIndexedDBCount(page, 'tours');\n    console.log(`ğŸ“Š åˆªé™¤å‰ Tours æ•¸é‡: ${beforeCount}`);\n\n    if (beforeCount === 0) {\n      console.log('âš ï¸ æ²’æœ‰è³‡æ–™å¯ä»¥åˆªé™¤ï¼Œè·³éæ­¤æ¸¬è©¦');\n      test.skip();\n      return;\n    }\n\n    // å–å¾—ç¬¬ä¸€ç­†è³‡æ–™çš„ ID\n    const tours = await getAllFromIndexedDB(page, 'tours');\n    const firstTourId = tours[0].id;\n\n    // æ¨¡æ“¬åˆªé™¤è³‡æ–™\n    await page.evaluate(async (tourId) => {\n      const { useTourStore } = await import('@/stores');\n      const store = useTourStore.getState();\n\n      await store.delete(tourId);\n    }, firstTourId);\n\n    // ç­‰å¾…åŒæ­¥\n    await waitForSync(page, 3000);\n\n    // æª¢æŸ¥æ•¸é‡æ˜¯å¦æ¸›å°‘\n    const afterCount = await getIndexedDBCount(page, 'tours');\n    console.log(`ğŸ“Š åˆªé™¤å¾Œ Tours æ•¸é‡: ${afterCount}`);\n    console.log(`è®ŠåŒ–: ${afterCount - beforeCount}`);\n\n    // é©—è­‰ï¼šæ•¸é‡æ‡‰è©²æ¸›å°‘ 1\n    expect(afterCount).toBe(beforeCount - 1);\n\n    console.log('âœ… æ¸¬è©¦ 4 é€šé');\n  });\n\n  test('æ¸¬è©¦ 5: è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥', async ({ page }) => {\n    console.log('ğŸ§ª æ¸¬è©¦ 5: è³‡æ–™ä¸€è‡´æ€§æª¢æŸ¥');\n\n    // è¼‰å…¥è³‡æ–™\n    await waitForSync(page, 5000);\n\n    // å¾ Store å–å¾—è³‡æ–™\n    const storeData = await page.evaluate(async () => {\n      const { useTourStore } = await import('@/stores');\n      const store = useTourStore.getState();\n      return store.items;\n    });\n\n    // å¾ IndexedDB å–å¾—è³‡æ–™\n    const indexedDBData = await getAllFromIndexedDB(page, 'tours');\n\n    console.log(`ğŸ“Š Store è³‡æ–™æ•¸: ${storeData.length}`);\n    console.log(`ğŸ“Š IndexedDB è³‡æ–™æ•¸: ${indexedDBData.length}`);\n\n    // é©—è­‰ï¼šæ•¸é‡æ‡‰è©²ä¸€è‡´\n    expect(indexedDBData.length).toBe(storeData.length);\n\n    // é©—è­‰ï¼šID æ‡‰è©²ä¸€è‡´\n    const storeIds = new Set(storeData.map((t: any) => t.id));\n    const indexedDBIds = new Set(indexedDBData.map((t: any) => t.id));\n\n    const onlyInStore = [...storeIds].filter(id => !indexedDBIds.has(id));\n    const onlyInIndexedDB = [...indexedDBIds].filter(id => !storeIds.has(id));\n\n    if (onlyInStore.length > 0) {\n      console.log('âŒ åªåœ¨ Store:', onlyInStore);\n    }\n    if (onlyInIndexedDB.length > 0) {\n      console.log('âŒ åªåœ¨ IndexedDB:', onlyInIndexedDB);\n    }\n\n    expect(onlyInStore.length).toBe(0);\n    expect(onlyInIndexedDB.length).toBe(0);\n\n    console.log('âœ… æ¸¬è©¦ 5 é€šé - è³‡æ–™å®Œå…¨ä¸€è‡´');\n  });\n});\n","usedDeprecatedRules":[]}]