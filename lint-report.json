[{"filePath":"/Users/william/Projects/venturo-new/add_updated_by_column.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/check-all-tables-schema.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/check-db-status.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/check-employees.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/check-rls-status.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/execute-audit-fields.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/execute-rls.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/fill-workspace-data.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/fix-messages-direct.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/fix-payment-requests.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/next-env.d.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/triple-slash-reference","severity":2,"message":"Do not use a triple slash reference for ./.next/types/routes.d.ts, use `import` style instead.","line":4,"column":1,"nodeType":"Line","messageId":"tripleSlashReference","endLine":4,"endColumn":51,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/accounting/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/accounting/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/auth/sync-password/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/health/detailed/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/health/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/itineraries/[id]/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/linkpay/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/log-error/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/ocr/passport/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/api/workspaces/[workspaceId]/channels/[channelId]/members/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/calendar/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/AccommodationForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/AccommodationPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/EditorContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/FlightForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/FlightPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/ImportPNRDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/PreviewContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/components/PrintableConfirmation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/confirmations/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/contracts/[id]/create/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/contracts/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/contracts/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/[id]/tabs/BasicInfoTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/[id]/tabs/GroupHistoryTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/companies/components/CompanyFormDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/companies/components/CompanyTableColumns.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/companies/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/customers/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/database/attractions/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/database/company-assets/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/database/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/database/regions/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/database/suppliers/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/database/transportation-rates/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/esims/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/BatchCreateReceiptDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/CreateLinkPayDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/CreateReceiptDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/EditReceiptDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/LinkPayLogsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/PaymentItemForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/ReceiptSearchDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/hooks/usePaymentData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/payments/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/reports/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/requests/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/travel-invoice/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/travel-invoice/create/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/travel-invoice/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/treasury/disbursement/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/treasury/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/vouchers/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/vouchers/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/finance/vouchers/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/components/ExerciseIcons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/components/FitnessLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/history/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/settings/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/fitness/stats/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/global-error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/hr/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/itinerary/[slug]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/itinerary/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/itinerary/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/manifestation/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/manifestation/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/orders/[orderId]/documents/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/orders/[orderId]/members/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/orders/[orderId]/overview/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/orders/[orderId]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/orders/[orderId]/payment/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/orders/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/pnrs/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/quotes/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/quotes/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/reports/tour-closing/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/AccountSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/AppearanceSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/CompanyResourcesSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/ModuleManagementSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/OtherSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/PermissionManagementSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/PreferredFeaturesSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/SystemSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/WorkspaceSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/components/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/hooks/useSettingsState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/menu/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/modules/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/permissions/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/settings/workspaces/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/timebox/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/todos/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/tools/flight-itinerary/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/tools/hotel-voucher/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/tools/hotel-voucher/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/tools/reset-db/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/tours/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/tours/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/unauthorized/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/view/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/view/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/visas/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/app/workspace/page.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":29,"column":5,"severity":1,"nodeType":null,"fix":{"range":[885,940],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":44,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1357,1412],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useEffect, useState } from 'react'\nimport { ResponsiveHeader } from '@/components/layout/responsive-header'\nimport { ChannelChat } from '@/components/workspace/ChannelChat'\nimport { useWorkspaceChannels } from '@/stores/workspace-store'\nimport { useRealtimeForChannels, useRealtimeForMessages } from '@/hooks/use-realtime-hooks'\n\nexport default function WorkspacePage() {\n  // âœ… Realtime è¨‚é–±\n  useRealtimeForChannels()\n  useRealtimeForMessages()\n\n  const { loadWorkspaces, loadChannelGroups, loadChannels, currentWorkspace } =\n    useWorkspaceChannels()\n  const [hasLoaded, setHasLoaded] = useState(false)\n\n  // ğŸ”¥ Step 1: è¼‰å…¥ workspacesï¼ˆåªåŸ·è¡Œä¸€æ¬¡ï¼‰\n  useEffect(() => {\n    if (hasLoaded) return\n\n    const init = async () => {\n      logger.log('ğŸ”µ [WorkspacePage] è¼‰å…¥å·¥ä½œç©ºé–“')\n      await loadWorkspaces()\n    }\n\n    init()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // ğŸ”¥ Step 2: ç•¶ workspace è¼‰å…¥å¾Œï¼Œè¼‰å…¥ channels å’Œ groupsï¼ˆåªåŸ·è¡Œä¸€æ¬¡ï¼‰\n  useEffect(() => {\n    if (hasLoaded || !currentWorkspace) return\n\n    const loadData = async () => {\n      logger.log('ğŸ”µ [WorkspacePage] è¼‰å…¥é »é“å’Œç¾¤çµ„')\n      await Promise.all([loadChannelGroups(currentWorkspace.id), loadChannels(currentWorkspace.id)])\n      setHasLoaded(true)\n      logger.log('âœ… [WorkspacePage] åˆå§‹åŒ–å®Œæˆ')\n    }\n\n    loadData()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentWorkspace?.id])\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"å·¥ä½œç©ºé–“\"\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'å·¥ä½œç©ºé–“', href: '/workspace' },\n        ]}\n      />\n\n      <div className=\"flex-1 overflow-hidden\">\n        <ChannelChat />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/AppInitializer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ErrorLogger.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-unreachable').","line":8,"column":5,"severity":1,"nodeType":null,"fix":{"range":[129,164],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { useEffect } from 'react'\n\nexport function ErrorLogger() {\n  useEffect(() => {\n    // ğŸ”¥ æš«æ™‚ç¦ç”¨ä»¥æŸ¥çœ‹å®Œæ•´éŒ¯èª¤è¨Šæ¯\n    /* eslint-disable no-unreachable */\n    return undefined\n\n    // æ•ç²æœªè™•ç†çš„éŒ¯èª¤\n    const handleError = (event: ErrorEvent) => {\n      console.error('Global error:', event.error)\n      const errorData = {\n        message: event.message,\n        source: event.filename,\n        lineno: event.lineno,\n        colno: event.colno,\n        error: event.error?.stack || event.error?.toString(),\n        timestamp: new Date().toISOString(),\n        type: 'error',\n      }\n\n      // å°‡éŒ¯èª¤å¯«å…¥æ–‡ä»¶ç³»çµ±\n      fetch('/api/log-error', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(errorData),\n      }).catch(console.error)\n    }\n\n    // æ•ç²æœªè™•ç†çš„ Promise rejection\n    const handleRejection = (event: PromiseRejectionEvent) => {\n      console.error('Unhandled promise rejection:', event.reason)\n      const errorData = {\n        message: 'Unhandled Promise Rejection',\n        error: event.reason?.stack || event.reason?.toString() || String(event.reason),\n        timestamp: new Date().toISOString(),\n        type: 'unhandledRejection',\n      }\n\n      fetch('/api/log-error', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(errorData),\n      }).catch(console.error)\n    }\n\n    // æ•ç² React Hydration éŒ¯èª¤\n    const originalConsoleError = console.error\n    let isLoggingError = false // é˜²æ­¢ç„¡é™å¾ªç’°çš„æ¨™èªŒ\n\n    console.error = function (...args) {\n      // å¦‚æœæ­£åœ¨è¨˜éŒ„éŒ¯èª¤ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹ console.error ä¸¦è¿”å›\n      if (isLoggingError) {\n        originalConsoleError.apply(console, args)\n        return\n      }\n\n      // å…ˆè¼¸å‡ºåˆ°åŸå§‹çš„ console.error\n      try {\n        originalConsoleError.apply(console, args)\n      } catch (err) {\n        // å¦‚æœè¼¸å‡ºå¤±æ•—ï¼Œéœé»˜è™•ç†\n      }\n\n      // é¿å…åœ¨ ErrorLogger å…§éƒ¨å†æ¬¡è§¸ç™¼éŒ¯èª¤æ—¥èªŒ\n      try {\n        isLoggingError = true\n\n        const errorString = args\n          .map(arg => {\n            try {\n              return typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)\n            } catch {\n              return String(arg)\n            }\n          })\n          .join(' ')\n\n        if (\n          errorString.includes('Hydration') ||\n          errorString.includes('Text content does not match') ||\n          errorString.includes('did not match')\n        ) {\n          const errorData = {\n            message: 'Hydration Error',\n            error: errorString,\n            timestamp: new Date().toISOString(),\n            type: 'hydration',\n          }\n\n          fetch('/api/log-error', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(errorData),\n          }).catch(() => {\n            // ä½¿ç”¨åŸå§‹çš„ console.errorï¼Œé¿å…éè¿´\n            originalConsoleError('Failed to log error to API')\n          })\n        }\n      } catch (err) {\n        // å¦‚æœæ—¥èªŒè¨˜éŒ„æœ¬èº«å‡ºéŒ¯ï¼Œä½¿ç”¨åŸå§‹çš„ console.error\n        originalConsoleError('ErrorLogger internal error:', err)\n      } finally {\n        // é‡ç½®æ¨™èªŒï¼Œå…è¨±ä¸‹æ¬¡è¨˜éŒ„\n        isLoggingError = false\n      }\n    }\n\n    window.addEventListener('error', handleError)\n    window.addEventListener('unhandledrejection', handleRejection)\n\n    return () => {\n      window.removeEventListener('error', handleError)\n      window.removeEventListener('unhandledrejection', handleRejection)\n      console.error = originalConsoleError\n    }\n    /* eslint-enable no-unreachable */\n  }, [])\n\n  return null\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/PermanentRealtimeSubscriptions.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":184,"column":5,"severity":1,"nodeType":null,"fix":{"range":[5302,5357],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * æ°¸ä¹… Realtime è¨‚é–±çµ„ä»¶\n *\n * é€™äº›è¡¨æ ¼éœ€è¦åœ¨æ•´å€‹æ‡‰ç”¨ç¨‹å¼ç”Ÿå‘½é€±æœŸä¸­ä¿æŒè¨‚é–±ï¼š\n * - user_roles: ä½¿ç”¨è€…æ¬Šé™ï¼ˆç®¡ç†å“¡è®Šæ›´æ¬Šé™æ™‚ç«‹å³ç”Ÿæ•ˆï¼‰\n * - workspaces: å·¥ä½œç©ºé–“è¨­å®š\n * - employees: å“¡å·¥è³‡æ–™ï¼ˆå¸¸ç”¨æ–¼ä¸‹æ‹‰é¸å–®ï¼‰\n *\n * âš ï¸ æ³¨æ„ï¼šåªæœ‰åœ¨ä½¿ç”¨è€…å·²ç™»å…¥æ™‚æ‰è¨‚é–±\n */\n\n'use client'\n\nimport { useEffect } from 'react'\nimport { useAuthStore } from '@/stores/auth-store'\nimport { useEmployeeStore } from '@/stores'\nimport { realtimeManager } from '@/lib/realtime/realtime-manager'\nimport { logger } from '@/lib/utils/logger'\nimport { useToast } from '@/components/ui/use-toast'\n\ninterface UserRole {\n  id: string\n  user_id: string\n  role: string\n  permissions: string[]\n  updated_at: string\n  [key: string]: unknown\n}\n\ninterface Workspace {\n  id: string\n  name: string\n  owner_id: string\n  updated_at: string\n  [key: string]: unknown\n}\n\ninterface Employee {\n  id: string\n  created_at: string\n  updated_at: string\n  [key: string]: unknown\n}\n\nexport function PermanentRealtimeSubscriptions() {\n  const user = useAuthStore(state => state.user)\n  const { toast } = useToast()\n\n  useEffect(() => {\n    // åªæœ‰åœ¨ä½¿ç”¨è€…å·²ç™»å…¥æ™‚æ‰è¨‚é–±\n    if (!user) {\n      logger.log('â­ï¸ [PermanentRealtimeSubscriptions] ä½¿ç”¨è€…æœªç™»å…¥ï¼Œè·³éè¨‚é–±')\n      return\n    }\n\n    logger.log('ğŸ”” [PermanentRealtimeSubscriptions] é–‹å§‹æ°¸ä¹…è¨‚é–±...')\n\n    // 1. è¨‚é–±ä½¿ç”¨è€…æ¬Šé™ï¼ˆæ°¸ä¹…ï¼‰\n    const userRoleSubscriptionId = `user-role-${user.id}`\n    realtimeManager.subscribe<UserRole>({\n      table: 'user_roles',\n      filter: `user_id=eq.${user.id}`,\n      subscriptionId: userRoleSubscriptionId,\n      handlers: {\n        onUpdate: newRole => {\n          logger.log('ğŸ”” [user_roles] æ¬Šé™å·²æ›´æ–°:', newRole)\n\n          // é€šçŸ¥ä½¿ç”¨è€…\n          toast({\n            title: 'ä½ çš„æ¬Šé™å·²æ›´æ–°ï¼',\n            description: 'è«‹é‡æ–°æ•´ç†é é¢ä»¥å¥—ç”¨æ–°æ¬Šé™ã€‚',\n          })\n\n          // 2 ç§’å¾Œè‡ªå‹•é‡æ–°æ•´ç†\n          setTimeout(() => {\n            window.location.reload()\n          }, 2000)\n        },\n        onInsert: newRole => {\n          logger.log('ğŸ”” [user_roles] æ–°å¢æ¬Šé™:', newRole)\n          toast({\n            title: 'ä½ å·²ç²å¾—æ–°çš„æ¬Šé™ï¼',\n          })\n        },\n        onDelete: oldRole => {\n          logger.log('ğŸ”” [user_roles] æ¬Šé™å·²ç§»é™¤:', oldRole)\n          toast({\n            title: 'ä½ çš„éƒ¨åˆ†æ¬Šé™å·²è¢«ç§»é™¤',\n            variant: 'destructive',\n          })\n        },\n      },\n    })\n\n    // 2. è¨‚é–±å·¥ä½œç©ºé–“ï¼ˆæ°¸ä¹…ï¼‰\n    const workspaceSubscriptionId = 'workspaces-permanent'\n    realtimeManager.subscribe<Workspace>({\n      table: 'workspaces',\n      subscriptionId: workspaceSubscriptionId,\n      handlers: {\n        onUpdate: workspace => {\n          logger.log('ğŸ”” [workspaces] å·¥ä½œç©ºé–“å·²æ›´æ–°:', workspace.name)\n          toast({\n            title: 'å·¥ä½œç©ºé–“å·²æ›´æ–°',\n            description: `å·¥ä½œç©ºé–“ã€Œ${workspace.name}ã€å·²æ›´æ–°`,\n          })\n        },\n        onInsert: workspace => {\n          logger.log('ğŸ”” [workspaces] æ–°å¢å·¥ä½œç©ºé–“:', workspace.name)\n          toast({\n            title: 'æ–°å¢å·¥ä½œç©ºé–“',\n            description: `å·¥ä½œç©ºé–“ã€Œ${workspace.name}ã€`,\n          })\n        },\n        onDelete: workspace => {\n          logger.log('ğŸ”” [workspaces] åˆªé™¤å·¥ä½œç©ºé–“:', workspace.name)\n          toast({\n            title: 'å·¥ä½œç©ºé–“å·²åˆªé™¤',\n            description: `å·¥ä½œç©ºé–“ã€Œ${workspace.name}ã€å·²åˆªé™¤`,\n            variant: 'destructive',\n          })\n        },\n      },\n    })\n\n    // 3. è¨‚é–±å“¡å·¥è³‡æ–™ï¼ˆæ°¸ä¹…ï¼‰- å¸¸ç”¨æ–¼ä¸‹æ‹‰é¸å–®\n    const employeeSubscriptionId = 'employees-permanent'\n    realtimeManager.subscribe({\n      table: 'employees',\n      subscriptionId: employeeSubscriptionId,\n      handlers: {\n        onInsert: async (employee: Employee) => {\n          logger.log('ğŸ”” [employees] æ–°å¢å“¡å·¥:', employee)\n\n          // æ›´æ–° IndexedDB\n          const { IndexedDBAdapter } = await import('@/stores/adapters/indexeddb-adapter')\n          const indexedDB = new IndexedDBAdapter('employees')\n          await indexedDB.put(employee)\n\n          // æ›´æ–° Zustand ç‹€æ…‹\n          useEmployeeStore.setState(state => {\n            const exists = state.items.some(item => item.id === employee.id)\n            if (exists) return state\n            return {\n              items: [...state.items, employee as unknown as typeof state.items[0]],\n            }\n          })\n        },\n        onUpdate: async (employee: Employee) => {\n          logger.log('ğŸ”” [employees] æ›´æ–°å“¡å·¥:', employee)\n\n          const { IndexedDBAdapter } = await import('@/stores/adapters/indexeddb-adapter')\n          const indexedDB = new IndexedDBAdapter('employees')\n          await indexedDB.put(employee)\n\n          useEmployeeStore.setState(state => ({\n            items: state.items.map(item => (item.id === employee.id ? (employee as unknown as typeof item) : item)),\n          }))\n        },\n        onDelete: async (employee: Employee) => {\n          logger.log('ğŸ”” [employees] åˆªé™¤å“¡å·¥:', employee)\n\n          const { IndexedDBAdapter } = await import('@/stores/adapters/indexeddb-adapter')\n          const indexedDB = new IndexedDBAdapter('employees')\n          await indexedDB.delete(employee.id)\n\n          useEmployeeStore.setState(state => ({\n            items: state.items.filter(item => item.id !== employee.id),\n          }))\n        },\n      },\n    })\n\n    logger.log('âœ… [PermanentRealtimeSubscriptions] æ°¸ä¹…è¨‚é–±å®Œæˆ')\n\n    // æ¸…ç†ï¼šç™»å‡ºæ™‚å–æ¶ˆè¨‚é–±\n    return () => {\n      logger.log('ğŸ”• [PermanentRealtimeSubscriptions] å–æ¶ˆæ°¸ä¹…è¨‚é–±')\n      realtimeManager.unsubscribe(userRoleSubscriptionId)\n      realtimeManager.unsubscribe(workspaceSubscriptionId)\n      realtimeManager.unsubscribe(employeeSubscriptionId)\n    }\n    // âœ… åªä¾è³´ userï¼Œä¸è¦ä¾è³´ employeeStoreï¼ˆå®ƒæ¯æ¬¡éƒ½æœƒæ”¹è®Šï¼‰\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user])\n\n  // é€™æ˜¯ä¸€å€‹ç´”é‚è¼¯çµ„ä»¶ï¼Œä¸æ¸²æŸ“ä»»ä½• UI\n  return null\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/TourPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/accounting/accounts-management-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/accounting/add-account-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/accounting/add-transaction-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/calendar/calendar-settings-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/ContractDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/ContractViewDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/EnvelopeDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/contract-dialog/ContractDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/contract-dialog/ContractFormFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/contract-dialog/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/contract-dialog/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/contracts/contract-dialog/useContractForm.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":116,"column":5,"severity":1,"nodeType":null,"fix":{"range":[4320,4375],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { useState, useEffect } from 'react'\nimport { Tour, ContractTemplate } from '@/types/tour.types'\nimport { Order, Member } from '@/types/order.types'\nimport { useTourStore, useOrderStore, useMemberStore, useItineraryStore } from '@/stores'\nimport { prepareContractData, ContractData } from '@/lib/contract-utils'\n\ninterface UseContractFormProps {\n  tour: Tour\n  mode: 'create' | 'edit'\n  isOpen: boolean\n}\n\nexport function useContractForm({ tour, mode, isOpen }: UseContractFormProps) {\n  const { update: updateTour } = useTourStore()\n  const { items: orders } = useOrderStore()\n  const { items: members } = useMemberStore()\n  const { items: itineraries } = useItineraryStore()\n\n  const [selectedTemplate, setSelectedTemplate] = useState<ContractTemplate | ''>('')\n  const [contractNotes, setContractNotes] = useState('')\n  const [contractCompleted, setContractCompleted] = useState(false)\n  const [archivedDate, setArchivedDate] = useState('')\n  const [saving, setSaving] = useState(false)\n  const [contractData, setContractData] = useState<Partial<ContractData>>({})\n  const [selectedOrderId, setSelectedOrderId] = useState<string>('')\n\n  // å–å¾—é€™å€‹åœ˜çš„è³‡æ–™\n  const tourOrders = orders.filter(o => o.tour_id === tour.id)\n  const firstOrder = tourOrders[0]\n  const selectedOrder = tourOrders.find(o => o.id === selectedOrderId) || firstOrder\n  const tourMembers = members.filter(m => m.tour_id === tour.id)\n  const selectedOrderMembers = selectedOrder\n    ? members.filter(m => m.order_id === selectedOrder.id)\n    : []\n  const itinerary = itineraries.find(i => i.tour_id === tour.id)\n\n  // åˆå§‹åŒ–é¸æ“‡çš„è¨‚å–®ï¼ˆé è¨­ç¬¬ä¸€å€‹ï¼‰\n  useEffect(() => {\n    if (isOpen && firstOrder) {\n      // å°è©±æ¡†é–‹å•Ÿæ™‚ï¼Œå¦‚æœé‚„æ²’é¸æ“‡è¨‚å–®ï¼Œé è¨­ç¬¬ä¸€å€‹\n      if (!selectedOrderId) {\n        setSelectedOrderId(firstOrder.id)\n      }\n    } else if (!isOpen) {\n      // å°è©±æ¡†é—œé–‰æ™‚ï¼Œé‡ç½®é¸æ“‡çš„è¨‚å–®\n      setSelectedOrderId('')\n    }\n  }, [isOpen, firstOrder])\n\n  useEffect(() => {\n    if (isOpen) {\n      if (mode === 'edit' && tour.contract_template) {\n        setSelectedTemplate(tour.contract_template as ContractTemplate)\n        setContractNotes(tour.contract_notes || '')\n        setContractCompleted(tour.contract_completed || false)\n        setArchivedDate(tour.contract_archived_date || '')\n\n        // è¼‰å…¥å·²å„²å­˜çš„åˆç´„è³‡æ–™,æˆ–å¾ç³»çµ±è‡ªå‹•å¸¶å…¥\n        if (tour.contract_content) {\n          try {\n            const savedData = JSON.parse(tour.contract_content)\n            setContractData(savedData)\n          } catch {\n            // å¦‚æœ contract_content ä¸æ˜¯ JSON,å°±é‡æ–°æº–å‚™è³‡æ–™\n            if (selectedOrder) {\n              const firstMember = selectedOrderMembers[0]\n              const autoData = prepareContractData(tour, selectedOrder as Order, firstMember as Member, itinerary)\n              setContractData(autoData)\n            }\n          }\n        } else if (selectedOrder) {\n          const firstMember = selectedOrderMembers[0]\n          const autoData = prepareContractData(tour, selectedOrder as Order, firstMember as Member, itinerary)\n          setContractData(autoData)\n        }\n      } else {\n        // å»ºç«‹æ¨¡å¼:è‡ªå‹•æº–å‚™è³‡æ–™\n        setSelectedTemplate('')\n        setContractNotes('')\n        setContractCompleted(false)\n        setArchivedDate('')\n\n        if (selectedOrder) {\n          // æœ‰è¨‚å–®è³‡æ–™ï¼Œè‡ªå‹•å¸¶å…¥\n          const firstMember = selectedOrderMembers[0]\n          const autoData = prepareContractData(tour, selectedOrder as Order, firstMember as Member, itinerary)\n          setContractData(autoData)\n        } else {\n          // æ²’æœ‰è¨‚å–®è³‡æ–™ï¼Œåˆå§‹åŒ–ç©ºç™½æ¬„ä½\n          setContractData({\n            reviewYear: new Date().getFullYear().toString(),\n            reviewMonth: (new Date().getMonth() + 1).toString(),\n            reviewDay: new Date().getDate().toString(),\n            travelerName: '',\n            travelerAddress: '',\n            travelerIdNumber: '',\n            travelerPhone: '',\n            tourName: tour.name || '',\n            tourDestination: tour.location || '',\n            tourCode: tour.code || '',\n            gatherYear: '',\n            gatherMonth: '',\n            gatherDay: '',\n            gatherHour: '',\n            gatherMinute: '',\n            gatherLocation: '',\n            totalAmount: '',\n            depositAmount: '',\n            deathInsurance: '2,500,000',\n            medicalInsurance: '100,000',\n            companyExtension: '',\n          })\n        }\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isOpen, mode, tour.id])\n\n  const handleFieldChange = (field: keyof ContractData, value: string) => {\n    // æ•¸å­—æ¬„ä½è‡ªå‹•è½‰åŠå½¢\n    const numberFields = [\n      'reviewYear',\n      'reviewMonth',\n      'reviewDay',\n      'gatherYear',\n      'gatherMonth',\n      'gatherDay',\n      'gatherHour',\n      'gatherMinute',\n      'totalAmount',\n      'depositAmount',\n    ]\n\n    let processedValue = value\n    if (numberFields.includes(field)) {\n      // å…¨å½¢æ•¸å­—è½‰åŠå½¢\n      processedValue = value.replace(/[ï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xfee0))\n    }\n\n    setContractData(prev => ({ ...prev, [field]: processedValue }))\n  }\n\n  const handleSave = async () => {\n    if (mode === 'create' && !selectedTemplate) {\n      alert('è«‹é¸æ“‡åˆç´„ç¯„æœ¬')\n      return\n    }\n\n    setSaving(true)\n    try {\n      // å°‡åˆç´„è³‡æ–™è½‰æˆ JSON å„²å­˜\n      const contractContentJson = JSON.stringify(contractData)\n\n      if (mode === 'create') {\n        await updateTour(tour.id, {\n          contract_template: selectedTemplate as ContractTemplate,\n          contract_content: contractContentJson,\n          contract_created_at: new Date().toISOString(),\n          contract_notes: contractNotes,\n          contract_completed: contractCompleted,\n          contract_archived_date: archivedDate || undefined,\n        })\n        alert('åˆç´„å»ºç«‹æˆåŠŸ!')\n      } else {\n        await updateTour(tour.id, {\n          contract_content: contractContentJson,\n          contract_notes: contractNotes,\n          contract_completed: contractCompleted,\n          contract_archived_date: archivedDate || undefined,\n        })\n        alert('åˆç´„æ›´æ–°æˆåŠŸ!')\n      }\n      return true\n    } catch (error) {\n      alert('å„²å­˜åˆç´„å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦')\n      return false\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  const handlePrint = async () => {\n    if (!contractData || Object.keys(contractData).length === 0) {\n      alert('è«‹å…ˆå¡«å¯«åˆç´„è³‡æ–™')\n      return\n    }\n\n    try {\n      // å…ˆå„²å­˜åˆç´„è³‡æ–™\n      setSaving(true)\n      const contractContentJson = JSON.stringify(contractData)\n      await updateTour(tour.id, {\n        contract_template: selectedTemplate,\n        contract_content: contractContentJson,\n        contract_created_at: new Date().toISOString(),\n        contract_notes: contractNotes,\n        contract_completed: contractCompleted,\n        contract_archived_date: archivedDate || '',\n      })\n\n      // è®€å–åˆç´„ç¯„æœ¬\n      const templateMap: Record<string, string> = {\n        domestic: 'domestic.html',\n        international: 'international.html',\n        individual_international: 'individual_international.html',\n      }\n      const templateFile = templateMap[selectedTemplate as string] || 'international.html'\n      const response = await fetch(`/contract-templates/${templateFile}`)\n      if (!response.ok) {\n        throw new Error('ç„¡æ³•è¼‰å…¥åˆç´„ç¯„æœ¬')\n      }\n\n      let template = await response.text()\n\n      // æ›¿æ›æ‰€æœ‰è®Šæ•¸\n      Object.entries(contractData).forEach(([key, value]) => {\n        const regex = new RegExp(`{{${key}}}`, 'g')\n        template = template.replace(regex, value || '')\n      })\n\n      // é–‹å•Ÿæ–°è¦–çª—ä¸¦åˆ—å°\n      const printWindow = window.open('', '_blank')\n      if (!printWindow) {\n        alert('è«‹å…è¨±å½ˆå‡ºè¦–çª—ä»¥é€²è¡Œåˆ—å°')\n        return\n      }\n\n      printWindow.document.write(template)\n      printWindow.document.close()\n\n      // ç­‰å¾…å…§å®¹è¼‰å…¥å¾Œåˆ—å°\n      printWindow.onload = () => {\n        printWindow.print()\n        // åˆ—å°å¾Œé—œé–‰è¦–çª—\n        printWindow.onafterprint = () => {\n          printWindow.close()\n        }\n      }\n    } catch (error) {\n      alert('åˆ—å°åˆç´„æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return {\n    selectedTemplate,\n    setSelectedTemplate,\n    contractNotes,\n    setContractNotes,\n    contractCompleted,\n    setContractCompleted,\n    archivedDate,\n    setArchivedDate,\n    saving,\n    contractData,\n    handleFieldChange,\n    handleSave,\n    handlePrint,\n    firstOrder,\n    tourMembers,\n    tourOrders,\n    selectedOrderId,\n    setSelectedOrderId,\n    selectedOrder,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/customers/customer-combobox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/customers/customer-search-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/dialog/confirm-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/dialog/form-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/dialog/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/AttractionSelector.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":166,"column":5,"severity":1,"nodeType":null,"fix":{"range":[4382,4437],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport React, { useState, useMemo } from 'react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Search, MapPin } from 'lucide-react'\nimport { supabase } from '@/lib/supabase/client'\nimport { TourCountry } from './tour-form/types'\nimport { Attraction } from '@/features/attractions/types'\n\n// æ“´å±•å‹åˆ¥ï¼ˆåŠ å…¥ join æŸ¥è©¢çš„æ¬„ä½ï¼‰\ninterface AttractionWithCity extends Attraction {\n  city_name?: string\n  region_name?: string\n}\n\ninterface AttractionSelectorProps {\n  isOpen: boolean\n  onClose: () => void\n  tourCountries?: TourCountry[] // è¡Œç¨‹æ¶µè“‹çš„åœ‹å®¶\n  onSelect: (attractions: AttractionWithCity[]) => void\n}\n\nexport function AttractionSelector({\n  isOpen,\n  onClose,\n  tourCountries = [],\n  onSelect,\n}: AttractionSelectorProps) {\n  const [selectedCountryId, setSelectedCountryId] = useState<string>('')\n  const [selectedCityId, setSelectedCityId] = useState<string>('')\n  const [searchQuery, setSearchQuery] = useState('')\n  const [attractions, setAttractions] = useState<AttractionWithCity[]>([])\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n  const [loading, setLoading] = useState(false)\n  const [cities, setCities] = useState<{ id: string; name: string }[]>([])\n\n  // åºåˆ—åŒ– tourCountries é¿å…ç„¡é™è¿´åœˆ\n  const tourCountryIds = useMemo(\n    () => tourCountries.map(c => c.country_id).filter(Boolean),\n    [tourCountries]\n  )\n\n  // æ‰“é–‹å°è©±æ¡†æ™‚æ¸…ç©ºé¸æ“‡\n  React.useEffect(() => {\n    if (isOpen) {\n      setSelectedIds(new Set())\n      setSearchQuery('')\n      setSelectedCityId('')\n    }\n  }, [isOpen])\n\n  // è¼‰å…¥åŸå¸‚åˆ—è¡¨ï¼ˆæ ¹æ“šé¸æ“‡çš„åœ‹å®¶ï¼‰\n  React.useEffect(() => {\n    if (!isOpen || !selectedCountryId) {\n      setCities([])\n      return\n    }\n\n    const loadCities = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('cities')\n          .select('id, name')\n          .eq('country_id', selectedCountryId)\n          .eq('is_active', true)\n          .order('name')\n\n        if (error) throw error\n        setCities(data || [])\n      } catch (error) {\n        setCities([])\n      }\n    }\n\n    loadCities()\n  }, [isOpen, selectedCountryId])\n\n  // è¼‰å…¥æ™¯é»è³‡æ–™\n  React.useEffect(() => {\n    if (!isOpen) return\n\n    const loadAttractions = async () => {\n      setLoading(true)\n      try {\n        let query = supabase\n          .from('attractions')\n          .select(\n            `\n            id,\n            name,\n            name_en,\n            category,\n            description,\n            thumbnail,\n            country_id,\n            region_id,\n            city_id,\n            cities!inner (\n              name\n            )\n          `\n          )\n          .eq('is_active', true)\n          .order('name')\n\n        // å¦‚æœæœ‰é¸æ“‡åŸå¸‚ï¼Œç¯©é¸è©²åŸå¸‚çš„æ™¯é»\n        if (selectedCityId) {\n          query = query.eq('city_id', selectedCityId)\n        } else if (selectedCountryId) {\n          // å¦‚æœæœ‰é¸æ“‡åœ‹å®¶ï¼Œç¯©é¸è©²åœ‹å®¶çš„æ™¯é»\n          query = query.eq('country_id', selectedCountryId)\n        } else if (tourCountryIds.length > 0) {\n          // å¦‚æœæ²’é¸æ“‡åœ‹å®¶ï¼Œä½†è¡Œç¨‹æœ‰è¨­å®šåœ‹å®¶ï¼Œå°±ç¯©é¸é€™äº›åœ‹å®¶çš„æ™¯é»\n          query = query.in('country_id', tourCountryIds)\n        }\n\n        const { data, error } = await query\n\n        if (error) throw error\n\n        const formatted = (data || []).map((item: {\n          id: string\n          name: string\n          name_en: string | null\n          category: string | null\n          description: string | null\n          thumbnail: string | null\n          country_id: string\n          region_id: string | null\n          city_id: string\n          cities: { name: string }\n        }): AttractionWithCity => ({\n          id: item.id,\n          name: item.name,\n          name_en: item.name_en ?? undefined,\n          category: item.category ?? undefined,\n          description: item.description ?? undefined,\n          thumbnail: item.thumbnail ?? undefined,\n          country_id: item.country_id,\n          region_id: item.region_id ?? undefined,\n          city_id: item.city_id,\n          city_name: item.cities?.name || '',\n          is_active: true,\n          display_order: 0,\n          created_at: '',\n          updated_at: '',\n        }))\n\n        setAttractions(formatted)\n      } catch (error) {\n        // éœé»˜å¤±æ•—ï¼Œä½¿ç”¨ç©ºé™£åˆ—\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    loadAttractions()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isOpen, selectedCountryId, selectedCityId, tourCountryIds.join(',')])\n\n  // æœå°‹éæ¿¾\n  const filteredAttractions = useMemo(() => {\n    if (!searchQuery) return attractions\n\n    const query = searchQuery.toLowerCase()\n    return attractions.filter(\n      a =>\n        a.name.toLowerCase().includes(query) ||\n        a.name_en?.toLowerCase().includes(query) ||\n        a.city_name?.toLowerCase().includes(query) ||\n        a.category?.toLowerCase().includes(query)\n    )\n  }, [attractions, searchQuery])\n\n  // åˆ‡æ›é¸æ“‡\n  const toggleSelection = (id: string) => {\n    const newSet = new Set(selectedIds)\n    if (newSet.has(id)) {\n      newSet.delete(id)\n    } else {\n      newSet.add(id)\n    }\n    setSelectedIds(newSet)\n  }\n\n  // ç¢ºèªé¸æ“‡\n  const handleConfirm = () => {\n    const selected = attractions.filter(a => selectedIds.has(a.id))\n    onSelect(selected)\n    setSelectedIds(new Set())\n    setSearchQuery('')\n    onClose()\n  }\n\n  // å–æ¶ˆ\n  const handleCancel = () => {\n    setSelectedIds(new Set())\n    setSearchQuery('')\n    onClose()\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleCancel}>\n      <DialogContent className=\"max-w-3xl max-h-[80vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <MapPin className=\"text-morandi-gold\" size={20} />\n            é¸æ“‡æ™¯é»\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden flex flex-col gap-4\">\n          {/* ç¯©é¸å€ */}\n          <div className=\"flex gap-3\">\n            {/* åœ‹å®¶é¸æ“‡ */}\n            {tourCountries.length > 0 && (\n              <select\n                value={selectedCountryId}\n                onChange={e => {\n                  setSelectedCountryId(e.target.value)\n                  setSelectedCityId('')\n                  setSearchQuery('')\n                }}\n                className=\"px-3 py-2 border rounded-lg text-sm bg-white min-w-[150px]\"\n              >\n                <option value=\"\">å…¨éƒ¨åœ‹å®¶</option>\n                {tourCountries.map(country => (\n                  <option key={country.country_id} value={country.country_id}>\n                    {country.country_name}\n                  </option>\n                ))}\n              </select>\n            )}\n\n            {/* åŸå¸‚é¸æ“‡ */}\n            {selectedCountryId && cities.length > 0 && (\n              <select\n                value={selectedCityId}\n                onChange={e => {\n                  setSelectedCityId(e.target.value)\n                  setSearchQuery('')\n                }}\n                className=\"px-3 py-2 border rounded-lg text-sm bg-white min-w-[150px]\"\n              >\n                <option value=\"\">å…¨éƒ¨åŸå¸‚</option>\n                {cities.map(city => (\n                  <option key={city.id} value={city.id}>\n                    {city.name}\n                  </option>\n                ))}\n              </select>\n            )}\n\n            {/* æœå°‹æ¡† */}\n            <div className=\"flex-1 relative\">\n              <Search\n                className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"\n                size={16}\n              />\n              <Input\n                value={searchQuery}\n                onChange={e => setSearchQuery(e.target.value)}\n                placeholder=\"æœå°‹æ™¯é»åç¨±ã€åŸå¸‚...\"\n                className=\"pl-10\"\n              />\n            </div>\n          </div>\n\n          {/* æ™¯é»åˆ—è¡¨ */}\n          <div className=\"flex-1 overflow-y-auto border rounded-lg\">\n            {loading ? (\n              <div className=\"p-8 text-center text-gray-500\">è¼‰å…¥ä¸­...</div>\n            ) : filteredAttractions.length === 0 ? (\n              <div className=\"p-8 text-center text-gray-500\">\n                {searchQuery ? 'æ‰¾ä¸åˆ°ç¬¦åˆçš„æ™¯é»' : 'æ²’æœ‰å¯é¸æ“‡çš„æ™¯é»'}\n              </div>\n            ) : (\n              <div className=\"divide-y\">\n                {filteredAttractions.map(attraction => (\n                  <label\n                    key={attraction.id}\n                    className=\"flex items-start gap-3 p-3 hover:bg-morandi-container/10 cursor-pointer transition-colors\"\n                  >\n                    <input\n                      type=\"checkbox\"\n                      checked={selectedIds.has(attraction.id)}\n                      onChange={() => toggleSelection(attraction.id)}\n                      className=\"mt-1 rounded\"\n                    />\n\n                    {/* ç¸®åœ– */}\n                    {attraction.thumbnail && (\n                      <img\n                        src={attraction.thumbnail}\n                        alt={attraction.name}\n                        className=\"w-16 h-16 rounded object-cover flex-shrink-0\"\n                      />\n                    )}\n\n                    {/* è³‡è¨Š */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"font-medium text-morandi-primary truncate\">\n                        {attraction.name}\n                      </div>\n                      {attraction.name_en && (\n                        <div className=\"text-xs text-gray-500 truncate\">{attraction.name_en}</div>\n                      )}\n                      <div className=\"text-xs text-morandi-secondary mt-1 flex items-center gap-2\">\n                        <span>{attraction.city_name}</span>\n                        {attraction.category && (\n                          <>\n                            <span>Â·</span>\n                            <span>{attraction.category}</span>\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  </label>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* å·²é¸æ“‡æç¤º */}\n          {selectedIds.size > 0 && (\n            <div className=\"text-sm text-morandi-secondary bg-morandi-container/10 px-3 py-2 rounded\">\n              å·²é¸æ“‡ <span className=\"font-semibold text-morandi-gold\">{selectedIds.size}</span>{' '}\n              å€‹æ™¯é»\n            </div>\n          )}\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleCancel}>\n            å–æ¶ˆ\n          </Button>\n          <Button\n            onClick={handleConfirm}\n            disabled={selectedIds.size === 0}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n          >\n            ç¢ºèªæ–°å¢ ({selectedIds.size})\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/PublishButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/TourForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/TourPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/hooks/useRegionData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/hooks/useTourFormHandlers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/CountriesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/CoverInfoSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/DailyItinerarySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/FeaturesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/FlightInfoSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/HotelSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/sections/LeaderMeetingSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/editor/tour-form/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/AddEmployeeForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/BasicInfoFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/ContactFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/JobInfoFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/PasswordAndRoleFields.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/SuccessDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/add-employee/useEmployeeForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/employee-expanded-view.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/salary-payment-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/BasicInfoTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/ContactInfoSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/EmergencyContactSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/EmploymentInfoSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/PasswordManagementSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/PersonalInfoSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/basic-info/useBasicInfoForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/permissions-tab-new.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/hr/tabs/salary-tab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/content-container.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/layout-router.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/list-page-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/main-layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/mobile-bottom-nav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/responsive-header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/sync-status-indicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/layout/theme-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/manifestation/BreathingExercise.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/manifestation/ChapterContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/manifestation/ChapterList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/manifestation/WishWall.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":24,"column":7,"severity":1,"nodeType":null,"fix":{"range":[496,558],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { supabase } from '@/lib/supabase/client'\nimport { Heart, Sparkles } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface Wish {\n  id: string\n  shared_wish: string\n  created_at: string\n}\n\nexport function WishWall() {\n  const [wishes, setWishes] = useState<Wish[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n\n  useEffect(() => {\n    fetchWishes()\n  }, [])\n\n  const fetchWishes = async () => {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const result = await (supabase as any)\n        .from('manifestation_entries')\n        .select('id, shared_wish, created_at')\n        .not('shared_wish', 'is', null)\n        .neq('shared_wish', '')\n        .order('created_at', { ascending: false })\n        .limit(50)\n\n      const { data, error } = result\n\n      if (error) throw error\n\n      setWishes((data || []) as Wish[])\n    } catch (_error) {\n      // Ignore error\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <div className=\"text-morandi-secondary\">è¼‰å…¥ä¸­...</div>\n      </div>\n    )\n  }\n\n  if (wishes.length === 0) {\n    return (\n      <div className=\"text-center p-12\">\n        <Sparkles className=\"mx-auto mb-4 text-morandi-gold\" size={48} />\n        <h3 className=\"text-lg font-medium text-morandi-primary mb-2\">é¡˜æœ›ä¹‹ç‰†é‚„å¾ˆç©º</h3>\n        <p className=\"text-sm text-morandi-secondary\">æˆç‚ºç¬¬ä¸€å€‹åˆ†äº«é¡˜æœ›çš„äººå§</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"text-center mb-8\">\n        <h2 className=\"text-2xl font-light text-morandi-primary mb-2\">é¡˜æœ›ä¹‹ç‰†</h2>\n        <p className=\"text-sm text-morandi-secondary\">æ¯ä¸€å€‹é¡˜æœ›ï¼Œéƒ½å€¼å¾—è¢«çœ‹è¦‹å’Œç¥ç¦</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {wishes.map((wish, index) => (\n          <WishCard key={wish.id} wish={wish} index={index} />\n        ))}\n      </div>\n    </div>\n  )\n}\n\nfunction WishCard({ wish, index }: { wish: Wish; index: number }) {\n  const colors = ['#d4c5a9', '#c9b896', '#bfad87', '#a89968']\n  const color = colors[index % colors.length]\n\n  return (\n    <div\n      className={cn(\n        'p-6 rounded-lg border transition-all duration-200',\n        'hover:shadow-md hover:scale-105'\n      )}\n      style={{\n        backgroundColor: `${color}10`,\n        borderColor: `${color}40`,\n      }}\n    >\n      <div className=\"flex items-start gap-3 mb-3\">\n        <div\n          className=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0\"\n          style={{ backgroundColor: `${color}30` }}\n        >\n          <Sparkles size={16} style={{ color }} />\n        </div>\n        <p className=\"text-sm text-morandi-primary flex-1 leading-relaxed\">{wish.shared_wish}</p>\n      </div>\n\n      <div className=\"flex items-center justify-between mt-4 pt-4 border-t border-border\">\n        <span className=\"text-xs text-morandi-secondary\">\n          {new Date(wish.created_at).toLocaleDateString('zh-TW')}\n        </span>\n        <button\n          className=\"text-morandi-secondary hover:text-morandi-gold transition-colors\"\n          title=\"ç‚ºé€™å€‹é¡˜æœ›ç¥ç¦\"\n        >\n          <Heart size={16} />\n        </button>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/members/excel-member-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/members/member-quick-add.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/network-monitor-initializer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/orders/OrderMembersExpandable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/orders/add-order-form.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/orders/expandable-order-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/orders/simple-order-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/destination-selector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/passport-upload-zone.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/DatasheetCell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/DatasheetStyles.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/ReactDatasheetWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/useDatasheetHandlers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/shared/react-datasheet-wrapper/useDatasheetState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/table-cells/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/quick-actions/quick-disbursement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/quick-actions/quick-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/quick-actions/quick-pnr.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/quick-actions/quick-receipt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/AssignmentSection.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":21,"column":5,"severity":1,"nodeType":null,"fix":{"range":[699,754],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport React, { useEffect, useState } from 'react'\nimport { Input } from '@/components/ui/input'\nimport { cn } from '@/lib/utils'\nimport { Calendar, Clock, FileText, X, UserCheck } from 'lucide-react'\nimport { AssignmentSectionProps } from './types'\nimport { useUserStore } from '@/stores/user-store'\nimport { useAuthStore } from '@/stores/auth-store'\n\nexport function AssignmentSection({ todo, onUpdate }: AssignmentSectionProps) {\n  const { items: employees, fetchAll } = useUserStore()\n  const { user } = useAuthStore()\n  const [assigneeName, setAssigneeName] = useState<string>('')\n\n  // è¼‰å…¥å“¡å·¥è³‡æ–™\n  useEffect(() => {\n    if (employees.length === 0) {\n      void fetchAll()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [employees.length])\n\n  // æ›´æ–°æŒ‡æ´¾è€…åç¨±\n  useEffect(() => {\n    if (todo.assignee) {\n      // å„ªå…ˆæª¢æŸ¥ç•¶å‰ç™»å…¥ç”¨æˆ¶ï¼Œå†æª¢æŸ¥å“¡å·¥åˆ—è¡¨\n      if (user?.id === todo.assignee) {\n        setAssigneeName(user.display_name || user.chinese_name || user.personal_info?.email || 'æœªçŸ¥å“¡å·¥')\n      } else {\n        const assignee = employees.find(e => e.id === todo.assignee)\n        setAssigneeName(assignee?.display_name || assignee?.chinese_name || 'æœªçŸ¥å“¡å·¥')\n      }\n    } else {\n      setAssigneeName('')\n    }\n  }, [todo.assignee, employees, user])\n  const getDeadlineColor = () => {\n    if (!todo.deadline) return 'text-morandi-secondary'\n\n    const deadline = new Date(todo.deadline)\n    const today = new Date()\n    const diffDays = Math.ceil((deadline.getTime() - today.getTime()) / (1000 * 60 * 60 * 24))\n\n    if (diffDays < 0) return 'text-morandi-red' // é€¾æœŸ\n    if (diffDays === 0) return 'text-morandi-gold' // ä»Šå¤©\n    if (diffDays <= 3) return 'text-morandi-gold' // 3å¤©å…§\n    return 'text-morandi-secondary' // å……è£•\n  }\n\n  return (\n    <div className=\"bg-card border border-border rounded-xl p-4 mb-4 shadow-sm\">\n      <div className=\"space-y-3\">\n        {/* æŒ‡æ´¾çµ¦ */}\n        {assigneeName && (\n          <div className=\"flex items-center gap-3 pb-3 border-b border-border\">\n            <UserCheck size={18} className=\"text-morandi-gold\" />\n            <span className=\"text-sm text-morandi-secondary min-w-[60px]\">æŒ‡æ´¾çµ¦:</span>\n            <div className=\"flex items-center gap-2 px-3 py-1.5 bg-morandi-gold/10 border border-morandi-gold/30 rounded-lg\">\n              <span className=\"text-sm font-medium text-morandi-gold\">{assigneeName}</span>\n              <button\n                onClick={() => onUpdate({ assignee: undefined })}\n                className=\"p-0.5 hover:bg-morandi-red/10 rounded text-morandi-secondary hover:text-morandi-red\"\n                title=\"å–æ¶ˆæŒ‡æ´¾\"\n              >\n                <X size={12} />\n              </button>\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex items-center gap-3\">\n          <Calendar size={18} className=\"text-morandi-secondary\" />\n          <span className=\"text-sm text-morandi-secondary min-w-[60px]\">æœŸé™:</span>\n          <Input\n            type=\"date\"\n            value={todo.deadline || ''}\n            onChange={e => onUpdate({ deadline: e.target.value })}\n            className={cn('text-sm font-medium h-8 w-auto', getDeadlineColor())}\n          />\n          {todo.deadline && (\n            <button\n              onClick={() => onUpdate({ deadline: '' })}\n              className=\"p-1 hover:bg-morandi-red/10 rounded text-morandi-secondary hover:text-morandi-red\"\n              title=\"æ¸…é™¤æœŸé™\"\n            >\n              <X size={14} />\n            </button>\n          )}\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Clock size={16} className=\"text-morandi-secondary\" />\n          <span className=\"text-xs text-morandi-secondary min-w-[50px]\">ç‹€æ…‹:</span>\n          <div className=\"flex gap-2 flex-wrap\">\n            <button\n              onClick={() => onUpdate({ status: 'pending' })}\n              className={cn(\n                'px-3.5 py-2 text-xs rounded-lg transition-all font-medium',\n                todo.status === 'pending'\n                  ? 'bg-morandi-muted text-white shadow-md'\n                  : 'bg-morandi-container/30 border border-morandi-muted/20 text-morandi-secondary hover:bg-morandi-muted/10 hover:border-morandi-muted/40 hover:text-morandi-muted'\n              )}\n            >\n              å¾…è¾¦\n            </button>\n            <button\n              onClick={() => onUpdate({ status: 'in_progress' })}\n              className={cn(\n                'px-3.5 py-2 text-xs rounded-lg transition-all font-medium',\n                todo.status === 'in_progress'\n                  ? 'bg-morandi-gold text-white shadow-md'\n                  : 'bg-morandi-container/30 border border-morandi-gold/20 text-morandi-secondary hover:bg-morandi-gold/10 hover:border-morandi-gold/40 hover:text-morandi-gold'\n              )}\n            >\n              é€²è¡Œä¸­\n            </button>\n            <button\n              onClick={() => onUpdate({ status: 'completed' })}\n              className={cn(\n                'px-3.5 py-2 text-xs rounded-lg transition-all font-medium',\n                todo.status === 'completed'\n                  ? 'bg-morandi-green text-white shadow-md'\n                  : 'bg-morandi-container/30 border border-morandi-green/20 text-morandi-secondary hover:bg-morandi-green/10 hover:border-morandi-green/40 hover:text-morandi-green'\n              )}\n            >\n              å®Œæˆ\n            </button>\n            <button\n              onClick={() => onUpdate({ status: 'cancelled' })}\n              className={cn(\n                'px-3.5 py-2 text-xs rounded-lg transition-all font-medium',\n                todo.status === 'cancelled'\n                  ? 'bg-morandi-red text-white shadow-md'\n                  : 'bg-morandi-container/30 border border-morandi-red/20 text-morandi-secondary hover:bg-morandi-red/10 hover:border-morandi-red/40 hover:text-morandi-red'\n              )}\n            >\n              å–æ¶ˆ\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {todo.related_items && todo.related_items.length > 0 && (\n        <div className=\"pt-3 mt-3 border-t border-border\">\n          <span className=\"text-xs font-medium text-morandi-primary flex items-center gap-1.5 mb-2\">\n            <FileText size={12} className=\"text-morandi-gold\" />\n            é—œè¯é …ç›®\n          </span>\n          <div className=\"flex flex-wrap gap-1.5\">\n            {todo.related_items.map((item, index) => (\n              <button\n                key={index}\n                onClick={() => {\n                  const basePath = {\n                    group: '/tours',\n                    quote: '/quotes',\n                    order: '/orders',\n                    invoice: '/finance/treasury/disbursement',\n                    receipt: '/finance/payments',\n                  }[item.type]\n                  if (basePath) {\n                    window.location.href = `${basePath}?highlight=${item.id}`\n                  }\n                }}\n                className=\"bg-white/60 border border-morandi-gold/20 text-morandi-primary text-xs px-2 py-1 rounded-lg hover:bg-morandi-gold/10 hover:border-morandi-gold/20 transition-all font-medium\"\n              >\n                {item.title}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/NotesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/QuickActionsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/SubTasksSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/TodoExpandedView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/todos/todo-expanded-view/useTodoExpandedView.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tour-preview/AttractionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tour-preview/DateSubtitle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tour-preview/DayLabel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tour-preview/DecorativeDivider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tour-preview/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-add-ons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-close-dialog.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":62,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1786,1841],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":210,"column":11,"severity":1,"nodeType":null,"fix":{"range":[5664,5726],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":225,"column":11,"severity":1,"nodeType":null,"fix":{"range":[6192,6254],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":3,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useState, useEffect } from 'react'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Tour } from '@/types/tour.types'\nimport { PaymentRequest } from '@/stores/types'\nimport { supabase } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { Plus, X } from 'lucide-react'\n\ninterface Employee {\n  id: string\n  name: string\n}\n\ninterface BonusRecipient {\n  employeeId: string\n  percentage: number\n}\n\ninterface TourCloseDialogProps {\n  tour: Tour\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  onSuccess: () => void\n}\n\nexport function TourCloseDialog({ tour, open, onOpenChange, onSuccess }: TourCloseDialogProps) {\n  const [loading, setLoading] = useState(false)\n  const [calculating, setCalculating] = useState(true)\n  const [employees, setEmployees] = useState<Employee[]>([])\n\n  // è¨ˆç®—æ•¸æ“š\n  const [totalRevenue, setTotalRevenue] = useState(0)\n  const [totalCost, setTotalCost] = useState(0)\n  const [memberCount, setMemberCount] = useState(0)\n  const [grossProfit, setGrossProfit] = useState(0)\n  const [miscExpense, setMiscExpense] = useState(0)\n  const [tax, setTax] = useState(0)\n  const [netProfit, setNetProfit] = useState(0)\n\n  // æ¥­å‹™æ¥­ç¸¾ï¼ˆå¯å¤šäººï¼‰\n  const [salesRecipients, setSalesRecipients] = useState<BonusRecipient[]>([\n    { employeeId: '', percentage: 0 }\n  ])\n\n  // OP çé‡‘ï¼ˆå¯å¤šäººï¼‰\n  const [opRecipients, setOpRecipients] = useState<BonusRecipient[]>([\n    { employeeId: '', percentage: 0 }\n  ])\n\n  // è¼‰å…¥å“¡å·¥åˆ—è¡¨\n  useEffect(() => {\n    if (open) {\n      loadEmployees()\n      calculateTourFinance()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [open, tour.id])\n\n  const loadEmployees = async () => {\n    try {\n      // å–å¾—ç•¶å‰ workspace\n      const { data: workspace } = await supabase\n        .from('workspaces')\n        .select('id')\n        .limit(1)\n        .single()\n\n      if (!workspace) {\n        logger.error('æ‰¾ä¸åˆ°å·¥ä½œç©ºé–“')\n        return\n      }\n\n      // åªè¼‰å…¥åŒä¸€ workspace çš„å“¡å·¥\n      const { data, error } = await supabase\n        .from('employees')\n        .select('id, display_name')\n        .eq('workspace_id', workspace.id)\n        .order('display_name')\n\n      if (error) throw error\n      if (data) {\n        setEmployees(\n          data.map(emp => ({\n            id: emp.id,\n            name: emp.display_name || '',\n          }))\n        )\n      }\n    } catch (error) {\n      logger.error('è¼‰å…¥å“¡å·¥å¤±æ•—:', error)\n    }\n  }\n\n  const calculateTourFinance = async () => {\n    try {\n      setCalculating(true)\n\n      // 1. è¨ˆç®—ç¸½æ”¶å…¥ï¼ˆè©²åœ˜æ‰€æœ‰è¨‚å–®çš„æ”¶æ¬¾ï¼‰\n      const { data: orders } = await supabase\n        .from('orders')\n        .select('id, paid_amount')\n        .eq('tour_id', tour.id)\n\n      const revenue = orders?.reduce((sum, o) => sum + (o.paid_amount || 0), 0) || 0\n      setTotalRevenue(revenue)\n\n      // 2. è¨ˆç®—ç¸½æˆæœ¬ï¼ˆè©²åœ˜æ‰€æœ‰è«‹æ¬¾å–®ï¼Œä½†æ’é™¤ bonus é¡å‹ï¼‰\n      const orderIds = orders?.map(o => o.id) || []\n      if (orderIds.length > 0) {\n        const { data: paymentRequests } = await supabase\n          .from('payment_requests')\n          .select('amount')\n          .in('order_id', orderIds)\n          .eq('status', 'paid')\n\n        const cost = paymentRequests?.reduce((sum: number, pr: Pick<PaymentRequest, 'amount'>) => sum + (pr.amount || 0), 0) || 0\n        setTotalCost(cost)\n      }\n\n      // 3. è¨ˆç®—åœ˜å“¡ç¸½äººæ•¸\n      if (orderIds.length > 0) {\n        const { data: members } = await supabase\n          .from('order_members')\n          .select('id')\n          .in('order_id', orderIds)\n\n        setMemberCount(members?.length || 0)\n      }\n\n      // 4. è¨ˆç®—å„é …æ•¸å€¼\n      const gross = revenue - totalCost\n      const misc = memberCount * 10\n      const taxAmount = (gross - misc) * 0.12\n      const net = gross - misc - taxAmount\n\n      setGrossProfit(gross)\n      setMiscExpense(misc)\n      setTax(taxAmount)\n      setNetProfit(net)\n    } catch (error) {\n      logger.error('è¨ˆç®—åœ˜é«”è²¡å‹™å¤±æ•—:', error)\n      toast.error('è¨ˆç®—å¤±æ•—')\n    } finally {\n      setCalculating(false)\n    }\n  }\n\n  // æ–°å¢æ¥­å‹™\n  const addSalesRecipient = () => {\n    setSalesRecipients([...salesRecipients, { employeeId: '', percentage: 0 }])\n  }\n\n  // ç§»é™¤æ¥­å‹™\n  const removeSalesRecipient = (index: number) => {\n    setSalesRecipients(salesRecipients.filter((_, i) => i !== index))\n  }\n\n  // æ–°å¢ OP\n  const addOpRecipient = () => {\n    setOpRecipients([...opRecipients, { employeeId: '', percentage: 0 }])\n  }\n\n  // ç§»é™¤ OP\n  const removeOpRecipient = (index: number) => {\n    setOpRecipients(opRecipients.filter((_, i) => i !== index))\n  }\n\n  // ç¢ºèªçµåœ˜\n  const handleCloseTour = async () => {\n    // é©—è­‰\n    const salesTotal = salesRecipients.reduce((sum, r) => sum + r.percentage, 0)\n    const opTotal = opRecipients.reduce((sum, r) => sum + r.percentage, 0)\n\n    if (salesRecipients.some(r => !r.employeeId)) {\n      toast.error('è«‹é¸æ“‡æ‰€æœ‰æ¥­å‹™äººå“¡')\n      return\n    }\n\n    if (opRecipients.some(r => !r.employeeId)) {\n      toast.error('è«‹é¸æ“‡æ‰€æœ‰ OP äººå“¡')\n      return\n    }\n\n    if (!confirm(`ç¢ºå®šè¦çµåœ˜å—ï¼Ÿçµåœ˜å¾Œå°‡ç„¡æ³•ä¿®æ”¹ã€‚\\n\\næ¥­å‹™æ¥­ç¸¾ï¼š${salesTotal}%\\nOP çé‡‘ï¼š${opTotal}%`)) {\n      return\n    }\n\n    setLoading(true)\n    try {\n      // å–å¾—ç¬¬ä¸€å€‹è¨‚å–® IDï¼ˆç”¨æ–¼é—œè¯è«‹æ¬¾å–®ï¼‰\n      const { data: firstOrder } = await supabase\n        .from('orders')\n        .select('id')\n        .eq('tour_id', tour.id)\n        .limit(1)\n        .single()\n\n      const orderId = firstOrder?.id\n\n      // 1. ç”¢ç”Ÿæ¥­å‹™æ¥­ç¸¾è«‹æ¬¾å–®\n      for (const recipient of salesRecipients) {\n        if (recipient.percentage > 0) {\n          const amount = Math.round(netProfit * (recipient.percentage / 100))\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          await (supabase as any).from('payment_requests').insert({\n            order_id: orderId,\n            supplier_name: 'æ¥­å‹™æ¥­ç¸¾',\n            amount,\n            note: `æ¥­å‹™æ¥­ç¸¾ ${recipient.percentage}%`,\n            status: 'pending'\n          })\n        }\n      }\n\n      // 2. ç”¢ç”Ÿ OP çé‡‘è«‹æ¬¾å–®\n      for (const recipient of opRecipients) {\n        if (recipient.percentage > 0) {\n          const amount = Math.round(netProfit * (recipient.percentage / 100))\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          await (supabase as any).from('payment_requests').insert({\n            order_id: orderId,\n            supplier_name: 'OP çé‡‘',\n            amount,\n            note: `OP çé‡‘ ${recipient.percentage}%`,\n            status: 'pending'\n          })\n        }\n      }\n\n      // 3. æ›´æ–°åœ˜é«”ç‹€æ…‹ç‚ºå·²çµåœ˜\n      const { error: updateError } = await supabase\n        .from('tours')\n        .update({\n          status: 'çµæ¡ˆ',\n          closing_date: new Date().toISOString().split('T')[0]\n        })\n        .eq('id', tour.id)\n\n      if (updateError) throw updateError\n\n      toast.success('çµåœ˜æˆåŠŸï¼')\n      onSuccess()\n      onOpenChange(false)\n    } catch (error) {\n      logger.error('çµåœ˜å¤±æ•—:', error)\n      toast.error('çµåœ˜å¤±æ•—')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>åœ˜é«”çµç®— - {tour.name}</DialogTitle>\n        </DialogHeader>\n\n        {calculating ? (\n          <div className=\"py-8 text-center text-morandi-secondary\">è¨ˆç®—ä¸­...</div>\n        ) : (\n          <div className=\"space-y-6\">\n            {/* è²¡å‹™æ‘˜è¦ */}\n            <div className=\"bg-morandi-container/20 rounded-lg p-4 space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">åœ˜è²»æ”¶å…¥</span>\n                <span className=\"font-medium\">${totalRevenue.toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">æˆæœ¬æ”¯å‡º</span>\n                <span className=\"font-medium text-red-600\">-${totalCost.toLocaleString()}</span>\n              </div>\n              <div className=\"border-t border-morandi-gold/20 pt-2 flex justify-between\">\n                <span className=\"font-medium\">æ¯›åˆ©</span>\n                <span className=\"font-bold text-lg\">${grossProfit.toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">å…¬å¸é›œæ”¯ ({memberCount} äºº Ã— $10)</span>\n                <span className=\"font-medium text-red-600\">-${miscExpense.toLocaleString()}</span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-morandi-secondary\">ç¨…é‡‘ (12%)</span>\n                <span className=\"font-medium text-red-600\">-${tax.toLocaleString()}</span>\n              </div>\n              <div className=\"border-t border-morandi-gold/20 pt-2 flex justify-between\">\n                <span className=\"font-bold\">æ·¨åˆ©æ½¤</span>\n                <span className=\"font-bold text-xl text-green-600\">${netProfit.toLocaleString()}</span>\n              </div>\n            </div>\n\n            {/* æ¥­å‹™æ¥­ç¸¾ */}\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <Label className=\"text-base font-semibold\">æ¥­å‹™æ¥­ç¸¾</Label>\n                <Button variant=\"outline\" size=\"sm\" onClick={addSalesRecipient}>\n                  <Plus size={14} className=\"mr-1\" />\n                  æ–°å¢æ¥­å‹™\n                </Button>\n              </div>\n              <div className=\"space-y-2\">\n                {salesRecipients.map((recipient, index) => (\n                  <div key={index} className=\"flex items-center gap-2\">\n                    <select\n                      value={recipient.employeeId}\n                      onChange={e => {\n                        const newRecipients = [...salesRecipients]\n                        newRecipients[index].employeeId = e.target.value\n                        setSalesRecipients(newRecipients)\n                      }}\n                      className=\"flex-1 px-3 py-2 border border-morandi-gold/30 rounded-lg text-sm\"\n                    >\n                      <option value=\"\">é¸æ“‡æ¥­å‹™</option>\n                      {employees.map(emp => (\n                        <option key={emp.id} value={emp.id}>{emp.name}</option>\n                      ))}\n                    </select>\n                    <Input\n                      type=\"number\"\n                      value={recipient.percentage || ''}\n                      onChange={e => {\n                        const newRecipients = [...salesRecipients]\n                        newRecipients[index].percentage = parseFloat(e.target.value) || 0\n                        setSalesRecipients(newRecipients)\n                      }}\n                      className=\"w-24\"\n                      placeholder=\"%\"\n                    />\n                    <span className=\"text-sm text-morandi-secondary min-w-[80px]\">\n                      ${Math.round(netProfit * (recipient.percentage / 100)).toLocaleString()}\n                    </span>\n                    {salesRecipients.length > 1 && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => removeSalesRecipient(index)}\n                      >\n                        <X size={16} />\n                      </Button>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* OP çé‡‘ */}\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <Label className=\"text-base font-semibold\">OP çé‡‘</Label>\n                <Button variant=\"outline\" size=\"sm\" onClick={addOpRecipient}>\n                  <Plus size={14} className=\"mr-1\" />\n                  æ–°å¢ OP\n                </Button>\n              </div>\n              <div className=\"space-y-2\">\n                {opRecipients.map((recipient, index) => (\n                  <div key={index} className=\"flex items-center gap-2\">\n                    <select\n                      value={recipient.employeeId}\n                      onChange={e => {\n                        const newRecipients = [...opRecipients]\n                        newRecipients[index].employeeId = e.target.value\n                        setOpRecipients(newRecipients)\n                      }}\n                      className=\"flex-1 px-3 py-2 border border-morandi-gold/30 rounded-lg text-sm\"\n                    >\n                      <option value=\"\">é¸æ“‡ OP</option>\n                      {employees.map(emp => (\n                        <option key={emp.id} value={emp.id}>{emp.name}</option>\n                      ))}\n                    </select>\n                    <Input\n                      type=\"number\"\n                      value={recipient.percentage || ''}\n                      onChange={e => {\n                        const newRecipients = [...opRecipients]\n                        newRecipients[index].percentage = parseFloat(e.target.value) || 0\n                        setOpRecipients(newRecipients)\n                      }}\n                      className=\"w-24\"\n                      placeholder=\"%\"\n                    />\n                    <span className=\"text-sm text-morandi-secondary min-w-[80px]\">\n                      ${Math.round(netProfit * (recipient.percentage / 100)).toLocaleString()}\n                    </span>\n                    {opRecipients.length > 1 && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => removeOpRecipient(index)}\n                      >\n                        <X size={16} />\n                      </Button>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* æŒ‰éˆ• */}\n            <div className=\"flex justify-end gap-2 pt-4\">\n              <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n                å–æ¶ˆ\n              </Button>\n              <Button onClick={handleCloseTour} disabled={loading}>\n                {loading ? 'è™•ç†ä¸­...' : 'ç¢ºèªçµåœ˜'}\n              </Button>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-costs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-departure-dialog.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":12,"column":1,"severity":1,"nodeType":null,"fix":{"range":[442,504],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useState, useEffect } from 'react'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Tour } from '@/types/tour.types'\nimport { supabase as supabaseClient } from '@/lib/supabase/client'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst supabase = supabaseClient as any\nimport { toast } from 'sonner'\nimport { Plus, X, FileText } from 'lucide-react'\nimport type {\n  TourDepartureData,\n  TourDepartureMeal,\n  TourDepartureAccommodation,\n  TourDepartureActivity,\n  TourDepartureOther,\n} from '@/types/tour-departure.types'\n\ninterface TourDepartureDialogProps {\n  tour: Tour\n  open: boolean\n  onOpenChange: (open: boolean) => void\n}\n\nexport function TourDepartureDialog({ tour, open, onOpenChange }: TourDepartureDialogProps) {\n  const [loading, setLoading] = useState(false)\n  const [data, setData] = useState<TourDepartureData | null>(null)\n  const [meals, setMeals] = useState<TourDepartureMeal[]>([])\n  const [accommodations, setAccommodations] = useState<TourDepartureAccommodation[]>([])\n  const [activities, setActivities] = useState<TourDepartureActivity[]>([])\n  const [others, setOthers] = useState<TourDepartureOther[]>([])\n\n  // è¼‰å…¥å‡ºåœ˜è³‡æ–™\n  useEffect(() => {\n    if (open) {\n      loadDepartureData()\n    }\n  }, [open, tour.id])\n\n  const loadDepartureData = async () => {\n    try {\n      setLoading(true)\n\n      // è¼‰å…¥ä¸»è¡¨è³‡æ–™\n      const { data: mainData, error: mainError } = await supabase\n        .from('tour_departure_data')\n        .select('*')\n        .eq('tour_id', tour.id)\n        .single()\n\n      if (mainError && mainError.code !== 'PGRST116') {\n        throw mainError\n      }\n\n      if (mainData) {\n        setData(mainData as unknown as TourDepartureData)\n\n        // è¼‰å…¥é¤é£Ÿ\n        const { data: mealsData } = await supabase\n          .from('tour_departure_meals')\n          .select('*')\n          .eq('departure_data_id', mainData.id)\n          .order('date', { ascending: true })\n          .order('display_order', { ascending: true })\n        setMeals((mealsData || []) as TourDepartureMeal[])\n\n        // è¼‰å…¥ä½å®¿\n        const { data: accomData } = await supabase\n          .from('tour_departure_accommodations')\n          .select('*')\n          .eq('departure_data_id', mainData.id)\n          .order('date', { ascending: true })\n          .order('display_order', { ascending: true })\n        setAccommodations((accomData || []) as TourDepartureAccommodation[])\n\n        // è¼‰å…¥æ´»å‹•\n        const { data: activData } = await supabase\n          .from('tour_departure_activities')\n          .select('*')\n          .eq('departure_data_id', mainData.id)\n          .order('date', { ascending: true })\n          .order('display_order', { ascending: true })\n        setActivities((activData || []) as TourDepartureActivity[])\n\n        // è¼‰å…¥å…¶ä»–\n        const { data: othersData } = await supabase\n          .from('tour_departure_others')\n          .select('*')\n          .eq('departure_data_id', mainData.id)\n          .order('date', { ascending: true })\n          .order('display_order', { ascending: true })\n        setOthers((othersData || []) as TourDepartureOther[])\n      } else {\n        // åˆå§‹åŒ–ç©ºè³‡æ–™\n        setData({\n          id: '',\n          tour_id: tour.id,\n          service_fee_per_person: 1500,\n          petty_cash: 0,\n        } as unknown as TourDepartureData)\n      }\n    } catch (error) {\n      logger.error('è¼‰å…¥å‡ºåœ˜è³‡æ–™å¤±æ•—:', error)\n      toast.error('è¼‰å…¥å¤±æ•—')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // å„²å­˜è³‡æ–™\n  const handleSave = async () => {\n    if (!data) return\n\n    setLoading(true)\n    try {\n      // å„²å­˜ä¸»è¡¨è³‡æ–™\n      let departureDataId = data.id\n\n      if (!departureDataId) {\n        // æ–°å»º\n        const { data: newData, error } = await supabase\n          .from('tour_departure_data')\n          .insert({\n            ...data,\n            tour_id: tour.id,\n          })\n          .select()\n          .single()\n\n        if (error) throw error\n        departureDataId = newData.id\n      } else {\n        // æ›´æ–°\n        const { error } = await supabase\n          .from('tour_departure_data')\n          .update(data)\n          .eq('id', departureDataId)\n\n        if (error) throw error\n      }\n\n      toast.success('å„²å­˜æˆåŠŸ')\n      onOpenChange(false)\n    } catch (error) {\n      logger.error('å„²å­˜å¤±æ•—:', error)\n      toast.error('å„²å­˜å¤±æ•—')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading || !data) {\n    return (\n      <Dialog open={open} onOpenChange={onOpenChange}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n          <div className=\"py-8 text-center text-morandi-secondary\">è¼‰å…¥ä¸­...</div>\n        </DialogContent>\n      </Dialog>\n    )\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>å‡ºåœ˜è³‡æ–™è¡¨ - {tour.name}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* åŸºæœ¬è³‡è¨Š */}\n          <div className=\"bg-morandi-container/20 rounded-lg p-4\">\n            <h3 className=\"font-semibold mb-3\">åŸºæœ¬è³‡è¨Š</h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label>éš¨åœ˜é ˜éšŠ</Label>\n                <Input\n                  value={data.tour_leader || ''}\n                  onChange={e => setData({ ...data, tour_leader: e.target.value })}\n                  placeholder=\"ä¾‹ï¼šæ± å¸¥ç”Ÿï¼Ike\"\n                />\n              </div>\n              <div>\n                <Label>é ˜éšŠè¯çµ¡æ–¹å¼</Label>\n                <Input\n                  value={data.tour_leader_contact || ''}\n                  onChange={e => setData({ ...data, tour_leader_contact: e.target.value })}\n                  placeholder=\"é›»è©±æˆ– Email\"\n                />\n              </div>\n              <div>\n                <Label>æ‰¿è¾¦æ¥­å‹™</Label>\n                <Input\n                  value={data.sales_person || ''}\n                  onChange={e => setData({ ...data, sales_person: e.target.value })}\n                  placeholder=\"ä¾‹ï¼šJessï¼02-7756051#12\"\n                />\n              </div>\n              <div>\n                <Label>åŠ©ç†äººå“¡</Label>\n                <Input\n                  value={data.assistant_person || ''}\n                  onChange={e => setData({ ...data, assistant_person: e.target.value })}\n                  placeholder=\"ä¾‹ï¼šCarsonï¼02-7756051#20\"\n                />\n              </div>\n              <div className=\"col-span-2\">\n                <Label>èˆªç­è³‡è¨Š</Label>\n                <Input\n                  value={data.flight_info || ''}\n                  onChange={e => setData({ ...data, flight_info: e.target.value })}\n                  placeholder=\"ä¾‹ï¼šBR-112 06:55-09:15ï¼BR-113 10:15-10:55\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* å…¶ä»–è²»ç”¨è¨­å®š */}\n          <div className=\"bg-morandi-container/20 rounded-lg p-4\">\n            <h3 className=\"font-semibold mb-3\">å…¶ä»–è²»ç”¨è¨­å®š</h3>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label>é ˜éšŠæœå‹™è²»ï¼ˆæ¯äººï¼‰</Label>\n                <Input\n                  type=\"number\"\n                  value={data.service_fee_per_person || 1500}\n                  onChange={e =>\n                    setData({ ...data, service_fee_per_person: parseInt(e.target.value) || 0 })\n                  }\n                />\n              </div>\n              <div>\n                <Label>é›¶ç”¨é‡‘</Label>\n                <Input\n                  type=\"number\"\n                  value={data.petty_cash || 0}\n                  onChange={e => setData({ ...data, petty_cash: parseInt(e.target.value) || 0 })}\n                />\n              </div>\n            </div>\n          </div>\n\n          {/* æç¤ºè¨Šæ¯ */}\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800\">\n            <p>\n              <strong>æç¤ºï¼š</strong>\n              åŸºæœ¬è³‡è¨Šå„²å­˜å¾Œï¼Œå¯åœ¨ä¸‹ä¸€æ­¥ç·¨è¼¯é¤é£Ÿã€ä½å®¿ã€æ´»å‹•ç­‰è©³ç´°è³‡è¨Šã€‚\n            </p>\n            <p className=\"mt-1\">äº¤é€šè¡¨æœƒå¾è¡Œç¨‹è¡¨è‡ªå‹•å¸¶å…¥ï¼Œç„¡éœ€æ‰‹å‹•å¡«å¯«ã€‚</p>\n          </div>\n\n          {/* æŒ‰éˆ• */}\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={handleSave} disabled={loading}>\n              {loading ? 'å„²å­˜ä¸­...' : 'å„²å­˜'}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-documents.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-unused-vars').","line":40,"column":3,"severity":1,"nodeType":null,"fix":{"range":[820,881],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { useState } from 'react'\nimport { ContentContainer } from '@/components/layout/content-container'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Tour } from '@/stores/types'\nimport {\n  FileText,\n  Upload,\n  Download,\n  Eye,\n  CheckCircle,\n  AlertCircle,\n  Clock,\n  Plus,\n  LucideIcon,\n} from 'lucide-react'\n\ninterface MockDocument {\n  id: string\n  name: string\n  type: string\n  description: string\n  status: string\n  format: string\n  size: string\n  uploadDate: string\n  signedBy?: string\n  order_id?: string\n}\n\ninterface TourDocumentsProps {\n  tour: Tour\n  orderFilter?: string\n}\n\nexport function TourDocuments({ orderFilter }: TourDocumentsProps) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [isUploadDialogOpen, setIsUploadDialogOpen] = useState(false)\n  const [newDocument, setNewDocument] = useState({\n    name: '',\n    type: 'contract',\n    description: '',\n  })\n\n  const allMockDocuments: MockDocument[] = []\n\n  const mockDocuments = orderFilter\n    ? allMockDocuments.filter(doc => doc.order_id === orderFilter)\n    : allMockDocuments\n\n  const handleUploadDocument = () => {\n    if (!newDocument.name) return\n\n    setNewDocument({\n      name: '',\n      type: 'contract',\n      description: '',\n    })\n    setIsUploadDialogOpen(false)\n  }\n\n  const getStatusIcon = (status: string): LucideIcon => {\n    const icons: Record<string, LucideIcon> = {\n      å·²ç°½ç½²: CheckCircle,\n      å·²ç¢ºèª: CheckCircle,\n      å¾…ç¢ºèª: Clock,\n      å¾…ç°½ç½²: AlertCircle,\n    }\n    return icons[status] || Clock\n  }\n\n  const getStatusBadge = (status: string) => {\n    const badges: Record<string, string> = {\n      å·²ç°½ç½²: 'bg-morandi-green text-white',\n      å·²ç¢ºèª: 'bg-morandi-green text-white',\n      å¾…ç¢ºèª: 'bg-morandi-gold text-white',\n      å¾…ç°½ç½²: 'bg-morandi-red text-white',\n    }\n    return badges[status] || 'bg-morandi-container text-morandi-secondary'\n  }\n\n  const getTypeColor = (type: string) => {\n    const colors: Record<string, string> = {\n      åˆç´„: 'text-red-600',\n      è¡Œç¨‹: 'text-blue-600',\n      ä¿éšª: 'text-green-600',\n      ç¥¨å‹™: 'text-purple-600',\n      ä½å®¿: 'text-orange-600',\n    }\n    return colors[type] || 'text-gray-600'\n  }\n\n  const documentsByType = mockDocuments.reduce(\n    (acc, doc) => {\n      if (!acc[doc.type]) acc[doc.type] = []\n      acc[doc.type].push(doc)\n      return acc\n    },\n    {} as Record<string, MockDocument[]>\n  )\n\n  return (\n    <div className=\"space-y-6\">\n      {/* æ–‡ä»¶çµ±è¨ˆ */}\n      <ContentContainer>\n        <h3 className=\"text-lg font-semibold text-morandi-primary mb-4\">æ–‡ä»¶ç‹€æ…‹æ¦‚è¦½</h3>\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">{mockDocuments.length}</div>\n            <div className=\"text-sm text-morandi-secondary\">ç¸½æ–‡ä»¶æ•¸</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-green\">\n              {mockDocuments.filter(doc => doc.status.includes('å·²')).length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å·²ç¢ºèª</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-gold\">\n              {mockDocuments.filter(doc => doc.status.includes('å¾…')).length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å¾…è™•ç†</div>\n          </div>\n          <div className=\"bg-morandi-container p-4 rounded-lg\">\n            <div className=\"text-2xl font-bold text-morandi-primary\">\n              {mockDocuments.filter(doc => doc.signedBy).length}\n            </div>\n            <div className=\"text-sm text-morandi-secondary\">å·²ç°½ç½²</div>\n          </div>\n        </div>\n      </ContentContainer>\n\n      {/* æ–‡ä»¶æ“ä½œæŒ‰éˆ• - å³ä¸Šè§’ */}\n      <div className=\"flex justify-end gap-2 mb-6\">\n        <Button variant=\"outline\">\n          <Download size={16} className=\"mr-2\" />\n          æ‰¹é‡ä¸‹è¼‰\n        </Button>\n        <Button\n          onClick={() => setIsUploadDialogOpen(true)}\n          className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n        >\n          <Plus size={16} className=\"mr-2\" />\n          ä¸Šå‚³æ–‡ä»¶\n        </Button>\n      </div>\n\n      {/* æ–‡ä»¶åˆ†é¡å±•ç¤º */}\n      <div className=\"space-y-6\">\n        {Object.entries(documentsByType).map(([type, documents]) => (\n          <ContentContainer key={type}>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h4 className=\"text-lg font-medium text-morandi-primary flex items-center\">\n                <FileText size={20} className={`mr-2 ${getTypeColor(type)}`} />\n                {type}æ–‡ä»¶\n                <span className=\"ml-2 text-sm text-morandi-secondary\">\n                  ({documents.length} å€‹æ–‡ä»¶)\n                </span>\n              </h4>\n            </div>\n\n            <div className=\"space-y-2\">\n              {documents.map((doc) => {\n                const StatusIcon = getStatusIcon(doc.status)\n                return (\n                  <div\n                    key={doc.id}\n                    className=\"grid grid-cols-12 gap-4 p-4 bg-card border border-border rounded-lg hover:shadow-md transition-shadow\"\n                  >\n                    <div className=\"col-span-3\">\n                      <div className=\"flex items-center\">\n                        <StatusIcon\n                          size={16}\n                          className={\n                            doc.status.includes('å·²')\n                              ? 'text-morandi-green'\n                              : doc.status.includes('å¾…')\n                                ? 'text-morandi-gold'\n                                : 'text-morandi-red'\n                          }\n                        />\n                        <div className=\"ml-2\">\n                          <div className=\"font-medium text-morandi-primary\">{doc.name}</div>\n                          <div className=\"text-xs text-morandi-secondary\">\n                            {doc.format} â€¢ {doc.size}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"col-span-3\">\n                      <div className=\"text-sm text-morandi-primary\">{doc.description}</div>\n                      {doc.signedBy && (\n                        <div className=\"text-xs text-morandi-secondary\">ç°½ç½²äººï¼š{doc.signedBy}</div>\n                      )}\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <div className=\"text-sm text-morandi-primary\">{doc.uploadDate}</div>\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <span\n                        className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadge(doc.status)}`}\n                      >\n                        {doc.status}\n                      </span>\n                    </div>\n\n                    <div className=\"col-span-2\">\n                      <div className=\"flex gap-1\">\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Eye size={12} className=\"mr-1\" />\n                          é è¦½\n                        </Button>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <Download size={12} className=\"mr-1\" />\n                          ä¸‹è¼‰\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                )\n              })}\n            </div>\n          </ContentContainer>\n        ))}\n      </div>\n\n      {/* ä¸Šå‚³æ–‡ä»¶å°è©±æ¡† */}\n      <Dialog open={isUploadDialogOpen} onOpenChange={setIsUploadDialogOpen}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>ä¸Šå‚³æ–‡ä»¶</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ–‡ä»¶åç¨±</label>\n              <Input\n                value={newDocument.name}\n                onChange={e => setNewDocument(prev => ({ ...prev, name: e.target.value }))}\n                placeholder=\"è¼¸å…¥æ–‡ä»¶åç¨±\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">æ–‡ä»¶é¡å‹</label>\n              <select\n                value={newDocument.type}\n                onChange={e => setNewDocument(prev => ({ ...prev, type: e.target.value }))}\n                className=\"mt-1 w-full p-2 border border-border rounded-md bg-background\"\n              >\n                <option value=\"contract\">åˆç´„</option>\n                <option value=\"itinerary\">è¡Œç¨‹</option>\n                <option value=\"insurance\">ä¿éšª</option>\n                <option value=\"ticket\">ç¥¨å‹™</option>\n                <option value=\"accommodation\">ä½å®¿</option>\n                <option value=\"other\">å…¶ä»–</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary\">èªªæ˜</label>\n              <Input\n                value={newDocument.description}\n                onChange={e => setNewDocument(prev => ({ ...prev, description: e.target.value }))}\n                placeholder=\"æ–‡ä»¶èªªæ˜\"\n                className=\"mt-1\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium text-morandi-primary mb-2 block\">\n                é¸æ“‡æª”æ¡ˆ\n              </label>\n              <div className=\"border-2 border-dashed border-morandi-container rounded-lg p-6 text-center\">\n                <Upload size={32} className=\"mx-auto mb-2 text-morandi-secondary\" />\n                <p className=\"text-sm text-morandi-secondary mb-2\">æ‹–æ‹½æª”æ¡ˆåˆ°æ­¤è™•æˆ–é»æ“Šé¸æ“‡</p>\n                <Button variant=\"outline\" size=\"sm\">\n                  é¸æ“‡æª”æ¡ˆ\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"flex justify-end space-x-2\">\n              <Button variant=\"outline\" onClick={() => setIsUploadDialogOpen(false)}>\n                å–æ¶ˆ\n              </Button>\n              <Button\n                onClick={handleUploadDocument}\n                className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n              >\n                ä¸Šå‚³\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-handover-print.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-members-advanced.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":7,"column":1,"severity":1,"nodeType":null,"fix":{"range":[170,232],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useState, useEffect } from 'react'\nimport { supabase as supabaseClient } from '@/lib/supabase/client'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst supabase = supabaseClient as any\nimport { Tour } from '@/types/tour.types'\nimport { Button } from '@/components/ui/button'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\nimport { Plus, Trash2, GripVertical, Printer } from 'lucide-react'\nimport { toast } from 'sonner'\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core'\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  useSortable,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable'\nimport { CSS } from '@dnd-kit/utilities'\nimport { TourHandoverPrint } from './tour-handover-print'\n\ninterface OrderMember {\n  id: string\n  order_id: string\n  chinese_name: string | null\n  passport_name: string | null\n  birth_date: string | null\n  gender: string | null\n  id_number: string | null\n  passport_number: string | null\n  passport_expiry: string | null\n  special_meal: string | null\n  pnr: string | null\n}\n\ninterface MemberFieldValue {\n  [memberId: string]: {\n    [fieldName: string]: string\n  }\n}\n\ninterface TourMembersAdvancedProps {\n  tour: Tour\n}\n\n// æ‹–æ›³è¡Œçµ„ä»¶\nfunction SortableRow({\n  member,\n  index,\n  customFields,\n  getFieldValue,\n  updateFieldValue,\n  isDragMode\n}: {\n  member: OrderMember\n  index: number\n  customFields: string[]\n  getFieldValue: (memberId: string, fieldName: string) => string\n  updateFieldValue: (memberId: string, fieldName: string, value: string) => void\n  isDragMode: boolean\n}) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: member.id })\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  }\n\n  return (\n    <tr\n      ref={setNodeRef}\n      style={style}\n      className={`border-b border-morandi-gold/10 hover:bg-morandi-container/10 ${\n        index % 2 === 0 ? 'bg-blue-50/30' : 'bg-green-50/30'\n      } ${isDragging ? 'z-50' : ''}`}\n    >\n      {/* æ‹–æ›³æ‰‹æŠŠ */}\n      {isDragMode && (\n        <td className=\"px-2 py-2 cursor-grab active:cursor-grabbing\" {...attributes} {...listeners}>\n          <GripVertical size={16} className=\"text-morandi-text-light\" />\n        </td>\n      )}\n\n      <td className=\"px-3 py-2 text-xs text-morandi-text-light\">\n        {member.order_id.slice(0, 8)}...\n      </td>\n      <td className=\"px-3 py-2\">{member.chinese_name || '-'}</td>\n      <td className=\"px-3 py-2\">{member.passport_name || '-'}</td>\n      <td className=\"px-3 py-2 text-xs\">{member.birth_date || '-'}</td>\n      <td className=\"px-3 py-2 text-center\">\n        {member.gender === 'M' ? 'ç”·' : member.gender === 'F' ? 'å¥³' : '-'}\n      </td>\n      <td className=\"px-3 py-2\">{member.passport_number || '-'}</td>\n      <td className=\"px-3 py-2 text-xs\">{member.special_meal || '-'}</td>\n      {customFields.map(field => (\n        <td key={field} className=\"px-3 py-2 bg-white\">\n          <input\n            type=\"text\"\n            value={getFieldValue(member.id, field)}\n            onChange={e => updateFieldValue(member.id, field, e.target.value)}\n            className=\"w-full bg-transparent text-xs border-none outline-none focus:bg-morandi-container/20 px-2 py-1 rounded\"\n            placeholder=\"-\"\n            disabled={isDragMode}\n          />\n        </td>\n      ))}\n    </tr>\n  )\n}\n\nexport function TourMembersAdvanced({ tour }: TourMembersAdvancedProps) {\n  const [members, setMembers] = useState<OrderMember[]>([])\n  const [customFields, setCustomFields] = useState<string[]>([])\n  const [fieldValues, setFieldValues] = useState<MemberFieldValue>({})\n  const [loading, setLoading] = useState(true)\n  const [showAddFieldDialog, setShowAddFieldDialog] = useState(false)\n  const [newFieldName, setNewFieldName] = useState('')\n  const [isDragMode, setIsDragMode] = useState(false)\n  const [showPrintPreview, setShowPrintPreview] = useState(false)\n\n  // æ‹–æ›³æ„Ÿæ‡‰å™¨\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  )\n\n  // è¼‰å…¥åœ˜å“¡è³‡æ–™\n  useEffect(() => {\n    loadMembers()\n  }, [tour.id])\n\n  const loadMembers = async () => {\n    try {\n      // 1. æ‰¾å‡ºæ‰€æœ‰å±¬æ–¼é€™å€‹åœ˜çš„è¨‚å–®\n      const { data: orders, error: ordersError } = await supabase\n        .from('orders')\n        .select('id')\n        .eq('tour_id', tour.id)\n\n      if (ordersError) throw ordersError\n\n      const orderIds = orders?.map((o: { id: string }) => o.id) || []\n\n      if (orderIds.length === 0) {\n        setMembers([])\n        setLoading(false)\n        return\n      }\n\n      // 2. æŠ“å–é€™äº›è¨‚å–®çš„æ‰€æœ‰åœ˜å“¡\n      const { data: membersData, error: membersError } = await supabase\n        .from('order_members')\n        .select('*')\n        .in('order_id', orderIds)\n        .order('created_at', { ascending: true })\n\n      if (membersError) throw membersError\n\n      setMembers((membersData || []) as unknown as OrderMember[])\n\n      // 3. è¼‰å…¥å·²å»ºç«‹çš„å‹•æ…‹æ¬„ä½\n      await loadCustomFields()\n\n      // 4. è¼‰å…¥å‹•æ…‹æ¬„ä½çš„å€¼\n      await loadFieldValues()\n    } catch (error) {\n      logger.error('è¼‰å…¥åœ˜å“¡å¤±æ•—:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const loadCustomFields = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tour_member_fields')\n        .select('field_name')\n        .eq('tour_id', tour.id)\n\n      if (error) throw error\n\n      // å–å¾—æ‰€æœ‰ä¸é‡è¤‡çš„æ¬„ä½åç¨±\n      const fieldData = data as Array<{ field_name: string }> | null\n      const uniqueFields = [...new Set(fieldData?.map(d => d.field_name) || [])]\n      setCustomFields(uniqueFields)\n    } catch (error) {\n      logger.error('è¼‰å…¥è‡ªè¨‚æ¬„ä½å¤±æ•—:', error)\n    }\n  }\n\n  const loadFieldValues = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('tour_member_fields')\n        .select('*')\n        .eq('tour_id', tour.id)\n\n      if (error) throw error\n\n      // çµ„ç¹”æˆ { memberId: { fieldName: value } } çµæ§‹\n      const values: MemberFieldValue = {}\n      const fieldData = data as Array<{\n        order_member_id: string\n        field_name: string\n        field_value: string | null\n      }> | null\n\n      fieldData?.forEach(item => {\n        if (!values[item.order_member_id]) {\n          values[item.order_member_id] = {}\n        }\n        values[item.order_member_id][item.field_name] = item.field_value || ''\n      })\n\n      setFieldValues(values)\n    } catch (error) {\n      logger.error('è¼‰å…¥æ¬„ä½å€¼å¤±æ•—:', error)\n    }\n  }\n\n  // æ–°å¢è‡ªè¨‚æ¬„ä½\n  const handleAddField = async () => {\n    if (!newFieldName.trim()) {\n      toast.error('è«‹è¼¸å…¥æ¬„ä½åç¨±')\n      return\n    }\n\n    if (customFields.includes(newFieldName.trim())) {\n      toast.error('æ¬„ä½åç¨±å·²å­˜åœ¨')\n      return\n    }\n\n    setCustomFields([...customFields, newFieldName.trim()])\n    setNewFieldName('')\n    setShowAddFieldDialog(false)\n    toast.success(`å·²æ–°å¢æ¬„ä½ï¼š${newFieldName.trim()}`)\n  }\n\n  // åˆªé™¤è‡ªè¨‚æ¬„ä½\n  const handleDeleteField = async (fieldName: string) => {\n    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${fieldName}ã€æ¬„ä½å—ï¼Ÿæ‰€æœ‰è³‡æ–™å°‡ä¸€ä½µåˆªé™¤ã€‚`)) {\n      return\n    }\n\n    try {\n      // åˆªé™¤è³‡æ–™åº«ä¸­çš„æ‰€æœ‰è©²æ¬„ä½è³‡æ–™\n      const { error } = await supabase\n        .from('tour_member_fields')\n        .delete()\n        .eq('tour_id', tour.id)\n        .eq('field_name', fieldName)\n\n      if (error) throw error\n\n      // æ›´æ–°æœ¬åœ°ç‹€æ…‹\n      setCustomFields(customFields.filter(f => f !== fieldName))\n\n      // æ¸…é™¤æ¬„ä½å€¼\n      const newFieldValues = { ...fieldValues }\n      Object.keys(newFieldValues).forEach(memberId => {\n        delete newFieldValues[memberId][fieldName]\n      })\n      setFieldValues(newFieldValues)\n\n      toast.success(`å·²åˆªé™¤æ¬„ä½ï¼š${fieldName}`)\n    } catch (error) {\n      logger.error('åˆªé™¤æ¬„ä½å¤±æ•—:', error)\n      toast.error('åˆªé™¤æ¬„ä½å¤±æ•—')\n    }\n  }\n\n  // æ›´æ–°å‹•æ…‹æ¬„ä½å€¼\n  const updateFieldValue = async (memberId: string, fieldName: string, value: string) => {\n    // ç«‹å³æ›´æ–°æœ¬åœ°ç‹€æ…‹\n    setFieldValues(prev => ({\n      ...prev,\n      [memberId]: {\n        ...prev[memberId],\n        [fieldName]: value\n      }\n    }))\n\n    try {\n      // Upsert åˆ°è³‡æ–™åº«\n      const { error } = await supabase\n        .from('tour_member_fields')\n        .upsert({\n          tour_id: tour.id,\n          order_member_id: memberId,\n          field_name: fieldName,\n          field_value: value,\n          display_order: 0\n        }, {\n          onConflict: 'tour_id,order_member_id,field_name'\n        })\n\n      if (error) throw error\n    } catch (error) {\n      logger.error('æ›´æ–°æ¬„ä½å€¼å¤±æ•—:', error)\n      // å¤±æ•—æ™‚é‡æ–°è¼‰å…¥\n      loadFieldValues()\n    }\n  }\n\n  // å–å¾—æ¬„ä½å€¼\n  const getFieldValue = (memberId: string, fieldName: string): string => {\n    return fieldValues[memberId]?.[fieldName] || ''\n  }\n\n  // æ‹–æ›³çµæŸè™•ç†\n  const handleDragEnd = (event: DragEndEvent) => {\n    const { active, over } = event\n\n    if (!over || active.id === over.id) {\n      return\n    }\n\n    setMembers(items => {\n      const oldIndex = items.findIndex(item => item.id === active.id)\n      const newIndex = items.findIndex(item => item.id === over.id)\n\n      return arrayMove(items, oldIndex, newIndex)\n    })\n\n    toast.success('é †åºå·²æ›´æ–°')\n  }\n\n  if (loading) {\n    return <div className=\"p-6 text-center\">è¼‰å…¥ä¸­...</div>\n  }\n\n  if (members.length === 0) {\n    return (\n      <div className=\"p-6 text-center\">\n        <p className=\"text-morandi-secondary mb-4\">ç›®å‰æ²’æœ‰åœ˜å“¡</p>\n        <p className=\"text-sm text-morandi-text-light\">è«‹å…ˆåœ¨ã€Œè¨‚å–®ç®¡ç†ã€ä¸­æ–°å¢è¨‚å–®å’Œåœ˜å“¡</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* å·¥å…·åˆ— */}\n      <div className=\"flex items-center justify-between px-6 py-4 border-b border-morandi-gold/20\">\n        <div className=\"flex items-center gap-4\">\n          <h2 className=\"text-lg font-medium text-morandi-primary\">\n            åœ˜å“¡åå–®ç¸½è¦½ ({members.length} äºº)\n          </h2>\n          {isDragMode && (\n            <span className=\"text-sm text-orange-600 bg-orange-50 px-3 py-1 rounded-full\">\n              æ‹–æ›³æ¨¡å¼\n            </span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={isDragMode ? 'default' : 'outline'}\n            size=\"sm\"\n            onClick={() => setIsDragMode(!isDragMode)}\n          >\n            {isDragMode ? 'å®Œæˆæ’åº' : 'æ’åºæ¨¡å¼'}\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowAddFieldDialog(true)}\n          >\n            <Plus size={16} className=\"mr-1\" />\n            æ–°å¢æ¬„ä½\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => setShowPrintPreview(true)}\n          >\n            <Printer size={16} className=\"mr-1\" />\n            åˆ—å°äº¤æ¥å–®\n          </Button>\n        </div>\n      </div>\n\n      {/* åœ˜å“¡åˆ—è¡¨ */}\n      <div className=\"flex-1 overflow-auto p-6\">\n        <div className=\"bg-white rounded-lg border border-morandi-gold/20 overflow-hidden\">\n          <DndContext\n            sensors={sensors}\n            collisionDetection={closestCenter}\n            onDragEnd={handleDragEnd}\n          >\n            <table className=\"w-full text-sm\">\n              <thead>\n                <tr className=\"bg-morandi-container/30 border-b border-morandi-gold/20\">\n                  {isDragMode && <th className=\"w-10\"></th>}\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs w-24\">è¨‚å–®</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs\">ä¸­æ–‡å§“å</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs\">è­·ç…§æ‹¼éŸ³</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs\">ç”Ÿæ—¥</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs w-16\">æ€§åˆ¥</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs\">è­·ç…§è™Ÿç¢¼</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs\">ç‰¹æ®Šé¤é£Ÿ</th>\n                  {customFields.map(field => (\n                    <th key={field} className=\"px-3 py-2 text-left font-medium text-morandi-secondary text-xs bg-morandi-gold/10 relative group\">\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <span>{field}</span>\n                        {!isDragMode && (\n                          <button\n                            onClick={() => handleDeleteField(field)}\n                            className=\"opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-100 rounded\"\n                            title=\"åˆªé™¤æ¬„ä½\"\n                          >\n                            <Trash2 size={12} className=\"text-red-500\" />\n                          </button>\n                        )}\n                      </div>\n                    </th>\n                  ))}\n                </tr>\n              </thead>\n              <SortableContext items={members.map(m => m.id)} strategy={verticalListSortingStrategy}>\n                <tbody>\n                  {members.map((member, index) => (\n                    <SortableRow\n                      key={member.id}\n                      member={member}\n                      index={index}\n                      customFields={customFields}\n                      getFieldValue={getFieldValue}\n                      updateFieldValue={updateFieldValue}\n                      isDragMode={isDragMode}\n                    />\n                  ))}\n                </tbody>\n              </SortableContext>\n            </table>\n          </DndContext>\n        </div>\n      </div>\n\n      {/* æ–°å¢æ¬„ä½ Dialog */}\n      <Dialog open={showAddFieldDialog} onOpenChange={setShowAddFieldDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>æ–°å¢è‡ªè¨‚æ¬„ä½</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div>\n              <label className=\"text-sm font-medium text-morandi-secondary mb-2 block\">\n                æ¬„ä½åç¨±\n              </label>\n              <Input\n                value={newFieldName}\n                onChange={e => setNewFieldName(e.target.value)}\n                placeholder=\"ä¾‹å¦‚ï¼šåˆ†è»Šã€åˆ†æˆ¿ã€åˆ†æ¡Œ\"\n                onKeyDown={e => {\n                  if (e.key === 'Enter') {\n                    handleAddField()\n                  }\n                }}\n                autoFocus\n              />\n            </div>\n            <div className=\"flex justify-end gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setShowAddFieldDialog(false)\n                  setNewFieldName('')\n                }}\n              >\n                å–æ¶ˆ\n              </Button>\n              <Button onClick={handleAddField}>\n                ç¢ºå®š\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* åˆ—å°é è¦½ Dialog */}\n      <Dialog open={showPrintPreview} onOpenChange={setShowPrintPreview}>\n        <DialogContent className=\"max-w-[95vw] max-h-[95vh] overflow-auto\">\n          <div className=\"no-print flex items-center justify-between mb-4\">\n            <DialogHeader>\n              <DialogTitle>åˆ—å°é è¦½ - è·å‹™äº¤è¾¦å–®</DialogTitle>\n            </DialogHeader>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowPrintPreview(false)}\n              >\n                é—œé–‰\n              </Button>\n              <Button\n                onClick={() => window.print()}\n              >\n                <Printer size={16} className=\"mr-1\" />\n                åˆ—å°\n              </Button>\n            </div>\n          </div>\n          <TourHandoverPrint\n            tour={tour}\n            members={members as unknown as Parameters<typeof TourHandoverPrint>[0]['members']}\n            customFields={customFields}\n            fieldValues={fieldValues}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-members.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-operations.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-orders.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-overview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-payments.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/tours/tour-task-assignment.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/transportation/editable-rates-table/components/add-row.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/transportation/editable-rates-table/components/category-group-row.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":37,"column":3,"severity":1,"nodeType":null,"fix":{"range":[1596,1658],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport React from 'react'\nimport { TransportationRate } from '@/types/transportation-rates.types'\nimport { useSortable } from '@dnd-kit/sortable'\nimport { CSS } from '@dnd-kit/utilities'\nimport { DndContext, closestCenter, DragEndEvent, SensorDescriptor } from '@dnd-kit/core'\nimport { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable'\nimport { ItemRow } from './item-row'\n\ninterface CategoryGroup {\n  category: string\n  supplier: string\n  rates: TransportationRate[]\n  displayOrder: number\n}\n\ninterface CategoryGroupRowProps {\n  group: CategoryGroup\n  isEditMode: boolean\n  hideKKDAYColumns: boolean\n  editingCell: { rowId: string; field: keyof TransportationRate } | null\n  editValue: string\n  setEditValue: (value: string) => void\n  inputRef: React.RefObject<HTMLInputElement>\n  startEdit: (rowId: string, field: keyof TransportationRate, currentValue: unknown) => void\n  saveEdit: () => Promise<void>\n  handleKeyDown: (e: React.KeyboardEvent, rowId: string, field: keyof TransportationRate) => Promise<void>\n  renderEditableCell: (rate: TransportationRate, field: keyof TransportationRate, value: unknown, type?: 'text' | 'number') => React.ReactNode\n  onUpdate: (id: string, updates: Partial<TransportationRate>) => Promise<void>\n  onDelete: (id: string) => Promise<void>\n  onInsert?: (rate: TransportationRate) => void\n  setAddingAfterCategory: (category: string) => void\n  setIsAdding: (isAdding: boolean) => void\n  setNewRow: (row: Partial<TransportationRate>) => void\n  handleItemDragEnd: (categoryKey: string, event: DragEndEvent) => Promise<void>\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  sensors: SensorDescriptor<any>[]\n}\n\nexport function CategoryGroupRow({\n  group,\n  isEditMode,\n  hideKKDAYColumns,\n  editingCell,\n  editValue,\n  setEditValue,\n  inputRef,\n  startEdit,\n  saveEdit,\n  handleKeyDown,\n  renderEditableCell,\n  onUpdate,\n  onDelete,\n  onInsert,\n  setAddingAfterCategory,\n  setIsAdding,\n  setNewRow,\n  handleItemDragEnd,\n  sensors,\n}: CategoryGroupRowProps) {\n  const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({\n    id: `${group.category}_${group.supplier}`,\n  })\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  }\n\n  const categoryKey = `${group.category}_${group.supplier}`\n\n  // å“é …çš„è³‡æ–™åˆ—\n  const rows = group.rates.map((rate: TransportationRate, index: number) => (\n    <ItemRow\n      key={rate.id}\n      rate={rate}\n      index={index}\n      groupSize={group.rates.length}\n      isEditMode={isEditMode}\n      hideKKDAYColumns={hideKKDAYColumns}\n      editingCell={editingCell}\n      editValue={editValue}\n      setEditValue={setEditValue}\n      inputRef={inputRef}\n      startEdit={startEdit}\n      saveEdit={saveEdit}\n      handleKeyDown={handleKeyDown}\n      renderEditableCell={renderEditableCell}\n      onUpdate={onUpdate}\n      onDelete={onDelete}\n      onInsert={onInsert}\n      setAddingAfterCategory={setAddingAfterCategory}\n      setIsAdding={setIsAdding}\n      setNewRow={setNewRow}\n      category={group.category}\n      supplier={group.supplier}\n      isBackup={rate.is_backup || false}\n      categoryDragRef={index === 0 ? setNodeRef : undefined}\n      categoryDragStyle={index === 0 ? style : undefined}\n      categoryDragAttributes={index === 0 ? attributes as unknown as Record<string, unknown> : undefined}\n      categoryDragListeners={index === 0 ? listeners : undefined}\n    />\n  ))\n\n  // åŒ…è£¹ DndContext å’Œ SortableContextï¼ˆç´°é …æ‹–æ›³ï¼‰\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={closestCenter}\n      onDragEnd={(event) => handleItemDragEnd(categoryKey, event)}\n    >\n      <SortableContext items={group.rates.map((r: TransportationRate) => r.id)} strategy={verticalListSortingStrategy}>\n        {rows}\n      </SortableContext>\n    </DndContext>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/transportation/editable-rates-table/components/item-row.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/transportation/editable-rates-table/index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/color-picker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/combobox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/date-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/dropdown-menu.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":51,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1408,1470],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":55,"column":9,"severity":1,"nodeType":null,"fix":{"range":[1631,1693],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"'use client'\n\nimport * as React from 'react'\nimport { cn } from '@/lib/utils'\n\nconst DropdownMenu = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n    children: React.ReactNode\n  }\n>(({ className, open, onOpenChange, children, ...props }, ref) => {\n  const [isOpen, setIsOpen] = React.useState(open || false)\n\n  React.useEffect(() => {\n    if (open !== undefined) {\n      setIsOpen(open)\n    }\n  }, [open])\n\n  const handleOpenChange = (newOpen: boolean) => {\n    setIsOpen(newOpen)\n    onOpenChange?.(newOpen)\n  }\n\n  return (\n    <div ref={ref} className={cn('relative', className)} {...props}>\n      {React.Children.map(children, child =>\n        React.isValidElement(child)\n          ? React.cloneElement(child as React.ReactElement<{ isOpen?: boolean; onOpenChange?: (open: boolean) => void }>, {\n              isOpen,\n              onOpenChange: handleOpenChange,\n            })\n          : child\n      )}\n    </div>\n  )\n})\nDropdownMenu.displayName = 'DropdownMenu'\n\nconst DropdownMenuTrigger = React.forwardRef<\n  HTMLButtonElement,\n  React.ButtonHTMLAttributes<HTMLButtonElement> & {\n    isOpen?: boolean\n    onOpenChange?: (open: boolean) => void\n    asChild?: boolean\n  }\n>(({ className, children, isOpen, onOpenChange, asChild, ...props }, ref) => {\n  if (asChild && React.isValidElement(children)) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return React.cloneElement(children as React.ReactElement<any>, {\n      onClick: (e: React.MouseEvent<Element>) => {\n        onOpenChange?.(!isOpen)\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const childProps = children.props as any\n        childProps.onClick?.(e)\n      },\n      ...props,\n    })\n  }\n\n  return (\n    <button\n      ref={ref}\n      className={cn(\n        'flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors',\n        'focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring',\n        'disabled:pointer-events-none disabled:opacity-50',\n        className\n      )}\n      onClick={() => onOpenChange?.(!isOpen)}\n      {...props}\n    >\n      {children}\n    </button>\n  )\n})\nDropdownMenuTrigger.displayName = 'DropdownMenuTrigger'\n\nconst DropdownMenuContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    isOpen?: boolean\n    onOpenChange?: (open: boolean) => void\n    align?: 'start' | 'center' | 'end'\n  }\n>(({ className, children, isOpen, onOpenChange, align = 'start', ...props }, _ref) => {\n  const contentRef = React.useRef<HTMLDivElement>(null)\n\n  React.useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (contentRef.current && !contentRef.current.contains(event.target as Node)) {\n        onOpenChange?.(false)\n      }\n    }\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [isOpen, onOpenChange])\n\n  if (!isOpen) return null\n\n  return (\n    <div\n      ref={contentRef}\n      className={cn(\n        'absolute top-full z-50 min-w-[8rem] overflow-hidden rounded-md border border-border bg-white p-1 shadow-md',\n        'animate-in fade-in-0 zoom-in-95 data-[side=bottom]:slide-in-from-top-2',\n        align === 'start' && 'left-0',\n        align === 'center' && 'left-1/2 -translate-x-1/2',\n        align === 'end' && 'right-0',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n})\nDropdownMenuContent.displayName = 'DropdownMenuContent'\n\nconst DropdownMenuItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\n  ({ className, ...props }, ref) => (\n    <div\n      ref={ref}\n      className={cn(\n        'relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none',\n        'hover:bg-morandi-container hover:text-morandi-primary',\n        'focus:bg-morandi-container focus:text-morandi-primary',\n        'data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n        className\n      )}\n      {...props}\n    />\n  )\n)\nDropdownMenuItem.displayName = 'DropdownMenuItem'\n\nconst DropdownMenuSeparator = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn('-mx-1 my-1 h-px bg-muted', className)} {...props} />\n))\nDropdownMenuSeparator.displayName = 'DropdownMenuSeparator'\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/EnhancedTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/TableBody.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/TableHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/TablePagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/useEnhancedTable.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/enhanced-table/useTableState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/floating-dock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/input-ime.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/simple-date-input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/star-rating.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/ui/use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/widgets/calculator/calculatorUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/AdvanceListCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/CanvasEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/ChannelChat.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/ChannelSidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/ChannelTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/CreatePaymentRequestDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/CreateReceiptDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/OrderListCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/ShareAdvanceDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/ShareOrdersDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/ShareTodoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/canvas-editor/CanvasEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/canvas-editor/EditorContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/canvas-editor/EditorToolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/canvas-editor/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/canvas-editor/useCanvasEditor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/shared/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/shared/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/canvas/shared/useCanvasState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/ChatHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/ChatMessages.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/DialogsContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/useChannelEditState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/useChannelEffects.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":24,"column":5,"severity":1,"nodeType":null,"fix":{"range":[731,786],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":33,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1042,1097],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":49,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1458,1513],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":3,"source":"import { useEffect } from 'react'\nimport type { Channel, Workspace } from '@/stores/workspace-store'\nimport { DEFAULT_CHANNEL_NAME } from '../constants'\n\n/**\n * ç®¡ç†é »é“ç›¸é—œçš„å‰¯ä½œç”¨\n * åŒ…æ‹¬è¼‰å…¥é »é“ã€é¸æ“‡é è¨­é »é“ã€è¼‰å…¥é »é“è³‡æ–™ç­‰\n */\nexport function useChannelEffects(\n  currentWorkspace: Workspace | null,\n  channels: Channel[],\n  selectedChannel: Channel | null,\n  loadChannels: (workspaceId: string) => Promise<void>,\n  selectChannel: (channel: Channel | null) => void,\n  loadMessages: (channelId: string) => Promise<void>,\n  loadAdvanceLists: (channelId: string) => Promise<void>,\n  loadSharedOrderLists: (channelId: string) => Promise<void>\n) {\n  // è¼‰å…¥é »é“åˆ—è¡¨\n  useEffect(() => {\n    if (currentWorkspace?.id) {\n      loadChannels(currentWorkspace.id)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentWorkspace?.id])\n\n  // é¸æ“‡é è¨­é »é“\n  useEffect(() => {\n    if (channels.length > 0 && !selectedChannel) {\n      const defaultChannel = channels.find(c => c.name === DEFAULT_CHANNEL_NAME) || channels[0]\n      selectChannel(defaultChannel)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [channels.length, selectedChannel?.id])\n\n  // è¼‰å…¥é »é“è³‡æ–™ï¼ˆè¨Šæ¯ã€ä»£å¢Šæ¸…å–®ã€è¨‚å–®æ¸…å–®ï¼‰\n  useEffect(() => {\n    if (!selectedChannel?.id) {\n      return\n    }\n\n    Promise.all([\n      loadMessages(selectedChannel.id),\n      loadAdvanceLists(selectedChannel.id),\n      loadSharedOrderLists(selectedChannel.id),\n    ]).catch(error => {\n      // Silent error handling\n    })\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedChannel?.id])\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/useChannelOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/useDialogStates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/useMessageHandlers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/hooks/useSelectionState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-chat/useChannelChat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/ChannelList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/ChannelListSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/ChannelSidebar.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":127,"column":5,"severity":1,"nodeType":null,"fix":{"range":[3674,3729],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useEffect } from 'react'\nimport { arrayMove } from '@dnd-kit/sortable'\nimport type { DragEndEvent } from '@dnd-kit/core'\nimport { useAuthStore } from '@/stores/auth-store'\nimport { removeChannelMember } from '@/services/workspace-members'\nimport { useWorkspaceChannels, useWorkspaceMembers } from '@/stores/workspace-store'\nimport { useChannelMemberStore } from '@/stores/workspace/channel-member-store'\nimport type { Channel, ChannelGroup } from '@/stores/workspace/types'\nimport type { ChannelSidebarProps } from './types'\nimport { useChannelSidebar } from './useChannelSidebar'\nimport { useChannelState } from './hooks/useChannelState'\nimport {\n  MemberManagementDialog,\n  ChannelDeleteDialog,\n  GroupDeleteDialog,\n} from './MemberManagementDialog'\nimport { WorkspaceHeader } from './WorkspaceHeader'\nimport { CreateGroupDialog } from './CreateGroupDialog'\nimport { CreateChannelDialog } from './CreateChannelDialog'\nimport { EditChannelDialog } from './EditChannelDialog'\nimport { ChannelList } from './ChannelList'\n\nexport function ChannelSidebar({ selectedChannelId, onSelectChannel }: ChannelSidebarProps) {\n  // Use selective hooks for better performance\n  const {\n    channels,\n    channelGroups,\n    currentWorkspace,\n    searchQuery,\n    channelFilter,\n    setSearchQuery,\n    setChannelFilter,\n    createChannelGroup,\n    toggleGroupCollapse,\n    updateChannelOrder,\n    updateChannel,\n    deleteChannel,\n    deleteChannelGroup,\n    createChannel,\n    loadChannels,\n    loading,\n  } = useWorkspaceChannels()\n\n  const { channelMembers, loadChannelMembers } = useWorkspaceMembers()\n\n  const { user } = useAuthStore()\n\n  // ğŸ”¥ è¼‰å…¥æ‰€æœ‰é »é“æˆå“¡è³‡æ–™ï¼ˆç”¨æ–¼æª¢æŸ¥æ˜¯å¦å·²åŠ å…¥é »é“ï¼‰\n  const allChannelMembers = useChannelMemberStore(state => state.items)\n\n  // Use the new state hook\n  const {\n    showNewGroupDialog,\n    setShowNewGroupDialog,\n    newGroupName,\n    setNewGroupName,\n    memberToRemove,\n    isRemoveDialogOpen,\n    isRemovingMember,\n    setIsRemovingMember,\n    openRemoveMemberDialog,\n    closeRemoveMemberDialog,\n    channelToDelete,\n    isDeleteDialogOpen,\n    isDeletingChannel,\n    setIsDeletingChannel,\n    openDeleteChannelDialog,\n    closeDeleteChannelDialog,\n    groupToDelete,\n    isGroupDeleteDialogOpen,\n    isDeletingGroup,\n    setIsDeletingGroup,\n    openDeleteGroupDialog,\n    closeDeleteGroupDialog,\n    showCreateChannelDialog,\n    setShowCreateChannelDialog,\n    newChannelName,\n    setNewChannelName,\n    newChannelDescription,\n    setNewChannelDescription,\n    newChannelType,\n    setNewChannelType,\n    selectedMembers,\n    setSelectedMembers,\n    resetCreateChannelDialog,\n    showEditChannelDialog,\n    channelToEdit,\n    editChannelName,\n    setEditChannelName,\n    editChannelDescription,\n    setEditChannelDescription,\n    openEditChannelDialog,\n    resetEditChannelDialog,\n  } = useChannelState()\n\n  const { expandedSections, setExpandedSections, filteredChannels } = useChannelSidebar(\n    channels,\n    searchQuery,\n    channelFilter\n  )\n\n  // ğŸ”¥ è¼‰å…¥æ‰€æœ‰é »é“æˆå“¡è³‡æ–™ï¼ˆç”¨æ–¼æª¢æŸ¥æ˜¯å¦å·²åŠ å…¥ï¼‰\n  useEffect(() => {\n    if (!currentWorkspace) return\n\n    // è¼‰å…¥ channel_members storeï¼ˆåŒ…å«æ‰€æœ‰é »é“çš„æˆå“¡è³‡æ–™ï¼‰\n    useChannelMemberStore.getState().fetchAll()\n  }, [currentWorkspace?.id])\n\n  // ğŸ”¥ é–‹å•Ÿå»ºç«‹é »é“å°è©±æ¡†æ™‚ï¼Œè‡ªå‹•é¸ä¸­å»ºç«‹è€…\n  useEffect(() => {\n    if (showCreateChannelDialog && user?.id && !selectedMembers.includes(user.id)) {\n      setSelectedMembers([user.id])\n    }\n  }, [showCreateChannelDialog, user?.id])\n\n  // Load channel members when selectedChannelId changes\n  useEffect(() => {\n    if (!selectedChannelId || !currentWorkspace) {\n      return\n    }\n\n    void loadChannelMembers(currentWorkspace.id, selectedChannelId)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedChannelId, currentWorkspace?.id])\n\n  const handleRemoveMember = async () => {\n    if (!memberToRemove || !selectedChannelId || !currentWorkspace) {\n      return\n    }\n\n    setIsRemovingMember(true)\n    try {\n      await removeChannelMember(currentWorkspace.id, selectedChannelId, memberToRemove.id)\n      closeRemoveMemberDialog()\n    } catch (error) {\n    } finally {\n      setIsRemovingMember(false)\n    }\n  }\n\n  const handleDeleteChannel = async () => {\n    if (!channelToDelete) {\n      return\n    }\n\n    setIsDeletingChannel(true)\n    try {\n      await deleteChannel(channelToDelete.id)\n      closeDeleteChannelDialog()\n    } catch (error) {\n    } finally {\n      setIsDeletingChannel(false)\n    }\n  }\n\n  const handleDeleteGroup = async () => {\n    if (!groupToDelete) {\n      return\n    }\n\n    setIsDeletingGroup(true)\n    try {\n      await deleteChannelGroup(groupToDelete.id)\n      closeDeleteGroupDialog()\n    } catch (error) {\n    } finally {\n      setIsDeletingGroup(false)\n    }\n  }\n\n  const handleDeleteGroupClick = (groupId: string) => {\n    const group = channelGroups.find((g: ChannelGroup) => g.id === groupId)\n    if (group) {\n      openDeleteGroupDialog(group)\n    }\n  }\n\n  const handleDeleteClick = (channelId: string) => {\n    const channel = channels.find((ch: Channel) => ch.id === channelId)\n    if (channel) {\n      openDeleteChannelDialog(channel)\n    }\n  }\n\n  const handleJoinChannel = async (channelId: string) => {\n    if (!user || !currentWorkspace) return\n\n    try {\n      const { addChannelMembers } = await import('@/services/workspace-members')\n      await addChannelMembers(currentWorkspace.id, channelId, [user.id], 'member')\n\n      // ğŸ”¥ é‡æ–°è¼‰å…¥é »é“æˆå“¡åˆ—è¡¨\n      await loadChannelMembers(currentWorkspace.id, channelId)\n\n      // ğŸ”¥ é‡æ–°è¼‰å…¥ channel_members storeï¼ˆæ›´æ–°æˆå“¡æ•¸é‡ï¼‰\n      const { useChannelMemberStore } = await import('@/stores/workspace/channel-member-store')\n      await useChannelMemberStore.getState().fetchAll()\n\n      // ğŸ”¥ é‡æ–°è¼‰å…¥é »é“åˆ—è¡¨ï¼ˆæ›´æ–°å´é‚Šæ¬„çš„ã€ŒæœªåŠ å…¥ã€ç‹€æ…‹ï¼‰\n      await loadChannels(currentWorkspace.id)\n    } catch (error) {\n      logger.error('Failed to join channel:', error)\n    }\n  }\n\n  const handleLeaveChannel = async (channelId: string) => {\n    if (!user || !currentWorkspace) return\n\n    const channel = channels.find((ch: Channel) => ch.id === channelId)\n    if (!channel) return\n\n    const confirmed = confirm(`ç¢ºå®šè¦é›¢é–‹ #${channel.name} é »é“å—ï¼Ÿ`)\n    if (!confirmed) return\n\n    try {\n      const members = channelMembers[channelId] || []\n      const currentMember = members.find(m => m.employeeId === user.id)\n\n      if (currentMember) {\n        await removeChannelMember(currentWorkspace.id, channelId, currentMember.id)\n\n        // ğŸ”¥ é‡æ–°è¼‰å…¥é »é“æˆå“¡åˆ—è¡¨\n        await loadChannelMembers(currentWorkspace.id, channelId)\n\n        // ğŸ”¥ é‡æ–°è¼‰å…¥ channel_members storeï¼ˆæ›´æ–°æˆå“¡æ•¸é‡ï¼‰\n        const { useChannelMemberStore } = await import('@/stores/workspace/channel-member-store')\n        await useChannelMemberStore.getState().fetchAll()\n\n        // ğŸ”¥ é‡æ–°è¼‰å…¥é »é“åˆ—è¡¨ï¼ˆæ›´æ–°å´é‚Šæ¬„çš„ã€ŒæœªåŠ å…¥ã€ç‹€æ…‹ï¼‰\n        await loadChannels(currentWorkspace.id)\n      }\n    } catch (error) {\n      logger.error('Failed to leave channel:', error)\n    }\n  }\n\n  const toggleChannelPin = async (channelId: string) => {\n    const channel = channels.find((ch: Channel) => ch.id === channelId)\n    if (!channel) return\n\n    try {\n      await updateChannel(channelId, {\n        is_favorite: !channel.is_favorite,\n      })\n    } catch (error) {\n      logger.error('Failed to toggle pin:', error)\n    }\n  }\n\n  const handleEditClick = (channelId: string) => {\n    const channel = channels.find((ch: Channel) => ch.id === channelId)\n    if (channel) {\n      openEditChannelDialog(channel)\n    }\n  }\n\n  const handleEditChannel = async () => {\n    if (!channelToEdit || !editChannelName.trim()) return\n\n    try {\n      await updateChannel(channelToEdit.id, {\n        name: editChannelName.trim(),\n        description: editChannelDescription.trim() || undefined,\n      })\n      resetEditChannelDialog()\n    } catch (error) {\n      logger.error('Failed to update channel:', error)\n    }\n  }\n\n  const handleDragEnd = async (event: DragEndEvent) => {\n    const { active, over } = event\n\n    if (!over || active.id === over.id) {\n      return\n    }\n\n    const draggedChannelId = active.id as string\n    const draggedChannel = channels.find((ch: Channel) => ch.id === draggedChannelId)\n\n    if (!draggedChannel) {\n      return\n    }\n\n    const targetGroup = channelGroups.find((g: ChannelGroup) => g.id === over.id)\n\n    if (targetGroup) {\n      await updateChannel(draggedChannelId, {\n        group_id: targetGroup.id,\n        is_favorite: false,\n      })\n      return\n    }\n\n    const targetChannel = channels.find((ch: Channel) => ch.id === over.id)\n\n    if (targetChannel) {\n      const bothHaveNoGroup = !draggedChannel.group_id && !targetChannel.group_id\n      const sameGroup = draggedChannel.group_id === targetChannel.group_id\n\n      if (!bothHaveNoGroup && !sameGroup) {\n        if (!targetChannel.group_id) {\n          await updateChannel(draggedChannelId, {\n            group_id: null,\n            is_favorite: false,\n          })\n        } else {\n          const targetGroupExists = channelGroups.find((g: ChannelGroup) => g.id === targetChannel.group_id)\n          if (targetGroupExists) {\n            await updateChannel(draggedChannelId, {\n              group_id: targetChannel.group_id,\n              is_favorite: false,\n            })\n          }\n        }\n      } else {\n        const groupChannels = channels.filter(\n          (ch: Channel) =>\n            (bothHaveNoGroup ? !ch.group_id : ch.group_id === draggedChannel.group_id) &&\n            ch.is_favorite === draggedChannel.is_favorite\n        )\n\n        const oldIndex = groupChannels.findIndex((ch: Channel) => ch.id === draggedChannelId)\n        const newIndex = groupChannels.findIndex((ch: Channel) => ch.id === over.id)\n\n        if (oldIndex !== -1 && newIndex !== -1) {\n          const reorderedChannels = arrayMove(groupChannels, oldIndex, newIndex)\n\n          for (let i = 0; i < reorderedChannels.length; i++) {\n            await updateChannelOrder(reorderedChannels[i].id, i)\n          }\n        }\n      }\n    }\n  }\n\n  const isAdmin = user?.permissions?.includes('admin') ?? false\n\n  const checkIsMember = (channelId: string): boolean => {\n    // ğŸ”¥ å„ªå…ˆä½¿ç”¨ channel_members storeï¼ˆåŒ…å«æ‰€æœ‰é »é“çš„æˆå“¡è³‡æ–™ï¼‰\n    if (allChannelMembers.length > 0) {\n      return allChannelMembers.some(\n        m => m.channel_id === channelId && m.employee_id === user?.id\n      )\n    }\n\n    // Fallback: ä½¿ç”¨ç•¶å‰è¼‰å…¥çš„é »é“æˆå“¡åˆ—è¡¨\n    const members = channelMembers[channelId] || []\n    return members.some(m => m.employeeId === user?.id)\n  }\n\n  // Helper function: sort channels by pinned and name\n  const sortChannels = (channels: Channel[]) => {\n    return [...channels].sort((a: Channel, b: Channel) => {\n      if (a.is_pinned && !b.is_pinned) return -1\n      if (!a.is_pinned && b.is_pinned) return 1\n      return a.name.localeCompare(b.name, 'zh-TW')\n    })\n  }\n\n  // 1. Company announcements (system group, fixed at top)\n  const announcementGroup = channelGroups.find(\n    (g: ChannelGroup) => g.is_system && g.system_type === 'company_announcements'\n  )\n  const announcementChannels = announcementGroup\n    ? sortChannels(\n        filteredChannels.filter((ch: Channel) => ch.group_id === announcementGroup.id && !ch.is_archived)\n      )\n    : []\n\n  // 2. User-defined groups (exclude archived)\n  const userGroups = channelGroups\n    .filter((g: ChannelGroup) => !g.is_system)\n    .sort((a: ChannelGroup, b: ChannelGroup) => (a.order || 0) - (b.order || 0))\n  const userGroupedChannels = userGroups.map((group: ChannelGroup) => ({\n    group,\n    channels: sortChannels(\n      filteredChannels.filter(\n        ch => ch.group_id === group.id && !ch.is_archived && checkIsMember(ch.id)\n      )\n    ),\n  }))\n\n  // 3. Ungrouped channels (joined but not grouped, exclude archived)\n  const ungroupedChannels = sortChannels(\n    filteredChannels.filter((ch: Channel) => !ch.group_id && !ch.is_archived && checkIsMember(ch.id))\n  )\n\n  // 4. Unjoined channels (public + not joined, exclude archived)\n  const unjoinedChannels = sortChannels(\n    filteredChannels.filter((ch: Channel) => ch.type === 'public' && !ch.is_archived && !checkIsMember(ch.id))\n  )\n\n  // 5. Archived (system group, fixed at bottom)\n  const archivedGroup = channelGroups.find((g: ChannelGroup) => g.is_system && g.system_type === 'archived')\n  const archivedChannels = archivedGroup\n    ? sortChannels(\n        filteredChannels.filter((ch: Channel) => ch.is_archived || ch.group_id === archivedGroup.id)\n      )\n    : []\n\n  const handleCreateGroup = () => {\n    if (newGroupName.trim() && currentWorkspace) {\n      createChannelGroup({\n        workspace_id: currentWorkspace.id,\n        name: newGroupName.trim(),\n        is_collapsed: false,\n        order: channelGroups.length,\n      })\n      setNewGroupName('')\n      setShowNewGroupDialog(false)\n    }\n  }\n\n  const handleCreateChannel = async () => {\n    if (!newChannelName.trim() || !currentWorkspace || !user || selectedMembers.length === 0) {\n      return\n    }\n\n    try {\n      // å»ºç«‹é »é“ï¼ˆçµ±ä¸€ç‚º privateï¼Œåªæœ‰è¢«é‚€è«‹çš„äººçœ‹å¾—åˆ°ï¼‰\n      const newChannel = await createChannel({\n        workspace_id: currentWorkspace.id,\n        name: newChannelName.trim(),\n        description: newChannelDescription.trim() || undefined,\n        type: 'private', // ğŸ”¥ çµ±ä¸€ç‚ºç§å¯†é »é“\n        created_by: user.id,\n      })\n\n      // ğŸ”¥ æ‰¹æ¬¡åŠ å…¥é¸ä¸­çš„æˆå“¡\n      if (newChannel?.id) {\n        try {\n          const channelMemberStore = useChannelMemberStore.getState()\n\n          // æ‰¹æ¬¡å»ºç«‹æˆå“¡\n          const memberPromises = selectedMembers.map(async (employeeId) => {\n            return channelMemberStore.create({\n              workspace_id: currentWorkspace.id,\n              channel_id: newChannel.id,\n              employee_id: employeeId,\n              role: employeeId === user.id ? 'owner' : 'member', // å»ºç«‹è€…æ˜¯ owner\n              status: 'active',\n            })\n          })\n\n          await Promise.all(memberPromises)\n          logger.log(`âœ… Added ${selectedMembers.length} members to channel`)\n\n          // ğŸ”¥ é‡æ–°è¼‰å…¥ channel_members store\n          await channelMemberStore.fetchAll()\n        } catch (memberError) {\n          logger.warn('âš ï¸ Failed to add members:', memberError)\n        }\n      }\n\n      resetCreateChannelDialog()\n    } catch (error) {\n      logger.error('Failed to create channel:', error)\n      alert('å»ºç«‹é »é“å¤±æ•—')\n    }\n  }\n\n  return (\n    <div className=\"w-[280px] bg-white border-r border-morandi-gold/20 flex flex-col shrink-0\">\n      {/* Workspace header */}\n      <WorkspaceHeader\n        workspaceName={currentWorkspace?.name || ''}\n        workspaceIcon={currentWorkspace?.icon || ''}\n        channelFilter={channelFilter}\n        onFilterChange={setChannelFilter}\n        onCreateChannel={() => setShowCreateChannelDialog(true)}\n        onCreateGroup={() => setShowNewGroupDialog(true)}\n        onRefresh={() => currentWorkspace?.id && loadChannels(currentWorkspace.id)}\n        isRefreshing={loading}\n      />\n\n      {/* Search input */}\n      <div className=\"px-4 py-2\">\n        <input\n          type=\"text\"\n          placeholder=\"æœå°‹é »é“...\"\n          value={searchQuery}\n          onChange={e => setSearchQuery(e.target.value)}\n          className=\"h-8 text-sm\"\n        />\n      </div>\n\n      {/* Channel list */}\n      <ChannelList\n        announcementChannels={announcementChannels}\n        announcementGroup={announcementGroup}\n        userGroupedChannels={userGroupedChannels}\n        ungroupedChannels={ungroupedChannels}\n        unjoinedChannels={unjoinedChannels}\n        archivedChannels={archivedChannels}\n        archivedGroup={archivedGroup}\n        selectedChannelId={selectedChannelId}\n        isAdmin={isAdmin}\n        expandedSections={expandedSections}\n        onSelectChannel={onSelectChannel}\n        toggleChannelFavorite={toggleChannelPin}\n        onDelete={handleDeleteClick}\n        onEdit={handleEditClick}\n        onJoinChannel={handleJoinChannel}\n        onLeaveChannel={handleLeaveChannel}\n        checkIsMember={checkIsMember}\n        toggleGroupCollapse={toggleGroupCollapse}\n        handleDeleteGroupClick={handleDeleteGroupClick}\n        onToggleExpanded={(section: string, expanded: boolean) => {\n          setExpandedSections(prev => ({ ...prev, [section]: expanded }))\n        }}\n        onDragEnd={handleDragEnd}\n      />\n\n      {/* Dialogs */}\n      <CreateGroupDialog\n        isOpen={showNewGroupDialog}\n        groupName={newGroupName}\n        onGroupNameChange={setNewGroupName}\n        onClose={() => setShowNewGroupDialog(false)}\n        onCreate={handleCreateGroup}\n      />\n\n      <CreateChannelDialog\n        isOpen={showCreateChannelDialog}\n        channelName={newChannelName}\n        channelDescription={newChannelDescription}\n        channelType={newChannelType}\n        selectedMembers={selectedMembers}\n        onChannelNameChange={setNewChannelName}\n        onChannelDescriptionChange={setNewChannelDescription}\n        onChannelTypeChange={setNewChannelType}\n        onMembersChange={setSelectedMembers}\n        onClose={resetCreateChannelDialog}\n        onCreate={handleCreateChannel}\n      />\n\n      <EditChannelDialog\n        isOpen={showEditChannelDialog}\n        channelName={editChannelName}\n        channelDescription={editChannelDescription}\n        onChannelNameChange={setEditChannelName}\n        onChannelDescriptionChange={setEditChannelDescription}\n        onClose={resetEditChannelDialog}\n        onSave={handleEditChannel}\n      />\n\n      <MemberManagementDialog\n        memberToRemove={memberToRemove}\n        isRemoveDialogOpen={isRemoveDialogOpen}\n        isRemovingMember={isRemovingMember}\n        onClose={closeRemoveMemberDialog}\n        onRemove={handleRemoveMember}\n      />\n\n      <ChannelDeleteDialog\n        channelToDelete={channelToDelete}\n        isDeleteDialogOpen={isDeleteDialogOpen}\n        isDeletingChannel={isDeletingChannel}\n        onClose={closeDeleteChannelDialog}\n        onDelete={handleDeleteChannel}\n      />\n\n      <GroupDeleteDialog\n        groupToDelete={groupToDelete}\n        isDeleteDialogOpen={isGroupDeleteDialogOpen}\n        isDeletingGroup={isDeletingGroup}\n        onClose={closeDeleteGroupDialog}\n        onDelete={handleDeleteGroup}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/CreateChannelDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/CreateGroupDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/DroppableGroupHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/EditChannelDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/MemberManagementDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/SortableChannelItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/WorkspaceHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/hooks/useChannelState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/channel-sidebar/useChannelSidebar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/FilePreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/MemberSidebar.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":32,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1179,1234],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { useEffect, useState, useMemo } from 'react'\nimport { useWorkspaceChannels } from '@/stores/workspace-store'\nimport { useChannelMemberStore } from '@/stores/workspace/channel-member-store'\nimport { useUserStore, useAuthStore } from '@/stores'\nimport { User, UserPlus, X } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\n\ninterface MemberSidebarProps {\n  isOpen: boolean\n}\n\nexport function MemberSidebar({ isOpen }: MemberSidebarProps) {\n  const { selectedChannel, currentWorkspace } = useWorkspaceChannels()\n  const { items: channelMembers, fetchAll: fetchChannelMembers, create: addMember } = useChannelMemberStore()\n  const { items: employees, fetchAll: fetchEmployees } = useUserStore()\n  const { user } = useAuthStore()\n  const [showAddMemberDialog, setShowAddMemberDialog] = useState(false)\n  const [selectedEmployees, setSelectedEmployees] = useState<string[]>([])\n  const [searchQuery, setSearchQuery] = useState('')\n  const [isAdding, setIsAdding] = useState(false)\n\n  // è¼‰å…¥é »é“æˆå“¡å’Œå“¡å·¥è³‡æ–™\n  useEffect(() => {\n    if (isOpen) {\n      fetchChannelMembers()\n      if (employees.length === 0) {\n        fetchEmployees()\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isOpen])\n\n  // è¨ˆç®—ç•¶å‰é »é“çš„æˆå“¡ï¼ˆå«å“¡å·¥è³‡æ–™ï¼‰\n  const members = useMemo(() => {\n    if (!selectedChannel?.id) return []\n\n    return channelMembers\n      .filter(m => m.channel_id === selectedChannel.id && m.status === 'active')\n      .map(member => {\n        const employee = employees.find(emp => emp.id === member.employee_id)\n        return {\n          id: member.id,\n          employeeId: member.employee_id,\n          role: member.role,\n          status: member.status,\n          profile: employee ? {\n            displayName: employee.display_name,\n            englishName: employee.english_name,\n            email: employee.personal_info?.email,\n            status: employee.status,\n          } : null,\n        }\n      })\n  }, [channelMembers, employees, selectedChannel?.id])\n\n  const memberEmployeeIds = new Set(members.map(m => m.employeeId))\n\n  // ğŸ” æ¬Šé™é©—è­‰ï¼šæª¢æŸ¥ç•¶å‰ç”¨æˆ¶åœ¨æ­¤é »é“çš„è§’è‰²\n  const currentUserMember = members.find(m => m.employeeId === user?.id)\n  const currentUserRole = currentUserMember?.role\n  const canManageMembers = currentUserRole === 'owner' || currentUserRole === 'admin'\n\n  // éæ¿¾å‡ºé‚„ä¸æ˜¯æˆå“¡çš„å“¡å·¥\n  const availableEmployees = employees.filter(emp => {\n    // 1. æ’é™¤å·²ç¶“æ˜¯æˆå“¡çš„\n    if (memberEmployeeIds.has(emp.id)) return false\n\n    // 2. åªé¡¯ç¤ºæ´»èºç‹€æ…‹\n    if (emp.status !== 'active') return false\n\n    // 3. ğŸ”¥ åªé¡¯ç¤ºçœŸæ­£çš„ã€Œå“¡å·¥ã€ï¼ˆæœ‰ employee è§’è‰²æ¨™ç±¤ï¼‰\n    // æœªä¾†å¯èƒ½æœƒæœ‰å®¢æˆ¶ã€è¨ªå®¢ç­‰éå“¡å·¥å¸³è™Ÿï¼Œé€™è£¡éœ€è¦éæ¿¾\n    const isEmployee = emp.roles?.includes('employee') || emp.roles?.includes('admin')\n    if (!isEmployee) return false\n\n    // 4. æœå°‹éæ¿¾\n    if (searchQuery !== '') {\n      const query = searchQuery.toLowerCase()\n      return (\n        emp.display_name.toLowerCase().includes(query) ||\n        emp.english_name?.toLowerCase().includes(query) ||\n        emp.employee_number.toLowerCase().includes(query)\n      )\n    }\n\n    return true\n  })\n\n  const handleAddMembers = async () => {\n    if (!selectedChannel || !currentWorkspace || selectedEmployees.length === 0) return\n\n    setIsAdding(true)\n    try {\n      // ä½¿ç”¨ Store æ‰¹æ¬¡æ–°å¢æˆå“¡\n      for (const employeeId of selectedEmployees) {\n        await addMember({\n          workspace_id: currentWorkspace.id,\n          channel_id: selectedChannel.id,\n          employee_id: employeeId,\n          role: 'member',\n          status: 'active',\n        })\n      }\n\n      // é‡æ–°è¼‰å…¥æˆå“¡åˆ—è¡¨\n      await fetchChannelMembers()\n\n      // é‡ç½®ç‹€æ…‹\n      setSelectedEmployees([])\n      setSearchQuery('')\n      setShowAddMemberDialog(false)\n    } catch (error) {\n      alert('æ–°å¢æˆå“¡å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦')\n    } finally {\n      setIsAdding(false)\n    }\n  }\n\n  const toggleEmployeeSelection = (employeeId: string) => {\n    setSelectedEmployees(prev =>\n      prev.includes(employeeId) ? prev.filter(id => id !== employeeId) : [...prev, employeeId]\n    )\n  }\n\n  if (!isOpen) return null\n\n  return (\n    <div className=\"w-64 border-l border-border bg-white flex flex-col shrink-0\">\n      <div className=\"p-4 border-b border-border\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"font-medium text-morandi-primary\">æˆå“¡åˆ—è¡¨</h3>\n          {canManageMembers && (\n            <button\n              onClick={() => setShowAddMemberDialog(true)}\n              className=\"p-1.5 rounded-md hover:bg-morandi-gold/10 text-morandi-gold transition-colors\"\n              title=\"æ–°å¢æˆå“¡\"\n            >\n              <UserPlus size={16} />\n            </button>\n          )}\n        </div>\n        <p className=\"text-xs text-morandi-secondary\">\n          {members.length} ä½æˆå“¡\n          {currentUserRole && (\n            <span className=\"ml-2 text-morandi-gold\">\n              Â· ä½ çš„è§’è‰²ï¼š\n              {currentUserRole === 'owner'\n                ? 'æ“æœ‰è€…'\n                : currentUserRole === 'admin'\n                  ? 'ç®¡ç†å“¡'\n                  : currentUserRole === 'manager'\n                    ? 'ç¶“ç†'\n                    : currentUserRole === 'member'\n                      ? 'æˆå“¡'\n                      : 'è¨ªå®¢'}\n            </span>\n          )}\n        </p>\n      </div>\n      <div className=\"flex-1 overflow-y-auto p-2\">\n        {members.length === 0 ? (\n          <div className=\"text-center text-morandi-secondary text-sm py-8\">\n            <User size={32} className=\"mx-auto mb-2 opacity-50\" />\n            <p>æ­¤é »é“ç›®å‰æ²’æœ‰æˆå“¡</p>\n          </div>\n        ) : (\n          <div className=\"space-y-1\">\n            {members.map(member => (\n              <div\n                key={member.id}\n                className=\"flex items-center gap-2 p-2 rounded hover:bg-morandi-container/10 transition-colors\"\n              >\n                <div className=\"w-8 h-8 rounded-full bg-morandi-gold/20 flex items-center justify-center text-xs font-medium text-morandi-primary\">\n                  {member.profile?.displayName?.[0]?.toUpperCase() || 'M'}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-morandi-primary truncate\">\n                    {member.profile?.displayName || member.profile?.englishName || 'æœªçŸ¥æˆå“¡'}\n                  </p>\n                  <p className=\"text-xs text-morandi-secondary truncate\">{member.role || 'æˆå“¡'}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* æ–°å¢æˆå“¡å°è©±æ¡† */}\n      {showAddMemberDialog && (\n        <div\n          className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n          onClick={() => setShowAddMemberDialog(false)}\n        >\n          <div\n            className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-4\"\n            onClick={e => e.stopPropagation()}\n          >\n            {/* æ¨™é¡Œåˆ— */}\n            <div className=\"flex items-center justify-between p-4 border-b border-border\">\n              <h3 className=\"font-semibold text-morandi-primary\">æ–°å¢æˆå“¡åˆ°é »é“</h3>\n              <button\n                onClick={() => setShowAddMemberDialog(false)}\n                className=\"p-1 rounded-md hover:bg-morandi-container/10 transition-colors\"\n              >\n                <X size={18} />\n              </button>\n            </div>\n\n            {/* æœå°‹æ¡† */}\n            <div className=\"p-4 border-b border-border\">\n              <input\n                type=\"text\"\n                placeholder=\"æœå°‹å“¡å·¥å§“åæˆ–ç·¨è™Ÿ...\"\n                value={searchQuery}\n                onChange={e => setSearchQuery(e.target.value)}\n                className=\"w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-morandi-gold/20 text-sm\"\n              />\n            </div>\n\n            {/* å“¡å·¥åˆ—è¡¨ */}\n            <div className=\"max-h-96 overflow-y-auto p-2\">\n              {availableEmployees.length === 0 ? (\n                <div className=\"text-center text-morandi-secondary text-sm py-8\">\n                  <User size={32} className=\"mx-auto mb-2 opacity-50\" />\n                  <p>æ²’æœ‰å¯æ–°å¢çš„å“¡å·¥</p>\n                </div>\n              ) : (\n                <div className=\"space-y-1\">\n                  {availableEmployees.map(employee => (\n                    <div\n                      key={employee.id}\n                      onClick={() => toggleEmployeeSelection(employee.id)}\n                      className={`flex items-center gap-3 p-3 rounded-md cursor-pointer transition-colors ${\n                        selectedEmployees.includes(employee.id)\n                          ? 'bg-morandi-gold/10 border border-morandi-gold/30'\n                          : 'hover:bg-morandi-container/10 border border-transparent'\n                      }`}\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-morandi-gold/20 flex items-center justify-center text-sm font-medium text-morandi-primary\">\n                        {employee.display_name[0]?.toUpperCase() || 'M'}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium text-morandi-primary truncate\">\n                          {employee.display_name}\n                        </p>\n                        <p className=\"text-xs text-morandi-secondary truncate\">\n                          {employee.employee_number} Â· {employee.english_name}\n                        </p>\n                      </div>\n                      {selectedEmployees.includes(employee.id) && (\n                        <div className=\"w-5 h-5 rounded-full bg-morandi-gold flex items-center justify-center\">\n                          <svg\n                            className=\"w-3 h-3 text-white\"\n                            fill=\"none\"\n                            viewBox=\"0 0 24 24\"\n                            stroke=\"currentColor\"\n                          >\n                            <path\n                              strokeLinecap=\"round\"\n                              strokeLinejoin=\"round\"\n                              strokeWidth={3}\n                              d=\"M5 13l4 4L19 7\"\n                            />\n                          </svg>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* åº•éƒ¨æŒ‰éˆ• */}\n            <div className=\"p-4 border-t border-border flex items-center justify-between\">\n              <p className=\"text-xs text-morandi-secondary\">\n                å·²é¸æ“‡ {selectedEmployees.length} ä½å“¡å·¥\n              </p>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowAddMemberDialog(false)}\n                  disabled={isAdding}\n                >\n                  å–æ¶ˆ\n                </Button>\n                <Button\n                  onClick={handleAddMembers}\n                  disabled={selectedEmployees.length === 0 || isAdding}\n                  className=\"bg-morandi-gold hover:bg-morandi-gold/90\"\n                >\n                  {isAdding ? 'æ–°å¢ä¸­...' : `æ–°å¢ (${selectedEmployees.length})`}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/MessageInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/MessageItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/MessageList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/QuickActionMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/UploadProgress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/hooks/useFileUpload.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/hooks/useMessageOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/hooks/useScrollToBottom.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/theme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/components/workspace/chat/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/constants/menu-items.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/constants/quote-status.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/constants/status-maps.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/core/errors/app-errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/core/services/base.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/core/types/common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/data/fitness/exercises.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/data/manifestation-chapters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/data/region-hierarchy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/accommodation/components/CornerHotelVoucher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/components/AttractionsDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/components/AttractionsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/components/DatabaseManagementPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/components/tabs/AttractionsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/components/tabs/MichelinRestaurantsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/components/tabs/PremiumExperiencesTab.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":138,"column":7,"severity":1,"nodeType":null,"fix":{"range":[3956,4018],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useState, useEffect, useMemo } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Sparkles, Award, Users, Clock, Edit2, Power, Trash2 } from 'lucide-react'\nimport { supabase } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { EnhancedTable } from '@/components/ui/enhanced-table'\nimport { cn } from '@/lib/utils'\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from '@/components/ui/dialog'\nimport { Input } from '@/components/ui/input'\n\ninterface PremiumExperience {\n  id: string\n  name: string\n  name_en?: string\n  category: string\n  country_id: string\n  city_id: string\n  exclusivity_level: string\n  description?: string\n  highlights?: string[]\n  duration_hours?: number\n  max_participants?: number\n  min_participants?: number\n  price_per_person_min?: number\n  price_per_person_max?: number\n  currency?: string\n  expert_name?: string\n  expert_credentials?: string\n  commission_rate?: number\n  recommended_for?: string[]\n  sustainability_rating?: string\n  is_active: boolean\n}\n\ninterface PremiumExperiencesTabProps {\n  selectedCountry: string\n}\n\nexport default function PremiumExperiencesTab({ selectedCountry }: PremiumExperiencesTabProps) {\n  const [experiences, setExperiences] = useState<PremiumExperience[]>([])\n  const [loading, setLoading] = useState(true)\n  const [countries, setCountries] = useState<Array<{ id: string; name: string; emoji?: string }>>([])\n  const [cities, setCities] = useState<Array<{ id: string; name: string }>>([])\n\n  const [editingExperience, setEditingExperience] = useState<PremiumExperience | null>(null)\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false)\n\n  // è¼‰å…¥é«”é©—è³‡æ–™\n  useEffect(() => {\n    loadExperiences()\n  }, [])\n\n  async function loadExperiences() {\n    try {\n      const { data, error } = await supabase\n        .from('premium_experiences')\n        .select('*')\n        .order('exclusivity_level', { ascending: false })\n        .order('name')\n\n      if (error) throw error\n      setExperiences((data as unknown as PremiumExperience[]) || [])\n\n      // è¼‰å…¥ç”¨åˆ°çš„åœ‹å®¶å’ŒåŸå¸‚è³‡æ–™\n      if (data && data.length > 0) {\n        const countryIds = Array.from(new Set(data.map(e => e.country_id).filter(Boolean)))\n        const cityIds = Array.from(new Set(data.map(e => e.city_id).filter(Boolean)))\n\n        if (countryIds.length > 0) {\n          supabase\n            .from('countries')\n            .select('*')\n            .in('id', countryIds)\n            .then(({ data }) => {\n              if (data) setCountries(data.map(c => ({ id: c.id, name: c.name, emoji: c.emoji ?? undefined })))\n            })\n        }\n\n        if (cityIds.length > 0) {\n          supabase\n            .from('cities')\n            .select('*')\n            .in('id', cityIds)\n            .then(({ data }) => {\n              if (data) setCities(data.map(c => ({ id: c.id, name: c.name })))\n            })\n        }\n      }\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error)\n      logger.error('è¼‰å…¥é ‚ç´šé«”é©—å¤±æ•—:', error)\n      toast.error('è¼‰å…¥å¤±æ•—ï¼š' + errorMessage)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // åˆªé™¤é«”é©—\n  const handleDelete = async (id: string) => {\n    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤é«”é©—ï¼Ÿ')) return\n\n    try {\n      const { error } = await supabase.from('premium_experiences').delete().eq('id', id)\n      if (error) throw error\n      await loadExperiences()\n      toast.success('åˆªé™¤æˆåŠŸ')\n    } catch (error) {\n      toast.error('åˆªé™¤å¤±æ•—')\n    }\n  }\n\n  // é–‹å•Ÿç·¨è¼¯å°è©±æ¡†\n  const handleEdit = (experience: PremiumExperience) => {\n    setEditingExperience(experience)\n    setIsEditDialogOpen(true)\n  }\n\n  // é—œé–‰ç·¨è¼¯å°è©±æ¡†\n  const handleCloseEdit = () => {\n    setEditingExperience(null)\n    setIsEditDialogOpen(false)\n  }\n\n  // æ›´æ–°é«”é©—\n  const handleUpdate = async (updatedData: Partial<PremiumExperience>) => {\n    if (!editingExperience) return\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { error } = await (supabase as any)\n        .from('premium_experiences')\n        .update(updatedData)\n        .eq('id', editingExperience.id)\n\n      if (error) throw error\n      await loadExperiences()\n      handleCloseEdit()\n      toast.success('æ›´æ–°æˆåŠŸ')\n    } catch (error) {\n      toast.error('æ›´æ–°å¤±æ•—')\n    }\n  }\n\n  // åˆ‡æ›å•Ÿç”¨ç‹€æ…‹\n  const handleToggleStatus = async (experience: PremiumExperience) => {\n    const newStatus = !experience.is_active\n    setExperiences(prev =>\n      prev.map(item => (item.id === experience.id ? { ...item, is_active: newStatus } : item))\n    )\n\n    try {\n      const { error } = await supabase\n        .from('premium_experiences')\n        .update({ is_active: newStatus })\n        .eq('id', experience.id)\n\n      if (error) throw error\n      toast.success(newStatus ? 'å·²å•Ÿç”¨' : 'å·²åœç”¨')\n    } catch (error) {\n      setExperiences(prev =>\n        prev.map(item =>\n          item.id === experience.id ? { ...item, is_active: experience.is_active } : item\n        )\n      )\n      toast.error('æ›´æ–°å¤±æ•—')\n    }\n  }\n\n  // ç¨ç‰¹æ€§ç­‰ç´šé¡è‰²\n  const getExclusivityColor = (level: string) => {\n    switch (level) {\n      case 'ultra_exclusive':\n        return 'bg-purple-100 text-purple-800 border-purple-300'\n      case 'highly_exclusive':\n        return 'bg-rose-100 text-rose-800 border-rose-300'\n      case 'exclusive':\n        return 'bg-amber-100 text-amber-800 border-amber-300'\n      case 'premium':\n        return 'bg-blue-100 text-blue-800 border-blue-300'\n      default:\n        return 'bg-gray-100 text-gray-800 border-gray-300'\n    }\n  }\n\n  // ç¨ç‰¹æ€§ç­‰ç´šæ–‡å­—\n  const getExclusivityLabel = (level: string) => {\n    switch (level) {\n      case 'ultra_exclusive':\n        return 'æ¥µè‡´ç¨å®¶'\n      case 'highly_exclusive':\n        return 'é«˜åº¦ç¨å®¶'\n      case 'exclusive':\n        return 'ç¨å®¶'\n      case 'premium':\n        return 'ç²¾å“'\n      default:\n        return level\n    }\n  }\n\n  // é¡åˆ¥æ–‡å­—\n  const getCategoryLabel = (category: string) => {\n    const labels: Record<string, string> = {\n      cultural_immersion: 'æ–‡åŒ–æ²‰æµ¸',\n      exclusive_access: 'ç¨å®¶é€šé“',\n      culinary_mastery: 'çƒ¹é£ªå¤§å¸«',\n      artisan_workshop: 'å·¥è—å·¥ä½œåŠ',\n      private_performance: 'ç§äººè¡¨æ¼”',\n      nature_adventure: 'è‡ªç„¶æ¢éšª',\n      wellness_retreat: 'é¤Šç”Ÿéœä¿®',\n    }\n    return labels[category] || category\n  }\n\n  // æ ¹æ“šåœ‹å®¶ç¯©é¸é«”é©—\n  const filteredExperiences = useMemo(() => {\n    if (!selectedCountry) return experiences\n    return experiences.filter(e => e.country_id === selectedCountry)\n  }, [experiences, selectedCountry])\n\n  // å®šç¾©è¡¨æ ¼æ¬„ä½\n  const columns = useMemo(\n    () => [\n      {\n        key: 'name',\n        label: 'é«”é©—åç¨±',\n        sortable: true,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <div className=\"min-w-[180px]\">\n            <div className=\"font-medium text-morandi-primary line-clamp-1\">{experience.name}</div>\n            {experience.name_en && (\n              <div className=\"text-xs text-morandi-muted line-clamp-1\">{experience.name_en}</div>\n            )}\n          </div>\n        ),\n      },\n      {\n        key: 'exclusivity_level',\n        label: 'ç¨ç‰¹æ€§',\n        sortable: true,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <span\n            className={`px-2 py-1 text-xs font-medium rounded border ${getExclusivityColor(\n              experience.exclusivity_level\n            )}`}\n          >\n            {getExclusivityLabel(experience.exclusivity_level)}\n          </span>\n        ),\n      },\n      {\n        key: 'category',\n        label: 'é¡åˆ¥',\n        sortable: true,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-morandi-gold/10 text-morandi-gold\">\n            {getCategoryLabel(experience.category)}\n          </span>\n        ),\n      },\n      {\n        key: 'city',\n        label: 'åœ°é»',\n        sortable: false,\n        render: (_: unknown, experience: PremiumExperience) => {\n          const country = countries.find(c => c.id === experience.country_id)\n          const city = cities.find(c => c.id === experience.city_id)\n          return (\n            <div className=\"text-sm text-morandi-secondary line-clamp-1\">\n              {country?.emoji} {city?.name || '-'}\n            </div>\n          )\n        },\n      },\n      {\n        key: 'expert_name',\n        label: 'å°ˆå®¶',\n        sortable: true,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <div className=\"min-w-[120px]\">\n            {experience.expert_name ? (\n              <>\n                <div className=\"text-sm text-morandi-primary font-medium\">\n                  {experience.expert_name}\n                </div>\n                {experience.expert_credentials && (\n                  <div className=\"text-xs text-morandi-muted line-clamp-1\">\n                    {experience.expert_credentials}\n                  </div>\n                )}\n              </>\n            ) : (\n              <span className=\"text-sm text-morandi-secondary\">-</span>\n            )}\n          </div>\n        ),\n      },\n      {\n        key: 'duration',\n        label: 'æ™‚é•·',\n        sortable: false,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <div className=\"flex items-center gap-1 text-sm text-morandi-secondary\">\n            {experience.duration_hours ? (\n              <>\n                <Clock className=\"w-3 h-3\" />\n                <span>{experience.duration_hours}h</span>\n              </>\n            ) : (\n              '-'\n            )}\n          </div>\n        ),\n      },\n      {\n        key: 'participants',\n        label: 'äººæ•¸',\n        sortable: false,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <div className=\"flex items-center gap-1 text-sm text-morandi-secondary\">\n            {experience.min_participants || experience.max_participants ? (\n              <>\n                <Users className=\"w-3 h-3\" />\n                <span>\n                  {experience.min_participants || 1}-{experience.max_participants || 'âˆ'}\n                </span>\n              </>\n            ) : (\n              '-'\n            )}\n          </div>\n        ),\n      },\n      {\n        key: 'price',\n        label: 'åƒ¹æ ¼',\n        sortable: false,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <div className=\"text-sm text-morandi-gold font-medium min-w-[100px]\">\n            {experience.price_per_person_min\n              ? `${experience.price_per_person_min.toLocaleString()}${\n                  experience.price_per_person_max &&\n                  experience.price_per_person_max !== experience.price_per_person_min\n                    ? `-${experience.price_per_person_max.toLocaleString()}`\n                    : ''\n                } ${experience.currency || 'TWD'}`\n              : '-'}\n          </div>\n        ),\n      },\n      {\n        key: 'is_active',\n        label: 'ç‹€æ…‹',\n        sortable: true,\n        render: (_: unknown, experience: PremiumExperience) => (\n          <span\n            className={cn(\n              'inline-flex items-center px-2 py-0.5 rounded text-xs font-medium',\n              experience.is_active\n                ? 'bg-morandi-green/80 text-white'\n                : 'bg-morandi-container text-morandi-secondary'\n            )}\n          >\n            {experience.is_active ? 'å•Ÿç”¨' : 'åœç”¨'}\n          </span>\n        ),\n      },\n    ],\n    [countries, cities]\n  )\n\n  return (\n    <>\n      <div className=\"h-full flex flex-col\">\n        <div className=\"flex-1 overflow-auto\">\n          <EnhancedTable\n            columns={columns as unknown as Parameters<typeof EnhancedTable>[0]['columns']}\n            data={filteredExperiences}\n            loading={loading}\n            initialPageSize={20}\n            onRowClick={handleEdit as (row: unknown) => void}\n            actions={(row: unknown) => {\n              const experience = row as PremiumExperience\n              return (\n              <div className=\"flex items-center gap-1\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={e => {\n                    e.stopPropagation()\n                    handleEdit(experience)\n                  }}\n                  className=\"h-8 px-2 text-morandi-blue hover:bg-morandi-blue/10\"\n                  title=\"ç·¨è¼¯\"\n                >\n                  <Edit2 size={14} />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={e => {\n                    e.stopPropagation()\n                    handleToggleStatus(experience)\n                  }}\n                  className=\"h-8 px-2\"\n                  title={experience.is_active ? 'åœç”¨' : 'å•Ÿç”¨'}\n                >\n                  <Power\n                    size={14}\n                    className={experience.is_active ? 'text-morandi-green' : 'text-morandi-secondary'}\n                  />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={e => {\n                    e.stopPropagation()\n                    handleDelete(experience.id)\n                  }}\n                  className=\"h-8 px-2 hover:text-morandi-red hover:bg-morandi-red/10\"\n                  title=\"åˆªé™¤\"\n                >\n                  <Trash2 size={14} />\n                </Button>\n              </div>\n            )}}\n          />\n        </div>\n      </div>\n\n      {/* ç·¨è¼¯å°è©±æ¡† */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>ç·¨è¼¯é ‚ç´šé«”é©—</DialogTitle>\n          </DialogHeader>\n          {editingExperience && (\n            <div className=\"space-y-4 py-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">åç¨±</label>\n                  <Input\n                    value={editingExperience.name}\n                    onChange={e =>\n                      setEditingExperience({ ...editingExperience, name: e.target.value })\n                    }\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">è‹±æ–‡åç¨±</label>\n                  <Input\n                    value={editingExperience.name_en || ''}\n                    onChange={e =>\n                      setEditingExperience({ ...editingExperience, name_en: e.target.value })\n                    }\n                  />\n                </div>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium\">æè¿°</label>\n                <textarea\n                  value={editingExperience.description || ''}\n                  onChange={e =>\n                    setEditingExperience({ ...editingExperience, description: e.target.value })\n                  }\n                  className=\"w-full px-3 py-2 border border-border rounded-md bg-background text-sm min-h-[100px]\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium\">å°ˆå®¶åç¨±</label>\n                  <Input\n                    value={editingExperience.expert_name || ''}\n                    onChange={e =>\n                      setEditingExperience({ ...editingExperience, expert_name: e.target.value })\n                    }\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\">å°ˆå®¶è³‡æ ¼</label>\n                  <Input\n                    value={editingExperience.expert_credentials || ''}\n                    onChange={e =>\n                      setEditingExperience({\n                        ...editingExperience,\n                        expert_credentials: e.target.value,\n                      })\n                    }\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={handleCloseEdit}>\n              å–æ¶ˆ\n            </Button>\n            <Button onClick={() => editingExperience && handleUpdate(editingExperience)}>\n              å„²å­˜\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/hooks/useAttractionsData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/hooks/useAttractionsDialog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/hooks/useAttractionsFilters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/attractions/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/AddEventDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/CalendarGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/CalendarLegend.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/CalendarStyles.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/EventDetailDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/MoreEventsDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/hooks/useCalendarEvents.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/hooks/useCalendarNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/hooks/useEventOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/hooks/useMoreEventsDialog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/calendar/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/company-assets/components/CompanyAssetsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/company-assets/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/confirmations/components/ConfirmationsList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/confirmations/components/ConfirmationsPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/confirmations/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/calculator-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/currency-widget.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":118,"column":5,"severity":1,"nodeType":null,"fix":{"range":[3464,3519],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { useState, useEffect, useCallback, useMemo } from 'react'\nimport { DollarSign, ArrowRightLeft, TrendingUp } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\nexport function CurrencyWidget() {\n  // é è¨­åŒ¯ç‡ï¼ˆ1 å¤–å¹£ = ? å°å¹£ï¼‰\n  const DEFAULT_RATES = useMemo(\n    () => ({\n      USD: {\n        rate: 31.5,\n        symbol: '$',\n        name: 'ç¾é‡‘',\n        color: 'from-blue-200/60 to-cyan-100/60',\n        gradient: 'bg-gradient-to-br from-blue-50 via-white to-cyan-50',\n      },\n      JPY: {\n        rate: 0.21,\n        symbol: 'Â¥',\n        name: 'æ—¥å¹£',\n        color: 'from-red-200/60 to-pink-100/60',\n        gradient: 'bg-gradient-to-br from-red-50 via-white to-pink-50',\n      },\n      KRW: {\n        rate: 0.024,\n        symbol: 'â‚©',\n        name: 'éŸ“å…ƒ',\n        color: 'from-purple-200/60 to-violet-100/60',\n        gradient: 'bg-gradient-to-br from-purple-50 via-white to-violet-50',\n      },\n      CNY: {\n        rate: 4.35,\n        symbol: 'Â¥',\n        name: 'äººæ°‘å¹£',\n        color: 'from-orange-200/60 to-amber-100/60',\n        gradient: 'bg-gradient-to-br from-orange-50 via-white to-amber-50',\n      },\n      VND: {\n        rate: 0.00127,\n        symbol: 'â‚«',\n        name: 'è¶Šå—ç›¾',\n        color: 'from-emerald-200/60 to-teal-100/60',\n        gradient: 'bg-gradient-to-br from-emerald-50 via-white to-teal-50',\n      },\n      IDR: {\n        rate: 0.002,\n        symbol: 'Rp',\n        name: 'å°å°¼ç›¾',\n        color: 'from-rose-200/60 to-pink-100/60',\n        gradient: 'bg-gradient-to-br from-rose-50 via-white to-pink-50',\n      },\n    }),\n    []\n  )\n\n  const [twdAmount, setTwdAmount] = useState('10000')\n  const [foreignAmount, setForeignAmount] = useState('')\n  const [selectedCurrency, setSelectedCurrency] = useState<keyof typeof DEFAULT_RATES>('USD')\n  const [customRate, setCustomRate] = useState(DEFAULT_RATES.USD.rate.toString())\n  const [useCustomRate, setUseCustomRate] = useState(false)\n  const [direction, setDirection] = useState<'twd-to-foreign' | 'foreign-to-twd'>('twd-to-foreign')\n\n  // ç•¶åˆ‡æ›è²¨å¹£æ™‚ï¼Œæ›´æ–°åŒ¯ç‡\n  useEffect(() => {\n    if (!useCustomRate) {\n      setCustomRate(DEFAULT_RATES[selectedCurrency].rate.toString())\n    }\n  }, [selectedCurrency, useCustomRate, DEFAULT_RATES])\n\n  // è¨ˆç®—å¤–å¹£é‡‘é¡ï¼ˆå°å¹£ â†’ å¤–å¹£ï¼‰\n  const calculateForeign = useCallback(\n    (twd: string): string => {\n      const amount = parseFloat(twd) || 0\n      const rate = parseFloat(customRate) || 0\n      if (rate === 0) return '0'\n      return (amount / rate).toFixed(2)\n    },\n    [customRate]\n  )\n\n  // è¨ˆç®—å°å¹£é‡‘é¡ï¼ˆå¤–å¹£ â†’ å°å¹£ï¼‰\n  const calculateTWD = useCallback(\n    (foreign: string): string => {\n      const amount = parseFloat(foreign) || 0\n      const rate = parseFloat(customRate) || 0\n      return (amount * rate).toFixed(2)\n    },\n    [customRate]\n  )\n\n  // ç•¶å°å¹£é‡‘é¡è®Šæ›´\n  const handleTwdChange = (value: string) => {\n    setTwdAmount(value)\n    setDirection('twd-to-foreign')\n    setForeignAmount(calculateForeign(value))\n  }\n\n  // ç•¶å¤–å¹£é‡‘é¡è®Šæ›´\n  const handleForeignChange = (value: string) => {\n    setForeignAmount(value)\n    setDirection('foreign-to-twd')\n    setTwdAmount(calculateTWD(value))\n  }\n\n  // ç•¶åŒ¯ç‡è®Šæ›´æ™‚ï¼Œé‡æ–°è¨ˆç®—\n  useEffect(() => {\n    if (direction === 'twd-to-foreign') {\n      setForeignAmount(calculateForeign(twdAmount))\n    } else {\n      setTwdAmount(calculateTWD(foreignAmount))\n    }\n  }, [customRate, direction, twdAmount, foreignAmount, calculateForeign, calculateTWD])\n\n  // åˆå§‹åŒ–å¤–å¹£é‡‘é¡\n  useEffect(() => {\n    setForeignAmount(calculateForeign(twdAmount))\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []) // åªåœ¨çµ„ä»¶æ›è¼‰æ™‚åŸ·è¡Œä¸€æ¬¡\n\n  const currencyInfo = DEFAULT_RATES[selectedCurrency]\n\n  // åˆ‡æ›æ–¹å‘\n  const swapDirection = () => {\n    setDirection(prev => (prev === 'twd-to-foreign' ? 'foreign-to-twd' : 'twd-to-foreign'))\n  }\n\n  return (\n    <div className=\"h-full\">\n      <div\n        className={cn(\n          'h-full rounded-2xl border border-white/70 shadow-xl backdrop-blur-md transition-all duration-300 hover:shadow-2xl hover:border-white/80',\n          currencyInfo.gradient\n        )}\n      >\n        <div className=\"p-5 space-y-4 h-full flex flex-col\">\n          {/* Header with Icon */}\n          <div className=\"flex items-start gap-3\">\n            <div\n              className={cn(\n                'rounded-full p-2.5 text-white shadow-lg shadow-black/10',\n                'bg-gradient-to-br',\n                currencyInfo.color,\n                'ring-2 ring-white/50 ring-offset-1 ring-offset-white/20'\n              )}\n            >\n              <DollarSign className=\"w-5 h-5 drop-shadow-sm\" />\n            </div>\n            <div className=\"flex-1\">\n              <p className=\"text-sm font-semibold text-morandi-primary leading-tight tracking-wide\">\n                åŒ¯ç‡æ›ç®—\n              </p>\n              <p className=\"text-xs text-morandi-secondary/90 mt-1.5 leading-relaxed\">\n                è¼•é¬†è¨ˆç®—å„åœ‹è²¨å¹£ï¼ŒæŒæ¡å³æ™‚åŒ¯ç‡\n              </p>\n            </div>\n          </div>\n\n          {/* Currency Selection */}\n          <div className=\"rounded-xl bg-white/70 p-3.5 shadow-md border border-white/40\">\n            <label className=\"text-xs font-semibold text-morandi-primary mb-2 block\">\n              é¸æ“‡è²¨å¹£\n            </label>\n            <select\n              value={selectedCurrency}\n              onChange={e => {\n                setSelectedCurrency(e.target.value as keyof typeof DEFAULT_RATES)\n                setUseCustomRate(false)\n              }}\n              className=\"w-full px-3.5 py-2.5 text-sm font-medium border border-white/60 rounded-xl bg-white/90 hover:bg-white focus:bg-white transition-all outline-none shadow-sm backdrop-blur-sm\"\n            >\n              {Object.entries(DEFAULT_RATES).map(([code, info]) => (\n                <option key={code} value={code}>\n                  {info.symbol} {info.name} ({code})\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* Currency Conversion - Side by Side */}\n          <div className=\"rounded-xl bg-white/70 p-3.5 shadow-md border border-white/40\">\n            <div className=\"flex items-end gap-2\">\n              {/* TWD Input */}\n              <div className=\"flex-1\">\n                <label className=\"text-xs font-semibold text-morandi-primary mb-2 block\">\n                  å°å¹£ (TWD)\n                </label>\n                <div className=\"relative group\">\n                  <span className=\"absolute left-3.5 top-1/2 -translate-y-1/2 text-morandi-secondary/70 text-xs font-semibold\">\n                    NT$\n                  </span>\n                  <input\n                    type=\"number\"\n                    value={twdAmount}\n                    onChange={e => handleTwdChange(e.target.value)}\n                    className=\"w-full px-3.5 py-2.5 pl-[46px] border border-white/60 rounded-xl font-mono text-sm font-medium bg-white/90 hover:bg-white hover:shadow-sm focus:bg-white transition-all outline-none shadow-sm backdrop-blur-sm\"\n                    placeholder=\"10000\"\n                  />\n                </div>\n              </div>\n\n              {/* Arrow Button */}\n              <button\n                onClick={swapDirection}\n                className=\"p-2.5 hover:bg-white/80 rounded-xl transition-all group mb-0.5 shadow-sm hover:shadow-md border border-transparent hover:border-white/60\"\n                title=\"åˆ‡æ›æ–¹å‘\"\n              >\n                <ArrowRightLeft className=\"h-4 w-4 text-morandi-gold group-hover:scale-110 group-hover:rotate-180 transition-all duration-300\" />\n              </button>\n\n              {/* Foreign Currency Input */}\n              <div className=\"flex-1\">\n                <label className=\"text-xs font-semibold text-morandi-primary mb-2 block\">\n                  {currencyInfo.name} ({selectedCurrency})\n                </label>\n                <div className=\"relative group\">\n                  <span className=\"absolute left-3.5 top-1/2 -translate-y-1/2 text-morandi-secondary/70 text-xs font-semibold\">\n                    {currencyInfo.symbol}\n                  </span>\n                  <input\n                    type=\"number\"\n                    value={foreignAmount}\n                    onChange={e => handleForeignChange(e.target.value)}\n                    className=\"w-full px-3.5 py-2.5 pl-[46px] border border-white/60 rounded-xl font-mono text-sm font-medium bg-white/90 hover:bg-white hover:shadow-sm focus:bg-white transition-all outline-none shadow-sm backdrop-blur-sm\"\n                    placeholder=\"0.00\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Exchange Rate Setting */}\n          <div className=\"rounded-xl bg-white/70 p-3.5 shadow-md border border-white/40 space-y-2.5\">\n            <div className=\"flex items-center justify-between\">\n              <label className=\"text-xs font-semibold text-morandi-primary\">\n                åŒ¯ç‡ (1 {selectedCurrency} = ? TWD)\n              </label>\n              <button\n                onClick={() => {\n                  setUseCustomRate(false)\n                  setCustomRate(DEFAULT_RATES[selectedCurrency].rate.toString())\n                }}\n                className=\"text-xs text-morandi-gold hover:text-morandi-gold/80 font-semibold transition-all hover:scale-105 px-2 py-1 rounded-lg hover:bg-morandi-gold/10\"\n              >\n                é‡è¨­\n              </button>\n            </div>\n            <input\n              type=\"number\"\n              step=\"0.001\"\n              value={customRate}\n              onChange={e => {\n                setCustomRate(e.target.value)\n                setUseCustomRate(true)\n              }}\n              className=\"w-full px-3.5 py-2.5 border border-white/60 rounded-xl font-mono text-sm font-medium bg-white/90 hover:bg-white hover:shadow-sm focus:bg-white transition-all outline-none shadow-sm backdrop-blur-sm\"\n              placeholder=\"è¼¸å…¥åŒ¯ç‡\"\n            />\n            <div className=\"flex items-center gap-1.5 text-xs text-morandi-secondary/90 bg-white/40 px-2.5 py-1.5 rounded-lg\">\n              <TrendingUp className=\"w-3.5 h-3.5 text-morandi-gold\" />\n              <span className=\"font-medium\">\n                {useCustomRate ? 'å·²è‡ªè¨‚åŒ¯ç‡' : `é è¨­åŒ¯ç‡: ${DEFAULT_RATES[selectedCurrency].rate}`}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/flight-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/manifestation-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/notes-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/remittance-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/stats-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/timer-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/visa-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/weather-widget-weekly.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/weather-widget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/widget-config.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/components/widget-settings-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/hooks/use-notes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/hooks/use-stats-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/hooks/use-widgets.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/dashboard/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/components/DisbursementColumns.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/components/DisbursementDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/components/DisbursementList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/components/DisbursementPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/hooks/useDisbursementData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/hooks/useDisbursementFilters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/hooks/useDisbursementForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/hooks/useDisbursementPDF.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/disbursement/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/esims/components/EsimCreateDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/esims/components/EsimSearchDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/components/AddReceiptDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/components/BatchReceiptDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/components/PaymentItemRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/hooks/usePaymentForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/payments/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/AddRequestDialog.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":73,"column":5,"severity":1,"nodeType":null,"fix":{"range":[2185,2240],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useEffect, useMemo } from 'react'\nimport { Plus, Trash2 } from 'lucide-react'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Combobox } from '@/components/ui/combobox'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { useRequestForm } from '../hooks/useRequestForm'\nimport { useRequestOperations } from '../hooks/useRequestOperations'\nimport { categoryOptions } from '../types'\nimport { cn } from '@/lib/utils'\n\ninterface AddRequestDialogProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n}\n\nexport function AddRequestDialog({ open, onOpenChange }: AddRequestDialogProps) {\n  const {\n    formData,\n    setFormData,\n    requestItems,\n    newItem,\n    setNewItem,\n    filteredOrders,\n    total_amount,\n    addItemToList,\n    removeItem,\n    resetForm,\n    suppliers,\n    tours,\n    orders,\n  } = useRequestForm()\n\n  const { generateRequestNumber, createRequest } = useRequestOperations()\n\n  // âœ… è¼‰å…¥åœ˜é«”ã€è¨‚å–®å’Œä¾›æ‡‰å•†è³‡æ–™ï¼ˆé–‹å•Ÿå°è©±æ¡†æ™‚ï¼‰\n  useEffect(() => {\n    if (open) {\n      const loadData = async () => {\n        const { useTourStore, useOrderStore, useSupplierStore, useEmployeeStore } = await import('@/stores')\n        const tourStore = useTourStore.getState()\n        const orderStore = useOrderStore.getState()\n        const supplierStore = useSupplierStore.getState()\n        const employeeStore = useEmployeeStore.getState()\n\n        if (tourStore.items.length === 0) {\n          await tourStore.fetchAll()\n        }\n        if (orderStore.items.length === 0) {\n          await orderStore.fetchAll()\n        }\n        if (supplierStore.items.length === 0) {\n          await supplierStore.fetchAll()\n        }\n        if (employeeStore.items.length === 0) {\n          await employeeStore.fetchAll()\n        }\n      }\n      loadData().catch((err: unknown) => logger.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', err))\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [open])\n\n  // Generate upcoming Thursdays for request date (20 weeks = ~5 months)\n  const upcomingThursdays = useMemo(() => {\n    const thursdays = []\n    const today = new Date()\n    const currentDay = today.getDay()\n\n    // å¦‚æœä»Šå¤©æ˜¯é€±å››ï¼Œå¾ä»Šå¤©é–‹å§‹ï¼›å¦å‰‡å¾ä¸‹ä¸€å€‹é€±å››é–‹å§‹\n    let daysUntilThursday = (4 - currentDay + 7) % 7\n\n    for (let i = 0; i < 20; i++) {\n      const thursdayDate = new Date(today)\n      thursdayDate.setDate(today.getDate() + daysUntilThursday + i * 7)\n\n      thursdays.push({\n        value: thursdayDate.toISOString().split('T')[0],\n        label: `${thursdayDate.toLocaleDateString('zh-TW')} (${thursdayDate.toLocaleDateString('zh-TW', { weekday: 'short' })})`,\n      })\n    }\n\n    return thursdays\n  }, [])\n\n  const handleSubmit = async () => {\n    if (!formData.tour_id || requestItems.length === 0 || !formData.request_date) {\n      alert('è«‹å¡«å¯«å¿…å¡«æ¬„ä½ï¼ˆåœ˜é«”ã€è«‹æ¬¾æ—¥æœŸã€è‡³å°‘ä¸€é …è«‹æ¬¾é …ç›®ï¼‰')\n      return\n    }\n\n    const selectedTour = tours.find(t => t.id === formData.tour_id)\n    const selectedOrder = orders.find(o => o.id === formData.order_id)\n\n    if (!selectedTour) {\n      alert('æ‰¾ä¸åˆ°é¸ä¸­çš„åœ˜é«”')\n      return\n    }\n\n    try {\n      await createRequest(\n        formData,\n        requestItems,\n        selectedTour.name || '',\n        selectedTour.code || '',\n        selectedOrder?.order_number || undefined\n      )\n\n      alert('âœ… è«‹æ¬¾å–®å»ºç«‹æˆåŠŸ')\n      resetForm()\n      onOpenChange(false)\n    } catch (error) {\n      logger.error('âŒ Create Request Error:', error)\n      alert('âŒ å»ºç«‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦')\n    }\n  }\n\n  const handleCancel = () => {\n    resetForm()\n    onOpenChange(false)\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-[90vw] w-[90vw] h-[90vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>æ–°å¢è«‹æ¬¾å–®</DialogTitle>\n          <p className=\"text-sm text-morandi-secondary\">\n            è«‹æ¬¾å–®è™Ÿ: {generateRequestNumber()} (è‡ªå‹•ç”Ÿæˆ)\n          </p>\n        </DialogHeader>\n\n        {/* Basic Info - Single Row */}\n        <div className=\"bg-white border border-border rounded-md p-4 shadow-sm overflow-visible\">\n          <div className=\"grid grid-cols-3 gap-4\">\n              {/* é¸æ“‡åœ˜é«” */}\n              <div>\n                <Label className=\"text-sm font-medium text-morandi-secondary\">åœ˜é«” *</Label>\n                <Combobox\n                  options={tours.map(tour => ({\n                    value: tour.id,\n                    label: `${tour.code || ''} - ${tour.name || ''}`,\n                  }))}\n                  value={formData.tour_id}\n                  onChange={value => {\n                    setFormData(prev => ({\n                      ...prev,\n                      tour_id: value,\n                      order_id: '',\n                    }))\n                  }}\n                  placeholder=\"è«‹é¸æ“‡åœ˜é«”...\"\n                  emptyMessage=\"æ‰¾ä¸åˆ°åœ˜é«”\"\n                  className=\"mt-1\"\n                />\n              </div>\n\n              {/* é¸æ“‡è¨‚å–® */}\n              <div>\n                <Label className=\"text-sm font-medium text-morandi-secondary\">è¨‚å–®ï¼ˆé¸å¡«ï¼‰</Label>\n                <Select\n                  disabled={!formData.tour_id || filteredOrders.length === 0}\n                  value={formData.order_id}\n                  onValueChange={value => setFormData(prev => ({ ...prev, order_id: value }))}\n                >\n                  <SelectTrigger className=\"mt-1 border-morandi-container/30\">\n                    <SelectValue\n                      placeholder={\n                        !formData.tour_id\n                          ? 'è«‹å…ˆé¸æ“‡åœ˜é«”'\n                          : filteredOrders.length === 0\n                            ? 'æ­¤åœ˜é«”æ²’æœ‰è¨‚å–®'\n                            : 'è«‹é¸æ“‡è¨‚å–®...'\n                      }\n                    />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {filteredOrders.map(order => (\n                      <SelectItem key={order.id} value={order.id}>\n                        {order.order_number} - {order.contact_person || 'ç„¡è¯çµ¡äºº'}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Request Date */}\n              <div>\n                <div className=\"flex items-center justify-between mb-1\">\n                  <Label className=\"text-sm font-medium text-morandi-secondary\">\n                    è«‹æ¬¾æ—¥æœŸ <span className=\"text-morandi-red\">*</span>\n                  </Label>\n                  <div className=\"flex items-center space-x-1\">\n                    <input\n                      type=\"checkbox\"\n                      id=\"isSpecialBilling\"\n                      checked={formData.is_special_billing}\n                      onChange={e => {\n                        setFormData(prev => ({\n                          ...prev,\n                          is_special_billing: e.target.checked,\n                          request_date: '',\n                        }))\n                      }}\n                      className=\"rounded border-border\"\n                    />\n                    <label htmlFor=\"isSpecialBilling\" className=\"text-xs text-morandi-primary cursor-pointer\">\n                      ç‰¹æ®Šå‡ºå¸³\n                    </label>\n                  </div>\n                </div>\n\n                {formData.is_special_billing ? (\n                  <Input\n                    type=\"date\"\n                    value={formData.request_date}\n                    onChange={e => setFormData(prev => ({ ...prev, request_date: e.target.value }))}\n                    className=\"bg-morandi-gold/10 border-morandi-container/30\"\n                  />\n                ) : (\n                  <Select\n                    value={formData.request_date}\n                    onValueChange={value => setFormData(prev => ({ ...prev, request_date: value }))}\n                  >\n                    <SelectTrigger className=\"border-morandi-container/30\">\n                      <SelectValue placeholder=\"é¸æ“‡è«‹æ¬¾æ—¥æœŸ (é€±å››)\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {upcomingThursdays.map(thursday => (\n                        <SelectItem key={thursday.value} value={thursday.value}>\n                          {thursday.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                )}\n              </div>\n            </div>\n        </div>\n\n        {/* Add Item Form - Table Style */}\n        <div className=\"bg-white border border-border rounded-md p-4 shadow-sm flex-1 flex flex-col overflow-hidden mt-4\">\n            <h3 className=\"text-sm font-medium text-morandi-primary mb-4\">è«‹æ¬¾é …ç›®</h3>\n            <div className=\"overflow-x-auto flex-1\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b border-border\">\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-32\">\n                      è«‹æ¬¾é¡å‹\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-64\">\n                      ä¾›æ‡‰å•†\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-28\">\n                      å–®åƒ¹\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-24\">\n                      æ•¸é‡\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-28\">\n                      å°è¨ˆ\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-32\">\n                      ä»˜æ¬¾æ–¹å¼\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-32\">\n                      æ”¯ç¥¨æ—¥æœŸ\n                    </th>\n                    <th className=\"text-left py-2 px-3 text-sm font-medium text-morandi-secondary w-48\">\n                      å‚™è¨»\n                    </th>\n                    <th className=\"text-center py-2 px-3 text-sm font-medium text-morandi-secondary w-32\">\n                      æ“ä½œ\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {/* Existing Items */}\n                  {requestItems.map((item, index) => (\n                    <tr\n                      key={item.id}\n                      className={cn(\n                        'border-b border-border/40 hover:bg-morandi-container/10 transition-colors',\n                        index % 2 === 1 && 'bg-morandi-container/5'\n                      )}\n                    >\n                      <td className=\"py-3 px-3 w-32\">\n                        <span className=\"text-xs bg-morandi-gold/20 text-morandi-gold px-2 py-1 rounded font-medium\">\n                          {categoryOptions.find(c => c.value === item.category)?.label}\n                        </span>\n                      </td>\n                      <td className=\"py-3 px-3 w-64 text-sm text-morandi-primary font-medium\">\n                        {item.supplierName}\n                      </td>\n                      <td className=\"py-3 px-3 w-28 text-sm text-morandi-secondary\">\n                        {item.unit_price.toLocaleString()}\n                      </td>\n                      <td className=\"py-3 px-3 w-24 text-sm text-morandi-secondary\">{item.quantity}</td>\n                      <td className=\"py-3 px-3 w-28 text-sm font-bold text-morandi-gold\">\n                        {(item.unit_price * item.quantity).toLocaleString()}\n                      </td>\n                      <td className=\"py-3 px-3 w-32\">\n                        <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded\">\n                          {item.payment_method === 'transfer' && 'è½‰å¸³'}\n                          {item.payment_method === 'cash' && 'ç¾é‡‘'}\n                          {item.payment_method === 'check' && 'æ”¯ç¥¨'}\n                          {!item.payment_method && 'è½‰å¸³'}\n                        </span>\n                      </td>\n                      <td className=\"py-3 px-3 w-32 text-xs text-morandi-secondary\">\n                        {item.payment_method === 'check' && item.custom_request_date\n                          ? new Date(item.custom_request_date).toLocaleDateString('zh-TW')\n                          : '-'}\n                      </td>\n                      <td className=\"py-3 px-3 w-48 text-sm text-morandi-secondary\">{item.description || '-'}</td>\n                      <td className=\"py-3 px-3 w-32 text-center\">\n                        <Button\n                          onClick={() => removeItem(item.id)}\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"h-8 text-morandi-red hover:text-morandi-red hover:bg-morandi-red/10\"\n                        >\n                          <Trash2 size={14} />\n                        </Button>\n                      </td>\n                    </tr>\n                  ))}\n\n                  {/* New Item Row - æ”¾åœ¨æœ€å¾Œ */}\n                  <tr className=\"bg-morandi-gold/5 border-b-2 border-morandi-gold/30\">\n                    <td className=\"py-2 px-3 w-32\">\n                      <Select\n                        value={newItem.category}\n                        onValueChange={value =>\n                          setNewItem(prev => ({ ...prev, category: value as typeof newItem.category }))\n                        }\n                      >\n                        <SelectTrigger className=\"h-9 border-morandi-container/30\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {categoryOptions.map(option => (\n                            <SelectItem key={option.value} value={option.value}>\n                              {option.label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"py-2 px-3 w-64\">\n                      <Combobox\n                        options={suppliers.map(supplier => ({\n                          value: supplier.id,\n                          label: `${supplier.name} (${supplier.group})`,\n                        }))}\n                        value={newItem.supplier_id}\n                        onChange={value => setNewItem(prev => ({ ...prev, supplier_id: value }))}\n                        placeholder=\"æœå°‹ä¾›æ‡‰å•†...\"\n                        emptyMessage=\"æ‰¾ä¸åˆ°ä¾›æ‡‰å•†\"\n                        className=\"h-9\"\n                      />\n                    </td>\n                    <td className=\"py-2 px-3 w-28\">\n                      <Input\n                        type=\"text\"\n                        inputMode=\"numeric\"\n                        value={newItem.unit_price || ''}\n                        onChange={e => {\n                          // å…¨å½¢è½‰åŠå½¢ä¸¦åªä¿ç•™æ•¸å­—\n                          let value = e.target.value\n                            .replace(/[ï¼-ï¼™]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))\n                            .replace(/[^\\d]/g, '')\n                          setNewItem(prev => ({ ...prev, unit_price: value ? Number(value) : 0 }))\n                        }}\n                        onKeyDown={e => {\n                          if (e.key === 'Enter' && !e.nativeEvent.isComposing) {\n                            e.preventDefault()\n                          }\n                        }}\n                        placeholder=\"0\"\n                        className=\"h-9 border-morandi-container/30\"\n                      />\n                    </td>\n                    <td className=\"py-2 px-3 w-24\">\n                      <Input\n                        type=\"text\"\n                        inputMode=\"numeric\"\n                        value={newItem.quantity || ''}\n                        onChange={e => {\n                          // å…¨å½¢è½‰åŠå½¢ä¸¦åªä¿ç•™æ•¸å­—\n                          let value = e.target.value\n                            .replace(/[ï¼-ï¼™]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))\n                            .replace(/[^\\d]/g, '')\n                          setNewItem(prev => ({ ...prev, quantity: value ? Number(value) : 1 }))\n                        }}\n                        onKeyDown={e => {\n                          if (e.key === 'Enter' && !e.nativeEvent.isComposing) {\n                            e.preventDefault()\n                          }\n                        }}\n                        placeholder=\"1\"\n                        className=\"h-9 border-morandi-container/30\"\n                      />\n                    </td>\n                    <td className=\"py-2 px-3 w-28 text-sm font-bold text-morandi-gold\">\n                      {(newItem.unit_price * newItem.quantity).toLocaleString()}\n                    </td>\n                    <td className=\"py-2 px-3 w-32\">\n                      <Select\n                        value={newItem.payment_method || 'transfer'}\n                        onValueChange={value => {\n                          const paymentMethod = value as 'transfer' | 'check' | 'cash'\n                          setNewItem(prev => ({\n                            ...prev,\n                            payment_method: paymentMethod,\n                            // æ¸…ç©ºæ”¯ç¥¨æ—¥æœŸï¼ˆå¦‚æœä¸æ˜¯æ”¯ç¥¨ï¼‰\n                            custom_request_date: paymentMethod === 'check' ? prev.custom_request_date : undefined,\n                          }))\n                        }}\n                      >\n                        <SelectTrigger className=\"h-9 border-morandi-container/30\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"transfer\">è½‰å¸³</SelectItem>\n                          <SelectItem value=\"check\">æ”¯ç¥¨</SelectItem>\n                          <SelectItem value=\"cash\">ç¾é‡‘</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </td>\n                    <td className=\"py-2 px-3 w-32\">\n                      {newItem.payment_method === 'check' && (\n                        <Input\n                          type=\"date\"\n                          value={newItem.custom_request_date || ''}\n                          onChange={e => setNewItem(prev => ({ ...prev, custom_request_date: e.target.value }))}\n                          className=\"h-9 border-morandi-container/30\"\n                        />\n                      )}\n                    </td>\n                    <td className=\"py-2 px-3 w-48\">\n                      <Input\n                        value={newItem.description}\n                        onChange={e => setNewItem(prev => ({ ...prev, description: e.target.value }))}\n                        onKeyDown={e => {\n                          if (e.key === 'Enter') {\n                            e.preventDefault()\n                            // åªæœ‰åœ¨ä¸æ˜¯è¼¸å…¥æ³•çµ„åˆä¸­æ™‚æ‰æ–°å¢\n                            if (!e.nativeEvent.isComposing) {\n                              addItemToList()\n                            }\n                          }\n                        }}\n                        placeholder=\"è¼¸å…¥é …ç›®æè¿°\"\n                        className=\"h-9 border-morandi-container/30\"\n                      />\n                    </td>\n                    <td className=\"py-2 px-3 w-32 text-center\">\n                      <Button\n                        onClick={(e) => {\n                          addItemToList()\n                          // ä¿æŒ focus åœ¨æŒ‰éˆ•ä¸Šï¼Œæ–¹ä¾¿é€£çºŒæŒ‰\n                          e.currentTarget.focus()\n                        }}\n                        size=\"sm\"\n                        className=\"h-9 bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n                      >\n                        <Plus size={14} />\n                      </Button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n\n              {requestItems.length > 0 && (\n                <div className=\"mt-4 pt-4 border-t border-border flex justify-end items-center\">\n                  <span className=\"text-base font-semibold text-morandi-primary mr-4\">ç¸½é‡‘é¡:</span>\n                  <span className=\"text-xl font-bold text-morandi-gold\">\n                    NT$ {total_amount.toLocaleString()}\n                  </span>\n                </div>\n              )}\n            </div>\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex justify-end space-x-2 pt-4 border-t border-border mt-4\">\n          <Button variant=\"outline\" onClick={handleCancel}>\n            å–æ¶ˆ\n          </Button>\n          <Button\n            onClick={handleSubmit}\n            disabled={!formData.tour_id || requestItems.length === 0 || !formData.request_date}\n            className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white rounded-md\"\n          >\n            æ–°å¢è«‹æ¬¾å–® (å…± {requestItems.length} é …ï¼ŒNT$ {total_amount.toLocaleString()})\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/BatchRequestDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/BatchTourSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/RequestDateInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/RequestItemForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/RequestItemList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/components/SupplierSearchSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/hooks/useBatchRequestForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/hooks/useRequestForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/hooks/useRequestOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/hooks/useRequestTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/finance/requests/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/itinerary/components/CornerFlightItinerary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/itinerary/components/PrintItineraryForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/itinerary/components/PrintItineraryPreview.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/orders/hooks/useOrders.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/orders/services/order.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/payments/hooks/usePayments.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/payments/services/disbursement-order.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/payments/services/payment-request.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/AccommodationItemRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/CategorySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/CostItemRow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/PrintableQuickQuote.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/PrintableQuotation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/QuickQuoteDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/QuickQuoteDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/QuoteDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/QuoteHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/QuotesList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/QuotesPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/SaveVersionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/SellingPriceSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quick-quote/PrintableQuickQuote.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quick-quote/QuickQuoteCustomerInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quick-quote/QuickQuoteItemsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quick-quote/QuickQuotePaymentInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quick-quote/QuickQuoteReceiptInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quick-quote/QuickQuoteSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quotation/PrintableQuotation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quotation/QuotationInclusions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quotation/QuotationInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quotation/QuotationPricingTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/quotation/QuotationTerms.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/shared/PrintControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/shared/PrintFooter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/shared/PrintHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/shared/print-styles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/components/printable/shared/usePrintLogo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useCategoryOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuickQuoteForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuoteActions.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":15,"column":3,"severity":1,"nodeType":null,"fix":{"range":[681,743],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { useCallback, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { UI_DELAYS } from '@/lib/constants/timeouts'\nimport { generateTourCode } from '@/stores/utils/code-generator'\nimport { getCurrentWorkspaceCode } from '@/lib/workspace-helpers'\nimport { logger } from '@/lib/utils/logger'\nimport { CostCategory, ParticipantCounts, SellingPrices, VersionRecord } from '../types'\nimport { useTourStore } from '@/stores'\nimport type { Quote, Tour } from '@/stores/types'\nimport type { CreateInput } from '@/stores/core/types'\n\ninterface UseQuoteActionsProps {\n  quote: Quote | null | undefined\n  updateQuote: (id: string, data: Partial<Quote>) => void\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  addTour: (data: any) => Promise<Tour | undefined>\n  router: ReturnType<typeof useRouter>\n  updatedCategories: CostCategory[]\n  total_cost: number\n  groupSize: number\n  groupSizeForGuide: number\n  quoteName: string\n  accommodationDays: number\n  participantCounts: ParticipantCounts\n  sellingPrices: SellingPrices\n  versionName: string\n  currentEditingVersion: number | null\n  setSaveSuccess: (value: boolean) => void\n  setCategories: React.Dispatch<React.SetStateAction<CostCategory[]>>\n}\n\nexport const useQuoteActions = ({\n  quote,\n  updateQuote,\n  addTour,\n  router,\n  updatedCategories,\n  total_cost,\n  groupSize,\n  groupSizeForGuide,\n  quoteName,\n  accommodationDays,\n  participantCounts,\n  sellingPrices,\n  versionName,\n  currentEditingVersion,\n  setSaveSuccess,\n  setCategories,\n}: UseQuoteActionsProps) => {\n  // ç•¶äººæ•¸æ”¹è®Šæ™‚ï¼Œé‡æ–°è¨ˆç®—æ‰€æœ‰åœ˜é«”åˆ†æ”¤é …ç›®\n  useEffect(() => {\n    setCategories(prevCategories => {\n      return prevCategories.map(category => {\n        if (\n          category.id === 'group-transport' ||\n          category.id === 'transport' ||\n          category.id === 'guide'\n        ) {\n          const updatedItems = category.items.map(item => {\n            const effectiveQuantity = item.quantity && item.quantity !== 1 ? item.quantity : 1\n            let total = 0\n\n            if (category.id === 'group-transport') {\n              // åœ˜é«”åˆ†æ”¤åˆ†é¡ï¼šè‡ªå‹•åŸ·è¡Œåœ˜é«”åˆ†æ”¤é‚è¼¯\n              if (item.name === 'é ˜éšŠåˆ†æ”¤') {\n                // é ˜éšŠåˆ†æ”¤ï¼š(å–®åƒ¹ Ã— æ•¸é‡) Ã· äººæ•¸ï¼ˆä¸å«å¬°å…’ï¼‰\n                const guideTotalCost = (item.unit_price || 0) * effectiveQuantity\n                total = groupSizeForGuide > 0 ? Math.ceil(guideTotalCost / groupSizeForGuide) : 0\n              } else if (groupSizeForGuide > 1) {\n                // å…¶ä»–åœ˜é«”åˆ†æ”¤é …ç›®ï¼šåŸ·è¡Œä¸€èˆ¬åœ˜é«”åˆ†æ”¤é‚è¼¯ï¼ˆä¸å«å¬°å…’ï¼‰\n                const total_cost = effectiveQuantity * (item.unit_price || 0)\n                total = Math.ceil(total_cost / groupSizeForGuide)\n              } else {\n                // äººæ•¸ç‚º1æ™‚ï¼Œä¸åˆ†æ”¤\n                total = Math.ceil(effectiveQuantity * (item.unit_price || 0))\n              }\n            } else if (\n              (category.id === 'transport' || category.id === 'guide') &&\n              item.is_group_cost &&\n              groupSize > 1\n            ) {\n              // äº¤é€šå’Œé ˜éšŠå°éŠçš„åœ˜é«”åˆ†æ”¤é‚è¼¯ï¼šå°è¨ˆ = (æ•¸é‡ Ã— å–®åƒ¹) Ã· åœ˜é«”äººæ•¸\n              const total_cost = effectiveQuantity * (item.unit_price || 0)\n              total = Math.ceil(total_cost / groupSize)\n            } else {\n              // ç¶­æŒåŸæœ‰çš„ total å€¼\n              total = item.total || 0\n            }\n\n            return { ...item, total }\n          })\n\n          const categoryTotal = updatedItems.reduce((sum, item) => sum + (item.total || 0), 0)\n          return { ...category, items: updatedItems, total: categoryTotal }\n        }\n        return category\n      })\n    })\n  }, [participantCounts, groupSize, groupSizeForGuide, setCategories]) // ç›£è½äººæ•¸è®ŠåŒ–\n\n  // å„²å­˜ç•¶å‰ç‰ˆæœ¬ï¼ˆè¦†è“‹ï¼‰\n  const handleSave = useCallback(\n    () => {\n      if (!quote) return\n\n      try {\n        const baseUpdate = {\n          categories: updatedCategories as any,\n          total_cost,\n          group_size: groupSize,\n          name: quoteName,\n          accommodation_days: accommodationDays,\n          participant_counts: participantCounts,\n          selling_prices: sellingPrices,\n        }\n\n        const existingVersions = quote.versions || []\n\n        // å¦‚æœæ­£åœ¨ç·¨è¼¯æŸå€‹ç‰ˆæœ¬ï¼Œæ›´æ–°è©²ç‰ˆæœ¬\n        if (currentEditingVersion !== null && existingVersions.length > 0) {\n          const updatedVersions = [...existingVersions] as any[]\n          updatedVersions[currentEditingVersion] = {\n            ...updatedVersions[currentEditingVersion],\n            categories: updatedCategories,\n            total_cost,\n            group_size: groupSize,\n            accommodation_days: accommodationDays,\n            participant_counts: participantCounts,\n            selling_prices: sellingPrices,\n            updated_at: new Date().toISOString(),\n          }\n\n          updateQuote(quote.id, {\n            ...baseUpdate,\n            versions: updatedVersions,\n          })\n        } else if (existingVersions.length === 0) {\n          // ç¬¬ä¸€æ¬¡å„²å­˜ï¼šæ²’æœ‰ç‰ˆæœ¬è¨˜éŒ„ï¼Œè‡ªå‹•å‰µå»ºç‰ˆæœ¬ 1\n          const firstVersion = {\n            id: Date.now().toString(),\n            version: 1,\n            categories: updatedCategories,\n            total_cost,\n            group_size: groupSize,\n            accommodation_days: accommodationDays,\n            participant_counts: participantCounts,\n            selling_prices: sellingPrices,\n            note: 'ç‰ˆæœ¬ 1',\n            created_at: new Date().toISOString(),\n          }\n\n          updateQuote(quote.id, {\n            ...baseUpdate,\n            versions: [firstVersion] as any,\n          })\n        } else {\n          // æœ‰ç‰ˆæœ¬è¨˜éŒ„ä½†æ²’æœ‰ç·¨è¼¯ç‰¹å®šç‰ˆæœ¬ï¼Œåªæ›´æ–°ä¸»è³‡æ–™\n          updateQuote(quote.id, baseUpdate)\n        }\n\n        setSaveSuccess(true)\n        setTimeout(() => setSaveSuccess(false), UI_DELAYS.SUCCESS_MESSAGE)\n      } catch (error) {\n        logger.error('å„²å­˜å¤±æ•—:', error)\n      }\n    },\n    [\n      quote,\n      updatedCategories,\n      total_cost,\n      groupSize,\n      quoteName,\n      accommodationDays,\n      participantCounts,\n      sellingPrices,\n      currentEditingVersion,\n      updateQuote,\n      setSaveSuccess,\n    ]\n  )\n\n  // å¦å­˜æ–°ç‰ˆæœ¬\n  const handleSaveAsNewVersion = useCallback(\n    (note?: string, setCurrentEditingVersion?: (index: number) => void) => {\n      if (!quote) return\n\n      try {\n        // è¨ˆç®—æ–°çš„ç‰ˆæœ¬è™Ÿï¼ˆå–å¾—ç‰ˆæœ¬æ­·å²ä¸­çš„æœ€å¤§ç‰ˆæœ¬è™Ÿ + 1ï¼‰\n        const existingVersions = (quote.versions || []) as any[]\n        const maxVersion = existingVersions.reduce((max: number, v: any) =>\n          Math.max(max, v.version || 0), 0\n        )\n        const newVersion = maxVersion + 1\n\n        // å‰µå»ºæ–°çš„ç‰ˆæœ¬è¨˜éŒ„\n        const newVersionRecord = {\n          id: Date.now().toString(),\n          version: newVersion,\n          categories: updatedCategories,\n          total_cost,\n          group_size: groupSize,\n          accommodation_days: accommodationDays,\n          participant_counts: participantCounts,\n          selling_prices: sellingPrices,\n          note: note || versionName || `ç‰ˆæœ¬ ${newVersion}`,\n          created_at: new Date().toISOString(),\n        }\n\n        // æ›´æ–°å ±åƒ¹å–®ï¼šå°‡æ–°ç‰ˆæœ¬åŠ å…¥ç‰ˆæœ¬æ­·å²\n        const newVersions = [...existingVersions, newVersionRecord]\n        updateQuote(quote.id, {\n          categories: updatedCategories as any,\n          total_cost,\n          group_size: groupSize,\n          name: quoteName,\n          accommodation_days: accommodationDays,\n          participant_counts: participantCounts,\n          selling_prices: sellingPrices,\n          versions: newVersions as any,\n        })\n\n        // è‡ªå‹•åˆ‡æ›åˆ°æ–°å‰µå»ºçš„ç‰ˆæœ¬ï¼ˆæ–°ç‰ˆæœ¬çš„ç´¢å¼•æ˜¯ length - 1ï¼‰\n        if (setCurrentEditingVersion) {\n          setCurrentEditingVersion(newVersions.length - 1)\n        }\n\n        // é¡¯ç¤ºæˆåŠŸæç¤º\n        setSaveSuccess(true)\n        setTimeout(() => setSaveSuccess(false), UI_DELAYS.SUCCESS_MESSAGE)\n      } catch (error) {\n        logger.error('ä¿å­˜ç‰ˆæœ¬å¤±æ•—:', error)\n      }\n    },\n    [\n      quote,\n      updatedCategories,\n      total_cost,\n      groupSize,\n      quoteName,\n      accommodationDays,\n      participantCounts,\n      sellingPrices,\n      versionName,\n      updateQuote,\n      setSaveSuccess,\n    ]\n  )\n\n  // æ ¼å¼åŒ–æ™‚é–“\n  const formatDateTime = useCallback((dateString: string) => {\n    const date = new Date(dateString)\n    return date.toLocaleString('zh-TW', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n    })\n  }, [])\n\n  // è½‰ç‚ºæœ€çµ‚ç‰ˆæœ¬\n  const handleFinalize = useCallback(() => {\n    if (!quote) return\n\n    // å…ˆä¿å­˜ç•¶å‰ç‰ˆæœ¬ç‚ºæ–°ç‰ˆæœ¬\n    const existingVersions = (quote.versions || []) as any[]\n    const maxVersion = existingVersions.reduce((max: number, v: any) =>\n      Math.max(max, v.version || 0), 0\n    )\n    const newVersion = maxVersion + 1\n\n    const finalizeVersionRecord = {\n      id: Date.now().toString(),\n      version: newVersion,\n      categories: updatedCategories,\n      total_cost,\n      group_size: groupSize,\n      accommodation_days: accommodationDays,\n      participant_counts: participantCounts,\n      selling_prices: sellingPrices,\n      note: 'è½‰ç‚ºæœ€çµ‚ç‰ˆæœ¬å‰çš„ç‹€æ…‹',\n      created_at: new Date().toISOString(),\n    }\n\n    // æ›´æ–°ç‹€æ…‹ç‚ºæœ€çµ‚ç‰ˆæœ¬\n    updateQuote(quote.id, {\n      status: 'approved',\n      categories: updatedCategories as any,\n      total_cost,\n      group_size: groupSize,\n      name: quoteName,\n      accommodation_days: accommodationDays,\n      participant_counts: participantCounts,\n      selling_prices: sellingPrices,\n      versions: [...existingVersions, finalizeVersionRecord] as any,\n    })\n\n    // è‡ªå‹•è·³è½‰åˆ°æ—…éŠåœ˜æ–°å¢é é¢ï¼Œä¸¦å¸¶ä¸Šå ±åƒ¹å–®ID\n    router.push(`/tours?fromQuote=${quote.id}`)\n  }, [\n    quote,\n    updateQuote,\n    updatedCategories,\n    total_cost,\n    groupSize,\n    quoteName,\n    accommodationDays,\n    participantCounts,\n    sellingPrices,\n    router,\n  ])\n\n  // é–‹æ—…éŠåœ˜\n  const handleCreateTour = useCallback(async () => {\n    if (!quote) return\n\n    // å…ˆä¿å­˜ç›®å‰çš„å ±åƒ¹å–®ç‹€æ…‹ç‚ºæ–°ç‰ˆæœ¬\n    const existingVersions = (quote.versions || []) as any[]\n    const maxVersion = existingVersions.reduce((max: number, v: any) =>\n      Math.max(max, v.version || 0), 0\n    )\n    const newVersion = maxVersion + 1\n\n    const createTourVersionRecord = {\n      id: Date.now().toString(),\n      version: newVersion,\n      categories: updatedCategories,\n      total_cost,\n      group_size: groupSize,\n      accommodation_days: accommodationDays,\n      participant_counts: participantCounts,\n      selling_prices: sellingPrices,\n      note: 'è½‰ç‚ºæ—…éŠåœ˜å‰çš„ç‰ˆæœ¬',\n      created_at: new Date().toISOString(),\n    }\n\n    // æ›´æ–°å ±åƒ¹å–®ç‹€æ…‹ç‚ºæœ€çµ‚ç‰ˆæœ¬\n    updateQuote(quote.id, {\n      status: 'approved',\n      versions: [...existingVersions, createTourVersionRecord] as any,\n    })\n\n    // å‰µå»ºæ—…éŠåœ˜\n    const departure_date = new Date()\n    departure_date.setDate(departure_date.getDate() + 30) // é è¨­30å¤©å¾Œå‡ºç™¼\n    const return_date = new Date(departure_date)\n    return_date.setDate(return_date.getDate() + 5) // é è¨­5å¤©è¡Œç¨‹\n\n    // ä½¿ç”¨å ±åƒ¹å–®åç¨±ä½œç‚ºåœ°é»ï¼ˆç”¨æˆ¶å¯ä»¥åœ¨æ—…éŠåœ˜é é¢å†ä¿®æ”¹ï¼‰\n    const location = quoteName || 'å¾…å®š'\n\n    // ç”Ÿæˆåœ˜è™Ÿï¼ˆä½¿ç”¨é è¨­åœ°å€ä»£ç¢¼ 'XX'ï¼‰\n    const workspaceCode = getCurrentWorkspaceCode()\n    if (!workspaceCode) {\n      throw new Error('ç„¡æ³•å–å¾— workspace code')\n    }\n\n    // ç²å–ç¾æœ‰çš„ tours ä¾†é¿å…ç·¨è™Ÿè¡çª\n    const existingTours = useTourStore.getState().items\n    const tourCode = generateTourCode(\n      workspaceCode,\n      'XX', // é è¨­åœ°å€ä»£ç¢¼ï¼Œç”¨æˆ¶å¯ä»¥å¾ŒçºŒä¿®æ”¹\n      departure_date.toISOString(),\n      existingTours\n    )\n\n    const newTour = await addTour({\n      name: quoteName,\n      location: location,\n      departure_date: departure_date.toISOString().split('T')[0],\n      return_date: return_date.toISOString().split('T')[0],\n      price: Math.round(total_cost / groupSize), // æ¯äººå–®åƒ¹\n      status: 'draft',\n      code: tourCode,\n      contract_status: 'pending',\n      total_revenue: 0,\n      total_cost: total_cost,\n      profit: 0,\n    })\n\n    // æ›´æ–°å ±åƒ¹å–®çš„ tour_id\n    if (newTour?.id) {\n      await updateQuote(quote.id, { tour_id: newTour.id })\n    }\n\n    // è·³è½‰åˆ°æ—…éŠåœ˜ç®¡ç†é é¢ï¼Œä¸¦é«˜äº®æ–°å»ºçš„åœ˜\n    router.push(`/tours?highlight=${newTour?.id}`)\n  }, [\n    quote,\n    updatedCategories,\n    total_cost,\n    groupSize,\n    accommodationDays,\n    participantCounts,\n    sellingPrices,\n    updateQuote,\n    quoteName,\n    addTour,\n    router,\n  ])\n\n  // åˆªé™¤ç‰ˆæœ¬\n  const handleDeleteVersion = useCallback(\n    (versionIndex: number) => {\n      if (!quote || !quote.versions) return\n\n      try {\n        const existingVersions = [...quote.versions]\n        existingVersions.splice(versionIndex, 1)\n\n        updateQuote(quote.id, {\n          versions: existingVersions,\n        })\n\n        setSaveSuccess(true)\n        setTimeout(() => setSaveSuccess(false), UI_DELAYS.SUCCESS_MESSAGE)\n      } catch (error) {\n        logger.error('åˆªé™¤ç‰ˆæœ¬å¤±æ•—:', error)\n      }\n    },\n    [quote, updateQuote, setSaveSuccess]\n  )\n\n  return {\n    handleSave,\n    handleSaveAsNewVersion,\n    formatDateTime,\n    handleFinalize,\n    handleCreateTour,\n    handleDeleteVersion,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuoteCalculations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuoteForm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuoteState.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":24,"column":5,"severity":1,"nodeType":null,"fix":{"range":[882,937],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":32,"column":5,"severity":1,"nodeType":null,"fix":{"range":[1053,1108],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { useState, useEffect, useMemo } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { useQuotes } from './useQuotes'\nimport { useTourStore, useOrderStore } from '@/stores'\nimport { useWorkspaceChannels } from '@/stores/workspace'\nimport { CostCategory, ParticipantCounts, SellingPrices, costCategories } from '../types'\n\nexport const useQuoteState = () => {\n  const params = useParams()\n  const router = useRouter()\n  const { quotes, updateQuote, loadQuotes } = useQuotes()\n  const { items: tours, create: addTour } = useTourStore()\n  const { items: orders } = useOrderStore()\n  const { workspaces, loadWorkspaces } = useWorkspaceChannels()\n\n  const quote_id = params.id as string\n  const quote = quotes.find(q => q.id === quote_id)\n\n  // è‡ªå‹•è¼‰å…¥ workspacesï¼ˆå¦‚æœé‚„æ²’è¼‰å…¥ï¼‰\n  useEffect(() => {\n    if (workspaces.length === 0) {\n      loadWorkspaces()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // è‡ªå‹•è¼‰å…¥ quotesï¼ˆå¦‚æœé‚„æ²’è¼‰å…¥ï¼‰\n  useEffect(() => {\n    if (quotes.length === 0) {\n      loadQuotes()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // æª¢æŸ¥æ˜¯å¦ç‚ºç‰¹æ®Šåœ˜å ±åƒ¹å–®\n  const relatedTour = quote?.tour_id ? tours.find(t => t.id === quote.tour_id) : null\n  const isSpecialTour = relatedTour?.status === 'special'\n  const isReadOnly = isSpecialTour // ç‰¹æ®Šåœ˜å ±åƒ¹å–®è¨­ç‚ºå”¯è®€\n\n  // è¨ˆç®—æ—…éŠåœ˜çš„å¯¦éš›é è¨ˆäººæ•¸ï¼ˆå¾è¨‚å–®çš„ member_count åŠ ç¸½ï¼‰\n  const tourPlannedParticipants = useMemo(() => {\n    if (!relatedTour) return 0\n    const tourOrders = orders.filter(order => order.tour_id === relatedTour.id)\n    return tourOrders.reduce((sum, order) => sum + (order.member_count || 0), 0)\n  }, [relatedTour, orders])\n\n\n  const [categories, setCategories] = useState<CostCategory[]>(() => {\n    const initialCategories = quote?.categories || costCategories\n    // ç¢ºä¿æ¯å€‹åˆ†é¡çš„ç¸½è¨ˆéƒ½æ­£ç¢ºè¨ˆç®—\n    return initialCategories.map(cat => ({\n      ...cat,\n      total: cat.items.reduce((sum, item) => sum + (item.total || 0), 0),\n    }))\n  })\n\n  const [accommodationDays, setAccommodationDays] = useState<number>(quote?.accommodation_days || 0)\n\n  // å¤šèº«ä»½äººæ•¸çµ±è¨ˆï¼ˆåˆå§‹å€¼ï¼šå¾ quote è¼‰å…¥ï¼Œæˆ–å¾ tour/order æ¨ç®—ï¼Œæœ€å¾Œæ‰ç”¨é è¨­å€¼ 1ï¼‰\n  const [participantCounts, setParticipantCounts] = useState<ParticipantCounts>(() => {\n    if (quote?.participant_counts) {\n      return quote.participant_counts\n    }\n\n    // å¦‚æœæœ‰ tourï¼Œå¾ tour çš„è¨‚å–®è¨ˆç®—é è¨ˆäººæ•¸\n    if (quote?.tour_id && relatedTour) {\n      const tourOrders = orders.filter(order => order.tour_id === relatedTour.id)\n      const totalMembers = tourOrders.reduce((sum, order) => sum + (order.member_count || 0), 0)\n\n      if (totalMembers > 0) {\n        return {\n          adult: totalMembers,\n          child_with_bed: 0,\n          child_no_bed: 0,\n          single_room: 0,\n          infant: 0,\n        }\n      }\n\n      // å¦‚æœè¨‚å–®æ²’æœ‰äººæ•¸ï¼Œç”¨ tour çš„ max_participants\n      if (relatedTour.max_participants) {\n        return {\n          adult: relatedTour.max_participants,\n          child_with_bed: 0,\n          child_no_bed: 0,\n          single_room: 0,\n          infant: 0,\n        }\n      }\n    }\n\n    // å¦‚æœ quote æœ‰ group_sizeï¼Œä½¿ç”¨å®ƒ\n    const quoteGroupSize = quote?.group_size\n    if (quoteGroupSize && quoteGroupSize > 0) {\n      return {\n        adult: quoteGroupSize,\n        child_with_bed: 0,\n        child_no_bed: 0,\n        single_room: 0,\n        infant: 0,\n      }\n    }\n\n    // æœ€å¾Œæ‰ç”¨é è¨­å€¼\n    return {\n      adult: 1,\n      child_with_bed: 0,\n      child_no_bed: 0,\n      single_room: 0,\n      infant: 0,\n    }\n  })\n\n  // ç•¶ quote è¼‰å…¥å¾Œï¼Œæ›´æ–°æ‰€æœ‰ç‹€æ…‹\n  useEffect(() => {\n    if (quote) {\n      if (quote.categories) {\n        const loadedCategories = quote.categories.map(cat => ({\n          ...cat,\n          total: cat.items.reduce((sum, item) => sum + (item.total || 0), 0),\n        }))\n        setCategories(loadedCategories)\n      }\n      if (quote.accommodation_days !== undefined) {\n        setAccommodationDays(quote.accommodation_days)\n      }\n      if (quote.participant_counts) {\n        setParticipantCounts(quote.participant_counts)\n      }\n      if (quote.selling_prices) {\n        setSellingPrices(quote.selling_prices)\n      }\n      if (quote.name) {\n        setQuoteName(quote.name)\n      }\n    }\n  }, [quote?.id]) // åªåœ¨ quote.id æ”¹è®Šæ™‚åŸ·è¡Œ\n\n  // ç¸½äººæ•¸ï¼šå„ªå…ˆä½¿ç”¨æ—…éŠåœ˜è¨‚å–®çš„é è¨ˆäººæ•¸ï¼Œå…¶æ¬¡ç”¨ max_participantsï¼Œæœ€å¾Œå¾åƒèˆ‡äººæ•¸åŠ ç¸½\n  const groupSize =\n    tourPlannedParticipants ||\n    relatedTour?.max_participants ||\n    participantCounts.adult +\n      participantCounts.child_with_bed +\n      participantCounts.child_no_bed +\n      participantCounts.single_room +\n      participantCounts.infant\n\n  // å°éŠè²»ç”¨åˆ†æ”¤äººæ•¸ï¼ˆä¸å«å¬°å…’ï¼‰ï¼šå„ªå…ˆä½¿ç”¨æ—…éŠåœ˜è¨‚å–®çš„é è¨ˆäººæ•¸ï¼Œå…¶æ¬¡ç”¨ max_participantsï¼Œæœ€å¾Œå¾åƒèˆ‡äººæ•¸åŠ ç¸½\n  const groupSizeForGuide =\n    tourPlannedParticipants ||\n    relatedTour?.max_participants ||\n    participantCounts.adult +\n      participantCounts.child_with_bed +\n      participantCounts.child_no_bed +\n      participantCounts.single_room\n\n  const [quoteName, setQuoteName] = useState<string>(quote?.name || '')\n  const [saveSuccess, setSaveSuccess] = useState<boolean>(false)\n  const [isSaveDialogOpen, setIsSaveDialogOpen] = useState<boolean>(false)\n  const [versionName, setVersionName] = useState<string>('')\n  const [currentEditingVersion, setCurrentEditingVersion] = useState<number | null>(null) // è¿½è¹¤ç•¶å‰ç·¨è¼¯çš„ç‰ˆæœ¬ç´¢å¼•\n\n  // å¤šèº«ä»½å”®åƒ¹\n  const [sellingPrices, setSellingPrices] = useState<SellingPrices>(\n    quote?.selling_prices || {\n      adult: 0,\n      child_with_bed: 0,\n      child_no_bed: 0,\n      single_room: 0,\n      infant: 0,\n    }\n  )\n\n  // å¦‚æœæ‰¾ä¸åˆ°å ±åƒ¹å–®ï¼Œè¿”å›åˆ—è¡¨é ï¼ˆåªæœ‰åœ¨è³‡æ–™å·²è¼‰å…¥æ™‚æ‰åˆ¤æ–·ï¼‰\n  useEffect(() => {\n    // åªæœ‰ç•¶ quotes é™£åˆ—æœ‰è³‡æ–™ï¼ˆè¡¨ç¤ºå·²è¼‰å…¥ï¼‰ä¸”æ‰¾ä¸åˆ°å°æ‡‰çš„ quote æ™‚ï¼Œæ‰è·³è½‰\n    if (quotes.length > 0 && !quote) {\n      router.push('/quotes')\n    }\n  }, [quote, quotes.length, router])\n\n  return {\n    quote_id,\n    quote,\n    relatedTour,\n    isSpecialTour,\n    isReadOnly,\n    categories,\n    setCategories,\n    accommodationDays,\n    setAccommodationDays,\n    participantCounts,\n    setParticipantCounts,\n    groupSize,\n    groupSizeForGuide,\n    quoteName,\n    setQuoteName,\n    saveSuccess,\n    setSaveSuccess,\n    isSaveDialogOpen,\n    setIsSaveDialogOpen,\n    versionName,\n    setVersionName,\n    currentEditingVersion,\n    setCurrentEditingVersion,\n    sellingPrices,\n    setSellingPrices,\n    updateQuote,\n    addTour,\n    router,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuoteTourSync.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuotes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuotesData.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":31,"column":5,"severity":1,"nodeType":null,"fix":{"range":[929,984],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * Hook for quotes data fetching and CRUD operations\n */\n\n'use client'\n\nimport { useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useQuotes } from './useQuotes'\nimport { useTourStore, useRegionsStore } from '@/stores'\nimport { logger } from '@/lib/utils/logger'\n\nexport const useQuotesData = () => {\n  const router = useRouter()\n  const { quotes, addQuote, updateQuote, deleteQuote, duplicateQuote, loadQuotes } = useQuotes()\n  const { items: tours, fetchAll: fetchTours } = useTourStore()\n  const { countries, cities, fetchAll: fetchRegions, getCitiesByCountry } = useRegionsStore()\n\n  // è¼‰å…¥å ±åƒ¹å–®è³‡æ–™ - åªåœ¨é¦–æ¬¡è¼‰å…¥æ™‚åŸ·è¡Œ\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      loadQuotes()\n      // âœ… è¼‰å…¥ toursï¼ˆå ±åƒ¹å–®éœ€è¦é—œè¯æ—…éŠåœ˜ï¼‰\n      if (tours.length === 0) {\n        fetchTours()\n      }\n      // âœ… ç§»é™¤è‡ªå‹•è¼‰å…¥ regionsï¼ˆæ”¹ç‚ºåœ¨æ‰“é–‹å°è©±æ¡†æ™‚æ‰è¼‰å…¥ï¼‰\n      // fetchRegions()\n    }, 100)\n    return () => clearTimeout(timer)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []) // åªåŸ·è¡Œä¸€æ¬¡ï¼Œé¿å…ç„¡é™å¾ªç’°\n\n  const handleDuplicateQuote = async (quote_id: string, e?: React.MouseEvent) => {\n    if (e) e.stopPropagation()\n\n    try {\n      const duplicated = await duplicateQuote(quote_id)\n      if (duplicated && 'id' in duplicated && duplicated.id) {\n        router.push(`/quotes/${duplicated.id}`)\n      } else {\n        alert('è¤‡è£½å ±åƒ¹å–®å¤±æ•—ï¼Œè«‹é‡è©¦')\n      }\n    } catch (error) {\n      logger.error('âŒ è¤‡è£½å ±åƒ¹å–®å¤±æ•—:', error)\n      alert('è¤‡è£½å ±åƒ¹å–®å¤±æ•—ï¼Œè«‹é‡è©¦')\n    }\n  }\n\n  const handleTogglePin = async (quoteId: string, isPinned: boolean, e?: React.MouseEvent) => {\n    if (e) e.stopPropagation()\n    await updateQuote(quoteId, { is_pinned: !isPinned })\n  }\n\n  const handleDeleteQuote = async (quoteId: string, e?: React.MouseEvent) => {\n    if (e) e.stopPropagation()\n    await deleteQuote(quoteId)\n  }\n\n  const handleQuoteClick = (quoteId: string) => {\n    router.push(`/quotes/${quoteId}`)\n  }\n\n  return {\n    // Data\n    quotes,\n    tours,\n    countries,\n    cities,\n    getCitiesByCountry,\n\n    // Actions\n    addQuote,\n    updateQuote,\n    deleteQuote,\n    handleDuplicateQuote,\n    handleTogglePin,\n    handleDeleteQuote,\n    handleQuoteClick,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/hooks/useQuotesFilters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/services/quote.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/quotes/utils/calculateTierPricing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/suppliers/components/SuppliersDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/suppliers/components/SuppliersList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/suppliers/components/SuppliersPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/suppliers/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/DeleteConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourActionButtons.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourChannelOperations.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourExpandedView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourMobileCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourOperationsAddButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourOverviewTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/TourTableColumns.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/ToursPage.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":245,"column":5,"severity":1,"nodeType":null,"fix":{"range":[7395,7450],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * ToursPage - Main tours list page component\n */\n\n'use client'\n\nimport React, { useCallback, useEffect, useMemo } from 'react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { ResponsiveHeader } from '@/components/layout/responsive-header'\nimport { useTours } from '../hooks/useTours-advanced'\nimport { PageRequest } from '@/core/types/common'\nimport {\n  Calendar,\n  FileText,\n  MapPin,\n  BarChart3,\n  FileCheck,\n  AlertCircle,\n  Archive,\n} from 'lucide-react'\nimport {\n  useOrderStore,\n  useEmployeeStore,\n  useRegionsStore,\n  useMemberStore,\n} from '@/stores'\nimport { useAuthStore } from '@/stores/auth-store'\nimport { useQuotes } from '@/features/quotes/hooks/useQuotes'\nimport { Tour } from '@/stores/types'\nimport { EnhancedTable } from '@/components/ui/enhanced-table'\nimport { useDialog } from '@/hooks/useDialog'\nimport { useTourPageState } from '../hooks/useTourPageState'\nimport { useTourOperations } from '../hooks/useTourOperations'\nimport { TourForm } from './TourForm'\nimport { TourExpandedView } from './TourExpandedView'\nimport { TourMobileCard } from './TourMobileCard'\nimport { DeleteConfirmDialog } from './DeleteConfirmDialog'\nimport { useTourTableColumns } from './TourTableColumns'\nimport { useTourChannelOperations } from './TourChannelOperations'\nimport { useTourActionButtons } from './TourActionButtons'\nimport {\n  useRealtimeForTours,\n} from '@/hooks/use-realtime-hooks'\n\nexport const ToursPage: React.FC = () => {\n  // âœ… Realtime è¨‚é–±ï¼ˆåªè¨‚é–± Toursï¼‰\n  // Orders, Members, Quotes åªç”¨ä¾†é¡¯ç¤ºçµ±è¨ˆæ•¸å­—ï¼Œä¸éœ€è¦å³æ™‚è¨‚é–±\n  // å±•é–‹æ™‚çš„è©³ç´°è³‡æ–™æœƒåœ¨ TourExpandedView ä¸­æŒ‰éœ€è¨‚é–±\n  useRealtimeForTours()\n\n  const router = useRouter()\n  const searchParams = useSearchParams()\n  const { user } = useAuthStore()\n  const orderStore = useOrderStore()\n  const { items: orders } = orderStore\n  const addOrder = orderStore.create\n  const { items: members } = useMemberStore()\n  const employeeStore = useEmployeeStore()\n  const { items: employees } = employeeStore\n  const { countries, cities, fetchAll: fetchRegions, getCitiesByCountry } = useRegionsStore()\n  const { quotes, updateQuote } = useQuotes()\n  const { dialog, openDialog, closeDialog } = useDialog()\n\n  // Use custom hooks\n  const state = useTourPageState()\n  const {\n    currentPage,\n    setCurrentPage,\n    sortBy,\n    setSortBy,\n    sortOrder,\n    setSortOrder,\n    expandedRows,\n    activeStatusTab,\n    setActiveStatusTab,\n    searchQuery,\n    setSearchQuery,\n    deleteConfirm,\n    setDeleteConfirm,\n    pageSize,\n    activeTabs,\n    submitting,\n    setSubmitting,\n    formError,\n    setFormError,\n    triggerAddOnAdd,\n    setTriggerAddOnAdd,\n    triggerRefundAdd,\n    setTriggerRefundAdd,\n    triggerPaymentAdd,\n    setTriggerPaymentAdd,\n    triggerCostAdd,\n    setTriggerCostAdd,\n    tourExtraFields,\n    setTourExtraFields,\n    newTour,\n    setNewTour,\n    newOrder,\n    setNewOrder,\n    availableCities,\n    setAvailableCities,\n    toggleRowExpand,\n    setActiveTab,\n    getStatusColor,\n    setSelectedTour,\n  } = state\n\n  // Lazy load: only load regions and employees when opening create dialog\n  const handleOpenCreateDialog = useCallback(\n    async (tour: Tour | null = null, fromQuoteId?: string) => {\n      if (countries.length === 0) {\n        await fetchRegions()\n      }\n      if (employees.length === 0) {\n        await employeeStore.fetchAll()\n      }\n      openDialog('create', tour, fromQuoteId)\n    },\n    [countries.length, employees.length, fetchRegions, employeeStore, openDialog]\n  )\n\n  // Build PageRequest parameters\n  const pageRequest: PageRequest = useMemo(\n    () => ({\n      page: currentPage,\n      pageSize: 20,\n      search: '',\n      sortBy,\n      sortOrder,\n    }),\n    [currentPage, sortBy, sortOrder]\n  )\n\n  // Use tours hook\n  const { data: tours, loading, actions } = useTours(pageRequest)\n\n  // âœ… ç§»é™¤è‡ªå‹•è¼‰å…¥ regionsï¼ˆæ”¹ç‚ºåœ¨æ‰“é–‹å°è©±æ¡†æ™‚æ‰è¼‰å…¥ï¼‰\n  // åŸå› ï¼šå¤§éƒ¨åˆ†ç”¨æˆ¶åªæ˜¯ç€è¦½åˆ—è¡¨ï¼Œä¸éœ€è¦è¼‰å…¥ 187 ç­† cities\n  // React.useEffect(() => {\n  //   if (countries.length === 0) {\n  //     fetchRegions();\n  //   }\n  // }, [countries.length]);\n\n  // Get active countries from new region store\n  const activeCountries = useMemo(() => {\n    return countries\n      .filter(c => c.is_active)\n      .map(c => ({ id: c.id, code: c.code || '', name: c.name }))\n  }, [countries])\n\n  // Get cities by country ID\n  const getCitiesByCountryId = useCallback(\n    (countryId: string) => {\n      return getCitiesByCountry(countryId)\n        .filter(c => c.is_active)\n        .map(c => ({\n          id: c.id,\n          code: c.airport_code || c.name,\n          name: c.name,\n          country_id: c.country_id,\n        }))\n    },\n    [getCitiesByCountry]\n  )\n\n  // Filter tours by status and search query\n  const filteredTours = (tours || []).filter(tour => {\n    // å°å­˜åˆ†é ï¼šåªé¡¯ç¤ºå·²çµåœ˜çš„\n    if (activeStatusTab === 'archived') {\n      const searchLower = searchQuery.toLowerCase()\n      const searchMatch =\n        !searchQuery ||\n        tour.name.toLowerCase().includes(searchLower) ||\n        tour.code.toLowerCase().includes(searchLower) ||\n        (tour.location || '').toLowerCase().includes(searchLower) ||\n        (tour.status || '').toLowerCase().includes(searchLower) ||\n        tour.description?.toLowerCase().includes(searchLower)\n\n      return tour.closing_status === 'closed' && searchMatch\n    }\n\n    // å…¶ä»–åˆ†é ï¼šæ’é™¤å·²çµåœ˜çš„\n    const notClosed = tour.closing_status !== 'closed'\n    const statusMatch = activeStatusTab === 'all' || tour.status === activeStatusTab\n    const searchLower = searchQuery.toLowerCase()\n    const searchMatch =\n      !searchQuery ||\n      tour.name.toLowerCase().includes(searchLower) ||\n      tour.code.toLowerCase().includes(searchLower) ||\n      (tour.location || '').toLowerCase().includes(searchLower) ||\n      (tour.status || '').toLowerCase().includes(searchLower) ||\n      tour.description?.toLowerCase().includes(searchLower)\n\n    return notClosed && statusMatch && searchMatch\n  })\n\n  // Handle edit mode: load tour data when dialog opens in edit mode\n  useEffect(() => {\n    if (dialog.type === 'edit' && dialog.data) {\n      const tour = dialog.data as Tour\n\n      let countryCode = ''\n      let cityCode = ''\n\n      // Try to find matching city from destinations\n      for (const country of activeCountries) {\n        const citiesInCountry = getCitiesByCountry(country.id)\n          .filter(c => c.is_active)\n          .map(c => ({\n            id: c.id,\n            code: c.airport_code || c.name,\n            name: c.name,\n            country_id: c.country_id,\n          }))\n        const matchedCity = citiesInCountry.find(city => city.name === tour.location)\n        if (matchedCity) {\n          countryCode = country.code\n          cityCode = matchedCity.code\n          setAvailableCities(citiesInCountry)\n          break\n        }\n      }\n\n      // If not found, set as custom\n      if (!countryCode) {\n        countryCode = '__custom__'\n        cityCode = '__custom__'\n      }\n\n      setNewTour({\n        name: tour.name,\n        countryCode,\n        cityCode,\n        customLocation: countryCode === '__custom__' ? (tour.location || undefined) : undefined,\n        departure_date: tour.departure_date || '',\n        return_date: tour.return_date || '',\n        price: tour.price ?? 0,\n        status: (tour.status || 'draft') as Tour['status'],\n        isSpecial: tour.status === 'special',\n        max_participants: tour.max_participants || 20,\n        description: tour.description || '',\n      })\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dialog.type, dialog.data, activeCountries])\n\n  // Handle navigation from quote\n  useEffect(() => {\n    const fromQuoteId = searchParams.get('fromQuote')\n    const highlightId = searchParams.get('highlight')\n    const departure_date = searchParams.get('departure_date')\n    const shouldOpenDialog = searchParams.get('openDialog')\n\n    if (fromQuoteId) {\n      const sourceQuote = quotes.find(quote => quote.id === fromQuoteId)\n      if (sourceQuote) {\n        setNewTour(prev => ({\n          ...prev,\n          name: sourceQuote.name || prev.name,\n          price: Math.round((sourceQuote.total_cost ?? 0) / (sourceQuote.group_size ?? 1)),\n        }))\n        handleOpenCreateDialog(null, fromQuoteId)\n      }\n    }\n\n    if (departure_date && shouldOpenDialog === 'true') {\n      setNewTour(prev => ({\n        ...prev,\n        departure_date: departure_date,\n      }))\n      handleOpenCreateDialog()\n    }\n\n    if (highlightId) {\n      toggleRowExpand(highlightId)\n      setActiveTab(highlightId, 'tasks')\n    }\n  }, [searchParams, quotes, handleOpenCreateDialog, setNewTour, toggleRowExpand, setActiveTab])\n\n  const resetForm = useCallback(() => {\n    setNewTour({\n      name: '',\n      countryCode: '',\n      cityCode: '',\n      departure_date: '',\n      return_date: '',\n      price: 0,\n      status: 'draft',\n      isSpecial: false,\n      max_participants: 20,\n      description: '',\n    })\n    setAvailableCities([])\n    setNewOrder({\n      contact_person: '',\n      sales_person: '',\n      assistant: '',\n      member_count: 1,\n      total_amount: 0,\n    })\n    setFormError(null)\n  }, [setNewTour, setAvailableCities, setNewOrder, setFormError])\n\n  // Use tour operations hook\n  const operations = useTourOperations({\n    actions: actions as any,\n    addOrder,\n    updateQuote: updateQuote as any,\n    availableCities,\n    resetForm,\n    closeDialog,\n    setSubmitting,\n    setFormError,\n    dialogType: dialog.type || 'create',\n    dialogData: dialog.data as any,\n  })\n\n  const handleAddTour = useCallback(() => {\n    const fromQuoteId = searchParams.get('fromQuote')\n    operations.handleAddTour(newTour, newOrder, fromQuoteId ?? undefined)\n  }, [operations, newTour, newOrder, searchParams])\n\n  const handleSortChange = useCallback(\n    (field: string, order: 'asc' | 'desc') => {\n      setSortBy(field)\n      setSortOrder(order)\n      setCurrentPage(1)\n    },\n    [setSortBy, setSortOrder, setCurrentPage]\n  )\n\n  const handleRowClick = useCallback(\n    (row: unknown) => {\n      const tour = row as Tour\n      setSelectedTour(tour)\n      router.push(`/tours/${tour.id}`)\n    },\n    [router, setSelectedTour]\n  )\n\n  const handleDeleteTour = useCallback(async () => {\n    await operations.handleDeleteTour(deleteConfirm.tour)\n    setDeleteConfirm({ isOpen: false, tour: null })\n  }, [operations, deleteConfirm.tour, setDeleteConfirm])\n\n  // Use extracted hooks for table columns, channel operations, and action buttons\n  const columns = useTourTableColumns({ orders: orders as any, getStatusColor })\n\n  const { handleCreateChannel, handleUnlockTour } = useTourChannelOperations({ actions: actions as any })\n\n  const { renderActions } = useTourActionButtons({\n    quotes,\n    activeStatusTab,\n    user,\n    operations,\n    openDialog,\n    setSelectedTour,\n    setDeleteConfirm,\n    handleCreateChannel,\n    handleUnlockTour,\n  })\n\n  const renderExpanded = useCallback(\n    (row: unknown) => {\n      const tour = row as Tour\n      return (\n      <TourExpandedView\n        tour={tour}\n        orders={orders as any}\n        activeTabs={activeTabs}\n        setActiveTab={setActiveTab}\n        openDialog={openDialog}\n        tourExtraFields={tourExtraFields as any}\n        setTourExtraFields={setTourExtraFields as any}\n        triggerAddOnAdd={triggerAddOnAdd}\n        setTriggerAddOnAdd={setTriggerAddOnAdd}\n        triggerPaymentAdd={triggerPaymentAdd}\n        setTriggerPaymentAdd={setTriggerPaymentAdd}\n        triggerCostAdd={triggerCostAdd}\n        setTriggerCostAdd={setTriggerCostAdd}\n      />\n      )\n    },\n    [\n      orders,\n      activeTabs,\n      setActiveTab,\n      openDialog,\n      tourExtraFields,\n      setTourExtraFields,\n      triggerAddOnAdd,\n      setTriggerAddOnAdd,\n      triggerRefundAdd,\n      setTriggerRefundAdd,\n      triggerPaymentAdd,\n      setTriggerPaymentAdd,\n      triggerCostAdd,\n      setTriggerCostAdd,\n    ]\n  )\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-morandi-secondary\">è¼‰å…¥ä¸­...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"æ—…éŠåœ˜ç®¡ç†\"\n        icon={MapPin}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'æ—…éŠåœ˜ç®¡ç†', href: '/tours' },\n        ]}\n        showSearch={true}\n        searchTerm={searchQuery}\n        onSearchChange={setSearchQuery}\n        searchPlaceholder=\"æœå°‹æ—…éŠåœ˜...\"\n        onAdd={handleOpenCreateDialog}\n        addLabel=\"æ–°å¢æ—…éŠåœ˜\"\n        tabs={[\n          { value: 'all', label: 'å…¨éƒ¨', icon: BarChart3 },\n          { value: 'ææ¡ˆ', label: 'ææ¡ˆ', icon: FileText },\n          { value: 'é€²è¡Œä¸­', label: 'é€²è¡Œä¸­', icon: Calendar },\n          { value: 'å¾…çµæ¡ˆ', label: 'å¾…çµæ¡ˆ', icon: AlertCircle },\n          { value: 'çµæ¡ˆ', label: 'çµæ¡ˆ', icon: FileCheck },\n          { value: 'archived', label: 'å°å­˜', icon: Archive },\n        ]}\n        activeTab={activeStatusTab}\n        onTabChange={(tab: string) => {\n          setActiveStatusTab(tab)\n          setCurrentPage(1)\n        }}\n      />\n\n      {/* Tour list */}\n      <div className=\"flex-1 overflow-hidden\">\n        {/* æ¡Œé¢æ¨¡å¼ï¼šè¡¨æ ¼ */}\n        <div className=\"hidden md:block h-full\">\n          <EnhancedTable\n            columns={columns}\n            data={filteredTours}\n            loading={loading}\n            onSort={handleSortChange}\n            expandable={{\n              expanded: expandedRows,\n              onExpand: toggleRowExpand,\n              renderExpanded,\n            }}\n            actions={renderActions}\n            onRowClick={handleRowClick}\n            bordered={true}\n          />\n        </div>\n\n        {/* æ‰‹æ©Ÿæ¨¡å¼ï¼šå¡ç‰‡åˆ—è¡¨ */}\n        <div className=\"md:hidden space-y-3 pb-4\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-morandi-gold\"></div>\n            </div>\n          ) : filteredTours.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <MapPin size={48} className=\"text-morandi-secondary/30 mb-4\" />\n              <p className=\"text-morandi-secondary\">æ²’æœ‰æ‰¾åˆ°æ—…éŠåœ˜</p>\n              <p className=\"text-sm text-morandi-secondary/70 mt-1\">è«‹èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–æ–°å¢æ—…éŠåœ˜</p>\n            </div>\n          ) : (\n            filteredTours.map(tour => (\n              <TourMobileCard\n                key={tour.id}\n                tour={tour}\n                onClick={() => handleRowClick(tour)}\n                getStatusColor={getStatusColor}\n              />\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Tour form dialog */}\n      <TourForm\n        isOpen={dialog.isOpen}\n        onClose={() => {\n          resetForm()\n          closeDialog()\n        }}\n        mode={dialog.type === 'edit' ? 'edit' : 'create'}\n        newTour={newTour}\n        setNewTour={setNewTour}\n        newOrder={newOrder}\n        setNewOrder={setNewOrder}\n        activeCountries={activeCountries}\n        availableCities={availableCities}\n        setAvailableCities={setAvailableCities}\n        getCitiesByCountryId={getCitiesByCountryId}\n        submitting={submitting}\n        formError={formError}\n        onSubmit={handleAddTour}\n      />\n\n      {/* Delete confirmation dialog */}\n      <DeleteConfirmDialog\n        isOpen={deleteConfirm.isOpen}\n        tour={deleteConfirm.tour}\n        onClose={() => setDeleteConfirm({ isOpen: false, tour: null })}\n        onConfirm={handleDeleteTour}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/DailyImageCarousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourFeaturesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourFlightSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourHeroSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourHotelsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourItinerarySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourLeaderSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/components/sections/TourNavigation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTourGallery.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTourItineraryNav.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTourOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTourPageState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTourScrollEffects.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTours-advanced.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/hooks/useTours.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/services/tour.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/tours/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/transportation-rates/components/CountryList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/transportation-rates/components/RatesDetailDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/components/AddVisaDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/components/VisasInfoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/components/VisasList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/components/VisasPage.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":58,"column":3,"severity":1,"nodeType":null,"fix":{"range":[1701,1756],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":100,"column":3,"severity":1,"nodeType":null,"fix":{"range":[2713,2768],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"'use client'\n\nimport React, { useEffect } from 'react'\nimport { FileText, Clock, CheckCircle, XCircle, AlertCircle, FileCheck, Info } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { ResponsiveHeader } from '@/components/layout/responsive-header'\nimport { logger } from '@/lib/utils/logger'\nimport { tourService } from '@/features/tours/services/tour.service'\nimport { toast } from 'sonner'\nimport { useVisasData } from '../hooks/useVisasData'\nimport { useVisasFilters } from '../hooks/useVisasFilters'\nimport { useVisasDialog } from '../hooks/useVisasDialog'\nimport { VisasList } from './VisasList'\nimport { VisasInfoDialog } from './VisasInfoDialog'\nimport { AddVisaDialog } from './AddVisaDialog'\nimport {\n  useRealtimeForVisas,\n} from '@/hooks/use-realtime-hooks'\n\n// ============================================\n// ç°½è­‰ç®¡ç†ä¸»é é¢\n// ============================================\n\nexport default function VisasPage() {\n  // âœ… Realtime è¨‚é–±ï¼ˆåªè¨‚é–± Visasï¼‰\n  // Tours, Orders, Members, Customers åªç”¨ä¾†é¡¯ç¤ºåç¨±ï¼Œä¸éœ€è¦å³æ™‚è¨‚é–±\n  useRealtimeForVisas()\n  // è³‡æ–™ç®¡ç†\n  const {\n    visas,\n    tours,\n    orders,\n    user,\n    canManageVisas,\n    addVisa,\n    updateVisa,\n    deleteVisa,\n    addTour,\n    fetchTours,\n    addOrder,\n  } = useVisasData()\n\n  // è¼‰å…¥è³‡æ–™\n  React.useEffect(() => {\n    const loadData = async () => {\n      const { useVisaStore, useOrderStore, useMemberStore, useCustomerStore } = await import(\n        '@/stores'\n      )\n      await Promise.all([\n        useVisaStore.getState().fetchAll(),\n        fetchTours(),\n        useOrderStore.getState().fetchAll(),\n        useMemberStore.getState().fetchAll(),\n        useCustomerStore.getState().fetchAll(),\n      ])\n    }\n    loadData()\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // ç¯©é¸ç®¡ç†\n  const { activeTab, setActiveTab, selectedRows, setSelectedRows, filteredVisas } =\n    useVisasFilters(visas)\n\n  // å°è©±æ¡†ç®¡ç†\n  const {\n    isDialogOpen,\n    setIsDialogOpen,\n    contact_info,\n    setContactInfo,\n    applicants,\n    setApplicants,\n    tourOptions,\n    calculateFee,\n    addApplicant,\n    removeApplicant,\n    updateApplicant,\n    resetForm,\n  } = useVisasDialog(tours)\n\n  const [isInfoDialogOpen, setIsInfoDialogOpen] = React.useState(false)\n  const [isSubmitting, setIsSubmitting] = React.useState(false)\n\n  // æ¬Šé™æª¢æŸ¥ï¼šæ¸…é™¤é¸æ“‡\n  useEffect(() => {\n    if (!canManageVisas && selectedRows.length > 0) {\n      setSelectedRows([])\n    }\n  }, [canManageVisas, selectedRows.length, setSelectedRows])\n\n  // ç¬¬ä¸€å€‹è¾¦ç†äººè‡ªå‹•å¸¶å…¥ç”³è«‹äººå§“å\n  useEffect(() => {\n    if (applicants.length > 0) {\n      setApplicants(prev => {\n        const updated = [...prev]\n        updated[0].name = contact_info.applicant_name\n        return updated\n      })\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [contact_info.applicant_name, applicants.length])\n\n  // è™•ç†æ‰¹æ¬¡æ–°å¢ç°½è­‰\n  const handleAddVisa = async () => {\n    // é˜²æ­¢é‡è¤‡æäº¤\n    if (isSubmitting) return\n    setIsSubmitting(true)\n\n    try {\n    if (!canManageVisas || !contact_info.applicant_name || !user) return\n\n    let selectedTour\n\n    // å¦‚æœæ²’é¸åœ˜è™Ÿï¼Œä½¿ç”¨é è¨­ç°½è­‰åœ˜ï¼ˆä¸è‡ªå‹•å»ºç«‹ï¼‰\n    if (!contact_info.tour_id) {\n      const currentYear = new Date().getFullYear()\n      const defaultTourCode = `VISA-${currentYear}`\n      const existingDefaultTour = tours.find(t => t.code === defaultTourCode)\n\n      if (existingDefaultTour) {\n        selectedTour = existingDefaultTour\n      } else {\n        // æç¤ºç®¡ç†å“¡éœ€è¦å…ˆå»ºç«‹ç°½è­‰åœ˜\n        toast.error(`è«‹å…ˆåœ¨ç°½è­‰é é¢è¨­å®š ${currentYear} å¹´é è¨­ç°½è­‰åœ˜ï¼Œæˆ–åœ¨è¡¨å–®ä¸­é¸æ“‡åœ˜è™Ÿ`)\n        return\n      }\n    } else {\n      selectedTour = tours.find(t => t.id === contact_info.tour_id)\n      if (!selectedTour) return\n    }\n\n    // å–å¾—æˆ–å»ºç«‹è¨‚å–®\n    const totalFee = applicants.reduce((sum, a) => sum + calculateFee(a.country), 0)\n    let targetOrder\n\n    // å¦‚æœé¸æ“‡ã€Œ+ æ–°å¢è¨‚å–®ã€æˆ–æ²’æœ‰é¸è¨‚å–®ï¼Œå‰‡è‡ªå‹•å»ºç«‹\n    if (contact_info.order_id && contact_info.order_id !== '__create_new__') {\n      targetOrder = orders.find(o => o.id === contact_info.order_id)\n      if (!targetOrder) return\n    } else {\n      // é‡æ–°æŸ¥è©¢è©²åœ˜çš„è¨‚å–®æ•¸é‡ï¼ˆç¢ºä¿æœ€æ–°ï¼‰\n      const { supabase } = await import('@/lib/supabase/client')\n      const { count } = await supabase\n        .from('orders')\n        .select('*', { count: 'exact', head: true })\n        .eq('tour_id', selectedTour.id)\n\n      const nextNumber = ((count || 0) + 1).toString().padStart(3, '0')\n      const order_number = `${selectedTour.code}-${nextNumber}`\n\n      targetOrder = await addOrder({\n        order_number,\n        tour_id: selectedTour.id,\n        code: order_number,\n        tour_name: selectedTour.name,\n        contact_person: contact_info.contact_person || contact_info.applicant_name,\n        sales_person: user.display_name || 'ç³»çµ±',\n        assistant: user.display_name || 'ç³»çµ±',\n        member_count: applicants.filter(a => a.name).length,\n        total_amount: totalFee,\n        paid_amount: 0,\n        remaining_amount: totalFee,\n        payment_status: 'unpaid' as const,\n      } as any)\n\n      if (contact_info.order_id === '__create_new__') {\n        toast.success(`å·²å»ºç«‹è¨‚å–®ï¼š${order_number}`)\n      }\n    }\n\n    if (!targetOrder) {\n      logger.error('è¨‚å–®å»ºç«‹å¤±æ•—')\n      return\n    }\n\n    // æ‰¹æ¬¡å»ºç«‹ç°½è­‰ï¼ˆä½¿ç”¨ for...of ç¢ºä¿é †åºåŸ·è¡Œï¼‰\n    for (const applicant of applicants) {\n      if (!applicant.name) continue\n\n      const fee = calculateFee(applicant.country)\n      const total_cost = applicant.is_urgent ? applicant.cost + 900 : applicant.cost\n\n      await addVisa({\n        applicant_name: applicant.name,\n        contact_person: contact_info.contact_person || '',\n        contact_phone: contact_info.contact_phone || '',\n        visa_type: applicant.country,\n        country: applicant.country,\n        submission_date: applicant.submission_date,\n        received_date: applicant.received_date,\n        fee,\n        cost: total_cost,\n        status: 'pending',\n        order_id: targetOrder.id,\n        order_number: targetOrder.order_number || '',\n        tour_id: selectedTour.id,\n        code: selectedTour.code,\n        created_by: user.id,\n        note: '',\n      })\n    }\n\n      // é‡ç½®è¡¨å–®\n      const currentYear = new Date().getFullYear()\n      const visaCode = `VISA${currentYear}001`\n      const defaultVisaTour = tours.find(t => t.code === visaCode)\n      resetForm(defaultVisaTour?.id)\n      setIsDialogOpen(false)\n    } catch (error) {\n      logger.error('æ‰¹æ¬¡æ–°å¢ç°½è­‰å¤±æ•—', error)\n      toast.error('æ–°å¢ç°½è­‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦')\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  // æ‰¹æ¬¡é€ä»¶\n  const handleBatchSubmit = async () => {\n    if (!canManageVisas || selectedRows.length === 0) return\n    const today = new Date().toISOString().split('T')[0]\n\n    for (const id of selectedRows) {\n      await updateVisa(id, { status: 'submitted', submission_date: today })\n    }\n\n    setSelectedRows([])\n  }\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      <ResponsiveHeader\n        title=\"ç°½è­‰ç®¡ç†\"\n        icon={FileText}\n        breadcrumb={[\n          { label: 'é¦–é ', href: '/' },\n          { label: 'ç°½è­‰ç®¡ç†', href: '/visas' },\n        ]}\n        actions={\n          <div className=\"flex items-center gap-3\">\n            {/* æ‰¹æ¬¡æ“ä½œå€åŸŸ */}\n            {canManageVisas && selectedRows.length > 0 ? (\n              <>\n                <span className=\"text-sm text-morandi-primary\">\n                  å·²é¸æ“‡ {selectedRows.length} ç­†ç°½è­‰\n                </span>\n                <Button\n                  onClick={() => {\n                    selectedRows.forEach(id => updateVisa(id, { status: 'submitted' }))\n                    setSelectedRows([])\n                  }}\n                  size=\"sm\"\n                  className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                >\n                  é€\n                </Button>\n                <Button\n                  onClick={() => {\n                    selectedRows.forEach(id => updateVisa(id, { status: 'collected' }))\n                    setSelectedRows([])\n                  }}\n                  size=\"sm\"\n                  className=\"bg-green-600 hover:bg-green-700 text-white\"\n                >\n                  å–\n                </Button>\n                <Button\n                  onClick={() => {\n                    selectedRows.forEach(id => updateVisa(id, { status: 'rejected' }))\n                    setSelectedRows([])\n                  }}\n                  size=\"sm\"\n                  className=\"bg-red-600 hover:bg-red-700 text-white\"\n                >\n                  é€€\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" onClick={() => setSelectedRows([])}>\n                  å–æ¶ˆé¸æ“‡\n                </Button>\n              </>\n            ) : (\n              <>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setIsInfoDialogOpen(true)}\n                  className=\"flex items-center gap-2\"\n                >\n                  <Info size={16} />\n                  æŸ¥çœ‹ç°½è­‰è³‡è¨Š\n                </Button>\n                {canManageVisas && (\n                  <Button\n                    onClick={() => setIsDialogOpen(true)}\n                    className=\"bg-morandi-gold hover:bg-morandi-gold-hover text-white\"\n                  >\n                    æ–°å¢ç°½è­‰\n                  </Button>\n                )}\n              </>\n            )}\n          </div>\n        }\n        tabs={[\n          { value: 'all', label: 'å…¨éƒ¨', icon: FileText },\n          { value: 'pending', label: 'å¾…é€ä»¶', icon: Clock },\n          { value: 'submitted', label: 'å·²é€ä»¶', icon: AlertCircle },\n          { value: 'issued', label: 'å·²ä¸‹ä»¶', icon: CheckCircle },\n          { value: 'collected', label: 'å·²å–ä»¶', icon: FileCheck },\n          { value: 'rejected', label: 'é€€ä»¶', icon: XCircle },\n        ]}\n        activeTab={activeTab}\n        onTabChange={setActiveTab}\n      />\n\n      <div className=\"flex-1 overflow-auto\">\n        {/* ç°½è­‰åˆ—è¡¨ */}\n        <VisasList\n          filteredVisas={filteredVisas}\n          canManageVisas={canManageVisas}\n          selectedRows={selectedRows}\n          onSelectionChange={setSelectedRows}\n          onDelete={deleteVisa}\n          onUpdateStatus={(id, status) => updateVisa(id, { status })}\n        />\n      </div>\n\n      {/* ç°½è­‰è³‡è¨Šå°è©±æ¡† */}\n      <VisasInfoDialog open={isInfoDialogOpen} onClose={() => setIsInfoDialogOpen(false)} />\n\n      {/* æ–°å¢ç°½è­‰å°è©±æ¡† */}\n      <AddVisaDialog\n        open={isDialogOpen}\n        onClose={() => setIsDialogOpen(false)}\n        onSubmit={handleAddVisa}\n        contact_info={contact_info}\n        setContactInfo={setContactInfo}\n        applicants={applicants}\n        tourOptions={tourOptions}\n        calculateFee={calculateFee}\n        addApplicant={addApplicant}\n        removeApplicant={removeApplicant}\n        updateApplicant={updateApplicant}\n        canSubmit={!!contact_info.applicant_name && applicants.some(a => a.name)}\n        isSubmitting={isSubmitting}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/constants/usa-esta-info.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/constants/visa-info.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/hooks/useVisasData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/hooks/useVisasDialog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/hooks/useVisasFilters.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/features/visas/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/use-accounting-module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/use-realtime-hooks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useChannelsRealtime.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useChatRealtime.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useConfirmDialog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useCrudOperations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useDataFiltering.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useDialog.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useDialogState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useEnterSubmit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useListPageState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/usePermissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useRequireAuth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/hooks/useSwipeNavigation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/auth-guard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/auth/auth-provider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/auth/local-auth-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/auth/quick-login-token.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/cache/memory-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/company.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/layout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/morandi-colors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/routes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/time.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/timebox.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/timeouts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/workspace-settings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/constants/workspace.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/contract-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/data/create-data-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/database.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/init-local-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/migrations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/operations/delete.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/operations/query.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/operations/read.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/operations/write.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/seed-regions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/sync-schema-helper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/utils/connection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/utils/helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/db/version-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/excel/receipt-excel.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/files.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/formula-calculator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/manifestation/reminder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/pdf/disbursement-pdf.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/pdf/receipt-pdf.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/pnr-parser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/rbac-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/realtime/createRealtimeHook.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":12,"column":1,"severity":1,"nodeType":null,"fix":{"range":[211,273],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * Realtime Hook å·¥å» å‡½æ•¸\n * ç‚ºä»»ä½•è³‡æ–™è¡¨å»ºç«‹æŒ‰éœ€è¨‚é–±çš„ Hook\n */\n\n'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useRealtimeSubscription } from './hooks/useRealtimeSubscription'\n\n// Zustand store çš„æœ€å°ä»‹é¢éœ€æ±‚\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype MinimalZustandStore = any\n\n// IndexedDB ä»‹é¢\ninterface IndexedDBAdapter<T> {\n  put: (record: T) => Promise<void>\n  delete: (id: string) => Promise<void>\n}\n\ninterface CreateRealtimeHookOptions<T> {\n  tableName: string\n  indexedDB: IndexedDBAdapter<T>\n  store: MinimalZustandStore\n}\n\n/**\n * å»ºç«‹ Realtime Hook\n *\n * @example\n * ```typescript\n * // åœ¨ src/stores/index.ts ä¸­\n * export const useRealtimeForTours = createRealtimeHook({\n *   tableName: 'tours',\n *   store: useTourStore,\n *   indexedDB: tourIndexedDB\n * });\n *\n * // åœ¨é é¢ä¸­ä½¿ç”¨\n * function ToursPage() {\n *   useRealtimeForTours(); // â† é€²å…¥é é¢æ‰è¨‚é–±\n *   const tours = useTourStore(state => state.items);\n * }\n * ```\n */\nexport function createRealtimeHook<T extends { id: string }>(\n  options: CreateRealtimeHookOptions<T>\n) {\n  const { tableName, indexedDB, store } = options\n\n  // å‹åˆ¥å®‰å…¨çš„ setState åŒ…è£å™¨\n  const setStoreState = (updater: (state: { items: T[] }) => { items: T[] }) => {\n    store.setState(updater as unknown)\n  }\n\n  // å‹åˆ¥å®‰å…¨çš„ getState åŒ…è£å™¨\n  const getStoreState = (): { items: T[] } => {\n    return store.getState() as { items: T[] }\n  }\n\n  return function useRealtimeForTable() {\n    useRealtimeSubscription<T>({\n      table: tableName,\n      subscriptionId: `${tableName}-realtime`,\n      handlers: {\n        // æ–°å¢è³‡æ–™\n        onInsert: async record => {\n          logger.log(`â• [${tableName}] Realtime INSERT:`, record)\n          await indexedDB.put(record)\n\n          const currentState = getStoreState()\n          const exists = currentState.items.some(item => item.id === record.id)\n          if (exists) {\n            logger.log(`âš ï¸ [${tableName}] è¨˜éŒ„å·²å­˜åœ¨ï¼Œè·³é:`, record.id)\n            return\n          }\n          logger.log(`âœ… [${tableName}] æ–°å¢åˆ° Store`)\n          setStoreState(state => ({\n            items: [...state.items, record],\n          }))\n        },\n\n        // æ›´æ–°è³‡æ–™\n        onUpdate: async record => {\n          logger.log(`âœï¸ [${tableName}] Realtime UPDATE:`, record)\n          await indexedDB.put(record)\n\n          setStoreState(state => ({\n            items: state.items.map(item => (item.id === record.id ? record : item)),\n          }))\n        },\n\n        // åˆªé™¤è³‡æ–™\n        onDelete: async oldRecord => {\n          logger.log(`ğŸ—‘ï¸ [${tableName}] Realtime DELETE:`, oldRecord)\n          await indexedDB.delete(oldRecord.id)\n\n          setStoreState(state => ({\n            items: state.items.filter(item => item.id !== oldRecord.id),\n          }))\n        },\n      },\n    })\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/realtime/hooks/useRealtimeSubscription.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":132,"column":3,"severity":1,"nodeType":null,"fix":{"range":[3152,3214],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * React Hook for Supabase Realtime Subscription\n * è‡ªå‹•ç®¡ç†è¨‚é–±çš„ç”Ÿå‘½é€±æœŸ\n */\n\n'use client'\n\nimport { logger } from '@/lib/utils/logger'\nimport { useEffect, useRef, useState } from 'react'\nimport { realtimeManager } from '../realtime-manager'\nimport type { RealtimeSubscriptionConfig, RealtimeStatus } from '../types'\n\ninterface UseRealtimeSubscriptionOptions<T> extends RealtimeSubscriptionConfig<T> {\n  /** æ˜¯å¦å•Ÿç”¨è¨‚é–± (é è¨­: true) */\n  enabled?: boolean\n}\n\ninterface UseRealtimeSubscriptionReturn {\n  /** è¨‚é–±ç‹€æ…‹ */\n  status: RealtimeStatus\n  /** éŒ¯èª¤è¨Šæ¯ */\n  error: Error | null\n  /** æ˜¯å¦å·²é€£ç·š */\n  isConnected: boolean\n  /** é‡è©¦æ¬¡æ•¸ */\n  retryCount: number\n}\n\n/**\n * ä½¿ç”¨ Realtime è¨‚é–±\n *\n * @example\n * ```tsx\n * function ChannelList() {\n *   const { isConnected } = useRealtimeSubscription({\n *     table: 'channels',\n *     handlers: {\n *       onInsert: (channel) => {\n *         logger.log('New channel:', channel);\n *       },\n *       onDelete: (oldChannel) => {\n *         logger.log('Deleted channel:', oldChannel);\n *       },\n *     },\n *   });\n *\n *   return <div>Connected: {isConnected ? 'Yes' : 'No'}</div>;\n * }\n * ```\n */\nexport function useRealtimeSubscription<T extends Record<string, unknown> = Record<string, unknown>>(\n  options: UseRealtimeSubscriptionOptions<T>\n): UseRealtimeSubscriptionReturn {\n  const { enabled = true, ...config } = options\n  const subscriptionIdRef = useRef<string | null>(null)\n  const [status, setStatus] = useState<RealtimeStatus>('disconnected')\n  const [error, setError] = useState<Error | null>(null)\n  const [retryCount, setRetryCount] = useState(0)\n\n  useEffect(() => {\n    // å¦‚æœæœªå•Ÿç”¨ï¼Œä¸è¨‚é–±\n    if (!enabled) {\n      return\n    }\n\n    // å‰µå»ºè¨‚é–±\n    const subscriptionId = realtimeManager.subscribe<T>(config)\n    subscriptionIdRef.current = subscriptionId\n\n    // å®šæœŸæª¢æŸ¥è¨‚é–±ç‹€æ…‹\n    const statusInterval = setInterval(() => {\n      if (!subscriptionIdRef.current) return\n\n      const state = realtimeManager.getSubscriptionState(subscriptionIdRef.current)\n\n      if (state) {\n        setStatus(state.status)\n        setError(state.error)\n        setRetryCount(state.retryCount)\n      }\n    }, 1000)\n\n    // æ¸…ç†å‡½æ•¸\n    return () => {\n      clearInterval(statusInterval)\n\n      if (subscriptionIdRef.current) {\n        realtimeManager.unsubscribe(subscriptionIdRef.current)\n        subscriptionIdRef.current = null\n      }\n    }\n  }, [\n    enabled,\n    config.table,\n    config.event,\n    config.schema,\n    config.filter,\n    // æ³¨æ„ï¼šhandlers ä¸æ‡‰è©²ä½œç‚ºä¾è³´ï¼Œå› ç‚ºå®ƒå€‘æ˜¯ç‰©ä»¶å¼•ç”¨\n    // å¦‚æœ handlers è®Šæ›´ï¼Œéœ€è¦é‡æ–°è¨‚é–±\n  ])\n\n  return {\n    status,\n    error,\n    isConnected: status === 'connected',\n    retryCount,\n  }\n}\n\n/**\n * ä½¿ç”¨å¤šå€‹ Realtime è¨‚é–±\n *\n * @example\n * ```tsx\n * function Workspace() {\n *   useMultipleRealtimeSubscriptions([\n *     {\n *       table: 'channels',\n *       handlers: { onInsert: handleChannelInsert },\n *     },\n *     {\n *       table: 'messages',\n *       handlers: { onInsert: handleMessageInsert },\n *     },\n *   ]);\n * }\n * ```\n */\nexport function useMultipleRealtimeSubscriptions<T extends Record<string, unknown> = Record<string, unknown>>(\n  subscriptions: UseRealtimeSubscriptionOptions<T>[]\n): UseRealtimeSubscriptionReturn[] {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const results = subscriptions.map(config => useRealtimeSubscription(config as any))\n\n  return results\n}\n\n/**\n * å–å¾—æ‰€æœ‰è¨‚é–±ç‹€æ…‹ï¼ˆä¸å‰µå»ºæ–°è¨‚é–±ï¼‰\n */\nexport function useRealtimeStatus() {\n  const [subscriptions, setSubscriptions] = useState(realtimeManager.getAllSubscriptions())\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setSubscriptions(realtimeManager.getAllSubscriptions())\n    }, 1000)\n\n    return () => clearInterval(interval)\n  }, [])\n\n  return {\n    subscriptions,\n    totalCount: subscriptions.length,\n    connectedCount: subscriptions.filter(s => s.status === 'connected').length,\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/realtime/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/realtime/realtime-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/realtime/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/status-config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/supabase/admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/supabase/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/supabase/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/sync/background-sync-service.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":98,"column":11,"severity":1,"nodeType":null,"fix":{"range":[2238,2300],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":226,"column":11,"severity":1,"nodeType":null,"fix":{"range":[6573,6635],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":235,"column":13,"severity":1,"nodeType":null,"fix":{"range":[6899,6961],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":257,"column":13,"severity":1,"nodeType":null,"fix":{"range":[7694,7756],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":323,"column":11,"severity":1,"nodeType":null,"fix":{"range":[10058,10120],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":5,"source":"/**\n * èƒŒæ™¯åŒæ­¥æœå‹™ï¼ˆå‹åˆ¥å®‰å…¨ç‰ˆæœ¬ï¼‰\n *\n * è² è²¬è™•ç†é›¢ç·šæ™‚çš„è³‡æ–™åŒæ­¥ï¼ŒåŒ…æ‹¬ï¼š\n * 1. TBC ç·¨è™Ÿè½‰æ›ï¼ˆé›¢ç·šå»ºç«‹çš„é …ç›®ï¼‰\n * 2. å¾…åŒæ­¥çš„æ–°å¢/ä¿®æ”¹é …ç›®\n * 3. å¾…åˆªé™¤çš„é …ç›®\n *\n * æ¶æ§‹ï¼šåŒæ­¥é‚è¼¯èˆ‡è³‡æ–™è®€å–åˆ†é›¢\n */\n\nimport { supabase } from '@/lib/supabase/client'\nimport { localDB } from '@/lib/db'\nimport { TABLES, TableName } from '@/lib/db/schemas'\nimport { logger } from '@/lib/utils/logger'\nimport type { BaseEntity, SyncableEntity } from '@/types'\nimport {\n  isTbcEntity,\n  isSyncableEntity,\n  isSyncQueueItem,\n  needsSync,\n  type TbcEntity,\n  type SyncQueueItem,\n  type CodedEntity,\n} from './sync-types'\n\nexport class BackgroundSyncService {\n  private syncInProgress: Set<string> = new Set()\n\n  /**\n   * åŒæ­¥å–®ä¸€è¡¨æ ¼çš„æ‰€æœ‰å¾…è™•ç†é …ç›®\n   */\n  async syncTable(tableName: TableName): Promise<void> {\n    // é˜²æ­¢é‡è¤‡åŒæ­¥\n    if (this.syncInProgress.has(tableName)) {\n      logger.log(`â³ [${tableName}] åŒæ­¥é€²è¡Œä¸­ï¼Œè·³é`)\n      return\n    }\n\n    try {\n      this.syncInProgress.add(tableName)\n      logger.log(`ğŸ”„ [${tableName}] é–‹å§‹èƒŒæ™¯åŒæ­¥...`)\n\n      // 1. åŒæ­¥ TBC ç·¨è™Ÿè½‰æ›\n      await this.syncTbcCodes(tableName)\n\n      // 2. åŒæ­¥å¾…ä¸Šå‚³é …ç›®\n      await this.syncPendingUpserts(tableName)\n\n      // 3. åŒæ­¥å¾…åˆªé™¤é …ç›®\n      await this.syncPendingDeletes(tableName)\n\n      logger.log(`âœ… [${tableName}] èƒŒæ™¯åŒæ­¥å®Œæˆ`)\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] èƒŒæ™¯åŒæ­¥å¤±æ•—:`, error)\n      // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œéœé»˜å¤±æ•—\n    } finally {\n      this.syncInProgress.delete(tableName)\n    }\n  }\n\n  /**\n   * åŒæ­¥æ‰€æœ‰è¡¨æ ¼\n   */\n  async syncAllTables(): Promise<void> {\n    const tables = Object.values(TABLES)\n\n    logger.log('ğŸŒ é–‹å§‹åŒæ­¥æ‰€æœ‰è¡¨æ ¼...')\n\n    // ä¸¦è¡ŒåŒæ­¥æ‰€æœ‰è¡¨æ ¼\n    await Promise.allSettled(tables.map(tableName => this.syncTable(tableName)))\n\n    logger.log('âœ… æ‰€æœ‰è¡¨æ ¼åŒæ­¥å®Œæˆ')\n  }\n\n  /**\n   * 1. åŒæ­¥ TBC ç·¨è™Ÿè½‰æ›\n   *\n   * å°‡é›¢ç·šå»ºç«‹çš„é …ç›®ï¼ˆTBC ç·¨è™Ÿï¼‰è½‰æ›ç‚ºæ­£å¼ç·¨è™Ÿ\n   */\n  private async syncTbcCodes(tableName: TableName): Promise<void> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName)\n\n      // ä½¿ç”¨å‹åˆ¥å®ˆè¡›éæ¿¾ TBC é …ç›®\n      const tbcItems = allLocalItems.filter(isTbcEntity)\n\n      if (tbcItems.length === 0) return\n\n      logger.log(`ğŸ”§ [${tableName}] ç™¼ç¾ ${tbcItems.length} ç­† TBC ç·¨è™Ÿï¼Œæº–å‚™è½‰æ›...`)\n\n      for (const item of tbcItems) {\n        try {\n          // æº–å‚™ä¸Šå‚³è³‡æ–™ï¼ˆç§»é™¤ TBC code å’ŒåŒæ­¥æ¬„ä½ï¼‰\n          const { code, _needs_sync, _synced_at, _deleted, ...itemData } = item\n\n          // ä¸Šå‚³åˆ° Supabaseï¼ˆæœƒè‡ªå‹•ç”Ÿæˆæ­£å¼ç·¨è™Ÿï¼‰\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const { data: supabaseData, error } = await (supabase as any)\n            .from(tableName)\n            .insert([itemData])\n            .select()\n            .single()\n\n          if (error) throw error\n          if (!supabaseData) throw new Error('No data returned from insert')\n\n          // æ›´æ–° IndexedDBï¼ˆç”¨æ–°çš„æ­£å¼ç·¨è™Ÿï¼‰\n          await localDB.delete(tableName, item.id)\n\n          // å°‡ Supabase å›å‚³çš„è³‡æ–™åŠ ä¸ŠåŒæ­¥æ¬„ä½\n          const baseEntity = supabaseData as unknown as BaseEntity\n          const syncedData: SyncableEntity = {\n            ...baseEntity,\n            _needs_sync: false,\n            _synced_at: new Date().toISOString(),\n          }\n\n          await localDB.put(tableName, syncedData)\n\n          // å‹åˆ¥å®‰å…¨çš„ code å­˜å–\n          const codedEntity = supabaseData as unknown as CodedEntity\n          const newCode = codedEntity.code || 'unknown'\n          logger.log(`âœ… [${tableName}] TBC ç·¨è™Ÿå·²è½‰æ›: ${code} â†’ ${newCode}`)\n        } catch (error) {\n          logger.error(`âŒ [${tableName}] TBC ç·¨è™Ÿè½‰æ›å¤±æ•—:`, item.code, error)\n        }\n      }\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] syncTbcCodes å¤±æ•—:`, error)\n    }\n  }\n\n  /**\n   * 2. åŒæ­¥å¾…ä¸Šå‚³é …ç›®ï¼ˆæ–°å¢/ä¿®æ”¹ï¼‰\n   *\n   * åŒæ­¥æ¨™è¨˜ç‚º _needs_sync: true çš„é …ç›®\n   */\n  private async syncPendingUpserts(tableName: TableName): Promise<void> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName)\n\n      // ä½¿ç”¨å‹åˆ¥å®ˆè¡›å’Œç´”å‡½æ•¸éæ¿¾\n      const pendingUpserts = allLocalItems.filter((item): item is SyncableEntity => {\n        if (!isSyncableEntity(item)) return false\n\n        // æ’é™¤ TBC ç·¨è™Ÿå’Œè»Ÿåˆªé™¤çš„é …ç›®\n        const isTbc = isTbcEntity(item)\n        const isDeleted = item._deleted === true\n\n        return needsSync(item) && !isTbc && !isDeleted\n      })\n\n      if (pendingUpserts.length === 0) return\n\n      logger.log(`ğŸ“¤ [${tableName}] ç™¼ç¾ ${pendingUpserts.length} ç­†å¾…åŒæ­¥é …ç›®ï¼Œé–‹å§‹ä¸Šå‚³...`)\n\n      for (const item of pendingUpserts) {\n        try {\n          // ç§»é™¤åŒæ­¥æ¨™è¨˜æ¬„ä½\n          const { _needs_sync, _synced_at, _deleted, ...syncData } = item\n\n          // ğŸ”¥ é€šç”¨è™•ç†ï¼šå°‡ç©ºå­—ä¸²çš„ timestamp/date æ¬„ä½è½‰ç‚º null\n          // PostgreSQL ä¸æ¥å—ç©ºå­—ä¸²ä½œç‚º timestamp å€¼\n          Object.keys(syncData).forEach(key => {\n            const value = (syncData as Record<string, unknown>)[key]\n            // å¦‚æœæ¬„ä½åç¨±åŒ…å« _atã€_date æˆ–æ˜¯ deadlineï¼Œä¸”å€¼ç‚ºç©ºå­—ä¸²ï¼Œè½‰ç‚º null\n            if (\n              (key.endsWith('_at') || key.endsWith('_date') || key === 'deadline') &&\n              value === ''\n            ) {\n              ;(syncData as Record<string, unknown>)[key] = null\n            }\n          })\n\n          // ğŸ”¥ ç‰¹æ®Šè™•ç†ï¼šç‚º quotes è¡¨è£œå……å¿…å¡«æ¬„ä½çš„é è¨­å€¼\n          if (tableName === 'quotes') {\n            const quoteData = syncData as Record<string, unknown>\n            // å¦‚æœç¼ºå°‘ customer_nameï¼Œæä¾›é è¨­å€¼\n            if (!quoteData.customer_name) {\n              quoteData.customer_name = 'å¾…æŒ‡å®š'\n            }\n            // ç¢ºä¿å…¶ä»–å¿…å¡«æ¬„ä½ä¹Ÿæœ‰å€¼\n            if (!quoteData.destination) {\n              quoteData.destination = 'å¾…æŒ‡å®š'\n            }\n            if (!quoteData.start_date) {\n              quoteData.start_date = new Date().toISOString().split('T')[0]\n            }\n            if (!quoteData.end_date) {\n              quoteData.end_date = new Date().toISOString().split('T')[0]\n            }\n            if (!quoteData.days) {\n              quoteData.days = 1\n            }\n            if (!quoteData.nights) {\n              quoteData.nights = 0\n            }\n            if (!quoteData.number_of_people) {\n              quoteData.number_of_people = 1\n            }\n            if (!quoteData.total_amount) {\n              quoteData.total_amount = 0\n            }\n          }\n\n          // å…ˆæª¢æŸ¥ syncQueue æ˜¯å¦æœ‰æ­¤é …ç›®çš„åˆªé™¤è¨˜éŒ„\n          const allQueueItems = await localDB.getAll(TABLES.SYNC_QUEUE)\n          const hasDeleteRecord = allQueueItems.some(queueItem => {\n            if (!isSyncQueueItem(queueItem)) return false\n            return (\n              queueItem.table_name === tableName &&\n              queueItem.record_id === item.id &&\n              queueItem.operation === 'delete'\n            )\n          })\n\n          // å¦‚æœæœ‰åˆªé™¤è¨˜éŒ„ï¼Œä¸è¦ä¸Šå‚³ï¼Œç›´æ¥æ¸…ç†æœ¬åœ°è³‡æ–™\n          if (hasDeleteRecord) {\n            logger.log(`âš ï¸ [${tableName}] ç™¼ç¾åˆªé™¤è¨˜éŒ„ï¼Œè·³éåŒæ­¥ä¸¦æ¸…ç†æœ¬åœ°è³‡æ–™: ${item.id}`)\n            await localDB.delete(tableName, item.id)\n            continue\n          }\n\n          // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆupdateï¼‰æˆ–æ–°å»ºï¼ˆinsertï¼‰\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const { data: existing } = await (supabase as any)\n            .from(tableName)\n            .select('id')\n            .eq('id', item.id)\n            .maybeSingle() // âœ… ä½¿ç”¨ maybeSingle() é¿å… 406 éŒ¯èª¤\n\n          if (existing) {\n            // æ›´æ–°\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const { error } = await (supabase as any).from(tableName).update(syncData).eq('id', item.id)\n\n            if (error) throw error\n            logger.log(`âœ… [${tableName}] æ›´æ–°æˆåŠŸ: ${item.id}`)\n          } else {\n            // æ–°å¢ï¼ˆç¢ºä¿ä¸æ˜¯å·²è¢«å…¶ä»–è£ç½®åˆªé™¤çš„è³‡æ–™ï¼‰\n            // å¦‚æœ Supabase ä¸­æ‰¾ä¸åˆ°ï¼Œæœ‰å…©ç¨®å¯èƒ½ï¼š\n            // 1. çœŸçš„æ˜¯æ–°è³‡æ–™\n            // 2. å·²è¢«å…¶ä»–è£ç½®åˆªé™¤\n            //\n            // ä¿å®ˆåšæ³•ï¼šå¦‚æœè³‡æ–™å·²ç¶“æœ‰ _synced_atï¼ˆæ›¾ç¶“åŒæ­¥éï¼‰ï¼Œå‰‡è·³é\n            if (item._synced_at) {\n              logger.warn(\n                `âš ï¸ [${tableName}] è³‡æ–™åœ¨ Supabase ä¸­ä¸å­˜åœ¨ä½†æ›¾åŒæ­¥éï¼Œå¯èƒ½å·²è¢«å…¶ä»–è£ç½®åˆªé™¤ï¼Œè·³éæ’å…¥: ${item.id}`\n              )\n              // æ¸…ç†æœ¬åœ°è³‡æ–™\n              await localDB.delete(tableName, item.id)\n              continue\n            }\n\n            // çœŸçš„æ˜¯æ–°è³‡æ–™ï¼ŒåŸ·è¡Œæ’å…¥\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const { error } = await (supabase as any).from(tableName).insert([syncData])\n\n            if (error) throw error\n            logger.log(`âœ… [${tableName}] æ–°å¢æˆåŠŸ: ${item.id}`)\n          }\n\n          // æ›´æ–° IndexedDBï¼ˆæ¨™è¨˜ç‚ºå·²åŒæ­¥ï¼‰\n          const syncedItem: SyncableEntity = {\n            ...item,\n            _needs_sync: false,\n            _synced_at: new Date().toISOString(),\n          }\n\n          await localDB.put(tableName, syncedItem)\n        } catch (error) {\n          logger.error(`âŒ [${tableName}] åŒæ­¥å¤±æ•—:`, item.id)\n\n          // è©³ç´°è¨˜éŒ„éŒ¯èª¤è³‡è¨Š\n          if (error instanceof Error) {\n            logger.error('éŒ¯èª¤è¨Šæ¯:', error.message)\n            logger.error('éŒ¯èª¤å †ç–Š:', error.stack)\n          } else if (typeof error === 'object' && error !== null) {\n            // Supabase éŒ¯èª¤ç‰©ä»¶\n            logger.error('Supabase éŒ¯èª¤:', JSON.stringify(error, null, 2))\n            const errorObj = error as Record<string, unknown>\n            if ('message' in errorObj && errorObj.message) logger.error('è¨Šæ¯:', errorObj.message)\n            if ('code' in errorObj && errorObj.code) logger.error('éŒ¯èª¤ä»£ç¢¼:', errorObj.code)\n            if ('details' in errorObj && errorObj.details) logger.error('è©³ç´°è³‡è¨Š:', errorObj.details)\n            if ('hint' in errorObj && errorObj.hint) logger.error('æç¤º:', errorObj.hint)\n          } else {\n            logger.error('éŒ¯èª¤å…§å®¹:', String(error))\n          }\n\n          // è¨˜éŒ„å˜—è©¦åŒæ­¥çš„è³‡æ–™\n          logger.error('å˜—è©¦åŒæ­¥çš„è³‡æ–™:', JSON.stringify(item, null, 2))\n        }\n      }\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] syncPendingUpserts å¤±æ•—:`, error)\n    }\n  }\n\n  /**\n   * 3. åŒæ­¥å¾…åˆªé™¤é …ç›®\n   *\n   * è™•ç† syncQueue è¡¨ä¸­çš„åˆªé™¤æ“ä½œ\n   */\n  private async syncPendingDeletes(tableName: TableName): Promise<void> {\n    try {\n      // å¾ syncQueue è¡¨ä¸­å–å¾—è©²è¡¨çš„åˆªé™¤æ“ä½œ\n      const allQueueItems = await localDB.getAll(TABLES.SYNC_QUEUE)\n\n      // ä½¿ç”¨å‹åˆ¥å®ˆè¡›éæ¿¾åˆªé™¤æ“ä½œ\n      const pendingDeletes = allQueueItems.filter((item): item is SyncQueueItem => {\n        if (!isSyncQueueItem(item)) return false\n        return item.table_name === tableName && item.operation === 'delete'\n      })\n\n      if (pendingDeletes.length === 0) return\n\n      logger.log(`ğŸ—‘ï¸ [${tableName}] ç™¼ç¾ ${pendingDeletes.length} ç­†å¾…åˆªé™¤é …ç›®ï¼Œé–‹å§‹åˆªé™¤...`)\n\n      for (const queueItem of pendingDeletes) {\n        try {\n          // å¾ Supabase åˆªé™¤\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const { error } = await (supabase as any).from(tableName).delete().eq('id', queueItem.record_id)\n\n          // åˆªé™¤æˆåŠŸæˆ–è³‡æ–™å·²ä¸å­˜åœ¨ï¼Œæ¸…é™¤éšŠåˆ—è¨˜éŒ„\n          await localDB.delete(TABLES.SYNC_QUEUE, queueItem.id)\n\n          if (error) {\n            logger.warn(\n              `âš ï¸ [${tableName}] Supabase åˆªé™¤å¤±æ•—ï¼ˆå·²æ¸…é™¤éšŠåˆ—ï¼‰:`,\n              queueItem.record_id,\n              error\n            )\n          } else {\n            logger.log(`âœ… [${tableName}] åˆªé™¤æˆåŠŸ: ${queueItem.record_id}`)\n          }\n        } catch (error) {\n          logger.error(`âŒ [${tableName}] åˆªé™¤å¤±æ•—:`, queueItem.record_id, error)\n        }\n      }\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] syncPendingDeletes å¤±æ•—:`, error)\n    }\n  }\n\n  /**\n   * æª¢æŸ¥æ˜¯å¦æœ‰å¾…åŒæ­¥é …ç›®\n   */\n  async hasPendingSync(tableName: TableName): Promise<boolean> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName)\n\n      // ä½¿ç”¨å‹åˆ¥å®ˆè¡›æª¢æŸ¥\n      const hasLocalPending = allLocalItems.some(item => {\n        if (isTbcEntity(item)) return true\n        if (isSyncableEntity(item) && needsSync(item)) return true\n        return false\n      })\n\n      // æª¢æŸ¥æ˜¯å¦æœ‰åˆªé™¤éšŠåˆ—\n      const allQueueItems = await localDB.getAll(TABLES.SYNC_QUEUE)\n      const hasDeletePending = allQueueItems.some(item => {\n        if (!isSyncQueueItem(item)) return false\n        return item.table_name === tableName && item.operation === 'delete'\n      })\n\n      return hasLocalPending || hasDeletePending\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] æª¢æŸ¥å¾…åŒæ­¥é …ç›®å¤±æ•—:`, error)\n      return false\n    }\n  }\n\n  /**\n   * å–å¾—å¾…åŒæ­¥é …ç›®æ•¸é‡\n   */\n  async getPendingCount(tableName: TableName): Promise<number> {\n    try {\n      const allLocalItems = await localDB.getAll(tableName)\n\n      // ä½¿ç”¨å‹åˆ¥å®ˆè¡›è¨ˆæ•¸\n      const localPendingCount = allLocalItems.filter(item => {\n        if (isTbcEntity(item)) return true\n        if (isSyncableEntity(item) && needsSync(item)) return true\n        return false\n      }).length\n\n      // è¨ˆç®—åˆªé™¤éšŠåˆ—æ•¸é‡\n      const allQueueItems = await localDB.getAll(TABLES.SYNC_QUEUE)\n      const deletePendingCount = allQueueItems.filter(item => {\n        if (!isSyncQueueItem(item)) return false\n        return item.table_name === tableName && item.operation === 'delete'\n      }).length\n\n      return localPendingCount + deletePendingCount\n    } catch (error) {\n      logger.error(`âŒ [${tableName}] å–å¾—å¾…åŒæ­¥æ•¸é‡å¤±æ•—:`, error)\n      return 0\n    }\n  }\n}\n\n// å–®ä¾‹æ¨¡å¼\nexport const backgroundSyncService = new BackgroundSyncService()\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/sync/network-monitor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/sync/sync-status-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/sync/sync-types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/task-templates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/ui/global-dialog-override.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/utils/format-date.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/utils/logger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/utils/receipt-number-generator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/utils/text.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/utils/uuid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/workspace-filter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/lib/workspace-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/services/fastmove.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/services/offline-auth.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/services/storage/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/services/voucher-auto-generator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/services/workspace-members.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/accounting-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/accounting-subject-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/adapters/indexeddb-adapter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/adapters/supabase-adapter.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":29,"column":7,"severity":1,"nodeType":null,"fix":{"range":[773,835],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":71,"column":7,"severity":1,"nodeType":null,"fix":{"range":[2003,2065],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":99,"column":7,"severity":1,"nodeType":null,"fix":{"range":[2816,2878],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":155,"column":7,"severity":1,"nodeType":null,"fix":{"range":[4336,4398],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":196,"column":7,"severity":1,"nodeType":null,"fix":{"range":[5584,5646],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":219,"column":7,"severity":1,"nodeType":null,"fix":{"range":[6255,6317],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":6,"source":"/**\n * Supabase é©é…å™¨\n * å°è£æ‰€æœ‰ Supabase æ“ä½œ\n */\n\nimport type { BaseEntity } from '@/types'\nimport type { TableName } from '@/lib/db/schemas'\nimport type { RemoteAdapter } from '../core/types'\nimport { logger } from '@/lib/utils/logger'\nimport { getWorkspaceFilterForQuery } from '@/lib/workspace-filter'\n\nexport class SupabaseAdapter<T extends BaseEntity> implements RemoteAdapter<T> {\n  constructor(\n    private tableName: TableName,\n    private enabled: boolean\n  ) {}\n\n  /**\n   * å–å¾—æ‰€æœ‰è³‡æ–™\n   */\n  async fetchAll(signal?: AbortSignal): Promise<T[]> {\n    if (!this.enabled || typeof window === 'undefined') {\n      return []\n    }\n\n    try {\n      const { supabase } = await import('@/lib/supabase/client')\n      // Dynamic table name - using TableName type from schemas\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      let query = (supabase as any)\n        .from(this.tableName)\n        .select('*')\n        .order('created_at', { ascending: true })\n\n      // å¥—ç”¨ workspace ç¯©é¸ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰\n      const workspaceId = await getWorkspaceFilterForQuery(this.tableName)\n      if (workspaceId) {\n        query = query.eq('workspace_id', workspaceId)\n        logger.log(`ğŸ” [${this.tableName}] å¥—ç”¨ workspace ç¯©é¸:`, workspaceId)\n      }\n\n      if (signal) {\n        query.abortSignal(signal)\n      }\n\n      const { data, error } = await query\n\n      if (error) throw error\n\n      const items = (data || []) as T[]\n      logger.log(`â˜ï¸ [${this.tableName}] Supabase fetchAll:`, items.length, 'ç­†')\n\n      return items\n    } catch (error) {\n      logger.warn(`âš ï¸ [${this.tableName}] Supabase fetchAll å¤±æ•—:`, error)\n      throw error\n    }\n  }\n\n  /**\n   * æ–°å¢è³‡æ–™\n   */\n  async insert(data: Omit<T, 'id' | 'created_at' | 'updated_at'>): Promise<T> {\n    if (!this.enabled || typeof window === 'undefined') {\n      throw new Error('Supabase not enabled')\n    }\n\n    try {\n      const { supabase } = await import('@/lib/supabase/client')\n      // Dynamic table name - using TableName type from schemas\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data: insertedData, error } = await (supabase as any)\n        .from(this.tableName)\n        .insert(data)\n        .select()\n        .single()\n\n      if (error) throw error\n\n      logger.log(`â˜ï¸ [${this.tableName}] Supabase insert:`, insertedData.id)\n      return insertedData as T\n    } catch (error) {\n      logger.error(`âŒ [${this.tableName}] Supabase insert å¤±æ•—:`, error)\n      throw error\n    }\n  }\n\n  /**\n   * æ ¹æ“š ID å–å¾—å–®ç­†\n   */\n  async getById(id: string): Promise<T | null> {\n    if (!this.enabled || typeof window === 'undefined') {\n      throw new Error('Supabase not enabled')\n    }\n\n    try {\n      const { supabase } = await import('@/lib/supabase/client')\n      // Dynamic table name - using TableName type from schemas\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data, error } = await (supabase as any).from(this.tableName).select('*').eq('id', id).single()\n\n      if (error) throw error\n\n      return data as T\n    } catch (error) {\n      logger.warn(`âš ï¸ [${this.tableName}] Supabase getById å¤±æ•—:`, error)\n      throw error\n    }\n  }\n\n  /**\n   * å–å¾—æ‰€æœ‰è³‡æ–™ï¼ˆåˆ¥åï¼‰\n   */\n  async getAll(): Promise<T[]> {\n    return this.fetchAll()\n  }\n\n  /**\n   * æ¸…ç†è³‡æ–™ç‰©ä»¶ï¼Œç§»é™¤æœªçŸ¥çš„æ¬„ä½\n   */\n  private cleanDataForTable<D extends Record<string, unknown>>(data: D): Partial<T> {\n    const cleaned = { ...data } as Record<string, unknown>\n\n    // payment_requests: ç§»é™¤ items æ¬„ä½ï¼ˆæ‡‰ä½¿ç”¨ payment_request_items é—œè¯è¡¨ï¼‰\n    if (this.tableName === 'payment_requests' && 'items' in cleaned) {\n      delete cleaned.items\n      logger.log(`ğŸ§¹ [${this.tableName}] ç§»é™¤æœªçŸ¥æ¬„ä½: items`)\n    }\n\n    // todos: ç§»é™¤éæ™‚çš„ description æ¬„ä½\n    if (this.tableName === 'todos' && 'description' in cleaned) {\n      delete cleaned.description\n      logger.log(`ğŸ§¹ [${this.tableName}] ç§»é™¤éæ™‚æ¬„ä½: description`)\n    }\n\n    return cleaned as Partial<T>\n  }\n\n  /**\n   * æ–°å¢æˆ–æ›´æ–°è³‡æ–™\n   */\n  async put(item: T): Promise<void> {\n    // Supabase ä½¿ç”¨ upsert\n    if (!this.enabled || typeof window === 'undefined') {\n      return\n    }\n\n    try {\n      const { supabase } = await import('@/lib/supabase/client')\n\n      // æ¸…ç†è³‡æ–™ï¼Œç§»é™¤æœªçŸ¥æ¬„ä½\n      const cleanedItem = this.cleanDataForTable(item as unknown as Record<string, unknown>)\n\n      // Dynamic table name - using TableName type from schemas\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { error } = await (supabase as any).from(this.tableName).upsert(cleanedItem)\n\n      if (error) {\n        logger.error(`âŒ [${this.tableName}] Supabase upsert éŒ¯èª¤è©³æƒ…:`, {\n          message: error.message,\n          details: error.details,\n          hint: error.hint,\n          code: error.code,\n        })\n        throw error\n      }\n\n      logger.log(`â˜ï¸ [${this.tableName}] Supabase upsert:`, item.id)\n    } catch (error) {\n      const err = error as { message?: string; details?: string; hint?: string; code?: string }\n      logger.error(`âŒ [${this.tableName}] Supabase upsert å¤±æ•—:`, {\n        message: err?.message || 'æœªçŸ¥éŒ¯èª¤',\n        details: err?.details || '',\n        hint: err?.hint || '',\n        code: err?.code || '',\n        item_id: item?.id,\n      })\n      throw error\n    }\n  }\n\n  /**\n   * æ›´æ–°è³‡æ–™\n   */\n  async update(id: string, data: Partial<T>): Promise<void> {\n    if (!this.enabled || typeof window === 'undefined') {\n      return\n    }\n\n    try {\n      // æ¸…ç†è³‡æ–™ï¼Œç§»é™¤æœªçŸ¥æ¬„ä½\n      const cleanedData = this.cleanDataForTable(data)\n\n      const { supabase } = await import('@/lib/supabase/client')\n      // Dynamic table name - using TableName type from schemas\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { error } = await (supabase as any).from(this.tableName).update(cleanedData).eq('id', id)\n\n      if (error) throw error\n\n      logger.log(`â˜ï¸ [${this.tableName}] Supabase update:`, id)\n    } catch (error) {\n      logger.error(`âŒ [${this.tableName}] Supabase update å¤±æ•—:`, error)\n      throw error\n    }\n  }\n\n  /**\n   * åˆªé™¤è³‡æ–™\n   */\n  async delete(id: string): Promise<void> {\n    if (!this.enabled || typeof window === 'undefined') {\n      return\n    }\n\n    try {\n      const { supabase } = await import('@/lib/supabase/client')\n      // Dynamic table name - using TableName type from schemas\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { error } = await (supabase as any).from(this.tableName).delete().eq('id', id)\n\n      if (error) throw error\n\n      logger.log(`â˜ï¸ [${this.tableName}] Supabase delete:`, id)\n    } catch (error) {\n      logger.error(`âŒ [${this.tableName}] Supabase delete å¤±æ•—:`, error)\n      throw error\n    }\n  }\n\n  /**\n   * æ¸…ç©ºæ‰€æœ‰è³‡æ–™\n   */\n  async clear(): Promise<void> {\n    logger.warn(`âš ï¸ [${this.tableName}] Supabase clear æœªå¯¦ä½œï¼ˆå®‰å…¨è€ƒé‡ï¼‰`)\n    // ä¸å¯¦ä½œï¼Œé¿å…èª¤åˆªé›²ç«¯è³‡æ–™\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/attraction-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/auth-store.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":629,"column":15,"severity":1,"nodeType":null,"fix":{"range":[23403,23465],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { create } from 'zustand'\nimport { persist } from 'zustand/middleware'\nimport { User } from './types'\nimport { useUserStore } from './user-store'\nimport { generateToken, type AuthPayload } from '@/lib/auth'\nimport { useLocalAuthStore, LocalProfile } from '@/lib/auth/local-auth-manager'\nimport { OfflineAuthService } from '@/services/offline-auth.service'\nimport { logger } from '@/lib/utils/logger'\nimport { generateQuickLoginToken } from '@/lib/auth/quick-login-token'\n\ninterface AuthState {\n  // ä¿æŒå‘ä¸‹ç›¸å®¹çš„å±¬æ€§\n  user: User | null\n  isAuthenticated: boolean\n  sidebarCollapsed: boolean\n  loginAttempts: Map<string, { count: number; lastAttempt: Date }>\n\n  // æ–°å¢å±¬æ€§\n  currentProfile: LocalProfile | null\n  isOfflineMode: boolean\n  _hasHydrated: boolean\n\n  // æ–¹æ³•\n  login: (user: User) => void\n  logout: () => void\n  validateLogin: (\n    username: string,\n    password: string\n  ) => Promise<{ success: boolean; message?: string }>\n  toggleSidebar: () => void\n  setSidebarCollapsed: (collapsed: boolean) => void\n  checkPermission: (permission: string) => boolean\n  switchProfile: (profileId: string) => Promise<boolean>\n  setHasHydrated: (hasHydrated: boolean) => void\n}\n\n// é˜²æš´åŠ›ç ´è§£çš„å¤±æ•—è¨˜éŒ„\nconst loginAttemptsMap = new Map<string, { count: number; lastAttempt: Date }>()\n\nfunction checkLoginAttempts(username: string): { allowed: boolean; message?: string } {\n  const attempts = loginAttemptsMap.get(username)\n\n  if (!attempts) {\n    loginAttemptsMap.set(username, { count: 1, lastAttempt: new Date() })\n    return { allowed: true }\n  }\n\n  // 15 åˆ†é˜å¾Œé‡ç½®\n  const timeDiff = Date.now() - attempts.lastAttempt.getTime()\n  if (timeDiff > 15 * 60 * 1000) {\n    loginAttemptsMap.set(username, { count: 1, lastAttempt: new Date() })\n    return { allowed: true }\n  }\n\n  // è¶…é 5 æ¬¡å˜—è©¦\n  if (attempts.count >= 5) {\n    const remainingTime = Math.ceil((15 * 60 * 1000 - timeDiff) / (60 * 1000))\n    return {\n      allowed: false,\n      message: `ç™»å…¥å¤±æ•—æ¬¡æ•¸éå¤šï¼Œè«‹ ${remainingTime} åˆ†é˜å¾Œå†è©¦`,\n    }\n  }\n\n  attempts.count++\n  attempts.lastAttempt = new Date()\n  return { allowed: true }\n}\n\nfunction recordLoginAttempt(username: string, success: boolean): void {\n  if (success) {\n    // ç™»å…¥æˆåŠŸï¼Œæ¸…é™¤å¤±æ•—è¨˜éŒ„\n    loginAttemptsMap.delete(username)\n  }\n  // å¤±æ•—è¨˜éŒ„å·²åœ¨ checkLoginAttempts ä¸­è™•ç†\n}\n\nfunction setSecureCookie(token: string, rememberMe: boolean = false): void {\n  const maxAge = rememberMe ? 30 * 24 * 60 * 60 : 8 * 60 * 60 // 30å¤© or 8å°æ™‚\n  const secure = window.location.protocol === 'https:' ? 'Secure; ' : ''\n\n  // åœ¨ localhost é–‹ç™¼ç’°å¢ƒä¸­ï¼Œä¸ä½¿ç”¨ Secure å’Œ SameSite=Strict\n  if (window.location.hostname === 'localhost') {\n    document.cookie = `auth-token=${token}; path=/; max-age=${maxAge}; SameSite=Lax`\n  } else {\n    document.cookie = `auth-token=${token}; path=/; max-age=${maxAge}; SameSite=Strict; ${secure}`\n  }\n}\n\nexport const useAuthStore = create<AuthState>()(\n  persist(\n    (set, get) => ({\n      user: null,\n      isAuthenticated: false,\n      sidebarCollapsed: true, // é è¨­æ”¶åˆï¼Œhover æ™‚å±•é–‹\n      loginAttempts: new Map(),\n      currentProfile: null,\n      isOfflineMode: false,\n      _hasHydrated: false,\n\n      login: async user => {\n        // âœ… employees è¡¨æœ‰ workspace_id æ¬„ä½ï¼Œç™»å…¥æ™‚æœƒè‡ªå‹•è¼‰å…¥\n        const finalUser = user\n\n        // åŒæ™‚æ›´æ–° user å’Œ currentProfile\n        const profile = useLocalAuthStore.getState().currentProfile\n        set({\n          user: finalUser,\n          isAuthenticated: true,\n          currentProfile: profile,\n        })\n      },\n\n      logout: async () => {\n        // ğŸ” ç™»å‡º Supabase Auth session\n        try {\n          const { supabase } = await import('@/lib/supabase/client')\n          await supabase.auth.signOut()\n          logger.log('âœ… Supabase Auth session å·²ç™»å‡º')\n        } catch (error) {\n          logger.warn('âš ï¸ Supabase Auth ç™»å‡ºå¤±æ•—:', error)\n        }\n\n        // ä½¿ç”¨é›¢ç·šèªè­‰æœå‹™ç™»å‡º\n        OfflineAuthService.logout()\n\n        // å®‰å…¨æ¸…é™¤èªè­‰ cookie\n        if (typeof window !== 'undefined') {\n          if (window.location.hostname === 'localhost') {\n            document.cookie = 'auth-token=; path=/; max-age=0; SameSite=Lax'\n          } else {\n            document.cookie = 'auth-token=; path=/; max-age=0; SameSite=Strict; Secure'\n          }\n        }\n\n        set({\n          user: null,\n          isAuthenticated: false,\n          currentProfile: null,\n        })\n      },\n\n      validateLogin: async (username: string, password: string) => {\n        try {\n          // æª¢æŸ¥ç™»å…¥æ¬¡æ•¸é™åˆ¶\n          const attemptCheck = checkLoginAttempts(username)\n          if (!attemptCheck.allowed) {\n            return { success: false, message: attemptCheck.message }\n          }\n\n          const localAuthStore = useLocalAuthStore.getState()\n          const existingProfile = localAuthStore.profiles.find(p => p.employee_number === username)\n\n          // ğŸŒ å„ªå…ˆæª¢æŸ¥ç¶²è·¯ç‹€æ…‹\n          const isOnline = navigator.onLine\n\n          // ğŸŒ æœ‰ç¶²è·¯ â†’ å„ªå…ˆå¾ Supabase é©—è­‰ï¼ˆç¢ºä¿å¯†ç¢¼ã€æ¬Šé™ã€ç‹€æ…‹éƒ½æ˜¯æœ€æ–°çš„ï¼‰\n          if (isOnline) {\n            logger.log('ğŸŒ æœ‰ç¶²è·¯é€£ç·šï¼Œå¾ Supabase é©—è­‰...', username)\n\n            // ç›´æ¥è·³åˆ° Supabase é©—è­‰ï¼ˆè·³éè§’è‰²å¡ç™»å…¥ï¼‰\n            // ï¼ˆä¸‹é¢çš„ Supabase é©—è­‰é‚è¼¯æœƒåœ¨é©—è­‰æˆåŠŸå¾Œæ›´æ–°è§’è‰²å¡ï¼‰\n          }\n          // ğŸ“´ ç„¡ç¶²è·¯ + æœ‰è§’è‰²å¡ â†’ é›¢ç·šå¿«é€Ÿç™»å…¥ï¼ˆä½¿ç”¨ IndexedDBï¼‰\n          else if (!isOnline && existingProfile) {\n            logger.log('ğŸ“´ é›¢ç·šæ¨¡å¼ + æ‰¾åˆ°è§’è‰²å¡ï¼Œä½¿ç”¨é›¢ç·šç™»å…¥:', username)\n\n            try {\n              // å¾ IndexedDB è®€å–å“¡å·¥è³‡æ–™\n              const { localDB } = await import('@/lib/db')\n              const { TABLES } = await import('@/lib/db/schemas')\n\n              const employee = (await localDB.read(TABLES.EMPLOYEES, existingProfile.id)) as User | undefined\n\n              if (!employee) {\n                logger.error('âŒ IndexedDB æ‰¾ä¸åˆ°å“¡å·¥è³‡æ–™')\n                localAuthStore.removeProfile(existingProfile.id)\n                return { success: false, message: 'æœ¬åœ°è³‡æ–™å·²æå£ï¼Œè«‹é€£ç·šç¶²è·¯å¾Œé‡æ–°ç™»å…¥' }\n              }\n\n              // ğŸ” æª¢æŸ¥è³‡æ–™æ ¼å¼ï¼ˆçµ±ä¸€ä½¿ç”¨ snake_caseï¼‰\n              if (!employee.password_hash || !employee.employee_number || !employee.display_name) {\n                logger.error('âŒ IndexedDB è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼ˆæ‡‰ç‚º snake_caseï¼‰')\n                logger.error('   è«‹è¨ªå• /check-db.html æ¸…ç©ºè³‡æ–™åº«')\n                localAuthStore.removeProfile(existingProfile.id)\n                return {\n                  success: false,\n                  message:\n                    'æœ¬åœ°è³‡æ–™æ ¼å¼éŒ¯èª¤ï¼Œè«‹é€£ç·šç¶²è·¯å¾Œé‡æ–°ç™»å…¥\\nï¼ˆæˆ–è¨ªå• /check-db.html æ¸…ç©ºè³‡æ–™åº«ï¼‰',\n                }\n              }\n\n              // æª¢æŸ¥å“¡å·¥ç‹€æ…‹\n              if (employee.status === 'terminated') {\n                logger.error('âŒ å¸³è™Ÿå·²åœç”¨')\n                return { success: false, message: 'æ­¤å¸³è™Ÿå·²åœç”¨' }\n              }\n\n              // é©—è­‰å¯†ç¢¼ï¼ˆä½¿ç”¨ bcryptï¼‰\n              const bcrypt = (await import('bcryptjs')).default\n              const isValidPassword = await bcrypt.compare(password, employee.password_hash)\n\n              if (!isValidPassword) {\n                logger.error('âŒ å¯†ç¢¼éŒ¯èª¤')\n                recordLoginAttempt(username, false)\n                return { success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' }\n              }\n\n              // âœ… é›¢ç·šç™»å…¥æˆåŠŸ\n              logger.log('âœ… ğŸ“´ é›¢ç·šç™»å…¥æˆåŠŸ')\n              recordLoginAttempt(username, true)\n\n              const user: User = {\n                id: employee.id,\n                employee_number: employee.employee_number,\n                english_name: employee.english_name,\n                display_name: employee.display_name,\n                chinese_name: employee.chinese_name || employee.display_name,\n                personal_info: employee.personal_info || {},\n                job_info: employee.job_info || {},\n                salary_info: employee.salary_info || {},\n                permissions: employee.permissions || [],\n                roles: employee.roles || [],\n                attendance: employee.attendance || { leave_records: [], overtime_records: [] },\n                contracts: employee.contracts || [],\n                status: employee.status,\n                workspace_id: employee.workspace_id, // âœ… å¾è³‡æ–™åº«è®€å– workspace_id\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n              }\n\n              set({\n                user,\n                isAuthenticated: true,\n                currentProfile: existingProfile,\n                isOfflineMode: true,\n              })\n              return { success: true }\n            } catch (error) {\n              logger.error('âŒ é›¢ç·šç™»å…¥å¤±æ•—:', error)\n              // åˆªé™¤æå£çš„è§’è‰²å¡\n              localAuthStore.removeProfile(existingProfile.id)\n              return { success: false, message: 'é›¢ç·šç™»å…¥å¤±æ•—ï¼Œè«‹é€£ç·šç¶²è·¯å¾Œé‡æ–°ç™»å…¥' }\n            }\n          }\n          // ğŸ“´ ç„¡ç¶²è·¯ + ç„¡è§’è‰²å¡ â†’ ç„¡æ³•ç™»å…¥\n          else if (!isOnline && !existingProfile) {\n            logger.error('âŒ é›¢ç·šç‹€æ…‹ä¸”ç„¡è§’è‰²å¡')\n            return { success: false, message: 'é›¢ç·šç‹€æ…‹ä¸‹ç„¡æ³•ç™»å…¥ï¼Œè«‹é€£æ¥ç¶²è·¯' }\n          }\n\n          // ğŸŒ æ²’æœ‰è§’è‰²å¡ â†’ å¾ Supabase é©—è­‰ï¼ˆç¬¬ä¸€æ¬¡ç™»å…¥ï¼‰\n          logger.log('ğŸŒ ç¬¬ä¸€æ¬¡ç™»å…¥ï¼ŒæŸ¥è©¢ Supabase...')\n\n          // æª¢æŸ¥ç’°å¢ƒè®Šæ•¸\n          logger.log('ğŸ”§ ç’°å¢ƒè®Šæ•¸æª¢æŸ¥:', {\n            hasUrl: !!process.env.NEXT_PUBLIC_SUPABASE_URL,\n            hasKey: !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,\n            url: process.env.NEXT_PUBLIC_SUPABASE_URL?.substring(0, 30) + '...',\n          })\n\n          // å¾ Supabase æŸ¥è©¢å“¡å·¥è³‡æ–™\n          const { supabase } = await import('@/lib/supabase/client')\n          logger.log('ğŸ“¡ Supabase client è¼‰å…¥æˆåŠŸ')\n\n          const { data: employees, error: queryError } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('employee_number', username)\n            .single()\n\n          logger.log('ğŸ“Š æŸ¥è©¢çµæœ:', {\n            hasData: !!employees,\n            hasError: !!queryError,\n            errorMessage: queryError?.message,\n          })\n\n          if (queryError || !employees) {\n            logger.error('âŒ Supabase æŸ¥è©¢å¤±æ•—:', queryError?.message)\n            logger.error('   å®Œæ•´éŒ¯èª¤:', queryError)\n            recordLoginAttempt(username, false)\n            return { success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' }\n          }\n\n          interface EmployeeData {\n            id: string\n            employee_number: string\n            display_name: string\n            english_name: string\n            chinese_name: string\n            password_hash: string\n            must_change_password: boolean\n            last_password_change?: string\n            personal_info?: Record<string, unknown>\n            job_info?: Record<string, unknown>\n            salary_info?: Record<string, unknown>\n            permissions?: string[]\n            roles?: string[]\n            attendance?: Record<string, unknown>\n            contracts?: unknown[]\n            status: string\n            workspace_id: string\n            created_at?: string\n            updated_at?: string\n          }\n\n          const employeeData = employees as unknown as EmployeeData\n          logger.log('âœ… æ‰¾åˆ°å“¡å·¥è³‡æ–™:', employeeData.display_name)\n\n          // å°‡ snake_case è½‰æ›ç‚º camelCaseï¼ˆå‰ç«¯çµ±ä¸€æ ¼å¼ï¼‰\n          const employee = {\n            id: employeeData.id,\n            employee_number: employeeData.employee_number,\n            display_name: employeeData.display_name,\n            english_name: employeeData.english_name,\n            chinese_name: employeeData.chinese_name,\n            password_hash: employeeData.password_hash,\n            must_change_password: employeeData.must_change_password,\n            last_password_change: employeeData.last_password_change,\n            personal_info: employeeData.personal_info || {},\n            job_info: employeeData.job_info || {},\n            salary_info: employeeData.salary_info || {},\n            permissions: employeeData.permissions || [],\n            roles: employeeData.roles || [], // é™„åŠ èº«ä»½æ¨™ç±¤\n            attendance: employeeData.attendance || { leave_records: [], overtime_records: [] },\n            contracts: employeeData.contracts || [],\n            status: employeeData.status,\n            workspace_id: employeeData.workspace_id, // âœ… å¾è³‡æ–™åº«è®€å– workspace_id\n            created_at: employeeData.created_at,\n            updated_at: employeeData.updated_at,\n          }\n\n          // æª¢æŸ¥å“¡å·¥ç‹€æ…‹\n          logger.log('ğŸ” æª¢æŸ¥å“¡å·¥ç‹€æ…‹:', employee.status)\n          if (employee.status === 'terminated') {\n            logger.error('âŒ å¸³è™Ÿå·²åœç”¨')\n            return { success: false, message: 'æ­¤å¸³è™Ÿå·²åœç”¨' }\n          }\n\n          // é©—è­‰å¯†ç¢¼\n          logger.log('ğŸ” æª¢æŸ¥å¯†ç¢¼ hash:', {\n            hasPasswordHash: !!employee.password_hash,\n            hashLength: employee.password_hash?.length,\n          })\n\n          if (!employee.password_hash) {\n            logger.warn('âš ï¸ å“¡å·¥å°šæœªè¨­å®šå¯†ç¢¼:', username)\n            return { success: false, message: 'è«‹å…ˆè¨­å®šå¯†ç¢¼' }\n          }\n\n          // ä½¿ç”¨ bcrypt é©—è­‰å¯†ç¢¼\n          logger.log('ğŸ”‘ é–‹å§‹é©—è­‰å¯†ç¢¼...')\n          const bcrypt = (await import('bcryptjs')).default\n          const isValidPassword = await bcrypt.compare(password, employee.password_hash)\n\n          logger.log('ğŸ”‘ å¯†ç¢¼é©—è­‰çµæœ:', isValidPassword)\n\n          if (!isValidPassword) {\n            logger.error('âŒ å¯†ç¢¼éŒ¯èª¤')\n            recordLoginAttempt(username, false)\n            return { success: false, message: 'å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤' }\n          }\n\n          // âœ… Supabase é©—è­‰æˆåŠŸï¼\n          logger.log('âœ… Supabase é©—è­‰æˆåŠŸï¼Œå»ºç«‹è§’è‰²å¡...')\n          recordLoginAttempt(username, true)\n\n          // ğŸ” å»ºç«‹ Supabase Auth sessionï¼ˆç”¨æ–¼ Realtime å’Œèªè­‰ï¼‰\n          try {\n            const email = `${username}@venturo.com` // ä½¿ç”¨å“¡å·¥ç·¨è™Ÿä½œç‚º email\n            logger.log('ğŸ” å˜—è©¦å»ºç«‹ Supabase Auth session...', email)\n\n            const { data: authData, error: authError } = await supabase.auth.signInWithPassword({\n              email,\n              password,\n            })\n\n            if (authError) {\n              logger.warn('âš ï¸ Supabase Auth ç™»å…¥å¤±æ•—ï¼ˆä¸å½±éŸ¿ç³»çµ±ç™»å…¥ï¼‰:', authError.message)\n\n              // ğŸ”§ å¦‚æœæ˜¯å¯†ç¢¼éŒ¯èª¤ï¼Œå˜—è©¦åŒæ­¥å¯†ç¢¼ï¼ˆé€é API Routeï¼‰\n              if (authError.message.includes('Invalid login credentials')) {\n                logger.log('ğŸ”§ å˜—è©¦åŒæ­¥ auth.users å¯†ç¢¼...')\n                try {\n                  // å‘¼å« API Route åŒæ­¥å¯†ç¢¼\n                  const syncResponse = await fetch('/api/auth/sync-password', {\n                    method: 'POST',\n                    headers: {\n                      'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                      userId: employee.id,\n                      password: password,\n                    }),\n                  })\n\n                  if (syncResponse.ok) {\n                    logger.log('âœ… auth.users å¯†ç¢¼å·²åŒæ­¥ï¼Œé‡æ–°å˜—è©¦ç™»å…¥...')\n\n                    // é‡æ–°å˜—è©¦ç™»å…¥\n                    const { data: retryAuthData, error: retryAuthError } =\n                      await supabase.auth.signInWithPassword({\n                        email,\n                        password,\n                      })\n\n                    if (retryAuthError) {\n                      logger.warn('âš ï¸ é‡æ–°ç™»å…¥ä»ç„¶å¤±æ•—:', retryAuthError.message)\n                    } else {\n                      logger.log('âœ… Supabase Auth session å·²å»ºç«‹:', retryAuthData.user?.id)\n                    }\n                  } else {\n                    const errorText = await syncResponse.text()\n                    logger.warn('âš ï¸ åŒæ­¥å¯†ç¢¼å¤±æ•—:', errorText)\n                  }\n                } catch (syncError) {\n                  logger.warn('âš ï¸ å¯†ç¢¼åŒæ­¥éŒ¯èª¤:', syncError)\n                }\n              }\n            } else {\n              logger.log('âœ… Supabase Auth session å·²å»ºç«‹:', authData.user?.id)\n            }\n          } catch (authError) {\n            logger.warn('âš ï¸ Supabase Auth ç™»å…¥å¤±æ•—ï¼ˆä¸å½±éŸ¿ç³»çµ±ç™»å…¥ï¼‰:', authError)\n          }\n\n          // å»ºç«‹ç”¨æˆ¶å°è±¡ï¼ˆå‘ä¸‹ç›¸å®¹ï¼‰\n          const user: User = {\n            id: employee.id,\n            employee_number: employee.employee_number,\n            english_name: employee.english_name,\n            display_name: employee.display_name,\n            chinese_name: employee.chinese_name || employee.display_name,\n            personal_info: employee.personal_info as any,\n            job_info: employee.job_info as any,\n            salary_info: employee.salary_info as any,\n            permissions: employee.permissions,\n            roles: (employee.roles || []) as User['roles'], // é™„åŠ èº«ä»½æ¨™ç±¤\n            attendance: employee.attendance as any,\n            contracts: employee.contracts as any,\n            status: employee.status as User['status'],\n            workspace_id: employee.workspace_id, // âœ… å¾è³‡æ–™åº«è®€å– workspace_id\n            created_at: employee.created_at || new Date().toISOString(),\n            updated_at: employee.updated_at || new Date().toISOString(),\n          }\n\n          // ğŸ´ å»ºç«‹è§’è‰²å¡ï¼ˆProfile Cardï¼‰- ç”¨æ–¼é›¢ç·šå¿«é€Ÿç™»å…¥\n          const personalInfo = employee.personal_info as { email?: string; phone?: string | string[] } | null\n          const profile: LocalProfile = {\n            id: employee.id,\n            email: personalInfo?.email || `${username}@venturo.local`,\n            employee_number: employee.employee_number,\n            display_name: employee.display_name,\n            english_name: employee.english_name,\n            role: employee.permissions?.includes('admin') ? 'ADMIN' : 'EMPLOYEE',\n            permissions: employee.permissions || [],\n            roles: (employee.roles || []) as User['roles'], // é™„åŠ èº«ä»½æ¨™ç±¤ï¼ˆæ”¯æ´å¤šé‡è§’è‰²ï¼‰\n            personal_info: employee.personal_info as any,\n            job_info: employee.job_info as any,\n            salary_info: employee.salary_info as any,\n            contracts: employee.contracts as any,\n            attendance: employee.attendance as any,\n            lastLoginAt: new Date().toISOString(),\n            created_at: employee.created_at || new Date().toISOString(),\n            status: employee.status === 'active' ? 'active' : 'inactive',\n          }\n\n          // ğŸ’¾ å„²å­˜è§’è‰²å¡åˆ° local-auth-managerï¼ˆä¸‹æ¬¡å¯é›¢ç·šç™»å…¥ï¼‰\n          // å…ˆç§»é™¤èˆŠçš„ï¼Œå†æ–°å¢ï¼ˆç¢ºä¿å®Œå…¨æ›´æ–°ï¼‰\n          const oldProfile = localAuthStore.profiles.find(p => p.id === employee.id)\n          if (oldProfile) {\n            logger.log('ğŸ”„ ç™¼ç¾èˆŠè§’è‰²å¡ï¼Œç§»é™¤å¾Œé‡æ–°å»ºç«‹...')\n            localAuthStore.removeProfile(employee.id)\n          }\n\n          localAuthStore.addProfile(profile)\n          localAuthStore.setCurrentProfile(profile)\n          logger.log('ğŸ´ è§’è‰²å¡å·²å»ºç«‹/æ›´æ–°ï¼Œä¸‹æ¬¡å¯é›¢ç·šç™»å…¥')\n\n          // ğŸ’¾ åŒæ­¥æ›´æ–° IndexedDB çš„ employees è³‡æ–™ï¼ˆç¢ºä¿é›¢ç·šè³‡æ–™æœ€æ–°ï¼‰\n          try {\n            const { localDB } = await import('@/lib/db')\n            const { TABLES } = await import('@/lib/db/schemas')\n\n            await localDB.put(TABLES.EMPLOYEES, employee)\n            logger.log('âœ… IndexedDB employees è³‡æ–™å·²åŒæ­¥')\n          } catch (dbError) {\n            logger.warn('âš ï¸ IndexedDB åŒæ­¥å¤±æ•—ï¼ˆä¸å½±éŸ¿ç™»å…¥ï¼‰:', dbError)\n          }\n\n          // ç”Ÿæˆ JWT token\n          const authPayload: AuthPayload = {\n            id: employee.id,\n            employee_number: employee.employee_number,\n            permissions: employee.permissions || [],\n            role: employee.permissions?.includes('admin') ? 'admin' : 'employee',\n          }\n\n          const token = generateToken(authPayload)\n\n          // è¨­å®šå®‰å…¨ cookie\n          setSecureCookie(token, false)\n\n          // æ›´æ–° store ç‹€æ…‹\n          set({\n            user,\n            isAuthenticated: true,\n            currentProfile: profile,\n          })\n\n          // åˆå§‹åŒ–åŒæ­¥å·²æ”¹ç”¨ createStore çš„ fetchAll è‡ªå‹•è™•ç†\n          // æ¯å€‹é é¢è¼‰å…¥æ™‚æœƒè‡ªå‹•å¾ Supabase ä¸‹è¼‰è³‡æ–™\n          logger.log('âœ… ç™»å…¥æˆåŠŸï¼Œè³‡æ–™å°‡åœ¨å„é é¢è¼‰å…¥æ™‚è‡ªå‹•åŒæ­¥')\n\n          /* èˆŠçš„åˆå§‹åŒ–åŒæ­¥ç¨‹å¼ç¢¼ï¼ˆå·²å»¢æ£„ï¼‰\n      try {\n        const { needsInitialSync, initialSync } = await import('@/lib/offline/initial-sync');\n        const needsSync = await needsInitialSync();\n        if (needsSync) {\n          logger.log('ğŸ“¥ é–‹å§‹åˆå§‹åŒ–åŒæ­¥...');\n          initialSync((progress) => {\n            logger.log(`ğŸ“Š åŒæ­¥é€²åº¦: ${progress.current}/${progress.total} - ${progress.table}`);\n          }).then((result) => {\n            if (result.success) {\n              logger.log('âœ… åˆå§‹åŒ–åŒæ­¥å®Œæˆï¼');\n            } else {\n              logger.error('âŒ åˆå§‹åŒ–åŒæ­¥å¤±æ•—:', result.error);\n            }\n          });\n        } else {\n          logger.log('â„¹ï¸ æœ¬åœ°è³‡æ–™æ­£å¸¸ï¼Œè·³éåˆå§‹åŒ–åŒæ­¥');\n        }\n      } catch (syncError) {\n        logger.warn('âš ï¸ åŒæ­¥æª¢æŸ¥å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿ç™»å…¥:', syncError);\n      }\n      */\n\n          logger.log('âœ… ç™»å…¥æˆåŠŸ:', employee.display_name)\n          return { success: true }\n        } catch (error) {\n          logger.error('ğŸ’¥ ç™»å…¥é©—è­‰éŒ¯èª¤:', error)\n          return { success: false, message: 'ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦' }\n        }\n      },\n\n      checkPermission: (permission: string) => {\n        const profile = get().currentProfile\n        if (!profile) return false\n        return profile.permissions.includes(permission) || profile.permissions.includes('admin')\n      },\n\n      switchProfile: async (profileId: string) => {\n        const success = OfflineAuthService.switchProfile(profileId)\n        if (success) {\n          const profile = useLocalAuthStore.getState().getProfileById(profileId)\n          if (profile) {\n            const user: User = {\n              id: profile.id,\n              employee_number: profile.employee_number,\n              english_name: profile.english_name,\n              display_name: profile.display_name,\n              chinese_name: profile.display_name, // å¾ profile å–å¾—\n              personal_info: (profile.personal_info as User['personal_info']) || {\n                national_id: '',\n                birthday: '',\n                phone: '',\n                email: '',\n                address: '',\n                emergency_contact: { name: '', relationship: '', phone: '' }\n              },\n              job_info: (profile.job_info as User['job_info']) || {\n                hire_date: new Date().toISOString()\n              },\n              salary_info: (profile.salary_info as User['salary_info']) || {\n                base_salary: 0,\n                allowances: [],\n                salary_history: []\n              },\n              permissions: profile.permissions || [],\n              roles: profile.roles as User['roles'] || [],\n              attendance: (profile.attendance as User['attendance']) || {\n                leave_records: [],\n                overtime_records: []\n              },\n              contracts: (profile.contracts as User['contracts']) || [],\n              status: profile.status as 'active' | 'probation' | 'leave' | 'terminated',\n              workspace_id: profile.workspace_id, // âœ… å¾è³‡æ–™åº«è®€å– workspace_id\n              created_at: profile.created_at || new Date().toISOString(),\n              updated_at: new Date().toISOString(),\n            }\n\n            // ğŸ” è¨­å®šèªè­‰ cookieï¼ˆå¿«é€Ÿç™»å…¥ä¹Ÿéœ€è¦ï¼Œä½¿ç”¨å¸¶ç°½åçš„ tokenï¼‰\n            const token = await generateQuickLoginToken(profile.id)\n            setSecureCookie(token, false)\n\n            set({\n              currentProfile: profile,\n              user,\n              isAuthenticated: true,\n            })\n          }\n        }\n        return success\n      },\n\n      toggleSidebar: () => set(state => ({ sidebarCollapsed: !state.sidebarCollapsed })),\n      setSidebarCollapsed: collapsed => set({ sidebarCollapsed: collapsed }),\n      setHasHydrated: hasHydrated => set({ _hasHydrated: hasHydrated }),\n    }),\n    {\n      name: 'auth-storage',\n      skipHydration: true, // ğŸ”¥ é¿å… SSR æ™‚è®€å– localStorage\n      partialize: state => ({\n        user: state.user,\n        isAuthenticated: state.isAuthenticated,\n        currentProfile: state.currentProfile,\n        sidebarCollapsed: state.sidebarCollapsed,\n        isOfflineMode: state.isOfflineMode,\n      }),\n      onRehydrateStorage: () => async state => {\n        // Hydration å®Œæˆå¾Œè¨­ç½®æ¨™è¨˜\n        if (state) {\n          state._hasHydrated = true\n\n          // ğŸ”§ è‡ªå‹•ä¿®å¾©ï¼šå¦‚æœ user ç¼ºå°‘ workspace_idï¼Œå¾ Supabase å³æ™‚æŸ¥è©¢è£œä¸Š\n          if (state.user && !state.user.workspace_id) {\n            logger.warn('âš ï¸ [onRehydrate] user ç¼ºå°‘ workspace_idï¼Œå¾ Supabase æŸ¥è©¢...')\n            try {\n              const { supabase } = await import('@/lib/supabase/client')\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              const { data: employee, error } = await (supabase as any)\n                .from('employees')\n                .select('workspace_id')\n                .eq('id', state.user.id)\n                .single()\n\n              if (!error && employee?.workspace_id) {\n                // ç›´æ¥æ›´æ–° store ç‹€æ…‹\n                useAuthStore.setState({\n                  user: {\n                    ...state.user,\n                    workspace_id: employee.workspace_id,\n                  },\n                })\n                logger.log('âœ… [onRehydrate] å·²å¾ Supabase è£œä¸Š workspace_id:', employee.workspace_id)\n              } else {\n                logger.error('âŒ [onRehydrate] ç„¡æ³•å¾ Supabase å–å¾— workspace_id:', error?.message)\n              }\n            } catch (err) {\n              logger.error('âŒ [onRehydrate] æŸ¥è©¢ workspace_id å¤±æ•—:', err)\n            }\n          }\n        }\n      },\n    }\n  )\n)\n\n// ğŸ”„ å®¢æˆ¶ç«¯è‡ªå‹• hydrateï¼ˆæ¢å¾©ç™»å…¥ç‹€æ…‹ï¼‰\n// workspace_id çš„è‡ªå‹•ä¿®å¾©å·²ç§»è‡³ onRehydrateStorage ä¸­è™•ç†\nif (typeof window !== 'undefined') {\n  const store = useAuthStore as typeof useAuthStore & { persist: { rehydrate: () => void } }\n  store.persist.rehydrate()\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/calendar-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/confirmation-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/core/create-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/core/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/cost-template-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/esim-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/home-settings-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/linkpay-log-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/manifestation-store.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":43,"column":7,"severity":1,"nodeType":null,"fix":{"range":[1257,1319],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":72,"column":7,"severity":1,"nodeType":null,"fix":{"range":[2021,2083],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":114,"column":7,"severity":1,"nodeType":null,"fix":{"range":[3129,3191],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":148,"column":7,"severity":1,"nodeType":null,"fix":{"range":[3942,4004],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":188,"column":7,"severity":1,"nodeType":null,"fix":{"range":[4967,5029],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":219,"column":7,"severity":1,"nodeType":null,"fix":{"range":[5731,5793],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":6,"source":"import { create } from 'zustand'\nimport { ManifestationEntry, ManifestationProgress } from '@/types/manifestation'\nimport { supabase } from '@/lib/supabase/client'\nimport { useAuthStore } from './auth-store'\n\ninterface ManifestationState {\n  // ç‹€æ…‹\n  entries: ManifestationEntry[]\n  currentEntry: ManifestationEntry | null\n  progress: ManifestationProgress | null\n  isLoading: boolean\n  error: string | null\n\n  // æ–¹æ³•\n  fetchEntries: () => Promise<void>\n  fetchEntryByChapter: (chapterNumber: number) => Promise<void>\n  createEntry: (entry: Partial<ManifestationEntry>) => Promise<ManifestationEntry | null>\n  updateEntry: (id: string, updates: Partial<ManifestationEntry>) => Promise<boolean>\n  deleteEntry: (id: string) => Promise<boolean>\n  fetchProgress: () => Promise<void>\n  setCurrentEntry: (entry: ManifestationEntry | null) => void\n  clearError: () => void\n}\n\nexport const useManifestationStore = create<ManifestationState>((set, get) => ({\n  entries: [],\n  currentEntry: null,\n  progress: null,\n  isLoading: false,\n  error: null,\n\n  // ç²å–ç•¶å‰ç”¨æˆ¶çš„æ‰€æœ‰è¨˜éŒ„\n  fetchEntries: async () => {\n    const user = useAuthStore.getState().user\n    if (!user) {\n      set({ error: 'è«‹å…ˆç™»å…¥' })\n      return\n    }\n\n    set({ isLoading: true, error: null })\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data, error } = await (supabase as any)\n        .from('manifestation_entries')\n        .select('*')\n        .eq('user_id', user.id)\n        .order('chapter_number', { ascending: true })\n\n      if (error) throw error\n\n      set({ entries: (data as ManifestationEntry[]) || [], isLoading: false })\n    } catch (error) {\n      set({\n        error: error instanceof Error ? error.message : 'ç²å–è¨˜éŒ„å¤±æ•—',\n        isLoading: false,\n      })\n    }\n  },\n\n  // ç²å–ç‰¹å®šç« ç¯€çš„è¨˜éŒ„\n  fetchEntryByChapter: async (chapterNumber: number) => {\n    const user = useAuthStore.getState().user\n    if (!user) {\n      set({ error: 'è«‹å…ˆç™»å…¥' })\n      return\n    }\n\n    set({ isLoading: true, error: null })\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data, error } = await (supabase as any)\n        .from('manifestation_entries')\n        .select('*')\n        .eq('user_id', user.id)\n        .eq('chapter_number', chapterNumber)\n        .order('created_at', { ascending: false })\n        .limit(1)\n        .single()\n\n      if (error && error.code !== 'PGRST116') {\n        // PGRST116 = No rows found\n        throw error\n      }\n\n      set({ currentEntry: (data as ManifestationEntry) || null, isLoading: false })\n    } catch (error) {\n      set({\n        error: error instanceof Error ? error.message : 'ç²å–ç« ç¯€è¨˜éŒ„å¤±æ•—',\n        isLoading: false,\n      })\n    }\n  },\n\n  // å‰µå»ºæ–°è¨˜éŒ„\n  createEntry: async (entry: Partial<ManifestationEntry>) => {\n    const user = useAuthStore.getState().user\n    if (!user) {\n      set({ error: 'è«‹å…ˆç™»å…¥' })\n      return null\n    }\n\n    set({ isLoading: true, error: null })\n\n    try {\n      const newEntry = {\n        ...entry,\n        user_id: user.id,\n        created_at: new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data, error } = await (supabase as any)\n        .from('manifestation_entries')\n        .insert(newEntry)\n        .select()\n        .single()\n\n      if (error) throw error\n\n      // æ›´æ–°æœ¬åœ°ç‹€æ…‹\n      set(state => ({\n        entries: [...state.entries, data as ManifestationEntry],\n        currentEntry: data as ManifestationEntry,\n        isLoading: false,\n      }))\n\n      // é‡æ–°ç²å–é€²åº¦\n      get().fetchProgress()\n\n      return data\n    } catch (error) {\n      set({\n        error: error instanceof Error ? error.message : 'å‰µå»ºè¨˜éŒ„å¤±æ•—',\n        isLoading: false,\n      })\n      return null\n    }\n  },\n\n  // æ›´æ–°è¨˜éŒ„\n  updateEntry: async (id: string, updates: Partial<ManifestationEntry>) => {\n    set({ isLoading: true, error: null })\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data, error } = await (supabase as any)\n        .from('manifestation_entries')\n        .update({\n          ...updates,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', id)\n        .select()\n        .single()\n\n      if (error) throw error\n\n      // æ›´æ–°æœ¬åœ°ç‹€æ…‹\n      set(state => ({\n        entries: state.entries.map(e => (e.id === id ? data as ManifestationEntry : e)),\n        currentEntry: state.currentEntry?.id === id ? data as ManifestationEntry : state.currentEntry,\n        isLoading: false,\n      }))\n\n      // å¦‚æœæ›´æ–°äº† is_completedï¼Œé‡æ–°ç²å–é€²åº¦\n      if (updates.is_completed !== undefined) {\n        get().fetchProgress()\n      }\n\n      return true\n    } catch (error) {\n      set({\n        error: error instanceof Error ? error.message : 'æ›´æ–°è¨˜éŒ„å¤±æ•—',\n        isLoading: false,\n      })\n      return false\n    }\n  },\n\n  // åˆªé™¤è¨˜éŒ„\n  deleteEntry: async (id: string) => {\n    set({ isLoading: true, error: null })\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { error } = await (supabase as any).from('manifestation_entries').delete().eq('id', id)\n\n      if (error) throw error\n\n      // æ›´æ–°æœ¬åœ°ç‹€æ…‹\n      set(state => ({\n        entries: state.entries.filter(e => e.id !== id),\n        currentEntry: state.currentEntry?.id === id ? null : state.currentEntry,\n        isLoading: false,\n      }))\n\n      // é‡æ–°ç²å–é€²åº¦\n      get().fetchProgress()\n\n      return true\n    } catch (error) {\n      set({\n        error: error instanceof Error ? error.message : 'åˆªé™¤è¨˜éŒ„å¤±æ•—',\n        isLoading: false,\n      })\n      return false\n    }\n  },\n\n  // ç²å–ç”¨æˆ¶é€²åº¦\n  fetchProgress: async () => {\n    const user = useAuthStore.getState().user\n    if (!user) return\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { data, error } = await (supabase as any)\n        .from('manifestation_user_progress')\n        .select('*')\n        .eq('user_id', user.id)\n        .single()\n\n      if (error && error.code !== 'PGRST116') {\n        throw error\n      }\n\n      set({ progress: (data || null) as ManifestationProgress | null })\n    } catch (error) {}\n  },\n\n  // è¨­ç½®ç•¶å‰è¨˜éŒ„\n  setCurrentEntry: (entry: ManifestationEntry | null) => {\n    set({ currentEntry: entry })\n  },\n\n  // æ¸…é™¤éŒ¯èª¤\n  clearError: () => {\n    set({ error: null })\n  },\n}))\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/operations/create.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/operations/delete.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/operations/fetch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/operations/query.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/operations/update.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/pnrs-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/receipt-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/region-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/supplier-category-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/sync/coordinator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/sync/event-bus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/sync/merge-strategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/theme-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/useTravelInvoiceStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/user-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/utils/abort-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/utils/code-generator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/voucher-entry-store.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":22,"column":3,"severity":1,"nodeType":null,"fix":{"range":[496,558],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * å‚³ç¥¨æ˜ç´° Store\n * å»ºç«‹æ—¥æœŸï¼š2025-01-17\n */\n\nimport { createStore } from './core/create-store'\nimport type { VoucherEntry } from '@/types/accounting-pro.types'\n\n/**\n * å‚³ç¥¨æ˜ç´° Store\n *\n * ä½¿ç”¨æ–¹å¼ï¼š\n * ```tsx\n * const entries = useVoucherEntryStore(state => state.items)\n * const fetchAll = useVoucherEntryStore(state => state.fetchAll)\n *\n * // æŸ¥è©¢ç‰¹å®šå‚³ç¥¨çš„åˆ†éŒ„\n * const voucherEntries = entries.filter(e => e.voucher_id === voucherId)\n * ```\n */\nexport const useVoucherEntryStore = createStore<VoucherEntry>({\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  tableName: 'voucher_entries' as any,\n  enableSupabase: true,\n  fastInsert: true,\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/voucher-store.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":25,"column":3,"severity":1,"nodeType":null,"fix":{"range":[541,603],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * å‚³ç¥¨ Store\n * å»ºç«‹æ—¥æœŸï¼š2025-01-17\n */\n\nimport { createStore } from './core/create-store'\nimport type { Voucher } from '@/types/accounting-pro.types'\n\n/**\n * å‚³ç¥¨ Store\n *\n * ä½¿ç”¨æ–¹å¼ï¼š\n * ```tsx\n * const vouchers = useVoucherStore(state => state.items)\n * const fetchAll = useVoucherStore(state => state.fetchAll)\n * const create = useVoucherStore(state => state.create)\n *\n * // æŸ¥è©¢æœ¬æœˆå‚³ç¥¨\n * const monthVouchers = vouchers.filter(v =>\n *   v.voucher_date.startsWith('2025-01')\n * )\n * ```\n */\nexport const useVoucherStore = createStore<Voucher>({\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  tableName: 'vouchers' as any,\n  codePrefix: 'V',\n  enableSupabase: true,\n  fastInsert: true,\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace-module-store.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":30,"column":3,"severity":1,"nodeType":null,"fix":{"range":[750,812],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"/**\n * å·¥ä½œç©ºé–“æ¨¡çµ„æˆæ¬Š Store\n * å»ºç«‹æ—¥æœŸï¼š2025-01-17\n */\n\nimport { createStore } from './core/create-store'\nimport type { WorkspaceModule } from '@/types/accounting-pro.types'\n\n/**\n * å·¥ä½œç©ºé–“æ¨¡çµ„æˆæ¬Š Store\n *\n * ä½¿ç”¨æ–¹å¼ï¼š\n * ```tsx\n * const modules = useWorkspaceModuleStore(state => state.items)\n * const fetchAll = useWorkspaceModuleStore(state => state.fetchAll)\n *\n * // æª¢æŸ¥æœƒè¨ˆæ¨¡çµ„æ˜¯å¦å·²å•Ÿç”¨\n * const accountingModule = modules.find(m =>\n *   m.workspace_id === workspaceId &&\n *   m.module_name === 'accounting' &&\n *   m.is_enabled\n * )\n *\n * const hasAccounting = !!accountingModule\n * const isExpired = accountingModule?.expires_at &&\n *   new Date(accountingModule.expires_at) < new Date()\n * ```\n */\nexport const useWorkspaceModuleStore = createStore<WorkspaceModule>({\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  tableName: 'workspace_modules' as any,\n  enableSupabase: true,\n  fastInsert: true,\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/advance-list-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/canvas-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/channel-group-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/channel-member-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/channel-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/channels-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/chat-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/members-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/message-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/personal-canvas-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/rich-document-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/shared-order-list-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/widgets-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/stores/workspace/workspace-store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/accounting-pro.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/base.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/calendar.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/company-asset.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/company.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/confirmation.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/customer.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/esim.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/manifestation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/models.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/order.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/pnr.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/quote.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/receipt.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/supplier-category.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/supplier.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/tour-departure.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/tour.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/src/types/transportation-rates.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/supabase/functions/workspace-api/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/test-data-persistence.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/tests/setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/verify-final-status.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/william/Projects/venturo-new/vitest.setup.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-undef').","line":17,"column":1,"severity":1,"nodeType":null,"fix":{"range":[352,388],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-undef').","line":21,"column":1,"severity":1,"nodeType":null,"fix":{"range":[457,493],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import '@testing-library/jest-dom'\nimport { expect, afterEach, vi } from 'vitest'\nimport { cleanup } from '@testing-library/react'\n\n// Cleanup after each test case (e.g., clearing jsdom)\nafterEach(() => {\n  cleanup()\n})\n\n// Mock localStorage\nconst localStorageMock = {\n  getItem: vi.fn(),\n  setItem: vi.fn(),\n  removeItem: vi.fn(),\n  clear: vi.fn(),\n}\n// eslint-disable-next-line no-undef\n;(global as any).localStorage = localStorageMock\n\n// Mock IndexedDB\n// eslint-disable-next-line no-undef\n;(global as any).indexedDB = {}\n","usedDeprecatedRules":[]}]