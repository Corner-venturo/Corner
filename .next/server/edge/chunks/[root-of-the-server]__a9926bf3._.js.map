{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/auth.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcryptjs';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'venturo_app_jwt_secret_key_change_in_production_2024';\n\nexport interface AuthPayload {\n  id: string;\n  employeeNumber: string;\n  permissions: string[];\n  role: string;\n}\n\n// ç”Ÿæˆ JWT token\nexport function generateToken(payload: AuthPayload): string {\n  try {\n    return jwt.sign(payload, JWT_SECRET, {\n      expiresIn: '8h',\n      issuer: 'venturo-app'\n    });\n  } catch (error) {\n    console.warn('JWT generation failed, using simple token', error);\n    // å¦‚æœ JWT å¤±æ•—ï¼Œä½¿ç”¨ç°¡å–®çš„ç·¨ç¢¼æ–¹æ¡ˆ\n    return btoa(JSON.stringify({\n      ...payload,\n      exp: Date.now() + 8 * 60 * 60 * 1000, // 8å°æ™‚\n      iss: 'venturo-app'\n    }));\n  }\n}\n\n// é©—è­‰ JWT token\nexport function verifyToken(token: string): AuthPayload | null {\n  try {\n    // å˜—è©¦ JWT é©—è­‰\n    const decoded = jwt.verify(token, JWT_SECRET) as AuthPayload;\n    return decoded;\n  } catch (jwtError) {\n    try {\n      // å¦‚æœ JWT å¤±æ•—ï¼Œå˜—è©¦ç°¡å–®è§£ç¢¼\n      const decoded = JSON.parse(atob(token));\n\n      // æª¢æŸ¥æ˜¯å¦éæœŸ\n      if (decoded.exp && Date.now() > decoded.exp) {\n        console.log('Token expired');\n        return null;\n      }\n\n      return decoded as AuthPayload;\n    } catch (fallbackError) {\n      console.error('Token verification failed:', fallbackError);\n      return null;\n    }\n  }\n}\n\n// åŠ å¯†å¯†ç¢¼\nexport async function hashPassword(password: string): Promise<string> {\n  const saltRounds = 12;\n  return bcrypt.hash(password, saltRounds);\n}\n\n// é©—è­‰å¯†ç¢¼\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return bcrypt.compare(password, hashedPassword);\n}\n\n// å¾ token å–å¾—ç”¨æˆ¶è³‡è¨Š\nexport function getUserFromToken(token: string): AuthPayload | null {\n  return verifyToken(token);\n}\n\n// æª¢æŸ¥æ¬Šé™\nexport function hasPermission(userPermissions: string[], requiredPermission: string): boolean {\n  return userPermissions.includes(requiredPermission) ||\n         userPermissions.includes('super_admin') ||\n         userPermissions.includes('admin');\n}\n\n// æª¢æŸ¥è§’è‰²\nexport function hasRole(userPermissions: string[], requiredRoles: string[]): boolean {\n  return requiredRoles.some(role => userPermissions.includes(role));\n}"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAUtC,SAAS,cAAc,OAAoB;IAChD,IAAI;QACF,OAAO,wJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;YACnC,WAAW;YACX,QAAQ;QACV;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,6CAA6C;QAC1D,sBAAsB;QACtB,OAAO,KAAK,KAAK,SAAS,CAAC;YACzB,GAAG,OAAO;YACV,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK;YAChC,KAAK;QACP;IACF;AACF;AAGO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,YAAY;QACZ,MAAM,UAAU,wJAAG,CAAC,MAAM,CAAC,OAAO;QAClC,OAAO;IACT,EAAE,OAAO,UAAU;QACjB,IAAI;YACF,mBAAmB;YACnB,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK;YAEhC,SAAS;YACT,IAAI,QAAQ,GAAG,IAAI,KAAK,GAAG,KAAK,QAAQ,GAAG,EAAE;gBAC3C,QAAQ,GAAG,CAAC;gBACZ,OAAO;YACT;YAEA,OAAO;QACT,EAAE,OAAO,eAAe;YACtB,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO;QACT;IACF;AACF;AAGO,eAAe,aAAa,QAAgB;IACjD,MAAM,aAAa;IACnB,OAAO,oJAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAGO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,oJAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAGO,SAAS,iBAAiB,KAAa;IAC5C,OAAO,YAAY;AACrB;AAGO,SAAS,cAAc,eAAyB,EAAE,kBAA0B;IACjF,OAAO,gBAAgB,QAAQ,CAAC,uBACzB,gBAAgB,QAAQ,CAAC,kBACzB,gBAAgB,QAAQ,CAAC;AAClC;AAGO,SAAS,QAAQ,eAAyB,EAAE,aAAuB;IACxE,OAAO,cAAc,IAAI,CAAC,CAAA,OAAQ,gBAAgB,QAAQ,CAAC;AAC7D"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { getUserFromToken, hasPermission, hasRole } from '@/lib/auth';\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // ç™½åå–®è·¯å¾‘ - ä¸éœ€è¦é©—è­‰\n  if (\n    pathname === '/login' ||\n    pathname.startsWith('/api/public') ||\n    pathname.startsWith('/_next/') ||\n    pathname.startsWith('/favicon.ico') ||\n    pathname === '/unauthorized'\n  ) {\n    return NextResponse.next();\n  }\n\n  // ğŸ”¥ æš«æ™‚å…è¨±æ‰€æœ‰è«‹æ±‚é€šéï¼Œå› ç‚ºç¾åœ¨ä½¿ç”¨ localStorage èªè­‰\n  // èªè­‰æª¢æŸ¥åœ¨å®¢æˆ¶ç«¯çš„ AuthGuard å’Œ MainLayout ä¸­é€²è¡Œ\n  return NextResponse.next();\n\n  // æª¢æŸ¥èªè­‰ token\n  const authToken = request.cookies.get('auth-token');\n\n  if (!authToken) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  try {\n    // é©—è­‰ JWT token\n    const user = getUserFromToken(authToken.value);\n\n    if (!user) {\n      const response = NextResponse.redirect(new URL('/login', request.url));\n      response.cookies.delete('auth-token');\n      return response;\n    }\n\n    // æ¬Šé™æª¢æŸ¥\n    const userPermissions = user.permissions || [];\n\n    // HR æ¨¡çµ„æ¬Šé™æª¢æŸ¥\n    if (pathname.startsWith('/hr')) {\n      if (!hasPermission(userPermissions, 'hr')) {\n        return NextResponse.redirect(new URL('/unauthorized', request.url));\n      }\n    }\n\n    // è²¡å‹™æ¨¡çµ„æ¬Šé™æª¢æŸ¥\n    if (pathname.startsWith('/finance')) {\n      const hasPaymentsPermission = hasPermission(userPermissions, 'payments');\n      const hasDisbursementPermission = hasPermission(userPermissions, 'disbursement');\n\n      if (!hasPaymentsPermission && !hasDisbursementPermission) {\n        return NextResponse.redirect(new URL('/unauthorized', request.url));\n      }\n    }\n\n    // è³‡æ–™åº«ç®¡ç†æ¬Šé™æª¢æŸ¥ - å…è¨±æ‰€æœ‰å·²ç™»å…¥ç”¨æˆ¶å­˜å–\n    if (pathname.startsWith('/database')) {\n      // è³‡æ–™åº«ç®¡ç†å°æ‰€æœ‰å·²ç™»å…¥ç”¨æˆ¶é–‹æ”¾ï¼Œä¸éœ€è¦ç‰¹æ®Šæ¬Šé™\n    }\n\n    // ç‰¹æ®Šåœ˜æ¬Šé™æª¢æŸ¥\n    if (pathname.includes('/special') ||\n        (pathname.includes('/tours') && request.nextUrl.searchParams.get('type') === 'special')) {\n      if (!hasRole(userPermissions, ['super_admin', 'admin'])) {\n        return NextResponse.redirect(new URL('/unauthorized', request.url));\n      }\n    }\n\n    // å ±è¡¨æ¬Šé™æª¢æŸ¥\n    if (pathname.startsWith('/reports')) {\n      if (!hasPermission(userPermissions, 'reports')) {\n        return NextResponse.redirect(new URL('/unauthorized', request.url));\n      }\n    }\n\n    // è¨­å®šæ¬Šé™æª¢æŸ¥\n    if (pathname.startsWith('/settings')) {\n      if (!hasPermission(userPermissions, 'settings')) {\n        return NextResponse.redirect(new URL('/unauthorized', request.url));\n      }\n    }\n\n    // åœ¨ response header ä¸­æ·»åŠ ç”¨æˆ¶è³‡è¨Šä¾›å¾ŒçºŒä½¿ç”¨\n    const response = NextResponse.next();\n    response.headers.set('x-user-id', user.id);\n    response.headers.set('x-user-permissions', JSON.stringify(userPermissions));\n\n    return response;\n\n  } catch (error) {\n    console.error('ğŸš« Middleware auth error:', error);\n    const response = NextResponse.redirect(new URL('/login', request.url));\n    response.cookies.delete('auth-token');\n    return response;\n  }\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * åŒ¹é…æ‰€æœ‰è·¯å¾‘é™¤äº†ï¼š\n     * - api è·¯ç”±\n     * - _next/static (éœæ…‹æ–‡ä»¶)\n     * - _next/image (åœ–åƒå„ªåŒ–)\n     * - favicon.ico (ç¶²ç«™åœ–æ¨™)\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico).*)',\n  ],\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,gBAAgB;IAChB,IACE,aAAa,YACb,SAAS,UAAU,CAAC,kBACpB,SAAS,UAAU,CAAC,cACpB,SAAS,UAAU,CAAC,mBACpB,aAAa,iBACb;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,uCAAuC;IACvC,uCAAuC;IACvC,OAAO,gMAAY,CAAC,IAAI;;;IAExB,aAAa;IACb,MAAM;AA4ER;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}