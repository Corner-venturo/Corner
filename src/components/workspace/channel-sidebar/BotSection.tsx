/**
 * 機器人區塊
 * 獨立顯示 VENTURO 機器人，放在公告下方
 */

'use client'

import { useMemo, useEffect } from 'react'
import { Bot } from 'lucide-react'
import { cn } from '@/lib/utils'
import { useEmployeeStore } from '@/stores'

// 系統機器人的固定 ID
export const SYSTEM_BOT_ID = '00000000-0000-0000-0000-000000000001'

interface BotSectionProps {
  onSelectBot: (botId: string) => void
  selectedBotId?: string | null
}

export function BotSection({
  onSelectBot,
  selectedBotId,
}: BotSectionProps) {
  const employees = useEmployeeStore(state => state.items)
  const fetchEmployees = useEmployeeStore(state => state.fetchAll)

  // 載入員工資料
  useEffect(() => {
    if (employees.length === 0) {
      fetchEmployees()
    }
  }, [employees.length, fetchEmployees])

  // 找到機器人
  const bot = useMemo(() => {
    return employees.find(emp => emp.id === SYSTEM_BOT_ID || emp.employee_number === 'BOT001')
  }, [employees])

  if (!bot) {
    return null
  }

  return (
    <div className="py-1">
      <button
        onClick={() => onSelectBot(bot.id)}
        className={cn(
          'w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors',
          selectedBotId === bot.id
            ? 'bg-morandi-gold/10 text-morandi-primary'
            : 'text-morandi-secondary hover:bg-morandi-container/30'
        )}
      >
        <div className="w-6 h-6 rounded-full bg-morandi-gold/20 flex items-center justify-center">
          <Bot size={14} className="text-morandi-gold" />
        </div>
        <span className="flex-1 text-left truncate font-medium">
          {bot.chinese_name || bot.display_name || 'VENTURO 機器人'}
        </span>
      </button>
    </div>
  )
}
